
###### Base Searches ######
[ESS - Notable Events by Geography - Base]
action.postprocess = 0
enableSched        = 0
is_visible         = false
search             = `notable` | search NOT `suppression` | table src,src_lat,src_long,src_city,src_country,dest,dest_lat,dest_long,dest_city,dest_country


###### Key Indicator Searches ######
[Notable - Total Events By Access Domain]
action.email.reportServerEnabled              = 0
alert.track                                   = 0
action.keyindicator                           = 1
action.keyindicator.title                     = Access Notables
action.keyindicator.subtitle                  = Total Count
action.keyindicator.value                     = current_count
action.keyindicator.threshold                 = 
action.keyindicator.delta                     = delta
action.keyindicator.invert                    = false
action.keyindicator.group.0.name              = security_posture
action.keyindicator.group.0.order             = 1
dispatch.latest_time                          = now
display.general.enablePreview                 = 1
display.general.timeRangePicker.show          = false
display.general.type                          = visualizations
display.statistics.rowNumbers                 = 0
display.statistics.wrap                       = 0
display.visualizations.charting.drilldown     = all
display.visualizations.singlevalue.underLabel = Access Notable Events
display.visualizations.show                   = 1
display.visualizations.type                   = singlevalue
search                                        = | `es_loadjob("ESS - Notable Events")` | search security_domain=access | stats sum(count) as count by timeDiff_type | transpose | sort 1 + column | rename "row 1" as current_count,"row 2" as historical_count | `get_delta` | table current_count,historical_count,delta

[Notable - Total Events By Endpoint Domain]
action.email.reportServerEnabled              = 0
alert.track                                   = 0
action.keyindicator                           = 1
action.keyindicator.title                     = Endpoint Notables
action.keyindicator.subtitle                  = Total Count
action.keyindicator.value                     = current_count
action.keyindicator.threshold                 = 
action.keyindicator.delta                     = delta
action.keyindicator.invert                    = false
action.keyindicator.group.0.name              = security_posture
action.keyindicator.group.0.order             = 2
dispatch.latest_time                          = now
display.general.enablePreview                 = 1
display.general.timeRangePicker.show          = false
display.general.type                          = visualizations
display.statistics.rowNumbers                 = 0
display.statistics.wrap                       = 0
display.visualizations.charting.drilldown     = all
display.visualizations.singlevalue.underLabel = Endpoint Notable Events
display.visualizations.show                   = 1
display.visualizations.type                   = singlevalue
search                                        = | `es_loadjob("ESS - Notable Events")` | search security_domain=endpoint | stats sum(count) as count by timeDiff_type | transpose | sort 1 + column | rename "row 1" as current_count,"row 2" as historical_count | `get_delta` | table current_count,historical_count,delta

[Notable - Total Events By Network Domain]
action.email.reportServerEnabled              = 0
alert.track                                   = 0
action.keyindicator                           = 1
action.keyindicator.title                     = Network Notables
action.keyindicator.subtitle                  = Total Count
action.keyindicator.value                     = current_count
action.keyindicator.threshold                 = 
action.keyindicator.delta                     = delta
action.keyindicator.invert                    = false
action.keyindicator.group.0.name              = security_posture
action.keyindicator.group.0.order             = 3
dispatch.latest_time                          = now
display.general.enablePreview                 = 1
display.general.timeRangePicker.show          = false
display.general.type                          = visualizations
display.statistics.rowNumbers                 = 0
display.statistics.wrap                       = 0
display.visualizations.charting.drilldown     = all
display.visualizations.singlevalue.underLabel = Network Notable Events
display.visualizations.show                   = 1
display.visualizations.type                   = singlevalue
search                                        = | `es_loadjob("ESS - Notable Events")` | search security_domain=network | stats sum(count) as count by timeDiff_type | transpose | sort 1 + column | rename "row 1" as current_count,"row 2" as historical_count | `get_delta` | table current_count,historical_count,delta

[Notable - Total Events By Identity Domain]
action.email.reportServerEnabled              = 0
alert.track                                   = 0
action.keyindicator                           = 1
action.keyindicator.title                     = Identity Notables
action.keyindicator.subtitle                  = Total Count
action.keyindicator.value                     = current_count
action.keyindicator.threshold                 = 
action.keyindicator.delta                     = delta
action.keyindicator.invert                    = false
action.keyindicator.group.0.name              = security_posture
action.keyindicator.group.0.order             = 4
dispatch.latest_time                          = now
display.general.enablePreview                 = 1
display.general.timeRangePicker.show          = false
display.general.type                          = visualizations
display.statistics.rowNumbers                 = 0
display.statistics.wrap                       = 0
display.visualizations.charting.drilldown     = all
display.visualizations.singlevalue.underLabel = Identity Notable Events
display.visualizations.show                   = 1
display.visualizations.type                   = singlevalue
search                                        = | `es_loadjob("ESS - Notable Events")` | search security_domain=identity | stats sum(count) as count by timeDiff_type | transpose | sort 1 + column | rename "row 1" as current_count,"row 2" as historical_count | `get_delta` | table current_count,historical_count,delta

[Notable - Total Events By Audit Domain]
action.email.reportServerEnabled              = 0
alert.track                                   = 0
action.keyindicator                           = 1
action.keyindicator.title                     = Audit Notables
action.keyindicator.subtitle                  = Total Count
action.keyindicator.value                     = current_count
action.keyindicator.threshold                 = 
action.keyindicator.delta                     = delta
action.keyindicator.invert                    = false
action.keyindicator.group.0.name              = security_posture
action.keyindicator.group.0.order             = 5
dispatch.latest_time                          = now
display.general.enablePreview                 = 1
display.general.timeRangePicker.show          = false
display.general.type                          = visualizations
display.statistics.rowNumbers                 = 0
display.statistics.wrap                       = 0
display.visualizations.charting.drilldown     = all
display.visualizations.singlevalue.underLabel = Audit Notable Events
display.visualizations.show                   = 1
display.visualizations.type                   = singlevalue
search                                        = | `es_loadjob("ESS - Notable Events")` | search security_domain=audit | stats sum(count) as count by timeDiff_type | transpose | sort 1 + column | rename "row 1" as current_count,"row 2" as historical_count | `get_delta` | table current_count,historical_count,delta

[Notable - Total Events By Threat Domain]
action.email.reportServerEnabled              = 0
alert.track                                   = 0
action.keyindicator                           = 1
action.keyindicator.title                     = Threat Notables
action.keyindicator.subtitle                  = Total Count
action.keyindicator.value                     = current_count
action.keyindicator.threshold                 = 
action.keyindicator.delta                     = delta
action.keyindicator.invert                    = false
action.keyindicator.group.0.name              = security_posture
action.keyindicator.group.0.order             = 6
dispatch.latest_time                          = now
display.general.enablePreview                 = 1
display.general.timeRangePicker.show          = false
display.general.type                          = visualizations
display.statistics.rowNumbers                 = 0
display.statistics.wrap                       = 0
display.visualizations.charting.drilldown     = all
display.visualizations.singlevalue.underLabel = Threat Notable Events
display.visualizations.show                   = 1
display.visualizations.type                   = singlevalue
search                                        = | `es_loadjob("ESS - Notable Events")` | search security_domain=threat | stats sum(count) as count by timeDiff_type | transpose | sort 1 + column | rename "row 1" as current_count,"row 2" as historical_count | `get_delta` | table current_count,historical_count,delta

[Notable - Notable Events Exceeding Analyst Capacity]
action.email.reportServerEnabled              = 0
alert.track                                   = 0
action.keyindicator                           = 1
action.keyindicator.title                     = Excess Notable Events
action.keyindicator.subtitle                  = Total Count
action.keyindicator.value                     = current_count
action.keyindicator.threshold                 = 
action.keyindicator.delta                     = delta
action.keyindicator.invert                    = false
action.keyindicator.group.0.name              = 
action.keyindicator.group.0.order             = 
dispatch.latest_time                          = now
display.general.enablePreview                 = 1
display.general.timeRangePicker.show          = false
display.general.type                          = visualizations
display.statistics.rowNumbers                 = 0
display.statistics.wrap                       = 0
display.visualizations.charting.drilldown     = all
display.visualizations.singlevalue.underLabel = Excess Notable Events
display.visualizations.show                   = 1
display.visualizations.type                   = singlevalue
search                                        = | `es_loadjob("ESS - Notable Events")` | search NOT status_group="Closed" | stats sum(count) as count by timeDiff_type | transpose | sort 1 + column | rename "row 1" as current_count,"row 2" as historical_count | appendcols [| `incident_review_capacity`] | eval current_count=if(current_count>incident_review_capacity, current_count-incident_review_capacity, 0) | eval historical_count=if(historical_count>incident_review_capacity,historical_count-incident_review_capacity,0) | `get_delta` | table current_count,historical_count,delta


###### Report Searches ######
[Audit - ES View Activity Over Time]
action.email.reportServerEnabled                    = 0
alert.track                                         = 0
dispatch.earliest_time                              = -7d@d
dispatch.latest_time                                = now
display.general.enablePreview                       = 1
display.general.type                                = visualizations
display.statistics.rowNumbers                       = 0
display.statistics.wrap                             = 0
display.visualizations.charting.chart               = line
display.visualizations.charting.chart.nullValueMode = zero
display.visualizations.charting.drilldown           = all
display.visualizations.show                         = 1
display.visualizations.type                         = charting
search                                              = | `tstats` count from datamodel=Splunk_Audit where View_Activity.app=SplunkEnterpriseSecuritySuite by _time,View_Activity.view span=1h | timechart span=1h useother=`useother` count by View_Activity.view | `drop_dm_object_name("View_Activity")`

[Audit - Expected ES View Activity]
action.email.reportServerEnabled     = 0
alert.track                          = 0
dispatch.earliest_time               = -7d@d
dispatch.latest_time                 = now
display.general.enablePreview        = 1
display.general.timeRangePicker.show = false
display.general.type                 = statistics
display.statistics.drilldown         = row
display.statistics.rowNumbers        = 0
display.statistics.wrap              = 0
display.visualizations.show          = 0
search                               = | `expected_view_tracker("-7d","SplunkEnterpriseSecuritySuite")` | bin _time span=1d | `ctime(_time,"%m-%d-%Y")` | chart sum(count) as count over view by _time

[Notable - Events By Urgency]
action.email.reportServerEnabled          = 0
alert.track                               = 0
## dispatch times are for drilldown purposes only
dispatch.earliest_time                    = -24h@h
dispatch.latest_time                      = now
display.general.enablePreview             = 1
display.general.timeRangePicker.show      = false
display.general.type                      = visualizations
display.statistics.rowNumbers             = 0
display.statistics.wrap                   = 0
display.visualizations.charting.chart     = bar
display.visualizations.charting.drilldown = all
display.visualizations.show               = 1
search                                    = | `es_loadjob("ESS - Notable Events")` | search timeDiff_type=current | stats count by urgency

[Notable - Events Over Time]
action.email.reportServerEnabled                    = 0
alert.track                                         = 0
## dispatch times are for drilldown purposes only
dispatch.earliest_time                              = -24h@h
dispatch.latest_time                                = now
display.general.enablePreview                       = 1
display.general.timeRangePicker.show                = false
display.general.type                                = visualizations
display.statistics.rowNumbers                       = 0
display.statistics.wrap                             = 0
display.visualizations.charting.chart               = line
display.visualizations.charting.chart.nullValueMode = zero
display.visualizations.charting.drilldown           = all
display.visualizations.show                         = 1
display.visualizations.type                         = charting
search                                              = | `es_loadjob("ESS - Notable Events")` | search timeDiff_type=current | timechart minspan=30m sum(count) as count

[Notable - Events Over Time By Security Domain]
action.email.reportServerEnabled                    = 0
alert.track                                         = 0
## dispatch times are for drilldown purposes only
dispatch.earliest_time                              = -24h@h
dispatch.latest_time                                = now
display.general.enablePreview                       = 1
display.general.timeRangePicker.show                = false
display.general.type                                = visualizations
display.statistics.rowNumbers                       = 0
display.statistics.wrap                             = 0
display.visualizations.charting.chart               = line
display.visualizations.charting.chart.nullValueMode = zero
display.visualizations.charting.drilldown           = all
display.visualizations.show                         = 1
display.visualizations.type                         = charting
search                                              = | `es_loadjob("ESS - Notable Events")` | search timeDiff_type=current | timechart minspan=30m sum(count) as count by security_domain

[Notable - Top Events]
action.email.reportServerEnabled     = 0
alert.track                          = 0
## dispatch times are for drilldown purposes only
dispatch.earliest_time               = -24h@h
dispatch.latest_time                 = now
display.general.enablePreview        = 1
display.general.timeRangePicker.show = false
display.general.type                 = statistics
display.statistics.drilldown         = row
display.statistics.rowNumbers        = 0
display.statistics.wrap              = 0
display.visualizations.show          = 0
search                               = | `es_loadjob("ESS - Notable Events")` | search timeDiff_type=current | stats sparkline(sum(count),30m) as sparkline,count by rule_name | sort 100 - count

[Notable - Top Notable Event Sources]
action.email.reportServerEnabled     = 0
alert.track                          = 0
## dispatch times are for drilldown purposes only
dispatch.earliest_time               = -24h@h
dispatch.latest_time                 = now
display.general.enablePreview        = 1
display.general.timeRangePicker.show = false
display.general.type                 = statistics
display.statistics.drilldown         = row
display.statistics.rowNumbers        = 0
display.statistics.wrap              = 0
display.visualizations.show          = 0
search                               = | `es_loadjob("ESS - Notable Events")` | search timeDiff_type=current src!=unknown | stats sparkline(sum(count),30m) as sparkline,dc(rule_name) as correlation_search_count,dc(security_domain) as security_domain_count,count by src | sort 100 - count,correlation_search_count

[Notable - Top Notable Event Destinations]
action.email.reportServerEnabled     = 0
alert.track                          = 0
## dispatch times are for drilldown purposes only
dispatch.earliest_time               = -24h@h
dispatch.latest_time                 = now
display.general.enablePreview        = 1
display.general.timeRangePicker.show = false
display.general.type                 = statistics
display.statistics.drilldown         = row
display.statistics.rowNumbers        = 0
display.statistics.wrap              = 0
display.visualizations.show          = 0
search                               = | `es_loadjob("ESS - Notable Events")` | search timeDiff_type=current dest!=unknown | stats sparkline(sum(count),30m) as sparkline,dc(rule_name) as correlation_search_count,dc(security_domain) as security_domain_count,count by dest | sort 100 - count,correlation_search_count


###### UI Searches ######
[ESS - Notable Events]
cron_schedule          = */10 * * * *
alert.suppress         = 0
## Caution: Do not change earliest/latest w/o updating timeDiff comparison operators
## The timeDiff comparison operators determine if a result should be used for historical trending vs. current charting
dispatch.earliest_time = -48h@h
dispatch.latest_time   = now
enableSched            = 1
is_visible             = false
run_on_startup         = true
## NOTE that we had to add a fillnull here.   dest and src are not present on every event, and 'stats by foo,bar,baz' will discard any rows that dont have foo, bar AND baz present.   
## If you think that the events coming into the stats clause *should* have values for all these fields,  then your starting point to debug the situation should be the following search, which will tell you which ones are missing:: 
## `notable` | search NOT `suppression` | eval has_urgency=if(isnull(urgency),0,1) | eval has_dest=if(isnull(dest),0,1) | eval has_src=if(isnull(src),0,1) | eval has_security_domain=if(isnull(security_domain),0,1) |eval has_rule_name=if(isnull(rule_name),0,1) | stats count sum(has_*) 
## --ncm
search                 = `notable` | search NOT `suppression` | bucket _time span=30m | fillnull value="unknown" dest src | stats count by _time,security_domain,urgency,rule_name,dest,src,status,status_group | convert mktime(_time) as time | `timeDiff` | eval timeDiff_type=case(timeDiff<=86400,"current",timeDiff>86400 AND timeDiff<=172800,"historical",1=1,"unknown") | `security_domains` | fillnull value="historical" timeDiff_type | `security_domains` | fillnull value="current" timeDiff_type | fields - time,timeDiff,is_enabled,is_expected,is_ignored,security_domain_label
