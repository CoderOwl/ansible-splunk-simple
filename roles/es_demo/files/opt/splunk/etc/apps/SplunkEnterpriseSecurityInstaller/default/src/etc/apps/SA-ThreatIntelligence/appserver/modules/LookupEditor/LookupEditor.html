<%page args="module"/>

<%namespace name="lib" file="//lib.html" import="*"/>

<%
## Copyright (C) 2009-2012 Splunk Inc. All Rights Reserved.
import cherrypy

from LookupEditor import LookupEditor

## Get args
args = cherrypy.serving.request.params

## Get cherry key
session_key = cherrypy.session.get('sessionKey')

## Get cherry username
user = cherrypy.session['user']['name']

## Get capabilities
capabilities = LookupEditor.getCapabilities4User(user, session_key)

## Test capabilities
insufficient_permissions = True

if 'edit_lookups' in capabilities:
    insufficient_permissions = False
    path = args.get('path')
    
else:
    path = 'insufficient_permissions'

## Get app
app = APP['id']

## Get list view
listView = module['params'].get('listView', '')

error = None

formAction = make_url(["custom", "SA-ThreatIntelligence", "lookupeditor", "save"])

def escape_javascript( string_to_strip ):
    return string_to_strip.replace('"','').replace("'","").replace("<","").replace(">","").replace("\n","")
%>

<style type="text/css">
    @import url("${make_url(['/static/css/admin.css'])}"); 
    
    .lookupData {
        height: 400px;
        width: 99%;
    	font-family:"Courier New", Courier,monospace;
    }
    
    #no_permissions div.adminGroup {
      border: none;
      box-shadow: none;
      padding: 0px;
    }
    
    #no_permissions div.adminListItem {
      border-bottom: none;
      min-height: 45px;
      padding-left: 15px;
    }
    
    #no_permissions dd {
      border-left: none;
      padding-top: 16px;
    }
</style>

<script>
    var app = "${app}";
    var listView = "${listView}";
</script>

% if not insufficient_permissions:
  % if error:
      <div class="error">${error}<div>
      <% return %>
  % endif
  
  <div class="lookuped">
      <h1></h1>
      <form name="lookupEditorForm" class="lookupEditorForm" method="POST" action="${formAction}" autocomplete="off" enctype="multipart/form-data">
          <input type="hidden" id="selectedLookup" name="selectedLookup" value="${path|h}">
          <input type="hidden" name="splunk_session_id" value="${cherrypy.session.id|h}">
          ${csrf_hidden_input()}
          
          <textarea name="lookupData" class="lookupData"></textarea>
          
          <div class="jmFormActions">
              <button class="splButton-secondary" type="button" onclick="window.location='${listView|h}'">
                  <span>Cancel</span>
              </button>
              <button class="splButton-primary" type="submit">
                  <span>Save</span>
              </button>
          </div>
      </form>
  </div>
% else:
  <div class="adminContent">
    <div class="adminIndex" id="no_permissions">
      <div class="adminGroup">
        <div class="adminListItem">
          <a class="adminListIcon" style="background: url(${make_url(['/static/img/skins/default/managerIcons/icon_access.png'])}) no-repeat 0px 0;"></a>
          <dd>You do not have the necessary capabilities required to edit lookups.  Please contact your Splunk administrator.</dd>
        </div>
      </div>
    </div>
  </div>
% endif