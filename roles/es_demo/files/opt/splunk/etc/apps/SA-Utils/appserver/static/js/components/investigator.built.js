function sprintf(){var regex=/%%|%(\d+\$)?(\([^)]+\))?([-+#0 ]*)(\*\d+\$|\*|\d+)?(\.(\*\d+\$|\*|\d+))?([scboxXuidfegEG])/g,a=arguments,i=0,format=a[i];i++;var pad=function(str,len,chr,leftJustify){var padding=str.length>=len?"":Array(1+len-str.length>>>0).join(chr);return leftJustify?str+padding:padding+str},justify=function(value,prefix,leftJustify,minWidth,zeroPad){var diff=minWidth-value.length;diff>0&&(value=leftJustify||!zeroPad?pad(value,minWidth," ",leftJustify):value.slice(0,prefix.length)+pad("",diff,"0",!0)+value.slice(prefix.length));return value},formatBaseX=function(value,base,prefix,leftJustify,minWidth,precision,zeroPad){var number=value>>>0;prefix=prefix&&number&&{2:"0b",8:"0",16:"0x"}[base]||"";value=prefix+pad(number.toString(base),precision||0,"0",!1);return justify(value,prefix,leftJustify,minWidth,zeroPad)},formatString=function(value,leftJustify,minWidth,precision,zeroPad){null!=precision&&(value=value.slice(0,precision));return justify(value,"",leftJustify,minWidth,zeroPad)},doFormat=function(substring,valueIndex,valueName,flags,minWidth,_,precision,type){if("%%"==substring)return"%";for(var leftJustify=!1,positivePrefix="",zeroPad=!1,prefixBaseX=!1,flagsl=flags.length,j=0;flags&&flagsl>j;j++)switch(flags.charAt(j)){case" ":positivePrefix=" ";break;case"+":positivePrefix="+";break;case"-":leftJustify=!0;break;case"0":zeroPad=!0;break;case"#":prefixBaseX=!0}if(minWidth)if("*"==minWidth){minWidth=+a[i];i++}else minWidth="*"==minWidth.charAt(0)?+a[minWidth.slice(1,-1)]:+minWidth;else minWidth=0;if(0>minWidth){minWidth=-minWidth;leftJustify=!0}if(!isFinite(minWidth))throw new Error("sprintf: (minimum-)width must be finite");if(precision)if("*"==precision){precision=+a[i];i++}else precision="*"==precision.charAt(0)?+a[precision.slice(1,-1)]:+precision;else precision="fFeE".indexOf(type)>-1?6:"d"==type?0:void 0;var value;if(valueName){valueName=valueName.substr(1,valueName.length-2);value=a[1].__getitem__?a[1].__getitem__(valueName):a[1][valueName]}else if(valueIndex)value=a[valueIndex.slice(0,-1)];else{value=a[i];i++}var number,prefix;switch(type){case"s":return formatString(String(value),leftJustify,minWidth,precision,zeroPad);case"c":return formatString(String.fromCharCode(+value),leftJustify,minWidth,precision,zeroPad);case"b":return formatBaseX(value,2,prefixBaseX,leftJustify,minWidth,precision,zeroPad);case"o":return formatBaseX(value,8,prefixBaseX,leftJustify,minWidth,precision,zeroPad);case"x":return formatBaseX(value,16,prefixBaseX,leftJustify,minWidth,precision,zeroPad);case"X":return formatBaseX(value,16,prefixBaseX,leftJustify,minWidth,precision,zeroPad).toUpperCase();case"u":return formatBaseX(value,10,prefixBaseX,leftJustify,minWidth,precision,zeroPad);case"i":case"d":number=parseInt(+value,10);prefix=0>number?"-":positivePrefix;value=prefix+pad(String(Math.abs(number)),precision,"0",!1);return justify(value,prefix,leftJustify,minWidth,zeroPad);case"e":case"E":case"f":case"F":case"g":case"G":number=+value;prefix=0>number?"-":positivePrefix;var method=["toExponential","toFixed","toPrecision"]["efg".indexOf(type.toLowerCase())],textTransform=["toString","toUpperCase"]["eEfFgG".indexOf(type)%2];value=prefix+Math.abs(number)[method](precision);return justify(value,prefix,leftJustify,minWidth,zeroPad)[textTransform]();default:return substring}};return format.replace(regex,doFormat)}this.JSON||(JSON={});!function(){function f(n){return 10>n?"0"+n:n}function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return"string"==typeof c?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,partial,mind=gap,value=holder[key];value&&"object"==typeof value&&"function"==typeof value.toJSON&&(value=value.toJSON(key));"function"==typeof rep&&(value=rep.call(holder,key,value));switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value)return"null";gap+=indent;partial=[];if("[object Array]"===Object.prototype.toString.apply(value)){length=value.length;for(i=0;length>i;i+=1)partial[i]=str(i,value)||"null";v=0===partial.length?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&"object"==typeof rep){length=rep.length;for(i=0;length>i;i+=1){k=rep[i];if("string"==typeof k){v=str(k,value);v&&partial.push(quote(k)+(gap?": ":":")+v)}}}else for(k in value)if(Object.hasOwnProperty.call(value,k)){v=str(k,value);v&&partial.push(quote(k)+(gap?": ":":")+v)}v=0===partial.length?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if("function"!=typeof Date.prototype.toJSON){Date.prototype.toJSON=function(){return this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z"};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if("number"==typeof space)for(i=0;space>i;i+=1)indent+=" ";else"string"==typeof space&&(indent=space);rep=replacer;if(replacer&&"function"!=typeof replacer&&("object"!=typeof replacer||"number"!=typeof replacer.length))throw new Error("JSON.stringify");return str("",{"":value})});"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(holder,key){var k,v,value=holder[key];if(value&&"object"==typeof value)for(k in value)if(Object.hasOwnProperty.call(value,k)){v=walk(value,k);void 0!==v?value[k]=v:delete value[k]}return reviver.call(holder,key,value)}var j;cx.lastIndex=0;cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return"function"==typeof reviver?walk({"":j},""):j}throw new SyntaxError("JSON.parse")})}();Number.prototype.pad=function(n,p){var s=""+this;p=p||"0";for(;s.length<n;)s=p+s;return s};Date.prototype.months=["January","February","March","April","May","June","July","August","September","October","November","December"];Date.prototype.weekdays=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];Date.prototype.dpm=[31,28,31,30,31,30,31,31,30,31,30,31];Date.prototype.strftime_f={A:function(d){return d.weekdays[d.getDay()]},a:function(d){return d.weekdays[d.getDay()].substring(0,3)},B:function(d){return d.months[d.getMonth()]},b:function(d){return d.months[d.getMonth()].substring(0,3)},C:function(d){return Math.floor(d.getFullYear()/100)},c:function(d){return d.toString()},D:function(d){return d.strftime_f.m(d)+"/"+d.strftime_f.d(d)+"/"+d.strftime_f.y(d)},d:function(d){return d.getDate().pad(2,"0")},e:function(d){return d.getDate()},F:function(d){return d.strftime_f.Y(d)+"-"+d.strftime_f.m(d)+"-"+d.strftime_f.d(d)},H:function(d){return d.getHours().pad(2,"0")},I:function(d){return(d.getHours()%12||12).pad(2)},j:function(d){var t=d.getDate(),m=d.getMonth()-1;if(m>1){var y=d.getYear();y%100==0&&y%400==0?++t:y%4==0&&++t}for(;m>-1;)t+=d.dpm[m--];return t.pad(3,"0")},k:function(d){return d.getHours().pad(2," ")},l:function(d){return d.getHours()%12||12},M:function(d){return d.getMinutes().pad(2,"0")},m:function(d){return(d.getMonth()+1).pad(2,"0")},n:function(){return"\n"},p:function(d){return d.getHours()>11?"PM":"AM"},Q:function(d){return 0==d.getMilliseconds()?"000":d.getMilliseconds().pad(3,"0")},R:function(d){return d.strftime_f.H(d)+":"+d.strftime_f.M(d)},r:function(d){return d.strftime_f.I(d)+":"+d.strftime_f.M(d)+":"+d.strftime_f.S(d)+" "+d.strftime_f.p(d)},S:function(d){return d.getSeconds().pad(2,"0")},s:function(d){return Math.floor(d.getTime()/1e3)},T:function(d){return d.strftime_f.H(d)+":"+d.strftime_f.M(d)+":"+d.strftime_f.S(d)},t:function(){return"	"},u:function(d){return d.getDay()||7},v:function(d){return d.strftime_f.e(d)+"-"+d.strftime_f.b(d)+"-"+d.strftime_f.Y(d)},w:function(d){return d.getDay()},X:function(d){return d.toTimeString()},x:function(d){return d.toDateString()},Y:function(d){return d.getFullYear()},y:function(d){return(d.getYear()%100).pad(2)},z:function(){return""},Z:function(){return""},"%":function(){return"%"}};Date.prototype.strftime_f["+"]=Date.prototype.strftime_f.c;Date.prototype.strftime_f.h=Date.prototype.strftime_f.b;Date.prototype.strftime=function(fmt){var rv;if(rv=this[fmt])return rv;for(var r=[],n=0;n<fmt.length;){var c=fmt.charAt(n);if("%"==c){c=fmt.charAt(++n);r.push(this.strftime_f[c]?this.strftime_f[c](this):c)}else r.push(c);++n}return this[fmt]=r.join("")};define("strftime",function(){});!function(window,undefined){function isArraylike(obj){var length=obj.length,type=jQuery.type(obj);return jQuery.isWindow(obj)?!1:1===obj.nodeType&&length?!0:"array"===type||"function"!==type&&(0===length||"number"==typeof length&&length>0&&length-1 in obj)}function createOptions(options){var object=optionsCache[options]={};jQuery.each(options.match(core_rnotwhite)||[],function(_,flag){object[flag]=!0});return object}function internalData(elem,name,data,pvt){if(jQuery.acceptData(elem)){var ret,thisCache,internalKey=jQuery.expando,isNode=elem.nodeType,cache=isNode?jQuery.cache:elem,id=isNode?elem[internalKey]:elem[internalKey]&&internalKey;if(id&&cache[id]&&(pvt||cache[id].data)||data!==undefined||"string"!=typeof name){id||(id=isNode?elem[internalKey]=core_deletedIds.pop()||jQuery.guid++:internalKey);cache[id]||(cache[id]=isNode?{}:{toJSON:jQuery.noop});("object"==typeof name||"function"==typeof name)&&(pvt?cache[id]=jQuery.extend(cache[id],name):cache[id].data=jQuery.extend(cache[id].data,name));thisCache=cache[id];if(!pvt){thisCache.data||(thisCache.data={});thisCache=thisCache.data}data!==undefined&&(thisCache[jQuery.camelCase(name)]=data);if("string"==typeof name){ret=thisCache[name];null==ret&&(ret=thisCache[jQuery.camelCase(name)])}else ret=thisCache;return ret}}}function internalRemoveData(elem,name,pvt){if(jQuery.acceptData(elem)){var thisCache,i,isNode=elem.nodeType,cache=isNode?jQuery.cache:elem,id=isNode?elem[jQuery.expando]:jQuery.expando;if(cache[id]){if(name){thisCache=pvt?cache[id]:cache[id].data;if(thisCache){if(jQuery.isArray(name))name=name.concat(jQuery.map(name,jQuery.camelCase));else if(name in thisCache)name=[name];else{name=jQuery.camelCase(name);name=name in thisCache?[name]:name.split(" ")}i=name.length;for(;i--;)delete thisCache[name[i]];if(pvt?!isEmptyDataObject(thisCache):!jQuery.isEmptyObject(thisCache))return}}if(!pvt){delete cache[id].data;if(!isEmptyDataObject(cache[id]))return}isNode?jQuery.cleanData([elem],!0):jQuery.support.deleteExpando||cache!=cache.window?delete cache[id]:cache[id]=null}}}function dataAttr(elem,key,data){if(data===undefined&&1===elem.nodeType){var name="data-"+key.replace(rmultiDash,"-$1").toLowerCase();data=elem.getAttribute(name);if("string"==typeof data){try{data="true"===data?!0:"false"===data?!1:"null"===data?null:+data+""===data?+data:rbrace.test(data)?jQuery.parseJSON(data):data}catch(e){}jQuery.data(elem,key,data)}else data=undefined}return data}function isEmptyDataObject(obj){var name;for(name in obj)if(("data"!==name||!jQuery.isEmptyObject(obj[name]))&&"toJSON"!==name)return!1;return!0}function returnTrue(){return!0}function returnFalse(){return!1}function safeActiveElement(){try{return document.activeElement}catch(err){}}function sibling(cur,dir){do cur=cur[dir];while(cur&&1!==cur.nodeType);return cur}function winnow(elements,qualifier,not){if(jQuery.isFunction(qualifier))return jQuery.grep(elements,function(elem,i){return!!qualifier.call(elem,i,elem)!==not});if(qualifier.nodeType)return jQuery.grep(elements,function(elem){return elem===qualifier!==not});if("string"==typeof qualifier){if(isSimple.test(qualifier))return jQuery.filter(qualifier,elements,not);qualifier=jQuery.filter(qualifier,elements)}return jQuery.grep(elements,function(elem){return jQuery.inArray(elem,qualifier)>=0!==not})}function createSafeFragment(document){var list=nodeNames.split("|"),safeFrag=document.createDocumentFragment();if(safeFrag.createElement)for(;list.length;)safeFrag.createElement(list.pop());return safeFrag}function manipulationTarget(elem,content){return jQuery.nodeName(elem,"table")&&jQuery.nodeName(1===content.nodeType?content:content.firstChild,"tr")?elem.getElementsByTagName("tbody")[0]||elem.appendChild(elem.ownerDocument.createElement("tbody")):elem}function disableScript(elem){elem.type=(null!==jQuery.find.attr(elem,"type"))+"/"+elem.type;return elem}function restoreScript(elem){var match=rscriptTypeMasked.exec(elem.type);match?elem.type=match[1]:elem.removeAttribute("type");return elem}function setGlobalEval(elems,refElements){for(var elem,i=0;null!=(elem=elems[i]);i++)jQuery._data(elem,"globalEval",!refElements||jQuery._data(refElements[i],"globalEval"))}function cloneCopyEvent(src,dest){if(1===dest.nodeType&&jQuery.hasData(src)){var type,i,l,oldData=jQuery._data(src),curData=jQuery._data(dest,oldData),events=oldData.events;if(events){delete curData.handle;curData.events={};for(type in events)for(i=0,l=events[type].length;l>i;i++)jQuery.event.add(dest,type,events[type][i])}curData.data&&(curData.data=jQuery.extend({},curData.data))}}function fixCloneNodeIssues(src,dest){var nodeName,e,data;if(1===dest.nodeType){nodeName=dest.nodeName.toLowerCase();if(!jQuery.support.noCloneEvent&&dest[jQuery.expando]){data=jQuery._data(dest);for(e in data.events)jQuery.removeEvent(dest,e,data.handle);dest.removeAttribute(jQuery.expando)}if("script"===nodeName&&dest.text!==src.text){disableScript(dest).text=src.text;restoreScript(dest)}else if("object"===nodeName){dest.parentNode&&(dest.outerHTML=src.outerHTML);jQuery.support.html5Clone&&src.innerHTML&&!jQuery.trim(dest.innerHTML)&&(dest.innerHTML=src.innerHTML)}else if("input"===nodeName&&manipulation_rcheckableType.test(src.type)){dest.defaultChecked=dest.checked=src.checked;dest.value!==src.value&&(dest.value=src.value)}else"option"===nodeName?dest.defaultSelected=dest.selected=src.defaultSelected:("input"===nodeName||"textarea"===nodeName)&&(dest.defaultValue=src.defaultValue)}}function getAll(context,tag){var elems,elem,i=0,found=typeof context.getElementsByTagName!==core_strundefined?context.getElementsByTagName(tag||"*"):typeof context.querySelectorAll!==core_strundefined?context.querySelectorAll(tag||"*"):undefined;if(!found)for(found=[],elems=context.childNodes||context;null!=(elem=elems[i]);i++)!tag||jQuery.nodeName(elem,tag)?found.push(elem):jQuery.merge(found,getAll(elem,tag));return tag===undefined||tag&&jQuery.nodeName(context,tag)?jQuery.merge([context],found):found}function fixDefaultChecked(elem){manipulation_rcheckableType.test(elem.type)&&(elem.defaultChecked=elem.checked)}function vendorPropName(style,name){if(name in style)return name;for(var capName=name.charAt(0).toUpperCase()+name.slice(1),origName=name,i=cssPrefixes.length;i--;){name=cssPrefixes[i]+capName;if(name in style)return name}return origName}function isHidden(elem,el){elem=el||elem;return"none"===jQuery.css(elem,"display")||!jQuery.contains(elem.ownerDocument,elem)}function showHide(elements,show){for(var display,elem,hidden,values=[],index=0,length=elements.length;length>index;index++){elem=elements[index];if(elem.style){values[index]=jQuery._data(elem,"olddisplay");display=elem.style.display;if(show){values[index]||"none"!==display||(elem.style.display="");""===elem.style.display&&isHidden(elem)&&(values[index]=jQuery._data(elem,"olddisplay",css_defaultDisplay(elem.nodeName)))}else if(!values[index]){hidden=isHidden(elem);(display&&"none"!==display||!hidden)&&jQuery._data(elem,"olddisplay",hidden?display:jQuery.css(elem,"display"))}}}for(index=0;length>index;index++){elem=elements[index];elem.style&&(show&&"none"!==elem.style.display&&""!==elem.style.display||(elem.style.display=show?values[index]||"":"none"))}return elements}function setPositiveNumber(elem,value,subtract){var matches=rnumsplit.exec(value);return matches?Math.max(0,matches[1]-(subtract||0))+(matches[2]||"px"):value}function augmentWidthOrHeight(elem,name,extra,isBorderBox,styles){for(var i=extra===(isBorderBox?"border":"content")?4:"width"===name?1:0,val=0;4>i;i+=2){"margin"===extra&&(val+=jQuery.css(elem,extra+cssExpand[i],!0,styles));if(isBorderBox){"content"===extra&&(val-=jQuery.css(elem,"padding"+cssExpand[i],!0,styles));"margin"!==extra&&(val-=jQuery.css(elem,"border"+cssExpand[i]+"Width",!0,styles))}else{val+=jQuery.css(elem,"padding"+cssExpand[i],!0,styles);"padding"!==extra&&(val+=jQuery.css(elem,"border"+cssExpand[i]+"Width",!0,styles))}}return val}function getWidthOrHeight(elem,name,extra){var valueIsBorderBox=!0,val="width"===name?elem.offsetWidth:elem.offsetHeight,styles=getStyles(elem),isBorderBox=jQuery.support.boxSizing&&"border-box"===jQuery.css(elem,"boxSizing",!1,styles);if(0>=val||null==val){val=curCSS(elem,name,styles);(0>val||null==val)&&(val=elem.style[name]);if(rnumnonpx.test(val))return val;valueIsBorderBox=isBorderBox&&(jQuery.support.boxSizingReliable||val===elem.style[name]);val=parseFloat(val)||0}return val+augmentWidthOrHeight(elem,name,extra||(isBorderBox?"border":"content"),valueIsBorderBox,styles)+"px"}function css_defaultDisplay(nodeName){var doc=document,display=elemdisplay[nodeName];if(!display){display=actualDisplay(nodeName,doc);if("none"===display||!display){iframe=(iframe||jQuery("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(doc.documentElement);doc=(iframe[0].contentWindow||iframe[0].contentDocument).document;doc.write("<!doctype html><html><body>");doc.close();display=actualDisplay(nodeName,doc);iframe.detach()}elemdisplay[nodeName]=display}return display}function actualDisplay(name,doc){var elem=jQuery(doc.createElement(name)).appendTo(doc.body),display=jQuery.css(elem[0],"display");elem.remove();return display}function buildParams(prefix,obj,traditional,add){var name;if(jQuery.isArray(obj))jQuery.each(obj,function(i,v){traditional||rbracket.test(prefix)?add(prefix,v):buildParams(prefix+"["+("object"==typeof v?i:"")+"]",v,traditional,add)});else if(traditional||"object"!==jQuery.type(obj))add(prefix,obj);else for(name in obj)buildParams(prefix+"["+name+"]",obj[name],traditional,add)}function addToPrefiltersOrTransports(structure){return function(dataTypeExpression,func){if("string"!=typeof dataTypeExpression){func=dataTypeExpression;dataTypeExpression="*"}var dataType,i=0,dataTypes=dataTypeExpression.toLowerCase().match(core_rnotwhite)||[];if(jQuery.isFunction(func))for(;dataType=dataTypes[i++];)if("+"===dataType[0]){dataType=dataType.slice(1)||"*";(structure[dataType]=structure[dataType]||[]).unshift(func)}else(structure[dataType]=structure[dataType]||[]).push(func)}}function inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR){function inspect(dataType){var selected;inspected[dataType]=!0;jQuery.each(structure[dataType]||[],function(_,prefilterOrFactory){var dataTypeOrTransport=prefilterOrFactory(options,originalOptions,jqXHR);if("string"==typeof dataTypeOrTransport&&!seekingTransport&&!inspected[dataTypeOrTransport]){options.dataTypes.unshift(dataTypeOrTransport);inspect(dataTypeOrTransport);return!1}return seekingTransport?!(selected=dataTypeOrTransport):void 0});return selected}var inspected={},seekingTransport=structure===transports;return inspect(options.dataTypes[0])||!inspected["*"]&&inspect("*")}function ajaxExtend(target,src){var deep,key,flatOptions=jQuery.ajaxSettings.flatOptions||{};for(key in src)src[key]!==undefined&&((flatOptions[key]?target:deep||(deep={}))[key]=src[key]);deep&&jQuery.extend(!0,target,deep);return target}function ajaxHandleResponses(s,jqXHR,responses){for(var firstDataType,ct,finalDataType,type,contents=s.contents,dataTypes=s.dataTypes;"*"===dataTypes[0];){dataTypes.shift();ct===undefined&&(ct=s.mimeType||jqXHR.getResponseHeader("Content-Type"))}if(ct)for(type in contents)if(contents[type]&&contents[type].test(ct)){dataTypes.unshift(type);break}if(dataTypes[0]in responses)finalDataType=dataTypes[0];else{for(type in responses){if(!dataTypes[0]||s.converters[type+" "+dataTypes[0]]){finalDataType=type;break}firstDataType||(firstDataType=type)}finalDataType=finalDataType||firstDataType}if(finalDataType){finalDataType!==dataTypes[0]&&dataTypes.unshift(finalDataType);return responses[finalDataType]}}function ajaxConvert(s,response,jqXHR,isSuccess){var conv2,current,conv,tmp,prev,converters={},dataTypes=s.dataTypes.slice();if(dataTypes[1])for(conv in s.converters)converters[conv.toLowerCase()]=s.converters[conv];current=dataTypes.shift();for(;current;){s.responseFields[current]&&(jqXHR[s.responseFields[current]]=response);!prev&&isSuccess&&s.dataFilter&&(response=s.dataFilter(response,s.dataType));prev=current;current=dataTypes.shift();if(current)if("*"===current)current=prev;else if("*"!==prev&&prev!==current){conv=converters[prev+" "+current]||converters["* "+current];if(!conv)for(conv2 in converters){tmp=conv2.split(" ");if(tmp[1]===current){conv=converters[prev+" "+tmp[0]]||converters["* "+tmp[0]];if(conv){if(conv===!0)conv=converters[conv2];else if(converters[conv2]!==!0){current=tmp[0];dataTypes.unshift(tmp[1])}break}}}if(conv!==!0)if(conv&&s["throws"])response=conv(response);else try{response=conv(response)}catch(e){return{state:"parsererror",error:conv?e:"No conversion from "+prev+" to "+current}}}}return{state:"success",data:response}}function createStandardXHR(){try{return new window.XMLHttpRequest}catch(e){}}function createActiveXHR(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}function createFxNow(){setTimeout(function(){fxNow=undefined});return fxNow=jQuery.now()}function createTween(value,prop,animation){for(var tween,collection=(tweeners[prop]||[]).concat(tweeners["*"]),index=0,length=collection.length;length>index;index++)if(tween=collection[index].call(animation,prop,value))return tween}function Animation(elem,properties,options){var result,stopped,index=0,length=animationPrefilters.length,deferred=jQuery.Deferred().always(function(){delete tick.elem}),tick=function(){if(stopped)return!1;for(var currentTime=fxNow||createFxNow(),remaining=Math.max(0,animation.startTime+animation.duration-currentTime),temp=remaining/animation.duration||0,percent=1-temp,index=0,length=animation.tweens.length;length>index;index++)animation.tweens[index].run(percent);deferred.notifyWith(elem,[animation,percent,remaining]);if(1>percent&&length)return remaining;deferred.resolveWith(elem,[animation]);return!1},animation=deferred.promise({elem:elem,props:jQuery.extend({},properties),opts:jQuery.extend(!0,{specialEasing:{}},options),originalProperties:properties,originalOptions:options,startTime:fxNow||createFxNow(),duration:options.duration,tweens:[],createTween:function(prop,end){var tween=jQuery.Tween(elem,animation.opts,prop,end,animation.opts.specialEasing[prop]||animation.opts.easing);animation.tweens.push(tween);return tween},stop:function(gotoEnd){var index=0,length=gotoEnd?animation.tweens.length:0;if(stopped)return this;stopped=!0;for(;length>index;index++)animation.tweens[index].run(1);gotoEnd?deferred.resolveWith(elem,[animation,gotoEnd]):deferred.rejectWith(elem,[animation,gotoEnd]);return this}}),props=animation.props;propFilter(props,animation.opts.specialEasing);for(;length>index;index++){result=animationPrefilters[index].call(animation,elem,props,animation.opts);if(result)return result}jQuery.map(props,createTween,animation);jQuery.isFunction(animation.opts.start)&&animation.opts.start.call(elem,animation);jQuery.fx.timer(jQuery.extend(tick,{elem:elem,anim:animation,queue:animation.opts.queue}));return animation.progress(animation.opts.progress).done(animation.opts.done,animation.opts.complete).fail(animation.opts.fail).always(animation.opts.always)}function propFilter(props,specialEasing){var index,name,easing,value,hooks;for(index in props){name=jQuery.camelCase(index);easing=specialEasing[name];value=props[index];if(jQuery.isArray(value)){easing=value[1];value=props[index]=value[0]}if(index!==name){props[name]=value;delete props[index]}hooks=jQuery.cssHooks[name];if(hooks&&"expand"in hooks){value=hooks.expand(value);delete props[name];for(index in value)if(!(index in props)){props[index]=value[index];specialEasing[index]=easing}}else specialEasing[name]=easing}}function defaultPrefilter(elem,props,opts){var prop,value,toggle,tween,hooks,oldfire,anim=this,orig={},style=elem.style,hidden=elem.nodeType&&isHidden(elem),dataShow=jQuery._data(elem,"fxshow");if(!opts.queue){hooks=jQuery._queueHooks(elem,"fx");if(null==hooks.unqueued){hooks.unqueued=0;oldfire=hooks.empty.fire;hooks.empty.fire=function(){hooks.unqueued||oldfire()}}hooks.unqueued++;anim.always(function(){anim.always(function(){hooks.unqueued--;jQuery.queue(elem,"fx").length||hooks.empty.fire()})})}if(1===elem.nodeType&&("height"in props||"width"in props)){opts.overflow=[style.overflow,style.overflowX,style.overflowY];"inline"===jQuery.css(elem,"display")&&"none"===jQuery.css(elem,"float")&&(jQuery.support.inlineBlockNeedsLayout&&"inline"!==css_defaultDisplay(elem.nodeName)?style.zoom=1:style.display="inline-block")}if(opts.overflow){style.overflow="hidden";jQuery.support.shrinkWrapBlocks||anim.always(function(){style.overflow=opts.overflow[0];style.overflowX=opts.overflow[1];style.overflowY=opts.overflow[2]})}for(prop in props){value=props[prop];if(rfxtypes.exec(value)){delete props[prop];toggle=toggle||"toggle"===value;if(value===(hidden?"hide":"show"))continue;orig[prop]=dataShow&&dataShow[prop]||jQuery.style(elem,prop)}}if(!jQuery.isEmptyObject(orig)){dataShow?"hidden"in dataShow&&(hidden=dataShow.hidden):dataShow=jQuery._data(elem,"fxshow",{});toggle&&(dataShow.hidden=!hidden);hidden?jQuery(elem).show():anim.done(function(){jQuery(elem).hide()});anim.done(function(){var prop;jQuery._removeData(elem,"fxshow");for(prop in orig)jQuery.style(elem,prop,orig[prop])});for(prop in orig){tween=createTween(hidden?dataShow[prop]:0,prop,anim);if(!(prop in dataShow)){dataShow[prop]=tween.start;if(hidden){tween.end=tween.start;tween.start="width"===prop||"height"===prop?1:0}}}}}function Tween(elem,options,prop,end,easing){return new Tween.prototype.init(elem,options,prop,end,easing)}function genFx(type,includeWidth){var which,attrs={height:type},i=0;includeWidth=includeWidth?1:0;for(;4>i;i+=2-includeWidth){which=cssExpand[i];attrs["margin"+which]=attrs["padding"+which]=type}includeWidth&&(attrs.opacity=attrs.width=type);return attrs}function getWindow(elem){return jQuery.isWindow(elem)?elem:9===elem.nodeType?elem.defaultView||elem.parentWindow:!1}var readyList,rootjQuery,core_strundefined=typeof undefined,location=window.location,document=window.document,docElem=document.documentElement,_jQuery=window.jQuery,_$=window.$,class2type={},core_deletedIds=[],core_version="1.10.2",core_concat=core_deletedIds.concat,core_push=core_deletedIds.push,core_slice=core_deletedIds.slice,core_indexOf=core_deletedIds.indexOf,core_toString=class2type.toString,core_hasOwn=class2type.hasOwnProperty,core_trim=core_version.trim,jQuery=function(selector,context){return new jQuery.fn.init(selector,context,rootjQuery)},core_pnum=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,core_rnotwhite=/\S+/g,rtrim=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,rquickExpr=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,rsingleTag=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,rvalidchars=/^[\],:{}\s]*$/,rvalidbraces=/(?:^|:|,)(?:\s*\[)+/g,rvalidescape=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,rvalidtokens=/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g,rmsPrefix=/^-ms-/,rdashAlpha=/-([\da-z])/gi,fcamelCase=function(all,letter){return letter.toUpperCase()},completed=function(event){if(document.addEventListener||"load"===event.type||"complete"===document.readyState){detach();jQuery.ready()}},detach=function(){if(document.addEventListener){document.removeEventListener("DOMContentLoaded",completed,!1);window.removeEventListener("load",completed,!1)}else{document.detachEvent("onreadystatechange",completed);window.detachEvent("onload",completed)}};jQuery.fn=jQuery.prototype={jquery:core_version,constructor:jQuery,init:function(selector,context,rootjQuery){var match,elem;if(!selector)return this;if("string"==typeof selector){match="<"===selector.charAt(0)&&">"===selector.charAt(selector.length-1)&&selector.length>=3?[null,selector,null]:rquickExpr.exec(selector);if(!match||!match[1]&&context)return!context||context.jquery?(context||rootjQuery).find(selector):this.constructor(context).find(selector);if(match[1]){context=context instanceof jQuery?context[0]:context;jQuery.merge(this,jQuery.parseHTML(match[1],context&&context.nodeType?context.ownerDocument||context:document,!0));if(rsingleTag.test(match[1])&&jQuery.isPlainObject(context))for(match in context)jQuery.isFunction(this[match])?this[match](context[match]):this.attr(match,context[match]);return this}elem=document.getElementById(match[2]);if(elem&&elem.parentNode){if(elem.id!==match[2])return rootjQuery.find(selector);this.length=1;this[0]=elem}this.context=document;this.selector=selector;return this}if(selector.nodeType){this.context=this[0]=selector;this.length=1;return this}if(jQuery.isFunction(selector))return rootjQuery.ready(selector);if(selector.selector!==undefined){this.selector=selector.selector;this.context=selector.context}return jQuery.makeArray(selector,this)},selector:"",length:0,toArray:function(){return core_slice.call(this)},get:function(num){return null==num?this.toArray():0>num?this[this.length+num]:this[num]},pushStack:function(elems){var ret=jQuery.merge(this.constructor(),elems);ret.prevObject=this;ret.context=this.context;return ret},each:function(callback,args){return jQuery.each(this,callback,args)},ready:function(fn){jQuery.ready.promise().done(fn);return this},slice:function(){return this.pushStack(core_slice.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(i){var len=this.length,j=+i+(0>i?len:0);return this.pushStack(j>=0&&len>j?[this[j]]:[])},map:function(callback){return this.pushStack(jQuery.map(this,function(elem,i){return callback.call(elem,i,elem)}))},end:function(){return this.prevObject||this.constructor(null)},push:core_push,sort:[].sort,splice:[].splice};jQuery.fn.init.prototype=jQuery.fn;jQuery.extend=jQuery.fn.extend=function(){var src,copyIsArray,copy,name,options,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=!1;if("boolean"==typeof target){deep=target;target=arguments[1]||{};i=2}"object"==typeof target||jQuery.isFunction(target)||(target={});if(length===i){target=this;--i}for(;length>i;i++)if(null!=(options=arguments[i]))for(name in options){src=target[name];copy=options[name];if(target!==copy)if(deep&&copy&&(jQuery.isPlainObject(copy)||(copyIsArray=jQuery.isArray(copy)))){if(copyIsArray){copyIsArray=!1;clone=src&&jQuery.isArray(src)?src:[]}else clone=src&&jQuery.isPlainObject(src)?src:{};target[name]=jQuery.extend(deep,clone,copy)}else copy!==undefined&&(target[name]=copy)}return target};jQuery.extend({expando:"jQuery"+(core_version+Math.random()).replace(/\D/g,""),noConflict:function(deep){window.$===jQuery&&(window.$=_$);deep&&window.jQuery===jQuery&&(window.jQuery=_jQuery);return jQuery},isReady:!1,readyWait:1,holdReady:function(hold){hold?jQuery.readyWait++:jQuery.ready(!0)},ready:function(wait){if(wait===!0?!--jQuery.readyWait:!jQuery.isReady){if(!document.body)return setTimeout(jQuery.ready);
jQuery.isReady=!0;if(!(wait!==!0&&--jQuery.readyWait>0)){readyList.resolveWith(document,[jQuery]);jQuery.fn.trigger&&jQuery(document).trigger("ready").off("ready")}}},isFunction:function(obj){return"function"===jQuery.type(obj)},isArray:Array.isArray||function(obj){return"array"===jQuery.type(obj)},isWindow:function(obj){return null!=obj&&obj==obj.window},isNumeric:function(obj){return!isNaN(parseFloat(obj))&&isFinite(obj)},type:function(obj){return null==obj?String(obj):"object"==typeof obj||"function"==typeof obj?class2type[core_toString.call(obj)]||"object":typeof obj},isPlainObject:function(obj){var key;if(!obj||"object"!==jQuery.type(obj)||obj.nodeType||jQuery.isWindow(obj))return!1;try{if(obj.constructor&&!core_hasOwn.call(obj,"constructor")&&!core_hasOwn.call(obj.constructor.prototype,"isPrototypeOf"))return!1}catch(e){return!1}if(jQuery.support.ownLast)for(key in obj)return core_hasOwn.call(obj,key);for(key in obj);return key===undefined||core_hasOwn.call(obj,key)},isEmptyObject:function(obj){var name;for(name in obj)return!1;return!0},error:function(msg){throw new Error(msg)},parseHTML:function(data,context,keepScripts){if(!data||"string"!=typeof data)return null;if("boolean"==typeof context){keepScripts=context;context=!1}context=context||document;var parsed=rsingleTag.exec(data),scripts=!keepScripts&&[];if(parsed)return[context.createElement(parsed[1])];parsed=jQuery.buildFragment([data],context,scripts);scripts&&jQuery(scripts).remove();return jQuery.merge([],parsed.childNodes)},parseJSON:function(data){if(window.JSON&&window.JSON.parse)return window.JSON.parse(data);if(null===data)return data;if("string"==typeof data){data=jQuery.trim(data);if(data&&rvalidchars.test(data.replace(rvalidescape,"@").replace(rvalidtokens,"]").replace(rvalidbraces,"")))return new Function("return "+data)()}jQuery.error("Invalid JSON: "+data)},parseXML:function(data){var xml,tmp;if(!data||"string"!=typeof data)return null;try{if(window.DOMParser){tmp=new DOMParser;xml=tmp.parseFromString(data,"text/xml")}else{xml=new ActiveXObject("Microsoft.XMLDOM");xml.async="false";xml.loadXML(data)}}catch(e){xml=undefined}xml&&xml.documentElement&&!xml.getElementsByTagName("parsererror").length||jQuery.error("Invalid XML: "+data);return xml},noop:function(){},globalEval:function(data){data&&jQuery.trim(data)&&(window.execScript||function(data){window["eval"].call(window,data)})(data)},camelCase:function(string){return string.replace(rmsPrefix,"ms-").replace(rdashAlpha,fcamelCase)},nodeName:function(elem,name){return elem.nodeName&&elem.nodeName.toLowerCase()===name.toLowerCase()},each:function(obj,callback,args){var value,i=0,length=obj.length,isArray=isArraylike(obj);if(args)if(isArray)for(;length>i;i++){value=callback.apply(obj[i],args);if(value===!1)break}else for(i in obj){value=callback.apply(obj[i],args);if(value===!1)break}else if(isArray)for(;length>i;i++){value=callback.call(obj[i],i,obj[i]);if(value===!1)break}else for(i in obj){value=callback.call(obj[i],i,obj[i]);if(value===!1)break}return obj},trim:core_trim&&!core_trim.call("﻿ ")?function(text){return null==text?"":core_trim.call(text)}:function(text){return null==text?"":(text+"").replace(rtrim,"")},makeArray:function(arr,results){var ret=results||[];null!=arr&&(isArraylike(Object(arr))?jQuery.merge(ret,"string"==typeof arr?[arr]:arr):core_push.call(ret,arr));return ret},inArray:function(elem,arr,i){var len;if(arr){if(core_indexOf)return core_indexOf.call(arr,elem,i);len=arr.length;i=i?0>i?Math.max(0,len+i):i:0;for(;len>i;i++)if(i in arr&&arr[i]===elem)return i}return-1},merge:function(first,second){var l=second.length,i=first.length,j=0;if("number"==typeof l)for(;l>j;j++)first[i++]=second[j];else for(;second[j]!==undefined;)first[i++]=second[j++];first.length=i;return first},grep:function(elems,callback,inv){var retVal,ret=[],i=0,length=elems.length;inv=!!inv;for(;length>i;i++){retVal=!!callback(elems[i],i);inv!==retVal&&ret.push(elems[i])}return ret},map:function(elems,callback,arg){var value,i=0,length=elems.length,isArray=isArraylike(elems),ret=[];if(isArray)for(;length>i;i++){value=callback(elems[i],i,arg);null!=value&&(ret[ret.length]=value)}else for(i in elems){value=callback(elems[i],i,arg);null!=value&&(ret[ret.length]=value)}return core_concat.apply([],ret)},guid:1,proxy:function(fn,context){var args,proxy,tmp;if("string"==typeof context){tmp=fn[context];context=fn;fn=tmp}if(!jQuery.isFunction(fn))return undefined;args=core_slice.call(arguments,2);proxy=function(){return fn.apply(context||this,args.concat(core_slice.call(arguments)))};proxy.guid=fn.guid=fn.guid||jQuery.guid++;return proxy},access:function(elems,fn,key,value,chainable,emptyGet,raw){var i=0,length=elems.length,bulk=null==key;if("object"===jQuery.type(key)){chainable=!0;for(i in key)jQuery.access(elems,fn,i,key[i],!0,emptyGet,raw)}else if(value!==undefined){chainable=!0;jQuery.isFunction(value)||(raw=!0);if(bulk)if(raw){fn.call(elems,value);fn=null}else{bulk=fn;fn=function(elem,key,value){return bulk.call(jQuery(elem),value)}}if(fn)for(;length>i;i++)fn(elems[i],key,raw?value:value.call(elems[i],i,fn(elems[i],key)))}return chainable?elems:bulk?fn.call(elems):length?fn(elems[0],key):emptyGet},now:function(){return(new Date).getTime()},swap:function(elem,options,callback,args){var ret,name,old={};for(name in options){old[name]=elem.style[name];elem.style[name]=options[name]}ret=callback.apply(elem,args||[]);for(name in options)elem.style[name]=old[name];return ret}});jQuery.ready.promise=function(obj){if(!readyList){readyList=jQuery.Deferred();if("complete"===document.readyState)setTimeout(jQuery.ready);else if(document.addEventListener){document.addEventListener("DOMContentLoaded",completed,!1);window.addEventListener("load",completed,!1)}else{document.attachEvent("onreadystatechange",completed);window.attachEvent("onload",completed);var top=!1;try{top=null==window.frameElement&&document.documentElement}catch(e){}top&&top.doScroll&&!function doScrollCheck(){if(!jQuery.isReady){try{top.doScroll("left")}catch(e){return setTimeout(doScrollCheck,50)}detach();jQuery.ready()}}()}}return readyList.promise(obj)};jQuery.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(i,name){class2type["[object "+name+"]"]=name.toLowerCase()});rootjQuery=jQuery(document);!function(window,undefined){function Sizzle(selector,context,results,seed){var match,elem,m,nodeType,i,groups,old,nid,newContext,newSelector;(context?context.ownerDocument||context:preferredDoc)!==document&&setDocument(context);context=context||document;results=results||[];if(!selector||"string"!=typeof selector)return results;if(1!==(nodeType=context.nodeType)&&9!==nodeType)return[];if(documentIsHTML&&!seed){if(match=rquickExpr.exec(selector))if(m=match[1]){if(9===nodeType){elem=context.getElementById(m);if(!elem||!elem.parentNode)return results;if(elem.id===m){results.push(elem);return results}}else if(context.ownerDocument&&(elem=context.ownerDocument.getElementById(m))&&contains(context,elem)&&elem.id===m){results.push(elem);return results}}else{if(match[2]){push.apply(results,context.getElementsByTagName(selector));return results}if((m=match[3])&&support.getElementsByClassName&&context.getElementsByClassName){push.apply(results,context.getElementsByClassName(m));return results}}if(support.qsa&&(!rbuggyQSA||!rbuggyQSA.test(selector))){nid=old=expando;newContext=context;newSelector=9===nodeType&&selector;if(1===nodeType&&"object"!==context.nodeName.toLowerCase()){groups=tokenize(selector);(old=context.getAttribute("id"))?nid=old.replace(rescape,"\\$&"):context.setAttribute("id",nid);nid="[id='"+nid+"'] ";i=groups.length;for(;i--;)groups[i]=nid+toSelector(groups[i]);newContext=rsibling.test(selector)&&context.parentNode||context;newSelector=groups.join(",")}if(newSelector)try{push.apply(results,newContext.querySelectorAll(newSelector));return results}catch(qsaError){}finally{old||context.removeAttribute("id")}}}return select(selector.replace(rtrim,"$1"),context,results,seed)}function createCache(){function cache(key,value){keys.push(key+=" ")>Expr.cacheLength&&delete cache[keys.shift()];return cache[key]=value}var keys=[];return cache}function markFunction(fn){fn[expando]=!0;return fn}function assert(fn){var div=document.createElement("div");try{return!!fn(div)}catch(e){return!1}finally{div.parentNode&&div.parentNode.removeChild(div);div=null}}function addHandle(attrs,handler){for(var arr=attrs.split("|"),i=attrs.length;i--;)Expr.attrHandle[arr[i]]=handler}function siblingCheck(a,b){var cur=b&&a,diff=cur&&1===a.nodeType&&1===b.nodeType&&(~b.sourceIndex||MAX_NEGATIVE)-(~a.sourceIndex||MAX_NEGATIVE);if(diff)return diff;if(cur)for(;cur=cur.nextSibling;)if(cur===b)return-1;return a?1:-1}function createInputPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return"input"===name&&elem.type===type}}function createButtonPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return("input"===name||"button"===name)&&elem.type===type}}function createPositionalPseudo(fn){return markFunction(function(argument){argument=+argument;return markFunction(function(seed,matches){for(var j,matchIndexes=fn([],seed.length,argument),i=matchIndexes.length;i--;)seed[j=matchIndexes[i]]&&(seed[j]=!(matches[j]=seed[j]))})})}function setFilters(){}function tokenize(selector,parseOnly){var matched,match,tokens,type,soFar,groups,preFilters,cached=tokenCache[selector+" "];if(cached)return parseOnly?0:cached.slice(0);soFar=selector;groups=[];preFilters=Expr.preFilter;for(;soFar;){if(!matched||(match=rcomma.exec(soFar))){match&&(soFar=soFar.slice(match[0].length)||soFar);groups.push(tokens=[])}matched=!1;if(match=rcombinators.exec(soFar)){matched=match.shift();tokens.push({value:matched,type:match[0].replace(rtrim," ")});soFar=soFar.slice(matched.length)}for(type in Expr.filter)if((match=matchExpr[type].exec(soFar))&&(!preFilters[type]||(match=preFilters[type](match)))){matched=match.shift();tokens.push({value:matched,type:type,matches:match});soFar=soFar.slice(matched.length)}if(!matched)break}return parseOnly?soFar.length:soFar?Sizzle.error(selector):tokenCache(selector,groups).slice(0)}function toSelector(tokens){for(var i=0,len=tokens.length,selector="";len>i;i++)selector+=tokens[i].value;return selector}function addCombinator(matcher,combinator,base){var dir=combinator.dir,checkNonElements=base&&"parentNode"===dir,doneName=done++;return combinator.first?function(elem,context,xml){for(;elem=elem[dir];)if(1===elem.nodeType||checkNonElements)return matcher(elem,context,xml)}:function(elem,context,xml){var data,cache,outerCache,dirkey=dirruns+" "+doneName;if(xml){for(;elem=elem[dir];)if((1===elem.nodeType||checkNonElements)&&matcher(elem,context,xml))return!0}else for(;elem=elem[dir];)if(1===elem.nodeType||checkNonElements){outerCache=elem[expando]||(elem[expando]={});if((cache=outerCache[dir])&&cache[0]===dirkey){if((data=cache[1])===!0||data===cachedruns)return data===!0}else{cache=outerCache[dir]=[dirkey];cache[1]=matcher(elem,context,xml)||cachedruns;if(cache[1]===!0)return!0}}}}function elementMatcher(matchers){return matchers.length>1?function(elem,context,xml){for(var i=matchers.length;i--;)if(!matchers[i](elem,context,xml))return!1;return!0}:matchers[0]}function condense(unmatched,map,filter,context,xml){for(var elem,newUnmatched=[],i=0,len=unmatched.length,mapped=null!=map;len>i;i++)if((elem=unmatched[i])&&(!filter||filter(elem,context,xml))){newUnmatched.push(elem);mapped&&map.push(i)}return newUnmatched}function setMatcher(preFilter,selector,matcher,postFilter,postFinder,postSelector){postFilter&&!postFilter[expando]&&(postFilter=setMatcher(postFilter));postFinder&&!postFinder[expando]&&(postFinder=setMatcher(postFinder,postSelector));return markFunction(function(seed,results,context,xml){var temp,i,elem,preMap=[],postMap=[],preexisting=results.length,elems=seed||multipleContexts(selector||"*",context.nodeType?[context]:context,[]),matcherIn=!preFilter||!seed&&selector?elems:condense(elems,preMap,preFilter,context,xml),matcherOut=matcher?postFinder||(seed?preFilter:preexisting||postFilter)?[]:results:matcherIn;matcher&&matcher(matcherIn,matcherOut,context,xml);if(postFilter){temp=condense(matcherOut,postMap);postFilter(temp,[],context,xml);i=temp.length;for(;i--;)(elem=temp[i])&&(matcherOut[postMap[i]]=!(matcherIn[postMap[i]]=elem))}if(seed){if(postFinder||preFilter){if(postFinder){temp=[];i=matcherOut.length;for(;i--;)(elem=matcherOut[i])&&temp.push(matcherIn[i]=elem);postFinder(null,matcherOut=[],temp,xml)}i=matcherOut.length;for(;i--;)(elem=matcherOut[i])&&(temp=postFinder?indexOf.call(seed,elem):preMap[i])>-1&&(seed[temp]=!(results[temp]=elem))}}else{matcherOut=condense(matcherOut===results?matcherOut.splice(preexisting,matcherOut.length):matcherOut);postFinder?postFinder(null,results,matcherOut,xml):push.apply(results,matcherOut)}})}function matcherFromTokens(tokens){for(var checkContext,matcher,j,len=tokens.length,leadingRelative=Expr.relative[tokens[0].type],implicitRelative=leadingRelative||Expr.relative[" "],i=leadingRelative?1:0,matchContext=addCombinator(function(elem){return elem===checkContext},implicitRelative,!0),matchAnyContext=addCombinator(function(elem){return indexOf.call(checkContext,elem)>-1},implicitRelative,!0),matchers=[function(elem,context,xml){return!leadingRelative&&(xml||context!==outermostContext)||((checkContext=context).nodeType?matchContext(elem,context,xml):matchAnyContext(elem,context,xml))}];len>i;i++)if(matcher=Expr.relative[tokens[i].type])matchers=[addCombinator(elementMatcher(matchers),matcher)];else{matcher=Expr.filter[tokens[i].type].apply(null,tokens[i].matches);if(matcher[expando]){j=++i;for(;len>j&&!Expr.relative[tokens[j].type];j++);return setMatcher(i>1&&elementMatcher(matchers),i>1&&toSelector(tokens.slice(0,i-1).concat({value:" "===tokens[i-2].type?"*":""})).replace(rtrim,"$1"),matcher,j>i&&matcherFromTokens(tokens.slice(i,j)),len>j&&matcherFromTokens(tokens=tokens.slice(j)),len>j&&toSelector(tokens))}matchers.push(matcher)}return elementMatcher(matchers)}function matcherFromGroupMatchers(elementMatchers,setMatchers){var matcherCachedRuns=0,bySet=setMatchers.length>0,byElement=elementMatchers.length>0,superMatcher=function(seed,context,xml,results,expandContext){var elem,j,matcher,setMatched=[],matchedCount=0,i="0",unmatched=seed&&[],outermost=null!=expandContext,contextBackup=outermostContext,elems=seed||byElement&&Expr.find["TAG"]("*",expandContext&&context.parentNode||context),dirrunsUnique=dirruns+=null==contextBackup?1:Math.random()||.1;if(outermost){outermostContext=context!==document&&context;cachedruns=matcherCachedRuns}for(;null!=(elem=elems[i]);i++){if(byElement&&elem){j=0;for(;matcher=elementMatchers[j++];)if(matcher(elem,context,xml)){results.push(elem);break}if(outermost){dirruns=dirrunsUnique;cachedruns=++matcherCachedRuns}}if(bySet){(elem=!matcher&&elem)&&matchedCount--;seed&&unmatched.push(elem)}}matchedCount+=i;if(bySet&&i!==matchedCount){j=0;for(;matcher=setMatchers[j++];)matcher(unmatched,setMatched,context,xml);if(seed){if(matchedCount>0)for(;i--;)unmatched[i]||setMatched[i]||(setMatched[i]=pop.call(results));setMatched=condense(setMatched)}push.apply(results,setMatched);outermost&&!seed&&setMatched.length>0&&matchedCount+setMatchers.length>1&&Sizzle.uniqueSort(results)}if(outermost){dirruns=dirrunsUnique;outermostContext=contextBackup}return unmatched};return bySet?markFunction(superMatcher):superMatcher}function multipleContexts(selector,contexts,results){for(var i=0,len=contexts.length;len>i;i++)Sizzle(selector,contexts[i],results);return results}function select(selector,context,results,seed){var i,tokens,token,type,find,match=tokenize(selector);if(!seed&&1===match.length){tokens=match[0]=match[0].slice(0);if(tokens.length>2&&"ID"===(token=tokens[0]).type&&support.getById&&9===context.nodeType&&documentIsHTML&&Expr.relative[tokens[1].type]){context=(Expr.find["ID"](token.matches[0].replace(runescape,funescape),context)||[])[0];if(!context)return results;selector=selector.slice(tokens.shift().value.length)}i=matchExpr["needsContext"].test(selector)?0:tokens.length;for(;i--;){token=tokens[i];if(Expr.relative[type=token.type])break;if((find=Expr.find[type])&&(seed=find(token.matches[0].replace(runescape,funescape),rsibling.test(tokens[0].type)&&context.parentNode||context))){tokens.splice(i,1);selector=seed.length&&toSelector(tokens);if(!selector){push.apply(results,seed);return results}break}}}compile(selector,match)(seed,context,!documentIsHTML,results,rsibling.test(selector));return results}var i,support,cachedruns,Expr,getText,isXML,compile,outermostContext,sortInput,setDocument,document,docElem,documentIsHTML,rbuggyQSA,rbuggyMatches,matches,contains,expando="sizzle"+-new Date,preferredDoc=window.document,dirruns=0,done=0,classCache=createCache(),tokenCache=createCache(),compilerCache=createCache(),hasDuplicate=!1,sortOrder=function(a,b){if(a===b){hasDuplicate=!0;return 0}return 0},strundefined=typeof undefined,MAX_NEGATIVE=1<<31,hasOwn={}.hasOwnProperty,arr=[],pop=arr.pop,push_native=arr.push,push=arr.push,slice=arr.slice,indexOf=arr.indexOf||function(elem){for(var i=0,len=this.length;len>i;i++)if(this[i]===elem)return i;return-1},booleans="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",whitespace="[\\x20\\t\\r\\n\\f]",characterEncoding="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",identifier=characterEncoding.replace("w","w#"),attributes="\\["+whitespace+"*("+characterEncoding+")"+whitespace+"*(?:([*^$|!~]?=)"+whitespace+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+identifier+")|)|)"+whitespace+"*\\]",pseudos=":("+characterEncoding+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+attributes.replace(3,8)+")*)|.*)\\)|)",rtrim=new RegExp("^"+whitespace+"+|((?:^|[^\\\\])(?:\\\\.)*)"+whitespace+"+$","g"),rcomma=new RegExp("^"+whitespace+"*,"+whitespace+"*"),rcombinators=new RegExp("^"+whitespace+"*([>+~]|"+whitespace+")"+whitespace+"*"),rsibling=new RegExp(whitespace+"*[+~]"),rattributeQuotes=new RegExp("="+whitespace+"*([^\\]'\"]*)"+whitespace+"*\\]","g"),rpseudo=new RegExp(pseudos),ridentifier=new RegExp("^"+identifier+"$"),matchExpr={ID:new RegExp("^#("+characterEncoding+")"),CLASS:new RegExp("^\\.("+characterEncoding+")"),TAG:new RegExp("^("+characterEncoding.replace("w","w*")+")"),ATTR:new RegExp("^"+attributes),PSEUDO:new RegExp("^"+pseudos),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+whitespace+"*(even|odd|(([+-]|)(\\d*)n|)"+whitespace+"*(?:([+-]|)"+whitespace+"*(\\d+)|))"+whitespace+"*\\)|)","i"),bool:new RegExp("^(?:"+booleans+")$","i"),needsContext:new RegExp("^"+whitespace+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+whitespace+"*((?:-\\d)?\\d*)"+whitespace+"*\\)|)(?=[^-]|$)","i")},rnative=/^[^{]+\{\s*\[native \w/,rquickExpr=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,rinputs=/^(?:input|select|textarea|button)$/i,rheader=/^h\d$/i,rescape=/'|\\/g,runescape=new RegExp("\\\\([\\da-f]{1,6}"+whitespace+"?|("+whitespace+")|.)","ig"),funescape=function(_,escaped,escapedWhitespace){var high="0x"+escaped-65536;return high!==high||escapedWhitespace?escaped:0>high?String.fromCharCode(high+65536):String.fromCharCode(high>>10|55296,1023&high|56320)};try{push.apply(arr=slice.call(preferredDoc.childNodes),preferredDoc.childNodes);arr[preferredDoc.childNodes.length].nodeType}catch(e){push={apply:arr.length?function(target,els){push_native.apply(target,slice.call(els))}:function(target,els){for(var j=target.length,i=0;target[j++]=els[i++];);target.length=j-1}}}isXML=Sizzle.isXML=function(elem){var documentElement=elem&&(elem.ownerDocument||elem).documentElement;return documentElement?"HTML"!==documentElement.nodeName:!1};support=Sizzle.support={};setDocument=Sizzle.setDocument=function(node){var doc=node?node.ownerDocument||node:preferredDoc,parent=doc.defaultView;if(doc===document||9!==doc.nodeType||!doc.documentElement)return document;document=doc;docElem=doc.documentElement;documentIsHTML=!isXML(doc);parent&&parent.attachEvent&&parent!==parent.top&&parent.attachEvent("onbeforeunload",function(){setDocument()});support.attributes=assert(function(div){div.className="i";return!div.getAttribute("className")});support.getElementsByTagName=assert(function(div){div.appendChild(doc.createComment(""));return!div.getElementsByTagName("*").length});support.getElementsByClassName=assert(function(div){div.innerHTML="<div class='a'></div><div class='a i'></div>";div.firstChild.className="i";return 2===div.getElementsByClassName("i").length});support.getById=assert(function(div){docElem.appendChild(div).id=expando;return!doc.getElementsByName||!doc.getElementsByName(expando).length});if(support.getById){Expr.find["ID"]=function(id,context){if(typeof context.getElementById!==strundefined&&documentIsHTML){var m=context.getElementById(id);return m&&m.parentNode?[m]:[]}};Expr.filter["ID"]=function(id){var attrId=id.replace(runescape,funescape);return function(elem){return elem.getAttribute("id")===attrId}}}else{delete Expr.find["ID"];Expr.filter["ID"]=function(id){var attrId=id.replace(runescape,funescape);return function(elem){var node=typeof elem.getAttributeNode!==strundefined&&elem.getAttributeNode("id");return node&&node.value===attrId}}}Expr.find["TAG"]=support.getElementsByTagName?function(tag,context){return typeof context.getElementsByTagName!==strundefined?context.getElementsByTagName(tag):void 0}:function(tag,context){var elem,tmp=[],i=0,results=context.getElementsByTagName(tag);if("*"===tag){for(;elem=results[i++];)1===elem.nodeType&&tmp.push(elem);return tmp}return results};Expr.find["CLASS"]=support.getElementsByClassName&&function(className,context){return typeof context.getElementsByClassName!==strundefined&&documentIsHTML?context.getElementsByClassName(className):void 0};rbuggyMatches=[];rbuggyQSA=[];if(support.qsa=rnative.test(doc.querySelectorAll)){assert(function(div){div.innerHTML="<select><option selected=''></option></select>";div.querySelectorAll("[selected]").length||rbuggyQSA.push("\\["+whitespace+"*(?:value|"+booleans+")");div.querySelectorAll(":checked").length||rbuggyQSA.push(":checked")});assert(function(div){var input=doc.createElement("input");input.setAttribute("type","hidden");div.appendChild(input).setAttribute("t","");div.querySelectorAll("[t^='']").length&&rbuggyQSA.push("[*^$]="+whitespace+"*(?:''|\"\")");div.querySelectorAll(":enabled").length||rbuggyQSA.push(":enabled",":disabled");div.querySelectorAll("*,:x");rbuggyQSA.push(",.*:")})}(support.matchesSelector=rnative.test(matches=docElem.webkitMatchesSelector||docElem.mozMatchesSelector||docElem.oMatchesSelector||docElem.msMatchesSelector))&&assert(function(div){support.disconnectedMatch=matches.call(div,"div");matches.call(div,"[s!='']:x");rbuggyMatches.push("!=",pseudos)});rbuggyQSA=rbuggyQSA.length&&new RegExp(rbuggyQSA.join("|"));rbuggyMatches=rbuggyMatches.length&&new RegExp(rbuggyMatches.join("|"));contains=rnative.test(docElem.contains)||docElem.compareDocumentPosition?function(a,b){var adown=9===a.nodeType?a.documentElement:a,bup=b&&b.parentNode;return a===bup||!(!bup||1!==bup.nodeType||!(adown.contains?adown.contains(bup):a.compareDocumentPosition&&16&a.compareDocumentPosition(bup)))}:function(a,b){if(b)for(;b=b.parentNode;)if(b===a)return!0;return!1};sortOrder=docElem.compareDocumentPosition?function(a,b){if(a===b){hasDuplicate=!0;return 0}var compare=b.compareDocumentPosition&&a.compareDocumentPosition&&a.compareDocumentPosition(b);return compare?1&compare||!support.sortDetached&&b.compareDocumentPosition(a)===compare?a===doc||contains(preferredDoc,a)?-1:b===doc||contains(preferredDoc,b)?1:sortInput?indexOf.call(sortInput,a)-indexOf.call(sortInput,b):0:4&compare?-1:1:a.compareDocumentPosition?-1:1}:function(a,b){var cur,i=0,aup=a.parentNode,bup=b.parentNode,ap=[a],bp=[b];if(a===b){hasDuplicate=!0;return 0}if(!aup||!bup)return a===doc?-1:b===doc?1:aup?-1:bup?1:sortInput?indexOf.call(sortInput,a)-indexOf.call(sortInput,b):0;if(aup===bup)return siblingCheck(a,b);cur=a;for(;cur=cur.parentNode;)ap.unshift(cur);cur=b;for(;cur=cur.parentNode;)bp.unshift(cur);for(;ap[i]===bp[i];)i++;return i?siblingCheck(ap[i],bp[i]):ap[i]===preferredDoc?-1:bp[i]===preferredDoc?1:0};return doc};Sizzle.matches=function(expr,elements){return Sizzle(expr,null,null,elements)};Sizzle.matchesSelector=function(elem,expr){(elem.ownerDocument||elem)!==document&&setDocument(elem);expr=expr.replace(rattributeQuotes,"='$1']");if(!(!support.matchesSelector||!documentIsHTML||rbuggyMatches&&rbuggyMatches.test(expr)||rbuggyQSA&&rbuggyQSA.test(expr)))try{var ret=matches.call(elem,expr);if(ret||support.disconnectedMatch||elem.document&&11!==elem.document.nodeType)return ret}catch(e){}return Sizzle(expr,document,null,[elem]).length>0};Sizzle.contains=function(context,elem){(context.ownerDocument||context)!==document&&setDocument(context);return contains(context,elem)};Sizzle.attr=function(elem,name){(elem.ownerDocument||elem)!==document&&setDocument(elem);var fn=Expr.attrHandle[name.toLowerCase()],val=fn&&hasOwn.call(Expr.attrHandle,name.toLowerCase())?fn(elem,name,!documentIsHTML):undefined;return val===undefined?support.attributes||!documentIsHTML?elem.getAttribute(name):(val=elem.getAttributeNode(name))&&val.specified?val.value:null:val};Sizzle.error=function(msg){throw new Error("Syntax error, unrecognized expression: "+msg)};Sizzle.uniqueSort=function(results){var elem,duplicates=[],j=0,i=0;hasDuplicate=!support.detectDuplicates;sortInput=!support.sortStable&&results.slice(0);results.sort(sortOrder);if(hasDuplicate){for(;elem=results[i++];)elem===results[i]&&(j=duplicates.push(i));for(;j--;)results.splice(duplicates[j],1)}return results};getText=Sizzle.getText=function(elem){var node,ret="",i=0,nodeType=elem.nodeType;if(nodeType){if(1===nodeType||9===nodeType||11===nodeType){if("string"==typeof elem.textContent)return elem.textContent;for(elem=elem.firstChild;elem;elem=elem.nextSibling)ret+=getText(elem)}else if(3===nodeType||4===nodeType)return elem.nodeValue}else for(;node=elem[i];i++)ret+=getText(node);return ret};Expr=Sizzle.selectors={cacheLength:50,createPseudo:markFunction,match:matchExpr,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(match){match[1]=match[1].replace(runescape,funescape);match[3]=(match[4]||match[5]||"").replace(runescape,funescape);"~="===match[2]&&(match[3]=" "+match[3]+" ");return match.slice(0,4)},CHILD:function(match){match[1]=match[1].toLowerCase();if("nth"===match[1].slice(0,3)){match[3]||Sizzle.error(match[0]);match[4]=+(match[4]?match[5]+(match[6]||1):2*("even"===match[3]||"odd"===match[3]));match[5]=+(match[7]+match[8]||"odd"===match[3])}else match[3]&&Sizzle.error(match[0]);return match},PSEUDO:function(match){var excess,unquoted=!match[5]&&match[2];if(matchExpr["CHILD"].test(match[0]))return null;if(match[3]&&match[4]!==undefined)match[2]=match[4];else if(unquoted&&rpseudo.test(unquoted)&&(excess=tokenize(unquoted,!0))&&(excess=unquoted.indexOf(")",unquoted.length-excess)-unquoted.length)){match[0]=match[0].slice(0,excess);match[2]=unquoted.slice(0,excess)}return match.slice(0,3)}},filter:{TAG:function(nodeNameSelector){var nodeName=nodeNameSelector.replace(runescape,funescape).toLowerCase();return"*"===nodeNameSelector?function(){return!0}:function(elem){return elem.nodeName&&elem.nodeName.toLowerCase()===nodeName}},CLASS:function(className){var pattern=classCache[className+" "];return pattern||(pattern=new RegExp("(^|"+whitespace+")"+className+"("+whitespace+"|$)"))&&classCache(className,function(elem){return pattern.test("string"==typeof elem.className&&elem.className||typeof elem.getAttribute!==strundefined&&elem.getAttribute("class")||"")})},ATTR:function(name,operator,check){return function(elem){var result=Sizzle.attr(elem,name);if(null==result)return"!="===operator;if(!operator)return!0;result+="";return"="===operator?result===check:"!="===operator?result!==check:"^="===operator?check&&0===result.indexOf(check):"*="===operator?check&&result.indexOf(check)>-1:"$="===operator?check&&result.slice(-check.length)===check:"~="===operator?(" "+result+" ").indexOf(check)>-1:"|="===operator?result===check||result.slice(0,check.length+1)===check+"-":!1}},CHILD:function(type,what,argument,first,last){var simple="nth"!==type.slice(0,3),forward="last"!==type.slice(-4),ofType="of-type"===what;return 1===first&&0===last?function(elem){return!!elem.parentNode}:function(elem,context,xml){var cache,outerCache,node,diff,nodeIndex,start,dir=simple!==forward?"nextSibling":"previousSibling",parent=elem.parentNode,name=ofType&&elem.nodeName.toLowerCase(),useCache=!xml&&!ofType;if(parent){if(simple){for(;dir;){node=elem;for(;node=node[dir];)if(ofType?node.nodeName.toLowerCase()===name:1===node.nodeType)return!1;start=dir="only"===type&&!start&&"nextSibling"}return!0}start=[forward?parent.firstChild:parent.lastChild];if(forward&&useCache){outerCache=parent[expando]||(parent[expando]={});cache=outerCache[type]||[];nodeIndex=cache[0]===dirruns&&cache[1];diff=cache[0]===dirruns&&cache[2];node=nodeIndex&&parent.childNodes[nodeIndex];for(;node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop();)if(1===node.nodeType&&++diff&&node===elem){outerCache[type]=[dirruns,nodeIndex,diff];break}}else if(useCache&&(cache=(elem[expando]||(elem[expando]={}))[type])&&cache[0]===dirruns)diff=cache[1];else for(;node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop();)if((ofType?node.nodeName.toLowerCase()===name:1===node.nodeType)&&++diff){useCache&&((node[expando]||(node[expando]={}))[type]=[dirruns,diff]);if(node===elem)break}diff-=last;return diff===first||diff%first===0&&diff/first>=0}}},PSEUDO:function(pseudo,argument){var args,fn=Expr.pseudos[pseudo]||Expr.setFilters[pseudo.toLowerCase()]||Sizzle.error("unsupported pseudo: "+pseudo);if(fn[expando])return fn(argument);if(fn.length>1){args=[pseudo,pseudo,"",argument];return Expr.setFilters.hasOwnProperty(pseudo.toLowerCase())?markFunction(function(seed,matches){for(var idx,matched=fn(seed,argument),i=matched.length;i--;){idx=indexOf.call(seed,matched[i]);seed[idx]=!(matches[idx]=matched[i])}}):function(elem){return fn(elem,0,args)}}return fn}},pseudos:{not:markFunction(function(selector){var input=[],results=[],matcher=compile(selector.replace(rtrim,"$1"));return matcher[expando]?markFunction(function(seed,matches,context,xml){for(var elem,unmatched=matcher(seed,null,xml,[]),i=seed.length;i--;)(elem=unmatched[i])&&(seed[i]=!(matches[i]=elem))}):function(elem,context,xml){input[0]=elem;matcher(input,null,xml,results);return!results.pop()}}),has:markFunction(function(selector){return function(elem){return Sizzle(selector,elem).length>0}}),contains:markFunction(function(text){return function(elem){return(elem.textContent||elem.innerText||getText(elem)).indexOf(text)>-1}}),lang:markFunction(function(lang){ridentifier.test(lang||"")||Sizzle.error("unsupported lang: "+lang);lang=lang.replace(runescape,funescape).toLowerCase();return function(elem){var elemLang;do if(elemLang=documentIsHTML?elem.lang:elem.getAttribute("xml:lang")||elem.getAttribute("lang")){elemLang=elemLang.toLowerCase();return elemLang===lang||0===elemLang.indexOf(lang+"-")}while((elem=elem.parentNode)&&1===elem.nodeType);return!1}}),target:function(elem){var hash=window.location&&window.location.hash;return hash&&hash.slice(1)===elem.id},root:function(elem){return elem===docElem},focus:function(elem){return elem===document.activeElement&&(!document.hasFocus||document.hasFocus())&&!!(elem.type||elem.href||~elem.tabIndex)},enabled:function(elem){return elem.disabled===!1},disabled:function(elem){return elem.disabled===!0},checked:function(elem){var nodeName=elem.nodeName.toLowerCase();return"input"===nodeName&&!!elem.checked||"option"===nodeName&&!!elem.selected},selected:function(elem){elem.parentNode&&elem.parentNode.selectedIndex;
return elem.selected===!0},empty:function(elem){for(elem=elem.firstChild;elem;elem=elem.nextSibling)if(elem.nodeName>"@"||3===elem.nodeType||4===elem.nodeType)return!1;return!0},parent:function(elem){return!Expr.pseudos["empty"](elem)},header:function(elem){return rheader.test(elem.nodeName)},input:function(elem){return rinputs.test(elem.nodeName)},button:function(elem){var name=elem.nodeName.toLowerCase();return"input"===name&&"button"===elem.type||"button"===name},text:function(elem){var attr;return"input"===elem.nodeName.toLowerCase()&&"text"===elem.type&&(null==(attr=elem.getAttribute("type"))||attr.toLowerCase()===elem.type)},first:createPositionalPseudo(function(){return[0]}),last:createPositionalPseudo(function(matchIndexes,length){return[length-1]}),eq:createPositionalPseudo(function(matchIndexes,length,argument){return[0>argument?argument+length:argument]}),even:createPositionalPseudo(function(matchIndexes,length){for(var i=0;length>i;i+=2)matchIndexes.push(i);return matchIndexes}),odd:createPositionalPseudo(function(matchIndexes,length){for(var i=1;length>i;i+=2)matchIndexes.push(i);return matchIndexes}),lt:createPositionalPseudo(function(matchIndexes,length,argument){for(var i=0>argument?argument+length:argument;--i>=0;)matchIndexes.push(i);return matchIndexes}),gt:createPositionalPseudo(function(matchIndexes,length,argument){for(var i=0>argument?argument+length:argument;++i<length;)matchIndexes.push(i);return matchIndexes})}};Expr.pseudos["nth"]=Expr.pseudos["eq"];for(i in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})Expr.pseudos[i]=createInputPseudo(i);for(i in{submit:!0,reset:!0})Expr.pseudos[i]=createButtonPseudo(i);setFilters.prototype=Expr.filters=Expr.pseudos;Expr.setFilters=new setFilters;compile=Sizzle.compile=function(selector,group){var i,setMatchers=[],elementMatchers=[],cached=compilerCache[selector+" "];if(!cached){group||(group=tokenize(selector));i=group.length;for(;i--;){cached=matcherFromTokens(group[i]);cached[expando]?setMatchers.push(cached):elementMatchers.push(cached)}cached=compilerCache(selector,matcherFromGroupMatchers(elementMatchers,setMatchers))}return cached};support.sortStable=expando.split("").sort(sortOrder).join("")===expando;support.detectDuplicates=hasDuplicate;setDocument();support.sortDetached=assert(function(div1){return 1&div1.compareDocumentPosition(document.createElement("div"))});assert(function(div){div.innerHTML="<a href='#'></a>";return"#"===div.firstChild.getAttribute("href")})||addHandle("type|href|height|width",function(elem,name,isXML){return isXML?void 0:elem.getAttribute(name,"type"===name.toLowerCase()?1:2)});support.attributes&&assert(function(div){div.innerHTML="<input/>";div.firstChild.setAttribute("value","");return""===div.firstChild.getAttribute("value")})||addHandle("value",function(elem,name,isXML){return isXML||"input"!==elem.nodeName.toLowerCase()?void 0:elem.defaultValue});assert(function(div){return null==div.getAttribute("disabled")})||addHandle(booleans,function(elem,name,isXML){var val;return isXML?void 0:(val=elem.getAttributeNode(name))&&val.specified?val.value:elem[name]===!0?name.toLowerCase():null});jQuery.find=Sizzle;jQuery.expr=Sizzle.selectors;jQuery.expr[":"]=jQuery.expr.pseudos;jQuery.unique=Sizzle.uniqueSort;jQuery.text=Sizzle.getText;jQuery.isXMLDoc=Sizzle.isXML;jQuery.contains=Sizzle.contains}(window);var optionsCache={};jQuery.Callbacks=function(options){options="string"==typeof options?optionsCache[options]||createOptions(options):jQuery.extend({},options);var firing,memory,fired,firingLength,firingIndex,firingStart,list=[],stack=!options.once&&[],fire=function(data){memory=options.memory&&data;fired=!0;firingIndex=firingStart||0;firingStart=0;firingLength=list.length;firing=!0;for(;list&&firingLength>firingIndex;firingIndex++)if(list[firingIndex].apply(data[0],data[1])===!1&&options.stopOnFalse){memory=!1;break}firing=!1;list&&(stack?stack.length&&fire(stack.shift()):memory?list=[]:self.disable())},self={add:function(){if(list){var start=list.length;!function add(args){jQuery.each(args,function(_,arg){var type=jQuery.type(arg);"function"===type?options.unique&&self.has(arg)||list.push(arg):arg&&arg.length&&"string"!==type&&add(arg)})}(arguments);if(firing)firingLength=list.length;else if(memory){firingStart=start;fire(memory)}}return this},remove:function(){list&&jQuery.each(arguments,function(_,arg){for(var index;(index=jQuery.inArray(arg,list,index))>-1;){list.splice(index,1);if(firing){firingLength>=index&&firingLength--;firingIndex>=index&&firingIndex--}}});return this},has:function(fn){return fn?jQuery.inArray(fn,list)>-1:!(!list||!list.length)},empty:function(){list=[];firingLength=0;return this},disable:function(){list=stack=memory=undefined;return this},disabled:function(){return!list},lock:function(){stack=undefined;memory||self.disable();return this},locked:function(){return!stack},fireWith:function(context,args){if(list&&(!fired||stack)){args=args||[];args=[context,args.slice?args.slice():args];firing?stack.push(args):fire(args)}return this},fire:function(){self.fireWith(this,arguments);return this},fired:function(){return!!fired}};return self};jQuery.extend({Deferred:function(func){var tuples=[["resolve","done",jQuery.Callbacks("once memory"),"resolved"],["reject","fail",jQuery.Callbacks("once memory"),"rejected"],["notify","progress",jQuery.Callbacks("memory")]],state="pending",promise={state:function(){return state},always:function(){deferred.done(arguments).fail(arguments);return this},then:function(){var fns=arguments;return jQuery.Deferred(function(newDefer){jQuery.each(tuples,function(i,tuple){var action=tuple[0],fn=jQuery.isFunction(fns[i])&&fns[i];deferred[tuple[1]](function(){var returned=fn&&fn.apply(this,arguments);returned&&jQuery.isFunction(returned.promise)?returned.promise().done(newDefer.resolve).fail(newDefer.reject).progress(newDefer.notify):newDefer[action+"With"](this===promise?newDefer.promise():this,fn?[returned]:arguments)})});fns=null}).promise()},promise:function(obj){return null!=obj?jQuery.extend(obj,promise):promise}},deferred={};promise.pipe=promise.then;jQuery.each(tuples,function(i,tuple){var list=tuple[2],stateString=tuple[3];promise[tuple[1]]=list.add;stateString&&list.add(function(){state=stateString},tuples[1^i][2].disable,tuples[2][2].lock);deferred[tuple[0]]=function(){deferred[tuple[0]+"With"](this===deferred?promise:this,arguments);return this};deferred[tuple[0]+"With"]=list.fireWith});promise.promise(deferred);func&&func.call(deferred,deferred);return deferred},when:function(subordinate){var progressValues,progressContexts,resolveContexts,i=0,resolveValues=core_slice.call(arguments),length=resolveValues.length,remaining=1!==length||subordinate&&jQuery.isFunction(subordinate.promise)?length:0,deferred=1===remaining?subordinate:jQuery.Deferred(),updateFunc=function(i,contexts,values){return function(value){contexts[i]=this;values[i]=arguments.length>1?core_slice.call(arguments):value;values===progressValues?deferred.notifyWith(contexts,values):--remaining||deferred.resolveWith(contexts,values)}};if(length>1){progressValues=new Array(length);progressContexts=new Array(length);resolveContexts=new Array(length);for(;length>i;i++)resolveValues[i]&&jQuery.isFunction(resolveValues[i].promise)?resolveValues[i].promise().done(updateFunc(i,resolveContexts,resolveValues)).fail(deferred.reject).progress(updateFunc(i,progressContexts,progressValues)):--remaining}remaining||deferred.resolveWith(resolveContexts,resolveValues);return deferred.promise()}});jQuery.support=function(support){var all,a,input,select,fragment,opt,eventName,isSupported,i,div=document.createElement("div");div.setAttribute("className","t");div.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>";all=div.getElementsByTagName("*")||[];a=div.getElementsByTagName("a")[0];if(!a||!a.style||!all.length)return support;select=document.createElement("select");opt=select.appendChild(document.createElement("option"));input=div.getElementsByTagName("input")[0];a.style.cssText="top:1px;float:left;opacity:.5";support.getSetAttribute="t"!==div.className;support.leadingWhitespace=3===div.firstChild.nodeType;support.tbody=!div.getElementsByTagName("tbody").length;support.htmlSerialize=!!div.getElementsByTagName("link").length;support.style=/top/.test(a.getAttribute("style"));support.hrefNormalized="/a"===a.getAttribute("href");support.opacity=/^0.5/.test(a.style.opacity);support.cssFloat=!!a.style.cssFloat;support.checkOn=!!input.value;support.optSelected=opt.selected;support.enctype=!!document.createElement("form").enctype;support.html5Clone="<:nav></:nav>"!==document.createElement("nav").cloneNode(!0).outerHTML;support.inlineBlockNeedsLayout=!1;support.shrinkWrapBlocks=!1;support.pixelPosition=!1;support.deleteExpando=!0;support.noCloneEvent=!0;support.reliableMarginRight=!0;support.boxSizingReliable=!0;input.checked=!0;support.noCloneChecked=input.cloneNode(!0).checked;select.disabled=!0;support.optDisabled=!opt.disabled;try{delete div.test}catch(e){support.deleteExpando=!1}input=document.createElement("input");input.setAttribute("value","");support.input=""===input.getAttribute("value");input.value="t";input.setAttribute("type","radio");support.radioValue="t"===input.value;input.setAttribute("checked","t");input.setAttribute("name","t");fragment=document.createDocumentFragment();fragment.appendChild(input);support.appendChecked=input.checked;support.checkClone=fragment.cloneNode(!0).cloneNode(!0).lastChild.checked;if(div.attachEvent){div.attachEvent("onclick",function(){support.noCloneEvent=!1});div.cloneNode(!0).click()}for(i in{submit:!0,change:!0,focusin:!0}){div.setAttribute(eventName="on"+i,"t");support[i+"Bubbles"]=eventName in window||div.attributes[eventName].expando===!1}div.style.backgroundClip="content-box";div.cloneNode(!0).style.backgroundClip="";support.clearCloneStyle="content-box"===div.style.backgroundClip;for(i in jQuery(support))break;support.ownLast="0"!==i;jQuery(function(){var container,marginDiv,tds,divReset="padding:0;margin:0;border:0;display:block;box-sizing:content-box;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;",body=document.getElementsByTagName("body")[0];if(body){container=document.createElement("div");container.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px";body.appendChild(container).appendChild(div);div.innerHTML="<table><tr><td></td><td>t</td></tr></table>";tds=div.getElementsByTagName("td");tds[0].style.cssText="padding:0;margin:0;border:0;display:none";isSupported=0===tds[0].offsetHeight;tds[0].style.display="";tds[1].style.display="none";support.reliableHiddenOffsets=isSupported&&0===tds[0].offsetHeight;div.innerHTML="";div.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;";jQuery.swap(body,null!=body.style.zoom?{zoom:1}:{},function(){support.boxSizing=4===div.offsetWidth});if(window.getComputedStyle){support.pixelPosition="1%"!==(window.getComputedStyle(div,null)||{}).top;support.boxSizingReliable="4px"===(window.getComputedStyle(div,null)||{width:"4px"}).width;marginDiv=div.appendChild(document.createElement("div"));marginDiv.style.cssText=div.style.cssText=divReset;marginDiv.style.marginRight=marginDiv.style.width="0";div.style.width="1px";support.reliableMarginRight=!parseFloat((window.getComputedStyle(marginDiv,null)||{}).marginRight)}if(typeof div.style.zoom!==core_strundefined){div.innerHTML="";div.style.cssText=divReset+"width:1px;padding:1px;display:inline;zoom:1";support.inlineBlockNeedsLayout=3===div.offsetWidth;div.style.display="block";div.innerHTML="<div></div>";div.firstChild.style.width="5px";support.shrinkWrapBlocks=3!==div.offsetWidth;support.inlineBlockNeedsLayout&&(body.style.zoom=1)}body.removeChild(container);container=div=tds=marginDiv=null}});all=select=fragment=opt=a=input=null;return support}({});var rbrace=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,rmultiDash=/([A-Z])/g;jQuery.extend({cache:{},noData:{applet:!0,embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(elem){elem=elem.nodeType?jQuery.cache[elem[jQuery.expando]]:elem[jQuery.expando];return!!elem&&!isEmptyDataObject(elem)},data:function(elem,name,data){return internalData(elem,name,data)},removeData:function(elem,name){return internalRemoveData(elem,name)},_data:function(elem,name,data){return internalData(elem,name,data,!0)},_removeData:function(elem,name){return internalRemoveData(elem,name,!0)},acceptData:function(elem){if(elem.nodeType&&1!==elem.nodeType&&9!==elem.nodeType)return!1;var noData=elem.nodeName&&jQuery.noData[elem.nodeName.toLowerCase()];return!noData||noData!==!0&&elem.getAttribute("classid")===noData}});jQuery.fn.extend({data:function(key,value){var attrs,name,data=null,i=0,elem=this[0];if(key===undefined){if(this.length){data=jQuery.data(elem);if(1===elem.nodeType&&!jQuery._data(elem,"parsedAttrs")){attrs=elem.attributes;for(;i<attrs.length;i++){name=attrs[i].name;if(0===name.indexOf("data-")){name=jQuery.camelCase(name.slice(5));dataAttr(elem,name,data[name])}}jQuery._data(elem,"parsedAttrs",!0)}}return data}return"object"==typeof key?this.each(function(){jQuery.data(this,key)}):arguments.length>1?this.each(function(){jQuery.data(this,key,value)}):elem?dataAttr(elem,key,jQuery.data(elem,key)):null},removeData:function(key){return this.each(function(){jQuery.removeData(this,key)})}});jQuery.extend({queue:function(elem,type,data){var queue;if(elem){type=(type||"fx")+"queue";queue=jQuery._data(elem,type);data&&(!queue||jQuery.isArray(data)?queue=jQuery._data(elem,type,jQuery.makeArray(data)):queue.push(data));return queue||[]}},dequeue:function(elem,type){type=type||"fx";var queue=jQuery.queue(elem,type),startLength=queue.length,fn=queue.shift(),hooks=jQuery._queueHooks(elem,type),next=function(){jQuery.dequeue(elem,type)};if("inprogress"===fn){fn=queue.shift();startLength--}if(fn){"fx"===type&&queue.unshift("inprogress");delete hooks.stop;fn.call(elem,next,hooks)}!startLength&&hooks&&hooks.empty.fire()},_queueHooks:function(elem,type){var key=type+"queueHooks";return jQuery._data(elem,key)||jQuery._data(elem,key,{empty:jQuery.Callbacks("once memory").add(function(){jQuery._removeData(elem,type+"queue");jQuery._removeData(elem,key)})})}});jQuery.fn.extend({queue:function(type,data){var setter=2;if("string"!=typeof type){data=type;type="fx";setter--}return arguments.length<setter?jQuery.queue(this[0],type):data===undefined?this:this.each(function(){var queue=jQuery.queue(this,type,data);jQuery._queueHooks(this,type);"fx"===type&&"inprogress"!==queue[0]&&jQuery.dequeue(this,type)})},dequeue:function(type){return this.each(function(){jQuery.dequeue(this,type)})},delay:function(time,type){time=jQuery.fx?jQuery.fx.speeds[time]||time:time;type=type||"fx";return this.queue(type,function(next,hooks){var timeout=setTimeout(next,time);hooks.stop=function(){clearTimeout(timeout)}})},clearQueue:function(type){return this.queue(type||"fx",[])},promise:function(type,obj){var tmp,count=1,defer=jQuery.Deferred(),elements=this,i=this.length,resolve=function(){--count||defer.resolveWith(elements,[elements])};if("string"!=typeof type){obj=type;type=undefined}type=type||"fx";for(;i--;){tmp=jQuery._data(elements[i],type+"queueHooks");if(tmp&&tmp.empty){count++;tmp.empty.add(resolve)}}resolve();return defer.promise(obj)}});var nodeHook,boolHook,rclass=/[\t\r\n\f]/g,rreturn=/\r/g,rfocusable=/^(?:input|select|textarea|button|object)$/i,rclickable=/^(?:a|area)$/i,ruseDefault=/^(?:checked|selected)$/i,getSetAttribute=jQuery.support.getSetAttribute,getSetInput=jQuery.support.input;jQuery.fn.extend({attr:function(name,value){return jQuery.access(this,jQuery.attr,name,value,arguments.length>1)},removeAttr:function(name){return this.each(function(){jQuery.removeAttr(this,name)})},prop:function(name,value){return jQuery.access(this,jQuery.prop,name,value,arguments.length>1)},removeProp:function(name){name=jQuery.propFix[name]||name;return this.each(function(){try{this[name]=undefined;delete this[name]}catch(e){}})},addClass:function(value){var classes,elem,cur,clazz,j,i=0,len=this.length,proceed="string"==typeof value&&value;if(jQuery.isFunction(value))return this.each(function(j){jQuery(this).addClass(value.call(this,j,this.className))});if(proceed){classes=(value||"").match(core_rnotwhite)||[];for(;len>i;i++){elem=this[i];cur=1===elem.nodeType&&(elem.className?(" "+elem.className+" ").replace(rclass," "):" ");if(cur){j=0;for(;clazz=classes[j++];)cur.indexOf(" "+clazz+" ")<0&&(cur+=clazz+" ");elem.className=jQuery.trim(cur)}}}return this},removeClass:function(value){var classes,elem,cur,clazz,j,i=0,len=this.length,proceed=0===arguments.length||"string"==typeof value&&value;if(jQuery.isFunction(value))return this.each(function(j){jQuery(this).removeClass(value.call(this,j,this.className))});if(proceed){classes=(value||"").match(core_rnotwhite)||[];for(;len>i;i++){elem=this[i];cur=1===elem.nodeType&&(elem.className?(" "+elem.className+" ").replace(rclass," "):"");if(cur){j=0;for(;clazz=classes[j++];)for(;cur.indexOf(" "+clazz+" ")>=0;)cur=cur.replace(" "+clazz+" "," ");elem.className=value?jQuery.trim(cur):""}}}return this},toggleClass:function(value,stateVal){var type=typeof value;return"boolean"==typeof stateVal&&"string"===type?stateVal?this.addClass(value):this.removeClass(value):this.each(jQuery.isFunction(value)?function(i){jQuery(this).toggleClass(value.call(this,i,this.className,stateVal),stateVal)}:function(){if("string"===type)for(var className,i=0,self=jQuery(this),classNames=value.match(core_rnotwhite)||[];className=classNames[i++];)self.hasClass(className)?self.removeClass(className):self.addClass(className);else if(type===core_strundefined||"boolean"===type){this.className&&jQuery._data(this,"__className__",this.className);this.className=this.className||value===!1?"":jQuery._data(this,"__className__")||""}})},hasClass:function(selector){for(var className=" "+selector+" ",i=0,l=this.length;l>i;i++)if(1===this[i].nodeType&&(" "+this[i].className+" ").replace(rclass," ").indexOf(className)>=0)return!0;return!1},val:function(value){var ret,hooks,isFunction,elem=this[0];if(arguments.length){isFunction=jQuery.isFunction(value);return this.each(function(i){var val;if(1===this.nodeType){val=isFunction?value.call(this,i,jQuery(this).val()):value;null==val?val="":"number"==typeof val?val+="":jQuery.isArray(val)&&(val=jQuery.map(val,function(value){return null==value?"":value+""}));hooks=jQuery.valHooks[this.type]||jQuery.valHooks[this.nodeName.toLowerCase()];hooks&&"set"in hooks&&hooks.set(this,val,"value")!==undefined||(this.value=val)}})}if(elem){hooks=jQuery.valHooks[elem.type]||jQuery.valHooks[elem.nodeName.toLowerCase()];if(hooks&&"get"in hooks&&(ret=hooks.get(elem,"value"))!==undefined)return ret;ret=elem.value;return"string"==typeof ret?ret.replace(rreturn,""):null==ret?"":ret}}});jQuery.extend({valHooks:{option:{get:function(elem){var val=jQuery.find.attr(elem,"value");return null!=val?val:elem.text}},select:{get:function(elem){for(var value,option,options=elem.options,index=elem.selectedIndex,one="select-one"===elem.type||0>index,values=one?null:[],max=one?index+1:options.length,i=0>index?max:one?index:0;max>i;i++){option=options[i];if(!(!option.selected&&i!==index||(jQuery.support.optDisabled?option.disabled:null!==option.getAttribute("disabled"))||option.parentNode.disabled&&jQuery.nodeName(option.parentNode,"optgroup"))){value=jQuery(option).val();if(one)return value;values.push(value)}}return values},set:function(elem,value){for(var optionSet,option,options=elem.options,values=jQuery.makeArray(value),i=options.length;i--;){option=options[i];(option.selected=jQuery.inArray(jQuery(option).val(),values)>=0)&&(optionSet=!0)}optionSet||(elem.selectedIndex=-1);return values}}},attr:function(elem,name,value){var hooks,ret,nType=elem.nodeType;if(elem&&3!==nType&&8!==nType&&2!==nType){if(typeof elem.getAttribute===core_strundefined)return jQuery.prop(elem,name,value);if(1!==nType||!jQuery.isXMLDoc(elem)){name=name.toLowerCase();hooks=jQuery.attrHooks[name]||(jQuery.expr.match.bool.test(name)?boolHook:nodeHook)}if(value===undefined){if(hooks&&"get"in hooks&&null!==(ret=hooks.get(elem,name)))return ret;ret=jQuery.find.attr(elem,name);return null==ret?undefined:ret}if(null!==value){if(hooks&&"set"in hooks&&(ret=hooks.set(elem,value,name))!==undefined)return ret;elem.setAttribute(name,value+"");return value}jQuery.removeAttr(elem,name)}},removeAttr:function(elem,value){var name,propName,i=0,attrNames=value&&value.match(core_rnotwhite);if(attrNames&&1===elem.nodeType)for(;name=attrNames[i++];){propName=jQuery.propFix[name]||name;jQuery.expr.match.bool.test(name)?getSetInput&&getSetAttribute||!ruseDefault.test(name)?elem[propName]=!1:elem[jQuery.camelCase("default-"+name)]=elem[propName]=!1:jQuery.attr(elem,name,"");elem.removeAttribute(getSetAttribute?name:propName)}},attrHooks:{type:{set:function(elem,value){if(!jQuery.support.radioValue&&"radio"===value&&jQuery.nodeName(elem,"input")){var val=elem.value;elem.setAttribute("type",value);val&&(elem.value=val);return value}}}},propFix:{"for":"htmlFor","class":"className"},prop:function(elem,name,value){var ret,hooks,notxml,nType=elem.nodeType;if(elem&&3!==nType&&8!==nType&&2!==nType){notxml=1!==nType||!jQuery.isXMLDoc(elem);if(notxml){name=jQuery.propFix[name]||name;hooks=jQuery.propHooks[name]}return value!==undefined?hooks&&"set"in hooks&&(ret=hooks.set(elem,value,name))!==undefined?ret:elem[name]=value:hooks&&"get"in hooks&&null!==(ret=hooks.get(elem,name))?ret:elem[name]}},propHooks:{tabIndex:{get:function(elem){var tabindex=jQuery.find.attr(elem,"tabindex");return tabindex?parseInt(tabindex,10):rfocusable.test(elem.nodeName)||rclickable.test(elem.nodeName)&&elem.href?0:-1}}}});boolHook={set:function(elem,value,name){value===!1?jQuery.removeAttr(elem,name):getSetInput&&getSetAttribute||!ruseDefault.test(name)?elem.setAttribute(!getSetAttribute&&jQuery.propFix[name]||name,name):elem[jQuery.camelCase("default-"+name)]=elem[name]=!0;return name}};jQuery.each(jQuery.expr.match.bool.source.match(/\w+/g),function(i,name){var getter=jQuery.expr.attrHandle[name]||jQuery.find.attr;jQuery.expr.attrHandle[name]=getSetInput&&getSetAttribute||!ruseDefault.test(name)?function(elem,name,isXML){var fn=jQuery.expr.attrHandle[name],ret=isXML?undefined:(jQuery.expr.attrHandle[name]=undefined)!=getter(elem,name,isXML)?name.toLowerCase():null;jQuery.expr.attrHandle[name]=fn;return ret}:function(elem,name,isXML){return isXML?undefined:elem[jQuery.camelCase("default-"+name)]?name.toLowerCase():null}});getSetInput&&getSetAttribute||(jQuery.attrHooks.value={set:function(elem,value,name){if(!jQuery.nodeName(elem,"input"))return nodeHook&&nodeHook.set(elem,value,name);elem.defaultValue=value;return void 0}});if(!getSetAttribute){nodeHook={set:function(elem,value,name){var ret=elem.getAttributeNode(name);ret||elem.setAttributeNode(ret=elem.ownerDocument.createAttribute(name));ret.value=value+="";return"value"===name||value===elem.getAttribute(name)?value:undefined}};jQuery.expr.attrHandle.id=jQuery.expr.attrHandle.name=jQuery.expr.attrHandle.coords=function(elem,name,isXML){var ret;return isXML?undefined:(ret=elem.getAttributeNode(name))&&""!==ret.value?ret.value:null};jQuery.valHooks.button={get:function(elem,name){var ret=elem.getAttributeNode(name);return ret&&ret.specified?ret.value:undefined},set:nodeHook.set};jQuery.attrHooks.contenteditable={set:function(elem,value,name){nodeHook.set(elem,""===value?!1:value,name)}};jQuery.each(["width","height"],function(i,name){jQuery.attrHooks[name]={set:function(elem,value){if(""===value){elem.setAttribute(name,"auto");return value}}}})}jQuery.support.hrefNormalized||jQuery.each(["href","src"],function(i,name){jQuery.propHooks[name]={get:function(elem){return elem.getAttribute(name,4)}}});jQuery.support.style||(jQuery.attrHooks.style={get:function(elem){return elem.style.cssText||undefined},set:function(elem,value){return elem.style.cssText=value+""}});jQuery.support.optSelected||(jQuery.propHooks.selected={get:function(elem){var parent=elem.parentNode;if(parent){parent.selectedIndex;parent.parentNode&&parent.parentNode.selectedIndex}return null}});jQuery.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){jQuery.propFix[this.toLowerCase()]=this});jQuery.support.enctype||(jQuery.propFix.enctype="encoding");jQuery.each(["radio","checkbox"],function(){jQuery.valHooks[this]={set:function(elem,value){return jQuery.isArray(value)?elem.checked=jQuery.inArray(jQuery(elem).val(),value)>=0:void 0}};jQuery.support.checkOn||(jQuery.valHooks[this].get=function(elem){return null===elem.getAttribute("value")?"on":elem.value})});var rformElems=/^(?:input|select|textarea)$/i,rkeyEvent=/^key/,rmouseEvent=/^(?:mouse|contextmenu)|click/,rfocusMorph=/^(?:focusinfocus|focusoutblur)$/,rtypenamespace=/^([^.]*)(?:\.(.+)|)$/;jQuery.event={global:{},add:function(elem,types,handler,data,selector){var tmp,events,t,handleObjIn,special,eventHandle,handleObj,handlers,type,namespaces,origType,elemData=jQuery._data(elem);if(elemData){if(handler.handler){handleObjIn=handler;handler=handleObjIn.handler;selector=handleObjIn.selector}handler.guid||(handler.guid=jQuery.guid++);(events=elemData.events)||(events=elemData.events={});if(!(eventHandle=elemData.handle)){eventHandle=elemData.handle=function(e){return typeof jQuery===core_strundefined||e&&jQuery.event.triggered===e.type?undefined:jQuery.event.dispatch.apply(eventHandle.elem,arguments)};eventHandle.elem=elem}types=(types||"").match(core_rnotwhite)||[""];t=types.length;for(;t--;){tmp=rtypenamespace.exec(types[t])||[];type=origType=tmp[1];namespaces=(tmp[2]||"").split(".").sort();if(type){special=jQuery.event.special[type]||{};type=(selector?special.delegateType:special.bindType)||type;special=jQuery.event.special[type]||{};handleObj=jQuery.extend({type:type,origType:origType,data:data,handler:handler,guid:handler.guid,selector:selector,needsContext:selector&&jQuery.expr.match.needsContext.test(selector),namespace:namespaces.join(".")},handleObjIn);if(!(handlers=events[type])){handlers=events[type]=[];handlers.delegateCount=0;special.setup&&special.setup.call(elem,data,namespaces,eventHandle)!==!1||(elem.addEventListener?elem.addEventListener(type,eventHandle,!1):elem.attachEvent&&elem.attachEvent("on"+type,eventHandle))}if(special.add){special.add.call(elem,handleObj);handleObj.handler.guid||(handleObj.handler.guid=handler.guid)}selector?handlers.splice(handlers.delegateCount++,0,handleObj):handlers.push(handleObj);jQuery.event.global[type]=!0}}elem=null}},remove:function(elem,types,handler,selector,mappedTypes){var j,handleObj,tmp,origCount,t,events,special,handlers,type,namespaces,origType,elemData=jQuery.hasData(elem)&&jQuery._data(elem);if(elemData&&(events=elemData.events)){types=(types||"").match(core_rnotwhite)||[""];t=types.length;for(;t--;){tmp=rtypenamespace.exec(types[t])||[];type=origType=tmp[1];namespaces=(tmp[2]||"").split(".").sort();if(type){special=jQuery.event.special[type]||{};type=(selector?special.delegateType:special.bindType)||type;handlers=events[type]||[];tmp=tmp[2]&&new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)");origCount=j=handlers.length;for(;j--;){handleObj=handlers[j];if(!(!mappedTypes&&origType!==handleObj.origType||handler&&handler.guid!==handleObj.guid||tmp&&!tmp.test(handleObj.namespace)||selector&&selector!==handleObj.selector&&("**"!==selector||!handleObj.selector))){handlers.splice(j,1);handleObj.selector&&handlers.delegateCount--;special.remove&&special.remove.call(elem,handleObj)}}if(origCount&&!handlers.length){special.teardown&&special.teardown.call(elem,namespaces,elemData.handle)!==!1||jQuery.removeEvent(elem,type,elemData.handle);delete events[type]}}else for(type in events)jQuery.event.remove(elem,type+types[t],handler,selector,!0)}if(jQuery.isEmptyObject(events)){delete elemData.handle;jQuery._removeData(elem,"events")}}},trigger:function(event,data,elem,onlyHandlers){var handle,ontype,cur,bubbleType,special,tmp,i,eventPath=[elem||document],type=core_hasOwn.call(event,"type")?event.type:event,namespaces=core_hasOwn.call(event,"namespace")?event.namespace.split("."):[];cur=tmp=elem=elem||document;if(3!==elem.nodeType&&8!==elem.nodeType&&!rfocusMorph.test(type+jQuery.event.triggered)){if(type.indexOf(".")>=0){namespaces=type.split(".");type=namespaces.shift();namespaces.sort()}ontype=type.indexOf(":")<0&&"on"+type;event=event[jQuery.expando]?event:new jQuery.Event(type,"object"==typeof event&&event);event.isTrigger=onlyHandlers?2:3;event.namespace=namespaces.join(".");event.namespace_re=event.namespace?new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)"):null;event.result=undefined;event.target||(event.target=elem);data=null==data?[event]:jQuery.makeArray(data,[event]);special=jQuery.event.special[type]||{};if(onlyHandlers||!special.trigger||special.trigger.apply(elem,data)!==!1){if(!onlyHandlers&&!special.noBubble&&!jQuery.isWindow(elem)){bubbleType=special.delegateType||type;rfocusMorph.test(bubbleType+type)||(cur=cur.parentNode);for(;cur;cur=cur.parentNode){eventPath.push(cur);tmp=cur}tmp===(elem.ownerDocument||document)&&eventPath.push(tmp.defaultView||tmp.parentWindow||window)}i=0;for(;(cur=eventPath[i++])&&!event.isPropagationStopped();){event.type=i>1?bubbleType:special.bindType||type;handle=(jQuery._data(cur,"events")||{})[event.type]&&jQuery._data(cur,"handle");handle&&handle.apply(cur,data);handle=ontype&&cur[ontype];handle&&jQuery.acceptData(cur)&&handle.apply&&handle.apply(cur,data)===!1&&event.preventDefault()}event.type=type;if(!onlyHandlers&&!event.isDefaultPrevented()&&(!special._default||special._default.apply(eventPath.pop(),data)===!1)&&jQuery.acceptData(elem)&&ontype&&elem[type]&&!jQuery.isWindow(elem)){tmp=elem[ontype];tmp&&(elem[ontype]=null);jQuery.event.triggered=type;try{elem[type]()}catch(e){}jQuery.event.triggered=undefined;tmp&&(elem[ontype]=tmp)}return event.result}}},dispatch:function(event){event=jQuery.event.fix(event);var i,ret,handleObj,matched,j,handlerQueue=[],args=core_slice.call(arguments),handlers=(jQuery._data(this,"events")||{})[event.type]||[],special=jQuery.event.special[event.type]||{};args[0]=event;event.delegateTarget=this;if(!special.preDispatch||special.preDispatch.call(this,event)!==!1){handlerQueue=jQuery.event.handlers.call(this,event,handlers);i=0;for(;(matched=handlerQueue[i++])&&!event.isPropagationStopped();){event.currentTarget=matched.elem;j=0;for(;(handleObj=matched.handlers[j++])&&!event.isImmediatePropagationStopped();)if(!event.namespace_re||event.namespace_re.test(handleObj.namespace)){event.handleObj=handleObj;event.data=handleObj.data;ret=((jQuery.event.special[handleObj.origType]||{}).handle||handleObj.handler).apply(matched.elem,args);if(ret!==undefined&&(event.result=ret)===!1){event.preventDefault();event.stopPropagation()}}}special.postDispatch&&special.postDispatch.call(this,event);return event.result}},handlers:function(event,handlers){var sel,handleObj,matches,i,handlerQueue=[],delegateCount=handlers.delegateCount,cur=event.target;if(delegateCount&&cur.nodeType&&(!event.button||"click"!==event.type))for(;cur!=this;cur=cur.parentNode||this)if(1===cur.nodeType&&(cur.disabled!==!0||"click"!==event.type)){matches=[];for(i=0;delegateCount>i;i++){handleObj=handlers[i];sel=handleObj.selector+" ";matches[sel]===undefined&&(matches[sel]=handleObj.needsContext?jQuery(sel,this).index(cur)>=0:jQuery.find(sel,this,null,[cur]).length);matches[sel]&&matches.push(handleObj)}matches.length&&handlerQueue.push({elem:cur,handlers:matches})}delegateCount<handlers.length&&handlerQueue.push({elem:this,handlers:handlers.slice(delegateCount)});return handlerQueue},fix:function(event){if(event[jQuery.expando])return event;var i,prop,copy,type=event.type,originalEvent=event,fixHook=this.fixHooks[type];
fixHook||(this.fixHooks[type]=fixHook=rmouseEvent.test(type)?this.mouseHooks:rkeyEvent.test(type)?this.keyHooks:{});copy=fixHook.props?this.props.concat(fixHook.props):this.props;event=new jQuery.Event(originalEvent);i=copy.length;for(;i--;){prop=copy[i];event[prop]=originalEvent[prop]}event.target||(event.target=originalEvent.srcElement||document);3===event.target.nodeType&&(event.target=event.target.parentNode);event.metaKey=!!event.metaKey;return fixHook.filter?fixHook.filter(event,originalEvent):event},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(event,original){null==event.which&&(event.which=null!=original.charCode?original.charCode:original.keyCode);return event}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(event,original){var body,eventDoc,doc,button=original.button,fromElement=original.fromElement;if(null==event.pageX&&null!=original.clientX){eventDoc=event.target.ownerDocument||document;doc=eventDoc.documentElement;body=eventDoc.body;event.pageX=original.clientX+(doc&&doc.scrollLeft||body&&body.scrollLeft||0)-(doc&&doc.clientLeft||body&&body.clientLeft||0);event.pageY=original.clientY+(doc&&doc.scrollTop||body&&body.scrollTop||0)-(doc&&doc.clientTop||body&&body.clientTop||0)}!event.relatedTarget&&fromElement&&(event.relatedTarget=fromElement===event.target?original.toElement:fromElement);event.which||button===undefined||(event.which=1&button?1:2&button?3:4&button?2:0);return event}},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==safeActiveElement()&&this.focus)try{this.focus();return!1}catch(e){}},delegateType:"focusin"},blur:{trigger:function(){if(this===safeActiveElement()&&this.blur){this.blur();return!1}},delegateType:"focusout"},click:{trigger:function(){if(jQuery.nodeName(this,"input")&&"checkbox"===this.type&&this.click){this.click();return!1}},_default:function(event){return jQuery.nodeName(event.target,"a")}},beforeunload:{postDispatch:function(event){event.result!==undefined&&(event.originalEvent.returnValue=event.result)}}},simulate:function(type,elem,event,bubble){var e=jQuery.extend(new jQuery.Event,event,{type:type,isSimulated:!0,originalEvent:{}});bubble?jQuery.event.trigger(e,null,elem):jQuery.event.dispatch.call(elem,e);e.isDefaultPrevented()&&event.preventDefault()}};jQuery.removeEvent=document.removeEventListener?function(elem,type,handle){elem.removeEventListener&&elem.removeEventListener(type,handle,!1)}:function(elem,type,handle){var name="on"+type;if(elem.detachEvent){typeof elem[name]===core_strundefined&&(elem[name]=null);elem.detachEvent(name,handle)}};jQuery.Event=function(src,props){if(!(this instanceof jQuery.Event))return new jQuery.Event(src,props);if(src&&src.type){this.originalEvent=src;this.type=src.type;this.isDefaultPrevented=src.defaultPrevented||src.returnValue===!1||src.getPreventDefault&&src.getPreventDefault()?returnTrue:returnFalse}else this.type=src;props&&jQuery.extend(this,props);this.timeStamp=src&&src.timeStamp||jQuery.now();this[jQuery.expando]=!0};jQuery.Event.prototype={isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=returnTrue;e&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=returnTrue;if(e){e.stopPropagation&&e.stopPropagation();e.cancelBubble=!0}},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=returnTrue;this.stopPropagation()}};jQuery.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(orig,fix){jQuery.event.special[orig]={delegateType:fix,bindType:fix,handle:function(event){var ret,target=this,related=event.relatedTarget,handleObj=event.handleObj;if(!related||related!==target&&!jQuery.contains(target,related)){event.type=handleObj.origType;ret=handleObj.handler.apply(this,arguments);event.type=fix}return ret}}});jQuery.support.submitBubbles||(jQuery.event.special.submit={setup:function(){if(jQuery.nodeName(this,"form"))return!1;jQuery.event.add(this,"click._submit keypress._submit",function(e){var elem=e.target,form=jQuery.nodeName(elem,"input")||jQuery.nodeName(elem,"button")?elem.form:undefined;if(form&&!jQuery._data(form,"submitBubbles")){jQuery.event.add(form,"submit._submit",function(event){event._submit_bubble=!0});jQuery._data(form,"submitBubbles",!0)}});return void 0},postDispatch:function(event){if(event._submit_bubble){delete event._submit_bubble;this.parentNode&&!event.isTrigger&&jQuery.event.simulate("submit",this.parentNode,event,!0)}},teardown:function(){if(jQuery.nodeName(this,"form"))return!1;jQuery.event.remove(this,"._submit");return void 0}});jQuery.support.changeBubbles||(jQuery.event.special.change={setup:function(){if(rformElems.test(this.nodeName)){if("checkbox"===this.type||"radio"===this.type){jQuery.event.add(this,"propertychange._change",function(event){"checked"===event.originalEvent.propertyName&&(this._just_changed=!0)});jQuery.event.add(this,"click._change",function(event){this._just_changed&&!event.isTrigger&&(this._just_changed=!1);jQuery.event.simulate("change",this,event,!0)})}return!1}jQuery.event.add(this,"beforeactivate._change",function(e){var elem=e.target;if(rformElems.test(elem.nodeName)&&!jQuery._data(elem,"changeBubbles")){jQuery.event.add(elem,"change._change",function(event){!this.parentNode||event.isSimulated||event.isTrigger||jQuery.event.simulate("change",this.parentNode,event,!0)});jQuery._data(elem,"changeBubbles",!0)}})},handle:function(event){var elem=event.target;return this!==elem||event.isSimulated||event.isTrigger||"radio"!==elem.type&&"checkbox"!==elem.type?event.handleObj.handler.apply(this,arguments):void 0},teardown:function(){jQuery.event.remove(this,"._change");return!rformElems.test(this.nodeName)}});jQuery.support.focusinBubbles||jQuery.each({focus:"focusin",blur:"focusout"},function(orig,fix){var attaches=0,handler=function(event){jQuery.event.simulate(fix,event.target,jQuery.event.fix(event),!0)};jQuery.event.special[fix]={setup:function(){0===attaches++&&document.addEventListener(orig,handler,!0)},teardown:function(){0===--attaches&&document.removeEventListener(orig,handler,!0)}}});jQuery.fn.extend({on:function(types,selector,data,fn,one){var type,origFn;if("object"==typeof types){if("string"!=typeof selector){data=data||selector;selector=undefined}for(type in types)this.on(type,selector,data,types[type],one);return this}if(null==data&&null==fn){fn=selector;data=selector=undefined}else if(null==fn)if("string"==typeof selector){fn=data;data=undefined}else{fn=data;data=selector;selector=undefined}if(fn===!1)fn=returnFalse;else if(!fn)return this;if(1===one){origFn=fn;fn=function(event){jQuery().off(event);return origFn.apply(this,arguments)};fn.guid=origFn.guid||(origFn.guid=jQuery.guid++)}return this.each(function(){jQuery.event.add(this,types,fn,data,selector)})},one:function(types,selector,data,fn){return this.on(types,selector,data,fn,1)},off:function(types,selector,fn){var handleObj,type;if(types&&types.preventDefault&&types.handleObj){handleObj=types.handleObj;jQuery(types.delegateTarget).off(handleObj.namespace?handleObj.origType+"."+handleObj.namespace:handleObj.origType,handleObj.selector,handleObj.handler);return this}if("object"==typeof types){for(type in types)this.off(type,selector,types[type]);return this}if(selector===!1||"function"==typeof selector){fn=selector;selector=undefined}fn===!1&&(fn=returnFalse);return this.each(function(){jQuery.event.remove(this,types,fn,selector)})},trigger:function(type,data){return this.each(function(){jQuery.event.trigger(type,data,this)})},triggerHandler:function(type,data){var elem=this[0];return elem?jQuery.event.trigger(type,data,elem,!0):void 0}});var isSimple=/^.[^:#\[\.,]*$/,rparentsprev=/^(?:parents|prev(?:Until|All))/,rneedsContext=jQuery.expr.match.needsContext,guaranteedUnique={children:!0,contents:!0,next:!0,prev:!0};jQuery.fn.extend({find:function(selector){var i,ret=[],self=this,len=self.length;if("string"!=typeof selector)return this.pushStack(jQuery(selector).filter(function(){for(i=0;len>i;i++)if(jQuery.contains(self[i],this))return!0}));for(i=0;len>i;i++)jQuery.find(selector,self[i],ret);ret=this.pushStack(len>1?jQuery.unique(ret):ret);ret.selector=this.selector?this.selector+" "+selector:selector;return ret},has:function(target){var i,targets=jQuery(target,this),len=targets.length;return this.filter(function(){for(i=0;len>i;i++)if(jQuery.contains(this,targets[i]))return!0})},not:function(selector){return this.pushStack(winnow(this,selector||[],!0))},filter:function(selector){return this.pushStack(winnow(this,selector||[],!1))},is:function(selector){return!!winnow(this,"string"==typeof selector&&rneedsContext.test(selector)?jQuery(selector):selector||[],!1).length},closest:function(selectors,context){for(var cur,i=0,l=this.length,ret=[],pos=rneedsContext.test(selectors)||"string"!=typeof selectors?jQuery(selectors,context||this.context):0;l>i;i++)for(cur=this[i];cur&&cur!==context;cur=cur.parentNode)if(cur.nodeType<11&&(pos?pos.index(cur)>-1:1===cur.nodeType&&jQuery.find.matchesSelector(cur,selectors))){cur=ret.push(cur);break}return this.pushStack(ret.length>1?jQuery.unique(ret):ret)},index:function(elem){return elem?"string"==typeof elem?jQuery.inArray(this[0],jQuery(elem)):jQuery.inArray(elem.jquery?elem[0]:elem,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(selector,context){var set="string"==typeof selector?jQuery(selector,context):jQuery.makeArray(selector&&selector.nodeType?[selector]:selector),all=jQuery.merge(this.get(),set);return this.pushStack(jQuery.unique(all))},addBack:function(selector){return this.add(null==selector?this.prevObject:this.prevObject.filter(selector))}});jQuery.each({parent:function(elem){var parent=elem.parentNode;return parent&&11!==parent.nodeType?parent:null},parents:function(elem){return jQuery.dir(elem,"parentNode")},parentsUntil:function(elem,i,until){return jQuery.dir(elem,"parentNode",until)},next:function(elem){return sibling(elem,"nextSibling")},prev:function(elem){return sibling(elem,"previousSibling")},nextAll:function(elem){return jQuery.dir(elem,"nextSibling")},prevAll:function(elem){return jQuery.dir(elem,"previousSibling")},nextUntil:function(elem,i,until){return jQuery.dir(elem,"nextSibling",until)},prevUntil:function(elem,i,until){return jQuery.dir(elem,"previousSibling",until)},siblings:function(elem){return jQuery.sibling((elem.parentNode||{}).firstChild,elem)},children:function(elem){return jQuery.sibling(elem.firstChild)},contents:function(elem){return jQuery.nodeName(elem,"iframe")?elem.contentDocument||elem.contentWindow.document:jQuery.merge([],elem.childNodes)}},function(name,fn){jQuery.fn[name]=function(until,selector){var ret=jQuery.map(this,fn,until);"Until"!==name.slice(-5)&&(selector=until);selector&&"string"==typeof selector&&(ret=jQuery.filter(selector,ret));if(this.length>1){guaranteedUnique[name]||(ret=jQuery.unique(ret));rparentsprev.test(name)&&(ret=ret.reverse())}return this.pushStack(ret)}});jQuery.extend({filter:function(expr,elems,not){var elem=elems[0];not&&(expr=":not("+expr+")");return 1===elems.length&&1===elem.nodeType?jQuery.find.matchesSelector(elem,expr)?[elem]:[]:jQuery.find.matches(expr,jQuery.grep(elems,function(elem){return 1===elem.nodeType}))},dir:function(elem,dir,until){for(var matched=[],cur=elem[dir];cur&&9!==cur.nodeType&&(until===undefined||1!==cur.nodeType||!jQuery(cur).is(until));){1===cur.nodeType&&matched.push(cur);cur=cur[dir]}return matched},sibling:function(n,elem){for(var r=[];n;n=n.nextSibling)1===n.nodeType&&n!==elem&&r.push(n);return r}});var nodeNames="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",rinlinejQuery=/ jQuery\d+="(?:null|\d+)"/g,rnoshimcache=new RegExp("<(?:"+nodeNames+")[\\s/>]","i"),rleadingWhitespace=/^\s+/,rxhtmlTag=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,rtagName=/<([\w:]+)/,rtbody=/<tbody/i,rhtml=/<|&#?\w+;/,rnoInnerhtml=/<(?:script|style|link)/i,manipulation_rcheckableType=/^(?:checkbox|radio)$/i,rchecked=/checked\s*(?:[^=]|=\s*.checked.)/i,rscriptType=/^$|\/(?:java|ecma)script/i,rscriptTypeMasked=/^true\/(.*)/,rcleanScript=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,wrapMap={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:jQuery.support.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},safeFragment=createSafeFragment(document),fragmentDiv=safeFragment.appendChild(document.createElement("div"));wrapMap.optgroup=wrapMap.option;wrapMap.tbody=wrapMap.tfoot=wrapMap.colgroup=wrapMap.caption=wrapMap.thead;wrapMap.th=wrapMap.td;jQuery.fn.extend({text:function(value){return jQuery.access(this,function(value){return value===undefined?jQuery.text(this):this.empty().append((this[0]&&this[0].ownerDocument||document).createTextNode(value))},null,value,arguments.length)},append:function(){return this.domManip(arguments,function(elem){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var target=manipulationTarget(this,elem);target.appendChild(elem)}})},prepend:function(){return this.domManip(arguments,function(elem){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var target=manipulationTarget(this,elem);target.insertBefore(elem,target.firstChild)}})},before:function(){return this.domManip(arguments,function(elem){this.parentNode&&this.parentNode.insertBefore(elem,this)})},after:function(){return this.domManip(arguments,function(elem){this.parentNode&&this.parentNode.insertBefore(elem,this.nextSibling)})},remove:function(selector,keepData){for(var elem,elems=selector?jQuery.filter(selector,this):this,i=0;null!=(elem=elems[i]);i++){keepData||1!==elem.nodeType||jQuery.cleanData(getAll(elem));if(elem.parentNode){keepData&&jQuery.contains(elem.ownerDocument,elem)&&setGlobalEval(getAll(elem,"script"));elem.parentNode.removeChild(elem)}}return this},empty:function(){for(var elem,i=0;null!=(elem=this[i]);i++){1===elem.nodeType&&jQuery.cleanData(getAll(elem,!1));for(;elem.firstChild;)elem.removeChild(elem.firstChild);elem.options&&jQuery.nodeName(elem,"select")&&(elem.options.length=0)}return this},clone:function(dataAndEvents,deepDataAndEvents){dataAndEvents=null==dataAndEvents?!1:dataAndEvents;deepDataAndEvents=null==deepDataAndEvents?dataAndEvents:deepDataAndEvents;return this.map(function(){return jQuery.clone(this,dataAndEvents,deepDataAndEvents)})},html:function(value){return jQuery.access(this,function(value){var elem=this[0]||{},i=0,l=this.length;if(value===undefined)return 1===elem.nodeType?elem.innerHTML.replace(rinlinejQuery,""):undefined;if(!("string"!=typeof value||rnoInnerhtml.test(value)||!jQuery.support.htmlSerialize&&rnoshimcache.test(value)||!jQuery.support.leadingWhitespace&&rleadingWhitespace.test(value)||wrapMap[(rtagName.exec(value)||["",""])[1].toLowerCase()])){value=value.replace(rxhtmlTag,"<$1></$2>");try{for(;l>i;i++){elem=this[i]||{};if(1===elem.nodeType){jQuery.cleanData(getAll(elem,!1));elem.innerHTML=value}}elem=0}catch(e){}}elem&&this.empty().append(value)},null,value,arguments.length)},replaceWith:function(){var args=jQuery.map(this,function(elem){return[elem.nextSibling,elem.parentNode]}),i=0;this.domManip(arguments,function(elem){var next=args[i++],parent=args[i++];if(parent){next&&next.parentNode!==parent&&(next=this.nextSibling);jQuery(this).remove();parent.insertBefore(elem,next)}},!0);return i?this:this.remove()},detach:function(selector){return this.remove(selector,!0)},domManip:function(args,callback,allowIntersection){args=core_concat.apply([],args);var first,node,hasScripts,scripts,doc,fragment,i=0,l=this.length,set=this,iNoClone=l-1,value=args[0],isFunction=jQuery.isFunction(value);if(isFunction||!(1>=l||"string"!=typeof value||jQuery.support.checkClone)&&rchecked.test(value))return this.each(function(index){var self=set.eq(index);isFunction&&(args[0]=value.call(this,index,self.html()));self.domManip(args,callback,allowIntersection)});if(l){fragment=jQuery.buildFragment(args,this[0].ownerDocument,!1,!allowIntersection&&this);first=fragment.firstChild;1===fragment.childNodes.length&&(fragment=first);if(first){scripts=jQuery.map(getAll(fragment,"script"),disableScript);hasScripts=scripts.length;for(;l>i;i++){node=fragment;if(i!==iNoClone){node=jQuery.clone(node,!0,!0);hasScripts&&jQuery.merge(scripts,getAll(node,"script"))}callback.call(this[i],node,i)}if(hasScripts){doc=scripts[scripts.length-1].ownerDocument;jQuery.map(scripts,restoreScript);for(i=0;hasScripts>i;i++){node=scripts[i];rscriptType.test(node.type||"")&&!jQuery._data(node,"globalEval")&&jQuery.contains(doc,node)&&(node.src?jQuery._evalUrl(node.src):jQuery.globalEval((node.text||node.textContent||node.innerHTML||"").replace(rcleanScript,"")))}}fragment=first=null}}return this}});jQuery.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(name,original){jQuery.fn[name]=function(selector){for(var elems,i=0,ret=[],insert=jQuery(selector),last=insert.length-1;last>=i;i++){elems=i===last?this:this.clone(!0);jQuery(insert[i])[original](elems);core_push.apply(ret,elems.get())}return this.pushStack(ret)}});jQuery.extend({clone:function(elem,dataAndEvents,deepDataAndEvents){var destElements,node,clone,i,srcElements,inPage=jQuery.contains(elem.ownerDocument,elem);if(jQuery.support.html5Clone||jQuery.isXMLDoc(elem)||!rnoshimcache.test("<"+elem.nodeName+">"))clone=elem.cloneNode(!0);else{fragmentDiv.innerHTML=elem.outerHTML;fragmentDiv.removeChild(clone=fragmentDiv.firstChild)}if(!(jQuery.support.noCloneEvent&&jQuery.support.noCloneChecked||1!==elem.nodeType&&11!==elem.nodeType||jQuery.isXMLDoc(elem))){destElements=getAll(clone);srcElements=getAll(elem);for(i=0;null!=(node=srcElements[i]);++i)destElements[i]&&fixCloneNodeIssues(node,destElements[i])}if(dataAndEvents)if(deepDataAndEvents){srcElements=srcElements||getAll(elem);destElements=destElements||getAll(clone);for(i=0;null!=(node=srcElements[i]);i++)cloneCopyEvent(node,destElements[i])}else cloneCopyEvent(elem,clone);destElements=getAll(clone,"script");destElements.length>0&&setGlobalEval(destElements,!inPage&&getAll(elem,"script"));destElements=srcElements=node=null;return clone},buildFragment:function(elems,context,scripts,selection){for(var j,elem,contains,tmp,tag,tbody,wrap,l=elems.length,safe=createSafeFragment(context),nodes=[],i=0;l>i;i++){elem=elems[i];if(elem||0===elem)if("object"===jQuery.type(elem))jQuery.merge(nodes,elem.nodeType?[elem]:elem);else if(rhtml.test(elem)){tmp=tmp||safe.appendChild(context.createElement("div"));tag=(rtagName.exec(elem)||["",""])[1].toLowerCase();wrap=wrapMap[tag]||wrapMap._default;tmp.innerHTML=wrap[1]+elem.replace(rxhtmlTag,"<$1></$2>")+wrap[2];j=wrap[0];for(;j--;)tmp=tmp.lastChild;!jQuery.support.leadingWhitespace&&rleadingWhitespace.test(elem)&&nodes.push(context.createTextNode(rleadingWhitespace.exec(elem)[0]));if(!jQuery.support.tbody){elem="table"!==tag||rtbody.test(elem)?"<table>"!==wrap[1]||rtbody.test(elem)?0:tmp:tmp.firstChild;j=elem&&elem.childNodes.length;for(;j--;)jQuery.nodeName(tbody=elem.childNodes[j],"tbody")&&!tbody.childNodes.length&&elem.removeChild(tbody)}jQuery.merge(nodes,tmp.childNodes);tmp.textContent="";for(;tmp.firstChild;)tmp.removeChild(tmp.firstChild);tmp=safe.lastChild}else nodes.push(context.createTextNode(elem))}tmp&&safe.removeChild(tmp);jQuery.support.appendChecked||jQuery.grep(getAll(nodes,"input"),fixDefaultChecked);i=0;for(;elem=nodes[i++];)if(!selection||-1===jQuery.inArray(elem,selection)){contains=jQuery.contains(elem.ownerDocument,elem);tmp=getAll(safe.appendChild(elem),"script");contains&&setGlobalEval(tmp);if(scripts){j=0;for(;elem=tmp[j++];)rscriptType.test(elem.type||"")&&scripts.push(elem)}}tmp=null;return safe},cleanData:function(elems,acceptData){for(var elem,type,id,data,i=0,internalKey=jQuery.expando,cache=jQuery.cache,deleteExpando=jQuery.support.deleteExpando,special=jQuery.event.special;null!=(elem=elems[i]);i++)if(acceptData||jQuery.acceptData(elem)){id=elem[internalKey];data=id&&cache[id];if(data){if(data.events)for(type in data.events)special[type]?jQuery.event.remove(elem,type):jQuery.removeEvent(elem,type,data.handle);if(cache[id]){delete cache[id];deleteExpando?delete elem[internalKey]:typeof elem.removeAttribute!==core_strundefined?elem.removeAttribute(internalKey):elem[internalKey]=null;core_deletedIds.push(id)}}}},_evalUrl:function(url){return jQuery.ajax({url:url,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})}});jQuery.fn.extend({wrapAll:function(html){if(jQuery.isFunction(html))return this.each(function(i){jQuery(this).wrapAll(html.call(this,i))});if(this[0]){var wrap=jQuery(html,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&wrap.insertBefore(this[0]);wrap.map(function(){for(var elem=this;elem.firstChild&&1===elem.firstChild.nodeType;)elem=elem.firstChild;return elem}).append(this)}return this},wrapInner:function(html){return this.each(jQuery.isFunction(html)?function(i){jQuery(this).wrapInner(html.call(this,i))}:function(){var self=jQuery(this),contents=self.contents();contents.length?contents.wrapAll(html):self.append(html)})},wrap:function(html){var isFunction=jQuery.isFunction(html);return this.each(function(i){jQuery(this).wrapAll(isFunction?html.call(this,i):html)})},unwrap:function(){return this.parent().each(function(){jQuery.nodeName(this,"body")||jQuery(this).replaceWith(this.childNodes)}).end()}});var iframe,getStyles,curCSS,ralpha=/alpha\([^)]*\)/i,ropacity=/opacity\s*=\s*([^)]*)/,rposition=/^(top|right|bottom|left)$/,rdisplayswap=/^(none|table(?!-c[ea]).+)/,rmargin=/^margin/,rnumsplit=new RegExp("^("+core_pnum+")(.*)$","i"),rnumnonpx=new RegExp("^("+core_pnum+")(?!px)[a-z%]+$","i"),rrelNum=new RegExp("^([+-])=("+core_pnum+")","i"),elemdisplay={BODY:"block"},cssShow={position:"absolute",visibility:"hidden",display:"block"},cssNormalTransform={letterSpacing:0,fontWeight:400},cssExpand=["Top","Right","Bottom","Left"],cssPrefixes=["Webkit","O","Moz","ms"];jQuery.fn.extend({css:function(name,value){return jQuery.access(this,function(elem,name,value){var len,styles,map={},i=0;if(jQuery.isArray(name)){styles=getStyles(elem);len=name.length;for(;len>i;i++)map[name[i]]=jQuery.css(elem,name[i],!1,styles);return map}return value!==undefined?jQuery.style(elem,name,value):jQuery.css(elem,name)},name,value,arguments.length>1)},show:function(){return showHide(this,!0)},hide:function(){return showHide(this)},toggle:function(state){return"boolean"==typeof state?state?this.show():this.hide():this.each(function(){isHidden(this)?jQuery(this).show():jQuery(this).hide()})}});jQuery.extend({cssHooks:{opacity:{get:function(elem,computed){if(computed){var ret=curCSS(elem,"opacity");return""===ret?"1":ret}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":jQuery.support.cssFloat?"cssFloat":"styleFloat"},style:function(elem,name,value,extra){if(elem&&3!==elem.nodeType&&8!==elem.nodeType&&elem.style){var ret,type,hooks,origName=jQuery.camelCase(name),style=elem.style;name=jQuery.cssProps[origName]||(jQuery.cssProps[origName]=vendorPropName(style,origName));hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName];if(value===undefined)return hooks&&"get"in hooks&&(ret=hooks.get(elem,!1,extra))!==undefined?ret:style[name];type=typeof value;if("string"===type&&(ret=rrelNum.exec(value))){value=(ret[1]+1)*ret[2]+parseFloat(jQuery.css(elem,name));type="number"}if(!(null==value||"number"===type&&isNaN(value))){"number"!==type||jQuery.cssNumber[origName]||(value+="px");jQuery.support.clearCloneStyle||""!==value||0!==name.indexOf("background")||(style[name]="inherit");if(!(hooks&&"set"in hooks&&(value=hooks.set(elem,value,extra))===undefined))try{style[name]=value}catch(e){}}}},css:function(elem,name,extra,styles){var num,val,hooks,origName=jQuery.camelCase(name);name=jQuery.cssProps[origName]||(jQuery.cssProps[origName]=vendorPropName(elem.style,origName));hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName];hooks&&"get"in hooks&&(val=hooks.get(elem,!0,extra));val===undefined&&(val=curCSS(elem,name,styles));"normal"===val&&name in cssNormalTransform&&(val=cssNormalTransform[name]);if(""===extra||extra){num=parseFloat(val);return extra===!0||jQuery.isNumeric(num)?num||0:val}return val}});if(window.getComputedStyle){getStyles=function(elem){return window.getComputedStyle(elem,null)};curCSS=function(elem,name,_computed){var width,minWidth,maxWidth,computed=_computed||getStyles(elem),ret=computed?computed.getPropertyValue(name)||computed[name]:undefined,style=elem.style;if(computed){""!==ret||jQuery.contains(elem.ownerDocument,elem)||(ret=jQuery.style(elem,name));if(rnumnonpx.test(ret)&&rmargin.test(name)){width=style.width;minWidth=style.minWidth;maxWidth=style.maxWidth;style.minWidth=style.maxWidth=style.width=ret;ret=computed.width;style.width=width;style.minWidth=minWidth;style.maxWidth=maxWidth}}return ret}}else if(document.documentElement.currentStyle){getStyles=function(elem){return elem.currentStyle};curCSS=function(elem,name,_computed){var left,rs,rsLeft,computed=_computed||getStyles(elem),ret=computed?computed[name]:undefined,style=elem.style;null==ret&&style&&style[name]&&(ret=style[name]);if(rnumnonpx.test(ret)&&!rposition.test(name)){left=style.left;rs=elem.runtimeStyle;rsLeft=rs&&rs.left;rsLeft&&(rs.left=elem.currentStyle.left);style.left="fontSize"===name?"1em":ret;ret=style.pixelLeft+"px";style.left=left;rsLeft&&(rs.left=rsLeft)}return""===ret?"auto":ret}}jQuery.each(["height","width"],function(i,name){jQuery.cssHooks[name]={get:function(elem,computed,extra){return computed?0===elem.offsetWidth&&rdisplayswap.test(jQuery.css(elem,"display"))?jQuery.swap(elem,cssShow,function(){return getWidthOrHeight(elem,name,extra)}):getWidthOrHeight(elem,name,extra):void 0},set:function(elem,value,extra){var styles=extra&&getStyles(elem);return setPositiveNumber(elem,value,extra?augmentWidthOrHeight(elem,name,extra,jQuery.support.boxSizing&&"border-box"===jQuery.css(elem,"boxSizing",!1,styles),styles):0)}}});jQuery.support.opacity||(jQuery.cssHooks.opacity={get:function(elem,computed){return ropacity.test((computed&&elem.currentStyle?elem.currentStyle.filter:elem.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":computed?"1":""},set:function(elem,value){var style=elem.style,currentStyle=elem.currentStyle,opacity=jQuery.isNumeric(value)?"alpha(opacity="+100*value+")":"",filter=currentStyle&&currentStyle.filter||style.filter||"";style.zoom=1;if((value>=1||""===value)&&""===jQuery.trim(filter.replace(ralpha,""))&&style.removeAttribute){style.removeAttribute("filter");if(""===value||currentStyle&&!currentStyle.filter)return}style.filter=ralpha.test(filter)?filter.replace(ralpha,opacity):filter+" "+opacity}});jQuery(function(){jQuery.support.reliableMarginRight||(jQuery.cssHooks.marginRight={get:function(elem,computed){return computed?jQuery.swap(elem,{display:"inline-block"},curCSS,[elem,"marginRight"]):void 0}});!jQuery.support.pixelPosition&&jQuery.fn.position&&jQuery.each(["top","left"],function(i,prop){jQuery.cssHooks[prop]={get:function(elem,computed){if(computed){computed=curCSS(elem,prop);return rnumnonpx.test(computed)?jQuery(elem).position()[prop]+"px":computed}}}})});if(jQuery.expr&&jQuery.expr.filters){jQuery.expr.filters.hidden=function(elem){return elem.offsetWidth<=0&&elem.offsetHeight<=0||!jQuery.support.reliableHiddenOffsets&&"none"===(elem.style&&elem.style.display||jQuery.css(elem,"display"))};jQuery.expr.filters.visible=function(elem){return!jQuery.expr.filters.hidden(elem)}}jQuery.each({margin:"",padding:"",border:"Width"},function(prefix,suffix){jQuery.cssHooks[prefix+suffix]={expand:function(value){for(var i=0,expanded={},parts="string"==typeof value?value.split(" "):[value];4>i;i++)expanded[prefix+cssExpand[i]+suffix]=parts[i]||parts[i-2]||parts[0];return expanded}};rmargin.test(prefix)||(jQuery.cssHooks[prefix+suffix].set=setPositiveNumber)});var r20=/%20/g,rbracket=/\[\]$/,rCRLF=/\r?\n/g,rsubmitterTypes=/^(?:submit|button|image|reset|file)$/i,rsubmittable=/^(?:input|select|textarea|keygen)/i;jQuery.fn.extend({serialize:function(){return jQuery.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var elements=jQuery.prop(this,"elements");return elements?jQuery.makeArray(elements):this}).filter(function(){var type=this.type;return this.name&&!jQuery(this).is(":disabled")&&rsubmittable.test(this.nodeName)&&!rsubmitterTypes.test(type)&&(this.checked||!manipulation_rcheckableType.test(type))}).map(function(i,elem){var val=jQuery(this).val();return null==val?null:jQuery.isArray(val)?jQuery.map(val,function(val){return{name:elem.name,value:val.replace(rCRLF,"\r\n")}}):{name:elem.name,value:val.replace(rCRLF,"\r\n")}}).get()}});jQuery.param=function(a,traditional){var prefix,s=[],add=function(key,value){value=jQuery.isFunction(value)?value():null==value?"":value;s[s.length]=encodeURIComponent(key)+"="+encodeURIComponent(value)};traditional===undefined&&(traditional=jQuery.ajaxSettings&&jQuery.ajaxSettings.traditional);if(jQuery.isArray(a)||a.jquery&&!jQuery.isPlainObject(a))jQuery.each(a,function(){add(this.name,this.value)});else for(prefix in a)buildParams(prefix,a[prefix],traditional,add);return s.join("&").replace(r20,"+")};jQuery.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(i,name){jQuery.fn[name]=function(data,fn){return arguments.length>0?this.on(name,null,data,fn):this.trigger(name)}});jQuery.fn.extend({hover:function(fnOver,fnOut){return this.mouseenter(fnOver).mouseleave(fnOut||fnOver)},bind:function(types,data,fn){return this.on(types,null,data,fn)},unbind:function(types,fn){return this.off(types,null,fn)},delegate:function(selector,types,data,fn){return this.on(types,selector,data,fn)},undelegate:function(selector,types,fn){return 1===arguments.length?this.off(selector,"**"):this.off(types,selector||"**",fn)}});var ajaxLocParts,ajaxLocation,ajax_nonce=jQuery.now(),ajax_rquery=/\?/,rhash=/#.*$/,rts=/([?&])_=[^&]*/,rheaders=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,rlocalProtocol=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,rnoContent=/^(?:GET|HEAD)$/,rprotocol=/^\/\//,rurl=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,_load=jQuery.fn.load,prefilters={},transports={},allTypes="*/".concat("*");try{ajaxLocation=location.href}catch(e){ajaxLocation=document.createElement("a");ajaxLocation.href="";ajaxLocation=ajaxLocation.href}ajaxLocParts=rurl.exec(ajaxLocation.toLowerCase())||[];jQuery.fn.load=function(url,params,callback){if("string"!=typeof url&&_load)return _load.apply(this,arguments);var selector,response,type,self=this,off=url.indexOf(" ");if(off>=0){selector=url.slice(off,url.length);url=url.slice(0,off)}if(jQuery.isFunction(params)){callback=params;params=undefined}else params&&"object"==typeof params&&(type="POST");self.length>0&&jQuery.ajax({url:url,type:type,dataType:"html",data:params}).done(function(responseText){response=arguments;self.html(selector?jQuery("<div>").append(jQuery.parseHTML(responseText)).find(selector):responseText)}).complete(callback&&function(jqXHR,status){self.each(callback,response||[jqXHR.responseText,status,jqXHR])
});return this};jQuery.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(i,type){jQuery.fn[type]=function(fn){return this.on(type,fn)}});jQuery.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:ajaxLocation,type:"GET",isLocal:rlocalProtocol.test(ajaxLocParts[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":allTypes,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":jQuery.parseJSON,"text xml":jQuery.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(target,settings){return settings?ajaxExtend(ajaxExtend(target,jQuery.ajaxSettings),settings):ajaxExtend(jQuery.ajaxSettings,target)},ajaxPrefilter:addToPrefiltersOrTransports(prefilters),ajaxTransport:addToPrefiltersOrTransports(transports),ajax:function(url,options){function done(status,nativeStatusText,responses,headers){var isSuccess,success,error,response,modified,statusText=nativeStatusText;if(2!==state){state=2;timeoutTimer&&clearTimeout(timeoutTimer);transport=undefined;responseHeadersString=headers||"";jqXHR.readyState=status>0?4:0;isSuccess=status>=200&&300>status||304===status;responses&&(response=ajaxHandleResponses(s,jqXHR,responses));response=ajaxConvert(s,response,jqXHR,isSuccess);if(isSuccess){if(s.ifModified){modified=jqXHR.getResponseHeader("Last-Modified");modified&&(jQuery.lastModified[cacheURL]=modified);modified=jqXHR.getResponseHeader("etag");modified&&(jQuery.etag[cacheURL]=modified)}if(204===status||"HEAD"===s.type)statusText="nocontent";else if(304===status)statusText="notmodified";else{statusText=response.state;success=response.data;error=response.error;isSuccess=!error}}else{error=statusText;if(status||!statusText){statusText="error";0>status&&(status=0)}}jqXHR.status=status;jqXHR.statusText=(nativeStatusText||statusText)+"";isSuccess?deferred.resolveWith(callbackContext,[success,statusText,jqXHR]):deferred.rejectWith(callbackContext,[jqXHR,statusText,error]);jqXHR.statusCode(statusCode);statusCode=undefined;fireGlobals&&globalEventContext.trigger(isSuccess?"ajaxSuccess":"ajaxError",[jqXHR,s,isSuccess?success:error]);completeDeferred.fireWith(callbackContext,[jqXHR,statusText]);if(fireGlobals){globalEventContext.trigger("ajaxComplete",[jqXHR,s]);--jQuery.active||jQuery.event.trigger("ajaxStop")}}}if("object"==typeof url){options=url;url=undefined}options=options||{};var parts,i,cacheURL,responseHeadersString,timeoutTimer,fireGlobals,transport,responseHeaders,s=jQuery.ajaxSetup({},options),callbackContext=s.context||s,globalEventContext=s.context&&(callbackContext.nodeType||callbackContext.jquery)?jQuery(callbackContext):jQuery.event,deferred=jQuery.Deferred(),completeDeferred=jQuery.Callbacks("once memory"),statusCode=s.statusCode||{},requestHeaders={},requestHeadersNames={},state=0,strAbort="canceled",jqXHR={readyState:0,getResponseHeader:function(key){var match;if(2===state){if(!responseHeaders){responseHeaders={};for(;match=rheaders.exec(responseHeadersString);)responseHeaders[match[1].toLowerCase()]=match[2]}match=responseHeaders[key.toLowerCase()]}return null==match?null:match},getAllResponseHeaders:function(){return 2===state?responseHeadersString:null},setRequestHeader:function(name,value){var lname=name.toLowerCase();if(!state){name=requestHeadersNames[lname]=requestHeadersNames[lname]||name;requestHeaders[name]=value}return this},overrideMimeType:function(type){state||(s.mimeType=type);return this},statusCode:function(map){var code;if(map)if(2>state)for(code in map)statusCode[code]=[statusCode[code],map[code]];else jqXHR.always(map[jqXHR.status]);return this},abort:function(statusText){var finalText=statusText||strAbort;transport&&transport.abort(finalText);done(0,finalText);return this}};deferred.promise(jqXHR).complete=completeDeferred.add;jqXHR.success=jqXHR.done;jqXHR.error=jqXHR.fail;s.url=((url||s.url||ajaxLocation)+"").replace(rhash,"").replace(rprotocol,ajaxLocParts[1]+"//");s.type=options.method||options.type||s.method||s.type;s.dataTypes=jQuery.trim(s.dataType||"*").toLowerCase().match(core_rnotwhite)||[""];if(null==s.crossDomain){parts=rurl.exec(s.url.toLowerCase());s.crossDomain=!(!parts||parts[1]===ajaxLocParts[1]&&parts[2]===ajaxLocParts[2]&&(parts[3]||("http:"===parts[1]?"80":"443"))===(ajaxLocParts[3]||("http:"===ajaxLocParts[1]?"80":"443")))}s.data&&s.processData&&"string"!=typeof s.data&&(s.data=jQuery.param(s.data,s.traditional));inspectPrefiltersOrTransports(prefilters,s,options,jqXHR);if(2===state)return jqXHR;fireGlobals=s.global;fireGlobals&&0===jQuery.active++&&jQuery.event.trigger("ajaxStart");s.type=s.type.toUpperCase();s.hasContent=!rnoContent.test(s.type);cacheURL=s.url;if(!s.hasContent){if(s.data){cacheURL=s.url+=(ajax_rquery.test(cacheURL)?"&":"?")+s.data;delete s.data}s.cache===!1&&(s.url=rts.test(cacheURL)?cacheURL.replace(rts,"$1_="+ajax_nonce++):cacheURL+(ajax_rquery.test(cacheURL)?"&":"?")+"_="+ajax_nonce++)}if(s.ifModified){jQuery.lastModified[cacheURL]&&jqXHR.setRequestHeader("If-Modified-Since",jQuery.lastModified[cacheURL]);jQuery.etag[cacheURL]&&jqXHR.setRequestHeader("If-None-Match",jQuery.etag[cacheURL])}(s.data&&s.hasContent&&s.contentType!==!1||options.contentType)&&jqXHR.setRequestHeader("Content-Type",s.contentType);jqXHR.setRequestHeader("Accept",s.dataTypes[0]&&s.accepts[s.dataTypes[0]]?s.accepts[s.dataTypes[0]]+("*"!==s.dataTypes[0]?", "+allTypes+"; q=0.01":""):s.accepts["*"]);for(i in s.headers)jqXHR.setRequestHeader(i,s.headers[i]);if(s.beforeSend&&(s.beforeSend.call(callbackContext,jqXHR,s)===!1||2===state))return jqXHR.abort();strAbort="abort";for(i in{success:1,error:1,complete:1})jqXHR[i](s[i]);transport=inspectPrefiltersOrTransports(transports,s,options,jqXHR);if(transport){jqXHR.readyState=1;fireGlobals&&globalEventContext.trigger("ajaxSend",[jqXHR,s]);s.async&&s.timeout>0&&(timeoutTimer=setTimeout(function(){jqXHR.abort("timeout")},s.timeout));try{state=1;transport.send(requestHeaders,done)}catch(e){if(!(2>state))throw e;done(-1,e)}}else done(-1,"No Transport");return jqXHR},getJSON:function(url,data,callback){return jQuery.get(url,data,callback,"json")},getScript:function(url,callback){return jQuery.get(url,undefined,callback,"script")}});jQuery.each(["get","post"],function(i,method){jQuery[method]=function(url,data,callback,type){if(jQuery.isFunction(data)){type=type||callback;callback=data;data=undefined}return jQuery.ajax({url:url,type:method,dataType:type,data:data,success:callback})}});jQuery.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(text){jQuery.globalEval(text);return text}}});jQuery.ajaxPrefilter("script",function(s){s.cache===undefined&&(s.cache=!1);if(s.crossDomain){s.type="GET";s.global=!1}});jQuery.ajaxTransport("script",function(s){if(s.crossDomain){var script,head=document.head||jQuery("head")[0]||document.documentElement;return{send:function(_,callback){script=document.createElement("script");script.async=!0;s.scriptCharset&&(script.charset=s.scriptCharset);script.src=s.url;script.onload=script.onreadystatechange=function(_,isAbort){if(isAbort||!script.readyState||/loaded|complete/.test(script.readyState)){script.onload=script.onreadystatechange=null;script.parentNode&&script.parentNode.removeChild(script);script=null;isAbort||callback(200,"success")}};head.insertBefore(script,head.firstChild)},abort:function(){script&&script.onload(undefined,!0)}}}});var oldCallbacks=[],rjsonp=/(=)\?(?=&|$)|\?\?/;jQuery.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var callback=oldCallbacks.pop()||jQuery.expando+"_"+ajax_nonce++;this[callback]=!0;return callback}});jQuery.ajaxPrefilter("json jsonp",function(s,originalSettings,jqXHR){var callbackName,overwritten,responseContainer,jsonProp=s.jsonp!==!1&&(rjsonp.test(s.url)?"url":"string"==typeof s.data&&!(s.contentType||"").indexOf("application/x-www-form-urlencoded")&&rjsonp.test(s.data)&&"data");if(jsonProp||"jsonp"===s.dataTypes[0]){callbackName=s.jsonpCallback=jQuery.isFunction(s.jsonpCallback)?s.jsonpCallback():s.jsonpCallback;jsonProp?s[jsonProp]=s[jsonProp].replace(rjsonp,"$1"+callbackName):s.jsonp!==!1&&(s.url+=(ajax_rquery.test(s.url)?"&":"?")+s.jsonp+"="+callbackName);s.converters["script json"]=function(){responseContainer||jQuery.error(callbackName+" was not called");return responseContainer[0]};s.dataTypes[0]="json";overwritten=window[callbackName];window[callbackName]=function(){responseContainer=arguments};jqXHR.always(function(){window[callbackName]=overwritten;if(s[callbackName]){s.jsonpCallback=originalSettings.jsonpCallback;oldCallbacks.push(callbackName)}responseContainer&&jQuery.isFunction(overwritten)&&overwritten(responseContainer[0]);responseContainer=overwritten=undefined});return"script"}});var xhrCallbacks,xhrSupported,xhrId=0,xhrOnUnloadAbort=window.ActiveXObject&&function(){var key;for(key in xhrCallbacks)xhrCallbacks[key](undefined,!0)};jQuery.ajaxSettings.xhr=window.ActiveXObject?function(){return!this.isLocal&&createStandardXHR()||createActiveXHR()}:createStandardXHR;xhrSupported=jQuery.ajaxSettings.xhr();jQuery.support.cors=!!xhrSupported&&"withCredentials"in xhrSupported;xhrSupported=jQuery.support.ajax=!!xhrSupported;xhrSupported&&jQuery.ajaxTransport(function(s){if(!s.crossDomain||jQuery.support.cors){var callback;return{send:function(headers,complete){var handle,i,xhr=s.xhr();s.username?xhr.open(s.type,s.url,s.async,s.username,s.password):xhr.open(s.type,s.url,s.async);if(s.xhrFields)for(i in s.xhrFields)xhr[i]=s.xhrFields[i];s.mimeType&&xhr.overrideMimeType&&xhr.overrideMimeType(s.mimeType);s.crossDomain||headers["X-Requested-With"]||(headers["X-Requested-With"]="XMLHttpRequest");try{for(i in headers)xhr.setRequestHeader(i,headers[i])}catch(err){}xhr.send(s.hasContent&&s.data||null);callback=function(_,isAbort){var status,responseHeaders,statusText,responses;try{if(callback&&(isAbort||4===xhr.readyState)){callback=undefined;if(handle){xhr.onreadystatechange=jQuery.noop;xhrOnUnloadAbort&&delete xhrCallbacks[handle]}if(isAbort)4!==xhr.readyState&&xhr.abort();else{responses={};status=xhr.status;responseHeaders=xhr.getAllResponseHeaders();"string"==typeof xhr.responseText&&(responses.text=xhr.responseText);try{statusText=xhr.statusText}catch(e){statusText=""}status||!s.isLocal||s.crossDomain?1223===status&&(status=204):status=responses.text?200:404}}}catch(firefoxAccessException){isAbort||complete(-1,firefoxAccessException)}responses&&complete(status,statusText,responses,responseHeaders)};if(s.async)if(4===xhr.readyState)setTimeout(callback);else{handle=++xhrId;if(xhrOnUnloadAbort){if(!xhrCallbacks){xhrCallbacks={};jQuery(window).unload(xhrOnUnloadAbort)}xhrCallbacks[handle]=callback}xhr.onreadystatechange=callback}else callback()},abort:function(){callback&&callback(undefined,!0)}}}});var fxNow,timerId,rfxtypes=/^(?:toggle|show|hide)$/,rfxnum=new RegExp("^(?:([+-])=|)("+core_pnum+")([a-z%]*)$","i"),rrun=/queueHooks$/,animationPrefilters=[defaultPrefilter],tweeners={"*":[function(prop,value){var tween=this.createTween(prop,value),target=tween.cur(),parts=rfxnum.exec(value),unit=parts&&parts[3]||(jQuery.cssNumber[prop]?"":"px"),start=(jQuery.cssNumber[prop]||"px"!==unit&&+target)&&rfxnum.exec(jQuery.css(tween.elem,prop)),scale=1,maxIterations=20;if(start&&start[3]!==unit){unit=unit||start[3];parts=parts||[];start=+target||1;do{scale=scale||".5";start/=scale;jQuery.style(tween.elem,prop,start+unit)}while(scale!==(scale=tween.cur()/target)&&1!==scale&&--maxIterations)}if(parts){start=tween.start=+start||+target||0;tween.unit=unit;tween.end=parts[1]?start+(parts[1]+1)*parts[2]:+parts[2]}return tween}]};jQuery.Animation=jQuery.extend(Animation,{tweener:function(props,callback){if(jQuery.isFunction(props)){callback=props;props=["*"]}else props=props.split(" ");for(var prop,index=0,length=props.length;length>index;index++){prop=props[index];tweeners[prop]=tweeners[prop]||[];tweeners[prop].unshift(callback)}},prefilter:function(callback,prepend){prepend?animationPrefilters.unshift(callback):animationPrefilters.push(callback)}});jQuery.Tween=Tween;Tween.prototype={constructor:Tween,init:function(elem,options,prop,end,easing,unit){this.elem=elem;this.prop=prop;this.easing=easing||"swing";this.options=options;this.start=this.now=this.cur();this.end=end;this.unit=unit||(jQuery.cssNumber[prop]?"":"px")},cur:function(){var hooks=Tween.propHooks[this.prop];return hooks&&hooks.get?hooks.get(this):Tween.propHooks._default.get(this)},run:function(percent){var eased,hooks=Tween.propHooks[this.prop];this.pos=eased=this.options.duration?jQuery.easing[this.easing](percent,this.options.duration*percent,0,1,this.options.duration):percent;this.now=(this.end-this.start)*eased+this.start;this.options.step&&this.options.step.call(this.elem,this.now,this);hooks&&hooks.set?hooks.set(this):Tween.propHooks._default.set(this);return this}};Tween.prototype.init.prototype=Tween.prototype;Tween.propHooks={_default:{get:function(tween){var result;if(null!=tween.elem[tween.prop]&&(!tween.elem.style||null==tween.elem.style[tween.prop]))return tween.elem[tween.prop];result=jQuery.css(tween.elem,tween.prop,"");return result&&"auto"!==result?result:0},set:function(tween){jQuery.fx.step[tween.prop]?jQuery.fx.step[tween.prop](tween):tween.elem.style&&(null!=tween.elem.style[jQuery.cssProps[tween.prop]]||jQuery.cssHooks[tween.prop])?jQuery.style(tween.elem,tween.prop,tween.now+tween.unit):tween.elem[tween.prop]=tween.now}}};Tween.propHooks.scrollTop=Tween.propHooks.scrollLeft={set:function(tween){tween.elem.nodeType&&tween.elem.parentNode&&(tween.elem[tween.prop]=tween.now)}};jQuery.each(["toggle","show","hide"],function(i,name){var cssFn=jQuery.fn[name];jQuery.fn[name]=function(speed,easing,callback){return null==speed||"boolean"==typeof speed?cssFn.apply(this,arguments):this.animate(genFx(name,!0),speed,easing,callback)}});jQuery.fn.extend({fadeTo:function(speed,to,easing,callback){return this.filter(isHidden).css("opacity",0).show().end().animate({opacity:to},speed,easing,callback)},animate:function(prop,speed,easing,callback){var empty=jQuery.isEmptyObject(prop),optall=jQuery.speed(speed,easing,callback),doAnimation=function(){var anim=Animation(this,jQuery.extend({},prop),optall);(empty||jQuery._data(this,"finish"))&&anim.stop(!0)};doAnimation.finish=doAnimation;return empty||optall.queue===!1?this.each(doAnimation):this.queue(optall.queue,doAnimation)},stop:function(type,clearQueue,gotoEnd){var stopQueue=function(hooks){var stop=hooks.stop;delete hooks.stop;stop(gotoEnd)};if("string"!=typeof type){gotoEnd=clearQueue;clearQueue=type;type=undefined}clearQueue&&type!==!1&&this.queue(type||"fx",[]);return this.each(function(){var dequeue=!0,index=null!=type&&type+"queueHooks",timers=jQuery.timers,data=jQuery._data(this);if(index)data[index]&&data[index].stop&&stopQueue(data[index]);else for(index in data)data[index]&&data[index].stop&&rrun.test(index)&&stopQueue(data[index]);for(index=timers.length;index--;)if(timers[index].elem===this&&(null==type||timers[index].queue===type)){timers[index].anim.stop(gotoEnd);dequeue=!1;timers.splice(index,1)}(dequeue||!gotoEnd)&&jQuery.dequeue(this,type)})},finish:function(type){type!==!1&&(type=type||"fx");return this.each(function(){var index,data=jQuery._data(this),queue=data[type+"queue"],hooks=data[type+"queueHooks"],timers=jQuery.timers,length=queue?queue.length:0;data.finish=!0;jQuery.queue(this,type,[]);hooks&&hooks.stop&&hooks.stop.call(this,!0);for(index=timers.length;index--;)if(timers[index].elem===this&&timers[index].queue===type){timers[index].anim.stop(!0);timers.splice(index,1)}for(index=0;length>index;index++)queue[index]&&queue[index].finish&&queue[index].finish.call(this);delete data.finish})}});jQuery.each({slideDown:genFx("show"),slideUp:genFx("hide"),slideToggle:genFx("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(name,props){jQuery.fn[name]=function(speed,easing,callback){return this.animate(props,speed,easing,callback)}});jQuery.speed=function(speed,easing,fn){var opt=speed&&"object"==typeof speed?jQuery.extend({},speed):{complete:fn||!fn&&easing||jQuery.isFunction(speed)&&speed,duration:speed,easing:fn&&easing||easing&&!jQuery.isFunction(easing)&&easing};opt.duration=jQuery.fx.off?0:"number"==typeof opt.duration?opt.duration:opt.duration in jQuery.fx.speeds?jQuery.fx.speeds[opt.duration]:jQuery.fx.speeds._default;(null==opt.queue||opt.queue===!0)&&(opt.queue="fx");opt.old=opt.complete;opt.complete=function(){jQuery.isFunction(opt.old)&&opt.old.call(this);opt.queue&&jQuery.dequeue(this,opt.queue)};return opt};jQuery.easing={linear:function(p){return p},swing:function(p){return.5-Math.cos(p*Math.PI)/2}};jQuery.timers=[];jQuery.fx=Tween.prototype.init;jQuery.fx.tick=function(){var timer,timers=jQuery.timers,i=0;fxNow=jQuery.now();for(;i<timers.length;i++){timer=timers[i];timer()||timers[i]!==timer||timers.splice(i--,1)}timers.length||jQuery.fx.stop();fxNow=undefined};jQuery.fx.timer=function(timer){timer()&&jQuery.timers.push(timer)&&jQuery.fx.start()};jQuery.fx.interval=13;jQuery.fx.start=function(){timerId||(timerId=setInterval(jQuery.fx.tick,jQuery.fx.interval))};jQuery.fx.stop=function(){clearInterval(timerId);timerId=null};jQuery.fx.speeds={slow:600,fast:200,_default:400};jQuery.fx.step={};jQuery.expr&&jQuery.expr.filters&&(jQuery.expr.filters.animated=function(elem){return jQuery.grep(jQuery.timers,function(fn){return elem===fn.elem}).length});jQuery.fn.offset=function(options){if(arguments.length)return options===undefined?this:this.each(function(i){jQuery.offset.setOffset(this,options,i)});var docElem,win,box={top:0,left:0},elem=this[0],doc=elem&&elem.ownerDocument;if(doc){docElem=doc.documentElement;if(!jQuery.contains(docElem,elem))return box;typeof elem.getBoundingClientRect!==core_strundefined&&(box=elem.getBoundingClientRect());win=getWindow(doc);return{top:box.top+(win.pageYOffset||docElem.scrollTop)-(docElem.clientTop||0),left:box.left+(win.pageXOffset||docElem.scrollLeft)-(docElem.clientLeft||0)}}};jQuery.offset={setOffset:function(elem,options,i){var position=jQuery.css(elem,"position");"static"===position&&(elem.style.position="relative");var curTop,curLeft,curElem=jQuery(elem),curOffset=curElem.offset(),curCSSTop=jQuery.css(elem,"top"),curCSSLeft=jQuery.css(elem,"left"),calculatePosition=("absolute"===position||"fixed"===position)&&jQuery.inArray("auto",[curCSSTop,curCSSLeft])>-1,props={},curPosition={};if(calculatePosition){curPosition=curElem.position();curTop=curPosition.top;curLeft=curPosition.left}else{curTop=parseFloat(curCSSTop)||0;curLeft=parseFloat(curCSSLeft)||0}jQuery.isFunction(options)&&(options=options.call(elem,i,curOffset));null!=options.top&&(props.top=options.top-curOffset.top+curTop);null!=options.left&&(props.left=options.left-curOffset.left+curLeft);"using"in options?options.using.call(elem,props):curElem.css(props)}};jQuery.fn.extend({position:function(){if(this[0]){var offsetParent,offset,parentOffset={top:0,left:0},elem=this[0];if("fixed"===jQuery.css(elem,"position"))offset=elem.getBoundingClientRect();else{offsetParent=this.offsetParent();offset=this.offset();jQuery.nodeName(offsetParent[0],"html")||(parentOffset=offsetParent.offset());parentOffset.top+=jQuery.css(offsetParent[0],"borderTopWidth",!0);parentOffset.left+=jQuery.css(offsetParent[0],"borderLeftWidth",!0)}return{top:offset.top-parentOffset.top-jQuery.css(elem,"marginTop",!0),left:offset.left-parentOffset.left-jQuery.css(elem,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var offsetParent=this.offsetParent||docElem;offsetParent&&!jQuery.nodeName(offsetParent,"html")&&"static"===jQuery.css(offsetParent,"position");)offsetParent=offsetParent.offsetParent;return offsetParent||docElem})}});jQuery.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(method,prop){var top=/Y/.test(prop);jQuery.fn[method]=function(val){return jQuery.access(this,function(elem,method,val){var win=getWindow(elem);if(val===undefined)return win?prop in win?win[prop]:win.document.documentElement[method]:elem[method];win?win.scrollTo(top?jQuery(win).scrollLeft():val,top?val:jQuery(win).scrollTop()):elem[method]=val;return void 0},method,val,arguments.length,null)}});jQuery.each({Height:"height",Width:"width"},function(name,type){jQuery.each({padding:"inner"+name,content:type,"":"outer"+name},function(defaultExtra,funcName){jQuery.fn[funcName]=function(margin,value){var chainable=arguments.length&&(defaultExtra||"boolean"!=typeof margin),extra=defaultExtra||(margin===!0||value===!0?"margin":"border");return jQuery.access(this,function(elem,type,value){var doc;if(jQuery.isWindow(elem))return elem.document.documentElement["client"+name];if(9===elem.nodeType){doc=elem.documentElement;return Math.max(elem.body["scroll"+name],doc["scroll"+name],elem.body["offset"+name],doc["offset"+name],doc["client"+name])}return value===undefined?jQuery.css(elem,type,extra):jQuery.style(elem,type,value,extra)},type,chainable?margin:undefined,chainable,null)}})});jQuery.fn.size=function(){return this.length};jQuery.fn.andSelf=jQuery.fn.addBack;if("object"==typeof module&&module&&"object"==typeof module.exports)module.exports=jQuery;else{window.jQuery=window.$=jQuery;"function"==typeof define&&define.amd&&define("jquery",[],function(){return jQuery})}}(window);if("undefined"==typeof Splunk||!Splunk)var Splunk={};Splunk.namespace=function(name){for(var parts=name.split("."),obj=Splunk,i="Splunk"==parts[0]?1:0;i<parts.length;i+=1){obj[parts[i]]=obj[parts[i]]||{};obj=obj[parts[i]]}return obj};define("splunk",function(global){return function(){var ret;return ret||global.Splunk}}(this));define("splunk.config",[],function(){return window.$C});Splunk.namespace("util");Splunk.util={logger:{info:function(){},log:function(){},debug:function(){},warn:function(){},error:function(){}},propToQueryString:function(dictionary){var val,o=[];for(var prop in dictionary){val=dictionary[prop];o.push(encodeURIComponent(prop)+"="+encodeURIComponent(val))}return o.join("&")},queryStringToProp:function(args){args=this.trim(args,"&?#");if(!args||0==args.length)return{};for(var key,value,equalsSegments,parts=args.split("&"),output={},lim=parts.length,i=0,l=lim;l>i;i++){equalsSegments=parts[i].split("=");key=decodeURIComponent(equalsSegments.shift());value=equalsSegments.join("=");output[key]=decodeURIComponent(value.replace(/\+/g," "))}return output},getHash:function(){var hashPos=window.location.href.indexOf("#");if(-1==hashPos)return"";var qPos=window.location.href.indexOf("?",hashPos);return window.location.href.substr(-1!=qPos?qPos:hashPos)},parseDate:function(str,fmt){if(!str||!str.indexOf||0==str.indexOf("mm"))return null;var y=0,m=-1,d=0,a=str.split(/\W+/),b=fmt.match(/%./g),i=0,hr=0,min=0,sec=0;for(i=0;i<a.length;++i)if(a[i])switch(b[i]){case"%d":d=parseInt(a[i],10);break;case"%m":m=parseInt(a[i],10)-1;break;case"%Y":case"%y":y=parseInt(a[i],10);100>y&&(y+=y>29?1900:2e3);break;case"%H":hr=parseInt(a[i],10);break;case"%M":min=parseInt(a[i],10);break;case"%S":sec=parseInt(a[i],10)}if(0!=y&&-1!=m&&0!=d){var ourDate=new Date(y,m,d,hr,min,sec);return ourDate}return!1},getTimezoneOffsetDelta:function(serverOffsetThen,d){if(!Splunk.util.isInt(serverOffsetThen))return 0;var clientOffsetThen=60*d.getTimezoneOffset();serverOffsetThen=-60*serverOffsetThen;return 1e3*(serverOffsetThen-clientOffsetThen)},getEpochTimeFromISO:function(isoStr){this._isoTimeRegex||(this._isoTimeRegex=/([\+\-])?(\d{4,})(?:(?:\-(\d{2}))(?:(?:\-(\d{2}))(?:(?:[T ](\d{2}))(?:(?:\:(\d{2}))(?:(?:\:(\d{2}(?:\.\d+)?)))?)?(?:(Z)|([\+\-])(\d{2})(?:\:(\d{2}))?)?)?)?)?/);var m=this._isoTimeRegex.exec(isoStr),seconds,millisecondsStr;if(m[7]){seconds=m[7].substring(0,2);millisecondsStr=m[7].substring(2)}else millisecondsStr="";var offset=eval(m[9]+(60*m[10]+parseInt(m[11],10))),str=sprintf("%s/%s/%s %s:%s:%s",m[3],m[4],m[2],m[5],m[6],seconds),t=new Date(str);t.setTime(t.getTime()+this.getTimezoneOffsetDelta(offset,t));var startTime=t.getTime()/1e3;return startTime+millisecondsStr},getConfigValue:function(configKey,optionalDefault){if(window.$C&&window.$C.hasOwnProperty(configKey))return window.$C[configKey];if("FORM_KEY"===configKey)return this.getFormKey();if("undefined"!=typeof optionalDefault)return optionalDefault;throw new Error("getConfigValue - "+configKey+" not set, no default provided")},getCookie:function(name){var cookieValue=null;if(document.cookie&&""!=document.cookie)for(var cookies=document.cookie.split(";"),i=0;i<cookies.length;i++){var cookie=$.trim(cookies[i]);if(cookie.substring(0,name.length+1)==name+"="){cookieValue=decodeURIComponent(cookie.substring(name.length+1));break}}return cookieValue},getFormKey:function(){var cookieName="splunkweb_csrf_token_"+Splunk.util.getConfigValue("MRSPARKLE_PORT_NUMBER",""),cookieValue=Splunk.util.getCookie(cookieName);return cookieValue?cookieValue:""},make_url:function(){for(var seg,len,output="",i=0,l=arguments.length;l>i;i++){seg=arguments[i].toString();len=seg.length;len>1&&"/"==seg.charAt(len-1)&&(seg=seg.substring(0,len-1));output+="/"!=seg.charAt(0)?"/"+seg:seg}if("/"!=output){var segments=output.split("/"),firstseg=segments[1];if("static"==firstseg||"modules"==firstseg){var postfix=output.substring(firstseg.length+2,output.length);output="/"+firstseg+"/@"+window.$C["BUILD_NUMBER"];window.$C["BUILD_PUSH_NUMBER"]&&(output+="."+window.$C["BUILD_PUSH_NUMBER"]);"app"==segments[2]&&(output+=":"+this.getConfigValue("APP_BUILD",0));output+="/"+postfix}}var root=Splunk.util.getConfigValue("MRSPARKLE_ROOT_PATH","/"),djangoRoot=Splunk.util.getConfigValue("DJANGO_ROOT_PATH",""),locale=Splunk.util.getConfigValue("LOCALE","en-US"),combinedPath="";combinedPath=djangoRoot&&output.substring(0,djangoRoot.length)===djangoRoot?output.replace(djangoRoot,djangoRoot+"/"+locale.toLowerCase()):"/"+locale+output;return""==root||"/"==root?combinedPath:root+combinedPath},make_full_url:function(url,options){url=this.make_url(url);options&&(url=url+"?"+this.propToQueryString(options));return url},redirect_to:function(uri,options,windowObj,focus){uri=this.make_full_url(uri,options);windowObj||(windowObj=window);windowObj.document.location=uri;focus&&windowObj.focus&&windowObj.focus()},getCurrentApp:function(){return $(document.body).attr("s:app")||"UNKNOWN_APP"},getCurrentView:function(){return $(document.body).attr("s:view")||"UNKNOWN_VIEW"},getCurrentDisplayView:function(){return $(document.body).attr("s:displayview")||this.getCurrentView()},getAutoCancelInterval:function(){var interval=$(document.body).attr("s:autoCancelInterval");if(!interval){this.logger.error("no autoCancelInterval found. Returning 0");interval=0}return interval},getCurrentViewConfig:function(){return $.extend({},Splunk.ViewConfig)},getPath:function(path){void 0===path&&(path=document.location.pathname);var locale=this.getConfigValue("LOCALE").toString();if(!this.getConfigValue("LOCALE")||-1==path.indexOf(locale))return path;var start=locale.length+path.indexOf(locale);return path.slice(start)},getCumlativeOffsetTop:function(element){return element?element.offsetTop+this.getCumlativeOffsetTop(element.offsetParent):0},getCumlativeOffsetLeft:function(element){return element?element.offsetLeft+this.getCumlativeOffsetLeft(element.offsetParent):0},getPageYOffset:function(){var pageYOffset=0;window.pageYOffset?pageYOffset=window.pageYOffset:document.documentElement&&document.documentElement.scrollTop&&(pageYOffset=document.documentElement.scrollTop);return pageYOffset},getWindowDimensions:function(){return{width:isNaN(window.innerWidth)?document.documentElement.clientWidth||0:window.innerWidth,height:isNaN(window.innerHeight)?document.documentElement.clientHeight||0:window.innerHeight}},getComputedStyleHelper:function(el,styleProperty){if(el.currentStyle)return el.currentStyle[styleProperty];if(window.getComputedStyle){var cssProperty=styleProperty.replace(/([A-Z])/g,"-$1").toLowerCase(),computedStyle=window.getComputedStyle(el,"");return computedStyle.getPropertyValue(cssProperty)}return""},getParameter:function(p,s){s=s||window.location.search;return s?s.indexOf(p+"=")+1?s.split(p+"=")[1].split("&")[0]:null:null},getHEX:function(rgb){var parts=rgb.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/),hex=(parts[1]<<16|parts[2]<<8|parts[3]).toString(16);return"#"+Array(6-hex.length).concat([hex]).toString().replace(/,/g,0)},normalizeColor:function(color){normalizedColor=null;if("#"===color.charAt(0))normalizedColor=4===color.length?color+color.charAt(1)+color.charAt(2)+color.charAt(3):color;else try{normalizedColor=this.getHEX(color)}catch(e){}return normalizedColor},validateCronString:function(cronString){var cronRegEx=/^\s*(\*\/\d+|\*|\d+-\d+|\d+(,\d+)+|\d+)(\s+(\*\/\d+|\*|\d+-\d+|\d+(,\d+)+|\d+)){4}\s*$/;return cronRegEx.test(cronString)?!0:!1},turboInnerHTML:function(target,innerHTML){var targetClone=target.cloneNode(!1);targetClone.innerHTML=innerHTML;target.parentNode.replaceChild(targetClone,target);return targetClone},normalizeBoolean:function(test,strictMode){"string"==typeof test&&(test=test.toLowerCase());switch(test){case!0:case 1:case"1":case"yes":case"on":case"true":return!0;case!1:case 0:case"0":case"no":case"off":case"false":return!1;default:if(strictMode)throw TypeError("Unable to cast value into boolean: "+test);return test}},getCommaFormattedNumber:function(nStr){nStr+="";for(var x=nStr.split("."),x1=x[0],x2=x.length>1?"."+x[1]:"",rgx=/(\d+)(\d{3})/;rgx.test(x1);)x1=x1.replace(rgx,"$1,$2");return x1+x2},reLTrim:/^[\s\t\r\n]+/,reLTrimCommand:/^[\s\t\r\n\|]+/,reRNormalize:/[\s\t\r\n]+$/,addLeadingSearchCommand:function(q,isUserEntered){var workingQ=""+q;workingQ=workingQ.replace(this.reLTrim,"").replace(this.reRNormalize," ");return"|"==workingQ.substring(0,1)?q:!isUserEntered&&"search "==workingQ.substring(0,7)&&workingQ.length>7?q:"search "+workingQ},stripLeadingSearchCommand:function(q){var workingQ=""+q;workingQ=workingQ.replace(this.reLTrimCommand,"");return"search "==workingQ.substring(0,7)?workingQ.substring(7).replace(this.reLTrimCommand,""):q},stringToFieldList:function(strList){if("string"!=typeof strList||!strList)return[];for(var items=[],field_name_buffer=[],inquote=!1,str=$.trim(strList),i=0,j=str.length;j>i;i++)if("\\"!=str.charAt(i))if('"'!=str.charAt(i))if(" "!=str.charAt(i)&&","!=str.charAt(i)||inquote)field_name_buffer.push(str.charAt(i));else{field_name_buffer.length>0&&items.push(field_name_buffer.join(""));field_name_buffer=[]}else{if(inquote){inquote=!1;items.push(field_name_buffer.join(""));field_name_buffer=[];continue}inquote=!0}else{var nextidx=i+1;if(j>nextidx&&("\\"==str.charAt(nextidx)||'"'==str.charAt(nextidx))){field_name_buffer.push(str.charAt(nextidx));i++;continue}field_name_buffer.push(str.charAt(i))}field_name_buffer.length>0&&items.push(field_name_buffer.join(""));return items},_sflQuotable:/([\\",\s])/,_sflEscapable:/([\\"])/g,fieldListToString:function(fieldArray){if(!fieldArray)return"";for(var output=[],i=0,L=fieldArray.length;L>i;i++){var v=$.trim(fieldArray[i]);if(""!=v){v.search(this._sflEscapable)>-1&&(v=v.replace(this._sflEscapable,"\\$1"));v.search(this._sflQuotable)>-1&&(v=['"',v,'"'].join(""));output.push(v)}}return output.join(",")},searchEscape:function(str){return str.match(/[\s\,=|\[\]\"]/)?'"'+str.replace(/(\"|\\)/g,"\\$1")+'"':str},objectSimilarity:function(obj1,obj2){if(obj1 instanceof Array&&obj2 instanceof Array){if(obj1.length!==obj2.length)return!1;for(var i=0;i<obj1.length;i++)if(!this.objectSimilarity(obj1[i],obj2[i]))return!1}else if(obj1 instanceof Object&&obj2 instanceof Object){if(obj1!=obj2){for(var j in obj2)if(!obj1.hasOwnProperty(j))return!1;for(var k in obj1)if(obj1.hasOwnProperty(k)){if(!obj2.hasOwnProperty(k))return!1;
if(!this.objectSimilarity(obj1[k],obj2[k]))return!1}}}else if("function"==typeof obj1&&"function"==typeof obj2){if(obj1.toString()!==obj2.toString())return!1}else if(obj1!==obj2)return!1;return!0},StopWatch:function(){var self=this,startTime=null,stopTime=null,times=[],isSet=function(prop){return null==prop?!1:!0},isStarted=function(){return isSet(startTime)},isStopped=function(){return isSet(stopTime)},softReset=function(){startTime=null;stopTime=null};self.start=function(){if(isStarted())throw new Error("cannot call start, start already invoked.");startTime=new Date};self.stop=function(){if(!isStarted())throw new Error("cannot call stop, start not invoked.");if(isStopped())throw new Error("cannot call stop, stop already invoked.");stopTime=new Date;time=stopTime-startTime;times.push(time)};self.pause=function(){if(!isStarted())throw new Error("cannot call pause, start not invoked.");if(isStopped())throw new Error("cannot call pause, stop already invoked.");self.stop();softReset()};self.reset=function(){softReset();times=[]};self.time=function(){var total=0;for(i=0;i<times.length;i++)total+=times[i];isStarted()&&!isStopped()&&(total+=new Date-startTime);return total/1e3}},isInt:function(num){return""!==num&&!isNaN(parseInt(num,10))&&parseInt(num,10)==num/1},smartTrim:function(string,maxLength){if(!string)return string;if(1>maxLength)return string;if(string.length<=maxLength)return string;if(1==maxLength)return string.substring(0,1)+"...";var midpoint=Math.ceil(string.length/2),toremove=string.length-maxLength,lstrip=Math.ceil(toremove/2),rstrip=toremove-lstrip;return string.substring(0,midpoint-lstrip)+"..."+string.substring(midpoint+rstrip)},_tokenDiscoverer:/\$([^$]+)\$/g,discoverReplacementTokens:function(fragment){var keysToAdd,keys=[],tokenDiscoverer=Splunk.util._tokenDiscoverer;if("string"==typeof fragment){if(fragment.match(tokenDiscoverer)){keysToAdd=fragment.match(tokenDiscoverer);for(var i=0;i<keysToAdd.length;i++)keysToAdd[i]=keysToAdd[i].substring(1,keysToAdd[i].length-1);return keysToAdd}return[]}if("function"==typeof fragment)return[];for(var key in fragment){keysToAdd=[];keysToAdd=Splunk.util.discoverReplacementTokens(fragment[key]);for(var matchesInTheKeyItself=key.match(tokenDiscoverer)||[],j=0;j<matchesInTheKeyItself.length;j++)keysToAdd.push(matchesInTheKeyItself[j].substring(1,matchesInTheKeyItself[j].length-1));for(var k=0;k<keysToAdd.length;k++)-1==keys.indexOf(keysToAdd[k])&&keys.push(keysToAdd[k])}return keys},replaceTokens:function(fragment,reg,value){if("string"==typeof fragment){fragment.match(reg)&&(fragment=fragment.replace(reg,value));return fragment}if("function"==typeof fragment)return fragment;var keysToRename={};for(var key in fragment){"object"==typeof fragment[key]?Splunk.util.replaceTokens(fragment[key],reg,value):"string"==typeof fragment[key]&&fragment[key].match(reg)&&(fragment[key]=fragment[key].replace(reg,value));key.match(reg)&&(keysToRename[key]=key.replace(reg,value))}for(var oldKey in keysToRename){var newKey=keysToRename[oldKey];fragment[newKey]=fragment[oldKey];delete fragment[oldKey]}return fragment},getServerTimezoneOffset:function(){return Splunk.util.getConfigValue("SERVER_TIMEZONE_OFFSET")},moduleLoadStates:{WAITING_FOR_INITIALIZATION:1,WAITING_FOR_HIERARCHY:2,WAITING_FOR_CONTEXT:6,HAS_CONTEXT:7},getRetryInterval:function(elapsed_time,min_interval,max_interval,clamp_time){return elapsed_time>=clamp_time?parseFloat(max_interval):Math.min(max_interval*Math.pow(elapsed_time/parseFloat(clamp_time),3)+min_interval,max_interval)},escapeHtml:function(input){return(""+input).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")},escapeBackslash:function(input){return(""+input).replace(/\\/g,"\\\\")},escapeRegex:function(input){return(input+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")},escapeSelector:function(input){return(""+input).replace(/([;&,\.\+\*\~':"\!\^#$%@\[\]\(\)=>\|])/g,"\\$1")},trimToAlphaNumeric:function(input){return(""+input).replace(/([\s;&,\.\+\*\~':"\!\^#$%@\[\]\(\)=<>`\/\|\\])/g,"")},trim:function(str,delim){return delim?str.replace(new RegExp("^[\\s"+delim+"]+"),"").replace(new RegExp("[\\s"+delim+"]+$"),""):str.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},lowerTrimStr:function(str,defValue){return str?this.trim(str).toLowerCase():defValue?defValue:str},focusFirstField:function(popup){var firstInput=$(":input:visible:enabled:first",popup),firstSelect=$("select:visible:enabled:first",popup);firstInput.is(":button")&&firstInput.hasClass("splButton-secondary")&&$(":input:button.splButton-primary:first",popup).length&&(firstInput=$(":input:button.splButton-primary:first",popup));var firstInputOffset=firstInput.length?firstInput.offset().top:!1,firstSelectOffset=firstSelect.length?firstSelect.offset().top:!1,firstElem=firstInput;firstInputOffset&&firstSelectOffset&&firstInputOffset>firstSelectOffset&&(firstElem=firstSelect);firstElem.focus();var isFirstElemFocused=firstElem.is(":focus");isFirstElemFocused||setTimeout(function(){firstElem.focus()},10)},getWikiTransform:function(str){var text=Splunk.util.escapeHtml(str);text=text.replace(/\[(\!?)(\w+\:\/\/[^\s]+)\s+([^\]]+)\]/g,'<a href="$2" #~#$1#~#>$3</a>');text=text.replace(/\[\[(\!?)([^\|]+)\|([^\]]+)\]\]/g,Splunk.util._generateInternalLink);text=text.replace(/#~#!#~#/g,'target="_blank"');text=text.replace(/\s*#~##~#/g,"");return text},_generateInternalLink:function(str,blank_token,url,text){url=Splunk.util.make_url(url);return'<a href="'+url+'"#~#'+blank_token+"#~#>"+text+"</a>"},findMatchIndices:function(rex,source){for(var matches=source.match(rex),index=0,results=[],length=matches.length,i=0;length>i;i++){var match=matches[i];index=source.indexOf(match,index);-1!=index&&results.push({match:match,start:index,end:index+match.length-1});index++}return results}};if(!Function.prototype.bind){var $A=function(iterable){if(!iterable)return[];if(iterable.toArray)return iterable.toArray();for(var results=[],i=0,length=iterable.length;length>i;i++)results.push(iterable[i]);return results};Function.prototype.bind=function(){var __method=this,args=$A(arguments),object=args.shift();return function(){return __method.apply(object,args.concat($A(arguments)))}}}String.prototype.repeat||(String.prototype.repeat=function(count){return new Array(count+1).join(this)});String.prototype.reverse||(String.prototype.reverse=function(){return this.split("").reverse().join("")});String.prototype.rsplit||(String.prototype.rsplit=function(sep,limit){var sp=this.split(sep);if(limit&&sp.length>limit){for(var r=[],i=0;limit>i;i++)r[i]=sp[sp.length-limit+i];return r}return sp});Array.prototype.indexOf||(Array.prototype.indexOf=function(search,fromIndex){fromIndex||(fromIndex=0);for(var i=0;i<this.length;i++)if(this[i]===search)return i;return-1});Array.prototype.extend||(Array.prototype.extend=function(arr){for(var i=0;i<arr.length;i++)this.push(arr[i])});define("splunk.util",["jquery","splunk","splunk.config"],function(global){return function(){var ret,fn;fn=function($,Splunk){return $.extend({sprintf:this.sprintf},Splunk.util)};ret=fn.apply(global,arguments);return ret||global.Splunk.util}}(this));define("splunk.i18n",["strftime","splunk.util"],function(){if(window.locale_name()in{ko_KR:!0,zh_CN:!0,zh_TW:!0}){window._i18n_locale.date_formats["short"]={pattern:"yy/MM/dd",format:"%(yy)s/%(MM)s/%(dd)s"};window._i18n_locale.date_formats["medium"]={pattern:"yyyy/MM/dd",format:"%(yyyy)s/%(MM)s/%(dd)s"};window._i18n_locale.time_formats["short"]={pattern:"H:mm",format:"%(H)s:%(mm)s"};window._i18n_locale.time_formats["medium"]={pattern:"H:mm:ss",format:"%(H)s:%(mm)s:%(ss)s"}}var asianLanguageDateReplacements=[[/^ccc MMM d$/,"M/d (ccc)"],[/^YYYY-MM/,"YYYY/MM"],[/MM-dd/,"MM/dd"]],FORMAT_DATE_REPLACEMENTS={ja_JP:asianLanguageDateReplacements,ko_KR:asianLanguageDateReplacements,zh_CN:asianLanguageDateReplacements,zh_TW:asianLanguageDateReplacements},DAY_FIRST_FORMATS=[["MMM d","d MMM"]],oldFormatDate=window.format_date;window.format_date=function(date,format){format=format||"medium";var i,replacements,locale=window.locale_name();if(format&&"string"==typeof format&&window.locale_uses_day_before_month()){replacements=DAY_FIRST_FORMATS;for(i=0;i<replacements.length;i++)format=format.replace(replacements[i][0],replacements[i][1])}if(format&&"string"==typeof format&&locale in FORMAT_DATE_REPLACEMENTS){replacements=FORMAT_DATE_REPLACEMENTS[locale];for(i=0;i<replacements.length;i++){var replacement=replacements[i];format=format.replace(replacement[0],replacement[1])}}return oldFormatDate(date,format)};return{_:window.gettext,ungettext:window.ungettext,format_decimal:window.format_decimal,format_number:window.format_number,format_percent:window.format_percent,format_scientific:window.format_scientific,format_date:window.format_date,format_datetime:window.format_datetime,format_time:window.format_time,format_datetime_microseconds:window.format_datetime_microseconds,format_time_microseconds:window.format_time_microseconds,locale_uses_day_before_month:window.locale_uses_day_before_month,format_datetime_range:window.format_datetime_range,locale_name:window.locale_name,DateTime:window.DateTime,moment_install:window.moment_install,jQuery_ui_datepicker_install:window.jQuery_ui_datepicker_install}});(function(){function baseIndexOf(array,value,fromIndex){for(var index=(fromIndex||0)-1,length=array?array.length:0;++index<length;)if(array[index]===value)return index;return-1}function compareAscending(a,b){var ac=a.criteria,bc=b.criteria;if(ac!==bc){if(ac>bc||"undefined"==typeof ac)return 1;if(bc>ac||"undefined"==typeof bc)return-1}return a.index-b.index}function escapeStringChar(match){return"\\"+stringEscapes[match]}function noop(){}function lodash(value){return value instanceof lodash?value:new lodashWrapper(value)}function lodashWrapper(value,chainAll){this.__chain__=!!chainAll;this.__wrapped__=value}function baseCreateCallback(func,thisArg,argCount){if("function"!=typeof func)return identity;if("undefined"==typeof thisArg)return func;switch(argCount){case 1:return function(value){return func.call(thisArg,value)};case 2:return function(a,b){return func.call(thisArg,a,b)};case 3:return function(value,index,collection){return func.call(thisArg,value,index,collection)};case 4:return function(accumulator,value,index,collection){return func.call(thisArg,accumulator,value,index,collection)}}return bind(func,thisArg)}function baseFlatten(array,isShallow,isArgArrays,fromIndex){for(var index=(fromIndex||0)-1,length=array?array.length:0,result=[];++index<length;){var value=array[index];if(value&&"object"==typeof value&&"number"==typeof value.length&&(isArray(value)||isArguments(value))){isShallow||(value=baseFlatten(value,isShallow,isArgArrays));var valIndex=-1,valLength=value.length,resIndex=result.length;result.length+=valLength;for(;++valIndex<valLength;)result[resIndex++]=value[valIndex]}else isArgArrays||result.push(value)}return result}function baseIsEqual(a,b,stackA,stackB){if(a===b)return 0!==a||1/a==1/b;var type=typeof a,otherType=typeof b;if(!(a!==a||a&&objectTypes[type]||b&&objectTypes[otherType]))return!1;if(null==a||null==b)return a===b;var className=toString.call(a),otherClass=toString.call(b);if(className!=otherClass)return!1;switch(className){case boolClass:case dateClass:return+a==+b;case numberClass:return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case regexpClass:case stringClass:return a==String(b)}var isArr=className==arrayClass;if(!isArr){if(hasOwnProperty.call(a,"__wrapped__ ")||b instanceof lodash)return baseIsEqual(a.__wrapped__||a,b.__wrapped__||b,stackA,stackB);if(className!=objectClass)return!1;var ctorA=a.constructor,ctorB=b.constructor;if(ctorA!=ctorB&&!(isFunction(ctorA)&&ctorA instanceof ctorA&&isFunction(ctorB)&&ctorB instanceof ctorB))return!1}stackA||(stackA=[]);stackB||(stackB=[]);for(var length=stackA.length;length--;)if(stackA[length]==a)return stackB[length]==b;var result=!0,size=0;stackA.push(a);stackB.push(b);if(isArr){size=b.length;result=size==a.length;if(result)for(;size--&&(result=baseIsEqual(a[size],b[size],stackA,stackB)););return result}forIn(b,function(value,key,b){if(hasOwnProperty.call(b,key)){size++;return!(result=hasOwnProperty.call(a,key)&&baseIsEqual(a[key],value,stackA,stackB))&&indicatorObject}});result&&forIn(a,function(value,key,a){return hasOwnProperty.call(a,key)?!(result=--size>-1)&&indicatorObject:void 0});return result}function baseUniq(array,isSorted,callback){for(var index=-1,indexOf=getIndexOf(),length=array?array.length:0,result=[],seen=callback?[]:result;++index<length;){var value=array[index],computed=callback?callback(value,index,array):value;if(isSorted?!index||seen[seen.length-1]!==computed:indexOf(seen,computed)<0){callback&&seen.push(computed);result.push(value)}}return result}function createAggregator(setter){return function(collection,callback,thisArg){var result={};callback=createCallback(callback,thisArg,3);var index=-1,length=collection?collection.length:0;if("number"==typeof length)for(;++index<length;){var value=collection[index];setter(result,value,callback(value,index,collection),collection)}else forOwn(collection,function(value,key,collection){setter(result,value,callback(value,key,collection),collection)});return result}}function createBound(func,bitmask,partialArgs,partialRightArgs,thisArg,arity){var isBind=1&bitmask,isBindKey=2&bitmask,isCurry=4&bitmask,isCurryBound=8&bitmask,isPartial=16&bitmask,isPartialRight=32&bitmask,key=func;if(!isBindKey&&!isFunction(func))throw new TypeError;if(isPartial&&!partialArgs.length){bitmask&=-17;isPartial=partialArgs=!1}if(isPartialRight&&!partialRightArgs.length){bitmask&=-33;isPartialRight=partialRightArgs=!1}if(isBind&&!(isBindKey||isCurry||isPartialRight)&&(support.fastBind||nativeBind&&isPartial)){if(isPartial){var args=[thisArg];push.apply(args,partialArgs)}var bound=isPartial?nativeBind.apply(func,args):nativeBind.call(func,thisArg)}else bound=function(){var args=arguments,thisBinding=isBind?thisArg:this;if(isCurry||isPartial||isPartialRight){args=nativeSlice.call(args);isPartial&&unshift.apply(args,partialArgs);isPartialRight&&push.apply(args,partialRightArgs);if(isCurry&&args.length<arity){bitmask|=16;return createBound(func,isCurryBound?bitmask:-4&bitmask,args,null,thisArg,arity)}}isBindKey&&(func=thisBinding[key]);if(this instanceof bound){thisBinding=createObject(func.prototype);var result=func.apply(thisBinding,args);return isObject(result)?result:thisBinding}return func.apply(thisBinding,args)};return bound}function createObject(prototype){return isObject(prototype)?nativeCreate(prototype):{}}function escapeHtmlChar(match){return htmlEscapes[match]}function getIndexOf(){var result=(result=lodash.indexOf)===indexOf?baseIndexOf:result;return result}function unescapeHtmlChar(match){return htmlUnescapes[match]}function isArguments(value){return value&&"object"==typeof value&&"number"==typeof value.length&&toString.call(value)==argsClass||!1}function assign(object){if(!object)return object;for(var argsIndex=1,argsLength=arguments.length;argsLength>argsIndex;argsIndex++){var iterable=arguments[argsIndex];if(iterable)for(var key in iterable)object[key]=iterable[key]}return object}function clone(value){return isObject(value)?isArray(value)?nativeSlice.call(value):assign({},value):value}function defaults(object){if(!object)return object;for(var argsIndex=1,argsLength=arguments.length;argsLength>argsIndex;argsIndex++){var iterable=arguments[argsIndex];if(iterable)for(var key in iterable)"undefined"==typeof object[key]&&(object[key]=iterable[key])}return object}function functions(object){var result=[];forIn(object,function(value,key){isFunction(value)&&result.push(key)});return result.sort()}function has(object,property){return object?hasOwnProperty.call(object,property):!1}function invert(object){for(var index=-1,props=keys(object),length=props.length,result={};++index<length;){var key=props[index];result[object[key]]=key}return result}function isBoolean(value){return value===!0||value===!1||toString.call(value)==boolClass}function isDate(value){return value?"object"==typeof value&&toString.call(value)==dateClass:!1}function isElement(value){return value?1===value.nodeType:!1}function isEmpty(value){if(!value)return!0;if(isArray(value)||isString(value))return!value.length;for(var key in value)if(hasOwnProperty.call(value,key))return!1;return!0}function isEqual(a,b){return baseIsEqual(a,b)}function isFinite(value){return nativeIsFinite(value)&&!nativeIsNaN(parseFloat(value))}function isFunction(value){return"function"==typeof value}function isObject(value){return!(!value||!objectTypes[typeof value])}function isNaN(value){return isNumber(value)&&value!=+value}function isNull(value){return null===value}function isNumber(value){return"number"==typeof value||toString.call(value)==numberClass}function isRegExp(value){return value&&objectTypes[typeof value]?toString.call(value)==regexpClass:!1}function isString(value){return"string"==typeof value||toString.call(value)==stringClass}function isUndefined(value){return"undefined"==typeof value}function omit(object){var indexOf=getIndexOf(),props=baseFlatten(arguments,!0,!1,1),result={};forIn(object,function(value,key){indexOf(props,key)<0&&(result[key]=value)});return result}function pairs(object){for(var index=-1,props=keys(object),length=props.length,result=Array(length);++index<length;){var key=props[index];result[index]=[key,object[key]]}return result}function pick(object){for(var index=-1,props=baseFlatten(arguments,!0,!1,1),length=props.length,result={};++index<length;){var prop=props[index];prop in object&&(result[prop]=object[prop])}return result}function values(object){for(var index=-1,props=keys(object),length=props.length,result=Array(length);++index<length;)result[index]=object[props[index]];return result}function contains(collection,target){var indexOf=getIndexOf(),length=collection?collection.length:0,result=!1;length&&"number"==typeof length?result=indexOf(collection,target)>-1:forOwn(collection,function(value){return(result=value===target)&&indicatorObject});return result}function every(collection,callback,thisArg){var result=!0;callback=createCallback(callback,thisArg,3);var index=-1,length=collection?collection.length:0;if("number"==typeof length)for(;++index<length&&(result=!!callback(collection[index],index,collection)););else forOwn(collection,function(value,index,collection){return!(result=!!callback(value,index,collection))&&indicatorObject});return result}function filter(collection,callback,thisArg){var result=[];callback=createCallback(callback,thisArg,3);var index=-1,length=collection?collection.length:0;if("number"==typeof length)for(;++index<length;){var value=collection[index];callback(value,index,collection)&&result.push(value)}else forOwn(collection,function(value,index,collection){callback(value,index,collection)&&result.push(value)});return result}function find(collection,callback,thisArg){callback=createCallback(callback,thisArg,3);var index=-1,length=collection?collection.length:0;if("number"!=typeof length){var result;forOwn(collection,function(value,index,collection){if(callback(value,index,collection)){result=value;return indicatorObject}});return result}for(;++index<length;){var value=collection[index];if(callback(value,index,collection))return value}}function findWhere(object,properties){return where(object,properties,!0)}function forEach(collection,callback,thisArg){var index=-1,length=collection?collection.length:0;callback=callback&&"undefined"==typeof thisArg?callback:baseCreateCallback(callback,thisArg,3);if("number"==typeof length)for(;++index<length&&callback(collection[index],index,collection)!==indicatorObject;);else forOwn(collection,callback)}function forEachRight(collection,callback){var length=collection?collection.length:0;if("number"==typeof length)for(;length--&&callback(collection[length],length,collection)!==!1;);else{var props=keys(collection);length=props.length;forOwn(collection,function(value,key,collection){key=props?props[--length]:--length;return callback(collection[key],key,collection)===!1&&indicatorObject})}}function invoke(collection,methodName){var args=nativeSlice.call(arguments,2),index=-1,isFunc="function"==typeof methodName,length=collection?collection.length:0,result=Array("number"==typeof length?length:0);forEach(collection,function(value){result[++index]=(isFunc?methodName:value[methodName]).apply(value,args)});return result}function map(collection,callback,thisArg){var index=-1,length=collection?collection.length:0;callback=createCallback(callback,thisArg,3);if("number"==typeof length)for(var result=Array(length);++index<length;)result[index]=callback(collection[index],index,collection);else{result=[];forOwn(collection,function(value,key,collection){result[++index]=callback(value,key,collection)})}return result}function max(collection,callback,thisArg){var computed=-1/0,result=computed,index=-1,length=collection?collection.length:0;if(callback||"number"!=typeof length){callback=createCallback(callback,thisArg,3);forEach(collection,function(value,index,collection){var current=callback(value,index,collection);if(current>computed){computed=current;result=value}})}else for(;++index<length;){var value=collection[index];value>result&&(result=value)}return result}function min(collection,callback,thisArg){var computed=1/0,result=computed,index=-1,length=collection?collection.length:0;if(callback||"number"!=typeof length){callback=createCallback(callback,thisArg,3);forEach(collection,function(value,index,collection){var current=callback(value,index,collection);if(computed>current){computed=current;result=value}})}else for(;++index<length;){var value=collection[index];result>value&&(result=value)}return result}function pluck(collection,property){var index=-1,length=collection?collection.length:0;if("number"==typeof length)for(var result=Array(length);++index<length;)result[index]=collection[index][property];return result||map(collection,property)}function reduce(collection,callback,accumulator,thisArg){if(!collection)return accumulator;var noaccum=arguments.length<3;callback=baseCreateCallback(callback,thisArg,4);var index=-1,length=collection.length;if("number"==typeof length){noaccum&&(accumulator=collection[++index]);for(;++index<length;)accumulator=callback(accumulator,collection[index],index,collection)}else forOwn(collection,function(value,index,collection){accumulator=noaccum?(noaccum=!1,value):callback(accumulator,value,index,collection)});return accumulator}function reduceRight(collection,callback,accumulator,thisArg){var noaccum=arguments.length<3;callback=baseCreateCallback(callback,thisArg,4);forEachRight(collection,function(value,index,collection){accumulator=noaccum?(noaccum=!1,value):callback(accumulator,value,index,collection)});return accumulator}function reject(collection,callback,thisArg){callback=createCallback(callback,thisArg,3);return filter(collection,function(value,index,collection){return!callback(value,index,collection)})}function sample(collection,n,guard){var length=collection?collection.length:0;"number"!=typeof length&&(collection=values(collection));if(null==n||guard)return collection?collection[random(length-1)]:undefined;var result=shuffle(collection);result.length=nativeMin(nativeMax(0,n),result.length);return result}function shuffle(collection){var index=-1,length=collection?collection.length:0,result=Array("number"==typeof length?length:0);forEach(collection,function(value){var rand=random(++index);result[index]=result[rand];result[rand]=value});return result}function size(collection){var length=collection?collection.length:0;return"number"==typeof length?length:keys(collection).length}function some(collection,callback,thisArg){var result;callback=createCallback(callback,thisArg,3);var index=-1,length=collection?collection.length:0;if("number"==typeof length)for(;++index<length&&!(result=callback(collection[index],index,collection)););else forOwn(collection,function(value,index,collection){return(result=callback(value,index,collection))&&indicatorObject});return!!result}function sortBy(collection,callback,thisArg){var index=-1,length=collection?collection.length:0,result=Array("number"==typeof length?length:0);callback=createCallback(callback,thisArg,3);forEach(collection,function(value,key,collection){result[++index]={criteria:callback(value,key,collection),index:index,value:value}});length=result.length;result.sort(compareAscending);for(;length--;)result[length]=result[length].value;return result}function toArray(collection){return isArray(collection)?nativeSlice.call(collection):collection&&"number"==typeof collection.length?map(collection):values(collection)}function where(collection,properties,first){return first&&isEmpty(properties)?undefined:(first?find:filter)(collection,properties)}function compact(array){for(var index=-1,length=array?array.length:0,result=[];++index<length;){var value=array[index];value&&result.push(value)}return result}function difference(array){for(var index=-1,indexOf=getIndexOf(),length=array.length,flattened=baseFlatten(arguments,!0,!0,1),result=[];++index<length;){var value=array[index];indexOf(flattened,value)<0&&result.push(value)}return result}function first(array,callback,thisArg){var n=0,length=array?array.length:0;if("number"!=typeof callback&&null!=callback){var index=-1;callback=createCallback(callback,thisArg,3);for(;++index<length&&callback(array[index],index,array);)n++}else{n=callback;if(null==n||thisArg)return array?array[0]:undefined}return nativeSlice.call(array,0,nativeMin(nativeMax(0,n),length))}function flatten(array,isShallow){return baseFlatten(array,isShallow)}function indexOf(array,value,fromIndex){if("number"==typeof fromIndex){var length=array?array.length:0;fromIndex=0>fromIndex?nativeMax(0,length+fromIndex):fromIndex||0}else if(fromIndex){var index=sortedIndex(array,value);return array[index]===value?index:-1}return baseIndexOf(array,value,fromIndex)}function initial(array,callback,thisArg){var n=0,length=array?array.length:0;if("number"!=typeof callback&&null!=callback){var index=length;callback=createCallback(callback,thisArg,3);for(;index--&&callback(array[index],index,array);)n++}else n=null==callback||thisArg?1:callback||n;return nativeSlice.call(array,0,nativeMin(nativeMax(0,length-n),length))}function intersection(array){var args=arguments,argsLength=args.length,index=-1,indexOf=getIndexOf(),length=array?array.length:0,result=[];outer:for(;++index<length;){var value=array[index];if(indexOf(result,value)<0){for(var argsIndex=argsLength;--argsIndex;)if(indexOf(args[argsIndex],value)<0)continue outer;result.push(value)}}return result}function last(array,callback,thisArg){var n=0,length=array?array.length:0;if("number"!=typeof callback&&null!=callback){var index=length;callback=createCallback(callback,thisArg,3);for(;index--&&callback(array[index],index,array);)n++}else{n=callback;if(null==n||thisArg)return array?array[length-1]:undefined}return nativeSlice.call(array,nativeMax(0,length-n))}function lastIndexOf(array,value,fromIndex){var index=array?array.length:0;"number"==typeof fromIndex&&(index=(0>fromIndex?nativeMax(0,index+fromIndex):nativeMin(fromIndex,index-1))+1);for(;index--;)if(array[index]===value)return index;return-1}function range(start,end,step){start=+start||0;step=+step||1;if(null==end){end=start;start=0}for(var index=-1,length=nativeMax(0,ceil((end-start)/step)),result=Array(length);++index<length;){result[index]=start;start+=step}return result}function rest(array,callback,thisArg){if("number"!=typeof callback&&null!=callback){var n=0,index=-1,length=array?array.length:0;callback=createCallback(callback,thisArg,3);for(;++index<length&&callback(array[index],index,array);)n++}else n=null==callback||thisArg?1:nativeMax(0,callback);return nativeSlice.call(array,n)}function sortedIndex(array,value,callback,thisArg){var low=0,high=array?array.length:low;callback=callback?createCallback(callback,thisArg,1):identity;value=callback(value);for(;high>low;){var mid=low+high>>>1;callback(array[mid])<value?low=mid+1:high=mid}return low}function union(){return baseUniq(baseFlatten(arguments,!0,!0))}function uniq(array,isSorted,callback,thisArg){if("boolean"!=typeof isSorted&&null!=isSorted){thisArg=callback;callback=thisArg&&thisArg[isSorted]===array?null:isSorted;isSorted=!1}null!=callback&&(callback=createCallback(callback,thisArg,3));return baseUniq(array,isSorted,callback)}function without(array){return difference(array,nativeSlice.call(arguments,1))}function zip(){for(var index=-1,length=max(pluck(arguments,"length")),result=Array(0>length?0:length);++index<length;)result[index]=pluck(arguments,index);return result}function zipObject(keys,values){for(var index=-1,length=keys?keys.length:0,result={};++index<length;){var key=keys[index];values?result[key]=values[index]:key&&(result[key[0]]=key[1])}return result}function after(n,func){if(!isFunction(func))throw new TypeError;return function(){return--n<1?func.apply(this,arguments):void 0}}function bind(func,thisArg){return arguments.length>2?createBound(func,17,nativeSlice.call(arguments,2),null,thisArg):createBound(func,1,null,null,thisArg)}function bindAll(object){for(var funcs=arguments.length>1?baseFlatten(arguments,!0,!1,1):functions(object),index=-1,length=funcs.length;++index<length;){var key=funcs[index];object[key]=createBound(object[key],1,null,null,object)}return object}function compose(){for(var funcs=arguments,length=funcs.length;length--;)if(!isFunction(funcs[length]))throw new TypeError;return function(){for(var args=arguments,length=funcs.length;length--;)args=[funcs[length].apply(this,args)];return args[0]}}function createCallback(func,thisArg,argCount){var type=typeof func;if(null==func||"function"==type)return baseCreateCallback(func,thisArg,argCount);if("object"!=type)return function(object){return object[func]};var props=keys(func);return function(object){for(var length=props.length,result=!1;length--&&(result=object[props[length]]===func[props[length]]););return result}}function debounce(func,wait,options){var args,maxTimeoutId,result,stamp,thisArg,timeoutId,trailingCall,lastCalled=0,maxWait=!1,trailing=!0;if(!isFunction(func))throw new TypeError;wait=nativeMax(0,wait)||0;if(options===!0){var leading=!0;trailing=!1}else if(isObject(options)){leading=options.leading;maxWait="maxWait"in options&&(nativeMax(wait,options.maxWait)||0);trailing="trailing"in options?options.trailing:trailing}var delayed=function(){var remaining=wait-(now()-stamp);if(0>=remaining){maxTimeoutId&&clearTimeout(maxTimeoutId);var isCalled=trailingCall;maxTimeoutId=timeoutId=trailingCall=undefined;if(isCalled){lastCalled=now();result=func.apply(thisArg,args)}}else timeoutId=setTimeout(delayed,remaining)},maxDelayed=function(){timeoutId&&clearTimeout(timeoutId);maxTimeoutId=timeoutId=trailingCall=undefined;if(trailing||maxWait!==wait){lastCalled=now();result=func.apply(thisArg,args)}};return function(){args=arguments;stamp=now();thisArg=this;trailingCall=trailing&&(timeoutId||!leading);if(maxWait===!1)var leadingCall=leading&&!timeoutId;else{maxTimeoutId||leading||(lastCalled=stamp);var remaining=maxWait-(stamp-lastCalled);if(0>=remaining){maxTimeoutId&&(maxTimeoutId=clearTimeout(maxTimeoutId));lastCalled=stamp;result=func.apply(thisArg,args)}else maxTimeoutId||(maxTimeoutId=setTimeout(maxDelayed,remaining))}timeoutId||wait===maxWait||(timeoutId=setTimeout(delayed,wait));leadingCall&&(result=func.apply(thisArg,args));return result}}function defer(func){if(!isFunction(func))throw new TypeError;var args=nativeSlice.call(arguments,1);return setTimeout(function(){func.apply(undefined,args)},1)}function delay(func,wait){if(!isFunction(func))throw new TypeError;var args=nativeSlice.call(arguments,2);return setTimeout(function(){func.apply(undefined,args)},wait)}function memoize(func,resolver){var cache={};return function(){var key=resolver?resolver.apply(this,arguments):keyPrefix+arguments[0];return hasOwnProperty.call(cache,key)?cache[key]:cache[key]=func.apply(this,arguments)
}}function once(func){var ran,result;if(!isFunction(func))throw new TypeError;return function(){if(ran)return result;ran=!0;result=func.apply(this,arguments);func=null;return result}}function partial(func){return createBound(func,16,nativeSlice.call(arguments,1))}function throttle(func,wait,options){var leading=!0,trailing=!0;if(!isFunction(func))throw new TypeError;if(options===!1)leading=!1;else if(isObject(options)){leading="leading"in options?options.leading:leading;trailing="trailing"in options?options.trailing:trailing}options={};options.leading=leading;options.maxWait=wait;options.trailing=trailing;return debounce(func,wait,options)}function wrap(value,wrapper){if(!isFunction(wrapper))throw new TypeError;return function(){var args=[value];push.apply(args,arguments);return wrapper.apply(this,args)}}function escape(string){return null==string?"":String(string).replace(reUnescapedHtml,escapeHtmlChar)}function identity(value){return value}function mixin(object){forEach(functions(object),function(methodName){var func=lodash[methodName]=object[methodName];lodash.prototype[methodName]=function(){var args=[this.__wrapped__];push.apply(args,arguments);var result=func.apply(lodash,args);if(this.__chain__){result=new lodashWrapper(result);result.__chain__=!0}return result}})}function noConflict(){root._=oldDash;return this}function random(min,max){null==min&&null==max&&(max=1);min=+min||0;if(null==max){max=min;min=0}else max=+max||0;return min+floor(nativeRandom()*(max-min+1))}function result(object,property){if(object){var value=object[property];return isFunction(value)?object[property]():value}}function template(text,data,options){var _=lodash,settings=_.templateSettings;text||(text="");options=defaults({},options,settings);var index=0,source="__p += '",variable=options.variable,reDelimiters=RegExp((options.escape||reNoMatch).source+"|"+(options.interpolate||reNoMatch).source+"|"+(options.evaluate||reNoMatch).source+"|$","g");text.replace(reDelimiters,function(match,escapeValue,interpolateValue,evaluateValue,offset){source+=text.slice(index,offset).replace(reUnescapedString,escapeStringChar);escapeValue&&(source+="' +\n_.escape("+escapeValue+") +\n'");evaluateValue&&(source+="';\n"+evaluateValue+";\n__p += '");interpolateValue&&(source+="' +\n((__t = ("+interpolateValue+")) == null ? '' : __t) +\n'");index=offset+match.length;return match});source+="';\n";if(!variable){variable="obj";source="with ("+variable+" || {}) {\n"+source+"\n}\n"}source="function("+variable+") {\nvar __t, __p = '', __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n"+source+"return __p\n}";try{var result=Function("_","return "+source)(_)}catch(e){e.source=source;throw e}if(data)return result(data);result.source=source;return result}function times(n,callback,thisArg){n=(n=+n)>-1?n:0;var index=-1,result=Array(n);callback=baseCreateCallback(callback,thisArg,1);for(;++index<n;)result[index]=callback(index);return result}function unescape(string){return null==string?"":String(string).replace(reEscapedHtml,unescapeHtmlChar)}function uniqueId(prefix){var id=++idCounter+"";return prefix?prefix+id:id}function chain(value){value=new lodashWrapper(value);value.__chain__=!0;return value}function tap(value,interceptor){interceptor(value);return value}function wrapperChain(){this.__chain__=!0;return this}function wrapperValueOf(){return this.__wrapped__}var undefined,idCounter=0,indicatorObject={},keyPrefix=+new Date+"",reInterpolate=/<%=([\s\S]+?)%>/g,reNoMatch=/($^)/,reUnescapedString=/['\n\r\t\u2028\u2029\\]/g,argsClass="[object Arguments]",arrayClass="[object Array]",boolClass="[object Boolean]",dateClass="[object Date]",funcClass="[object Function]",numberClass="[object Number]",objectClass="[object Object]",regexpClass="[object RegExp]",stringClass="[object String]",objectTypes={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},stringEscapes={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"},root=objectTypes[typeof window]&&window||this,freeExports=objectTypes[typeof exports]&&exports&&!exports.nodeType&&exports,freeModule=objectTypes[typeof module]&&module&&!module.nodeType&&module,moduleExports=freeModule&&freeModule.exports===freeExports&&freeExports,freeGlobal=objectTypes[typeof global]&&global;!freeGlobal||freeGlobal.global!==freeGlobal&&freeGlobal.window!==freeGlobal||(root=freeGlobal);var arrayRef=[],objectProto=Object.prototype,oldDash=root._,reNative=RegExp("^"+String(objectProto.valueOf).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/valueOf|for [^\]]+/g,".+?")+"$"),ceil=Math.ceil,floor=Math.floor,hasOwnProperty=objectProto.hasOwnProperty,now=reNative.test(now=Date.now)&&now||function(){return+new Date},push=arrayRef.push,toString=objectProto.toString,unshift=arrayRef.unshift,nativeBind=reNative.test(nativeBind=toString.bind)&&nativeBind,nativeCreate=reNative.test(nativeCreate=Object.create)&&nativeCreate,nativeIsArray=reNative.test(nativeIsArray=Array.isArray)&&nativeIsArray,nativeIsFinite=root.isFinite,nativeIsNaN=root.isNaN,nativeKeys=reNative.test(nativeKeys=Object.keys)&&nativeKeys,nativeMax=Math.max,nativeMin=Math.min,nativeRandom=Math.random,nativeSlice=arrayRef.slice,isIeOpera=reNative.test(root.attachEvent),isV8=nativeBind&&!/\n|true/.test(nativeBind+isIeOpera);lodashWrapper.prototype=lodash.prototype;var support={};!function(){var object={0:1,length:1};support.fastBind=nativeBind&&!isV8;support.spliceObjects=(arrayRef.splice.call(object,0,1),!object[0])}(1);lodash.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:reInterpolate,variable:""};nativeCreate||(createObject=function(prototype){if(isObject(prototype)){noop.prototype=prototype;var result=new noop;noop.prototype=null}return result||{}});isArguments(arguments)||(isArguments=function(value){return value&&"object"==typeof value&&"number"==typeof value.length&&hasOwnProperty.call(value,"callee")||!1});var isArray=nativeIsArray||function(value){return value&&"object"==typeof value&&"number"==typeof value.length&&toString.call(value)==arrayClass||!1},shimKeys=function(object){var index,iterable=object,result=[];if(!iterable)return result;if(!objectTypes[typeof object])return result;for(index in iterable)hasOwnProperty.call(iterable,index)&&result.push(index);return result},keys=nativeKeys?function(object){return isObject(object)?nativeKeys(object):[]}:shimKeys,htmlEscapes={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"},htmlUnescapes=invert(htmlEscapes),reEscapedHtml=RegExp("("+keys(htmlUnescapes).join("|")+")","g"),reUnescapedHtml=RegExp("["+keys(htmlEscapes).join("")+"]","g"),forIn=function(collection,callback){var index,iterable=collection,result=iterable;if(!iterable)return result;if(!objectTypes[typeof iterable])return result;for(index in iterable)if(callback(iterable[index],index,collection)===indicatorObject)return result;return result},forOwn=function(collection,callback){var index,iterable=collection,result=iterable;if(!iterable)return result;if(!objectTypes[typeof iterable])return result;for(index in iterable)if(hasOwnProperty.call(iterable,index)&&callback(iterable[index],index,collection)===indicatorObject)return result;return result};isFunction(/x/)&&(isFunction=function(value){return"function"==typeof value&&toString.call(value)==funcClass});var countBy=createAggregator(function(result,value,key){hasOwnProperty.call(result,key)?result[key]++:result[key]=1}),groupBy=createAggregator(function(result,value,key){(hasOwnProperty.call(result,key)?result[key]:result[key]=[]).push(value)}),indexBy=createAggregator(function(result,value,key){result[key]=value});lodash.after=after;lodash.bind=bind;lodash.bindAll=bindAll;lodash.chain=chain;lodash.compact=compact;lodash.compose=compose;lodash.countBy=countBy;lodash.debounce=debounce;lodash.defaults=defaults;lodash.defer=defer;lodash.delay=delay;lodash.difference=difference;lodash.filter=filter;lodash.flatten=flatten;lodash.forEach=forEach;lodash.functions=functions;lodash.groupBy=groupBy;lodash.indexBy=indexBy;lodash.initial=initial;lodash.intersection=intersection;lodash.invert=invert;lodash.invoke=invoke;lodash.keys=keys;lodash.map=map;lodash.max=max;lodash.memoize=memoize;lodash.min=min;lodash.omit=omit;lodash.once=once;lodash.pairs=pairs;lodash.partial=partial;lodash.pick=pick;lodash.pluck=pluck;lodash.range=range;lodash.reject=reject;lodash.rest=rest;lodash.shuffle=shuffle;lodash.sortBy=sortBy;lodash.tap=tap;lodash.throttle=throttle;lodash.times=times;lodash.toArray=toArray;lodash.union=union;lodash.uniq=uniq;lodash.values=values;lodash.where=where;lodash.without=without;lodash.wrap=wrap;lodash.zip=zip;lodash.collect=map;lodash.drop=rest;lodash.each=forEach;lodash.extend=assign;lodash.methods=functions;lodash.object=zipObject;lodash.select=filter;lodash.tail=rest;lodash.unique=uniq;lodash.clone=clone;lodash.contains=contains;lodash.escape=escape;lodash.every=every;lodash.find=find;lodash.has=has;lodash.identity=identity;lodash.indexOf=indexOf;lodash.isArguments=isArguments;lodash.isArray=isArray;lodash.isBoolean=isBoolean;lodash.isDate=isDate;lodash.isElement=isElement;lodash.isEmpty=isEmpty;lodash.isEqual=isEqual;lodash.isFinite=isFinite;lodash.isFunction=isFunction;lodash.isNaN=isNaN;lodash.isNull=isNull;lodash.isNumber=isNumber;lodash.isObject=isObject;lodash.isRegExp=isRegExp;lodash.isString=isString;lodash.isUndefined=isUndefined;lodash.lastIndexOf=lastIndexOf;lodash.mixin=mixin;lodash.noConflict=noConflict;lodash.random=random;lodash.reduce=reduce;lodash.reduceRight=reduceRight;lodash.result=result;lodash.size=size;lodash.some=some;lodash.sortedIndex=sortedIndex;lodash.template=template;lodash.unescape=unescape;lodash.uniqueId=uniqueId;lodash.all=every;lodash.any=some;lodash.detect=find;lodash.findWhere=findWhere;lodash.foldl=reduce;lodash.foldr=reduceRight;lodash.include=contains;lodash.inject=reduce;lodash.first=first;lodash.last=last;lodash.sample=sample;lodash.take=first;lodash.head=first;mixin(lodash);lodash.VERSION="2.2.0";lodash.prototype.chain=wrapperChain;lodash.prototype.value=wrapperValueOf;forEach(["pop","push","reverse","shift","sort","splice","unshift"],function(methodName){var func=arrayRef[methodName];lodash.prototype[methodName]=function(){var value=this.__wrapped__;func.apply(value,arguments);support.spliceObjects||0!==value.length||delete value[0];return this}});forEach(["concat","join","slice"],function(methodName){var func=arrayRef[methodName];lodash.prototype[methodName]=function(){var value=this.__wrapped__,result=func.apply(value,arguments);if(this.__chain__){result=new lodashWrapper(result);result.__chain__=!0}return result}});if("function"==typeof define&&"object"==typeof define.amd&&define.amd){root._=lodash;define("lodash",[],function(){return lodash})}else freeExports&&freeModule?moduleExports?(freeModule.exports=lodash)._=lodash:freeExports._=lodash:root._=lodash}).call(this);define("underscore",["splunk.i18n","lodash"],function(i18n,_){_.mixin({t:function(string){return i18n._(string)}});return _});d3=function(){function d3_number(x){return null!=x&&!isNaN(x)}function d3_zipLength(d){return d.length}function d3_range_integerScale(x){for(var k=1;x*k%1;)k*=10;return k}function d3_class(ctor,properties){try{for(var key in properties)Object.defineProperty(ctor.prototype,key,{value:properties[key],enumerable:!1})}catch(e){ctor.prototype=properties}}function d3_Map(){}function d3_Set(){}function d3_rebind(target,source,method){return function(){var value=method.apply(source,arguments);return value===source?target:value}}function d3_vendorSymbol(object,name){if(name in object)return name;name=name.charAt(0).toUpperCase()+name.substring(1);for(var i=0,n=d3_vendorPrefixes.length;n>i;++i){var prefixName=d3_vendorPrefixes[i]+name;if(prefixName in object)return prefixName}}function d3_noop(){}function d3_dispatch(){}function d3_dispatch_event(dispatch){function event(){for(var l,z=listeners,i=-1,n=z.length;++i<n;)(l=z[i].on)&&l.apply(this,arguments);return dispatch}var listeners=[],listenerByName=new d3_Map;event.on=function(name,listener){var i,l=listenerByName.get(name);if(arguments.length<2)return l&&l.on;if(l){l.on=null;listeners=listeners.slice(0,i=listeners.indexOf(l)).concat(listeners.slice(i+1));listenerByName.remove(name)}listener&&listeners.push(listenerByName.set(name,{on:listener}));return dispatch};return event}function d3_eventPreventDefault(){d3.event.preventDefault()}function d3_eventSource(){for(var s,e=d3.event;s=e.sourceEvent;)e=s;return e}function d3_eventDispatch(target){for(var dispatch=new d3_dispatch,i=0,n=arguments.length;++i<n;)dispatch[arguments[i]]=d3_dispatch_event(dispatch);dispatch.of=function(thiz,argumentz){return function(e1){try{var e0=e1.sourceEvent=d3.event;e1.target=target;d3.event=e1;dispatch[e1.type].apply(thiz,argumentz)}finally{d3.event=e0}}};return dispatch}function d3_selection(groups){d3_subclass(groups,d3_selectionPrototype);return groups}function d3_selection_selector(selector){return"function"==typeof selector?selector:function(){return d3_select(selector,this)}}function d3_selection_selectorAll(selector){return"function"==typeof selector?selector:function(){return d3_selectAll(selector,this)}}function d3_selection_attr(name,value){function attrNull(){this.removeAttribute(name)}function attrNullNS(){this.removeAttributeNS(name.space,name.local)}function attrConstant(){this.setAttribute(name,value)}function attrConstantNS(){this.setAttributeNS(name.space,name.local,value)}function attrFunction(){var x=value.apply(this,arguments);null==x?this.removeAttribute(name):this.setAttribute(name,x)}function attrFunctionNS(){var x=value.apply(this,arguments);null==x?this.removeAttributeNS(name.space,name.local):this.setAttributeNS(name.space,name.local,x)}name=d3.ns.qualify(name);return null==value?name.local?attrNullNS:attrNull:"function"==typeof value?name.local?attrFunctionNS:attrFunction:name.local?attrConstantNS:attrConstant}function d3_collapse(s){return s.trim().replace(/\s+/g," ")}function d3_selection_classedRe(name){return new RegExp("(?:^|\\s+)"+d3.requote(name)+"(?:\\s+|$)","g")}function d3_selection_classed(name,value){function classedConstant(){for(var i=-1;++i<n;)name[i](this,value)}function classedFunction(){for(var i=-1,x=value.apply(this,arguments);++i<n;)name[i](this,x)}name=name.trim().split(/\s+/).map(d3_selection_classedName);var n=name.length;return"function"==typeof value?classedFunction:classedConstant}function d3_selection_classedName(name){var re=d3_selection_classedRe(name);return function(node,value){if(c=node.classList)return value?c.add(name):c.remove(name);var c=node.getAttribute("class")||"";if(value){re.lastIndex=0;re.test(c)||node.setAttribute("class",d3_collapse(c+" "+name))}else node.setAttribute("class",d3_collapse(c.replace(re," ")))}}function d3_selection_style(name,value,priority){function styleNull(){this.style.removeProperty(name)}function styleConstant(){this.style.setProperty(name,value,priority)}function styleFunction(){var x=value.apply(this,arguments);null==x?this.style.removeProperty(name):this.style.setProperty(name,x,priority)}return null==value?styleNull:"function"==typeof value?styleFunction:styleConstant}function d3_selection_property(name,value){function propertyNull(){delete this[name]}function propertyConstant(){this[name]=value}function propertyFunction(){var x=value.apply(this,arguments);null==x?delete this[name]:this[name]=x}return null==value?propertyNull:"function"==typeof value?propertyFunction:propertyConstant}function d3_selection_creator(name){return"function"==typeof name?name:(name=d3.ns.qualify(name)).local?function(){return d3_document.createElementNS(name.space,name.local)}:function(){return d3_document.createElementNS(this.namespaceURI,name)}}function d3_selection_dataNode(data){return{__data__:data}}function d3_selection_filter(selector){return function(){return d3_selectMatches(this,selector)}}function d3_selection_sortComparator(comparator){arguments.length||(comparator=d3.ascending);return function(a,b){return a&&b?comparator(a.__data__,b.__data__):!a-!b}}function d3_selection_each(groups,callback){for(var j=0,m=groups.length;m>j;j++)for(var node,group=groups[j],i=0,n=group.length;n>i;i++)(node=group[i])&&callback(node,i,j);return groups}function d3_selection_enter(selection){d3_subclass(selection,d3_selection_enterPrototype);return selection}function d3_selection_enterInsertBefore(enter){var i0,j0;return function(d,i,j){var node,group=enter[j].update,n=group.length;j!=j0&&(j0=j,i0=0);i>=i0&&(i0=i+1);for(;!(node=group[i0])&&++i0<n;);return node}}function d3_selection_interrupt(){var lock=this.__transition__;lock&&++lock.active}function d3_selection_on(type,listener,capture){function onRemove(){var l=this[name];if(l){this.removeEventListener(type,l,l.$);delete this[name]}}function onAdd(){var l=wrap(listener,d3_array(arguments));onRemove.call(this);this.addEventListener(type,this[name]=l,l.$=capture);l._=listener}function removeAll(){var match,re=new RegExp("^__on([^.]+)"+d3.requote(type)+"$");for(var name in this)if(match=name.match(re)){var l=this[name];this.removeEventListener(match[1],l,l.$);delete this[name]}}var name="__on"+type,i=type.indexOf("."),wrap=d3_selection_onListener;i>0&&(type=type.substring(0,i));var filter=d3_selection_onFilters.get(type);filter&&(type=filter,wrap=d3_selection_onFilter);return i?listener?onAdd:onRemove:listener?d3_noop:removeAll}function d3_selection_onListener(listener,argumentz){return function(e){var o=d3.event;d3.event=e;argumentz[0]=this.__data__;try{listener.apply(this,argumentz)}finally{d3.event=o}}}function d3_selection_onFilter(listener,argumentz){var l=d3_selection_onListener(listener,argumentz);return function(e){var target=this,related=e.relatedTarget;related&&(related===target||8&related.compareDocumentPosition(target))||l.call(target,e)}}function d3_event_dragSuppress(){var name=".dragsuppress-"+ ++d3_event_dragId,touchmove="touchmove"+name,selectstart="selectstart"+name,dragstart="dragstart"+name,click="click"+name,w=d3.select(d3_window).on(touchmove,d3_eventPreventDefault).on(selectstart,d3_eventPreventDefault).on(dragstart,d3_eventPreventDefault),style=d3_documentElement.style,select=style[d3_event_dragSelect];style[d3_event_dragSelect]="none";return function(suppressClick){function off(){w.on(click,null)}w.on(name,null);style[d3_event_dragSelect]=select;if(suppressClick){w.on(click,function(){d3_eventPreventDefault();off()},!0);setTimeout(off,0)}}}function d3_mousePoint(container,e){var svg=container.ownerSVGElement||container;if(svg.createSVGPoint){var point=svg.createSVGPoint();if(0>d3_mouse_bug44083&&(d3_window.scrollX||d3_window.scrollY)){svg=d3.select("body").append("svg").style({position:"absolute",top:0,left:0,margin:0,padding:0,border:"none"},"important");var ctm=svg[0][0].getScreenCTM();d3_mouse_bug44083=!(ctm.f||ctm.e);svg.remove()}if(d3_mouse_bug44083){point.x=e.pageX;point.y=e.pageY}else{point.x=e.clientX;point.y=e.clientY}point=point.matrixTransform(container.getScreenCTM().inverse());return[point.x,point.y]}var rect=container.getBoundingClientRect();return[e.clientX-rect.left-container.clientLeft,e.clientY-rect.top-container.clientTop]}function d3_sgn(x){return x>0?1:0>x?-1:0}function d3_acos(x){return x>1?0:-1>x?π:Math.acos(x)}function d3_asin(x){return x>1?π/2:-1>x?-π/2:Math.asin(x)}function d3_sinh(x){return(Math.exp(x)-Math.exp(-x))/2}function d3_cosh(x){return(Math.exp(x)+Math.exp(-x))/2}function d3_tanh(x){return d3_sinh(x)/d3_cosh(x)}function d3_haversin(x){return(x=Math.sin(x/2))*x}function d3_Color(){}function d3_hsl(h,s,l){return new d3_Hsl(h,s,l)}function d3_Hsl(h,s,l){this.h=h;this.s=s;this.l=l}function d3_hsl_rgb(h,s,l){function v(h){h>360?h-=360:0>h&&(h+=360);return 60>h?m1+(m2-m1)*h/60:180>h?m2:240>h?m1+(m2-m1)*(240-h)/60:m1}function vv(h){return Math.round(255*v(h))}var m1,m2;h=isNaN(h)?0:(h%=360)<0?h+360:h;s=isNaN(s)?0:0>s?0:s>1?1:s;l=0>l?0:l>1?1:l;m2=.5>=l?l*(1+s):l+s-l*s;m1=2*l-m2;return d3_rgb(vv(h+120),vv(h),vv(h-120))}function d3_hcl(h,c,l){return new d3_Hcl(h,c,l)}function d3_Hcl(h,c,l){this.h=h;this.c=c;this.l=l}function d3_hcl_lab(h,c,l){isNaN(h)&&(h=0);isNaN(c)&&(c=0);return d3_lab(l,Math.cos(h*=d3_radians)*c,Math.sin(h)*c)}function d3_lab(l,a,b){return new d3_Lab(l,a,b)}function d3_Lab(l,a,b){this.l=l;this.a=a;this.b=b}function d3_lab_rgb(l,a,b){var y=(l+16)/116,x=y+a/500,z=y-b/200;x=d3_lab_xyz(x)*d3_lab_X;y=d3_lab_xyz(y)*d3_lab_Y;z=d3_lab_xyz(z)*d3_lab_Z;return d3_rgb(d3_xyz_rgb(3.2404542*x-1.5371385*y-.4985314*z),d3_xyz_rgb(-.969266*x+1.8760108*y+.041556*z),d3_xyz_rgb(.0556434*x-.2040259*y+1.0572252*z))}function d3_lab_hcl(l,a,b){return l>0?d3_hcl(Math.atan2(b,a)*d3_degrees,Math.sqrt(a*a+b*b),l):d3_hcl(0/0,0/0,l)}function d3_lab_xyz(x){return x>.206893034?x*x*x:(x-4/29)/7.787037}function d3_xyz_lab(x){return x>.008856?Math.pow(x,1/3):7.787037*x+4/29}function d3_xyz_rgb(r){return Math.round(255*(.00304>=r?12.92*r:1.055*Math.pow(r,1/2.4)-.055))}function d3_rgbNumber(value){return d3_rgb(value>>16,value>>8&255,255&value)}function d3_rgbString(value){return d3_rgbNumber(value)+""}function d3_rgb(r,g,b){return new d3_Rgb(r,g,b)}function d3_Rgb(r,g,b){this.r=r;this.g=g;this.b=b}function d3_rgb_hex(v){return 16>v?"0"+Math.max(0,v).toString(16):Math.min(255,v).toString(16)}function d3_rgb_parse(format,rgb,hsl){var m1,m2,name,r=0,g=0,b=0;m1=/([a-z]+)\((.*)\)/i.exec(format);if(m1){m2=m1[2].split(",");switch(m1[1]){case"hsl":return hsl(parseFloat(m2[0]),parseFloat(m2[1])/100,parseFloat(m2[2])/100);case"rgb":return rgb(d3_rgb_parseNumber(m2[0]),d3_rgb_parseNumber(m2[1]),d3_rgb_parseNumber(m2[2]))}}if(name=d3_rgb_names.get(format))return rgb(name.r,name.g,name.b);if(null!=format&&"#"===format.charAt(0)){if(4===format.length){r=format.charAt(1);r+=r;g=format.charAt(2);g+=g;b=format.charAt(3);b+=b}else if(7===format.length){r=format.substring(1,3);g=format.substring(3,5);b=format.substring(5,7)}r=parseInt(r,16);g=parseInt(g,16);b=parseInt(b,16)}return rgb(r,g,b)}function d3_rgb_hsl(r,g,b){var h,s,min=Math.min(r/=255,g/=255,b/=255),max=Math.max(r,g,b),d=max-min,l=(max+min)/2;if(d){s=.5>l?d/(max+min):d/(2-max-min);h=r==max?(g-b)/d+(b>g?6:0):g==max?(b-r)/d+2:(r-g)/d+4;h*=60}else{h=0/0;s=l>0&&1>l?0:h}return d3_hsl(h,s,l)}function d3_rgb_lab(r,g,b){r=d3_rgb_xyz(r);g=d3_rgb_xyz(g);b=d3_rgb_xyz(b);var x=d3_xyz_lab((.4124564*r+.3575761*g+.1804375*b)/d3_lab_X),y=d3_xyz_lab((.2126729*r+.7151522*g+.072175*b)/d3_lab_Y),z=d3_xyz_lab((.0193339*r+.119192*g+.9503041*b)/d3_lab_Z);return d3_lab(116*y-16,500*(x-y),200*(y-z))}function d3_rgb_xyz(r){return(r/=255)<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function d3_rgb_parseNumber(c){var f=parseFloat(c);return"%"===c.charAt(c.length-1)?Math.round(2.55*f):f}function d3_functor(v){return"function"==typeof v?v:function(){return v}}function d3_identity(d){return d}function d3_xhrType(response){return function(url,mimeType,callback){2===arguments.length&&"function"==typeof mimeType&&(callback=mimeType,mimeType=null);return d3_xhr(url,mimeType,response,callback)}}function d3_xhr(url,mimeType,response,callback){function respond(){var result,status=request.status;if(!status&&request.responseText||status>=200&&300>status||304===status){try{result=response.call(xhr,request)}catch(e){dispatch.error.call(xhr,e);return}dispatch.load.call(xhr,result)}else dispatch.error.call(xhr,request)}var xhr={},dispatch=d3.dispatch("beforesend","progress","load","error"),headers={},request=new XMLHttpRequest,responseType=null;!d3_window.XDomainRequest||"withCredentials"in request||!/^(http(s)?:)?\/\//.test(url)||(request=new XDomainRequest);"onload"in request?request.onload=request.onerror=respond:request.onreadystatechange=function(){request.readyState>3&&respond()};request.onprogress=function(event){var o=d3.event;d3.event=event;try{dispatch.progress.call(xhr,request)}finally{d3.event=o}};xhr.header=function(name,value){name=(name+"").toLowerCase();if(arguments.length<2)return headers[name];null==value?delete headers[name]:headers[name]=value+"";return xhr};xhr.mimeType=function(value){if(!arguments.length)return mimeType;mimeType=null==value?null:value+"";return xhr};xhr.responseType=function(value){if(!arguments.length)return responseType;responseType=value;return xhr};xhr.response=function(value){response=value;return xhr};["get","post"].forEach(function(method){xhr[method]=function(){return xhr.send.apply(xhr,[method].concat(d3_array(arguments)))}});xhr.send=function(method,data,callback){2===arguments.length&&"function"==typeof data&&(callback=data,data=null);request.open(method,url,!0);null==mimeType||"accept"in headers||(headers["accept"]=mimeType+",*/*");if(request.setRequestHeader)for(var name in headers)request.setRequestHeader(name,headers[name]);null!=mimeType&&request.overrideMimeType&&request.overrideMimeType(mimeType);null!=responseType&&(request.responseType=responseType);null!=callback&&xhr.on("error",callback).on("load",function(request){callback(null,request)});dispatch.beforesend.call(xhr,request);request.send(null==data?null:data);return xhr};xhr.abort=function(){request.abort();return xhr};d3.rebind(xhr,dispatch,"on");return null==callback?xhr:xhr.get(d3_xhr_fixCallback(callback))}function d3_xhr_fixCallback(callback){return 1===callback.length?function(error,request){callback(null==error?request:null)}:callback}function d3_timer_step(){var now=d3_timer_mark(),delay=d3_timer_sweep()-now;if(delay>24){if(isFinite(delay)){clearTimeout(d3_timer_timeout);d3_timer_timeout=setTimeout(d3_timer_step,delay)}d3_timer_interval=0}else{d3_timer_interval=1;d3_timer_frame(d3_timer_step)}}function d3_timer_replace(callback,delay,then){var n=arguments.length;2>n&&(delay=0);3>n&&(then=Date.now());d3_timer_active.callback=callback;d3_timer_active.time=then+delay}function d3_timer_mark(){var now=Date.now();d3_timer_active=d3_timer_queueHead;for(;d3_timer_active;){now>=d3_timer_active.time&&(d3_timer_active.flush=d3_timer_active.callback(now-d3_timer_active.time));d3_timer_active=d3_timer_active.next}return now}function d3_timer_sweep(){for(var t0,t1=d3_timer_queueHead,time=1/0;t1;)if(t1.flush)t1=t0?t0.next=t1.next:d3_timer_queueHead=t1.next;else{t1.time<time&&(time=t1.time);t1=(t0=t1).next}d3_timer_queueTail=t0;return time}function d3_formatPrefix(d,i){var k=Math.pow(10,3*Math.abs(8-i));return{scale:i>8?function(d){return d/k}:function(d){return d*k},symbol:d}}function d3_format_precision(x,p){return p-(x?Math.ceil(Math.log(x)/Math.LN10):1)}function d3_format_typeDefault(x){return x+""}function d3_adder(){}function d3_adderSum(a,b,o){var x=o.s=a+b,bv=x-a,av=x-bv;o.t=a-av+(b-bv)}function d3_geo_streamGeometry(geometry,listener){geometry&&d3_geo_streamGeometryType.hasOwnProperty(geometry.type)&&d3_geo_streamGeometryType[geometry.type](geometry,listener)}function d3_geo_streamLine(coordinates,listener,closed){var coordinate,i=-1,n=coordinates.length-closed;listener.lineStart();for(;++i<n;)coordinate=coordinates[i],listener.point(coordinate[0],coordinate[1],coordinate[2]);listener.lineEnd()}function d3_geo_streamPolygon(coordinates,listener){var i=-1,n=coordinates.length;listener.polygonStart();for(;++i<n;)d3_geo_streamLine(coordinates[i],listener,1);listener.polygonEnd()}function d3_geo_areaRingStart(){function nextPoint(λ,φ){λ*=d3_radians;φ=φ*d3_radians/2+π/4;var dλ=λ-λ0,cosφ=Math.cos(φ),sinφ=Math.sin(φ),k=sinφ0*sinφ,u=cosφ0*cosφ+k*Math.cos(dλ),v=k*Math.sin(dλ);d3_geo_areaRingSum.add(Math.atan2(v,u));λ0=λ,cosφ0=cosφ,sinφ0=sinφ}var λ00,φ00,λ0,cosφ0,sinφ0;d3_geo_area.point=function(λ,φ){d3_geo_area.point=nextPoint;λ0=(λ00=λ)*d3_radians,cosφ0=Math.cos(φ=(φ00=φ)*d3_radians/2+π/4),sinφ0=Math.sin(φ)};d3_geo_area.lineEnd=function(){nextPoint(λ00,φ00)}}function d3_geo_cartesian(spherical){var λ=spherical[0],φ=spherical[1],cosφ=Math.cos(φ);return[cosφ*Math.cos(λ),cosφ*Math.sin(λ),Math.sin(φ)]}function d3_geo_cartesianDot(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]}function d3_geo_cartesianCross(a,b){return[a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]]}function d3_geo_cartesianAdd(a,b){a[0]+=b[0];a[1]+=b[1];a[2]+=b[2]}function d3_geo_cartesianScale(vector,k){return[vector[0]*k,vector[1]*k,vector[2]*k]}function d3_geo_cartesianNormalize(d){var l=Math.sqrt(d[0]*d[0]+d[1]*d[1]+d[2]*d[2]);d[0]/=l;d[1]/=l;d[2]/=l}function d3_geo_spherical(cartesian){return[Math.atan2(cartesian[1],cartesian[0]),d3_asin(cartesian[2])]}function d3_geo_sphericalEqual(a,b){return Math.abs(a[0]-b[0])<ε&&Math.abs(a[1]-b[1])<ε}function d3_geo_centroidPoint(λ,φ){λ*=d3_radians;var cosφ=Math.cos(φ*=d3_radians);d3_geo_centroidPointXYZ(cosφ*Math.cos(λ),cosφ*Math.sin(λ),Math.sin(φ))}function d3_geo_centroidPointXYZ(x,y,z){++d3_geo_centroidW0;d3_geo_centroidX0+=(x-d3_geo_centroidX0)/d3_geo_centroidW0;d3_geo_centroidY0+=(y-d3_geo_centroidY0)/d3_geo_centroidW0;d3_geo_centroidZ0+=(z-d3_geo_centroidZ0)/d3_geo_centroidW0}function d3_geo_centroidLineStart(){function nextPoint(λ,φ){λ*=d3_radians;var cosφ=Math.cos(φ*=d3_radians),x=cosφ*Math.cos(λ),y=cosφ*Math.sin(λ),z=Math.sin(φ),w=Math.atan2(Math.sqrt((w=y0*z-z0*y)*w+(w=z0*x-x0*z)*w+(w=x0*y-y0*x)*w),x0*x+y0*y+z0*z);d3_geo_centroidW1+=w;d3_geo_centroidX1+=w*(x0+(x0=x));d3_geo_centroidY1+=w*(y0+(y0=y));d3_geo_centroidZ1+=w*(z0+(z0=z));d3_geo_centroidPointXYZ(x0,y0,z0)}var x0,y0,z0;d3_geo_centroid.point=function(λ,φ){λ*=d3_radians;var cosφ=Math.cos(φ*=d3_radians);x0=cosφ*Math.cos(λ);y0=cosφ*Math.sin(λ);z0=Math.sin(φ);d3_geo_centroid.point=nextPoint;d3_geo_centroidPointXYZ(x0,y0,z0)}}function d3_geo_centroidLineEnd(){d3_geo_centroid.point=d3_geo_centroidPoint}function d3_geo_centroidRingStart(){function nextPoint(λ,φ){λ*=d3_radians;var cosφ=Math.cos(φ*=d3_radians),x=cosφ*Math.cos(λ),y=cosφ*Math.sin(λ),z=Math.sin(φ),cx=y0*z-z0*y,cy=z0*x-x0*z,cz=x0*y-y0*x,m=Math.sqrt(cx*cx+cy*cy+cz*cz),u=x0*x+y0*y+z0*z,v=m&&-d3_acos(u)/m,w=Math.atan2(m,u);d3_geo_centroidX2+=v*cx;d3_geo_centroidY2+=v*cy;d3_geo_centroidZ2+=v*cz;d3_geo_centroidW1+=w;d3_geo_centroidX1+=w*(x0+(x0=x));d3_geo_centroidY1+=w*(y0+(y0=y));d3_geo_centroidZ1+=w*(z0+(z0=z));d3_geo_centroidPointXYZ(x0,y0,z0)}var λ00,φ00,x0,y0,z0;d3_geo_centroid.point=function(λ,φ){λ00=λ,φ00=φ;d3_geo_centroid.point=nextPoint;λ*=d3_radians;var cosφ=Math.cos(φ*=d3_radians);x0=cosφ*Math.cos(λ);y0=cosφ*Math.sin(λ);z0=Math.sin(φ);d3_geo_centroidPointXYZ(x0,y0,z0)};d3_geo_centroid.lineEnd=function(){nextPoint(λ00,φ00);d3_geo_centroid.lineEnd=d3_geo_centroidLineEnd;d3_geo_centroid.point=d3_geo_centroidPoint}}function d3_true(){return!0}function d3_geo_clipPolygon(segments,compare,inside,interpolate,listener){var subject=[],clip=[];segments.forEach(function(segment){if(!((n=segment.length-1)<=0)){var n,p0=segment[0],p1=segment[n];if(d3_geo_sphericalEqual(p0,p1)){listener.lineStart();for(var i=0;n>i;++i)listener.point((p0=segment[i])[0],p0[1]);listener.lineEnd()}else{var a={point:p0,points:segment,other:null,visited:!1,entry:!0,subject:!0},b={point:p0,points:[p0],other:a,visited:!1,entry:!1,subject:!1};a.other=b;subject.push(a);clip.push(b);a={point:p1,points:[p1],other:null,visited:!1,entry:!1,subject:!0};b={point:p1,points:[p1],other:a,visited:!1,entry:!0,subject:!1};a.other=b;subject.push(a);clip.push(b)}}});clip.sort(compare);d3_geo_clipPolygonLinkCircular(subject);d3_geo_clipPolygonLinkCircular(clip);if(subject.length){if(inside)for(var i=1,e=!inside(clip[0].point),n=clip.length;n>i;++i)clip[i].entry=e=!e;for(var current,points,point,start=subject[0];;){current=start;for(;current.visited;)if((current=current.next)===start)return;points=current.points;listener.lineStart();do{current.visited=current.other.visited=!0;if(current.entry){if(current.subject)for(var i=0;i<points.length;i++)listener.point((point=points[i])[0],point[1]);else interpolate(current.point,current.next.point,1,listener);current=current.next}else{if(current.subject){points=current.prev.points;for(var i=points.length;--i>=0;)listener.point((point=points[i])[0],point[1])}else interpolate(current.point,current.prev.point,-1,listener);current=current.prev
}current=current.other;points=current.points}while(!current.visited);listener.lineEnd()}}}function d3_geo_clipPolygonLinkCircular(array){if(n=array.length){for(var n,b,i=0,a=array[0];++i<n;){a.next=b=array[i];b.prev=a;a=b}a.next=b=array[0];b.prev=a}}function d3_geo_clip(pointVisible,clipLine,interpolate,polygonContains){return function(listener){function point(λ,φ){pointVisible(λ,φ)&&listener.point(λ,φ)}function pointLine(λ,φ){line.point(λ,φ)}function lineStart(){clip.point=pointLine;line.lineStart()}function lineEnd(){clip.point=point;line.lineEnd()}function pointRing(λ,φ){ringListener.point(λ,φ);ring.push([λ,φ])}function ringStart(){ringListener.lineStart();ring=[]}function ringEnd(){pointRing(ring[0][0],ring[0][1]);ringListener.lineEnd();var segment,clean=ringListener.clean(),ringSegments=buffer.buffer(),n=ringSegments.length;ring.pop();polygon.push(ring);ring=null;if(n)if(1&clean){segment=ringSegments[0];var point,n=segment.length-1,i=-1;listener.lineStart();for(;++i<n;)listener.point((point=segment[i])[0],point[1]);listener.lineEnd()}else{n>1&&2&clean&&ringSegments.push(ringSegments.pop().concat(ringSegments.shift()));segments.push(ringSegments.filter(d3_geo_clipSegmentLength1))}}var segments,polygon,ring,line=clipLine(listener),clip={point:point,lineStart:lineStart,lineEnd:lineEnd,polygonStart:function(){clip.point=pointRing;clip.lineStart=ringStart;clip.lineEnd=ringEnd;segments=[];polygon=[];listener.polygonStart()},polygonEnd:function(){clip.point=point;clip.lineStart=lineStart;clip.lineEnd=lineEnd;segments=d3.merge(segments);if(segments.length)d3_geo_clipPolygon(segments,d3_geo_clipSort,null,interpolate,listener);else if(polygonContains(polygon)){listener.lineStart();interpolate(null,null,1,listener);listener.lineEnd()}listener.polygonEnd();segments=polygon=null},sphere:function(){listener.polygonStart();listener.lineStart();interpolate(null,null,1,listener);listener.lineEnd();listener.polygonEnd()}},buffer=d3_geo_clipBufferListener(),ringListener=clipLine(buffer);return clip}}function d3_geo_clipSegmentLength1(segment){return segment.length>1}function d3_geo_clipBufferListener(){var line,lines=[];return{lineStart:function(){lines.push(line=[])},point:function(λ,φ){line.push([λ,φ])},lineEnd:d3_noop,buffer:function(){var buffer=lines;lines=[];line=null;return buffer},rejoin:function(){lines.length>1&&lines.push(lines.pop().concat(lines.shift()))}}}function d3_geo_clipSort(a,b){return((a=a.point)[0]<0?a[1]-π/2-ε:π/2-a[1])-((b=b.point)[0]<0?b[1]-π/2-ε:π/2-b[1])}function d3_geo_pointInPolygon(point,polygon){var meridian=point[0],parallel=point[1],meridianNormal=[Math.sin(meridian),-Math.cos(meridian),0],polarAngle=0,polar=!1,southPole=!1,winding=0;d3_geo_areaRingSum.reset();for(var i=0,n=polygon.length;n>i;++i){var ring=polygon[i],m=ring.length;if(m){for(var point0=ring[0],λ0=point0[0],φ0=point0[1]/2+π/4,sinφ0=Math.sin(φ0),cosφ0=Math.cos(φ0),j=1;;){j===m&&(j=0);point=ring[j];var λ=point[0],φ=point[1]/2+π/4,sinφ=Math.sin(φ),cosφ=Math.cos(φ),dλ=λ-λ0,antimeridian=Math.abs(dλ)>π,k=sinφ0*sinφ;d3_geo_areaRingSum.add(Math.atan2(k*Math.sin(dλ),cosφ0*cosφ+k*Math.cos(dλ)));Math.abs(φ)<ε&&(southPole=!0);polarAngle+=antimeridian?dλ+(dλ>=0?2:-2)*π:dλ;if(antimeridian^λ0>=meridian^λ>=meridian){var arc=d3_geo_cartesianCross(d3_geo_cartesian(point0),d3_geo_cartesian(point));d3_geo_cartesianNormalize(arc);var intersection=d3_geo_cartesianCross(meridianNormal,arc);d3_geo_cartesianNormalize(intersection);var φarc=(antimeridian^dλ>=0?-1:1)*d3_asin(intersection[2]);parallel>φarc&&(winding+=antimeridian^dλ>=0?1:-1)}if(!j++)break;λ0=λ,sinφ0=sinφ,cosφ0=cosφ,point0=point}Math.abs(polarAngle)>ε&&(polar=!0)}}return(!southPole&&!polar&&0>d3_geo_areaRingSum||-ε>polarAngle)^1&winding}function d3_geo_clipAntimeridianLine(listener){var clean,λ0=0/0,φ0=0/0,sλ0=0/0;return{lineStart:function(){listener.lineStart();clean=1},point:function(λ1,φ1){var sλ1=λ1>0?π:-π,dλ=Math.abs(λ1-λ0);if(Math.abs(dλ-π)<ε){listener.point(λ0,φ0=(φ0+φ1)/2>0?π/2:-π/2);listener.point(sλ0,φ0);listener.lineEnd();listener.lineStart();listener.point(sλ1,φ0);listener.point(λ1,φ0);clean=0}else if(sλ0!==sλ1&&dλ>=π){Math.abs(λ0-sλ0)<ε&&(λ0-=sλ0*ε);Math.abs(λ1-sλ1)<ε&&(λ1-=sλ1*ε);φ0=d3_geo_clipAntimeridianIntersect(λ0,φ0,λ1,φ1);listener.point(sλ0,φ0);listener.lineEnd();listener.lineStart();listener.point(sλ1,φ0);clean=0}listener.point(λ0=λ1,φ0=φ1);sλ0=sλ1},lineEnd:function(){listener.lineEnd();λ0=φ0=0/0},clean:function(){return 2-clean}}}function d3_geo_clipAntimeridianIntersect(λ0,φ0,λ1,φ1){var cosφ0,cosφ1,sinλ0_λ1=Math.sin(λ0-λ1);return Math.abs(sinλ0_λ1)>ε?Math.atan((Math.sin(φ0)*(cosφ1=Math.cos(φ1))*Math.sin(λ1)-Math.sin(φ1)*(cosφ0=Math.cos(φ0))*Math.sin(λ0))/(cosφ0*cosφ1*sinλ0_λ1)):(φ0+φ1)/2}function d3_geo_clipAntimeridianInterpolate(from,to,direction,listener){var φ;if(null==from){φ=direction*π/2;listener.point(-π,φ);listener.point(0,φ);listener.point(π,φ);listener.point(π,0);listener.point(π,-φ);listener.point(0,-φ);listener.point(-π,-φ);listener.point(-π,0);listener.point(-π,φ)}else if(Math.abs(from[0]-to[0])>ε){var s=(from[0]<to[0]?1:-1)*π;φ=direction*s/2;listener.point(-s,φ);listener.point(0,φ);listener.point(s,φ)}else listener.point(to[0],to[1])}function d3_geo_clipAntimeridianPolygonContains(polygon){return d3_geo_pointInPolygon(d3_geo_clipAntimeridianPoint,polygon)}function d3_geo_clipCircle(radius){function visible(λ,φ){return Math.cos(λ)*Math.cos(φ)>cr}function clipLine(listener){var point0,c0,v0,v00,clean;return{lineStart:function(){v00=v0=!1;clean=1},point:function(λ,φ){var point2,point1=[λ,φ],v=visible(λ,φ),c=smallRadius?v?0:code(λ,φ):v?code(λ+(0>λ?π:-π),φ):0;!point0&&(v00=v0=v)&&listener.lineStart();if(v!==v0){point2=intersect(point0,point1);if(d3_geo_sphericalEqual(point0,point2)||d3_geo_sphericalEqual(point1,point2)){point1[0]+=ε;point1[1]+=ε;v=visible(point1[0],point1[1])}}if(v!==v0){clean=0;if(v){listener.lineStart();point2=intersect(point1,point0);listener.point(point2[0],point2[1])}else{point2=intersect(point0,point1);listener.point(point2[0],point2[1]);listener.lineEnd()}point0=point2}else if(notHemisphere&&point0&&smallRadius^v){var t;if(!(c&c0)&&(t=intersect(point1,point0,!0))){clean=0;if(smallRadius){listener.lineStart();listener.point(t[0][0],t[0][1]);listener.point(t[1][0],t[1][1]);listener.lineEnd()}else{listener.point(t[1][0],t[1][1]);listener.lineEnd();listener.lineStart();listener.point(t[0][0],t[0][1])}}}!v||point0&&d3_geo_sphericalEqual(point0,point1)||listener.point(point1[0],point1[1]);point0=point1,v0=v,c0=c},lineEnd:function(){v0&&listener.lineEnd();point0=null},clean:function(){return clean|(v00&&v0)<<1}}}function intersect(a,b,two){var pa=d3_geo_cartesian(a),pb=d3_geo_cartesian(b),n1=[1,0,0],n2=d3_geo_cartesianCross(pa,pb),n2n2=d3_geo_cartesianDot(n2,n2),n1n2=n2[0],determinant=n2n2-n1n2*n1n2;if(!determinant)return!two&&a;var c1=cr*n2n2/determinant,c2=-cr*n1n2/determinant,n1xn2=d3_geo_cartesianCross(n1,n2),A=d3_geo_cartesianScale(n1,c1),B=d3_geo_cartesianScale(n2,c2);d3_geo_cartesianAdd(A,B);var u=n1xn2,w=d3_geo_cartesianDot(A,u),uu=d3_geo_cartesianDot(u,u),t2=w*w-uu*(d3_geo_cartesianDot(A,A)-1);if(!(0>t2)){var t=Math.sqrt(t2),q=d3_geo_cartesianScale(u,(-w-t)/uu);d3_geo_cartesianAdd(q,A);q=d3_geo_spherical(q);if(!two)return q;var z,λ0=a[0],λ1=b[0],φ0=a[1],φ1=b[1];λ0>λ1&&(z=λ0,λ0=λ1,λ1=z);var δλ=λ1-λ0,polar=Math.abs(δλ-π)<ε,meridian=polar||ε>δλ;!polar&&φ0>φ1&&(z=φ0,φ0=φ1,φ1=z);if(meridian?polar?φ0+φ1>0^q[1]<(Math.abs(q[0]-λ0)<ε?φ0:φ1):φ0<=q[1]&&q[1]<=φ1:δλ>π^(λ0<=q[0]&&q[0]<=λ1)){var q1=d3_geo_cartesianScale(u,(-w+t)/uu);d3_geo_cartesianAdd(q1,A);return[q,d3_geo_spherical(q1)]}}}function code(λ,φ){var r=smallRadius?radius:π-radius,code=0;-r>λ?code|=1:λ>r&&(code|=2);-r>φ?code|=4:φ>r&&(code|=8);return code}function polygonContains(polygon){return d3_geo_pointInPolygon(point,polygon)}var cr=Math.cos(radius),smallRadius=cr>0,point=[radius,0],notHemisphere=Math.abs(cr)>ε,interpolate=d3_geo_circleInterpolate(radius,6*d3_radians);return d3_geo_clip(visible,clipLine,interpolate,polygonContains)}function d3_geo_clipExtent(x0,y0,x1,y1){function corner(p,direction){return Math.abs(p[0]-x0)<ε?direction>0?0:3:Math.abs(p[0]-x1)<ε?direction>0?2:1:Math.abs(p[1]-y0)<ε?direction>0?1:0:direction>0?3:2}function compare(a,b){return comparePoints(a.point,b.point)}function comparePoints(a,b){var ca=corner(a,1),cb=corner(b,1);return ca!==cb?ca-cb:0===ca?b[1]-a[1]:1===ca?a[0]-b[0]:2===ca?a[1]-b[1]:b[0]-a[0]}function clipLine(a,b){var dx=b[0]-a[0],dy=b[1]-a[1],t=[0,1];if(Math.abs(dx)<ε&&Math.abs(dy)<ε)return x0<=a[0]&&a[0]<=x1&&y0<=a[1]&&a[1]<=y1;if(d3_geo_clipExtentT(x0-a[0],dx,t)&&d3_geo_clipExtentT(a[0]-x1,-dx,t)&&d3_geo_clipExtentT(y0-a[1],dy,t)&&d3_geo_clipExtentT(a[1]-y1,-dy,t)){if(t[1]<1){b[0]=a[0]+t[1]*dx;b[1]=a[1]+t[1]*dy}if(t[0]>0){a[0]+=t[0]*dx;a[1]+=t[0]*dy}return!0}return!1}return function(listener){function inside(point){var a=corner(point,-1),i=insidePolygon([0===a||3===a?x0:x1,a>1?y1:y0]);return i}function insidePolygon(p){for(var wn=0,n=polygon.length,y=p[1],i=0;n>i;++i)for(var b,j=1,v=polygon[i],m=v.length,a=v[0];m>j;++j){b=v[j];a[1]<=y?b[1]>y&&isLeft(a,b,p)>0&&++wn:b[1]<=y&&isLeft(a,b,p)<0&&--wn;a=b}return 0!==wn}function isLeft(a,b,c){return(b[0]-a[0])*(c[1]-a[1])-(c[0]-a[0])*(b[1]-a[1])}function interpolate(from,to,direction,listener){var a=0,a1=0;if(null==from||(a=corner(from,direction))!==(a1=corner(to,direction))||comparePoints(from,to)<0^direction>0){do listener.point(0===a||3===a?x0:x1,a>1?y1:y0);while((a=(a+direction+4)%4)!==a1)}else listener.point(to[0],to[1])}function visible(x,y){return x>=x0&&x1>=x&&y>=y0&&y1>=y}function point(x,y){visible(x,y)&&listener.point(x,y)}function lineStart(){clip.point=linePoint;polygon&&polygon.push(ring=[]);first=!0;v_=!1;x_=y_=0/0}function lineEnd(){if(segments){linePoint(x__,y__);v__&&v_&&bufferListener.rejoin();segments.push(bufferListener.buffer())}clip.point=point;v_&&listener.lineEnd()}function linePoint(x,y){x=Math.max(-d3_geo_clipExtentMAX,Math.min(d3_geo_clipExtentMAX,x));y=Math.max(-d3_geo_clipExtentMAX,Math.min(d3_geo_clipExtentMAX,y));var v=visible(x,y);polygon&&ring.push([x,y]);if(first){x__=x,y__=y,v__=v;first=!1;if(v){listener.lineStart();listener.point(x,y)}}else if(v&&v_)listener.point(x,y);else{var a=[x_,y_],b=[x,y];if(clipLine(a,b)){if(!v_){listener.lineStart();listener.point(a[0],a[1])}listener.point(b[0],b[1]);v||listener.lineEnd()}else if(v){listener.lineStart();listener.point(x,y)}}x_=x,y_=y,v_=v}var segments,polygon,ring,x__,y__,v__,x_,y_,v_,first,listener_=listener,bufferListener=d3_geo_clipBufferListener(),clip={point:point,lineStart:lineStart,lineEnd:lineEnd,polygonStart:function(){listener=bufferListener;segments=[];polygon=[]},polygonEnd:function(){listener=listener_;if((segments=d3.merge(segments)).length){listener.polygonStart();d3_geo_clipPolygon(segments,compare,inside,interpolate,listener);listener.polygonEnd()}else if(insidePolygon([x0,y0])){listener.polygonStart(),listener.lineStart();interpolate(null,null,1,listener);listener.lineEnd(),listener.polygonEnd()}segments=polygon=ring=null}};return clip}}function d3_geo_clipExtentT(num,denominator,t){if(Math.abs(denominator)<ε)return 0>=num;var u=num/denominator;if(denominator>0){if(u>t[1])return!1;u>t[0]&&(t[0]=u)}else{if(u<t[0])return!1;u<t[1]&&(t[1]=u)}return!0}function d3_geo_compose(a,b){function compose(x,y){return x=a(x,y),b(x[0],x[1])}a.invert&&b.invert&&(compose.invert=function(x,y){return x=b.invert(x,y),x&&a.invert(x[0],x[1])});return compose}function d3_geo_conic(projectAt){var φ0=0,φ1=π/3,m=d3_geo_projectionMutator(projectAt),p=m(φ0,φ1);p.parallels=function(_){return arguments.length?m(φ0=_[0]*π/180,φ1=_[1]*π/180):[φ0/π*180,φ1/π*180]};return p}function d3_geo_conicEqualArea(φ0,φ1){function forward(λ,φ){var ρ=Math.sqrt(C-2*n*Math.sin(φ))/n;return[ρ*Math.sin(λ*=n),ρ0-ρ*Math.cos(λ)]}var sinφ0=Math.sin(φ0),n=(sinφ0+Math.sin(φ1))/2,C=1+sinφ0*(2*n-sinφ0),ρ0=Math.sqrt(C)/n;forward.invert=function(x,y){var ρ0_y=ρ0-y;return[Math.atan2(x,ρ0_y)/n,d3_asin((C-(x*x+ρ0_y*ρ0_y)*n*n)/(2*n))]};return forward}function d3_geo_pathAreaRingStart(){function nextPoint(x,y){d3_geo_pathAreaPolygon+=y0*x-x0*y;x0=x,y0=y}var x00,y00,x0,y0;d3_geo_pathArea.point=function(x,y){d3_geo_pathArea.point=nextPoint;x00=x0=x,y00=y0=y};d3_geo_pathArea.lineEnd=function(){nextPoint(x00,y00)}}function d3_geo_pathBoundsPoint(x,y){d3_geo_pathBoundsX0>x&&(d3_geo_pathBoundsX0=x);x>d3_geo_pathBoundsX1&&(d3_geo_pathBoundsX1=x);d3_geo_pathBoundsY0>y&&(d3_geo_pathBoundsY0=y);y>d3_geo_pathBoundsY1&&(d3_geo_pathBoundsY1=y)}function d3_geo_pathBuffer(){function point(x,y){buffer.push("M",x,",",y,pointCircle)}function pointLineStart(x,y){buffer.push("M",x,",",y);stream.point=pointLine}function pointLine(x,y){buffer.push("L",x,",",y)}function lineEnd(){stream.point=point}function lineEndPolygon(){buffer.push("Z")}var pointCircle=d3_geo_pathBufferCircle(4.5),buffer=[],stream={point:point,lineStart:function(){stream.point=pointLineStart},lineEnd:lineEnd,polygonStart:function(){stream.lineEnd=lineEndPolygon},polygonEnd:function(){stream.lineEnd=lineEnd;stream.point=point},pointRadius:function(_){pointCircle=d3_geo_pathBufferCircle(_);return stream},result:function(){if(buffer.length){var result=buffer.join("");buffer=[];return result}}};return stream}function d3_geo_pathBufferCircle(radius){return"m0,"+radius+"a"+radius+","+radius+" 0 1,1 0,"+-2*radius+"a"+radius+","+radius+" 0 1,1 0,"+2*radius+"z"}function d3_geo_pathCentroidPoint(x,y){d3_geo_centroidX0+=x;d3_geo_centroidY0+=y;++d3_geo_centroidZ0}function d3_geo_pathCentroidLineStart(){function nextPoint(x,y){var dx=x-x0,dy=y-y0,z=Math.sqrt(dx*dx+dy*dy);d3_geo_centroidX1+=z*(x0+x)/2;d3_geo_centroidY1+=z*(y0+y)/2;d3_geo_centroidZ1+=z;d3_geo_pathCentroidPoint(x0=x,y0=y)}var x0,y0;d3_geo_pathCentroid.point=function(x,y){d3_geo_pathCentroid.point=nextPoint;d3_geo_pathCentroidPoint(x0=x,y0=y)}}function d3_geo_pathCentroidLineEnd(){d3_geo_pathCentroid.point=d3_geo_pathCentroidPoint}function d3_geo_pathCentroidRingStart(){function nextPoint(x,y){var dx=x-x0,dy=y-y0,z=Math.sqrt(dx*dx+dy*dy);d3_geo_centroidX1+=z*(x0+x)/2;d3_geo_centroidY1+=z*(y0+y)/2;d3_geo_centroidZ1+=z;z=y0*x-x0*y;d3_geo_centroidX2+=z*(x0+x);d3_geo_centroidY2+=z*(y0+y);d3_geo_centroidZ2+=3*z;d3_geo_pathCentroidPoint(x0=x,y0=y)}var x00,y00,x0,y0;d3_geo_pathCentroid.point=function(x,y){d3_geo_pathCentroid.point=nextPoint;d3_geo_pathCentroidPoint(x00=x0=x,y00=y0=y)};d3_geo_pathCentroid.lineEnd=function(){nextPoint(x00,y00)}}function d3_geo_pathContext(context){function point(x,y){context.moveTo(x,y);context.arc(x,y,pointRadius,0,2*π)}function pointLineStart(x,y){context.moveTo(x,y);stream.point=pointLine}function pointLine(x,y){context.lineTo(x,y)}function lineEnd(){stream.point=point}function lineEndPolygon(){context.closePath()}var pointRadius=4.5,stream={point:point,lineStart:function(){stream.point=pointLineStart},lineEnd:lineEnd,polygonStart:function(){stream.lineEnd=lineEndPolygon},polygonEnd:function(){stream.lineEnd=lineEnd;stream.point=point},pointRadius:function(_){pointRadius=_;return stream},result:d3_noop};return stream}function d3_geo_resample(project){function resample(stream){function point(x,y){x=project(x,y);stream.point(x[0],x[1])}function lineStart(){x0=0/0;resample.point=linePoint;stream.lineStart()}function linePoint(λ,φ){var c=d3_geo_cartesian([λ,φ]),p=project(λ,φ);resampleLineTo(x0,y0,λ0,a0,b0,c0,x0=p[0],y0=p[1],λ0=λ,a0=c[0],b0=c[1],c0=c[2],maxDepth,stream);stream.point(x0,y0)}function lineEnd(){resample.point=point;stream.lineEnd()}function ringStart(){lineStart();resample.point=ringPoint;resample.lineEnd=ringEnd}function ringPoint(λ,φ){linePoint(λ00=λ,φ00=φ),x00=x0,y00=y0,a00=a0,b00=b0,c00=c0;resample.point=linePoint}function ringEnd(){resampleLineTo(x0,y0,λ0,a0,b0,c0,x00,y00,λ00,a00,b00,c00,maxDepth,stream);resample.lineEnd=lineEnd;lineEnd()}var λ00,φ00,x00,y00,a00,b00,c00,λ0,x0,y0,a0,b0,c0,resample={point:point,lineStart:lineStart,lineEnd:lineEnd,polygonStart:function(){stream.polygonStart();resample.lineStart=ringStart},polygonEnd:function(){stream.polygonEnd();resample.lineStart=lineStart}};return resample}function resampleLineTo(x0,y0,λ0,a0,b0,c0,x1,y1,λ1,a1,b1,c1,depth,stream){var dx=x1-x0,dy=y1-y0,d2=dx*dx+dy*dy;if(d2>4*δ2&&depth--){var a=a0+a1,b=b0+b1,c=c0+c1,m=Math.sqrt(a*a+b*b+c*c),φ2=Math.asin(c/=m),λ2=Math.abs(Math.abs(c)-1)<ε?(λ0+λ1)/2:Math.atan2(b,a),p=project(λ2,φ2),x2=p[0],y2=p[1],dx2=x2-x0,dy2=y2-y0,dz=dy*dx2-dx*dy2;if(dz*dz/d2>δ2||Math.abs((dx*dx2+dy*dy2)/d2-.5)>.3||cosMinDistance>a0*a1+b0*b1+c0*c1){resampleLineTo(x0,y0,λ0,a0,b0,c0,x2,y2,λ2,a/=m,b/=m,c,depth,stream);stream.point(x2,y2);resampleLineTo(x2,y2,λ2,a,b,c,x1,y1,λ1,a1,b1,c1,depth,stream)}}}var δ2=.5,cosMinDistance=Math.cos(30*d3_radians),maxDepth=16;resample.precision=function(_){if(!arguments.length)return Math.sqrt(δ2);maxDepth=(δ2=_*_)>0&&16;return resample};return resample}function d3_geo_transform(stream){this.stream=stream}function d3_geo_pathProjectStream(project){var resample=d3_geo_resample(function(x,y){return project([x*d3_degrees,y*d3_degrees])});return function(stream){var transform=new d3_geo_transform(stream=resample(stream));transform.point=function(x,y){stream.point(x*d3_radians,y*d3_radians)};return transform}}function d3_geo_projection(project){return d3_geo_projectionMutator(function(){return project})()}function d3_geo_projectionMutator(projectAt){function projection(point){point=projectRotate(point[0]*d3_radians,point[1]*d3_radians);return[point[0]*k+δx,δy-point[1]*k]}function invert(point){point=projectRotate.invert((point[0]-δx)/k,(δy-point[1])/k);return point&&[point[0]*d3_degrees,point[1]*d3_degrees]}function reset(){projectRotate=d3_geo_compose(rotate=d3_geo_rotation(δλ,δφ,δγ),project);var center=project(λ,φ);δx=x-center[0]*k;δy=y+center[1]*k;return invalidate()}function invalidate(){stream&&(stream.valid=!1,stream=null);return projection}var project,rotate,projectRotate,δx,δy,stream,projectResample=d3_geo_resample(function(x,y){x=project(x,y);return[x[0]*k+δx,δy-x[1]*k]}),k=150,x=480,y=250,λ=0,φ=0,δλ=0,δφ=0,δγ=0,preclip=d3_geo_clipAntimeridian,postclip=d3_identity,clipAngle=null,clipExtent=null;projection.stream=function(output){stream&&(stream.valid=!1);stream=d3_geo_projectionRadiansRotate(rotate,preclip(projectResample(postclip(output))));stream.valid=!0;return stream};projection.clipAngle=function(_){if(!arguments.length)return clipAngle;preclip=null==_?(clipAngle=_,d3_geo_clipAntimeridian):d3_geo_clipCircle((clipAngle=+_)*d3_radians);return invalidate()};projection.clipExtent=function(_){if(!arguments.length)return clipExtent;clipExtent=_;postclip=_?d3_geo_clipExtent(_[0][0],_[0][1],_[1][0],_[1][1]):d3_identity;return invalidate()};projection.scale=function(_){if(!arguments.length)return k;k=+_;return reset()};projection.translate=function(_){if(!arguments.length)return[x,y];x=+_[0];y=+_[1];return reset()};projection.center=function(_){if(!arguments.length)return[λ*d3_degrees,φ*d3_degrees];λ=_[0]%360*d3_radians;φ=_[1]%360*d3_radians;return reset()};projection.rotate=function(_){if(!arguments.length)return[δλ*d3_degrees,δφ*d3_degrees,δγ*d3_degrees];δλ=_[0]%360*d3_radians;δφ=_[1]%360*d3_radians;δγ=_.length>2?_[2]%360*d3_radians:0;return reset()};d3.rebind(projection,projectResample,"precision");return function(){project=projectAt.apply(this,arguments);projection.invert=project.invert&&invert;return reset()}}function d3_geo_projectionRadiansRotate(rotate,stream){var transform=new d3_geo_transform(stream);transform.point=function(x,y){y=rotate(x*d3_radians,y*d3_radians),x=y[0];stream.point(x>π?x-2*π:-π>x?x+2*π:x,y[1])};return transform}function d3_geo_equirectangular(λ,φ){return[λ,φ]}function d3_geo_rotation(δλ,δφ,δγ){return δλ?δφ||δγ?d3_geo_compose(d3_geo_rotationλ(δλ),d3_geo_rotationφγ(δφ,δγ)):d3_geo_rotationλ(δλ):δφ||δγ?d3_geo_rotationφγ(δφ,δγ):d3_geo_equirectangular}function d3_geo_forwardRotationλ(δλ){return function(λ,φ){return λ+=δλ,[λ>π?λ-2*π:-π>λ?λ+2*π:λ,φ]}}function d3_geo_rotationλ(δλ){var rotation=d3_geo_forwardRotationλ(δλ);rotation.invert=d3_geo_forwardRotationλ(-δλ);return rotation}function d3_geo_rotationφγ(δφ,δγ){function rotation(λ,φ){var cosφ=Math.cos(φ),x=Math.cos(λ)*cosφ,y=Math.sin(λ)*cosφ,z=Math.sin(φ),k=z*cosδφ+x*sinδφ;return[Math.atan2(y*cosδγ-k*sinδγ,x*cosδφ-z*sinδφ),d3_asin(k*cosδγ+y*sinδγ)]}var cosδφ=Math.cos(δφ),sinδφ=Math.sin(δφ),cosδγ=Math.cos(δγ),sinδγ=Math.sin(δγ);rotation.invert=function(λ,φ){var cosφ=Math.cos(φ),x=Math.cos(λ)*cosφ,y=Math.sin(λ)*cosφ,z=Math.sin(φ),k=z*cosδγ-y*sinδγ;return[Math.atan2(y*cosδγ+z*sinδγ,x*cosδφ+k*sinδφ),d3_asin(k*cosδφ-x*sinδφ)]};return rotation}function d3_geo_circleInterpolate(radius,precision){var cr=Math.cos(radius),sr=Math.sin(radius);return function(from,to,direction,listener){var step=direction*precision;if(null!=from){from=d3_geo_circleAngle(cr,from);to=d3_geo_circleAngle(cr,to);(direction>0?to>from:from>to)&&(from+=2*direction*π)}else{from=radius+2*direction*π;to=radius-.5*step}for(var point,t=from;direction>0?t>to:to>t;t-=step)listener.point((point=d3_geo_spherical([cr,-sr*Math.cos(t),-sr*Math.sin(t)]))[0],point[1])}}function d3_geo_circleAngle(cr,point){var a=d3_geo_cartesian(point);a[0]-=cr;d3_geo_cartesianNormalize(a);var angle=d3_acos(-a[1]);return((-a[2]<0?-angle:angle)+2*Math.PI-ε)%(2*Math.PI)}function d3_geo_graticuleX(y0,y1,dy){var y=d3.range(y0,y1-ε,dy).concat(y1);return function(x){return y.map(function(y){return[x,y]})}}function d3_geo_graticuleY(x0,x1,dx){var x=d3.range(x0,x1-ε,dx).concat(x1);return function(y){return x.map(function(x){return[x,y]})}}function d3_source(d){return d.source}function d3_target(d){return d.target}function d3_geo_interpolate(x0,y0,x1,y1){var cy0=Math.cos(y0),sy0=Math.sin(y0),cy1=Math.cos(y1),sy1=Math.sin(y1),kx0=cy0*Math.cos(x0),ky0=cy0*Math.sin(x0),kx1=cy1*Math.cos(x1),ky1=cy1*Math.sin(x1),d=2*Math.asin(Math.sqrt(d3_haversin(y1-y0)+cy0*cy1*d3_haversin(x1-x0))),k=1/Math.sin(d),interpolate=d?function(t){var B=Math.sin(t*=d)*k,A=Math.sin(d-t)*k,x=A*kx0+B*kx1,y=A*ky0+B*ky1,z=A*sy0+B*sy1;return[Math.atan2(y,x)*d3_degrees,Math.atan2(z,Math.sqrt(x*x+y*y))*d3_degrees]}:function(){return[x0*d3_degrees,y0*d3_degrees]};interpolate.distance=d;return interpolate}function d3_geo_lengthLineStart(){function nextPoint(λ,φ){var sinφ=Math.sin(φ*=d3_radians),cosφ=Math.cos(φ),t=Math.abs((λ*=d3_radians)-λ0),cosΔλ=Math.cos(t);d3_geo_lengthSum+=Math.atan2(Math.sqrt((t=cosφ*Math.sin(t))*t+(t=cosφ0*sinφ-sinφ0*cosφ*cosΔλ)*t),sinφ0*sinφ+cosφ0*cosφ*cosΔλ);λ0=λ,sinφ0=sinφ,cosφ0=cosφ}var λ0,sinφ0,cosφ0;d3_geo_length.point=function(λ,φ){λ0=λ*d3_radians,sinφ0=Math.sin(φ*=d3_radians),cosφ0=Math.cos(φ);d3_geo_length.point=nextPoint};d3_geo_length.lineEnd=function(){d3_geo_length.point=d3_geo_length.lineEnd=d3_noop}}function d3_geo_azimuthal(scale,angle){function azimuthal(λ,φ){var cosλ=Math.cos(λ),cosφ=Math.cos(φ),k=scale(cosλ*cosφ);return[k*cosφ*Math.sin(λ),k*Math.sin(φ)]}azimuthal.invert=function(x,y){var ρ=Math.sqrt(x*x+y*y),c=angle(ρ),sinc=Math.sin(c),cosc=Math.cos(c);return[Math.atan2(x*sinc,ρ*cosc),Math.asin(ρ&&y*sinc/ρ)]};return azimuthal}function d3_geo_conicConformal(φ0,φ1){function forward(λ,φ){var ρ=Math.abs(Math.abs(φ)-π/2)<ε?0:F/Math.pow(t(φ),n);return[ρ*Math.sin(n*λ),F-ρ*Math.cos(n*λ)]}var cosφ0=Math.cos(φ0),t=function(φ){return Math.tan(π/4+φ/2)},n=φ0===φ1?Math.sin(φ0):Math.log(cosφ0/Math.cos(φ1))/Math.log(t(φ1)/t(φ0)),F=cosφ0*Math.pow(t(φ0),n)/n;if(!n)return d3_geo_mercator;forward.invert=function(x,y){var ρ0_y=F-y,ρ=d3_sgn(n)*Math.sqrt(x*x+ρ0_y*ρ0_y);return[Math.atan2(x,ρ0_y)/n,2*Math.atan(Math.pow(F/ρ,1/n))-π/2]};return forward}function d3_geo_conicEquidistant(φ0,φ1){function forward(λ,φ){var ρ=G-φ;return[ρ*Math.sin(n*λ),G-ρ*Math.cos(n*λ)]}var cosφ0=Math.cos(φ0),n=φ0===φ1?Math.sin(φ0):(cosφ0-Math.cos(φ1))/(φ1-φ0),G=cosφ0/n+φ0;if(Math.abs(n)<ε)return d3_geo_equirectangular;forward.invert=function(x,y){var ρ0_y=G-y;return[Math.atan2(x,ρ0_y)/n,G-d3_sgn(n)*Math.sqrt(x*x+ρ0_y*ρ0_y)]};return forward}function d3_geo_mercator(λ,φ){return[λ,Math.log(Math.tan(π/4+φ/2))]}function d3_geo_mercatorProjection(project){var clipAuto,m=d3_geo_projection(project),scale=m.scale,translate=m.translate,clipExtent=m.clipExtent;m.scale=function(){var v=scale.apply(m,arguments);return v===m?clipAuto?m.clipExtent(null):m:v};m.translate=function(){var v=translate.apply(m,arguments);return v===m?clipAuto?m.clipExtent(null):m:v};m.clipExtent=function(_){var v=clipExtent.apply(m,arguments);if(v===m){if(clipAuto=null==_){var k=π*scale(),t=translate();clipExtent([[t[0]-k,t[1]-k],[t[0]+k,t[1]+k]])}}else clipAuto&&(v=null);return v};return m.clipExtent(null)}function d3_geo_transverseMercator(λ,φ){var B=Math.cos(φ)*Math.sin(λ);return[Math.log((1+B)/(1-B))/2,Math.atan2(Math.tan(φ),Math.cos(λ))]}function d3_svg_line(projection){function line(data){function segment(){segments.push("M",interpolate(projection(points),tension))}for(var d,segments=[],points=[],i=-1,n=data.length,fx=d3_functor(x),fy=d3_functor(y);++i<n;)if(defined.call(this,d=data[i],i))points.push([+fx.call(this,d,i),+fy.call(this,d,i)]);else if(points.length){segment();points=[]}points.length&&segment();return segments.length?segments.join(""):null}var x=d3_svg_lineX,y=d3_svg_lineY,defined=d3_true,interpolate=d3_svg_lineLinear,interpolateKey=interpolate.key,tension=.7;line.x=function(_){if(!arguments.length)return x;x=_;return line};line.y=function(_){if(!arguments.length)return y;y=_;return line};line.defined=function(_){if(!arguments.length)return defined;defined=_;return line};line.interpolate=function(_){if(!arguments.length)return interpolateKey;interpolateKey="function"==typeof _?interpolate=_:(interpolate=d3_svg_lineInterpolators.get(_)||d3_svg_lineLinear).key;return line};line.tension=function(_){if(!arguments.length)return tension;tension=_;return line};return line}function d3_svg_lineX(d){return d[0]}function d3_svg_lineY(d){return d[1]}function d3_svg_lineLinear(points){return points.join("L")}function d3_svg_lineLinearClosed(points){return d3_svg_lineLinear(points)+"Z"}function d3_svg_lineStep(points){for(var i=0,n=points.length,p=points[0],path=[p[0],",",p[1]];++i<n;)path.push("H",(p[0]+(p=points[i])[0])/2,"V",p[1]);n>1&&path.push("H",p[0]);return path.join("")}function d3_svg_lineStepBefore(points){for(var i=0,n=points.length,p=points[0],path=[p[0],",",p[1]];++i<n;)path.push("V",(p=points[i])[1],"H",p[0]);return path.join("")}function d3_svg_lineStepAfter(points){for(var i=0,n=points.length,p=points[0],path=[p[0],",",p[1]];++i<n;)path.push("H",(p=points[i])[0],"V",p[1]);return path.join("")}function d3_svg_lineCardinalOpen(points,tension){return points.length<4?d3_svg_lineLinear(points):points[1]+d3_svg_lineHermite(points.slice(1,points.length-1),d3_svg_lineCardinalTangents(points,tension))}function d3_svg_lineCardinalClosed(points,tension){return points.length<3?d3_svg_lineLinear(points):points[0]+d3_svg_lineHermite((points.push(points[0]),points),d3_svg_lineCardinalTangents([points[points.length-2]].concat(points,[points[1]]),tension))}function d3_svg_lineCardinal(points,tension){return points.length<3?d3_svg_lineLinear(points):points[0]+d3_svg_lineHermite(points,d3_svg_lineCardinalTangents(points,tension))}function d3_svg_lineHermite(points,tangents){if(tangents.length<1||points.length!=tangents.length&&points.length!=tangents.length+2)return d3_svg_lineLinear(points);var quad=points.length!=tangents.length,path="",p0=points[0],p=points[1],t0=tangents[0],t=t0,pi=1;if(quad){path+="Q"+(p[0]-2*t0[0]/3)+","+(p[1]-2*t0[1]/3)+","+p[0]+","+p[1];p0=points[1];pi=2}if(tangents.length>1){t=tangents[1];p=points[pi];pi++;path+="C"+(p0[0]+t0[0])+","+(p0[1]+t0[1])+","+(p[0]-t[0])+","+(p[1]-t[1])+","+p[0]+","+p[1];for(var i=2;i<tangents.length;i++,pi++){p=points[pi];t=tangents[i];path+="S"+(p[0]-t[0])+","+(p[1]-t[1])+","+p[0]+","+p[1]}}if(quad){var lp=points[pi];path+="Q"+(p[0]+2*t[0]/3)+","+(p[1]+2*t[1]/3)+","+lp[0]+","+lp[1]}return path}function d3_svg_lineCardinalTangents(points,tension){for(var p0,tangents=[],a=(1-tension)/2,p1=points[0],p2=points[1],i=1,n=points.length;++i<n;){p0=p1;p1=p2;p2=points[i];tangents.push([a*(p2[0]-p0[0]),a*(p2[1]-p0[1])])}return tangents}function d3_svg_lineBasis(points){if(points.length<3)return d3_svg_lineLinear(points);var i=1,n=points.length,pi=points[0],x0=pi[0],y0=pi[1],px=[x0,x0,x0,(pi=points[1])[0]],py=[y0,y0,y0,pi[1]],path=[x0,",",y0,"L",d3_svg_lineDot4(d3_svg_lineBasisBezier3,px),",",d3_svg_lineDot4(d3_svg_lineBasisBezier3,py)];points.push(points[n-1]);for(;++i<=n;){pi=points[i];px.shift();px.push(pi[0]);py.shift();py.push(pi[1]);d3_svg_lineBasisBezier(path,px,py)}points.pop();path.push("L",pi);return path.join("")}function d3_svg_lineBasisOpen(points){if(points.length<4)return d3_svg_lineLinear(points);for(var pi,path=[],i=-1,n=points.length,px=[0],py=[0];++i<3;){pi=points[i];px.push(pi[0]);py.push(pi[1])}path.push(d3_svg_lineDot4(d3_svg_lineBasisBezier3,px)+","+d3_svg_lineDot4(d3_svg_lineBasisBezier3,py));--i;for(;++i<n;){pi=points[i];px.shift();px.push(pi[0]);py.shift();py.push(pi[1]);d3_svg_lineBasisBezier(path,px,py)}return path.join("")}function d3_svg_lineBasisClosed(points){for(var path,pi,i=-1,n=points.length,m=n+4,px=[],py=[];++i<4;){pi=points[i%n];px.push(pi[0]);py.push(pi[1])}path=[d3_svg_lineDot4(d3_svg_lineBasisBezier3,px),",",d3_svg_lineDot4(d3_svg_lineBasisBezier3,py)];--i;for(;++i<m;){pi=points[i%n];px.shift();px.push(pi[0]);py.shift();py.push(pi[1]);d3_svg_lineBasisBezier(path,px,py)}return path.join("")}function d3_svg_lineBundle(points,tension){var n=points.length-1;if(n)for(var p,t,x0=points[0][0],y0=points[0][1],dx=points[n][0]-x0,dy=points[n][1]-y0,i=-1;++i<=n;){p=points[i];t=i/n;p[0]=tension*p[0]+(1-tension)*(x0+t*dx);p[1]=tension*p[1]+(1-tension)*(y0+t*dy)}return d3_svg_lineBasis(points)}function d3_svg_lineDot4(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]}function d3_svg_lineBasisBezier(path,x,y){path.push("C",d3_svg_lineDot4(d3_svg_lineBasisBezier1,x),",",d3_svg_lineDot4(d3_svg_lineBasisBezier1,y),",",d3_svg_lineDot4(d3_svg_lineBasisBezier2,x),",",d3_svg_lineDot4(d3_svg_lineBasisBezier2,y),",",d3_svg_lineDot4(d3_svg_lineBasisBezier3,x),",",d3_svg_lineDot4(d3_svg_lineBasisBezier3,y))}function d3_svg_lineSlope(p0,p1){return(p1[1]-p0[1])/(p1[0]-p0[0])}function d3_svg_lineFiniteDifferences(points){for(var i=0,j=points.length-1,m=[],p0=points[0],p1=points[1],d=m[0]=d3_svg_lineSlope(p0,p1);++i<j;)m[i]=(d+(d=d3_svg_lineSlope(p0=p1,p1=points[i+1])))/2;m[i]=d;return m}function d3_svg_lineMonotoneTangents(points){for(var d,a,b,s,tangents=[],m=d3_svg_lineFiniteDifferences(points),i=-1,j=points.length-1;++i<j;){d=d3_svg_lineSlope(points[i],points[i+1]);if(Math.abs(d)<1e-6)m[i]=m[i+1]=0;else{a=m[i]/d;b=m[i+1]/d;s=a*a+b*b;if(s>9){s=3*d/Math.sqrt(s);m[i]=s*a;m[i+1]=s*b}}}i=-1;for(;++i<=j;){s=(points[Math.min(j,i+1)][0]-points[Math.max(0,i-1)][0])/(6*(1+m[i]*m[i]));tangents.push([s||0,m[i]*s||0])}return tangents}function d3_svg_lineMonotone(points){return points.length<3?d3_svg_lineLinear(points):points[0]+d3_svg_lineHermite(points,d3_svg_lineMonotoneTangents(points))}function d3_geom_hullCCW(i1,i2,i3,v){var t,a,b,c,d,e,f;t=v[i1];a=t[0];b=t[1];t=v[i2];c=t[0];d=t[1];t=v[i3];e=t[0];f=t[1];return(f-b)*(c-a)-(d-b)*(e-a)>0}function d3_geom_polygonInside(p,a,b){return(b[0]-a[0])*(p[1]-a[1])<(b[1]-a[1])*(p[0]-a[0])}function d3_geom_polygonIntersect(c,d,a,b){var x1=c[0],x3=a[0],x21=d[0]-x1,x43=b[0]-x3,y1=c[1],y3=a[1],y21=d[1]-y1,y43=b[1]-y3,ua=(x43*(y1-y3)-y43*(x1-x3))/(y43*x21-x43*y21);return[x1+ua*x21,y1+ua*y21]}function d3_geom_polygonClosed(coordinates){var a=coordinates[0],b=coordinates[coordinates.length-1];return!(a[0]-b[0]||a[1]-b[1])}function d3_geom_voronoiTessellate(points,callback){var Sites={list:points.map(function(v,i){return{index:i,x:v[0],y:v[1]}}).sort(function(a,b){return a.y<b.y?-1:a.y>b.y?1:a.x<b.x?-1:a.x>b.x?1:0}),bottomSite:null},EdgeList={list:[],leftEnd:null,rightEnd:null,init:function(){EdgeList.leftEnd=EdgeList.createHalfEdge(null,"l");EdgeList.rightEnd=EdgeList.createHalfEdge(null,"l");EdgeList.leftEnd.r=EdgeList.rightEnd;
EdgeList.rightEnd.l=EdgeList.leftEnd;EdgeList.list.unshift(EdgeList.leftEnd,EdgeList.rightEnd)},createHalfEdge:function(edge,side){return{edge:edge,side:side,vertex:null,l:null,r:null}},insert:function(lb,he){he.l=lb;he.r=lb.r;lb.r.l=he;lb.r=he},leftBound:function(p){var he=EdgeList.leftEnd;do he=he.r;while(he!=EdgeList.rightEnd&&Geom.rightOf(he,p));he=he.l;return he},del:function(he){he.l.r=he.r;he.r.l=he.l;he.edge=null},right:function(he){return he.r},left:function(he){return he.l},leftRegion:function(he){return null==he.edge?Sites.bottomSite:he.edge.region[he.side]},rightRegion:function(he){return null==he.edge?Sites.bottomSite:he.edge.region[d3_geom_voronoiOpposite[he.side]]}},Geom={bisect:function(s1,s2){var newEdge={region:{l:s1,r:s2},ep:{l:null,r:null}},dx=s2.x-s1.x,dy=s2.y-s1.y,adx=dx>0?dx:-dx,ady=dy>0?dy:-dy;newEdge.c=s1.x*dx+s1.y*dy+.5*(dx*dx+dy*dy);if(adx>ady){newEdge.a=1;newEdge.b=dy/dx;newEdge.c/=dx}else{newEdge.b=1;newEdge.a=dx/dy;newEdge.c/=dy}return newEdge},intersect:function(el1,el2){var e1=el1.edge,e2=el2.edge;if(!e1||!e2||e1.region.r==e2.region.r)return null;var d=e1.a*e2.b-e1.b*e2.a;if(Math.abs(d)<1e-10)return null;var el,e,xint=(e1.c*e2.b-e2.c*e1.b)/d,yint=(e2.c*e1.a-e1.c*e2.a)/d,e1r=e1.region.r,e2r=e2.region.r;if(e1r.y<e2r.y||e1r.y==e2r.y&&e1r.x<e2r.x){el=el1;e=e1}else{el=el2;e=e2}var rightOfSite=xint>=e.region.r.x;return rightOfSite&&"l"===el.side||!rightOfSite&&"r"===el.side?null:{x:xint,y:yint}},rightOf:function(he,p){var e=he.edge,topsite=e.region.r,rightOfSite=p.x>topsite.x;if(rightOfSite&&"l"===he.side)return 1;if(!rightOfSite&&"r"===he.side)return 0;if(1===e.a){var dyp=p.y-topsite.y,dxp=p.x-topsite.x,fast=0,above=0;if(!rightOfSite&&e.b<0||rightOfSite&&e.b>=0)above=fast=dyp>=e.b*dxp;else{above=p.x+p.y*e.b>e.c;e.b<0&&(above=!above);above||(fast=1)}if(!fast){var dxs=topsite.x-e.region.l.x;above=e.b*(dxp*dxp-dyp*dyp)<dxs*dyp*(1+2*dxp/dxs+e.b*e.b);e.b<0&&(above=!above)}}else{var yl=e.c-e.a*p.x,t1=p.y-yl,t2=p.x-topsite.x,t3=yl-topsite.y;above=t1*t1>t2*t2+t3*t3}return"l"===he.side?above:!above},endPoint:function(edge,side,site){edge.ep[side]=site;edge.ep[d3_geom_voronoiOpposite[side]]&&callback(edge)},distance:function(s,t){var dx=s.x-t.x,dy=s.y-t.y;return Math.sqrt(dx*dx+dy*dy)}},EventQueue={list:[],insert:function(he,site,offset){he.vertex=site;he.ystar=site.y+offset;for(var i=0,list=EventQueue.list,l=list.length;l>i;i++){var next=list[i];if(!(he.ystar>next.ystar||he.ystar==next.ystar&&site.x>next.vertex.x))break}list.splice(i,0,he)},del:function(he){for(var i=0,ls=EventQueue.list,l=ls.length;l>i&&ls[i]!=he;++i);ls.splice(i,1)},empty:function(){return 0===EventQueue.list.length},nextEvent:function(he){for(var i=0,ls=EventQueue.list,l=ls.length;l>i;++i)if(ls[i]==he)return ls[i+1];return null},min:function(){var elem=EventQueue.list[0];return{x:elem.vertex.x,y:elem.ystar}},extractMin:function(){return EventQueue.list.shift()}};EdgeList.init();Sites.bottomSite=Sites.list.shift();for(var newIntStar,lbnd,rbnd,llbnd,rrbnd,bisector,bot,top,temp,p,v,e,pm,newSite=Sites.list.shift();;){EventQueue.empty()||(newIntStar=EventQueue.min());if(newSite&&(EventQueue.empty()||newSite.y<newIntStar.y||newSite.y==newIntStar.y&&newSite.x<newIntStar.x)){lbnd=EdgeList.leftBound(newSite);rbnd=EdgeList.right(lbnd);bot=EdgeList.rightRegion(lbnd);e=Geom.bisect(bot,newSite);bisector=EdgeList.createHalfEdge(e,"l");EdgeList.insert(lbnd,bisector);p=Geom.intersect(lbnd,bisector);if(p){EventQueue.del(lbnd);EventQueue.insert(lbnd,p,Geom.distance(p,newSite))}lbnd=bisector;bisector=EdgeList.createHalfEdge(e,"r");EdgeList.insert(lbnd,bisector);p=Geom.intersect(bisector,rbnd);p&&EventQueue.insert(bisector,p,Geom.distance(p,newSite));newSite=Sites.list.shift()}else{if(EventQueue.empty())break;lbnd=EventQueue.extractMin();llbnd=EdgeList.left(lbnd);rbnd=EdgeList.right(lbnd);rrbnd=EdgeList.right(rbnd);bot=EdgeList.leftRegion(lbnd);top=EdgeList.rightRegion(rbnd);v=lbnd.vertex;Geom.endPoint(lbnd.edge,lbnd.side,v);Geom.endPoint(rbnd.edge,rbnd.side,v);EdgeList.del(lbnd);EventQueue.del(rbnd);EdgeList.del(rbnd);pm="l";if(bot.y>top.y){temp=bot;bot=top;top=temp;pm="r"}e=Geom.bisect(bot,top);bisector=EdgeList.createHalfEdge(e,pm);EdgeList.insert(llbnd,bisector);Geom.endPoint(e,d3_geom_voronoiOpposite[pm],v);p=Geom.intersect(llbnd,bisector);if(p){EventQueue.del(llbnd);EventQueue.insert(llbnd,p,Geom.distance(p,bot))}p=Geom.intersect(bisector,rrbnd);p&&EventQueue.insert(bisector,p,Geom.distance(p,bot))}}for(lbnd=EdgeList.right(EdgeList.leftEnd);lbnd!=EdgeList.rightEnd;lbnd=EdgeList.right(lbnd))callback(lbnd.edge)}function d3_geom_quadtreeCompatX(d){return d.x}function d3_geom_quadtreeCompatY(d){return d.y}function d3_geom_quadtreeNode(){return{leaf:!0,nodes:[],point:null,x:null,y:null}}function d3_geom_quadtreeVisit(f,node,x1,y1,x2,y2){if(!f(node,x1,y1,x2,y2)){var sx=.5*(x1+x2),sy=.5*(y1+y2),children=node.nodes;children[0]&&d3_geom_quadtreeVisit(f,children[0],x1,y1,sx,sy);children[1]&&d3_geom_quadtreeVisit(f,children[1],sx,y1,x2,sy);children[2]&&d3_geom_quadtreeVisit(f,children[2],x1,sy,sx,y2);children[3]&&d3_geom_quadtreeVisit(f,children[3],sx,sy,x2,y2)}}function d3_interpolateRgb(a,b){a=d3.rgb(a);b=d3.rgb(b);var ar=a.r,ag=a.g,ab=a.b,br=b.r-ar,bg=b.g-ag,bb=b.b-ab;return function(t){return"#"+d3_rgb_hex(Math.round(ar+br*t))+d3_rgb_hex(Math.round(ag+bg*t))+d3_rgb_hex(Math.round(ab+bb*t))}}function d3_interpolateObject(a,b){var k,i={},c={};for(k in a)k in b?i[k]=d3_interpolate(a[k],b[k]):c[k]=a[k];for(k in b)k in a||(c[k]=b[k]);return function(t){for(k in i)c[k]=i[k](t);return c}}function d3_interpolateNumber(a,b){b-=a=+a;return function(t){return a+b*t}}function d3_interpolateString(a,b){var m,i,j,n,o,s0=0,s1=0,s=[],q=[];a+="",b+="";d3_interpolate_number.lastIndex=0;for(i=0;m=d3_interpolate_number.exec(b);++i){m.index&&s.push(b.substring(s0,s1=m.index));q.push({i:s.length,x:m[0]});s.push(null);s0=d3_interpolate_number.lastIndex}s0<b.length&&s.push(b.substring(s0));for(i=0,n=q.length;(m=d3_interpolate_number.exec(a))&&n>i;++i){o=q[i];if(o.x==m[0]){if(o.i)if(null==s[o.i+1]){s[o.i-1]+=o.x;s.splice(o.i,1);for(j=i+1;n>j;++j)q[j].i--}else{s[o.i-1]+=o.x+s[o.i+1];s.splice(o.i,2);for(j=i+1;n>j;++j)q[j].i-=2}else if(null==s[o.i+1])s[o.i]=o.x;else{s[o.i]=o.x+s[o.i+1];s.splice(o.i+1,1);for(j=i+1;n>j;++j)q[j].i--}q.splice(i,1);n--;i--}else o.x=d3_interpolateNumber(parseFloat(m[0]),parseFloat(o.x))}for(;n>i;){o=q.pop();if(null==s[o.i+1])s[o.i]=o.x;else{s[o.i]=o.x+s[o.i+1];s.splice(o.i+1,1)}n--}return 1===s.length?null==s[0]?(o=q[0].x,function(t){return o(t)+""}):function(){return b}:function(t){for(i=0;n>i;++i)s[(o=q[i]).i]=o.x(t);return s.join("")}}function d3_interpolate(a,b){for(var f,i=d3.interpolators.length;--i>=0&&!(f=d3.interpolators[i](a,b)););return f}function d3_interpolateArray(a,b){var i,x=[],c=[],na=a.length,nb=b.length,n0=Math.min(a.length,b.length);for(i=0;n0>i;++i)x.push(d3_interpolate(a[i],b[i]));for(;na>i;++i)c[i]=a[i];for(;nb>i;++i)c[i]=b[i];return function(t){for(i=0;n0>i;++i)c[i]=x[i](t);return c}}function d3_ease_clamp(f){return function(t){return 0>=t?0:t>=1?1:f(t)}}function d3_ease_reverse(f){return function(t){return 1-f(1-t)}}function d3_ease_reflect(f){return function(t){return.5*(.5>t?f(2*t):2-f(2-2*t))}}function d3_ease_quad(t){return t*t}function d3_ease_cubic(t){return t*t*t}function d3_ease_cubicInOut(t){if(0>=t)return 0;if(t>=1)return 1;var t2=t*t,t3=t2*t;return 4*(.5>t?t3:3*(t-t2)+t3-.75)}function d3_ease_poly(e){return function(t){return Math.pow(t,e)}}function d3_ease_sin(t){return 1-Math.cos(t*π/2)}function d3_ease_exp(t){return Math.pow(2,10*(t-1))}function d3_ease_circle(t){return 1-Math.sqrt(1-t*t)}function d3_ease_elastic(a,p){var s;arguments.length<2&&(p=.45);arguments.length?s=p/(2*π)*Math.asin(1/a):(a=1,s=p/4);return function(t){return 1+a*Math.pow(2,10*-t)*Math.sin(2*(t-s)*π/p)}}function d3_ease_back(s){s||(s=1.70158);return function(t){return t*t*((s+1)*t-s)}}function d3_ease_bounce(t){return 1/2.75>t?7.5625*t*t:2/2.75>t?7.5625*(t-=1.5/2.75)*t+.75:2.5/2.75>t?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}function d3_interpolateHcl(a,b){a=d3.hcl(a);b=d3.hcl(b);var ah=a.h,ac=a.c,al=a.l,bh=b.h-ah,bc=b.c-ac,bl=b.l-al;isNaN(bc)&&(bc=0,ac=isNaN(ac)?b.c:ac);isNaN(bh)?(bh=0,ah=isNaN(ah)?b.h:ah):bh>180?bh-=360:-180>bh&&(bh+=360);return function(t){return d3_hcl_lab(ah+bh*t,ac+bc*t,al+bl*t)+""}}function d3_interpolateHsl(a,b){a=d3.hsl(a);b=d3.hsl(b);var ah=a.h,as=a.s,al=a.l,bh=b.h-ah,bs=b.s-as,bl=b.l-al;isNaN(bs)&&(bs=0,as=isNaN(as)?b.s:as);isNaN(bh)?(bh=0,ah=isNaN(ah)?b.h:ah):bh>180?bh-=360:-180>bh&&(bh+=360);return function(t){return d3_hsl_rgb(ah+bh*t,as+bs*t,al+bl*t)+""}}function d3_interpolateLab(a,b){a=d3.lab(a);b=d3.lab(b);var al=a.l,aa=a.a,ab=a.b,bl=b.l-al,ba=b.a-aa,bb=b.b-ab;return function(t){return d3_lab_rgb(al+bl*t,aa+ba*t,ab+bb*t)+""}}function d3_interpolateRound(a,b){b-=a;return function(t){return Math.round(a+b*t)}}function d3_transform(m){var r0=[m.a,m.b],r1=[m.c,m.d],kx=d3_transformNormalize(r0),kz=d3_transformDot(r0,r1),ky=d3_transformNormalize(d3_transformCombine(r1,r0,-kz))||0;if(r0[0]*r1[1]<r1[0]*r0[1]){r0[0]*=-1;r0[1]*=-1;kx*=-1;kz*=-1}this.rotate=(kx?Math.atan2(r0[1],r0[0]):Math.atan2(-r1[0],r1[1]))*d3_degrees;this.translate=[m.e,m.f];this.scale=[kx,ky];this.skew=ky?Math.atan2(kz,ky)*d3_degrees:0}function d3_transformDot(a,b){return a[0]*b[0]+a[1]*b[1]}function d3_transformNormalize(a){var k=Math.sqrt(d3_transformDot(a,a));if(k){a[0]/=k;a[1]/=k}return k}function d3_transformCombine(a,b,k){a[0]+=k*b[0];a[1]+=k*b[1];return a}function d3_interpolateTransform(a,b){var n,s=[],q=[],A=d3.transform(a),B=d3.transform(b),ta=A.translate,tb=B.translate,ra=A.rotate,rb=B.rotate,wa=A.skew,wb=B.skew,ka=A.scale,kb=B.scale;if(ta[0]!=tb[0]||ta[1]!=tb[1]){s.push("translate(",null,",",null,")");q.push({i:1,x:d3_interpolateNumber(ta[0],tb[0])},{i:3,x:d3_interpolateNumber(ta[1],tb[1])})}else s.push(tb[0]||tb[1]?"translate("+tb+")":"");if(ra!=rb){ra-rb>180?rb+=360:rb-ra>180&&(ra+=360);q.push({i:s.push(s.pop()+"rotate(",null,")")-2,x:d3_interpolateNumber(ra,rb)})}else rb&&s.push(s.pop()+"rotate("+rb+")");wa!=wb?q.push({i:s.push(s.pop()+"skewX(",null,")")-2,x:d3_interpolateNumber(wa,wb)}):wb&&s.push(s.pop()+"skewX("+wb+")");if(ka[0]!=kb[0]||ka[1]!=kb[1]){n=s.push(s.pop()+"scale(",null,",",null,")");q.push({i:n-4,x:d3_interpolateNumber(ka[0],kb[0])},{i:n-2,x:d3_interpolateNumber(ka[1],kb[1])})}else(1!=kb[0]||1!=kb[1])&&s.push(s.pop()+"scale("+kb+")");n=q.length;return function(t){for(var o,i=-1;++i<n;)s[(o=q[i]).i]=o.x(t);return s.join("")}}function d3_uninterpolateNumber(a,b){b=b-(a=+a)?1/(b-a):0;return function(x){return(x-a)*b}}function d3_uninterpolateClamp(a,b){b=b-(a=+a)?1/(b-a):0;return function(x){return Math.max(0,Math.min(1,(x-a)*b))}}function d3_layout_bundlePath(link){for(var start=link.source,end=link.target,lca=d3_layout_bundleLeastCommonAncestor(start,end),points=[start];start!==lca;){start=start.parent;points.push(start)}for(var k=points.length;end!==lca;){points.splice(k,0,end);end=end.parent}return points}function d3_layout_bundleAncestors(node){for(var ancestors=[],parent=node.parent;null!=parent;){ancestors.push(node);node=parent;parent=parent.parent}ancestors.push(node);return ancestors}function d3_layout_bundleLeastCommonAncestor(a,b){if(a===b)return a;for(var aNodes=d3_layout_bundleAncestors(a),bNodes=d3_layout_bundleAncestors(b),aNode=aNodes.pop(),bNode=bNodes.pop(),sharedNode=null;aNode===bNode;){sharedNode=aNode;aNode=aNodes.pop();bNode=bNodes.pop()}return sharedNode}function d3_layout_forceDragstart(d){d.fixed|=2}function d3_layout_forceDragend(d){d.fixed&=-7}function d3_layout_forceMouseover(d){d.fixed|=4;d.px=d.x,d.py=d.y}function d3_layout_forceMouseout(d){d.fixed&=-5}function d3_layout_forceAccumulate(quad,alpha,charges){var cx=0,cy=0;quad.charge=0;if(!quad.leaf)for(var c,nodes=quad.nodes,n=nodes.length,i=-1;++i<n;){c=nodes[i];if(null!=c){d3_layout_forceAccumulate(c,alpha,charges);quad.charge+=c.charge;cx+=c.charge*c.cx;cy+=c.charge*c.cy}}if(quad.point){if(!quad.leaf){quad.point.x+=Math.random()-.5;quad.point.y+=Math.random()-.5}var k=alpha*charges[quad.point.index];quad.charge+=quad.pointCharge=k;cx+=k*quad.point.x;cy+=k*quad.point.y}quad.cx=cx/quad.charge;quad.cy=cy/quad.charge}function d3_layout_hierarchyRebind(object,hierarchy){d3.rebind(object,hierarchy,"sort","children","value");object.nodes=object;object.links=d3_layout_hierarchyLinks;return object}function d3_layout_hierarchyChildren(d){return d.children}function d3_layout_hierarchyValue(d){return d.value}function d3_layout_hierarchySort(a,b){return b.value-a.value}function d3_layout_hierarchyLinks(nodes){return d3.merge(nodes.map(function(parent){return(parent.children||[]).map(function(child){return{source:parent,target:child}})}))}function d3_layout_stackX(d){return d.x}function d3_layout_stackY(d){return d.y}function d3_layout_stackOut(d,y0,y){d.y0=y0;d.y=y}function d3_layout_stackOrderDefault(data){return d3.range(data.length)}function d3_layout_stackOffsetZero(data){for(var j=-1,m=data[0].length,y0=[];++j<m;)y0[j]=0;return y0}function d3_layout_stackMaxIndex(array){for(var k,i=1,j=0,v=array[0][1],n=array.length;n>i;++i)if((k=array[i][1])>v){j=i;v=k}return j}function d3_layout_stackReduceSum(d){return d.reduce(d3_layout_stackSum,0)}function d3_layout_stackSum(p,d){return p+d[1]}function d3_layout_histogramBinSturges(range,values){return d3_layout_histogramBinFixed(range,Math.ceil(Math.log(values.length)/Math.LN2+1))}function d3_layout_histogramBinFixed(range,n){for(var x=-1,b=+range[0],m=(range[1]-b)/n,f=[];++x<=n;)f[x]=m*x+b;return f}function d3_layout_histogramRange(values){return[d3.min(values),d3.max(values)]}function d3_layout_treeSeparation(a,b){return a.parent==b.parent?1:2}function d3_layout_treeLeft(node){var children=node.children;return children&&children.length?children[0]:node._tree.thread}function d3_layout_treeRight(node){var n,children=node.children;return children&&(n=children.length)?children[n-1]:node._tree.thread}function d3_layout_treeSearch(node,compare){var children=node.children;if(children&&(n=children.length))for(var child,n,i=-1;++i<n;)compare(child=d3_layout_treeSearch(children[i],compare),node)>0&&(node=child);return node}function d3_layout_treeRightmost(a,b){return a.x-b.x}function d3_layout_treeLeftmost(a,b){return b.x-a.x}function d3_layout_treeDeepest(a,b){return a.depth-b.depth}function d3_layout_treeVisitAfter(node,callback){function visit(node,previousSibling){var children=node.children;if(children&&(n=children.length))for(var child,n,previousChild=null,i=-1;++i<n;){child=children[i];visit(child,previousChild);previousChild=child}callback(node,previousSibling)}visit(node,null)}function d3_layout_treeShift(node){for(var child,shift=0,change=0,children=node.children,i=children.length;--i>=0;){child=children[i]._tree;child.prelim+=shift;child.mod+=shift;shift+=child.shift+(change+=child.change)}}function d3_layout_treeMove(ancestor,node,shift){ancestor=ancestor._tree;node=node._tree;var change=shift/(node.number-ancestor.number);ancestor.change+=change;node.change-=change;node.shift+=shift;node.prelim+=shift;node.mod+=shift}function d3_layout_treeAncestor(vim,node,ancestor){return vim._tree.ancestor.parent==node.parent?vim._tree.ancestor:ancestor}function d3_layout_packSort(a,b){return a.value-b.value}function d3_layout_packInsert(a,b){var c=a._pack_next;a._pack_next=b;b._pack_prev=a;b._pack_next=c;c._pack_prev=b}function d3_layout_packSplice(a,b){a._pack_next=b;b._pack_prev=a}function d3_layout_packIntersects(a,b){var dx=b.x-a.x,dy=b.y-a.y,dr=a.r+b.r;return.999*dr*dr>dx*dx+dy*dy}function d3_layout_packSiblings(node){function bound(node){xMin=Math.min(node.x-node.r,xMin);xMax=Math.max(node.x+node.r,xMax);yMin=Math.min(node.y-node.r,yMin);yMax=Math.max(node.y+node.r,yMax)}if((nodes=node.children)&&(n=nodes.length)){var nodes,a,b,c,i,j,k,n,xMin=1/0,xMax=-1/0,yMin=1/0,yMax=-1/0;nodes.forEach(d3_layout_packLink);a=nodes[0];a.x=-a.r;a.y=0;bound(a);if(n>1){b=nodes[1];b.x=b.r;b.y=0;bound(b);if(n>2){c=nodes[2];d3_layout_packPlace(a,b,c);bound(c);d3_layout_packInsert(a,c);a._pack_prev=c;d3_layout_packInsert(c,b);b=a._pack_next;for(i=3;n>i;i++){d3_layout_packPlace(a,b,c=nodes[i]);var isect=0,s1=1,s2=1;for(j=b._pack_next;j!==b;j=j._pack_next,s1++)if(d3_layout_packIntersects(j,c)){isect=1;break}if(1==isect)for(k=a._pack_prev;k!==j._pack_prev&&!d3_layout_packIntersects(k,c);k=k._pack_prev,s2++);if(isect){s2>s1||s1==s2&&b.r<a.r?d3_layout_packSplice(a,b=j):d3_layout_packSplice(a=k,b);i--}else{d3_layout_packInsert(a,c);b=c;bound(c)}}}}var cx=(xMin+xMax)/2,cy=(yMin+yMax)/2,cr=0;for(i=0;n>i;i++){c=nodes[i];c.x-=cx;c.y-=cy;cr=Math.max(cr,c.r+Math.sqrt(c.x*c.x+c.y*c.y))}node.r=cr;nodes.forEach(d3_layout_packUnlink)}}function d3_layout_packLink(node){node._pack_next=node._pack_prev=node}function d3_layout_packUnlink(node){delete node._pack_next;delete node._pack_prev}function d3_layout_packTransform(node,x,y,k){var children=node.children;node.x=x+=k*node.x;node.y=y+=k*node.y;node.r*=k;if(children)for(var i=-1,n=children.length;++i<n;)d3_layout_packTransform(children[i],x,y,k)}function d3_layout_packPlace(a,b,c){var db=a.r+c.r,dx=b.x-a.x,dy=b.y-a.y;if(db&&(dx||dy)){var da=b.r+c.r,dc=dx*dx+dy*dy;da*=da;db*=db;var x=.5+(db-da)/(2*dc),y=Math.sqrt(Math.max(0,2*da*(db+dc)-(db-=dc)*db-da*da))/(2*dc);c.x=a.x+x*dx+y*dy;c.y=a.y+x*dy-y*dx}else{c.x=a.x+db;c.y=a.y}}function d3_layout_clusterY(children){return 1+d3.max(children,function(child){return child.y})}function d3_layout_clusterX(children){return children.reduce(function(x,child){return x+child.x},0)/children.length}function d3_layout_clusterLeft(node){var children=node.children;return children&&children.length?d3_layout_clusterLeft(children[0]):node}function d3_layout_clusterRight(node){var n,children=node.children;return children&&(n=children.length)?d3_layout_clusterRight(children[n-1]):node}function d3_layout_treemapPadNull(node){return{x:node.x,y:node.y,dx:node.dx,dy:node.dy}}function d3_layout_treemapPad(node,padding){var x=node.x+padding[3],y=node.y+padding[0],dx=node.dx-padding[1]-padding[3],dy=node.dy-padding[0]-padding[2];if(0>dx){x+=dx/2;dx=0}if(0>dy){y+=dy/2;dy=0}return{x:x,y:y,dx:dx,dy:dy}}function d3_scaleExtent(domain){var start=domain[0],stop=domain[domain.length-1];return stop>start?[start,stop]:[stop,start]}function d3_scaleRange(scale){return scale.rangeExtent?scale.rangeExtent():d3_scaleExtent(scale.range())}function d3_scale_bilinear(domain,range,uninterpolate,interpolate){var u=uninterpolate(domain[0],domain[1]),i=interpolate(range[0],range[1]);return function(x){return i(u(x))}}function d3_scale_nice(domain,nice){var dx,i0=0,i1=domain.length-1,x0=domain[i0],x1=domain[i1];if(x0>x1){dx=i0,i0=i1,i1=dx;dx=x0,x0=x1,x1=dx}domain[i0]=nice.floor(x0);domain[i1]=nice.ceil(x1);return domain}function d3_scale_niceStep(step){return step?{floor:function(x){return Math.floor(x/step)*step},ceil:function(x){return Math.ceil(x/step)*step}}:d3_scale_niceIdentity}function d3_scale_polylinear(domain,range,uninterpolate,interpolate){var u=[],i=[],j=0,k=Math.min(domain.length,range.length)-1;if(domain[k]<domain[0]){domain=domain.slice().reverse();range=range.slice().reverse()}for(;++j<=k;){u.push(uninterpolate(domain[j-1],domain[j]));i.push(interpolate(range[j-1],range[j]))}return function(x){var j=d3.bisect(domain,x,1,k)-1;return i[j](u[j](x))}}function d3_scale_linear(domain,range,interpolate,clamp){function rescale(){var linear=Math.min(domain.length,range.length)>2?d3_scale_polylinear:d3_scale_bilinear,uninterpolate=clamp?d3_uninterpolateClamp:d3_uninterpolateNumber;output=linear(domain,range,uninterpolate,interpolate);input=linear(range,domain,uninterpolate,d3_interpolate);return scale}function scale(x){return output(x)}var output,input;scale.invert=function(y){return input(y)};scale.domain=function(x){if(!arguments.length)return domain;domain=x.map(Number);return rescale()};scale.range=function(x){if(!arguments.length)return range;range=x;return rescale()};scale.rangeRound=function(x){return scale.range(x).interpolate(d3_interpolateRound)};scale.clamp=function(x){if(!arguments.length)return clamp;clamp=x;return rescale()};scale.interpolate=function(x){if(!arguments.length)return interpolate;interpolate=x;return rescale()};scale.ticks=function(m){return d3_scale_linearTicks(domain,m)};scale.tickFormat=function(m,format){return d3_scale_linearTickFormat(domain,m,format)};scale.nice=function(m){d3_scale_linearNice(domain,m);return rescale()};scale.copy=function(){return d3_scale_linear(domain,range,interpolate,clamp)};return rescale()}function d3_scale_linearRebind(scale,linear){return d3.rebind(scale,linear,"range","rangeRound","interpolate","clamp")}function d3_scale_linearNice(domain,m){return d3_scale_nice(domain,d3_scale_niceStep(d3_scale_linearTickRange(domain,m)[2]))}function d3_scale_linearTickRange(domain,m){null==m&&(m=10);var extent=d3_scaleExtent(domain),span=extent[1]-extent[0],step=Math.pow(10,Math.floor(Math.log(span/m)/Math.LN10)),err=m/span*step;.15>=err?step*=10:.35>=err?step*=5:.75>=err&&(step*=2);extent[0]=Math.ceil(extent[0]/step)*step;extent[1]=Math.floor(extent[1]/step)*step+.5*step;extent[2]=step;return extent}function d3_scale_linearTicks(domain,m){return d3.range.apply(d3,d3_scale_linearTickRange(domain,m))}function d3_scale_linearTickFormat(domain,m,format){var precision=-Math.floor(Math.log(d3_scale_linearTickRange(domain,m)[2])/Math.LN10+.01);return d3.format(format?format.replace(d3_format_re,function(a,b,c,d,e,f,g,h,i,j){return[b,c,d,e,f,g,h,i||"."+(precision-2*("%"===j)),j].join("")}):",."+precision+"f")}function d3_scale_log(linear,base,positive,domain){function log(x){return(positive?Math.log(0>x?0:x):-Math.log(x>0?0:-x))/Math.log(base)}function pow(x){return positive?Math.pow(base,x):-Math.pow(base,-x)}function scale(x){return linear(log(x))}scale.invert=function(x){return pow(linear.invert(x))};scale.domain=function(x){if(!arguments.length)return domain;positive=x[0]>=0;linear.domain((domain=x.map(Number)).map(log));return scale};scale.base=function(_){if(!arguments.length)return base;base=+_;linear.domain(domain.map(log));return scale};scale.nice=function(){var niced=d3_scale_nice(domain.map(log),positive?Math:d3_scale_logNiceNegative);linear.domain(niced);domain=niced.map(pow);return scale};scale.ticks=function(){var extent=d3_scaleExtent(domain),ticks=[],u=extent[0],v=extent[1],i=Math.floor(log(u)),j=Math.ceil(log(v)),n=base%1?2:base;if(isFinite(j-i)){if(positive){for(;j>i;i++)for(var k=1;n>k;k++)ticks.push(pow(i)*k);ticks.push(pow(i))}else{ticks.push(pow(i));for(;i++<j;)for(var k=n-1;k>0;k--)ticks.push(pow(i)*k)}for(i=0;ticks[i]<u;i++);for(j=ticks.length;ticks[j-1]>v;j--);ticks=ticks.slice(i,j)}return ticks};scale.tickFormat=function(n,format){if(!arguments.length)return d3_scale_logFormat;arguments.length<2?format=d3_scale_logFormat:"function"!=typeof format&&(format=d3.format(format));var e,k=Math.max(.1,n/scale.ticks().length),f=positive?(e=1e-12,Math.ceil):(e=-1e-12,Math.floor);return function(d){return d/pow(f(log(d)+e))<=k?format(d):""}};scale.copy=function(){return d3_scale_log(linear.copy(),base,positive,domain)};return d3_scale_linearRebind(scale,linear)}function d3_scale_pow(linear,exponent,domain){function scale(x){return linear(powp(x))}var powp=d3_scale_powPow(exponent),powb=d3_scale_powPow(1/exponent);scale.invert=function(x){return powb(linear.invert(x))};scale.domain=function(x){if(!arguments.length)return domain;linear.domain((domain=x.map(Number)).map(powp));return scale};scale.ticks=function(m){return d3_scale_linearTicks(domain,m)};scale.tickFormat=function(m,format){return d3_scale_linearTickFormat(domain,m,format)};scale.nice=function(m){return scale.domain(d3_scale_linearNice(domain,m))};scale.exponent=function(x){if(!arguments.length)return exponent;powp=d3_scale_powPow(exponent=x);powb=d3_scale_powPow(1/exponent);linear.domain(domain.map(powp));return scale};scale.copy=function(){return d3_scale_pow(linear.copy(),exponent,domain)};return d3_scale_linearRebind(scale,linear)}function d3_scale_powPow(e){return function(x){return 0>x?-Math.pow(-x,e):Math.pow(x,e)}}function d3_scale_ordinal(domain,ranger){function scale(x){return range[((index.get(x)||index.set(x,domain.push(x)))-1)%range.length]}function steps(start,step){return d3.range(domain.length).map(function(i){return start+step*i})}var index,range,rangeBand;scale.domain=function(x){if(!arguments.length)return domain;domain=[];index=new d3_Map;for(var xi,i=-1,n=x.length;++i<n;)index.has(xi=x[i])||index.set(xi,domain.push(xi));return scale[ranger.t].apply(scale,ranger.a)};scale.range=function(x){if(!arguments.length)return range;range=x;rangeBand=0;ranger={t:"range",a:arguments};return scale};scale.rangePoints=function(x,padding){arguments.length<2&&(padding=0);var start=x[0],stop=x[1],step=(stop-start)/(Math.max(1,domain.length-1)+padding);range=steps(domain.length<2?(start+stop)/2:start+step*padding/2,step);rangeBand=0;ranger={t:"rangePoints",a:arguments};return scale};scale.rangeBands=function(x,padding,outerPadding){arguments.length<2&&(padding=0);arguments.length<3&&(outerPadding=padding);var reverse=x[1]<x[0],start=x[reverse-0],stop=x[1-reverse],step=(stop-start)/(domain.length-padding+2*outerPadding);range=steps(start+step*outerPadding,step);reverse&&range.reverse();rangeBand=step*(1-padding);ranger={t:"rangeBands",a:arguments};return scale};scale.rangeRoundBands=function(x,padding,outerPadding){arguments.length<2&&(padding=0);arguments.length<3&&(outerPadding=padding);var reverse=x[1]<x[0],start=x[reverse-0],stop=x[1-reverse],step=Math.floor((stop-start)/(domain.length-padding+2*outerPadding)),error=stop-start-(domain.length-padding)*step;range=steps(start+Math.round(error/2),step);reverse&&range.reverse();rangeBand=Math.round(step*(1-padding));ranger={t:"rangeRoundBands",a:arguments};return scale};scale.rangeBand=function(){return rangeBand};scale.rangeExtent=function(){return d3_scaleExtent(ranger.a[0])};scale.copy=function(){return d3_scale_ordinal(domain,ranger)};return scale.domain(domain)}function d3_scale_quantile(domain,range){function rescale(){var k=0,q=range.length;thresholds=[];for(;++k<q;)thresholds[k-1]=d3.quantile(domain,k/q);return scale}function scale(x){return isNaN(x=+x)?void 0:range[d3.bisect(thresholds,x)]}var thresholds;scale.domain=function(x){if(!arguments.length)return domain;domain=x.filter(function(d){return!isNaN(d)}).sort(d3.ascending);return rescale()};scale.range=function(x){if(!arguments.length)return range;range=x;return rescale()};scale.quantiles=function(){return thresholds};scale.invertExtent=function(y){y=range.indexOf(y);return 0>y?[0/0,0/0]:[y>0?thresholds[y-1]:domain[0],y<thresholds.length?thresholds[y]:domain[domain.length-1]]};scale.copy=function(){return d3_scale_quantile(domain,range)};return rescale()}function d3_scale_quantize(x0,x1,range){function scale(x){return range[Math.max(0,Math.min(i,Math.floor(kx*(x-x0))))]}function rescale(){kx=range.length/(x1-x0);i=range.length-1;return scale}var kx,i;scale.domain=function(x){if(!arguments.length)return[x0,x1];x0=+x[0];x1=+x[x.length-1];return rescale()};scale.range=function(x){if(!arguments.length)return range;range=x;return rescale()};scale.invertExtent=function(y){y=range.indexOf(y);y=0>y?0/0:y/kx+x0;return[y,y+1/kx]};scale.copy=function(){return d3_scale_quantize(x0,x1,range)};return rescale()}function d3_scale_threshold(domain,range){function scale(x){return x>=x?range[d3.bisect(domain,x)]:void 0}scale.domain=function(_){if(!arguments.length)return domain;domain=_;return scale};scale.range=function(_){if(!arguments.length)return range;range=_;return scale};scale.invertExtent=function(y){y=range.indexOf(y);return[domain[y-1],domain[y]]};scale.copy=function(){return d3_scale_threshold(domain,range)};return scale}function d3_scale_identity(domain){function identity(x){return+x}identity.invert=identity;identity.domain=identity.range=function(x){if(!arguments.length)return domain;domain=x.map(identity);return identity};identity.ticks=function(m){return d3_scale_linearTicks(domain,m)};identity.tickFormat=function(m,format){return d3_scale_linearTickFormat(domain,m,format)};identity.copy=function(){return d3_scale_identity(domain)};return identity}function d3_svg_arcInnerRadius(d){return d.innerRadius}function d3_svg_arcOuterRadius(d){return d.outerRadius}function d3_svg_arcStartAngle(d){return d.startAngle}function d3_svg_arcEndAngle(d){return d.endAngle}function d3_svg_lineRadial(points){for(var point,r,a,i=-1,n=points.length;++i<n;){point=points[i];r=point[0];a=point[1]+d3_svg_arcOffset;point[0]=r*Math.cos(a);point[1]=r*Math.sin(a)}return points}function d3_svg_area(projection){function area(data){function segment(){segments.push("M",interpolate(projection(points1),tension),L,interpolateReverse(projection(points0.reverse()),tension),"Z")}for(var d,x,y,segments=[],points0=[],points1=[],i=-1,n=data.length,fx0=d3_functor(x0),fy0=d3_functor(y0),fx1=x0===x1?function(){return x}:d3_functor(x1),fy1=y0===y1?function(){return y}:d3_functor(y1);++i<n;)if(defined.call(this,d=data[i],i)){points0.push([x=+fx0.call(this,d,i),y=+fy0.call(this,d,i)]);points1.push([+fx1.call(this,d,i),+fy1.call(this,d,i)])}else if(points0.length){segment();points0=[];points1=[]}points0.length&&segment();return segments.length?segments.join(""):null}var x0=d3_svg_lineX,x1=d3_svg_lineX,y0=0,y1=d3_svg_lineY,defined=d3_true,interpolate=d3_svg_lineLinear,interpolateKey=interpolate.key,interpolateReverse=interpolate,L="L",tension=.7;area.x=function(_){if(!arguments.length)return x1;x0=x1=_;return area};area.x0=function(_){if(!arguments.length)return x0;x0=_;return area};area.x1=function(_){if(!arguments.length)return x1;x1=_;return area};area.y=function(_){if(!arguments.length)return y1;y0=y1=_;return area};area.y0=function(_){if(!arguments.length)return y0;y0=_;return area};area.y1=function(_){if(!arguments.length)return y1;y1=_;return area};area.defined=function(_){if(!arguments.length)return defined;defined=_;return area};area.interpolate=function(_){if(!arguments.length)return interpolateKey;interpolateKey="function"==typeof _?interpolate=_:(interpolate=d3_svg_lineInterpolators.get(_)||d3_svg_lineLinear).key;interpolateReverse=interpolate.reverse||interpolate;L=interpolate.closed?"M":"L";return area};area.tension=function(_){if(!arguments.length)return tension;tension=_;return area};return area}function d3_svg_chordRadius(d){return d.radius}function d3_svg_diagonalProjection(d){return[d.x,d.y]}function d3_svg_diagonalRadialProjection(projection){return function(){var d=projection.apply(this,arguments),r=d[0],a=d[1]+d3_svg_arcOffset;return[r*Math.cos(a),r*Math.sin(a)]}}function d3_svg_symbolSize(){return 64}function d3_svg_symbolType(){return"circle"}function d3_svg_symbolCircle(size){var r=Math.sqrt(size/π);return"M0,"+r+"A"+r+","+r+" 0 1,1 0,"+-r+"A"+r+","+r+" 0 1,1 0,"+r+"Z"}function d3_transition(groups,id){d3_subclass(groups,d3_transitionPrototype);groups.id=id;return groups}function d3_transition_tween(groups,name,value,tween){var id=groups.id;return d3_selection_each(groups,"function"==typeof value?function(node,i,j){node.__transition__[id].tween.set(name,tween(value.call(node,node.__data__,i,j)))}:(value=tween(value),function(node){node.__transition__[id].tween.set(name,value)}))}function d3_transition_text(b){null==b&&(b="");return function(){this.textContent=b}}function d3_transitionNode(node,i,id,inherit){var lock=node.__transition__||(node.__transition__={active:0,count:0}),transition=lock[id];if(!transition){var time=inherit.time;transition=lock[id]={tween:new d3_Map,time:time,ease:inherit.ease,delay:inherit.delay,duration:inherit.duration};++lock.count;d3.timer(function(elapsed){function start(elapsed){if(lock.active>id)return stop();lock.active=id;transition.event&&transition.event.start.call(node,d,i);transition.tween.forEach(function(key,value){(value=value.call(node,d,i))&&tweened.push(value)});if(tick(elapsed))return 1;d3_timer_replace(tick,0,time);
return void 0}function tick(elapsed){if(lock.active!==id)return stop();for(var t=(elapsed-delay)/duration,e=ease(t),n=tweened.length;n>0;)tweened[--n].call(node,e);if(t>=1){transition.event&&transition.event.end.call(node,d,i);return stop()}}function stop(){--lock.count?delete lock[id]:delete node.__transition__;return 1}var d=node.__data__,ease=transition.ease,delay=transition.delay,duration=transition.duration,tweened=[];if(elapsed>=delay)return start(elapsed);d3_timer_replace(start,delay,time);return void 0},0,time)}}function d3_svg_axisX(selection,x){selection.attr("transform",function(d){return"translate("+x(d)+",0)"})}function d3_svg_axisY(selection,y){selection.attr("transform",function(d){return"translate(0,"+y(d)+")"})}function d3_date_utc(){this._=new Date(arguments.length>1?Date.UTC.apply(this,arguments):arguments[0])}function d3_time_interval(local,step,number){function round(date){var d0=local(date),d1=offset(d0,1);return d1-date>date-d0?d0:d1}function ceil(date){step(date=local(new d3_date(date-1)),1);return date}function offset(date,k){step(date=new d3_date(+date),k);return date}function range(t0,t1,dt){var time=ceil(t0),times=[];if(dt>1)for(;t1>time;){number(time)%dt||times.push(new Date(+time));step(time,1)}else for(;t1>time;)times.push(new Date(+time)),step(time,1);return times}function range_utc(t0,t1,dt){try{d3_date=d3_date_utc;var utc=new d3_date_utc;utc._=t0;return range(utc,t1,dt)}finally{d3_date=Date}}local.floor=local;local.round=round;local.ceil=ceil;local.offset=offset;local.range=range;var utc=local.utc=d3_time_interval_utc(local);utc.floor=utc;utc.round=d3_time_interval_utc(round);utc.ceil=d3_time_interval_utc(ceil);utc.offset=d3_time_interval_utc(offset);utc.range=range_utc;return local}function d3_time_interval_utc(method){return function(date,k){try{d3_date=d3_date_utc;var utc=new d3_date_utc;utc._=date;return method(utc,k)._}finally{d3_date=Date}}}function d3_time_format(template){function format(date){for(var c,p,f,string=[],i=-1,j=0;++i<n;)if(37===template.charCodeAt(i)){string.push(template.substring(j,i));null!=(p=d3_time_formatPads[c=template.charAt(++i)])&&(c=template.charAt(++i));(f=d3_time_formats[c])&&(c=f(date,null==p?"e"===c?" ":"0":p));string.push(c);j=i+1}string.push(template.substring(j,i));return string.join("")}var n=template.length;format.parse=function(string){var d={y:1900,m:0,d:1,H:0,M:0,S:0,L:0},i=d3_time_parse(d,template,string,0);if(i!=string.length)return null;"p"in d&&(d.H=d.H%12+12*d.p);var date=new d3_date;if("j"in d)date.setFullYear(d.y,0,d.j);else if("w"in d&&("W"in d||"U"in d)){date.setFullYear(d.y,0,1);date.setFullYear(d.y,0,"W"in d?(d.w+6)%7+7*d.W-(date.getDay()+5)%7:d.w+7*d.U-(date.getDay()+6)%7)}else date.setFullYear(d.y,d.m,d.d);date.setHours(d.H,d.M,d.S,d.L);return date};format.toString=function(){return template};return format}function d3_time_parse(date,template,string,j){for(var c,p,t,i=0,n=template.length,m=string.length;n>i;){if(j>=m)return-1;c=template.charCodeAt(i++);if(37===c){t=template.charAt(i++);p=d3_time_parsers[t in d3_time_formatPads?template.charAt(i++):t];if(!p||(j=p(date,string,j))<0)return-1}else if(c!=string.charCodeAt(j++))return-1}return j}function d3_time_formatRe(names){return new RegExp("^(?:"+names.map(d3.requote).join("|")+")","i")}function d3_time_formatLookup(names){for(var map=new d3_Map,i=-1,n=names.length;++i<n;)map.set(names[i].toLowerCase(),i);return map}function d3_time_formatPad(value,fill,width){var sign=0>value?"-":"",string=(sign?-value:value)+"",length=string.length;return sign+(width>length?new Array(width-length+1).join(fill)+string:string)}function d3_time_parseWeekdayAbbrev(date,string,i){d3_time_dayAbbrevRe.lastIndex=0;var n=d3_time_dayAbbrevRe.exec(string.substring(i));return n?(date.w=d3_time_dayAbbrevLookup.get(n[0].toLowerCase()),i+n[0].length):-1}function d3_time_parseWeekday(date,string,i){d3_time_dayRe.lastIndex=0;var n=d3_time_dayRe.exec(string.substring(i));return n?(date.w=d3_time_dayLookup.get(n[0].toLowerCase()),i+n[0].length):-1}function d3_time_parseWeekdayNumber(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.substring(i,i+1));return n?(date.w=+n[0],i+n[0].length):-1}function d3_time_parseWeekNumberSunday(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.substring(i));return n?(date.U=+n[0],i+n[0].length):-1}function d3_time_parseWeekNumberMonday(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.substring(i));return n?(date.W=+n[0],i+n[0].length):-1}function d3_time_parseMonthAbbrev(date,string,i){d3_time_monthAbbrevRe.lastIndex=0;var n=d3_time_monthAbbrevRe.exec(string.substring(i));return n?(date.m=d3_time_monthAbbrevLookup.get(n[0].toLowerCase()),i+n[0].length):-1}function d3_time_parseMonth(date,string,i){d3_time_monthRe.lastIndex=0;var n=d3_time_monthRe.exec(string.substring(i));return n?(date.m=d3_time_monthLookup.get(n[0].toLowerCase()),i+n[0].length):-1}function d3_time_parseLocaleFull(date,string,i){return d3_time_parse(date,d3_time_formats.c.toString(),string,i)}function d3_time_parseLocaleDate(date,string,i){return d3_time_parse(date,d3_time_formats.x.toString(),string,i)}function d3_time_parseLocaleTime(date,string,i){return d3_time_parse(date,d3_time_formats.X.toString(),string,i)}function d3_time_parseFullYear(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.substring(i,i+4));return n?(date.y=+n[0],i+n[0].length):-1}function d3_time_parseYear(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.substring(i,i+2));return n?(date.y=d3_time_expandYear(+n[0]),i+n[0].length):-1}function d3_time_expandYear(d){return d+(d>68?1900:2e3)}function d3_time_parseMonthNumber(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.substring(i,i+2));return n?(date.m=n[0]-1,i+n[0].length):-1}function d3_time_parseDay(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.substring(i,i+2));return n?(date.d=+n[0],i+n[0].length):-1}function d3_time_parseDayOfYear(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.substring(i,i+3));return n?(date.j=+n[0],i+n[0].length):-1}function d3_time_parseHour24(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.substring(i,i+2));return n?(date.H=+n[0],i+n[0].length):-1}function d3_time_parseMinutes(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.substring(i,i+2));return n?(date.M=+n[0],i+n[0].length):-1}function d3_time_parseSeconds(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.substring(i,i+2));return n?(date.S=+n[0],i+n[0].length):-1}function d3_time_parseMilliseconds(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.substring(i,i+3));return n?(date.L=+n[0],i+n[0].length):-1}function d3_time_parseAmPm(date,string,i){var n=d3_time_amPmLookup.get(string.substring(i,i+=2).toLowerCase());return null==n?-1:(date.p=n,i)}function d3_time_zone(d){var z=d.getTimezoneOffset(),zs=z>0?"-":"+",zh=~~(Math.abs(z)/60),zm=Math.abs(z)%60;return zs+d3_time_formatPad(zh,"0",2)+d3_time_formatPad(zm,"0",2)}function d3_time_parseLiteralPercent(date,string,i){d3_time_percentRe.lastIndex=0;var n=d3_time_percentRe.exec(string.substring(i,i+1));return n?i+n[0].length:-1}function d3_time_formatUtc(template){function format(date){try{d3_date=d3_date_utc;var utc=new d3_date;utc._=date;return local(utc)}finally{d3_date=Date}}var local=d3_time_format(template);format.parse=function(string){try{d3_date=d3_date_utc;var date=local.parse(string);return date&&date._}finally{d3_date=Date}};format.toString=local.toString;return format}function d3_time_formatIsoNative(date){return date.toISOString()}function d3_time_scale(linear,methods,format){function scale(x){return linear(x)}function tickMethod(extent,count){var span=extent[1]-extent[0],target=span/count,i=d3.bisect(d3_time_scaleSteps,target);return i==d3_time_scaleSteps.length?[methods.year,d3_scale_linearTickRange(extent.map(function(d){return d/31536e6}),count)[2]]:i?methods[target/d3_time_scaleSteps[i-1]<d3_time_scaleSteps[i]/target?i-1:i]:[d3_time_scaleMilliseconds,d3_scale_linearTickRange(extent,count)[2]]}scale.invert=function(x){return d3_time_scaleDate(linear.invert(x))};scale.domain=function(x){if(!arguments.length)return linear.domain().map(d3_time_scaleDate);linear.domain(x);return scale};scale.nice=function(interval,skip){function skipped(date){return!isNaN(date)&&!interval.range(date,d3_time_scaleDate(+date+1),skip).length}var domain=scale.domain(),extent=d3_scaleExtent(domain),method=null==interval?tickMethod(extent,10):"number"==typeof interval&&tickMethod(extent,interval);method&&(interval=method[0],skip=method[1]);return scale.domain(d3_scale_nice(domain,skip>1?{floor:function(date){for(;skipped(date=interval.floor(date));)date=d3_time_scaleDate(date-1);return date},ceil:function(date){for(;skipped(date=interval.ceil(date));)date=d3_time_scaleDate(+date+1);return date}}:interval))};scale.ticks=function(interval,skip){var extent=d3_scaleExtent(scale.domain()),method=null==interval?tickMethod(extent,10):"number"==typeof interval?tickMethod(extent,interval):!interval.range&&[{range:interval},skip];method&&(interval=method[0],skip=method[1]);return interval.range(extent[0],d3_time_scaleDate(+extent[1]+1),skip)};scale.tickFormat=function(){return format};scale.copy=function(){return d3_time_scale(linear.copy(),methods,format)};return d3_scale_linearRebind(scale,linear)}function d3_time_scaleDate(t){return new Date(t)}function d3_time_scaleFormat(formats){return function(date){for(var i=formats.length-1,f=formats[i];!f[1](date);)f=formats[--i];return f[0](date)}}function d3_json(request){return JSON.parse(request.responseText)}function d3_html(request){var range=d3_document.createRange();range.selectNode(d3_document.body);return range.createContextualFragment(request.responseText)}var d3={version:"3.3.2"};Date.now||(Date.now=function(){return+new Date});var d3_arraySlice=[].slice,d3_array=function(list){return d3_arraySlice.call(list)},d3_document=document,d3_documentElement=d3_document.documentElement,d3_window=window;try{d3_array(d3_documentElement.childNodes)[0].nodeType}catch(e){d3_array=function(list){for(var i=list.length,array=new Array(i);i--;)array[i]=list[i];return array}}try{d3_document.createElement("div").style.setProperty("opacity",0,"")}catch(error){var d3_element_prototype=d3_window.Element.prototype,d3_element_setAttribute=d3_element_prototype.setAttribute,d3_element_setAttributeNS=d3_element_prototype.setAttributeNS,d3_style_prototype=d3_window.CSSStyleDeclaration.prototype,d3_style_setProperty=d3_style_prototype.setProperty;d3_element_prototype.setAttribute=function(name,value){d3_element_setAttribute.call(this,name,value+"")};d3_element_prototype.setAttributeNS=function(space,local,value){d3_element_setAttributeNS.call(this,space,local,value+"")};d3_style_prototype.setProperty=function(name,value,priority){d3_style_setProperty.call(this,name,value+"",priority)}}d3.ascending=function(a,b){return b>a?-1:a>b?1:a>=b?0:0/0};d3.descending=function(a,b){return a>b?-1:b>a?1:b>=a?0:0/0};d3.min=function(array,f){var a,b,i=-1,n=array.length;if(1===arguments.length){for(;++i<n&&!(null!=(a=array[i])&&a>=a);)a=void 0;for(;++i<n;)null!=(b=array[i])&&a>b&&(a=b)}else{for(;++i<n&&!(null!=(a=f.call(array,array[i],i))&&a>=a);)a=void 0;for(;++i<n;)null!=(b=f.call(array,array[i],i))&&a>b&&(a=b)}return a};d3.max=function(array,f){var a,b,i=-1,n=array.length;if(1===arguments.length){for(;++i<n&&!(null!=(a=array[i])&&a>=a);)a=void 0;for(;++i<n;)null!=(b=array[i])&&b>a&&(a=b)}else{for(;++i<n&&!(null!=(a=f.call(array,array[i],i))&&a>=a);)a=void 0;for(;++i<n;)null!=(b=f.call(array,array[i],i))&&b>a&&(a=b)}return a};d3.extent=function(array,f){var a,b,c,i=-1,n=array.length;if(1===arguments.length){for(;++i<n&&!(null!=(a=c=array[i])&&a>=a);)a=c=void 0;for(;++i<n;)if(null!=(b=array[i])){a>b&&(a=b);b>c&&(c=b)}}else{for(;++i<n&&!(null!=(a=c=f.call(array,array[i],i))&&a>=a);)a=void 0;for(;++i<n;)if(null!=(b=f.call(array,array[i],i))){a>b&&(a=b);b>c&&(c=b)}}return[a,c]};d3.sum=function(array,f){var a,s=0,n=array.length,i=-1;if(1===arguments.length)for(;++i<n;)isNaN(a=+array[i])||(s+=a);else for(;++i<n;)isNaN(a=+f.call(array,array[i],i))||(s+=a);return s};d3.mean=function(array,f){var a,n=array.length,m=0,i=-1,j=0;if(1===arguments.length)for(;++i<n;)d3_number(a=array[i])&&(m+=(a-m)/++j);else for(;++i<n;)d3_number(a=f.call(array,array[i],i))&&(m+=(a-m)/++j);return j?m:void 0};d3.quantile=function(values,p){var H=(values.length-1)*p+1,h=Math.floor(H),v=+values[h-1],e=H-h;return e?v+e*(values[h]-v):v};d3.median=function(array,f){arguments.length>1&&(array=array.map(f));array=array.filter(d3_number);return array.length?d3.quantile(array.sort(d3.ascending),.5):void 0};d3.bisector=function(f){return{left:function(a,x,lo,hi){arguments.length<3&&(lo=0);arguments.length<4&&(hi=a.length);for(;hi>lo;){var mid=lo+hi>>>1;f.call(a,a[mid],mid)<x?lo=mid+1:hi=mid}return lo},right:function(a,x,lo,hi){arguments.length<3&&(lo=0);arguments.length<4&&(hi=a.length);for(;hi>lo;){var mid=lo+hi>>>1;x<f.call(a,a[mid],mid)?hi=mid:lo=mid+1}return lo}}};var d3_bisector=d3.bisector(function(d){return d});d3.bisectLeft=d3_bisector.left;d3.bisect=d3.bisectRight=d3_bisector.right;d3.shuffle=function(array){for(var t,i,m=array.length;m;){i=Math.random()*m--|0;t=array[m],array[m]=array[i],array[i]=t}return array};d3.permute=function(array,indexes){for(var i=indexes.length,permutes=new Array(i);i--;)permutes[i]=array[indexes[i]];return permutes};d3.pairs=function(array){for(var p0,i=0,n=array.length-1,p1=array[0],pairs=new Array(0>n?0:n);n>i;)pairs[i]=[p0=p1,p1=array[++i]];return pairs};d3.zip=function(){if(!(n=arguments.length))return[];for(var i=-1,m=d3.min(arguments,d3_zipLength),zips=new Array(m);++i<m;)for(var n,j=-1,zip=zips[i]=new Array(n);++j<n;)zip[j]=arguments[j][i];return zips};d3.transpose=function(matrix){return d3.zip.apply(d3,matrix)};d3.keys=function(map){var keys=[];for(var key in map)keys.push(key);return keys};d3.values=function(map){var values=[];for(var key in map)values.push(map[key]);return values};d3.entries=function(map){var entries=[];for(var key in map)entries.push({key:key,value:map[key]});return entries};d3.merge=function(arrays){return Array.prototype.concat.apply([],arrays)};d3.range=function(start,stop,step){if(arguments.length<3){step=1;if(arguments.length<2){stop=start;start=0}}if((stop-start)/step===1/0)throw new Error("infinite range");var j,range=[],k=d3_range_integerScale(Math.abs(step)),i=-1;start*=k,stop*=k,step*=k;if(0>step)for(;(j=start+step*++i)>stop;)range.push(j/k);else for(;(j=start+step*++i)<stop;)range.push(j/k);return range};d3.map=function(object){var map=new d3_Map;if(object instanceof d3_Map)object.forEach(function(key,value){map.set(key,value)});else for(var key in object)map.set(key,object[key]);return map};d3_class(d3_Map,{has:function(key){return d3_map_prefix+key in this},get:function(key){return this[d3_map_prefix+key]},set:function(key,value){return this[d3_map_prefix+key]=value},remove:function(key){key=d3_map_prefix+key;return key in this&&delete this[key]},keys:function(){var keys=[];this.forEach(function(key){keys.push(key)});return keys},values:function(){var values=[];this.forEach(function(key,value){values.push(value)});return values},entries:function(){var entries=[];this.forEach(function(key,value){entries.push({key:key,value:value})});return entries},forEach:function(f){for(var key in this)key.charCodeAt(0)===d3_map_prefixCode&&f.call(this,key.substring(1),this[key])}});var d3_map_prefix="\x00",d3_map_prefixCode=d3_map_prefix.charCodeAt(0);d3.nest=function(){function map(mapType,array,depth){if(depth>=keys.length)return rollup?rollup.call(nest,array):sortValues?array.sort(sortValues):array;for(var keyValue,object,setter,values,i=-1,n=array.length,key=keys[depth++],valuesByKey=new d3_Map;++i<n;)(values=valuesByKey.get(keyValue=key(object=array[i])))?values.push(object):valuesByKey.set(keyValue,[object]);if(mapType){object=mapType();setter=function(keyValue,values){object.set(keyValue,map(mapType,values,depth))}}else{object={};setter=function(keyValue,values){object[keyValue]=map(mapType,values,depth)}}valuesByKey.forEach(setter);return object}function entries(map,depth){if(depth>=keys.length)return map;var array=[],sortKey=sortKeys[depth++];map.forEach(function(key,keyMap){array.push({key:key,values:entries(keyMap,depth)})});return sortKey?array.sort(function(a,b){return sortKey(a.key,b.key)}):array}var sortValues,rollup,nest={},keys=[],sortKeys=[];nest.map=function(array,mapType){return map(mapType,array,0)};nest.entries=function(array){return entries(map(d3.map,array,0),0)};nest.key=function(d){keys.push(d);return nest};nest.sortKeys=function(order){sortKeys[keys.length-1]=order;return nest};nest.sortValues=function(order){sortValues=order;return nest};nest.rollup=function(f){rollup=f;return nest};return nest};d3.set=function(array){var set=new d3_Set;if(array)for(var i=0,n=array.length;n>i;++i)set.add(array[i]);return set};d3_class(d3_Set,{has:function(value){return d3_map_prefix+value in this},add:function(value){this[d3_map_prefix+value]=!0;return value},remove:function(value){value=d3_map_prefix+value;return value in this&&delete this[value]},values:function(){var values=[];this.forEach(function(value){values.push(value)});return values},forEach:function(f){for(var value in this)value.charCodeAt(0)===d3_map_prefixCode&&f.call(this,value.substring(1))}});d3.behavior={};d3.rebind=function(target,source){for(var method,i=1,n=arguments.length;++i<n;)target[method=arguments[i]]=d3_rebind(target,source,source[method]);return target};var d3_vendorPrefixes=["webkit","ms","moz","Moz","o","O"];d3.dispatch=function(){for(var dispatch=new d3_dispatch,i=-1,n=arguments.length;++i<n;)dispatch[arguments[i]]=d3_dispatch_event(dispatch);return dispatch};d3_dispatch.prototype.on=function(type,listener){var i=type.indexOf("."),name="";if(i>=0){name=type.substring(i+1);type=type.substring(0,i)}if(type)return arguments.length<2?this[type].on(name):this[type].on(name,listener);if(2===arguments.length){if(null==listener)for(type in this)this.hasOwnProperty(type)&&this[type].on(name,null);return this}};d3.event=null;d3.requote=function(s){return s.replace(d3_requote_re,"\\$&")};var d3_requote_re=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g,d3_subclass={}.__proto__?function(object,prototype){object.__proto__=prototype}:function(object,prototype){for(var property in prototype)object[property]=prototype[property]},d3_select=function(s,n){return n.querySelector(s)},d3_selectAll=function(s,n){return n.querySelectorAll(s)},d3_selectMatcher=d3_documentElement[d3_vendorSymbol(d3_documentElement,"matchesSelector")],d3_selectMatches=function(n,s){return d3_selectMatcher.call(n,s)};if("function"==typeof Sizzle){d3_select=function(s,n){return Sizzle(s,n)[0]||null};d3_selectAll=function(s,n){return Sizzle.uniqueSort(Sizzle(s,n))};d3_selectMatches=Sizzle.matchesSelector}d3.selection=function(){return d3_selectionRoot};var d3_selectionPrototype=d3.selection.prototype=[];d3_selectionPrototype.select=function(selector){var subgroup,subnode,group,node,subgroups=[];selector=d3_selection_selector(selector);for(var j=-1,m=this.length;++j<m;){subgroups.push(subgroup=[]);subgroup.parentNode=(group=this[j]).parentNode;for(var i=-1,n=group.length;++i<n;)if(node=group[i]){subgroup.push(subnode=selector.call(node,node.__data__,i,j));subnode&&"__data__"in node&&(subnode.__data__=node.__data__)}else subgroup.push(null)}return d3_selection(subgroups)};d3_selectionPrototype.selectAll=function(selector){var subgroup,node,subgroups=[];selector=d3_selection_selectorAll(selector);for(var j=-1,m=this.length;++j<m;)for(var group=this[j],i=-1,n=group.length;++i<n;)if(node=group[i]){subgroups.push(subgroup=d3_array(selector.call(node,node.__data__,i,j)));subgroup.parentNode=node}return d3_selection(subgroups)};var d3_nsPrefix={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};d3.ns={prefix:d3_nsPrefix,qualify:function(name){var i=name.indexOf(":"),prefix=name;if(i>=0){prefix=name.substring(0,i);name=name.substring(i+1)}return d3_nsPrefix.hasOwnProperty(prefix)?{space:d3_nsPrefix[prefix],local:name}:name}};d3_selectionPrototype.attr=function(name,value){if(arguments.length<2){if("string"==typeof name){var node=this.node();name=d3.ns.qualify(name);return name.local?node.getAttributeNS(name.space,name.local):node.getAttribute(name)}for(value in name)this.each(d3_selection_attr(value,name[value]));return this}return this.each(d3_selection_attr(name,value))};d3_selectionPrototype.classed=function(name,value){if(arguments.length<2){if("string"==typeof name){var node=this.node(),n=(name=name.trim().split(/^|\s+/g)).length,i=-1;if(value=node.classList){for(;++i<n;)if(!value.contains(name[i]))return!1}else{value=node.getAttribute("class");for(;++i<n;)if(!d3_selection_classedRe(name[i]).test(value))return!1}return!0}for(value in name)this.each(d3_selection_classed(value,name[value]));return this}return this.each(d3_selection_classed(name,value))};d3_selectionPrototype.style=function(name,value,priority){var n=arguments.length;if(3>n){if("string"!=typeof name){2>n&&(value="");for(priority in name)this.each(d3_selection_style(priority,name[priority],value));return this}if(2>n)return d3_window.getComputedStyle(this.node(),null).getPropertyValue(name);priority=""}return this.each(d3_selection_style(name,value,priority))};d3_selectionPrototype.property=function(name,value){if(arguments.length<2){if("string"==typeof name)return this.node()[name];for(value in name)this.each(d3_selection_property(value,name[value]));return this}return this.each(d3_selection_property(name,value))};d3_selectionPrototype.text=function(value){return arguments.length?this.each("function"==typeof value?function(){var v=value.apply(this,arguments);this.textContent=null==v?"":v}:null==value?function(){this.textContent=""}:function(){this.textContent=value}):this.node().textContent};d3_selectionPrototype.html=function(value){return arguments.length?this.each("function"==typeof value?function(){var v=value.apply(this,arguments);this.innerHTML=null==v?"":v}:null==value?function(){this.innerHTML=""}:function(){this.innerHTML=value}):this.node().innerHTML};d3_selectionPrototype.append=function(name){name=d3_selection_creator(name);return this.select(function(){return this.appendChild(name.apply(this,arguments))})};d3_selectionPrototype.insert=function(name,before){name=d3_selection_creator(name);before=d3_selection_selector(before);return this.select(function(){return this.insertBefore(name.apply(this,arguments),before.apply(this,arguments))})};d3_selectionPrototype.remove=function(){return this.each(function(){var parent=this.parentNode;parent&&parent.removeChild(this)})};d3_selectionPrototype.data=function(value,key){function bind(group,groupData){var i,node,nodeData,n=group.length,m=groupData.length,n0=Math.min(n,m),updateNodes=new Array(m),enterNodes=new Array(m),exitNodes=new Array(n);if(key){var keyValue,nodeByKeyValue=new d3_Map,dataByKeyValue=new d3_Map,keyValues=[];for(i=-1;++i<n;){keyValue=key.call(node=group[i],node.__data__,i);nodeByKeyValue.has(keyValue)?exitNodes[i]=node:nodeByKeyValue.set(keyValue,node);keyValues.push(keyValue)}for(i=-1;++i<m;){keyValue=key.call(groupData,nodeData=groupData[i],i);if(node=nodeByKeyValue.get(keyValue)){updateNodes[i]=node;node.__data__=nodeData}else dataByKeyValue.has(keyValue)||(enterNodes[i]=d3_selection_dataNode(nodeData));dataByKeyValue.set(keyValue,nodeData);nodeByKeyValue.remove(keyValue)}for(i=-1;++i<n;)nodeByKeyValue.has(keyValues[i])&&(exitNodes[i]=group[i])}else{for(i=-1;++i<n0;){node=group[i];nodeData=groupData[i];if(node){node.__data__=nodeData;updateNodes[i]=node}else enterNodes[i]=d3_selection_dataNode(nodeData)}for(;m>i;++i)enterNodes[i]=d3_selection_dataNode(groupData[i]);for(;n>i;++i)exitNodes[i]=group[i]}enterNodes.update=updateNodes;enterNodes.parentNode=updateNodes.parentNode=exitNodes.parentNode=group.parentNode;enter.push(enterNodes);update.push(updateNodes);exit.push(exitNodes)}var group,node,i=-1,n=this.length;if(!arguments.length){value=new Array(n=(group=this[0]).length);for(;++i<n;)(node=group[i])&&(value[i]=node.__data__);return value}var enter=d3_selection_enter([]),update=d3_selection([]),exit=d3_selection([]);if("function"==typeof value)for(;++i<n;)bind(group=this[i],value.call(group,group.parentNode.__data__,i));else for(;++i<n;)bind(group=this[i],value);update.enter=function(){return enter};update.exit=function(){return exit};return update};d3_selectionPrototype.datum=function(value){return arguments.length?this.property("__data__",value):this.property("__data__")};d3_selectionPrototype.filter=function(filter){var subgroup,group,node,subgroups=[];"function"!=typeof filter&&(filter=d3_selection_filter(filter));for(var j=0,m=this.length;m>j;j++){subgroups.push(subgroup=[]);subgroup.parentNode=(group=this[j]).parentNode;for(var i=0,n=group.length;n>i;i++)(node=group[i])&&filter.call(node,node.__data__,i)&&subgroup.push(node)}return d3_selection(subgroups)};d3_selectionPrototype.order=function(){for(var j=-1,m=this.length;++j<m;)for(var node,group=this[j],i=group.length-1,next=group[i];--i>=0;)if(node=group[i]){next&&next!==node.nextSibling&&next.parentNode.insertBefore(node,next);next=node}return this};d3_selectionPrototype.sort=function(comparator){comparator=d3_selection_sortComparator.apply(this,arguments);for(var j=-1,m=this.length;++j<m;)this[j].sort(comparator);return this.order()};d3_selectionPrototype.each=function(callback){return d3_selection_each(this,function(node,i,j){callback.call(node,node.__data__,i,j)})};d3_selectionPrototype.call=function(callback){var args=d3_array(arguments);callback.apply(args[0]=this,args);return this};d3_selectionPrototype.empty=function(){return!this.node()};d3_selectionPrototype.node=function(){for(var j=0,m=this.length;m>j;j++)for(var group=this[j],i=0,n=group.length;n>i;i++){var node=group[i];if(node)return node}return null};d3_selectionPrototype.size=function(){var n=0;this.each(function(){++n});return n};var d3_selection_enterPrototype=[];d3.selection.enter=d3_selection_enter;d3.selection.enter.prototype=d3_selection_enterPrototype;d3_selection_enterPrototype.append=d3_selectionPrototype.append;d3_selection_enterPrototype.empty=d3_selectionPrototype.empty;d3_selection_enterPrototype.node=d3_selectionPrototype.node;d3_selection_enterPrototype.call=d3_selectionPrototype.call;d3_selection_enterPrototype.size=d3_selectionPrototype.size;d3_selection_enterPrototype.select=function(selector){for(var subgroup,subnode,upgroup,group,node,subgroups=[],j=-1,m=this.length;++j<m;){upgroup=(group=this[j]).update;subgroups.push(subgroup=[]);subgroup.parentNode=group.parentNode;for(var i=-1,n=group.length;++i<n;)if(node=group[i]){subgroup.push(upgroup[i]=subnode=selector.call(group.parentNode,node.__data__,i,j));subnode.__data__=node.__data__}else subgroup.push(null)}return d3_selection(subgroups)};d3_selection_enterPrototype.insert=function(name,before){arguments.length<2&&(before=d3_selection_enterInsertBefore(this));return d3_selectionPrototype.insert.call(this,name,before)};d3_selectionPrototype.transition=function(){for(var subgroup,node,id=d3_transitionInheritId||++d3_transitionId,subgroups=[],transition=d3_transitionInherit||{time:Date.now(),ease:d3_ease_cubicInOut,delay:0,duration:250},j=-1,m=this.length;++j<m;){subgroups.push(subgroup=[]);for(var group=this[j],i=-1,n=group.length;++i<n;){(node=group[i])&&d3_transitionNode(node,i,id,transition);subgroup.push(node)}}return d3_transition(subgroups,id)};d3_selectionPrototype.interrupt=function(){return this.each(d3_selection_interrupt)};d3.select=function(node){var group=["string"==typeof node?d3_select(node,d3_document):node];group.parentNode=d3_documentElement;return d3_selection([group])};d3.selectAll=function(nodes){var group=d3_array("string"==typeof nodes?d3_selectAll(nodes,d3_document):nodes);group.parentNode=d3_documentElement;return d3_selection([group])};var d3_selectionRoot=d3.select(d3_documentElement);d3_selectionPrototype.on=function(type,listener,capture){var n=arguments.length;if(3>n){if("string"!=typeof type){2>n&&(listener=!1);for(capture in type)this.each(d3_selection_on(capture,type[capture],listener));return this}if(2>n)return(n=this.node()["__on"+type])&&n._;capture=!1}return this.each(d3_selection_on(type,listener,capture))};var d3_selection_onFilters=d3.map({mouseenter:"mouseover",mouseleave:"mouseout"});d3_selection_onFilters.forEach(function(k){"on"+k in d3_document&&d3_selection_onFilters.remove(k)});var d3_event_dragSelect=d3_vendorSymbol(d3_documentElement.style,"userSelect"),d3_event_dragId=0;d3.mouse=function(container){return d3_mousePoint(container,d3_eventSource())};var d3_mouse_bug44083=/WebKit/.test(d3_window.navigator.userAgent)?-1:0;d3.touches=function(container,touches){arguments.length<2&&(touches=d3_eventSource().touches);return touches?d3_array(touches).map(function(touch){var point=d3_mousePoint(container,touch);point.identifier=touch.identifier;return point}):[]};d3.behavior.drag=function(){function drag(){this.on("mousedown.drag",mousedown).on("touchstart.drag",touchstart)}function touchid(){return d3.event.changedTouches[0].identifier}function touchposition(parent,id){return d3.touches(parent).filter(function(p){return p.identifier===id})[0]}function dragstart(id,position,move,end){return function(){function moved(){if(!parent)return ended();var p=position(parent,eventId),dx=p[0]-origin_[0],dy=p[1]-origin_[1];dragged|=dx|dy;origin_=p;event_({type:"drag",x:p[0]+offset[0],y:p[1]+offset[1],dx:dx,dy:dy})}function ended(){w.on(move+"."+drag,null).on(end+"."+drag,null);dragRestore(dragged&&d3.event.target===eventTarget);event_({type:"dragend"})}var offset,target=this,parent=target.parentNode,event_=event.of(target,arguments),eventTarget=d3.event.target,eventId=id(),drag=null==eventId?"drag":"drag-"+eventId,origin_=position(parent,eventId),dragged=0,w=d3.select(d3_window).on(move+"."+drag,moved).on(end+"."+drag,ended),dragRestore=d3_event_dragSuppress();if(origin){offset=origin.apply(target,arguments);offset=[offset.x-origin_[0],offset.y-origin_[1]]}else offset=[0,0];event_({type:"dragstart"})}}var event=d3_eventDispatch(drag,"drag","dragstart","dragend"),origin=null,mousedown=dragstart(d3_noop,d3.mouse,"mousemove","mouseup"),touchstart=dragstart(touchid,touchposition,"touchmove","touchend");drag.origin=function(x){if(!arguments.length)return origin;origin=x;return drag};return d3.rebind(drag,event,"on")};var π=Math.PI,ε=1e-6,ε2=ε*ε,d3_radians=π/180,d3_degrees=180/π,ρ=Math.SQRT2,ρ2=2,ρ4=4;d3.interpolateZoom=function(p0,p1){function interpolate(t){var s=t*S;if(dr){var coshr0=d3_cosh(r0),u=w0/(ρ2*d1)*(coshr0*d3_tanh(ρ*s+r0)-d3_sinh(r0));return[ux0+u*dx,uy0+u*dy,w0*coshr0/d3_cosh(ρ*s+r0)]}return[ux0+t*dx,uy0+t*dy,w0*Math.exp(ρ*s)]}var ux0=p0[0],uy0=p0[1],w0=p0[2],ux1=p1[0],uy1=p1[1],w1=p1[2],dx=ux1-ux0,dy=uy1-uy0,d2=dx*dx+dy*dy,d1=Math.sqrt(d2),b0=(w1*w1-w0*w0+ρ4*d2)/(2*w0*ρ2*d1),b1=(w1*w1-w0*w0-ρ4*d2)/(2*w1*ρ2*d1),r0=Math.log(Math.sqrt(b0*b0+1)-b0),r1=Math.log(Math.sqrt(b1*b1+1)-b1),dr=r1-r0,S=(dr||Math.log(w1/w0))/ρ;interpolate.duration=1e3*S;return interpolate};d3.behavior.zoom=function(){function zoom(g){g.on(mousedown,mousedowned).on(d3_behavior_zoomWheel+".zoom",mousewheeled).on(mousemove,mousewheelreset).on("dblclick.zoom",dblclicked).on(touchstart,touchstarted)}function location(p){return[(p[0]-view.x)/view.k,(p[1]-view.y)/view.k]}function point(l){return[l[0]*view.k+view.x,l[1]*view.k+view.y]}function scaleTo(s){view.k=Math.max(scaleExtent[0],Math.min(scaleExtent[1],s))}function translateTo(p,l){l=point(l);view.x+=p[0]-l[0];
view.y+=p[1]-l[1]}function rescale(){x1&&x1.domain(x0.range().map(function(x){return(x-view.x)/view.k}).map(x0.invert));y1&&y1.domain(y0.range().map(function(y){return(y-view.y)/view.k}).map(y0.invert))}function zoomstarted(event){event({type:"zoomstart"})}function zoomed(event){rescale();event({type:"zoom",scale:view.k,translate:[view.x,view.y]})}function zoomended(event){event({type:"zoomend"})}function mousedowned(){function moved(){dragged=1;translateTo(d3.mouse(target),l);zoomed(event_)}function ended(){w.on(mousemove,d3_window===target?mousewheelreset:null).on(mouseup,null);dragRestore(dragged&&d3.event.target===eventTarget);zoomended(event_)}var target=this,event_=event.of(target,arguments),eventTarget=d3.event.target,dragged=0,w=d3.select(d3_window).on(mousemove,moved).on(mouseup,ended),l=location(d3.mouse(target)),dragRestore=d3_event_dragSuppress();d3_selection_interrupt.call(target);zoomstarted(event_)}function touchstarted(){function relocate(){var touches=d3.touches(target);scale0=view.k;locations0={};touches.forEach(function(t){locations0[t.identifier]=location(t)});return touches}function started(){var now=Date.now(),touches=relocate();if(1===touches.length){if(500>now-touchtime){var p=touches[0],l=locations0[p.identifier];scaleTo(2*view.k);translateTo(p,l);d3_eventPreventDefault();zoomed(event_)}touchtime=now}else if(touches.length>1){var p=touches[0],q=touches[1],dx=p[0]-q[0],dy=p[1]-q[1];distance0=dx*dx+dy*dy}}function moved(){var touches=d3.touches(target),p0=touches[0],l0=locations0[p0.identifier];if(p1=touches[1]){var p1,l1=locations0[p1.identifier],scale1=d3.event.scale;if(null==scale1){var distance1=(distance1=p1[0]-p0[0])*distance1+(distance1=p1[1]-p0[1])*distance1;scale1=distance0&&Math.sqrt(distance1/distance0)}p0=[(p0[0]+p1[0])/2,(p0[1]+p1[1])/2];l0=[(l0[0]+l1[0])/2,(l0[1]+l1[1])/2];scaleTo(scale1*scale0)}touchtime=null;translateTo(p0,l0);zoomed(event_)}function ended(){if(d3.event.touches.length)relocate();else{w.on(touchmove,null).on(touchend,null);t.on(mousedown,mousedowned).on(touchstart,touchstarted);dragRestore();zoomended(event_)}}var locations0,scale0,target=this,event_=event.of(target,arguments),distance0=0,w=d3.select(d3_window).on(touchmove,moved).on(touchend,ended),t=d3.select(target).on(mousedown,null).on(touchstart,started),dragRestore=d3_event_dragSuppress();d3_selection_interrupt.call(target);started();zoomstarted(event_)}function mousewheeled(){var event_=event.of(this,arguments);mousewheelTimer?clearTimeout(mousewheelTimer):(d3_selection_interrupt.call(this),zoomstarted(event_));mousewheelTimer=setTimeout(function(){mousewheelTimer=null;zoomended(event_)},50);d3_eventPreventDefault();var point=center||d3.mouse(this);translate0||(translate0=location(point));scaleTo(Math.pow(2,.002*d3_behavior_zoomDelta())*view.k);translateTo(point,translate0);zoomed(event_)}function mousewheelreset(){translate0=null}function dblclicked(){var event_=event.of(this,arguments),p=d3.mouse(this),l=location(p),k=Math.log(view.k)/Math.LN2;zoomstarted(event_);scaleTo(Math.pow(2,d3.event.shiftKey?Math.ceil(k)-1:Math.floor(k)+1));translateTo(p,l);zoomed(event_);zoomended(event_)}var translate0,center,mousewheelTimer,touchtime,x0,x1,y0,y1,view={x:0,y:0,k:1},size=[960,500],scaleExtent=d3_behavior_zoomInfinity,mousedown="mousedown.zoom",mousemove="mousemove.zoom",mouseup="mouseup.zoom",touchstart="touchstart.zoom",touchmove="touchmove.zoom",touchend="touchend.zoom",event=d3_eventDispatch(zoom,"zoomstart","zoom","zoomend");zoom.event=function(g){g.each(function(){var event_=event.of(this,arguments),view1=view;if(d3_transitionInheritId)d3.select(this).transition().each("start.zoom",function(){view=this.__chart__||{x:0,y:0,k:1};zoomstarted(event_)}).tween("zoom:zoom",function(){var dx=size[0],dy=size[1],cx=dx/2,cy=dy/2,i=d3.interpolateZoom([(cx-view.x)/view.k,(cy-view.y)/view.k,dx/view.k],[(cx-view1.x)/view1.k,(cy-view1.y)/view1.k,dx/view1.k]);return function(t){var l=i(t),k=dx/l[2];this.__chart__=view={x:cx-l[0]*k,y:cy-l[1]*k,k:k};zoomed(event_)}}).each("end.zoom",function(){zoomended(event_)});else{this.__chart__=view;zoomstarted(event_);zoomed(event_);zoomended(event_)}})};zoom.translate=function(_){if(!arguments.length)return[view.x,view.y];view={x:+_[0],y:+_[1],k:view.k};rescale();return zoom};zoom.scale=function(_){if(!arguments.length)return view.k;view={x:view.x,y:view.y,k:+_};rescale();return zoom};zoom.scaleExtent=function(_){if(!arguments.length)return scaleExtent;scaleExtent=null==_?d3_behavior_zoomInfinity:[+_[0],+_[1]];return zoom};zoom.center=function(_){if(!arguments.length)return center;center=_&&[+_[0],+_[1]];return zoom};zoom.size=function(_){if(!arguments.length)return size;size=_&&[+_[0],+_[1]];return zoom};zoom.x=function(z){if(!arguments.length)return x1;x1=z;x0=z.copy();view={x:0,y:0,k:1};return zoom};zoom.y=function(z){if(!arguments.length)return y1;y1=z;y0=z.copy();view={x:0,y:0,k:1};return zoom};return d3.rebind(zoom,event,"on")};var d3_behavior_zoomDelta,d3_behavior_zoomInfinity=[0,1/0],d3_behavior_zoomWheel="onwheel"in d3_document?(d3_behavior_zoomDelta=function(){return-d3.event.deltaY*(d3.event.deltaMode?120:1)},"wheel"):"onmousewheel"in d3_document?(d3_behavior_zoomDelta=function(){return d3.event.wheelDelta},"mousewheel"):(d3_behavior_zoomDelta=function(){return-d3.event.detail},"MozMousePixelScroll");d3_Color.prototype.toString=function(){return this.rgb()+""};d3.hsl=function(h,s,l){return 1===arguments.length?h instanceof d3_Hsl?d3_hsl(h.h,h.s,h.l):d3_rgb_parse(""+h,d3_rgb_hsl,d3_hsl):d3_hsl(+h,+s,+l)};var d3_hslPrototype=d3_Hsl.prototype=new d3_Color;d3_hslPrototype.brighter=function(k){k=Math.pow(.7,arguments.length?k:1);return d3_hsl(this.h,this.s,this.l/k)};d3_hslPrototype.darker=function(k){k=Math.pow(.7,arguments.length?k:1);return d3_hsl(this.h,this.s,k*this.l)};d3_hslPrototype.rgb=function(){return d3_hsl_rgb(this.h,this.s,this.l)};d3.hcl=function(h,c,l){return 1===arguments.length?h instanceof d3_Hcl?d3_hcl(h.h,h.c,h.l):h instanceof d3_Lab?d3_lab_hcl(h.l,h.a,h.b):d3_lab_hcl((h=d3_rgb_lab((h=d3.rgb(h)).r,h.g,h.b)).l,h.a,h.b):d3_hcl(+h,+c,+l)};var d3_hclPrototype=d3_Hcl.prototype=new d3_Color;d3_hclPrototype.brighter=function(k){return d3_hcl(this.h,this.c,Math.min(100,this.l+d3_lab_K*(arguments.length?k:1)))};d3_hclPrototype.darker=function(k){return d3_hcl(this.h,this.c,Math.max(0,this.l-d3_lab_K*(arguments.length?k:1)))};d3_hclPrototype.rgb=function(){return d3_hcl_lab(this.h,this.c,this.l).rgb()};d3.lab=function(l,a,b){return 1===arguments.length?l instanceof d3_Lab?d3_lab(l.l,l.a,l.b):l instanceof d3_Hcl?d3_hcl_lab(l.l,l.c,l.h):d3_rgb_lab((l=d3.rgb(l)).r,l.g,l.b):d3_lab(+l,+a,+b)};var d3_lab_K=18,d3_lab_X=.95047,d3_lab_Y=1,d3_lab_Z=1.08883,d3_labPrototype=d3_Lab.prototype=new d3_Color;d3_labPrototype.brighter=function(k){return d3_lab(Math.min(100,this.l+d3_lab_K*(arguments.length?k:1)),this.a,this.b)};d3_labPrototype.darker=function(k){return d3_lab(Math.max(0,this.l-d3_lab_K*(arguments.length?k:1)),this.a,this.b)};d3_labPrototype.rgb=function(){return d3_lab_rgb(this.l,this.a,this.b)};d3.rgb=function(r,g,b){return 1===arguments.length?r instanceof d3_Rgb?d3_rgb(r.r,r.g,r.b):d3_rgb_parse(""+r,d3_rgb,d3_hsl_rgb):d3_rgb(~~r,~~g,~~b)};var d3_rgbPrototype=d3_Rgb.prototype=new d3_Color;d3_rgbPrototype.brighter=function(k){k=Math.pow(.7,arguments.length?k:1);var r=this.r,g=this.g,b=this.b,i=30;if(!r&&!g&&!b)return d3_rgb(i,i,i);r&&i>r&&(r=i);g&&i>g&&(g=i);b&&i>b&&(b=i);return d3_rgb(Math.min(255,~~(r/k)),Math.min(255,~~(g/k)),Math.min(255,~~(b/k)))};d3_rgbPrototype.darker=function(k){k=Math.pow(.7,arguments.length?k:1);return d3_rgb(~~(k*this.r),~~(k*this.g),~~(k*this.b))};d3_rgbPrototype.hsl=function(){return d3_rgb_hsl(this.r,this.g,this.b)};d3_rgbPrototype.toString=function(){return"#"+d3_rgb_hex(this.r)+d3_rgb_hex(this.g)+d3_rgb_hex(this.b)};var d3_rgb_names=d3.map({aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074});d3_rgb_names.forEach(function(key,value){d3_rgb_names.set(key,d3_rgbNumber(value))});d3.functor=d3_functor;d3.xhr=d3_xhrType(d3_identity);d3.dsv=function(delimiter,mimeType){function dsv(url,row,callback){arguments.length<3&&(callback=row,row=null);var xhr=d3.xhr(url,mimeType,callback);xhr.row=function(_){return arguments.length?xhr.response(null==(row=_)?response:typedResponse(_)):row};return xhr.row(row)}function response(request){return dsv.parse(request.responseText)}function typedResponse(f){return function(request){return dsv.parse(request.responseText,f)}}function formatRow(row){return row.map(formatValue).join(delimiter)}function formatValue(text){return reFormat.test(text)?'"'+text.replace(/\"/g,'""')+'"':text}var reFormat=new RegExp('["'+delimiter+"\n]"),delimiterCode=delimiter.charCodeAt(0);dsv.parse=function(text,f){var o;return dsv.parseRows(text,function(row,i){if(o)return o(row,i-1);var a=new Function("d","return {"+row.map(function(name,i){return JSON.stringify(name)+": d["+i+"]"}).join(",")+"}");o=f?function(row,i){return f(a(row),i)}:a})};dsv.parseRows=function(text,f){function token(){if(I>=N)return EOF;if(eol)return eol=!1,EOL;var j=I;if(34===text.charCodeAt(j)){for(var i=j;i++<N;)if(34===text.charCodeAt(i)){if(34!==text.charCodeAt(i+1))break;++i}I=i+2;var c=text.charCodeAt(i+1);if(13===c){eol=!0;10===text.charCodeAt(i+2)&&++I}else 10===c&&(eol=!0);return text.substring(j+1,i).replace(/""/g,'"')}for(;N>I;){var c=text.charCodeAt(I++),k=1;if(10===c)eol=!0;else if(13===c){eol=!0;10===text.charCodeAt(I)&&(++I,++k)}else if(c!==delimiterCode)continue;return text.substring(j,I-k)}return text.substring(j)}for(var t,eol,EOL={},EOF={},rows=[],N=text.length,I=0,n=0;(t=token())!==EOF;){for(var a=[];t!==EOL&&t!==EOF;){a.push(t);t=token()}(!f||(a=f(a,n++)))&&rows.push(a)}return rows};dsv.format=function(rows){if(Array.isArray(rows[0]))return dsv.formatRows(rows);var fieldSet=new d3_Set,fields=[];rows.forEach(function(row){for(var field in row)fieldSet.has(field)||fields.push(fieldSet.add(field))});return[fields.map(formatValue).join(delimiter)].concat(rows.map(function(row){return fields.map(function(field){return formatValue(row[field])}).join(delimiter)})).join("\n")};dsv.formatRows=function(rows){return rows.map(formatRow).join("\n")};return dsv};d3.csv=d3.dsv(",","text/csv");d3.tsv=d3.dsv("	","text/tab-separated-values");var d3_timer_queueHead,d3_timer_queueTail,d3_timer_interval,d3_timer_timeout,d3_timer_active,d3_timer_frame=d3_window[d3_vendorSymbol(d3_window,"requestAnimationFrame")]||function(callback){setTimeout(callback,17)};d3.timer=function(callback,delay,then){var n=arguments.length;2>n&&(delay=0);3>n&&(then=Date.now());var time=then+delay,timer={callback:callback,time:time,next:null};d3_timer_queueTail?d3_timer_queueTail.next=timer:d3_timer_queueHead=timer;d3_timer_queueTail=timer;if(!d3_timer_interval){d3_timer_timeout=clearTimeout(d3_timer_timeout);d3_timer_interval=1;d3_timer_frame(d3_timer_step)}};d3.timer.flush=function(){d3_timer_mark();d3_timer_sweep()};var d3_format_decimalPoint=".",d3_format_thousandsSeparator=",",d3_format_grouping=[3,3],d3_format_currencySymbol="$",d3_formatPrefixes=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"].map(d3_formatPrefix);d3.formatPrefix=function(value,precision){var i=0;if(value){0>value&&(value*=-1);precision&&(value=d3.round(value,d3_format_precision(value,precision)));i=1+Math.floor(1e-12+Math.log(value)/Math.LN10);i=Math.max(-24,Math.min(24,3*Math.floor((0>=i?i+1:i-1)/3)))}return d3_formatPrefixes[8+i/3]};d3.round=function(x,n){return n?Math.round(x*(n=Math.pow(10,n)))/n:Math.round(x)};d3.format=function(specifier){var match=d3_format_re.exec(specifier),fill=match[1]||" ",align=match[2]||">",sign=match[3]||"",symbol=match[4]||"",zfill=match[5],width=+match[6],comma=match[7],precision=match[8],type=match[9],scale=1,suffix="",integer=!1;precision&&(precision=+precision.substring(1));if(zfill||"0"===fill&&"="===align){zfill=fill="0";align="=";comma&&(width-=Math.floor((width-1)/4))}switch(type){case"n":comma=!0;type="g";break;case"%":scale=100;suffix="%";type="f";break;case"p":scale=100;suffix="%";type="r";break;case"b":case"o":case"x":case"X":"#"===symbol&&(symbol="0"+type.toLowerCase());case"c":case"d":integer=!0;precision=0;break;case"s":scale=-1;type="r"}"#"===symbol?symbol="":"$"===symbol&&(symbol=d3_format_currencySymbol);"r"!=type||precision||(type="g");null!=precision&&("g"==type?precision=Math.max(1,Math.min(21,precision)):("e"==type||"f"==type)&&(precision=Math.max(0,Math.min(20,precision))));type=d3_format_types.get(type)||d3_format_typeDefault;var zcomma=zfill&&comma;return function(value){if(integer&&value%1)return"";var negative=0>value||0===value&&0>1/value?(value=-value,"-"):sign;if(0>scale){var prefix=d3.formatPrefix(value,precision);value=prefix.scale(value);suffix=prefix.symbol}else value*=scale;value=type(value,precision);var i=value.lastIndexOf("."),before=0>i?value:value.substring(0,i),after=0>i?"":d3_format_decimalPoint+value.substring(i+1);!zfill&&comma&&(before=d3_format_group(before));var length=symbol.length+before.length+after.length+(zcomma?0:negative.length),padding=width>length?new Array(length=width-length+1).join(fill):"";zcomma&&(before=d3_format_group(padding+before));negative+=symbol;value=before+after;return("<"===align?negative+value+padding:">"===align?padding+negative+value:"^"===align?padding.substring(0,length>>=1)+negative+value+padding.substring(length):negative+(zcomma?value:padding+value))+suffix}};var d3_format_re=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i,d3_format_types=d3.map({b:function(x){return x.toString(2)},c:function(x){return String.fromCharCode(x)},o:function(x){return x.toString(8)},x:function(x){return x.toString(16)},X:function(x){return x.toString(16).toUpperCase()},g:function(x,p){return x.toPrecision(p)},e:function(x,p){return x.toExponential(p)},f:function(x,p){return x.toFixed(p)},r:function(x,p){return(x=d3.round(x,d3_format_precision(x,p))).toFixed(Math.max(0,Math.min(20,d3_format_precision(x*(1+1e-15),p))))}}),d3_format_group=d3_identity;if(d3_format_grouping){var d3_format_groupingLength=d3_format_grouping.length;d3_format_group=function(value){for(var i=value.length,t=[],j=0,g=d3_format_grouping[0];i>0&&g>0;){t.push(value.substring(i-=g,i+g));g=d3_format_grouping[j=(j+1)%d3_format_groupingLength]}return t.reverse().join(d3_format_thousandsSeparator)}}d3.geo={};d3_adder.prototype={s:0,t:0,add:function(y){d3_adderSum(y,this.t,d3_adderTemp);d3_adderSum(d3_adderTemp.s,this.s,this);this.s?this.t+=d3_adderTemp.t:this.s=d3_adderTemp.t},reset:function(){this.s=this.t=0},valueOf:function(){return this.s}};var d3_adderTemp=new d3_adder;d3.geo.stream=function(object,listener){object&&d3_geo_streamObjectType.hasOwnProperty(object.type)?d3_geo_streamObjectType[object.type](object,listener):d3_geo_streamGeometry(object,listener)};var d3_geo_streamObjectType={Feature:function(feature,listener){d3_geo_streamGeometry(feature.geometry,listener)},FeatureCollection:function(object,listener){for(var features=object.features,i=-1,n=features.length;++i<n;)d3_geo_streamGeometry(features[i].geometry,listener)}},d3_geo_streamGeometryType={Sphere:function(object,listener){listener.sphere()},Point:function(object,listener){object=object.coordinates;listener.point(object[0],object[1],object[2])},MultiPoint:function(object,listener){for(var coordinates=object.coordinates,i=-1,n=coordinates.length;++i<n;)object=coordinates[i],listener.point(object[0],object[1],object[2])},LineString:function(object,listener){d3_geo_streamLine(object.coordinates,listener,0)},MultiLineString:function(object,listener){for(var coordinates=object.coordinates,i=-1,n=coordinates.length;++i<n;)d3_geo_streamLine(coordinates[i],listener,0)},Polygon:function(object,listener){d3_geo_streamPolygon(object.coordinates,listener)},MultiPolygon:function(object,listener){for(var coordinates=object.coordinates,i=-1,n=coordinates.length;++i<n;)d3_geo_streamPolygon(coordinates[i],listener)},GeometryCollection:function(object,listener){for(var geometries=object.geometries,i=-1,n=geometries.length;++i<n;)d3_geo_streamGeometry(geometries[i],listener)}};d3.geo.area=function(object){d3_geo_areaSum=0;d3.geo.stream(object,d3_geo_area);return d3_geo_areaSum};var d3_geo_areaSum,d3_geo_areaRingSum=new d3_adder,d3_geo_area={sphere:function(){d3_geo_areaSum+=4*π},point:d3_noop,lineStart:d3_noop,lineEnd:d3_noop,polygonStart:function(){d3_geo_areaRingSum.reset();d3_geo_area.lineStart=d3_geo_areaRingStart},polygonEnd:function(){var area=2*d3_geo_areaRingSum;d3_geo_areaSum+=0>area?4*π+area:area;d3_geo_area.lineStart=d3_geo_area.lineEnd=d3_geo_area.point=d3_noop}};d3.geo.bounds=function(){function point(λ,φ){ranges.push(range=[λ0=λ,λ1=λ]);φ0>φ&&(φ0=φ);φ>φ1&&(φ1=φ)}function linePoint(λ,φ){var p=d3_geo_cartesian([λ*d3_radians,φ*d3_radians]);if(p0){var normal=d3_geo_cartesianCross(p0,p),equatorial=[normal[1],-normal[0],0],inflection=d3_geo_cartesianCross(equatorial,normal);d3_geo_cartesianNormalize(inflection);inflection=d3_geo_spherical(inflection);var dλ=λ-λ_,s=dλ>0?1:-1,λi=inflection[0]*d3_degrees*s,antimeridian=Math.abs(dλ)>180;if(antimeridian^(λi>s*λ_&&s*λ>λi)){var φi=inflection[1]*d3_degrees;φi>φ1&&(φ1=φi)}else if(λi=(λi+360)%360-180,antimeridian^(λi>s*λ_&&s*λ>λi)){var φi=-inflection[1]*d3_degrees;φ0>φi&&(φ0=φi)}else{φ0>φ&&(φ0=φ);φ>φ1&&(φ1=φ)}if(antimeridian)λ_>λ?angle(λ0,λ)>angle(λ0,λ1)&&(λ1=λ):angle(λ,λ1)>angle(λ0,λ1)&&(λ0=λ);else if(λ1>=λ0){λ0>λ&&(λ0=λ);λ>λ1&&(λ1=λ)}else λ>λ_?angle(λ0,λ)>angle(λ0,λ1)&&(λ1=λ):angle(λ,λ1)>angle(λ0,λ1)&&(λ0=λ)}else point(λ,φ);p0=p,λ_=λ}function lineStart(){bound.point=linePoint}function lineEnd(){range[0]=λ0,range[1]=λ1;bound.point=point;p0=null}function ringPoint(λ,φ){if(p0){var dλ=λ-λ_;dλSum+=Math.abs(dλ)>180?dλ+(dλ>0?360:-360):dλ}else λ__=λ,φ__=φ;d3_geo_area.point(λ,φ);linePoint(λ,φ)}function ringStart(){d3_geo_area.lineStart()}function ringEnd(){ringPoint(λ__,φ__);d3_geo_area.lineEnd();Math.abs(dλSum)>ε&&(λ0=-(λ1=180));range[0]=λ0,range[1]=λ1;p0=null}function angle(λ0,λ1){return(λ1-=λ0)<0?λ1+360:λ1}function compareRanges(a,b){return a[0]-b[0]}function withinRange(x,range){return range[0]<=range[1]?range[0]<=x&&x<=range[1]:x<range[0]||range[1]<x}var λ0,φ0,λ1,φ1,λ_,λ__,φ__,p0,dλSum,ranges,range,bound={point:point,lineStart:lineStart,lineEnd:lineEnd,polygonStart:function(){bound.point=ringPoint;bound.lineStart=ringStart;bound.lineEnd=ringEnd;dλSum=0;d3_geo_area.polygonStart()},polygonEnd:function(){d3_geo_area.polygonEnd();bound.point=point;bound.lineStart=lineStart;bound.lineEnd=lineEnd;0>d3_geo_areaRingSum?(λ0=-(λ1=180),φ0=-(φ1=90)):dλSum>ε?φ1=90:-ε>dλSum&&(φ0=-90);range[0]=λ0,range[1]=λ1}};return function(feature){φ1=λ1=-(λ0=φ0=1/0);ranges=[];d3.geo.stream(feature,bound);var n=ranges.length;if(n){ranges.sort(compareRanges);for(var b,i=1,a=ranges[0],merged=[a];n>i;++i){b=ranges[i];if(withinRange(b[0],a)||withinRange(b[1],a)){angle(a[0],b[1])>angle(a[0],a[1])&&(a[1]=b[1]);angle(b[0],a[1])>angle(a[0],a[1])&&(a[0]=b[0])}else merged.push(a=b)}for(var dλ,b,best=-1/0,n=merged.length-1,i=0,a=merged[n];n>=i;a=b,++i){b=merged[i];(dλ=angle(a[1],b[0]))>best&&(best=dλ,λ0=b[0],λ1=a[1])}}ranges=range=null;return 1/0===λ0||1/0===φ0?[[0/0,0/0],[0/0,0/0]]:[[λ0,φ0],[λ1,φ1]]}}();d3.geo.centroid=function(object){d3_geo_centroidW0=d3_geo_centroidW1=d3_geo_centroidX0=d3_geo_centroidY0=d3_geo_centroidZ0=d3_geo_centroidX1=d3_geo_centroidY1=d3_geo_centroidZ1=d3_geo_centroidX2=d3_geo_centroidY2=d3_geo_centroidZ2=0;d3.geo.stream(object,d3_geo_centroid);var x=d3_geo_centroidX2,y=d3_geo_centroidY2,z=d3_geo_centroidZ2,m=x*x+y*y+z*z;if(ε2>m){x=d3_geo_centroidX1,y=d3_geo_centroidY1,z=d3_geo_centroidZ1;ε>d3_geo_centroidW1&&(x=d3_geo_centroidX0,y=d3_geo_centroidY0,z=d3_geo_centroidZ0);m=x*x+y*y+z*z;if(ε2>m)return[0/0,0/0]}return[Math.atan2(y,x)*d3_degrees,d3_asin(z/Math.sqrt(m))*d3_degrees]};var d3_geo_centroidW0,d3_geo_centroidW1,d3_geo_centroidX0,d3_geo_centroidY0,d3_geo_centroidZ0,d3_geo_centroidX1,d3_geo_centroidY1,d3_geo_centroidZ1,d3_geo_centroidX2,d3_geo_centroidY2,d3_geo_centroidZ2,d3_geo_centroid={sphere:d3_noop,point:d3_geo_centroidPoint,lineStart:d3_geo_centroidLineStart,lineEnd:d3_geo_centroidLineEnd,polygonStart:function(){d3_geo_centroid.lineStart=d3_geo_centroidRingStart},polygonEnd:function(){d3_geo_centroid.lineStart=d3_geo_centroidLineStart}},d3_geo_clipAntimeridian=d3_geo_clip(d3_true,d3_geo_clipAntimeridianLine,d3_geo_clipAntimeridianInterpolate,d3_geo_clipAntimeridianPolygonContains),d3_geo_clipAntimeridianPoint=[-π,0],d3_geo_clipExtentMAX=1e9;d3.geo.clipExtent=function(){var x0,y0,x1,y1,stream,clip,clipExtent={stream:function(output){stream&&(stream.valid=!1);stream=clip(output);stream.valid=!0;return stream},extent:function(_){if(!arguments.length)return[[x0,y0],[x1,y1]];clip=d3_geo_clipExtent(x0=+_[0][0],y0=+_[0][1],x1=+_[1][0],y1=+_[1][1]);stream&&(stream.valid=!1,stream=null);return clipExtent}};return clipExtent.extent([[0,0],[960,500]])};(d3.geo.conicEqualArea=function(){return d3_geo_conic(d3_geo_conicEqualArea)}).raw=d3_geo_conicEqualArea;d3.geo.albers=function(){return d3.geo.conicEqualArea().rotate([96,0]).center([-.6,38.7]).parallels([29.5,45.5]).scale(1070)};d3.geo.albersUsa=function(){function albersUsa(coordinates){var x=coordinates[0],y=coordinates[1];point=null;(lower48Point(x,y),point)||(alaskaPoint(x,y),point)||hawaiiPoint(x,y);return point}var point,lower48Point,alaskaPoint,hawaiiPoint,lower48=d3.geo.albers(),alaska=d3.geo.conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]),hawaii=d3.geo.conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]),pointStream={point:function(x,y){point=[x,y]}};albersUsa.invert=function(coordinates){var k=lower48.scale(),t=lower48.translate(),x=(coordinates[0]-t[0])/k,y=(coordinates[1]-t[1])/k;return(y>=.12&&.234>y&&x>=-.425&&-.214>x?alaska:y>=.166&&.234>y&&x>=-.214&&-.115>x?hawaii:lower48).invert(coordinates)};albersUsa.stream=function(stream){var lower48Stream=lower48.stream(stream),alaskaStream=alaska.stream(stream),hawaiiStream=hawaii.stream(stream);return{point:function(x,y){lower48Stream.point(x,y);alaskaStream.point(x,y);hawaiiStream.point(x,y)},sphere:function(){lower48Stream.sphere();alaskaStream.sphere();hawaiiStream.sphere()},lineStart:function(){lower48Stream.lineStart();alaskaStream.lineStart();hawaiiStream.lineStart()},lineEnd:function(){lower48Stream.lineEnd();alaskaStream.lineEnd();hawaiiStream.lineEnd()},polygonStart:function(){lower48Stream.polygonStart();alaskaStream.polygonStart();hawaiiStream.polygonStart()},polygonEnd:function(){lower48Stream.polygonEnd();alaskaStream.polygonEnd();hawaiiStream.polygonEnd()}}};albersUsa.precision=function(_){if(!arguments.length)return lower48.precision();lower48.precision(_);alaska.precision(_);hawaii.precision(_);return albersUsa};albersUsa.scale=function(_){if(!arguments.length)return lower48.scale();lower48.scale(_);alaska.scale(.35*_);hawaii.scale(_);return albersUsa.translate(lower48.translate())};albersUsa.translate=function(_){if(!arguments.length)return lower48.translate();var k=lower48.scale(),x=+_[0],y=+_[1];lower48Point=lower48.translate(_).clipExtent([[x-.455*k,y-.238*k],[x+.455*k,y+.238*k]]).stream(pointStream).point;alaskaPoint=alaska.translate([x-.307*k,y+.201*k]).clipExtent([[x-.425*k+ε,y+.12*k+ε],[x-.214*k-ε,y+.234*k-ε]]).stream(pointStream).point;hawaiiPoint=hawaii.translate([x-.205*k,y+.212*k]).clipExtent([[x-.214*k+ε,y+.166*k+ε],[x-.115*k-ε,y+.234*k-ε]]).stream(pointStream).point;return albersUsa};return albersUsa.scale(1070)};var d3_geo_pathAreaSum,d3_geo_pathAreaPolygon,d3_geo_pathBoundsX0,d3_geo_pathBoundsY0,d3_geo_pathBoundsX1,d3_geo_pathBoundsY1,d3_geo_pathArea={point:d3_noop,lineStart:d3_noop,lineEnd:d3_noop,polygonStart:function(){d3_geo_pathAreaPolygon=0;d3_geo_pathArea.lineStart=d3_geo_pathAreaRingStart},polygonEnd:function(){d3_geo_pathArea.lineStart=d3_geo_pathArea.lineEnd=d3_geo_pathArea.point=d3_noop;d3_geo_pathAreaSum+=Math.abs(d3_geo_pathAreaPolygon/2)}},d3_geo_pathBounds={point:d3_geo_pathBoundsPoint,lineStart:d3_noop,lineEnd:d3_noop,polygonStart:d3_noop,polygonEnd:d3_noop},d3_geo_pathCentroid={point:d3_geo_pathCentroidPoint,lineStart:d3_geo_pathCentroidLineStart,lineEnd:d3_geo_pathCentroidLineEnd,polygonStart:function(){d3_geo_pathCentroid.lineStart=d3_geo_pathCentroidRingStart},polygonEnd:function(){d3_geo_pathCentroid.point=d3_geo_pathCentroidPoint;d3_geo_pathCentroid.lineStart=d3_geo_pathCentroidLineStart;d3_geo_pathCentroid.lineEnd=d3_geo_pathCentroidLineEnd}};d3.geo.transform=function(methods){return{stream:function(stream){var transform=new d3_geo_transform(stream);for(var k in methods)transform[k]=methods[k];return transform}}};d3_geo_transform.prototype={point:function(x,y){this.stream.point(x,y)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};d3.geo.path=function(){function path(object){if(object){"function"==typeof pointRadius&&contextStream.pointRadius(+pointRadius.apply(this,arguments));cacheStream&&cacheStream.valid||(cacheStream=projectStream(contextStream));d3.geo.stream(object,cacheStream)}return contextStream.result()}function reset(){cacheStream=null;return path}var projection,context,projectStream,contextStream,cacheStream,pointRadius=4.5;path.area=function(object){d3_geo_pathAreaSum=0;d3.geo.stream(object,projectStream(d3_geo_pathArea));return d3_geo_pathAreaSum};path.centroid=function(object){d3_geo_centroidX0=d3_geo_centroidY0=d3_geo_centroidZ0=d3_geo_centroidX1=d3_geo_centroidY1=d3_geo_centroidZ1=d3_geo_centroidX2=d3_geo_centroidY2=d3_geo_centroidZ2=0;d3.geo.stream(object,projectStream(d3_geo_pathCentroid));return d3_geo_centroidZ2?[d3_geo_centroidX2/d3_geo_centroidZ2,d3_geo_centroidY2/d3_geo_centroidZ2]:d3_geo_centroidZ1?[d3_geo_centroidX1/d3_geo_centroidZ1,d3_geo_centroidY1/d3_geo_centroidZ1]:d3_geo_centroidZ0?[d3_geo_centroidX0/d3_geo_centroidZ0,d3_geo_centroidY0/d3_geo_centroidZ0]:[0/0,0/0]};path.bounds=function(object){d3_geo_pathBoundsX1=d3_geo_pathBoundsY1=-(d3_geo_pathBoundsX0=d3_geo_pathBoundsY0=1/0);d3.geo.stream(object,projectStream(d3_geo_pathBounds));return[[d3_geo_pathBoundsX0,d3_geo_pathBoundsY0],[d3_geo_pathBoundsX1,d3_geo_pathBoundsY1]]};path.projection=function(_){if(!arguments.length)return projection;projectStream=(projection=_)?_.stream||d3_geo_pathProjectStream(_):d3_identity;return reset()};path.context=function(_){if(!arguments.length)return context;contextStream=null==(context=_)?new d3_geo_pathBuffer:new d3_geo_pathContext(_);"function"!=typeof pointRadius&&contextStream.pointRadius(pointRadius);return reset()};path.pointRadius=function(_){if(!arguments.length)return pointRadius;pointRadius="function"==typeof _?_:(contextStream.pointRadius(+_),+_);return path};return path.projection(d3.geo.albersUsa()).context(null)};d3.geo.projection=d3_geo_projection;d3.geo.projectionMutator=d3_geo_projectionMutator;(d3.geo.equirectangular=function(){return d3_geo_projection(d3_geo_equirectangular)}).raw=d3_geo_equirectangular.invert=d3_geo_equirectangular;d3.geo.rotation=function(rotate){function forward(coordinates){coordinates=rotate(coordinates[0]*d3_radians,coordinates[1]*d3_radians);return coordinates[0]*=d3_degrees,coordinates[1]*=d3_degrees,coordinates}rotate=d3_geo_rotation(rotate[0]%360*d3_radians,rotate[1]*d3_radians,rotate.length>2?rotate[2]*d3_radians:0);forward.invert=function(coordinates){coordinates=rotate.invert(coordinates[0]*d3_radians,coordinates[1]*d3_radians);return coordinates[0]*=d3_degrees,coordinates[1]*=d3_degrees,coordinates};return forward};d3.geo.circle=function(){function circle(){var center="function"==typeof origin?origin.apply(this,arguments):origin,rotate=d3_geo_rotation(-center[0]*d3_radians,-center[1]*d3_radians,0).invert,ring=[];interpolate(null,null,1,{point:function(x,y){ring.push(x=rotate(x,y));x[0]*=d3_degrees,x[1]*=d3_degrees}});return{type:"Polygon",coordinates:[ring]}}var angle,interpolate,origin=[0,0],precision=6;circle.origin=function(x){if(!arguments.length)return origin;origin=x;return circle};circle.angle=function(x){if(!arguments.length)return angle;interpolate=d3_geo_circleInterpolate((angle=+x)*d3_radians,precision*d3_radians);return circle};circle.precision=function(_){if(!arguments.length)return precision;interpolate=d3_geo_circleInterpolate(angle*d3_radians,(precision=+_)*d3_radians);return circle};return circle.angle(90)};d3.geo.distance=function(a,b){var t,Δλ=(b[0]-a[0])*d3_radians,φ0=a[1]*d3_radians,φ1=b[1]*d3_radians,sinΔλ=Math.sin(Δλ),cosΔλ=Math.cos(Δλ),sinφ0=Math.sin(φ0),cosφ0=Math.cos(φ0),sinφ1=Math.sin(φ1),cosφ1=Math.cos(φ1);return Math.atan2(Math.sqrt((t=cosφ1*sinΔλ)*t+(t=cosφ0*sinφ1-sinφ0*cosφ1*cosΔλ)*t),sinφ0*sinφ1+cosφ0*cosφ1*cosΔλ)};d3.geo.graticule=function(){function graticule(){return{type:"MultiLineString",coordinates:lines()}}function lines(){return d3.range(Math.ceil(X0/DX)*DX,X1,DX).map(X).concat(d3.range(Math.ceil(Y0/DY)*DY,Y1,DY).map(Y)).concat(d3.range(Math.ceil(x0/dx)*dx,x1,dx).filter(function(x){return Math.abs(x%DX)>ε}).map(x)).concat(d3.range(Math.ceil(y0/dy)*dy,y1,dy).filter(function(y){return Math.abs(y%DY)>ε}).map(y))}var x1,x0,X1,X0,y1,y0,Y1,Y0,x,y,X,Y,dx=10,dy=dx,DX=90,DY=360,precision=2.5;graticule.lines=function(){return lines().map(function(coordinates){return{type:"LineString",coordinates:coordinates}
})};graticule.outline=function(){return{type:"Polygon",coordinates:[X(X0).concat(Y(Y1).slice(1),X(X1).reverse().slice(1),Y(Y0).reverse().slice(1))]}};graticule.extent=function(_){return arguments.length?graticule.majorExtent(_).minorExtent(_):graticule.minorExtent()};graticule.majorExtent=function(_){if(!arguments.length)return[[X0,Y0],[X1,Y1]];X0=+_[0][0],X1=+_[1][0];Y0=+_[0][1],Y1=+_[1][1];X0>X1&&(_=X0,X0=X1,X1=_);Y0>Y1&&(_=Y0,Y0=Y1,Y1=_);return graticule.precision(precision)};graticule.minorExtent=function(_){if(!arguments.length)return[[x0,y0],[x1,y1]];x0=+_[0][0],x1=+_[1][0];y0=+_[0][1],y1=+_[1][1];x0>x1&&(_=x0,x0=x1,x1=_);y0>y1&&(_=y0,y0=y1,y1=_);return graticule.precision(precision)};graticule.step=function(_){return arguments.length?graticule.majorStep(_).minorStep(_):graticule.minorStep()};graticule.majorStep=function(_){if(!arguments.length)return[DX,DY];DX=+_[0],DY=+_[1];return graticule};graticule.minorStep=function(_){if(!arguments.length)return[dx,dy];dx=+_[0],dy=+_[1];return graticule};graticule.precision=function(_){if(!arguments.length)return precision;precision=+_;x=d3_geo_graticuleX(y0,y1,90);y=d3_geo_graticuleY(x0,x1,precision);X=d3_geo_graticuleX(Y0,Y1,90);Y=d3_geo_graticuleY(X0,X1,precision);return graticule};return graticule.majorExtent([[-180,-90+ε],[180,90-ε]]).minorExtent([[-180,-80-ε],[180,80+ε]])};d3.geo.greatArc=function(){function greatArc(){return{type:"LineString",coordinates:[source_||source.apply(this,arguments),target_||target.apply(this,arguments)]}}var source_,target_,source=d3_source,target=d3_target;greatArc.distance=function(){return d3.geo.distance(source_||source.apply(this,arguments),target_||target.apply(this,arguments))};greatArc.source=function(_){if(!arguments.length)return source;source=_,source_="function"==typeof _?null:_;return greatArc};greatArc.target=function(_){if(!arguments.length)return target;target=_,target_="function"==typeof _?null:_;return greatArc};greatArc.precision=function(){return arguments.length?greatArc:0};return greatArc};d3.geo.interpolate=function(source,target){return d3_geo_interpolate(source[0]*d3_radians,source[1]*d3_radians,target[0]*d3_radians,target[1]*d3_radians)};d3.geo.length=function(object){d3_geo_lengthSum=0;d3.geo.stream(object,d3_geo_length);return d3_geo_lengthSum};var d3_geo_lengthSum,d3_geo_length={sphere:d3_noop,point:d3_noop,lineStart:d3_geo_lengthLineStart,lineEnd:d3_noop,polygonStart:d3_noop,polygonEnd:d3_noop},d3_geo_azimuthalEqualArea=d3_geo_azimuthal(function(cosλcosφ){return Math.sqrt(2/(1+cosλcosφ))},function(ρ){return 2*Math.asin(ρ/2)});(d3.geo.azimuthalEqualArea=function(){return d3_geo_projection(d3_geo_azimuthalEqualArea)}).raw=d3_geo_azimuthalEqualArea;var d3_geo_azimuthalEquidistant=d3_geo_azimuthal(function(cosλcosφ){var c=Math.acos(cosλcosφ);return c&&c/Math.sin(c)},d3_identity);(d3.geo.azimuthalEquidistant=function(){return d3_geo_projection(d3_geo_azimuthalEquidistant)}).raw=d3_geo_azimuthalEquidistant;(d3.geo.conicConformal=function(){return d3_geo_conic(d3_geo_conicConformal)}).raw=d3_geo_conicConformal;(d3.geo.conicEquidistant=function(){return d3_geo_conic(d3_geo_conicEquidistant)}).raw=d3_geo_conicEquidistant;var d3_geo_gnomonic=d3_geo_azimuthal(function(cosλcosφ){return 1/cosλcosφ},Math.atan);(d3.geo.gnomonic=function(){return d3_geo_projection(d3_geo_gnomonic)}).raw=d3_geo_gnomonic;d3_geo_mercator.invert=function(x,y){return[x,2*Math.atan(Math.exp(y))-π/2]};(d3.geo.mercator=function(){return d3_geo_mercatorProjection(d3_geo_mercator)}).raw=d3_geo_mercator;var d3_geo_orthographic=d3_geo_azimuthal(function(){return 1},Math.asin);(d3.geo.orthographic=function(){return d3_geo_projection(d3_geo_orthographic)}).raw=d3_geo_orthographic;var d3_geo_stereographic=d3_geo_azimuthal(function(cosλcosφ){return 1/(1+cosλcosφ)},function(ρ){return 2*Math.atan(ρ)});(d3.geo.stereographic=function(){return d3_geo_projection(d3_geo_stereographic)}).raw=d3_geo_stereographic;d3_geo_transverseMercator.invert=function(x,y){return[Math.atan2(d3_sinh(x),Math.cos(y)),d3_asin(Math.sin(y)/d3_cosh(x))]};(d3.geo.transverseMercator=function(){return d3_geo_mercatorProjection(d3_geo_transverseMercator)}).raw=d3_geo_transverseMercator;d3.geom={};d3.svg={};d3.svg.line=function(){return d3_svg_line(d3_identity)};var d3_svg_lineInterpolators=d3.map({linear:d3_svg_lineLinear,"linear-closed":d3_svg_lineLinearClosed,step:d3_svg_lineStep,"step-before":d3_svg_lineStepBefore,"step-after":d3_svg_lineStepAfter,basis:d3_svg_lineBasis,"basis-open":d3_svg_lineBasisOpen,"basis-closed":d3_svg_lineBasisClosed,bundle:d3_svg_lineBundle,cardinal:d3_svg_lineCardinal,"cardinal-open":d3_svg_lineCardinalOpen,"cardinal-closed":d3_svg_lineCardinalClosed,monotone:d3_svg_lineMonotone});d3_svg_lineInterpolators.forEach(function(key,value){value.key=key;value.closed=/-closed$/.test(key)});var d3_svg_lineBasisBezier1=[0,2/3,1/3,0],d3_svg_lineBasisBezier2=[0,1/3,2/3,0],d3_svg_lineBasisBezier3=[0,1/6,2/3,1/6];d3.geom.hull=function(vertices){function hull(data){if(data.length<3)return[];var vertices,d,i,j,x1,y1,x2,y2,u,v,a,sp,fx=d3_functor(x),fy=d3_functor(y),n=data.length,plen=n-1,points=[],stack=[],h=0;if(fx===d3_svg_lineX&&y===d3_svg_lineY)vertices=data;else for(i=0,vertices=[];n>i;++i)vertices.push([+fx.call(this,d=data[i],i),+fy.call(this,d,i)]);for(i=1;n>i;++i)(vertices[i][1]<vertices[h][1]||vertices[i][1]==vertices[h][1]&&vertices[i][0]<vertices[h][0])&&(h=i);for(i=0;n>i;++i)if(i!==h){y1=vertices[i][1]-vertices[h][1];x1=vertices[i][0]-vertices[h][0];points.push({angle:Math.atan2(y1,x1),index:i})}points.sort(function(a,b){return a.angle-b.angle});a=points[0].angle;v=points[0].index;u=0;for(i=1;plen>i;++i){j=points[i].index;if(a==points[i].angle){x1=vertices[v][0]-vertices[h][0];y1=vertices[v][1]-vertices[h][1];x2=vertices[j][0]-vertices[h][0];y2=vertices[j][1]-vertices[h][1];if(x1*x1+y1*y1>=x2*x2+y2*y2){points[i].index=-1;continue}points[u].index=-1}a=points[i].angle;u=i;v=j}stack.push(h);for(i=0,j=0;2>i;++j)if(points[j].index>-1){stack.push(points[j].index);i++}sp=stack.length;for(;plen>j;++j)if(!(points[j].index<0)){for(;!d3_geom_hullCCW(stack[sp-2],stack[sp-1],points[j].index,vertices);)--sp;stack[sp++]=points[j].index}var poly=[];for(i=sp-1;i>=0;--i)poly.push(data[stack[i]]);return poly}var x=d3_svg_lineX,y=d3_svg_lineY;if(arguments.length)return hull(vertices);hull.x=function(_){return arguments.length?(x=_,hull):x};hull.y=function(_){return arguments.length?(y=_,hull):y};return hull};d3.geom.polygon=function(coordinates){d3_subclass(coordinates,d3_geom_polygonPrototype);return coordinates};var d3_geom_polygonPrototype=d3.geom.polygon.prototype=[];d3_geom_polygonPrototype.area=function(){for(var a,i=-1,n=this.length,b=this[n-1],area=0;++i<n;){a=b;b=this[i];area+=a[1]*b[0]-a[0]*b[1]}return.5*area};d3_geom_polygonPrototype.centroid=function(k){var a,c,i=-1,n=this.length,x=0,y=0,b=this[n-1];arguments.length||(k=-1/(6*this.area()));for(;++i<n;){a=b;b=this[i];c=a[0]*b[1]-b[0]*a[1];x+=(a[0]+b[0])*c;y+=(a[1]+b[1])*c}return[x*k,y*k]};d3_geom_polygonPrototype.clip=function(subject){for(var input,j,m,b,c,d,closed=d3_geom_polygonClosed(subject),i=-1,n=this.length-d3_geom_polygonClosed(this),a=this[n-1];++i<n;){input=subject.slice();subject.length=0;b=this[i];c=input[(m=input.length-closed)-1];j=-1;for(;++j<m;){d=input[j];if(d3_geom_polygonInside(d,a,b)){d3_geom_polygonInside(c,a,b)||subject.push(d3_geom_polygonIntersect(c,d,a,b));subject.push(d)}else d3_geom_polygonInside(c,a,b)&&subject.push(d3_geom_polygonIntersect(c,d,a,b));c=d}closed&&subject.push(subject[0]);a=b}return subject};d3.geom.delaunay=function(vertices){var edges=vertices.map(function(){return[]}),triangles=[];d3_geom_voronoiTessellate(vertices,function(e){edges[e.region.l.index].push(vertices[e.region.r.index])});edges.forEach(function(edge,i){var v=vertices[i],cx=v[0],cy=v[1];edge.forEach(function(v){v.angle=Math.atan2(v[0]-cx,v[1]-cy)});edge.sort(function(a,b){return a.angle-b.angle});for(var j=0,m=edge.length-1;m>j;j++)triangles.push([v,edge[j],edge[j+1]])});return triangles};d3.geom.voronoi=function(points){function voronoi(data){var points,d,i,polygons=data.map(function(){return[]}),fx=d3_functor(x),fy=d3_functor(y),n=data.length,Z=1e6;if(fx===d3_svg_lineX&&fy===d3_svg_lineY)points=data;else for(points=new Array(n),i=0;n>i;++i)points[i]=[+fx.call(this,d=data[i],i),+fy.call(this,d,i)];d3_geom_voronoiTessellate(points,function(e){var s1,s2,x1,x2,y1,y2;if(1===e.a&&e.b>=0){s1=e.ep.r;s2=e.ep.l}else{s1=e.ep.l;s2=e.ep.r}if(1===e.a){y1=s1?s1.y:-Z;x1=e.c-e.b*y1;y2=s2?s2.y:Z;x2=e.c-e.b*y2}else{x1=s1?s1.x:-Z;y1=e.c-e.a*x1;x2=s2?s2.x:Z;y2=e.c-e.a*x2}var v1=[x1,y1],v2=[x2,y2];polygons[e.region.l.index].push(v1,v2);polygons[e.region.r.index].push(v1,v2)});polygons=polygons.map(function(polygon,i){var cx=points[i][0],cy=points[i][1],angle=polygon.map(function(v){return Math.atan2(v[0]-cx,v[1]-cy)}),order=d3.range(polygon.length).sort(function(a,b){return angle[a]-angle[b]});return order.filter(function(d,i){return!i||angle[d]-angle[order[i-1]]>ε}).map(function(d){return polygon[d]})});polygons.forEach(function(polygon,i){var n=polygon.length;if(!n)return polygon.push([-Z,-Z],[-Z,Z],[Z,Z],[Z,-Z]);if(!(n>2)){var p0=points[i],p1=polygon[0],p2=polygon[1],x0=p0[0],y0=p0[1],x1=p1[0],y1=p1[1],x2=p2[0],y2=p2[1],dx=Math.abs(x2-x1),dy=y2-y1;if(Math.abs(dy)<ε){var y=y1>y0?-Z:Z;polygon.push([-Z,y],[Z,y])}else if(ε>dx){var x=x1>x0?-Z:Z;polygon.push([x,-Z],[x,Z])}else{var y=(x1-x0)*(y2-y1)>(x2-x1)*(y1-y0)?Z:-Z,z=Math.abs(dy)-dx;if(Math.abs(z)<ε)polygon.push([0>dy?y:-y,y]);else{z>0&&(y*=-1);polygon.push([-Z,y],[Z,y])}}}});if(clipPolygon)for(i=0;n>i;++i)clipPolygon.clip(polygons[i]);for(i=0;n>i;++i)polygons[i].point=data[i];return polygons}var x=d3_svg_lineX,y=d3_svg_lineY,clipPolygon=null;if(arguments.length)return voronoi(points);voronoi.x=function(_){return arguments.length?(x=_,voronoi):x};voronoi.y=function(_){return arguments.length?(y=_,voronoi):y};voronoi.clipExtent=function(_){if(!arguments.length)return clipPolygon&&[clipPolygon[0],clipPolygon[2]];if(null==_)clipPolygon=null;else{var x1=+_[0][0],y1=+_[0][1],x2=+_[1][0],y2=+_[1][1];clipPolygon=d3.geom.polygon([[x1,y1],[x1,y2],[x2,y2],[x2,y1]])}return voronoi};voronoi.size=function(_){return arguments.length?voronoi.clipExtent(_&&[[0,0],_]):clipPolygon&&clipPolygon[2]};voronoi.links=function(data){var points,d,i,graph=data.map(function(){return[]}),links=[],fx=d3_functor(x),fy=d3_functor(y),n=data.length;if(fx===d3_svg_lineX&&fy===d3_svg_lineY)points=data;else for(points=new Array(n),i=0;n>i;++i)points[i]=[+fx.call(this,d=data[i],i),+fy.call(this,d,i)];d3_geom_voronoiTessellate(points,function(e){var l=e.region.l.index,r=e.region.r.index;if(!graph[l][r]){graph[l][r]=graph[r][l]=!0;links.push({source:data[l],target:data[r]})}});return links};voronoi.triangles=function(data){if(x===d3_svg_lineX&&y===d3_svg_lineY)return d3.geom.delaunay(data);for(var d,points=new Array(n),fx=d3_functor(x),fy=d3_functor(y),i=-1,n=data.length;++i<n;)(points[i]=[+fx.call(this,d=data[i],i),+fy.call(this,d,i)]).data=d;return d3.geom.delaunay(points).map(function(triangle){return triangle.map(function(point){return point.data})})};return voronoi};var d3_geom_voronoiOpposite={l:"r",r:"l"};d3.geom.quadtree=function(points,x1,y1,x2,y2){function quadtree(data){function insert(n,d,x,y,x1,y1,x2,y2){if(!isNaN(x)&&!isNaN(y))if(n.leaf){var nx=n.x,ny=n.y;if(null!=nx)if(Math.abs(nx-x)+Math.abs(ny-y)<.01)insertChild(n,d,x,y,x1,y1,x2,y2);else{var nPoint=n.point;n.x=n.y=n.point=null;insertChild(n,nPoint,nx,ny,x1,y1,x2,y2);insertChild(n,d,x,y,x1,y1,x2,y2)}else n.x=x,n.y=y,n.point=d}else insertChild(n,d,x,y,x1,y1,x2,y2)}function insertChild(n,d,x,y,x1,y1,x2,y2){var sx=.5*(x1+x2),sy=.5*(y1+y2),right=x>=sx,bottom=y>=sy,i=(bottom<<1)+right;n.leaf=!1;n=n.nodes[i]||(n.nodes[i]=d3_geom_quadtreeNode());right?x1=sx:x2=sx;bottom?y1=sy:y2=sy;insert(n,d,x,y,x1,y1,x2,y2)}var d,xs,ys,i,n,x1_,y1_,x2_,y2_,fx=d3_functor(x),fy=d3_functor(y);if(null!=x1)x1_=x1,y1_=y1,x2_=x2,y2_=y2;else{x2_=y2_=-(x1_=y1_=1/0);xs=[],ys=[];n=data.length;if(compat)for(i=0;n>i;++i){d=data[i];d.x<x1_&&(x1_=d.x);d.y<y1_&&(y1_=d.y);d.x>x2_&&(x2_=d.x);d.y>y2_&&(y2_=d.y);xs.push(d.x);ys.push(d.y)}else for(i=0;n>i;++i){var x_=+fx(d=data[i],i),y_=+fy(d,i);x1_>x_&&(x1_=x_);y1_>y_&&(y1_=y_);x_>x2_&&(x2_=x_);y_>y2_&&(y2_=y_);xs.push(x_);ys.push(y_)}}var dx=x2_-x1_,dy=y2_-y1_;dx>dy?y2_=y1_+dx:x2_=x1_+dy;var root=d3_geom_quadtreeNode();root.add=function(d){insert(root,d,+fx(d,++i),+fy(d,i),x1_,y1_,x2_,y2_)};root.visit=function(f){d3_geom_quadtreeVisit(f,root,x1_,y1_,x2_,y2_)};i=-1;if(null==x1){for(;++i<n;)insert(root,data[i],xs[i],ys[i],x1_,y1_,x2_,y2_);--i}else data.forEach(root.add);xs=ys=data=d=null;return root}var compat,x=d3_svg_lineX,y=d3_svg_lineY;if(compat=arguments.length){x=d3_geom_quadtreeCompatX;y=d3_geom_quadtreeCompatY;if(3===compat){y2=y1;x2=x1;y1=x1=0}return quadtree(points)}quadtree.x=function(_){return arguments.length?(x=_,quadtree):x};quadtree.y=function(_){return arguments.length?(y=_,quadtree):y};quadtree.extent=function(_){if(!arguments.length)return null==x1?null:[[x1,y1],[x2,y2]];null==_?x1=y1=x2=y2=null:(x1=+_[0][0],y1=+_[0][1],x2=+_[1][0],y2=+_[1][1]);return quadtree};quadtree.size=function(_){if(!arguments.length)return null==x1?null:[x2-x1,y2-y1];null==_?x1=y1=x2=y2=null:(x1=y1=0,x2=+_[0],y2=+_[1]);return quadtree};return quadtree};d3.interpolateRgb=d3_interpolateRgb;d3.interpolateObject=d3_interpolateObject;d3.interpolateNumber=d3_interpolateNumber;d3.interpolateString=d3_interpolateString;var d3_interpolate_number=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g;d3.interpolate=d3_interpolate;d3.interpolators=[function(a,b){var t=typeof b;return("string"===t?d3_rgb_names.has(b)||/^(#|rgb\(|hsl\()/.test(b)?d3_interpolateRgb:d3_interpolateString:b instanceof d3_Color?d3_interpolateRgb:"object"===t?Array.isArray(b)?d3_interpolateArray:d3_interpolateObject:d3_interpolateNumber)(a,b)}];d3.interpolateArray=d3_interpolateArray;var d3_ease_default=function(){return d3_identity},d3_ease=d3.map({linear:d3_ease_default,poly:d3_ease_poly,quad:function(){return d3_ease_quad},cubic:function(){return d3_ease_cubic},sin:function(){return d3_ease_sin},exp:function(){return d3_ease_exp},circle:function(){return d3_ease_circle},elastic:d3_ease_elastic,back:d3_ease_back,bounce:function(){return d3_ease_bounce}}),d3_ease_mode=d3.map({"in":d3_identity,out:d3_ease_reverse,"in-out":d3_ease_reflect,"out-in":function(f){return d3_ease_reflect(d3_ease_reverse(f))}});d3.ease=function(name){var i=name.indexOf("-"),t=i>=0?name.substring(0,i):name,m=i>=0?name.substring(i+1):"in";t=d3_ease.get(t)||d3_ease_default;m=d3_ease_mode.get(m)||d3_identity;return d3_ease_clamp(m(t.apply(null,Array.prototype.slice.call(arguments,1))))};d3.interpolateHcl=d3_interpolateHcl;d3.interpolateHsl=d3_interpolateHsl;d3.interpolateLab=d3_interpolateLab;d3.interpolateRound=d3_interpolateRound;d3.transform=function(string){var g=d3_document.createElementNS(d3.ns.prefix.svg,"g");return(d3.transform=function(string){if(null!=string){g.setAttribute("transform",string);var t=g.transform.baseVal.consolidate()}return new d3_transform(t?t.matrix:d3_transformIdentity)})(string)};d3_transform.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")"};var d3_transformIdentity={a:1,b:0,c:0,d:1,e:0,f:0};d3.interpolateTransform=d3_interpolateTransform;d3.layout={};d3.layout.bundle=function(){return function(links){for(var paths=[],i=-1,n=links.length;++i<n;)paths.push(d3_layout_bundlePath(links[i]));return paths}};d3.layout.chord=function(){function relayout(){var k,x,x0,i,j,subgroups={},groupSums=[],groupIndex=d3.range(n),subgroupIndex=[];chords=[];groups=[];k=0,i=-1;for(;++i<n;){x=0,j=-1;for(;++j<n;)x+=matrix[i][j];groupSums.push(x);subgroupIndex.push(d3.range(n));k+=x}sortGroups&&groupIndex.sort(function(a,b){return sortGroups(groupSums[a],groupSums[b])});sortSubgroups&&subgroupIndex.forEach(function(d,i){d.sort(function(a,b){return sortSubgroups(matrix[i][a],matrix[i][b])})});k=(2*π-padding*n)/k;x=0,i=-1;for(;++i<n;){x0=x,j=-1;for(;++j<n;){var di=groupIndex[i],dj=subgroupIndex[di][j],v=matrix[di][dj],a0=x,a1=x+=v*k;subgroups[di+"-"+dj]={index:di,subindex:dj,startAngle:a0,endAngle:a1,value:v}}groups[di]={index:di,startAngle:x0,endAngle:x,value:(x-x0)/k};x+=padding}i=-1;for(;++i<n;){j=i-1;for(;++j<n;){var source=subgroups[i+"-"+j],target=subgroups[j+"-"+i];(source.value||target.value)&&chords.push(source.value<target.value?{source:target,target:source}:{source:source,target:target})}}sortChords&&resort()}function resort(){chords.sort(function(a,b){return sortChords((a.source.value+a.target.value)/2,(b.source.value+b.target.value)/2)})}var chords,groups,matrix,n,sortGroups,sortSubgroups,sortChords,chord={},padding=0;chord.matrix=function(x){if(!arguments.length)return matrix;n=(matrix=x)&&matrix.length;chords=groups=null;return chord};chord.padding=function(x){if(!arguments.length)return padding;padding=x;chords=groups=null;return chord};chord.sortGroups=function(x){if(!arguments.length)return sortGroups;sortGroups=x;chords=groups=null;return chord};chord.sortSubgroups=function(x){if(!arguments.length)return sortSubgroups;sortSubgroups=x;chords=null;return chord};chord.sortChords=function(x){if(!arguments.length)return sortChords;sortChords=x;chords&&resort();return chord};chord.chords=function(){chords||relayout();return chords};chord.groups=function(){groups||relayout();return groups};return chord};d3.layout.force=function(){function repulse(node){return function(quad,x1,_,x2){if(quad.point!==node){var dx=quad.cx-node.x,dy=quad.cy-node.y,dn=1/Math.sqrt(dx*dx+dy*dy);if(theta>(x2-x1)*dn){var k=quad.charge*dn*dn;node.px-=dx*k;node.py-=dy*k;return!0}if(quad.point&&isFinite(dn)){var k=quad.pointCharge*dn*dn;node.px-=dx*k;node.py-=dy*k}}return!quad.charge}}function dragmove(d){d.px=d3.event.x,d.py=d3.event.y;force.resume()}var drag,alpha,distances,strengths,charges,force={},event=d3.dispatch("start","tick","end"),size=[1,1],friction=.9,linkDistance=d3_layout_forceLinkDistance,linkStrength=d3_layout_forceLinkStrength,charge=-30,gravity=.1,theta=.8,nodes=[],links=[];force.tick=function(){if((alpha*=.99)<.005){event.end({type:"end",alpha:alpha=0});return!0}var q,i,o,s,t,l,k,x,y,n=nodes.length,m=links.length;for(i=0;m>i;++i){o=links[i];s=o.source;t=o.target;x=t.x-s.x;y=t.y-s.y;if(l=x*x+y*y){l=alpha*strengths[i]*((l=Math.sqrt(l))-distances[i])/l;x*=l;y*=l;t.x-=x*(k=s.weight/(t.weight+s.weight));t.y-=y*k;s.x+=x*(k=1-k);s.y+=y*k}}if(k=alpha*gravity){x=size[0]/2;y=size[1]/2;i=-1;if(k)for(;++i<n;){o=nodes[i];o.x+=(x-o.x)*k;o.y+=(y-o.y)*k}}if(charge){d3_layout_forceAccumulate(q=d3.geom.quadtree(nodes),alpha,charges);i=-1;for(;++i<n;)(o=nodes[i]).fixed||q.visit(repulse(o))}i=-1;for(;++i<n;){o=nodes[i];if(o.fixed){o.x=o.px;o.y=o.py}else{o.x-=(o.px-(o.px=o.x))*friction;o.y-=(o.py-(o.py=o.y))*friction}}event.tick({type:"tick",alpha:alpha})};force.nodes=function(x){if(!arguments.length)return nodes;nodes=x;return force};force.links=function(x){if(!arguments.length)return links;links=x;return force};force.size=function(x){if(!arguments.length)return size;size=x;return force};force.linkDistance=function(x){if(!arguments.length)return linkDistance;linkDistance="function"==typeof x?x:+x;return force};force.distance=force.linkDistance;force.linkStrength=function(x){if(!arguments.length)return linkStrength;linkStrength="function"==typeof x?x:+x;return force};force.friction=function(x){if(!arguments.length)return friction;friction=+x;return force};force.charge=function(x){if(!arguments.length)return charge;charge="function"==typeof x?x:+x;return force};force.gravity=function(x){if(!arguments.length)return gravity;gravity=+x;return force};force.theta=function(x){if(!arguments.length)return theta;theta=+x;return force};force.alpha=function(x){if(!arguments.length)return alpha;x=+x;if(alpha)alpha=x>0?x:0;else if(x>0){event.start({type:"start",alpha:alpha=x});d3.timer(force.tick)}return force};force.start=function(){function position(dimension,size){for(var x,neighbors=neighbor(i),j=-1,m=neighbors.length;++j<m;)if(!isNaN(x=neighbors[j][dimension]))return x;return Math.random()*size}function neighbor(){if(!neighbors){neighbors=[];for(j=0;n>j;++j)neighbors[j]=[];for(j=0;m>j;++j){var o=links[j];neighbors[o.source.index].push(o.target);neighbors[o.target.index].push(o.source)}}return neighbors[i]}var i,j,neighbors,o,n=nodes.length,m=links.length,w=size[0],h=size[1];for(i=0;n>i;++i){(o=nodes[i]).index=i;o.weight=0}for(i=0;m>i;++i){o=links[i];"number"==typeof o.source&&(o.source=nodes[o.source]);"number"==typeof o.target&&(o.target=nodes[o.target]);++o.source.weight;++o.target.weight}for(i=0;n>i;++i){o=nodes[i];isNaN(o.x)&&(o.x=position("x",w));isNaN(o.y)&&(o.y=position("y",h));isNaN(o.px)&&(o.px=o.x);isNaN(o.py)&&(o.py=o.y)}distances=[];if("function"==typeof linkDistance)for(i=0;m>i;++i)distances[i]=+linkDistance.call(this,links[i],i);else for(i=0;m>i;++i)distances[i]=linkDistance;strengths=[];if("function"==typeof linkStrength)for(i=0;m>i;++i)strengths[i]=+linkStrength.call(this,links[i],i);else for(i=0;m>i;++i)strengths[i]=linkStrength;charges=[];if("function"==typeof charge)for(i=0;n>i;++i)charges[i]=+charge.call(this,nodes[i],i);else for(i=0;n>i;++i)charges[i]=charge;return force.resume()};force.resume=function(){return force.alpha(.1)};force.stop=function(){return force.alpha(0)};force.drag=function(){drag||(drag=d3.behavior.drag().origin(d3_identity).on("dragstart.force",d3_layout_forceDragstart).on("drag.force",dragmove).on("dragend.force",d3_layout_forceDragend));if(!arguments.length)return drag;this.on("mouseover.force",d3_layout_forceMouseover).on("mouseout.force",d3_layout_forceMouseout).call(drag);return void 0};return d3.rebind(force,event,"on")};var d3_layout_forceLinkDistance=20,d3_layout_forceLinkStrength=1;d3.layout.hierarchy=function(){function recurse(node,depth,nodes){var childs=children.call(hierarchy,node,depth);node.depth=depth;nodes.push(node);if(childs&&(n=childs.length)){for(var n,d,i=-1,c=node.children=[],v=0,j=depth+1;++i<n;){d=recurse(childs[i],j,nodes);d.parent=node;c.push(d);v+=d.value}sort&&c.sort(sort);value&&(node.value=v)}else value&&(node.value=+value.call(hierarchy,node,depth)||0);return node}function revalue(node,depth){var children=node.children,v=0;if(children&&(n=children.length))for(var n,i=-1,j=depth+1;++i<n;)v+=revalue(children[i],j);else value&&(v=+value.call(hierarchy,node,depth)||0);value&&(node.value=v);return v}function hierarchy(d){var nodes=[];recurse(d,0,nodes);return nodes}var sort=d3_layout_hierarchySort,children=d3_layout_hierarchyChildren,value=d3_layout_hierarchyValue;hierarchy.sort=function(x){if(!arguments.length)return sort;sort=x;return hierarchy};hierarchy.children=function(x){if(!arguments.length)return children;children=x;return hierarchy};hierarchy.value=function(x){if(!arguments.length)return value;value=x;return hierarchy};hierarchy.revalue=function(root){revalue(root,0);return root};return hierarchy};d3.layout.partition=function(){function position(node,x,dx,dy){var children=node.children;node.x=x;node.y=node.depth*dy;node.dx=dx;node.dy=dy;if(children&&(n=children.length)){var n,c,d,i=-1;dx=node.value?dx/node.value:0;for(;++i<n;){position(c=children[i],x,d=c.value*dx,dy);x+=d}}}function depth(node){var children=node.children,d=0;if(children&&(n=children.length))for(var n,i=-1;++i<n;)d=Math.max(d,depth(children[i]));return 1+d}function partition(d,i){var nodes=hierarchy.call(this,d,i);position(nodes[0],0,size[0],size[1]/depth(nodes[0]));return nodes}var hierarchy=d3.layout.hierarchy(),size=[1,1];partition.size=function(x){if(!arguments.length)return size;size=x;return partition};return d3_layout_hierarchyRebind(partition,hierarchy)};d3.layout.pie=function(){function pie(data){var values=data.map(function(d,i){return+value.call(pie,d,i)}),a=+("function"==typeof startAngle?startAngle.apply(this,arguments):startAngle),k=(("function"==typeof endAngle?endAngle.apply(this,arguments):endAngle)-a)/d3.sum(values),index=d3.range(data.length);null!=sort&&index.sort(sort===d3_layout_pieSortByValue?function(i,j){return values[j]-values[i]}:function(i,j){return sort(data[i],data[j])});var arcs=[];index.forEach(function(i){var d;arcs[i]={data:data[i],value:d=values[i],startAngle:a,endAngle:a+=d*k}});return arcs}var value=Number,sort=d3_layout_pieSortByValue,startAngle=0,endAngle=2*π;pie.value=function(x){if(!arguments.length)return value;value=x;return pie};pie.sort=function(x){if(!arguments.length)return sort;sort=x;return pie};pie.startAngle=function(x){if(!arguments.length)return startAngle;startAngle=x;return pie};pie.endAngle=function(x){if(!arguments.length)return endAngle;endAngle=x;return pie};return pie};var d3_layout_pieSortByValue={};d3.layout.stack=function(){function stack(data,index){var series=data.map(function(d,i){return values.call(stack,d,i)}),points=series.map(function(d){return d.map(function(v,i){return[x.call(stack,v,i),y.call(stack,v,i)]})}),orders=order.call(stack,points,index);series=d3.permute(series,orders);points=d3.permute(points,orders);var i,j,o,offsets=offset.call(stack,points,index),n=series.length,m=series[0].length;for(j=0;m>j;++j){out.call(stack,series[0][j],o=offsets[j],points[0][j][1]);for(i=1;n>i;++i)out.call(stack,series[i][j],o+=points[i-1][j][1],points[i][j][1])}return data}var values=d3_identity,order=d3_layout_stackOrderDefault,offset=d3_layout_stackOffsetZero,out=d3_layout_stackOut,x=d3_layout_stackX,y=d3_layout_stackY;stack.values=function(x){if(!arguments.length)return values;values=x;return stack};stack.order=function(x){if(!arguments.length)return order;order="function"==typeof x?x:d3_layout_stackOrders.get(x)||d3_layout_stackOrderDefault;return stack};stack.offset=function(x){if(!arguments.length)return offset;offset="function"==typeof x?x:d3_layout_stackOffsets.get(x)||d3_layout_stackOffsetZero;return stack};stack.x=function(z){if(!arguments.length)return x;x=z;return stack};stack.y=function(z){if(!arguments.length)return y;y=z;return stack};stack.out=function(z){if(!arguments.length)return out;out=z;return stack};return stack};var d3_layout_stackOrders=d3.map({"inside-out":function(data){var i,j,n=data.length,max=data.map(d3_layout_stackMaxIndex),sums=data.map(d3_layout_stackReduceSum),index=d3.range(n).sort(function(a,b){return max[a]-max[b]}),top=0,bottom=0,tops=[],bottoms=[];for(i=0;n>i;++i){j=index[i];if(bottom>top){top+=sums[j];tops.push(j)}else{bottom+=sums[j];bottoms.push(j)}}return bottoms.reverse().concat(tops)},reverse:function(data){return d3.range(data.length).reverse()},"default":d3_layout_stackOrderDefault}),d3_layout_stackOffsets=d3.map({silhouette:function(data){var i,j,o,n=data.length,m=data[0].length,sums=[],max=0,y0=[];for(j=0;m>j;++j){for(i=0,o=0;n>i;i++)o+=data[i][j][1];o>max&&(max=o);sums.push(o)}for(j=0;m>j;++j)y0[j]=(max-sums[j])/2;return y0},wiggle:function(data){var i,j,k,s1,s2,s3,dx,o,o0,n=data.length,x=data[0],m=x.length,y0=[];y0[0]=o=o0=0;for(j=1;m>j;++j){for(i=0,s1=0;n>i;++i)s1+=data[i][j][1];for(i=0,s2=0,dx=x[j][0]-x[j-1][0];n>i;++i){for(k=0,s3=(data[i][j][1]-data[i][j-1][1])/(2*dx);i>k;++k)s3+=(data[k][j][1]-data[k][j-1][1])/dx;s2+=s3*data[i][j][1]}y0[j]=o-=s1?s2/s1*dx:0;o0>o&&(o0=o)}for(j=0;m>j;++j)y0[j]-=o0;return y0},expand:function(data){var i,j,o,n=data.length,m=data[0].length,k=1/n,y0=[];for(j=0;m>j;++j){for(i=0,o=0;n>i;i++)o+=data[i][j][1];if(o)for(i=0;n>i;i++)data[i][j][1]/=o;else for(i=0;n>i;i++)data[i][j][1]=k}for(j=0;m>j;++j)y0[j]=0;return y0},zero:d3_layout_stackOffsetZero});d3.layout.histogram=function(){function histogram(data,i){for(var bin,x,bins=[],values=data.map(valuer,this),range=ranger.call(this,values,i),thresholds=binner.call(this,range,values,i),i=-1,n=values.length,m=thresholds.length-1,k=frequency?1:1/n;++i<m;){bin=bins[i]=[];bin.dx=thresholds[i+1]-(bin.x=thresholds[i]);bin.y=0}if(m>0){i=-1;for(;++i<n;){x=values[i];if(x>=range[0]&&x<=range[1]){bin=bins[d3.bisect(thresholds,x,1,m)-1];bin.y+=k;bin.push(data[i])}}}return bins}var frequency=!0,valuer=Number,ranger=d3_layout_histogramRange,binner=d3_layout_histogramBinSturges;histogram.value=function(x){if(!arguments.length)return valuer;valuer=x;return histogram};histogram.range=function(x){if(!arguments.length)return ranger;ranger=d3_functor(x);return histogram};histogram.bins=function(x){if(!arguments.length)return binner;binner="number"==typeof x?function(range){return d3_layout_histogramBinFixed(range,x)}:d3_functor(x);return histogram};histogram.frequency=function(x){if(!arguments.length)return frequency;frequency=!!x;return histogram};return histogram};d3.layout.tree=function(){function tree(d,i){function firstWalk(node,previousSibling){var children=node.children,layout=node._tree;if(children&&(n=children.length)){for(var n,previousChild,child,firstChild=children[0],ancestor=firstChild,i=-1;++i<n;){child=children[i];firstWalk(child,previousChild);ancestor=apportion(child,previousChild,ancestor);previousChild=child}d3_layout_treeShift(node);var midpoint=.5*(firstChild._tree.prelim+child._tree.prelim);if(previousSibling){layout.prelim=previousSibling._tree.prelim+separation(node,previousSibling);layout.mod=layout.prelim-midpoint}else layout.prelim=midpoint}else previousSibling&&(layout.prelim=previousSibling._tree.prelim+separation(node,previousSibling))}function secondWalk(node,x){node.x=node._tree.prelim+x;var children=node.children;if(children&&(n=children.length)){var n,i=-1;x+=node._tree.mod;for(;++i<n;)secondWalk(children[i],x)}}function apportion(node,previousSibling,ancestor){if(previousSibling){for(var shift,vip=node,vop=node,vim=previousSibling,vom=node.parent.children[0],sip=vip._tree.mod,sop=vop._tree.mod,sim=vim._tree.mod,som=vom._tree.mod;vim=d3_layout_treeRight(vim),vip=d3_layout_treeLeft(vip),vim&&vip;){vom=d3_layout_treeLeft(vom);vop=d3_layout_treeRight(vop);vop._tree.ancestor=node;shift=vim._tree.prelim+sim-vip._tree.prelim-sip+separation(vim,vip);if(shift>0){d3_layout_treeMove(d3_layout_treeAncestor(vim,node,ancestor),node,shift);sip+=shift;sop+=shift}sim+=vim._tree.mod;sip+=vip._tree.mod;som+=vom._tree.mod;sop+=vop._tree.mod}if(vim&&!d3_layout_treeRight(vop)){vop._tree.thread=vim;vop._tree.mod+=sim-sop}if(vip&&!d3_layout_treeLeft(vom)){vom._tree.thread=vip;vom._tree.mod+=sip-som;ancestor=node}}return ancestor}var nodes=hierarchy.call(this,d,i),root=nodes[0];d3_layout_treeVisitAfter(root,function(node,previousSibling){node._tree={ancestor:node,prelim:0,mod:0,change:0,shift:0,number:previousSibling?previousSibling._tree.number+1:0}});firstWalk(root);secondWalk(root,-root._tree.prelim);var left=d3_layout_treeSearch(root,d3_layout_treeLeftmost),right=d3_layout_treeSearch(root,d3_layout_treeRightmost),deep=d3_layout_treeSearch(root,d3_layout_treeDeepest),x0=left.x-separation(left,right)/2,x1=right.x+separation(right,left)/2,y1=deep.depth||1;d3_layout_treeVisitAfter(root,nodeSize?function(node){node.x*=size[0];node.y=node.depth*size[1];delete node._tree}:function(node){node.x=(node.x-x0)/(x1-x0)*size[0];node.y=node.depth/y1*size[1];delete node._tree});return nodes}var hierarchy=d3.layout.hierarchy().sort(null).value(null),separation=d3_layout_treeSeparation,size=[1,1],nodeSize=!1;tree.separation=function(x){if(!arguments.length)return separation;separation=x;return tree};tree.size=function(x){if(!arguments.length)return nodeSize?null:size;nodeSize=null==(size=x);return tree};tree.nodeSize=function(x){if(!arguments.length)return nodeSize?size:null;nodeSize=null!=(size=x);return tree};return d3_layout_hierarchyRebind(tree,hierarchy)};d3.layout.pack=function(){function pack(d,i){var nodes=hierarchy.call(this,d,i),root=nodes[0],w=size[0],h=size[1],r=null==radius?Math.sqrt:"function"==typeof radius?radius:function(){return radius};root.x=root.y=0;d3_layout_treeVisitAfter(root,function(d){d.r=+r(d.value)});d3_layout_treeVisitAfter(root,d3_layout_packSiblings);if(padding){var dr=padding*(radius?1:Math.max(2*root.r/w,2*root.r/h))/2;
d3_layout_treeVisitAfter(root,function(d){d.r+=dr});d3_layout_treeVisitAfter(root,d3_layout_packSiblings);d3_layout_treeVisitAfter(root,function(d){d.r-=dr})}d3_layout_packTransform(root,w/2,h/2,radius?1:1/Math.max(2*root.r/w,2*root.r/h));return nodes}var radius,hierarchy=d3.layout.hierarchy().sort(d3_layout_packSort),padding=0,size=[1,1];pack.size=function(_){if(!arguments.length)return size;size=_;return pack};pack.radius=function(_){if(!arguments.length)return radius;radius=null==_||"function"==typeof _?_:+_;return pack};pack.padding=function(_){if(!arguments.length)return padding;padding=+_;return pack};return d3_layout_hierarchyRebind(pack,hierarchy)};d3.layout.cluster=function(){function cluster(d,i){var previousNode,nodes=hierarchy.call(this,d,i),root=nodes[0],x=0;d3_layout_treeVisitAfter(root,function(node){var children=node.children;if(children&&children.length){node.x=d3_layout_clusterX(children);node.y=d3_layout_clusterY(children)}else{node.x=previousNode?x+=separation(node,previousNode):0;node.y=0;previousNode=node}});var left=d3_layout_clusterLeft(root),right=d3_layout_clusterRight(root),x0=left.x-separation(left,right)/2,x1=right.x+separation(right,left)/2;d3_layout_treeVisitAfter(root,nodeSize?function(node){node.x=(node.x-root.x)*size[0];node.y=(root.y-node.y)*size[1]}:function(node){node.x=(node.x-x0)/(x1-x0)*size[0];node.y=(1-(root.y?node.y/root.y:1))*size[1]});return nodes}var hierarchy=d3.layout.hierarchy().sort(null).value(null),separation=d3_layout_treeSeparation,size=[1,1],nodeSize=!1;cluster.separation=function(x){if(!arguments.length)return separation;separation=x;return cluster};cluster.size=function(x){if(!arguments.length)return nodeSize?null:size;nodeSize=null==(size=x);return cluster};cluster.nodeSize=function(x){if(!arguments.length)return nodeSize?size:null;nodeSize=null!=(size=x);return cluster};return d3_layout_hierarchyRebind(cluster,hierarchy)};d3.layout.treemap=function(){function scale(children,k){for(var child,area,i=-1,n=children.length;++i<n;){area=(child=children[i]).value*(0>k?0:k);child.area=isNaN(area)||0>=area?0:area}}function squarify(node){var children=node.children;if(children&&children.length){var child,score,n,rect=pad(node),row=[],remaining=children.slice(),best=1/0,u="slice"===mode?rect.dx:"dice"===mode?rect.dy:"slice-dice"===mode?1&node.depth?rect.dy:rect.dx:Math.min(rect.dx,rect.dy);scale(remaining,rect.dx*rect.dy/node.value);row.area=0;for(;(n=remaining.length)>0;){row.push(child=remaining[n-1]);row.area+=child.area;if("squarify"!==mode||(score=worst(row,u))<=best){remaining.pop();best=score}else{row.area-=row.pop().area;position(row,u,rect,!1);u=Math.min(rect.dx,rect.dy);row.length=row.area=0;best=1/0}}if(row.length){position(row,u,rect,!0);row.length=row.area=0}children.forEach(squarify)}}function stickify(node){var children=node.children;if(children&&children.length){var child,rect=pad(node),remaining=children.slice(),row=[];scale(remaining,rect.dx*rect.dy/node.value);row.area=0;for(;child=remaining.pop();){row.push(child);row.area+=child.area;if(null!=child.z){position(row,child.z?rect.dx:rect.dy,rect,!remaining.length);row.length=row.area=0}}children.forEach(stickify)}}function worst(row,u){for(var r,s=row.area,rmax=0,rmin=1/0,i=-1,n=row.length;++i<n;)if(r=row[i].area){rmin>r&&(rmin=r);r>rmax&&(rmax=r)}s*=s;u*=u;return s?Math.max(u*rmax*ratio/s,s/(u*rmin*ratio)):1/0}function position(row,u,rect,flush){var o,i=-1,n=row.length,x=rect.x,y=rect.y,v=u?round(row.area/u):0;if(u==rect.dx){(flush||v>rect.dy)&&(v=rect.dy);for(;++i<n;){o=row[i];o.x=x;o.y=y;o.dy=v;x+=o.dx=Math.min(rect.x+rect.dx-x,v?round(o.area/v):0)}o.z=!0;o.dx+=rect.x+rect.dx-x;rect.y+=v;rect.dy-=v}else{(flush||v>rect.dx)&&(v=rect.dx);for(;++i<n;){o=row[i];o.x=x;o.y=y;o.dx=v;y+=o.dy=Math.min(rect.y+rect.dy-y,v?round(o.area/v):0)}o.z=!1;o.dy+=rect.y+rect.dy-y;rect.x+=v;rect.dx-=v}}function treemap(d){var nodes=stickies||hierarchy(d),root=nodes[0];root.x=0;root.y=0;root.dx=size[0];root.dy=size[1];stickies&&hierarchy.revalue(root);scale([root],root.dx*root.dy/root.value);(stickies?stickify:squarify)(root);sticky&&(stickies=nodes);return nodes}var stickies,hierarchy=d3.layout.hierarchy(),round=Math.round,size=[1,1],padding=null,pad=d3_layout_treemapPadNull,sticky=!1,mode="squarify",ratio=.5*(1+Math.sqrt(5));treemap.size=function(x){if(!arguments.length)return size;size=x;return treemap};treemap.padding=function(x){function padFunction(node){var p=x.call(treemap,node,node.depth);return null==p?d3_layout_treemapPadNull(node):d3_layout_treemapPad(node,"number"==typeof p?[p,p,p,p]:p)}function padConstant(node){return d3_layout_treemapPad(node,x)}if(!arguments.length)return padding;var type;pad=null==(padding=x)?d3_layout_treemapPadNull:"function"==(type=typeof x)?padFunction:"number"===type?(x=[x,x,x,x],padConstant):padConstant;return treemap};treemap.round=function(x){if(!arguments.length)return round!=Number;round=x?Math.round:Number;return treemap};treemap.sticky=function(x){if(!arguments.length)return sticky;sticky=x;stickies=null;return treemap};treemap.ratio=function(x){if(!arguments.length)return ratio;ratio=x;return treemap};treemap.mode=function(x){if(!arguments.length)return mode;mode=x+"";return treemap};return d3_layout_hierarchyRebind(treemap,hierarchy)};d3.random={normal:function(µ,σ){var n=arguments.length;2>n&&(σ=1);1>n&&(µ=0);return function(){var x,y,r;do{x=2*Math.random()-1;y=2*Math.random()-1;r=x*x+y*y}while(!r||r>1);return µ+σ*x*Math.sqrt(-2*Math.log(r)/r)}},logNormal:function(){var random=d3.random.normal.apply(d3,arguments);return function(){return Math.exp(random())}},irwinHall:function(m){return function(){for(var s=0,j=0;m>j;j++)s+=Math.random();return s/m}}};d3.scale={};var d3_scale_niceIdentity={floor:d3_identity,ceil:d3_identity};d3.scale.linear=function(){return d3_scale_linear([0,1],[0,1],d3_interpolate,!1)};d3.scale.log=function(){return d3_scale_log(d3.scale.linear().domain([0,1]),10,!0,[1,10])};var d3_scale_logFormat=d3.format(".0e"),d3_scale_logNiceNegative={floor:function(x){return-Math.ceil(-x)},ceil:function(x){return-Math.floor(-x)}};d3.scale.pow=function(){return d3_scale_pow(d3.scale.linear(),1,[0,1])};d3.scale.sqrt=function(){return d3.scale.pow().exponent(.5)};d3.scale.ordinal=function(){return d3_scale_ordinal([],{t:"range",a:[[]]})};d3.scale.category10=function(){return d3.scale.ordinal().range(d3_category10)};d3.scale.category20=function(){return d3.scale.ordinal().range(d3_category20)};d3.scale.category20b=function(){return d3.scale.ordinal().range(d3_category20b)};d3.scale.category20c=function(){return d3.scale.ordinal().range(d3_category20c)};var d3_category10=[2062260,16744206,2924588,14034728,9725885,9197131,14907330,8355711,12369186,1556175].map(d3_rgbString),d3_category20=[2062260,11454440,16744206,16759672,2924588,10018698,14034728,16750742,9725885,12955861,9197131,12885140,14907330,16234194,8355711,13092807,12369186,14408589,1556175,10410725].map(d3_rgbString),d3_category20b=[3750777,5395619,7040719,10264286,6519097,9216594,11915115,13556636,9202993,12426809,15186514,15190932,8666169,11356490,14049643,15177372,8077683,10834324,13528509,14589654].map(d3_rgbString),d3_category20c=[3244733,7057110,10406625,13032431,15095053,16616764,16625259,16634018,3253076,7652470,10607003,13101504,7695281,10394312,12369372,14342891,6513507,9868950,12434877,14277081].map(d3_rgbString);d3.scale.quantile=function(){return d3_scale_quantile([],[])};d3.scale.quantize=function(){return d3_scale_quantize(0,1,[0,1])};d3.scale.threshold=function(){return d3_scale_threshold([.5],[0,1])};d3.scale.identity=function(){return d3_scale_identity([0,1])};d3.svg.arc=function(){function arc(){var r0=innerRadius.apply(this,arguments),r1=outerRadius.apply(this,arguments),a0=startAngle.apply(this,arguments)+d3_svg_arcOffset,a1=endAngle.apply(this,arguments)+d3_svg_arcOffset,da=(a0>a1&&(da=a0,a0=a1,a1=da),a1-a0),df=π>da?"0":"1",c0=Math.cos(a0),s0=Math.sin(a0),c1=Math.cos(a1),s1=Math.sin(a1);return da>=d3_svg_arcMax?r0?"M0,"+r1+"A"+r1+","+r1+" 0 1,1 0,"+-r1+"A"+r1+","+r1+" 0 1,1 0,"+r1+"M0,"+r0+"A"+r0+","+r0+" 0 1,0 0,"+-r0+"A"+r0+","+r0+" 0 1,0 0,"+r0+"Z":"M0,"+r1+"A"+r1+","+r1+" 0 1,1 0,"+-r1+"A"+r1+","+r1+" 0 1,1 0,"+r1+"Z":r0?"M"+r1*c0+","+r1*s0+"A"+r1+","+r1+" 0 "+df+",1 "+r1*c1+","+r1*s1+"L"+r0*c1+","+r0*s1+"A"+r0+","+r0+" 0 "+df+",0 "+r0*c0+","+r0*s0+"Z":"M"+r1*c0+","+r1*s0+"A"+r1+","+r1+" 0 "+df+",1 "+r1*c1+","+r1*s1+"L0,0Z"}var innerRadius=d3_svg_arcInnerRadius,outerRadius=d3_svg_arcOuterRadius,startAngle=d3_svg_arcStartAngle,endAngle=d3_svg_arcEndAngle;arc.innerRadius=function(v){if(!arguments.length)return innerRadius;innerRadius=d3_functor(v);return arc};arc.outerRadius=function(v){if(!arguments.length)return outerRadius;outerRadius=d3_functor(v);return arc};arc.startAngle=function(v){if(!arguments.length)return startAngle;startAngle=d3_functor(v);return arc};arc.endAngle=function(v){if(!arguments.length)return endAngle;endAngle=d3_functor(v);return arc};arc.centroid=function(){var r=(innerRadius.apply(this,arguments)+outerRadius.apply(this,arguments))/2,a=(startAngle.apply(this,arguments)+endAngle.apply(this,arguments))/2+d3_svg_arcOffset;return[Math.cos(a)*r,Math.sin(a)*r]};return arc};var d3_svg_arcOffset=-π/2,d3_svg_arcMax=2*π-1e-6;d3.svg.line.radial=function(){var line=d3_svg_line(d3_svg_lineRadial);line.radius=line.x,delete line.x;line.angle=line.y,delete line.y;return line};d3_svg_lineStepBefore.reverse=d3_svg_lineStepAfter;d3_svg_lineStepAfter.reverse=d3_svg_lineStepBefore;d3.svg.area=function(){return d3_svg_area(d3_identity)};d3.svg.area.radial=function(){var area=d3_svg_area(d3_svg_lineRadial);area.radius=area.x,delete area.x;area.innerRadius=area.x0,delete area.x0;area.outerRadius=area.x1,delete area.x1;area.angle=area.y,delete area.y;area.startAngle=area.y0,delete area.y0;area.endAngle=area.y1,delete area.y1;return area};d3.svg.chord=function(){function chord(d,i){var s=subgroup(this,source,d,i),t=subgroup(this,target,d,i);return"M"+s.p0+arc(s.r,s.p1,s.a1-s.a0)+(equals(s,t)?curve(s.r,s.p1,s.r,s.p0):curve(s.r,s.p1,t.r,t.p0)+arc(t.r,t.p1,t.a1-t.a0)+curve(t.r,t.p1,s.r,s.p0))+"Z"}function subgroup(self,f,d,i){var subgroup=f.call(self,d,i),r=radius.call(self,subgroup,i),a0=startAngle.call(self,subgroup,i)+d3_svg_arcOffset,a1=endAngle.call(self,subgroup,i)+d3_svg_arcOffset;return{r:r,a0:a0,a1:a1,p0:[r*Math.cos(a0),r*Math.sin(a0)],p1:[r*Math.cos(a1),r*Math.sin(a1)]}}function equals(a,b){return a.a0==b.a0&&a.a1==b.a1}function arc(r,p,a){return"A"+r+","+r+" 0 "+ +(a>π)+",1 "+p}function curve(r0,p0,r1,p1){return"Q 0,0 "+p1}var source=d3_source,target=d3_target,radius=d3_svg_chordRadius,startAngle=d3_svg_arcStartAngle,endAngle=d3_svg_arcEndAngle;chord.radius=function(v){if(!arguments.length)return radius;radius=d3_functor(v);return chord};chord.source=function(v){if(!arguments.length)return source;source=d3_functor(v);return chord};chord.target=function(v){if(!arguments.length)return target;target=d3_functor(v);return chord};chord.startAngle=function(v){if(!arguments.length)return startAngle;startAngle=d3_functor(v);return chord};chord.endAngle=function(v){if(!arguments.length)return endAngle;endAngle=d3_functor(v);return chord};return chord};d3.svg.diagonal=function(){function diagonal(d,i){var p0=source.call(this,d,i),p3=target.call(this,d,i),m=(p0.y+p3.y)/2,p=[p0,{x:p0.x,y:m},{x:p3.x,y:m},p3];p=p.map(projection);return"M"+p[0]+"C"+p[1]+" "+p[2]+" "+p[3]}var source=d3_source,target=d3_target,projection=d3_svg_diagonalProjection;diagonal.source=function(x){if(!arguments.length)return source;source=d3_functor(x);return diagonal};diagonal.target=function(x){if(!arguments.length)return target;target=d3_functor(x);return diagonal};diagonal.projection=function(x){if(!arguments.length)return projection;projection=x;return diagonal};return diagonal};d3.svg.diagonal.radial=function(){var diagonal=d3.svg.diagonal(),projection=d3_svg_diagonalProjection,projection_=diagonal.projection;diagonal.projection=function(x){return arguments.length?projection_(d3_svg_diagonalRadialProjection(projection=x)):projection};return diagonal};d3.svg.symbol=function(){function symbol(d,i){return(d3_svg_symbols.get(type.call(this,d,i))||d3_svg_symbolCircle)(size.call(this,d,i))}var type=d3_svg_symbolType,size=d3_svg_symbolSize;symbol.type=function(x){if(!arguments.length)return type;type=d3_functor(x);return symbol};symbol.size=function(x){if(!arguments.length)return size;size=d3_functor(x);return symbol};return symbol};var d3_svg_symbols=d3.map({circle:d3_svg_symbolCircle,cross:function(size){var r=Math.sqrt(size/5)/2;return"M"+-3*r+","+-r+"H"+-r+"V"+-3*r+"H"+r+"V"+-r+"H"+3*r+"V"+r+"H"+r+"V"+3*r+"H"+-r+"V"+r+"H"+-3*r+"Z"},diamond:function(size){var ry=Math.sqrt(size/(2*d3_svg_symbolTan30)),rx=ry*d3_svg_symbolTan30;return"M0,"+-ry+"L"+rx+",0 0,"+ry+" "+-rx+",0Z"},square:function(size){var r=Math.sqrt(size)/2;return"M"+-r+","+-r+"L"+r+","+-r+" "+r+","+r+" "+-r+","+r+"Z"},"triangle-down":function(size){var rx=Math.sqrt(size/d3_svg_symbolSqrt3),ry=rx*d3_svg_symbolSqrt3/2;return"M0,"+ry+"L"+rx+","+-ry+" "+-rx+","+-ry+"Z"},"triangle-up":function(size){var rx=Math.sqrt(size/d3_svg_symbolSqrt3),ry=rx*d3_svg_symbolSqrt3/2;return"M0,"+-ry+"L"+rx+","+ry+" "+-rx+","+ry+"Z"}});d3.svg.symbolTypes=d3_svg_symbols.keys();var d3_transitionInheritId,d3_transitionInherit,d3_svg_symbolSqrt3=Math.sqrt(3),d3_svg_symbolTan30=Math.tan(30*d3_radians),d3_transitionPrototype=[],d3_transitionId=0;d3_transitionPrototype.call=d3_selectionPrototype.call;d3_transitionPrototype.empty=d3_selectionPrototype.empty;d3_transitionPrototype.node=d3_selectionPrototype.node;d3_transitionPrototype.size=d3_selectionPrototype.size;d3.transition=function(selection){return arguments.length?d3_transitionInheritId?selection.transition():selection:d3_selectionRoot.transition()};d3.transition.prototype=d3_transitionPrototype;d3_transitionPrototype.select=function(selector){var subgroup,subnode,node,id=this.id,subgroups=[];selector=d3_selection_selector(selector);for(var j=-1,m=this.length;++j<m;){subgroups.push(subgroup=[]);for(var group=this[j],i=-1,n=group.length;++i<n;)if((node=group[i])&&(subnode=selector.call(node,node.__data__,i,j))){"__data__"in node&&(subnode.__data__=node.__data__);d3_transitionNode(subnode,i,id,node.__transition__[id]);subgroup.push(subnode)}else subgroup.push(null)}return d3_transition(subgroups,id)};d3_transitionPrototype.selectAll=function(selector){var subgroup,subnodes,node,subnode,transition,id=this.id,subgroups=[];selector=d3_selection_selectorAll(selector);for(var j=-1,m=this.length;++j<m;)for(var group=this[j],i=-1,n=group.length;++i<n;)if(node=group[i]){transition=node.__transition__[id];subnodes=selector.call(node,node.__data__,i,j);subgroups.push(subgroup=[]);for(var k=-1,o=subnodes.length;++k<o;){(subnode=subnodes[k])&&d3_transitionNode(subnode,k,id,transition);subgroup.push(subnode)}}return d3_transition(subgroups,id)};d3_transitionPrototype.filter=function(filter){var subgroup,group,node,subgroups=[];"function"!=typeof filter&&(filter=d3_selection_filter(filter));for(var j=0,m=this.length;m>j;j++){subgroups.push(subgroup=[]);for(var group=this[j],i=0,n=group.length;n>i;i++)(node=group[i])&&filter.call(node,node.__data__,i)&&subgroup.push(node)}return d3_transition(subgroups,this.id)};d3_transitionPrototype.tween=function(name,tween){var id=this.id;return arguments.length<2?this.node().__transition__[id].tween.get(name):d3_selection_each(this,null==tween?function(node){node.__transition__[id].tween.remove(name)}:function(node){node.__transition__[id].tween.set(name,tween)})};d3_transitionPrototype.attr=function(nameNS,value){function attrNull(){this.removeAttribute(name)}function attrNullNS(){this.removeAttributeNS(name.space,name.local)}function attrTween(b){return null==b?attrNull:(b+="",function(){var i,a=this.getAttribute(name);return a!==b&&(i=interpolate(a,b),function(t){this.setAttribute(name,i(t))})})}function attrTweenNS(b){return null==b?attrNullNS:(b+="",function(){var i,a=this.getAttributeNS(name.space,name.local);return a!==b&&(i=interpolate(a,b),function(t){this.setAttributeNS(name.space,name.local,i(t))})})}if(arguments.length<2){for(value in nameNS)this.attr(value,nameNS[value]);return this}var interpolate="transform"==nameNS?d3_interpolateTransform:d3_interpolate,name=d3.ns.qualify(nameNS);return d3_transition_tween(this,"attr."+nameNS,value,name.local?attrTweenNS:attrTween)};d3_transitionPrototype.attrTween=function(nameNS,tween){function attrTween(d,i){var f=tween.call(this,d,i,this.getAttribute(name));return f&&function(t){this.setAttribute(name,f(t))}}function attrTweenNS(d,i){var f=tween.call(this,d,i,this.getAttributeNS(name.space,name.local));return f&&function(t){this.setAttributeNS(name.space,name.local,f(t))}}var name=d3.ns.qualify(nameNS);return this.tween("attr."+nameNS,name.local?attrTweenNS:attrTween)};d3_transitionPrototype.style=function(name,value,priority){function styleNull(){this.style.removeProperty(name)}function styleString(b){return null==b?styleNull:(b+="",function(){var i,a=d3_window.getComputedStyle(this,null).getPropertyValue(name);return a!==b&&(i=d3_interpolate(a,b),function(t){this.style.setProperty(name,i(t),priority)})})}var n=arguments.length;if(3>n){if("string"!=typeof name){2>n&&(value="");for(priority in name)this.style(priority,name[priority],value);return this}priority=""}return d3_transition_tween(this,"style."+name,value,styleString)};d3_transitionPrototype.styleTween=function(name,tween,priority){function styleTween(d,i){var f=tween.call(this,d,i,d3_window.getComputedStyle(this,null).getPropertyValue(name));return f&&function(t){this.style.setProperty(name,f(t),priority)}}arguments.length<3&&(priority="");return this.tween("style."+name,styleTween)};d3_transitionPrototype.text=function(value){return d3_transition_tween(this,"text",value,d3_transition_text)};d3_transitionPrototype.remove=function(){return this.each("end.transition",function(){var p;this.__transition__.count<2&&(p=this.parentNode)&&p.removeChild(this)})};d3_transitionPrototype.ease=function(value){var id=this.id;if(arguments.length<1)return this.node().__transition__[id].ease;"function"!=typeof value&&(value=d3.ease.apply(d3,arguments));return d3_selection_each(this,function(node){node.__transition__[id].ease=value})};d3_transitionPrototype.delay=function(value){var id=this.id;return d3_selection_each(this,"function"==typeof value?function(node,i,j){node.__transition__[id].delay=+value.call(node,node.__data__,i,j)}:(value=+value,function(node){node.__transition__[id].delay=value}))};d3_transitionPrototype.duration=function(value){var id=this.id;return d3_selection_each(this,"function"==typeof value?function(node,i,j){node.__transition__[id].duration=Math.max(1,value.call(node,node.__data__,i,j))}:(value=Math.max(1,value),function(node){node.__transition__[id].duration=value}))};d3_transitionPrototype.each=function(type,listener){var id=this.id;if(arguments.length<2){var inherit=d3_transitionInherit,inheritId=d3_transitionInheritId;d3_transitionInheritId=id;d3_selection_each(this,function(node,i,j){d3_transitionInherit=node.__transition__[id];type.call(node,node.__data__,i,j)});d3_transitionInherit=inherit;d3_transitionInheritId=inheritId}else d3_selection_each(this,function(node){var transition=node.__transition__[id];(transition.event||(transition.event=d3.dispatch("start","end"))).on(type,listener)});return this};d3_transitionPrototype.transition=function(){for(var subgroup,group,node,transition,id0=this.id,id1=++d3_transitionId,subgroups=[],j=0,m=this.length;m>j;j++){subgroups.push(subgroup=[]);for(var group=this[j],i=0,n=group.length;n>i;i++){if(node=group[i]){transition=Object.create(node.__transition__[id0]);transition.delay+=transition.duration;d3_transitionNode(node,i,id1,transition)}subgroup.push(node)}}return d3_transition(subgroups,id1)};d3.svg.axis=function(){function axis(g){g.each(function(){var tickTransform,g=d3.select(this),ticks=null==tickValues?scale.ticks?scale.ticks.apply(scale,tickArguments_):scale.domain():tickValues,tickFormat=null==tickFormat_?scale.tickFormat?scale.tickFormat.apply(scale,tickArguments_):d3_identity:tickFormat_,tick=g.selectAll(".tick").data(ticks,d3_identity),tickEnter=tick.enter().insert("g",".domain").attr("class","tick").style("opacity",1e-6),tickExit=d3.transition(tick.exit()).style("opacity",1e-6).remove(),tickUpdate=d3.transition(tick).style("opacity",1),range=d3_scaleRange(scale),path=g.selectAll(".domain").data([0]),pathUpdate=(path.enter().append("path").attr("class","domain"),d3.transition(path)),scale1=scale.copy(),scale0=this.__chart__||scale1;this.__chart__=scale1;tickEnter.append("line");tickEnter.append("text");var lineEnter=tickEnter.select("line"),lineUpdate=tickUpdate.select("line"),text=tick.select("text").text(tickFormat),textEnter=tickEnter.select("text"),textUpdate=tickUpdate.select("text");switch(orient){case"bottom":tickTransform=d3_svg_axisX;lineEnter.attr("y2",innerTickSize);textEnter.attr("y",Math.max(innerTickSize,0)+tickPadding);lineUpdate.attr("x2",0).attr("y2",innerTickSize);textUpdate.attr("x",0).attr("y",Math.max(innerTickSize,0)+tickPadding);text.attr("dy",".71em").style("text-anchor","middle");pathUpdate.attr("d","M"+range[0]+","+outerTickSize+"V0H"+range[1]+"V"+outerTickSize);break;case"top":tickTransform=d3_svg_axisX;lineEnter.attr("y2",-innerTickSize);textEnter.attr("y",-(Math.max(innerTickSize,0)+tickPadding));lineUpdate.attr("x2",0).attr("y2",-innerTickSize);textUpdate.attr("x",0).attr("y",-(Math.max(innerTickSize,0)+tickPadding));text.attr("dy","0em").style("text-anchor","middle");pathUpdate.attr("d","M"+range[0]+","+-outerTickSize+"V0H"+range[1]+"V"+-outerTickSize);break;case"left":tickTransform=d3_svg_axisY;lineEnter.attr("x2",-innerTickSize);textEnter.attr("x",-(Math.max(innerTickSize,0)+tickPadding));lineUpdate.attr("x2",-innerTickSize).attr("y2",0);textUpdate.attr("x",-(Math.max(innerTickSize,0)+tickPadding)).attr("y",0);text.attr("dy",".32em").style("text-anchor","end");pathUpdate.attr("d","M"+-outerTickSize+","+range[0]+"H0V"+range[1]+"H"+-outerTickSize);break;case"right":tickTransform=d3_svg_axisY;lineEnter.attr("x2",innerTickSize);textEnter.attr("x",Math.max(innerTickSize,0)+tickPadding);lineUpdate.attr("x2",innerTickSize).attr("y2",0);textUpdate.attr("x",Math.max(innerTickSize,0)+tickPadding).attr("y",0);text.attr("dy",".32em").style("text-anchor","start");pathUpdate.attr("d","M"+outerTickSize+","+range[0]+"H0V"+range[1]+"H"+outerTickSize)}if(scale.rangeBand){var dx=scale1.rangeBand()/2,x=function(d){return scale1(d)+dx};tickEnter.call(tickTransform,x);tickUpdate.call(tickTransform,x)}else{tickEnter.call(tickTransform,scale0);tickUpdate.call(tickTransform,scale1);tickExit.call(tickTransform,scale1)}})}var tickFormat_,scale=d3.scale.linear(),orient=d3_svg_axisDefaultOrient,innerTickSize=6,outerTickSize=6,tickPadding=3,tickArguments_=[10],tickValues=null;axis.scale=function(x){if(!arguments.length)return scale;scale=x;return axis};axis.orient=function(x){if(!arguments.length)return orient;orient=x in d3_svg_axisOrients?x+"":d3_svg_axisDefaultOrient;return axis};axis.ticks=function(){if(!arguments.length)return tickArguments_;tickArguments_=arguments;return axis};axis.tickValues=function(x){if(!arguments.length)return tickValues;tickValues=x;return axis};axis.tickFormat=function(x){if(!arguments.length)return tickFormat_;tickFormat_=x;return axis};axis.tickSize=function(x){var n=arguments.length;if(!n)return innerTickSize;innerTickSize=+x;outerTickSize=+arguments[n-1];return axis};axis.innerTickSize=function(x){if(!arguments.length)return innerTickSize;innerTickSize=+x;return axis};axis.outerTickSize=function(x){if(!arguments.length)return outerTickSize;outerTickSize=+x;return axis};axis.tickPadding=function(x){if(!arguments.length)return tickPadding;tickPadding=+x;return axis};axis.tickSubdivide=function(){return arguments.length&&axis};return axis};var d3_svg_axisDefaultOrient="bottom",d3_svg_axisOrients={top:1,right:1,bottom:1,left:1};d3.svg.brush=function(){function brush(g){g.each(function(){var g=d3.select(this).style("pointer-events","all").style("-webkit-tap-highlight-color","rgba(0,0,0,0)").on("mousedown.brush",brushstart).on("touchstart.brush",brushstart),background=g.selectAll(".background").data([0]);background.enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair");g.selectAll(".extent").data([0]).enter().append("rect").attr("class","extent").style("cursor","move");var resize=g.selectAll(".resize").data(resizes,d3_identity);resize.exit().remove();resize.enter().append("g").attr("class",function(d){return"resize "+d}).style("cursor",function(d){return d3_svg_brushCursor[d]}).append("rect").attr("x",function(d){return/[ew]$/.test(d)?-3:null}).attr("y",function(d){return/^[ns]/.test(d)?-3:null}).attr("width",6).attr("height",6).style("visibility","hidden");resize.style("display",brush.empty()?"none":null);var range,gUpdate=d3.transition(g),backgroundUpdate=d3.transition(background);if(x){range=d3_scaleRange(x);backgroundUpdate.attr("x",range[0]).attr("width",range[1]-range[0]);redrawX(gUpdate)}if(y){range=d3_scaleRange(y);backgroundUpdate.attr("y",range[0]).attr("height",range[1]-range[0]);redrawY(gUpdate)}redraw(gUpdate)})}function redraw(g){g.selectAll(".resize").attr("transform",function(d){return"translate("+xExtent[+/e$/.test(d)]+","+yExtent[+/^s/.test(d)]+")"})}function redrawX(g){g.select(".extent").attr("x",xExtent[0]);g.selectAll(".extent,.n>rect,.s>rect").attr("width",xExtent[1]-xExtent[0])}function redrawY(g){g.select(".extent").attr("y",yExtent[0]);g.selectAll(".extent,.e>rect,.w>rect").attr("height",yExtent[1]-yExtent[0])}function brushstart(){function mouse(){var touches=d3.event.changedTouches;return touches?d3.touches(target,touches)[0]:d3.mouse(target)}function keydown(){if(32==d3.event.keyCode){if(!dragging){center=null;origin[0]-=xExtent[1];origin[1]-=yExtent[1];dragging=2}d3_eventPreventDefault()}}function keyup(){if(32==d3.event.keyCode&&2==dragging){origin[0]+=xExtent[1];origin[1]+=yExtent[1];dragging=0;d3_eventPreventDefault()}}function brushmove(){var point=mouse(),moved=!1;if(offset){point[0]+=offset[0];point[1]+=offset[1]}if(!dragging)if(d3.event.altKey){center||(center=[(xExtent[0]+xExtent[1])/2,(yExtent[0]+yExtent[1])/2]);origin[0]=xExtent[+(point[0]<center[0])];origin[1]=yExtent[+(point[1]<center[1])]}else center=null;if(resizingX&&move1(point,x,0)){redrawX(g);moved=!0}if(resizingY&&move1(point,y,1)){redrawY(g);moved=!0}if(moved){redraw(g);event_({type:"brush",mode:dragging?"move":"resize"})}}function move1(point,scale,i){var min,max,range=d3_scaleRange(scale),r0=range[0],r1=range[1],position=origin[i],extent=i?yExtent:xExtent,size=extent[1]-extent[0];if(dragging){r0-=position;r1-=size+position}min=(i?yClamp:xClamp)?Math.max(r0,Math.min(r1,point[i])):point[i];if(dragging)max=(min+=position)+size;else{center&&(position=Math.max(r0,Math.min(r1,2*center[i]-min)));if(min>position){max=min;min=position}else max=position}if(extent[0]!=min||extent[1]!=max){i?yExtentDomain=null:xExtentDomain=null;extent[0]=min;extent[1]=max;return!0}}function brushend(){brushmove();g.style("pointer-events","all").selectAll(".resize").style("display",brush.empty()?"none":null);d3.select("body").style("cursor",null);w.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null);dragRestore();event_({type:"brushend"})}var center,offset,target=this,eventTarget=d3.select(d3.event.target),event_=event.of(target,arguments),g=d3.select(target),resizing=eventTarget.datum(),resizingX=!/^(n|s)$/.test(resizing)&&x,resizingY=!/^(e|w)$/.test(resizing)&&y,dragging=eventTarget.classed("extent"),dragRestore=d3_event_dragSuppress(),origin=mouse(),w=d3.select(d3_window).on("keydown.brush",keydown).on("keyup.brush",keyup);d3.event.changedTouches?w.on("touchmove.brush",brushmove).on("touchend.brush",brushend):w.on("mousemove.brush",brushmove).on("mouseup.brush",brushend);g.interrupt().selectAll("*").interrupt();if(dragging){origin[0]=xExtent[0]-origin[0];origin[1]=yExtent[0]-origin[1]}else if(resizing){var ex=+/w$/.test(resizing),ey=+/^n/.test(resizing);offset=[xExtent[1-ex]-origin[0],yExtent[1-ey]-origin[1]];origin[0]=xExtent[ex];origin[1]=yExtent[ey]}else d3.event.altKey&&(center=origin.slice());g.style("pointer-events","none").selectAll(".resize").style("display",null);d3.select("body").style("cursor",eventTarget.style("cursor"));event_({type:"brushstart"});brushmove()}var xExtentDomain,yExtentDomain,event=d3_eventDispatch(brush,"brushstart","brush","brushend"),x=null,y=null,xExtent=[0,0],yExtent=[0,0],xClamp=!0,yClamp=!0,resizes=d3_svg_brushResizes[0];brush.event=function(g){g.each(function(){var event_=event.of(this,arguments),extent1={x:xExtent,y:yExtent,i:xExtentDomain,j:yExtentDomain},extent0=this.__chart__||extent1;this.__chart__=extent1;if(d3_transitionInheritId)d3.select(this).transition().each("start.brush",function(){xExtentDomain=extent0.i;yExtentDomain=extent0.j;xExtent=extent0.x;yExtent=extent0.y;event_({type:"brushstart"})}).tween("brush:brush",function(){var xi=d3_interpolateArray(xExtent,extent1.x),yi=d3_interpolateArray(yExtent,extent1.y);xExtentDomain=yExtentDomain=null;return function(t){xExtent=extent1.x=xi(t);yExtent=extent1.y=yi(t);event_({type:"brush",mode:"resize"})}}).each("end.brush",function(){xExtentDomain=extent1.i;yExtentDomain=extent1.j;event_({type:"brush",mode:"resize"});event_({type:"brushend"})});else{event_({type:"brushstart"});event_({type:"brush",mode:"resize"});event_({type:"brushend"})}})};brush.x=function(z){if(!arguments.length)return x;x=z;resizes=d3_svg_brushResizes[!x<<1|!y];return brush};brush.y=function(z){if(!arguments.length)return y;y=z;resizes=d3_svg_brushResizes[!x<<1|!y];return brush};brush.clamp=function(z){if(!arguments.length)return x&&y?[xClamp,yClamp]:x?xClamp:y?yClamp:null;x&&y?(xClamp=!!z[0],yClamp=!!z[1]):x?xClamp=!!z:y&&(yClamp=!!z);return brush};brush.extent=function(z){var x0,x1,y0,y1,t;if(!arguments.length){if(x)if(xExtentDomain)x0=xExtentDomain[0],x1=xExtentDomain[1];else{x0=xExtent[0],x1=xExtent[1];x.invert&&(x0=x.invert(x0),x1=x.invert(x1));x0>x1&&(t=x0,x0=x1,x1=t)}if(y)if(yExtentDomain)y0=yExtentDomain[0],y1=yExtentDomain[1];else{y0=yExtent[0],y1=yExtent[1];y.invert&&(y0=y.invert(y0),y1=y.invert(y1));y0>y1&&(t=y0,y0=y1,y1=t)}return x&&y?[[x0,y0],[x1,y1]]:x?[x0,x1]:y&&[y0,y1]}if(x){x0=z[0],x1=z[1];y&&(x0=x0[0],x1=x1[0]);xExtentDomain=[x0,x1];x.invert&&(x0=x(x0),x1=x(x1));x0>x1&&(t=x0,x0=x1,x1=t);(x0!=xExtent[0]||x1!=xExtent[1])&&(xExtent=[x0,x1])}if(y){y0=z[0],y1=z[1];x&&(y0=y0[1],y1=y1[1]);yExtentDomain=[y0,y1];y.invert&&(y0=y(y0),y1=y(y1));y0>y1&&(t=y0,y0=y1,y1=t);(y0!=yExtent[0]||y1!=yExtent[1])&&(yExtent=[y0,y1])}return brush};brush.clear=function(){if(!brush.empty()){xExtent=[0,0],yExtent=[0,0];xExtentDomain=yExtentDomain=null}return brush};brush.empty=function(){return!!x&&xExtent[0]==xExtent[1]||!!y&&yExtent[0]==yExtent[1]};return d3.rebind(brush,event,"on")};var d3_svg_brushCursor={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},d3_svg_brushResizes=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]],d3_time=d3.time={},d3_date=Date,d3_time_daySymbols=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];d3_date_utc.prototype={getDate:function(){return this._.getUTCDate()},getDay:function(){return this._.getUTCDay()},getFullYear:function(){return this._.getUTCFullYear()},getHours:function(){return this._.getUTCHours()},getMilliseconds:function(){return this._.getUTCMilliseconds()},getMinutes:function(){return this._.getUTCMinutes()},getMonth:function(){return this._.getUTCMonth()},getSeconds:function(){return this._.getUTCSeconds()},getTime:function(){return this._.getTime()},getTimezoneOffset:function(){return 0},valueOf:function(){return this._.valueOf()
},setDate:function(){d3_time_prototype.setUTCDate.apply(this._,arguments)},setDay:function(){d3_time_prototype.setUTCDay.apply(this._,arguments)},setFullYear:function(){d3_time_prototype.setUTCFullYear.apply(this._,arguments)},setHours:function(){d3_time_prototype.setUTCHours.apply(this._,arguments)},setMilliseconds:function(){d3_time_prototype.setUTCMilliseconds.apply(this._,arguments)},setMinutes:function(){d3_time_prototype.setUTCMinutes.apply(this._,arguments)},setMonth:function(){d3_time_prototype.setUTCMonth.apply(this._,arguments)},setSeconds:function(){d3_time_prototype.setUTCSeconds.apply(this._,arguments)},setTime:function(){d3_time_prototype.setTime.apply(this._,arguments)}};var d3_time_prototype=Date.prototype,d3_time_formatDateTime="%a %b %e %X %Y",d3_time_formatDate="%m/%d/%Y",d3_time_formatTime="%H:%M:%S",d3_time_days=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],d3_time_dayAbbreviations=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],d3_time_months=["January","February","March","April","May","June","July","August","September","October","November","December"],d3_time_monthAbbreviations=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];d3_time.year=d3_time_interval(function(date){date=d3_time.day(date);date.setMonth(0,1);return date},function(date,offset){date.setFullYear(date.getFullYear()+offset)},function(date){return date.getFullYear()});d3_time.years=d3_time.year.range;d3_time.years.utc=d3_time.year.utc.range;d3_time.day=d3_time_interval(function(date){var day=new d3_date(2e3,0);day.setFullYear(date.getFullYear(),date.getMonth(),date.getDate());return day},function(date,offset){date.setDate(date.getDate()+offset)},function(date){return date.getDate()-1});d3_time.days=d3_time.day.range;d3_time.days.utc=d3_time.day.utc.range;d3_time.dayOfYear=function(date){var year=d3_time.year(date);return Math.floor((date-year-6e4*(date.getTimezoneOffset()-year.getTimezoneOffset()))/864e5)};d3_time_daySymbols.forEach(function(day,i){day=day.toLowerCase();i=7-i;var interval=d3_time[day]=d3_time_interval(function(date){(date=d3_time.day(date)).setDate(date.getDate()-(date.getDay()+i)%7);return date},function(date,offset){date.setDate(date.getDate()+7*Math.floor(offset))},function(date){var day=d3_time.year(date).getDay();return Math.floor((d3_time.dayOfYear(date)+(day+i)%7)/7)-(day!==i)});d3_time[day+"s"]=interval.range;d3_time[day+"s"].utc=interval.utc.range;d3_time[day+"OfYear"]=function(date){var day=d3_time.year(date).getDay();return Math.floor((d3_time.dayOfYear(date)+(day+i)%7)/7)}});d3_time.week=d3_time.sunday;d3_time.weeks=d3_time.sunday.range;d3_time.weeks.utc=d3_time.sunday.utc.range;d3_time.weekOfYear=d3_time.sundayOfYear;d3_time.format=d3_time_format;var d3_time_dayRe=d3_time_formatRe(d3_time_days),d3_time_dayLookup=d3_time_formatLookup(d3_time_days),d3_time_dayAbbrevRe=d3_time_formatRe(d3_time_dayAbbreviations),d3_time_dayAbbrevLookup=d3_time_formatLookup(d3_time_dayAbbreviations),d3_time_monthRe=d3_time_formatRe(d3_time_months),d3_time_monthLookup=d3_time_formatLookup(d3_time_months),d3_time_monthAbbrevRe=d3_time_formatRe(d3_time_monthAbbreviations),d3_time_monthAbbrevLookup=d3_time_formatLookup(d3_time_monthAbbreviations),d3_time_percentRe=/^%/,d3_time_formatPads={"-":"",_:" ",0:"0"},d3_time_formats={a:function(d){return d3_time_dayAbbreviations[d.getDay()]},A:function(d){return d3_time_days[d.getDay()]},b:function(d){return d3_time_monthAbbreviations[d.getMonth()]},B:function(d){return d3_time_months[d.getMonth()]},c:d3_time_format(d3_time_formatDateTime),d:function(d,p){return d3_time_formatPad(d.getDate(),p,2)},e:function(d,p){return d3_time_formatPad(d.getDate(),p,2)},H:function(d,p){return d3_time_formatPad(d.getHours(),p,2)},I:function(d,p){return d3_time_formatPad(d.getHours()%12||12,p,2)},j:function(d,p){return d3_time_formatPad(1+d3_time.dayOfYear(d),p,3)},L:function(d,p){return d3_time_formatPad(d.getMilliseconds(),p,3)},m:function(d,p){return d3_time_formatPad(d.getMonth()+1,p,2)},M:function(d,p){return d3_time_formatPad(d.getMinutes(),p,2)},p:function(d){return d.getHours()>=12?"PM":"AM"},S:function(d,p){return d3_time_formatPad(d.getSeconds(),p,2)},U:function(d,p){return d3_time_formatPad(d3_time.sundayOfYear(d),p,2)},w:function(d){return d.getDay()},W:function(d,p){return d3_time_formatPad(d3_time.mondayOfYear(d),p,2)},x:d3_time_format(d3_time_formatDate),X:d3_time_format(d3_time_formatTime),y:function(d,p){return d3_time_formatPad(d.getFullYear()%100,p,2)},Y:function(d,p){return d3_time_formatPad(d.getFullYear()%1e4,p,4)},Z:d3_time_zone,"%":function(){return"%"}},d3_time_parsers={a:d3_time_parseWeekdayAbbrev,A:d3_time_parseWeekday,b:d3_time_parseMonthAbbrev,B:d3_time_parseMonth,c:d3_time_parseLocaleFull,d:d3_time_parseDay,e:d3_time_parseDay,H:d3_time_parseHour24,I:d3_time_parseHour24,j:d3_time_parseDayOfYear,L:d3_time_parseMilliseconds,m:d3_time_parseMonthNumber,M:d3_time_parseMinutes,p:d3_time_parseAmPm,S:d3_time_parseSeconds,U:d3_time_parseWeekNumberSunday,w:d3_time_parseWeekdayNumber,W:d3_time_parseWeekNumberMonday,x:d3_time_parseLocaleDate,X:d3_time_parseLocaleTime,y:d3_time_parseYear,Y:d3_time_parseFullYear,"%":d3_time_parseLiteralPercent},d3_time_numberRe=/^\s*\d+/,d3_time_amPmLookup=d3.map({am:0,pm:1});d3_time_format.utc=d3_time_formatUtc;var d3_time_formatIso=d3_time_formatUtc("%Y-%m-%dT%H:%M:%S.%LZ");d3_time_format.iso=Date.prototype.toISOString&&+new Date("2000-01-01T00:00:00.000Z")?d3_time_formatIsoNative:d3_time_formatIso;d3_time_formatIsoNative.parse=function(string){var date=new Date(string);return isNaN(date)?null:date};d3_time_formatIsoNative.toString=d3_time_formatIso.toString;d3_time.second=d3_time_interval(function(date){return new d3_date(1e3*Math.floor(date/1e3))},function(date,offset){date.setTime(date.getTime()+1e3*Math.floor(offset))},function(date){return date.getSeconds()});d3_time.seconds=d3_time.second.range;d3_time.seconds.utc=d3_time.second.utc.range;d3_time.minute=d3_time_interval(function(date){return new d3_date(6e4*Math.floor(date/6e4))},function(date,offset){date.setTime(date.getTime()+6e4*Math.floor(offset))},function(date){return date.getMinutes()});d3_time.minutes=d3_time.minute.range;d3_time.minutes.utc=d3_time.minute.utc.range;d3_time.hour=d3_time_interval(function(date){var timezone=date.getTimezoneOffset()/60;return new d3_date(36e5*(Math.floor(date/36e5-timezone)+timezone))},function(date,offset){date.setTime(date.getTime()+36e5*Math.floor(offset))},function(date){return date.getHours()});d3_time.hours=d3_time.hour.range;d3_time.hours.utc=d3_time.hour.utc.range;d3_time.month=d3_time_interval(function(date){date=d3_time.day(date);date.setDate(1);return date},function(date,offset){date.setMonth(date.getMonth()+offset)},function(date){return date.getMonth()});d3_time.months=d3_time.month.range;d3_time.months.utc=d3_time.month.utc.range;var d3_time_scaleSteps=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6],d3_time_scaleLocalMethods=[[d3_time.second,1],[d3_time.second,5],[d3_time.second,15],[d3_time.second,30],[d3_time.minute,1],[d3_time.minute,5],[d3_time.minute,15],[d3_time.minute,30],[d3_time.hour,1],[d3_time.hour,3],[d3_time.hour,6],[d3_time.hour,12],[d3_time.day,1],[d3_time.day,2],[d3_time.week,1],[d3_time.month,1],[d3_time.month,3],[d3_time.year,1]],d3_time_scaleLocalFormats=[[d3_time_format("%Y"),d3_true],[d3_time_format("%B"),function(d){return d.getMonth()}],[d3_time_format("%b %d"),function(d){return 1!=d.getDate()}],[d3_time_format("%a %d"),function(d){return d.getDay()&&1!=d.getDate()}],[d3_time_format("%I %p"),function(d){return d.getHours()}],[d3_time_format("%I:%M"),function(d){return d.getMinutes()}],[d3_time_format(":%S"),function(d){return d.getSeconds()}],[d3_time_format(".%L"),function(d){return d.getMilliseconds()}]],d3_time_scaleLocalFormat=d3_time_scaleFormat(d3_time_scaleLocalFormats);d3_time_scaleLocalMethods.year=d3_time.year;d3_time.scale=function(){return d3_time_scale(d3.scale.linear(),d3_time_scaleLocalMethods,d3_time_scaleLocalFormat)};var d3_time_scaleMilliseconds={range:function(start,stop,step){return d3.range(+start,+stop,step).map(d3_time_scaleDate)}},d3_time_scaleUTCMethods=d3_time_scaleLocalMethods.map(function(m){return[m[0].utc,m[1]]}),d3_time_scaleUTCFormats=[[d3_time_formatUtc("%Y"),d3_true],[d3_time_formatUtc("%B"),function(d){return d.getUTCMonth()}],[d3_time_formatUtc("%b %d"),function(d){return 1!=d.getUTCDate()}],[d3_time_formatUtc("%a %d"),function(d){return d.getUTCDay()&&1!=d.getUTCDate()}],[d3_time_formatUtc("%I %p"),function(d){return d.getUTCHours()}],[d3_time_formatUtc("%I:%M"),function(d){return d.getUTCMinutes()}],[d3_time_formatUtc(":%S"),function(d){return d.getUTCSeconds()}],[d3_time_formatUtc(".%L"),function(d){return d.getUTCMilliseconds()}]],d3_time_scaleUTCFormat=d3_time_scaleFormat(d3_time_scaleUTCFormats);d3_time_scaleUTCMethods.year=d3_time.year.utc;d3_time.scale.utc=function(){return d3_time_scale(d3.scale.linear(),d3_time_scaleUTCMethods,d3_time_scaleUTCFormat)};d3.text=d3_xhrType(function(request){return request.responseText});d3.json=function(url,callback){return d3_xhr(url,"application/json",d3_json,callback)};d3.html=function(url,callback){return d3_xhr(url,"text/html",d3_html,callback)};d3.xml=d3_xhrType(function(request){return request.responseXML});return d3}();define("d3",function(global){return function(){var ret;return ret||global.d3}}(this));(function(){{var Backbone,root=this,previousBackbone=root.Backbone,array=[],slice=(array.push,array.slice);array.splice}Backbone="undefined"!=typeof exports?exports:root.Backbone={};Backbone.VERSION="1.1.0";var _=root._;_||"undefined"==typeof require||(_=require("underscore"));Backbone.$=root.jQuery||root.Zepto||root.ender||root.$;Backbone.noConflict=function(){root.Backbone=previousBackbone;return this};Backbone.emulateHTTP=!1;Backbone.emulateJSON=!1;var Events=Backbone.Events={on:function(name,callback,context){if(!eventsApi(this,"on",name,[callback,context])||!callback)return this;this._events||(this._events={});var events=this._events[name]||(this._events[name]=[]);events.push({callback:callback,context:context,ctx:context||this});return this},once:function(name,callback,context){if(!eventsApi(this,"once",name,[callback,context])||!callback)return this;var self=this,once=_.once(function(){self.off(name,once);callback.apply(this,arguments)});once._callback=callback;return this.on(name,once,context)},off:function(name,callback,context){var retain,ev,events,names,i,l,j,k;if(!this._events||!eventsApi(this,"off",name,[callback,context]))return this;if(!name&&!callback&&!context){this._events={};return this}names=name?[name]:_.keys(this._events);for(i=0,l=names.length;l>i;i++){name=names[i];if(events=this._events[name]){this._events[name]=retain=[];if(callback||context)for(j=0,k=events.length;k>j;j++){ev=events[j];(callback&&callback!==ev.callback&&callback!==ev.callback._callback||context&&context!==ev.context)&&retain.push(ev)}retain.length||delete this._events[name]}}return this},trigger:function(name){if(!this._events)return this;var args=slice.call(arguments,1);if(!eventsApi(this,"trigger",name,args))return this;var events=this._events[name],allEvents=this._events.all;events&&triggerEvents(events,args);allEvents&&triggerEvents(allEvents,arguments);return this},stopListening:function(obj,name,callback){var listeningTo=this._listeningTo;if(!listeningTo)return this;var remove=!name&&!callback;callback||"object"!=typeof name||(callback=this);obj&&((listeningTo={})[obj._listenId]=obj);for(var id in listeningTo){obj=listeningTo[id];obj.off(name,callback,this);(remove||_.isEmpty(obj._events))&&delete this._listeningTo[id]}return this}},eventSplitter=/\s+/,eventsApi=function(obj,action,name,rest){if(!name)return!0;if("object"==typeof name){for(var key in name)obj[action].apply(obj,[key,name[key]].concat(rest));return!1}if(eventSplitter.test(name)){for(var names=name.split(eventSplitter),i=0,l=names.length;l>i;i++)obj[action].apply(obj,[names[i]].concat(rest));return!1}return!0},triggerEvents=function(events,args){var ev,i=-1,l=events.length,a1=args[0],a2=args[1],a3=args[2];switch(args.length){case 0:for(;++i<l;)(ev=events[i]).callback.call(ev.ctx);return;case 1:for(;++i<l;)(ev=events[i]).callback.call(ev.ctx,a1);return;case 2:for(;++i<l;)(ev=events[i]).callback.call(ev.ctx,a1,a2);return;case 3:for(;++i<l;)(ev=events[i]).callback.call(ev.ctx,a1,a2,a3);return;default:for(;++i<l;)(ev=events[i]).callback.apply(ev.ctx,args)}},listenMethods={listenTo:"on",listenToOnce:"once"};_.each(listenMethods,function(implementation,method){Events[method]=function(obj,name,callback){var listeningTo=this._listeningTo||(this._listeningTo={}),id=obj._listenId||(obj._listenId=_.uniqueId("l"));listeningTo[id]=obj;callback||"object"!=typeof name||(callback=this);obj[implementation](name,callback,this);return this}});Events.bind=Events.on;Events.unbind=Events.off;_.extend(Backbone,Events);var Model=Backbone.Model=function(attributes,options){var attrs=attributes||{};options||(options={});this.cid=_.uniqueId("c");this.attributes={};options.collection&&(this.collection=options.collection);options.parse&&(attrs=this.parse(attrs,options)||{});attrs=_.defaults({},attrs,_.result(this,"defaults"));this.set(attrs,options);this.changed={};this.initialize.apply(this,arguments)};_.extend(Model.prototype,Events,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(){return _.clone(this.attributes)},sync:function(){return Backbone.sync.apply(this,arguments)},get:function(attr){return this.attributes[attr]},escape:function(attr){return _.escape(this.get(attr))},has:function(attr){return null!=this.get(attr)},set:function(key,val,options){var attr,attrs,unset,changes,silent,changing,prev,current;if(null==key)return this;if("object"==typeof key){attrs=key;options=val}else(attrs={})[key]=val;options||(options={});if(!this._validate(attrs,options))return!1;unset=options.unset;silent=options.silent;changes=[];changing=this._changing;this._changing=!0;if(!changing){this._previousAttributes=_.clone(this.attributes);this.changed={}}current=this.attributes,prev=this._previousAttributes;this.idAttribute in attrs&&(this.id=attrs[this.idAttribute]);for(attr in attrs){val=attrs[attr];_.isEqual(current[attr],val)||changes.push(attr);_.isEqual(prev[attr],val)?delete this.changed[attr]:this.changed[attr]=val;unset?delete current[attr]:current[attr]=val}if(!silent){changes.length&&(this._pending=!0);for(var i=0,l=changes.length;l>i;i++)this.trigger("change:"+changes[i],this,current[changes[i]],options)}if(changing)return this;if(!silent)for(;this._pending;){this._pending=!1;this.trigger("change",this,options)}this._pending=!1;this._changing=!1;return this},unset:function(attr,options){return this.set(attr,void 0,_.extend({},options,{unset:!0}))},clear:function(options){var attrs={};for(var key in this.attributes)attrs[key]=void 0;return this.set(attrs,_.extend({},options,{unset:!0}))},hasChanged:function(attr){return null==attr?!_.isEmpty(this.changed):_.has(this.changed,attr)},changedAttributes:function(diff){if(!diff)return this.hasChanged()?_.clone(this.changed):!1;var val,changed=!1,old=this._changing?this._previousAttributes:this.attributes;for(var attr in diff)_.isEqual(old[attr],val=diff[attr])||((changed||(changed={}))[attr]=val);return changed},previous:function(attr){return null!=attr&&this._previousAttributes?this._previousAttributes[attr]:null},previousAttributes:function(){return _.clone(this._previousAttributes)},fetch:function(options){options=options?_.clone(options):{};void 0===options.parse&&(options.parse=!0);var model=this,success=options.success;options.success=function(resp){if(!model.set(model.parse(resp,options),options))return!1;success&&success(model,resp,options);model.trigger("sync",model,resp,options)};wrapError(this,options);return this.sync("read",this,options)},save:function(key,val,options){var attrs,method,xhr,attributes=this.attributes;if(null==key||"object"==typeof key){attrs=key;options=val}else(attrs={})[key]=val;options=_.extend({validate:!0},options);if(attrs&&!options.wait){if(!this.set(attrs,options))return!1}else if(!this._validate(attrs,options))return!1;attrs&&options.wait&&(this.attributes=_.extend({},attributes,attrs));void 0===options.parse&&(options.parse=!0);var model=this,success=options.success;options.success=function(resp){model.attributes=attributes;var serverAttrs=model.parse(resp,options);options.wait&&(serverAttrs=_.extend(attrs||{},serverAttrs));if(_.isObject(serverAttrs)&&!model.set(serverAttrs,options))return!1;success&&success(model,resp,options);model.trigger("sync",model,resp,options)};wrapError(this,options);method=this.isNew()?"create":options.patch?"patch":"update";"patch"===method&&(options.attrs=attrs);xhr=this.sync(method,this,options);attrs&&options.wait&&(this.attributes=attributes);return xhr},destroy:function(options){options=options?_.clone(options):{};var model=this,success=options.success,destroy=function(){model.trigger("destroy",model,model.collection,options)};options.success=function(resp){(options.wait||model.isNew())&&destroy();success&&success(model,resp,options);model.isNew()||model.trigger("sync",model,resp,options)};if(this.isNew()){options.success();return!1}wrapError(this,options);var xhr=this.sync("delete",this,options);options.wait||destroy();return xhr},url:function(){var base=_.result(this,"urlRoot")||_.result(this.collection,"url")||urlError();return this.isNew()?base:base+("/"===base.charAt(base.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(resp){return resp},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},isValid:function(options){return this._validate({},_.extend(options||{},{validate:!0}))},_validate:function(attrs,options){if(!options.validate||!this.validate)return!0;attrs=_.extend({},this.attributes,attrs);var error=this.validationError=this.validate(attrs,options)||null;if(!error)return!0;this.trigger("invalid",this,error,_.extend(options,{validationError:error}));return!1}});var modelMethods=["keys","values","pairs","invert","pick","omit"];_.each(modelMethods,function(method){Model.prototype[method]=function(){var args=slice.call(arguments);args.unshift(this.attributes);return _[method].apply(_,args)}});var Collection=Backbone.Collection=function(models,options){options||(options={});options.model&&(this.model=options.model);void 0!==options.comparator&&(this.comparator=options.comparator);this._reset();this.initialize.apply(this,arguments);models&&this.reset(models,_.extend({silent:!0},options))},setOptions={add:!0,remove:!0,merge:!0},addOptions={add:!0,remove:!1};_.extend(Collection.prototype,Events,{model:Model,initialize:function(){},toJSON:function(options){return this.map(function(model){return model.toJSON(options)})},sync:function(){return Backbone.sync.apply(this,arguments)},add:function(models,options){return this.set(models,_.extend({merge:!1},options,addOptions))},remove:function(models,options){var singular=!_.isArray(models);models=singular?[models]:_.clone(models);options||(options={});var i,l,index,model;for(i=0,l=models.length;l>i;i++){model=models[i]=this.get(models[i]);if(model){delete this._byId[model.id];delete this._byId[model.cid];index=this.indexOf(model);this.models.splice(index,1);this.length--;if(!options.silent){options.index=index;model.trigger("remove",model,this,options)}this._removeReference(model)}}return singular?models[0]:models},set:function(models,options){options=_.defaults({},options,setOptions);options.parse&&(models=this.parse(models,options));var singular=!_.isArray(models);models=singular?models?[models]:[]:_.clone(models);var i,l,id,model,attrs,existing,sort,at=options.at,targetModel=this.model,sortable=this.comparator&&null==at&&options.sort!==!1,sortAttr=_.isString(this.comparator)?this.comparator:null,toAdd=[],toRemove=[],modelMap={},add=options.add,merge=options.merge,remove=options.remove,order=!sortable&&add&&remove?[]:!1;for(i=0,l=models.length;l>i;i++){attrs=models[i];id=attrs instanceof Model?model=attrs:attrs[targetModel.prototype.idAttribute];if(existing=this.get(id)){remove&&(modelMap[existing.cid]=!0);if(merge){attrs=attrs===model?model.attributes:attrs;options.parse&&(attrs=existing.parse(attrs,options));existing.set(attrs,options);sortable&&!sort&&existing.hasChanged(sortAttr)&&(sort=!0)}models[i]=existing}else if(add){model=models[i]=this._prepareModel(attrs,options);if(!model)continue;toAdd.push(model);model.on("all",this._onModelEvent,this);this._byId[model.cid]=model;null!=model.id&&(this._byId[model.id]=model)}order&&order.push(existing||model)}if(remove){for(i=0,l=this.length;l>i;++i)modelMap[(model=this.models[i]).cid]||toRemove.push(model);toRemove.length&&this.remove(toRemove,options)}if(toAdd.length||order&&order.length){sortable&&(sort=!0);this.length+=toAdd.length;if(null!=at)for(i=0,l=toAdd.length;l>i;i++)this.models.splice(at+i,0,toAdd[i]);else{order&&(this.models.length=0);var orderedModels=order||toAdd;for(i=0,l=orderedModels.length;l>i;i++)this.models.push(orderedModels[i])}}sort&&this.sort({silent:!0});if(!options.silent){for(i=0,l=toAdd.length;l>i;i++)(model=toAdd[i]).trigger("add",model,this,options);(sort||order&&order.length)&&this.trigger("sort",this,options)}return singular?models[0]:models},reset:function(models,options){options||(options={});for(var i=0,l=this.models.length;l>i;i++)this._removeReference(this.models[i]);options.previousModels=this.models;this._reset();models=this.add(models,_.extend({silent:!0},options));options.silent||this.trigger("reset",this,options);return models},push:function(model,options){return this.add(model,_.extend({at:this.length},options))},pop:function(options){var model=this.at(this.length-1);this.remove(model,options);return model},unshift:function(model,options){return this.add(model,_.extend({at:0},options))},shift:function(options){var model=this.at(0);this.remove(model,options);return model},slice:function(){return slice.apply(this.models,arguments)},get:function(obj){return null==obj?void 0:this._byId[obj.id]||this._byId[obj.cid]||this._byId[obj]},at:function(index){return this.models[index]},where:function(attrs,first){return _.isEmpty(attrs)?first?void 0:[]:this[first?"find":"filter"](function(model){for(var key in attrs)if(attrs[key]!==model.get(key))return!1;return!0})},findWhere:function(attrs){return this.where(attrs,!0)},sort:function(options){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");options||(options={});_.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(_.bind(this.comparator,this));options.silent||this.trigger("sort",this,options);return this},pluck:function(attr){return _.invoke(this.models,"get",attr)},fetch:function(options){options=options?_.clone(options):{};void 0===options.parse&&(options.parse=!0);var success=options.success,collection=this;options.success=function(resp){var method=options.reset?"reset":"set";collection[method](resp,options);success&&success(collection,resp,options);collection.trigger("sync",collection,resp,options)};wrapError(this,options);return this.sync("read",this,options)},create:function(model,options){options=options?_.clone(options):{};if(!(model=this._prepareModel(model,options)))return!1;options.wait||this.add(model,options);var collection=this,success=options.success;options.success=function(model,resp,options){options.wait&&collection.add(model,options);success&&success(model,resp,options)};model.save(null,options);return model},parse:function(resp){return resp},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0;this.models=[];this._byId={}},_prepareModel:function(attrs,options){if(attrs instanceof Model){attrs.collection||(attrs.collection=this);return attrs}options=options?_.clone(options):{};options.collection=this;var model=new this.model(attrs,options);if(!model.validationError)return model;this.trigger("invalid",this,model.validationError,options);return!1},_removeReference:function(model){this===model.collection&&delete model.collection;model.off("all",this._onModelEvent,this)},_onModelEvent:function(event,model,collection,options){if("add"!==event&&"remove"!==event||collection===this){"destroy"===event&&this.remove(model,options);if(model&&event==="change:"+model.idAttribute){delete this._byId[model.previous(model.idAttribute)];null!=model.id&&(this._byId[model.id]=model)}this.trigger.apply(this,arguments)}}});var methods=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain"];_.each(methods,function(method){Collection.prototype[method]=function(){var args=slice.call(arguments);args.unshift(this.models);return _[method].apply(_,args)}});var attributeMethods=["groupBy","countBy","sortBy"];_.each(attributeMethods,function(method){Collection.prototype[method]=function(value,context){var iterator=_.isFunction(value)?value:function(model){return model.get(value)};return _[method](this.models,iterator,context)}});var View=Backbone.View=function(options){this.cid=_.uniqueId("view");options||(options={});_.extend(this,_.pick(options,viewOptions));this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()},delegateEventSplitter=/^(\S+)\s*(.*)$/,viewOptions=["model","collection","el","id","attributes","className","tagName","events"];_.extend(View.prototype,Events,{tagName:"div",$:function(selector){return this.$el.find(selector)},initialize:function(){},render:function(){return this},remove:function(){this.$el.remove();this.stopListening();return this},setElement:function(element,delegate){this.$el&&this.undelegateEvents();this.$el=element instanceof Backbone.$?element:Backbone.$(element);this.el=this.$el[0];delegate!==!1&&this.delegateEvents();return this},delegateEvents:function(events){if(!events&&!(events=_.result(this,"events")))return this;this.undelegateEvents();for(var key in events){var method=events[key];_.isFunction(method)||(method=this[events[key]]);if(method){var match=key.match(delegateEventSplitter),eventName=match[1],selector=match[2];method=_.bind(method,this);eventName+=".delegateEvents"+this.cid;""===selector?this.$el.on(eventName,method):this.$el.on(eventName,selector,method)}}return this},undelegateEvents:function(){this.$el.off(".delegateEvents"+this.cid);return this},_ensureElement:function(){if(this.el)this.setElement(_.result(this,"el"),!1);else{var attrs=_.extend({},_.result(this,"attributes"));this.id&&(attrs.id=_.result(this,"id"));this.className&&(attrs["class"]=_.result(this,"className"));var $el=Backbone.$("<"+_.result(this,"tagName")+">").attr(attrs);this.setElement($el,!1)}}});Backbone.sync=function(method,model,options){var type=methodMap[method];_.defaults(options||(options={}),{emulateHTTP:Backbone.emulateHTTP,emulateJSON:Backbone.emulateJSON});var params={type:type,dataType:"json"};options.url||(params.url=_.result(model,"url")||urlError());if(null==options.data&&model&&("create"===method||"update"===method||"patch"===method)){params.contentType="application/json";params.data=JSON.stringify(options.attrs||model.toJSON(options))}if(options.emulateJSON){params.contentType="application/x-www-form-urlencoded";params.data=params.data?{model:params.data}:{}}if(options.emulateHTTP&&("PUT"===type||"DELETE"===type||"PATCH"===type)){params.type="POST";options.emulateJSON&&(params.data._method=type);var beforeSend=options.beforeSend;options.beforeSend=function(xhr){xhr.setRequestHeader("X-HTTP-Method-Override",type);return beforeSend?beforeSend.apply(this,arguments):void 0}}"GET"===params.type||options.emulateJSON||(params.processData=!1);"PATCH"===params.type&&noXhrPatch&&(params.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var xhr=options.xhr=Backbone.ajax(_.extend(params,options));model.trigger("request",model,xhr,options);return xhr};var noXhrPatch=!("undefined"==typeof window||!window.ActiveXObject||window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent),methodMap={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};Backbone.ajax=function(){return Backbone.$.ajax.apply(Backbone.$,arguments)};var Router=Backbone.Router=function(options){options||(options={});options.routes&&(this.routes=options.routes);this._bindRoutes();this.initialize.apply(this,arguments)},optionalParam=/\((.*?)\)/g,namedParam=/(\(\?)?:\w+/g,splatParam=/\*\w+/g,escapeRegExp=/[\-{}\[\]+?.,\\\^$|#\s]/g;_.extend(Router.prototype,Events,{initialize:function(){},route:function(route,name,callback){_.isRegExp(route)||(route=this._routeToRegExp(route));if(_.isFunction(name)){callback=name;name=""}callback||(callback=this[name]);var router=this;Backbone.history.route(route,function(fragment){var args=router._extractParameters(route,fragment);callback&&callback.apply(router,args);router.trigger.apply(router,["route:"+name].concat(args));router.trigger("route",name,args);Backbone.history.trigger("route",router,name,args)});return this},navigate:function(fragment,options){Backbone.history.navigate(fragment,options);return this},_bindRoutes:function(){if(this.routes){this.routes=_.result(this,"routes");for(var route,routes=_.keys(this.routes);null!=(route=routes.pop());)this.route(route,this.routes[route])}},_routeToRegExp:function(route){route=route.replace(escapeRegExp,"\\$&").replace(optionalParam,"(?:$1)?").replace(namedParam,function(match,optional){return optional?match:"([^/]+)"}).replace(splatParam,"(.*?)");return new RegExp("^"+route+"$")},_extractParameters:function(route,fragment){var params=route.exec(fragment).slice(1);return _.map(params,function(param){return param?decodeURIComponent(param):null})}});var History=Backbone.History=function(){this.handlers=[];_.bindAll(this,"checkUrl");if("undefined"!=typeof window){this.location=window.location;this.history=window.history}},routeStripper=/^[#\/]|\s+$/g,rootStripper=/^\/+|\/+$/g,isExplorer=/msie [\w.]+/,trailingSlash=/\/$/,pathStripper=/[?#].*$/;History.started=!1;_.extend(History.prototype,Events,{interval:50,getHash:function(window){var match=(window||this).location.href.match(/#(.*)$/);return match?match[1]:""},getFragment:function(fragment,forcePushState){if(null==fragment)if(this._hasPushState||!this._wantsHashChange||forcePushState){fragment=this.location.pathname;var root=this.root.replace(trailingSlash,"");fragment.indexOf(root)||(fragment=fragment.slice(root.length))}else fragment=this.getHash();return fragment.replace(routeStripper,"")},start:function(options){if(History.started)throw new Error("Backbone.history has already been started");History.started=!0;this.options=_.extend({root:"/"},this.options,options);this.root=this.options.root;this._wantsHashChange=this.options.hashChange!==!1;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var fragment=this.getFragment(),docMode=document.documentMode,oldIE=isExplorer.exec(navigator.userAgent.toLowerCase())&&(!docMode||7>=docMode);this.root=("/"+this.root+"/").replace(rootStripper,"/");if(oldIE&&this._wantsHashChange){this.iframe=Backbone.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow;this.navigate(fragment)}this._hasPushState?Backbone.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!oldIE?Backbone.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval));this.fragment=fragment;var loc=this.location,atRoot=loc.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!atRoot){this.fragment=this.getFragment(null,!0);
this.location.replace(this.root+this.location.search+"#"+this.fragment);return!0}if(this._hasPushState&&atRoot&&loc.hash){this.fragment=this.getHash().replace(routeStripper,"");this.history.replaceState({},document.title,this.root+this.fragment+loc.search)}}return this.options.silent?void 0:this.loadUrl()},stop:function(){Backbone.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl);clearInterval(this._checkUrlInterval);History.started=!1},route:function(route,callback){this.handlers.unshift({route:route,callback:callback})},checkUrl:function(){var current=this.getFragment();current===this.fragment&&this.iframe&&(current=this.getFragment(this.getHash(this.iframe)));if(current===this.fragment)return!1;this.iframe&&this.navigate(current);this.loadUrl()},loadUrl:function(fragment){fragment=this.fragment=this.getFragment(fragment);return _.any(this.handlers,function(handler){if(handler.route.test(fragment)){handler.callback(fragment);return!0}})},navigate:function(fragment,options){if(!History.started)return!1;options&&options!==!0||(options={trigger:!!options});var url=this.root+(fragment=this.getFragment(fragment||""));fragment=fragment.replace(pathStripper,"");if(this.fragment!==fragment){this.fragment=fragment;""===fragment&&"/"!==url&&(url=url.slice(0,-1));if(this._hasPushState)this.history[options.replace?"replaceState":"pushState"]({},document.title,url);else{if(!this._wantsHashChange)return this.location.assign(url);this._updateHash(this.location,fragment,options.replace);if(this.iframe&&fragment!==this.getFragment(this.getHash(this.iframe))){options.replace||this.iframe.document.open().close();this._updateHash(this.iframe.location,fragment,options.replace)}}return options.trigger?this.loadUrl(fragment):void 0}},_updateHash:function(location,fragment,replace){if(replace){var href=location.href.replace(/(javascript:|#).*$/,"");location.replace(href+"#"+fragment)}else location.hash="#"+fragment}});Backbone.history=new History;var extend=function(protoProps,staticProps){var child,parent=this;child=protoProps&&_.has(protoProps,"constructor")?protoProps.constructor:function(){return parent.apply(this,arguments)};_.extend(child,parent,staticProps);var Surrogate=function(){this.constructor=child};Surrogate.prototype=parent.prototype;child.prototype=new Surrogate;protoProps&&_.extend(child.prototype,protoProps);child.__super__=parent.prototype;return child};Model.extend=Collection.extend=Router.extend=View.extend=History.extend=extend;var urlError=function(){throw new Error('A "url" property or function must be specified')},wrapError=function(model,options){var error=options.error;options.error=function(resp){error&&error(model,resp,options);model.trigger("error",model,resp,options)}}}).call(this);define("backbone",["jquery","underscore"],function(global){return function(){var ret,fn;fn=function($,_){_.noConflict();this.Backbone.hasOwnProperty("setDomLibrary")?this.Backbone.setDomLibrary($):this.Backbone.$=$;return this.Backbone.noConflict()};ret=fn.apply(global,arguments);return ret||global.Backbone}}(this));define("util/console_dev",[],function(){function bind(fn,context){return function(){fn.apply(context,arguments)}}var i,orig=window.console,console=orig,CONSOLE_METHODS=["log","trace","error","warn","info","debug"],EMPTY=function(){};try{console.DEBUG_ENABLED=!0}catch(e){console={DEBUG_ENABLED:!0}}for(i=0;i<CONSOLE_METHODS.length;i++){var fn=CONSOLE_METHODS[i];"function"!=typeof console[fn]&&(console[fn]=void 0!==orig&&"function"==typeof orig[fn]?bind(orig[fn],orig):EMPTY)}return console});Splunk.namespace("Splunk.Logger");Splunk.Logger.getLogger=function(fileName,mode){var self;mode=mode||Splunk.Logger.mode.Default;try{self=new mode(fileName)}catch(err){self=this;throw new Error("Splunk.Logger mode is undefined, not callable or thrown an exception. mode="+mode+" and fileName="+fileName+". Check to make sure the mode you are defining exist (see: web.conf js_logger_mode) and is a proper closure. Stack trace:"+err)}return self};Splunk.Logger.hasFirebug=function(){return"undefined"!=typeof console&&console.firebug?!0:!1};Splunk.Logger.hasConsole=function(){return"undefined"!=typeof console?!0:!1};Splunk.Logger.mode={};Splunk.Logger.mode.None=function(){var self=this;self.info=self.log=self.debug=self.warn=self.error=self.trace=function(){}};Splunk.Logger.mode.Firebug=function(fileName){var self=this,generateArguments=function(args){for(var arr=[],i=0;i<args.length;i++)arr.push(args[i]);arr.push(fileName);return arr},bindConsole=function(args,method){args=generateArguments(args);if(Splunk.Logger.hasConsole()){method=console[method]||console.info||function(){};method.apply?method.apply(console,args):method(args.join(" "))}};if(Splunk.Logger.hasFirebug()&&"1.3.0"!=console.firebug){self.log=console.log;self.info=console.info;self.debug=console.debug;self.warn=console.warn;self.error=console.error;self.trace=console.trace}else{self.info=function(){bindConsole(arguments,"info")};self.log=function(){bindConsole(arguments,"log")};self.debug=function(){bindConsole(arguments,"debug")};self.warn=function(){bindConsole(arguments,"warn")};self.error=function(){bindConsole(arguments,"error")};self.trace=function(){bindConsole(arguments,"trace")}}};Splunk.Logger.mode.Server=function(fileName){var self=this,buffer=Splunk.Logger.mode.Server.Buffer.getInstance(),bufferPush=function(args,level){args=args||[];for(var i=0;i<args.length;i++)if("object"==typeof args[i])try{args[i]=JSON.stringify(args[i])}catch(e){}var message=Array.apply(null,args).join(" "),data={level:level,"class":fileName,message:message};buffer.push(data)};self.info=function(){bufferPush(arguments,"info")};self.log=function(){bufferPush(arguments,"log")};self.debug=function(){bufferPush(arguments,"debug")};self.warn=function(){bufferPush(arguments,"warn")};self.error=function(){bufferPush(arguments,"error")};self.trace=function(){var trace="";try{var err=new Error;trace=err.stack.replace(/^Error/,"")}catch(e){}trace&&bufferPush([trace],"debug")}};Splunk.Logger.mode.Server.Buffer=function(){var thread,self=this,buffer=[],serverPost=function(){var data=JSON.stringify(buffer);$.post(Splunk.Logger.mode.Server.END_POINT,{data:data})},purge=function(){serverPost();buffer=[]},check=function(){buffer.length>Splunk.Logger.mode.Server.MAX_BUFFER&&purge()};self.push=function(str){buffer.push(str);check()};self.poller=function(){buffer.length>0&&purge()};self.size=function(){return buffer.length};self.Buffer=function(){thread=setInterval(self.poller,Splunk.Logger.mode.Server.POLL_BUFFER)}()};Splunk.Logger.mode.Server.Buffer.instance=null;Splunk.Logger.mode.Server.Buffer.getInstance=function(){null==Splunk.Logger.mode.Server.Buffer.instance&&(Splunk.Logger.mode.Server.Buffer.instance=new Splunk.Logger.mode.Server.Buffer);return Splunk.Logger.mode.Server.Buffer.instance};Splunk.Logger.mode.Server.END_POINT=Splunk.util.make_url(Splunk.util.getConfigValue("JS_LOGGER_MODE_SERVER_END_POINT","util/log/js"));Splunk.Logger.mode.Server.POLL_BUFFER=Splunk.util.getConfigValue("JS_LOGGER_MODE_SERVER_POLL_BUFFER",1e3);Splunk.Logger.mode.Server.MAX_BUFFER=Splunk.util.getConfigValue("JS_LOGGER_MODE_SERVER_MAX_BUFFER",100);Splunk.Logger.mode.Default=Splunk.Logger.mode[Splunk.util.getConfigValue("JS_LOGGER_MODE","None")];Splunk.log=function(msg,category,src){Splunk.Logger.getLogger("logger.js").warn("WARNING! Splunk.log is now deprecated. See Splunk.Logger class for more details.","Original Message:",msg," Original Category:",category,"Original Source:",src)};var D={};D.logger=Splunk.Logger.getLogger("logger.js");D.wrapper=function(str,level){D.logger.warn("WARNING! D.",level,"is now deprecated. See Splunk.Logger class for more details.",str)};D.debug=function(str){D.wrapper(str,"debug")};D.error=function(str){D.wrapper(str,"error")};D.warn=function(str){D.wrapper(str,"warn")};Splunk.util.logger=Splunk.Logger.getLogger("util.js");define("splunk.logger",["splunk","splunk.util"],function(global){return function(){var ret;return ret||global.Splunk.Logger}}(this));define("util/console",["jquery","underscore","util/console_dev","splunk.logger","splunk.util"],function($,_,devConsole,SplunkLogger,splunkUtils){var LOG_MODE=splunkUtils.getConfigValue("JS_LOGGER_MODE","None"),LOG_LEVEL=splunkUtils.getConfigValue("JS_LOGGER_LEVEL","INFO"),EMPTY=function(){};return"Firebug"===LOG_MODE?"function"==typeof devConsole.log.bind&&devConsole.log.bind.toString().indexOf("native code")>-1?{trace:"DEBUG"===LOG_LEVEL?devConsole.trace.bind(devConsole):EMPTY,debug:"DEBUG"===LOG_LEVEL?devConsole.debug.bind(devConsole):EMPTY,log:LOG_LEVEL in{INFO:!0,DEBUG:!0}?devConsole.log.bind(devConsole):EMPTY,info:LOG_LEVEL in{INFO:!0,DEBUG:!0}?devConsole.info.bind(devConsole):EMPTY,warn:"ERROR"!==LOG_LEVEL?devConsole.warn.bind(devConsole):EMPTY,error:devConsole.error.bind(devConsole)}:devConsole:SplunkLogger.getLogger(splunkUtils.getConfigValue("USERNAME","")+":::"+window.location.href)});!function($){var undef,decode=decodeURIComponent,deparam=$.deparam=function(text,reviver){var result={};$.each(text.replace(/\+/g," ").split("&"),function(index,pair){var kv=pair.split("="),key=decode(kv[0]);if(key){var value=decode(kv[1]||""),keys=key.split("]["),last=keys.length-1,i=0,current=result;if(keys[0].indexOf("[")>=0&&/\]$/.test(keys[last])){keys[last]=keys[last].replace(/\]$/,"");keys=keys.shift().split("[").concat(keys);last++}else last=0;$.isFunction(reviver)?value=reviver(key,value):reviver&&(value=deparam.reviver(key,value));if(last)for(;last>=i;i++){key=""!==keys[i]?keys[i]:current.length;last>i?current=current[key]=current[key]||(isNaN(keys[i+1])?{}:[]):current[key]=value}else $.isArray(result[key])?result[key].push(value):result[key]=key in result?[result[key],value]:value}});return result};deparam.reviver=function(key,value){var specials={"true":!0,"false":!1,"null":null,undefined:undef};return+value+""===value?+value:value in specials?specials[value]:value}}(jQuery);define("splunkjs/contrib/jquery.deparam",function(){});define("splunkjs/mvc/protections",["require","exports","module","splunk.util"],function(require){function enableCSRFProtection($){function csrfSafeMethod(method){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(method)}var djangoPort=splunkUtils.getConfigValue("DJANGO_PORT_NUMBER",null),splunkwebPort=splunkUtils.getConfigValue("MRSPARKLE_PORT_NUMBER"),portNumber=djangoPort||splunkwebPort,cookieName="django_csrftoken_"+portNumber,djangoCookie=splunkUtils.getCookie(cookieName),splunkwebCookie=splunkUtils.getFormKey();$.ajaxPrefilter(function(options,originalOptions,xhr){options.hasOwnProperty("crossDomain")||(options.crossDomain=!1);var type=options["type"]||"";if(!csrfSafeMethod(type)){djangoCookie&&xhr.setRequestHeader("X-CSRFToken",djangoCookie);splunkwebCookie&&xhr.setRequestHeader("X-Splunk-Form-Key",splunkwebCookie)}})}function enableUnauthorizationRedirection($,loginURL,logoutURL){$(document).bind("ajaxError",function(ev,xhr){var pathname=window.location.pathname;if(401===xhr.status&&-1===pathname.indexOf(logoutURL)){var returnTo=encodeURIComponent(pathname+document.location.search);document.location=loginURL+"?return_to="+returnTo}})}var splunkUtils=require("splunk.util");return{enableCSRFProtection:enableCSRFProtection,enableUnauthorizationRedirection:enableUnauthorizationRedirection}});define("splunkjs/mvc/basetokenmodel",["require","exports","module","backbone"],function(require,exports,module){var Backbone=require("backbone"),BaseTokenModel=Backbone.Model.extend({moduleId:module.id});return BaseTokenModel});define("splunkjs/mvc/registry",["require","exports","module","underscore","backbone","util/console","./basetokenmodel"],function(require){var _=require("underscore"),Backbone=require("backbone"),console=require("util/console"),BaseTokenModel=require("./basetokenmodel"),Registry=Backbone.Model.extend({initialize:function(){this.registerInstance("default",this._createTokenModel("default"))},createError:function(message){return message},registerInstance:function(id,component,options){options=options||{};if(!id)throw new Error("You must pass in an ID when registering an instance.");if(this.has(id)&&!options.replace)throw new Error(this.createError("Already have instance with id: "+id));this.set(id,component,options);return component},revokeInstance:function(id,options){this.unset(id,options)},hasInstance:function(id){return this.has(id)},getInstance:function(id,options){options=options||{};this.has(id)||(options.create?this.registerInstance(id,this._createTokenModel(id)):console.error(this.createError("No instance with id: "+id)));return this.get(id)},getInstances:function(){return _.values(this.attributes)},getInstanceNames:function(){return _.keys(this.attributes)},_createTokenModel:function(id){var namespaceModel=new BaseTokenModel;namespaceModel.id=id;return namespaceModel}});return Registry});define("splunkjs/generated/urlresolver",["require","exports","module"],function(){var reverse=function(){throw new Error("Path reverse is not supported in this configuration of the framework.")};return{reverse:reverse}});!function(){var __exportName="splunkjs",require=function(file,cwd){var resolved=require.resolve(file,cwd||"/"),mod=require.modules[resolved];if(!mod)throw new Error("Failed to resolve module "+file+", tried "+resolved);var res=mod._cached?mod._cached:mod();return res};require.paths=[];require.modules={};require.extensions=[".js",".coffee"];require._core={assert:!0,events:!0,fs:!0,path:!0,vm:!0};require.resolve=function(){return function(x,cwd){function loadAsFileSync(x){if(require.modules[x])return x;for(var i=0;i<require.extensions.length;i++){var ext=require.extensions[i];if(require.modules[x+ext])return x+ext}}function loadAsDirectorySync(x){x=x.replace(/\/+$/,"");var pkgfile=x+"/package.json";if(require.modules[pkgfile]){var pkg=require.modules[pkgfile](),b=pkg.browserify;if("object"==typeof b&&b.main){var m=loadAsFileSync(path.resolve(x,b.main));if(m)return m}else if("string"==typeof b){var m=loadAsFileSync(path.resolve(x,b));if(m)return m}else if(pkg.main){var m=loadAsFileSync(path.resolve(x,pkg.main));if(m)return m}}return loadAsFileSync(x+"/index")}function loadNodeModulesSync(x,start){for(var dirs=nodeModulesPathsSync(start),i=0;i<dirs.length;i++){var dir=dirs[i],m=loadAsFileSync(dir+"/"+x);if(m)return m;var n=loadAsDirectorySync(dir+"/"+x);if(n)return n}var m=loadAsFileSync(x);return m?m:void 0}function nodeModulesPathsSync(start){var parts;parts="/"===start?[""]:path.normalize(start).split("/");for(var dirs=[],i=parts.length-1;i>=0;i--)if("node_modules"!==parts[i]){var dir=parts.slice(0,i+1).join("/")+"/node_modules";dirs.push(dir)}return dirs}cwd||(cwd="/");if(require._core[x])return x;var path=require.modules.path();cwd=path.resolve("/",cwd);var y=cwd||"/";if(x.match(/^(?:\.\.?\/|\/)/)){var m=loadAsFileSync(path.resolve(y,x))||loadAsDirectorySync(path.resolve(y,x));if(m)return m}var n=loadNodeModulesSync(x,y);if(n)return n;throw new Error("Cannot find module '"+x+"'")}}();require.alias=function(from,to){var path=require.modules.path(),res=null;try{res=require.resolve(from+"/package.json","/")}catch(err){res=require.resolve(from,"/")}for(var basedir=path.dirname(res),keys=(Object.keys||function(obj){var res=[];for(var key in obj)res.push(key);return res})(require.modules),i=0;i<keys.length;i++){var key=keys[i];if(key.slice(0,basedir.length+1)===basedir+"/"){var f=key.slice(basedir.length);require.modules[to+f]=require.modules[basedir+f]}else key===basedir&&(require.modules[to]=require.modules[basedir])}};require.define=function(filename,fn){var dirname=require._core[filename]?"":require.modules.path().dirname(filename),require_=function(file){return require(file,dirname)};require_.resolve=function(name){return require.resolve(name,dirname)};require_.modules=require.modules;require_.define=require.define;var module_={exports:{}};require.modules[filename]=function(){require.modules[filename]._cached=module_.exports;fn.call(module_.exports,require_,module_,module_.exports,dirname,filename);require.modules[filename]._cached=module_.exports;return module_.exports}};"undefined"==typeof process&&(process={});process.nextTick||(process.nextTick=function(){var queue=[],canPost="undefined"!=typeof window&&window.postMessage&&window.addEventListener;canPost&&window.addEventListener("message",function(ev){if(ev.source===window&&"browserify-tick"===ev.data){ev.stopPropagation();if(queue.length>0){var fn=queue.shift();fn()}}},!0);return function(fn){if(canPost){queue.push(fn);window.postMessage("browserify-tick","*")}else setTimeout(fn,0)}}());process.title||(process.title="browser");process.binding||(process.binding=function(name){if("evals"===name)return require("vm");throw new Error("No such module")});process.cwd||(process.cwd=function(){return"."});require.define("path",function(require,module,exports){function filter(xs,fn){for(var res=[],i=0;i<xs.length;i++)fn(xs[i],i,xs)&&res.push(xs[i]);return res}function normalizeArray(parts,allowAboveRoot){for(var up=0,i=parts.length;i>=0;i--){var last=parts[i];if("."==last)parts.splice(i,1);else if(".."===last){parts.splice(i,1);up++}else if(up){parts.splice(i,1);up--}}if(allowAboveRoot)for(;up--;up)parts.unshift("..");return parts}var splitPathRe=/^(.+\/(?!$)|\/)?((?:.+?)?(\.[^.]*)?)$/;exports.resolve=function(){for(var resolvedPath="",resolvedAbsolute=!1,i=arguments.length;i>=-1&&!resolvedAbsolute;i--){var path=i>=0?arguments[i]:process.cwd();if("string"==typeof path&&path){resolvedPath=path+"/"+resolvedPath;resolvedAbsolute="/"===path.charAt(0)}}resolvedPath=normalizeArray(filter(resolvedPath.split("/"),function(p){return!!p}),!resolvedAbsolute).join("/");return(resolvedAbsolute?"/":"")+resolvedPath||"."};exports.normalize=function(path){var isAbsolute="/"===path.charAt(0),trailingSlash="/"===path.slice(-1);path=normalizeArray(filter(path.split("/"),function(p){return!!p}),!isAbsolute).join("/");path||isAbsolute||(path=".");path&&trailingSlash&&(path+="/");return(isAbsolute?"/":"")+path};exports.join=function(){var paths=Array.prototype.slice.call(arguments,0);return exports.normalize(filter(paths,function(p){return p&&"string"==typeof p}).join("/"))};exports.dirname=function(path){var dir=splitPathRe.exec(path)[1]||"",isWindows=!1;return dir?1===dir.length||isWindows&&dir.length<=3&&":"===dir.charAt(1)?dir:dir.substring(0,dir.length-1):"."};exports.basename=function(path,ext){var f=splitPathRe.exec(path)[2]||"";ext&&f.substr(-1*ext.length)===ext&&(f=f.substr(0,f.length-ext.length));return f};exports.extname=function(path){return splitPathRe.exec(path)[3]||""}});require.define("/package.json",function(require,module){module.exports={main:"index.js"}});require.define("/index.js",function(require,module,exports){!function(){var root=exports||this;process.env=process.env||{};module.exports=root={Logger:require("./lib/log").Logger,Context:require("./lib/context"),Service:require("./lib/service"),Http:require("./lib/http"),Utils:require("./lib/utils"),Async:require("./lib/async"),Paths:require("./lib/paths").Paths,Class:require("./lib/jquery.class").Class};"undefined"==typeof window&&(root.NodeHttp=require("./lib/platform/node/node_http").NodeHttp)}()});require.define("/lib/log.js",function(require,module,exports){!function(){var utils=require("./utils"),levels={ALL:4,INFO:3,WARN:2,ERROR:1,NONE:0},setLevel=function(level){process.env.LOG_LEVEL=utils.isString(level)&&levels.hasOwnProperty(level)?levels[level]:!isNaN(parseInt(level,10))&&utils.keyOf(parseInt(level,10),levels)?level:levels["ERROR"]};process.env.LOG_LEVEL?setLevel(process.env.LOG_LEVEL):process.env.LOG_LEVEL=levels["ERROR"];var _log,_warn,_error,_info;_log=_warn=_error=_info=function(){};if("undefined"!=typeof console){var logAs=function(level){return function(str){try{console[level].apply(console,arguments)}catch(ex){console[level](str)}}};console.log&&(_log=logAs("log"));console.error&&(_error=logAs("error"));console.warn&&(_warn=logAs("warn"));console.info&&(_info=logAs("info"))}exports.Logger={log:function(){process.env.LOG_LEVEL>=levels.ALL&&_log.apply(null,arguments)},error:function(){process.env.LOG_LEVEL>=levels.ERROR&&_error.apply(null,arguments)},warn:function(){process.env.LOG_LEVEL>=levels.WARN&&_warn.apply(null,arguments)},info:function(){process.env.LOG_LEVEL>=levels.INFO&&_info.apply(null,arguments)},printMessages:function(allMessages){allMessages=allMessages||[];for(var i=0;i<allMessages.length;i++){var message=allMessages[i],type=message["type"],text=message["text"],msg="[SPLUNKD] "+text;switch(type){case"HTTP":case"FATAL":case"ERROR":this.error(msg);break;case"WARN":this.warn(msg);break;case"INFO":this.info(msg);break;case"HTTP":this.error(msg);break;default:this.info(msg)}}},setLevel:function(){setLevel.apply(this,arguments)},levels:levels}}()});require.define("/lib/utils.js",function(require,module,exports){!function(){var root=exports||this;root.bind=function(me,fn){return function(){return fn.apply(me,arguments)}};root.trim=function(str){str=str||"";return String.prototype.trim?String.prototype.trim.call(str):str.replace(/^\s\s*/,"").replace(/\s\s*$/,"")};root.indexOf=function(arr,search){for(var i=0;i<arr.length;i++)if(arr[i]===search)return i;return-1};root.contains=function(arr,obj){arr=arr||[];return root.indexOf(arr,obj)>=0};root.startsWith=function(original,prefix){var matches=original.match("^"+prefix);return matches&&matches.length>0&&matches[0]===prefix};root.endsWith=function(original,suffix){var matches=original.match(suffix+"$");return matches&&matches.length>0&&matches[0]===suffix};var toString=Object.prototype.toString;root.toArray=function(iterable){return Array.prototype.slice.call(iterable)};root.isArray=Array.isArray||function(obj){return"[object Array]"===toString.call(obj)};root.isFunction=function(obj){return!!(obj&&obj.constructor&&obj.call&&obj.apply)};root.isNumber=function(obj){return!!(0===obj||obj&&obj.toExponential&&obj.toFixed)};root.isString=function(obj){return!!(""===obj||obj&&obj.charCodeAt&&obj.substr)};root.isObject=function(obj){return obj===Object(obj)};root.isEmpty=function(obj){if(root.isArray(obj)||root.isString(obj))return 0===obj.length;for(var key in obj)if(this.hasOwnProperty.call(obj,key))return!1;return!0};root.forEach=function(obj,iterator,context){if(null!==obj)if(Array.prototype.forEach&&obj.forEach===Array.prototype.forEach)obj.forEach(iterator,context);else if(obj.length===+obj.length){for(var i=0,l=obj.length;l>i;i++)if(i in obj&&iterator.call(context,obj[i],i,obj)==={})return}else for(var key in obj)if(obj.hasOwnProperty(key)&&iterator.call(context,obj[key],key,obj)==={})return};root.extend=function(obj){root.forEach(Array.prototype.slice.call(arguments,1),function(source){for(var prop in source)obj[prop]=source[prop]});return obj};root.clone=function(obj){return root.isObject(obj)?root.isArray(obj)?obj.slice():root.extend({},obj):obj};root.namespaceFromProperties=function(props){return{owner:props.acl.owner,app:props.acl.app,sharing:props.acl.sharing}};root.keyOf=function(val,obj){for(var k in obj)if(obj.hasOwnProperty(k)&&obj[k]===val)return k;return void 0};root.getWithVersion=function(version,map){map=map||{};for(var currentVersion=version+""||"";""!==currentVersion;){if(map.hasOwnProperty(currentVersion))return map[currentVersion];currentVersion=currentVersion.slice(0,currentVersion.lastIndexOf("."))}return map["default"]}}()});require.define("/lib/context.js",function(require,module,exports){!function(){var Paths=require("./paths").Paths,Class=require("./jquery.class").Class,Http=require("./http"),utils=require("./utils"),root=exports||this,prefixMap={5:"",4.3:"/services/json/v2","default":""};module.exports=root=Class.extend({init:function(http,params){if(!(http instanceof Http||params)){params=http;http=null}params=params||{};this.scheme=params.scheme||"https";this.host=params.host||"localhost";this.port=params.port||8089;this.username=params.username||null;this.password=params.password||null;this.owner=params.owner;this.app=params.app;this.sessionKey=params.sessionKey||"";this.authorization=params.authorization||"Splunk";this.paths=params.paths||Paths;this.version=params.version||"default";this.autologin=!0;params.hasOwnProperty("autologin")&&(this.autologin=params.autologin);if(!http){if("undefined"!=typeof window)throw new Error("Http instance required when creating a Context within a browser.");var NodeHttp=require("./platform/node/node_http").NodeHttp;http=new NodeHttp}this.http=http;this.http._setSplunkVersion(this.version);var versionPrefix=utils.getWithVersion(this.version,prefixMap);this.prefix=this.scheme+"://"+this.host+":"+this.port+versionPrefix;this._headers=utils.bind(this,this._headers);this.fullpath=utils.bind(this,this.fullpath);this.urlify=utils.bind(this,this.urlify);this.get=utils.bind(this,this.get);this.del=utils.bind(this,this.del);this.post=utils.bind(this,this.post);this.login=utils.bind(this,this.login);this._shouldAutoLogin=utils.bind(this,this._shouldAutoLogin);this._requestWrapper=utils.bind(this,this._requestWrapper)},_headers:function(headers){headers=headers||{};""!=this.sessionKey&&(headers["Authorization"]=this.authorization+" "+this.sessionKey);return headers},_shouldAutoLogin:function(){return this.username&&this.password&&this.autologin},_requestWrapper:function(task,callback){callback=callback||function(){};var that=this,req=null,reloginIfNecessary=function(err){if(!req.wasAborted)if(err&&401===err.status&&that._shouldAutoLogin()){that.sessionKey=null;that.login(function(err){req.wasAborted||(err?callback(err):task(callback))})}else callback.apply(null,arguments)};if(!this._shouldAutoLogin()||this.sessionKey){req=task(reloginIfNecessary);return req}req=this.login(function(err){req.wasAborted||(err?callback(err):task(callback))});return req},fullpath:function(path,namespace){namespace=namespace||{};if(utils.startsWith(path,"/"))return path;if(!namespace.app&&!this.app&&namespace.sharing!==root.Sharing.SYSTEM)return"/services/"+path;var owner=namespace.owner||this.owner||"-",app=namespace.app||this.app||"-";namespace.sharing=(namespace.sharing||"").toLowerCase();if(namespace.sharing===root.Sharing.APP||namespace.sharing===root.Sharing.GLOBAL)owner="nobody";else if(namespace.sharing===root.Sharing.SYSTEM){owner="nobody";app="system"}return utils.trim("/servicesNS/"+owner+"/"+app+"/"+path)},urlify:function(path){return this.prefix+this.fullpath(path)},login:function(callback){var that=this,url=this.paths.login,params={username:this.username,password:this.password};callback=callback||function(){};var wrappedCallback=function(err,response){var hasSessionKey=!(err||!response.data||!response.data.sessionKey);if(err||!hasSessionKey)callback(err||"No session key available",!1);else{that.sessionKey=response.data.sessionKey;callback(null,!0)}};return this.http.post(this.urlify(url),this._headers(),params,0,wrappedCallback)},get:function(path,params,callback){var that=this,request=function(callback){return that.http.get(that.urlify(path),that._headers(),params,0,callback)};return this._requestWrapper(request,callback)},del:function(path,params,callback){var that=this,request=function(callback){return that.http.del(that.urlify(path),that._headers(),params,0,callback)};return this._requestWrapper(request,callback)},post:function(path,params,callback){var that=this,request=function(callback){return that.http.post(that.urlify(path),that._headers(),params,0,callback)};return this._requestWrapper(request,callback)},request:function(path,method,query,post,body,headers,callback){var that=this,request=function(callback){return that.http.request(that.urlify(path),{method:method,headers:that._headers(headers),query:query,post:post,body:body,timeout:0},callback)};return this._requestWrapper(request,callback)},versionCompare:function(otherVersion){var thisVersion=this.version;"default"===thisVersion&&(thisVersion="5.0");for(var components1=thisVersion.split("."),components2=otherVersion.split("."),numComponents=Math.max(components1.length,components2.length),i=0;numComponents>i;i++){var c1=i<components1.length?parseInt(components1[i],10):0,c2=i<components2.length?parseInt(components2[i],10):0;if(c2>c1)return-1;if(c1>c2)return 1}return 0}});root.Sharing={USER:"user",APP:"app",GLOBAL:"global",SYSTEM:"system"}}()});require.define("/lib/paths.js",function(require,module,exports){!function(){var root=exports||this;root.Paths={apps:"/services/apps/local",capabilities:"authorization/capabilities",configurations:"configs",deploymentClient:"deployment/client",deploymentServers:"deployment/server",deploymentServerClasses:"deployment/serverclass",deploymentTenants:"deployment/tenants",eventTypes:"saved/eventtypes",indexes:"data/indexes",info:"/services/server/info",inputs:null,jobs:"search/jobs",licenseGroups:"licenser/groups",licenseMessages:"licenser/messages",licensePools:"licenser/pools",licenseSlaves:"licenser/slaves",licenseStacks:"licenser/stacks",licenses:"licenser/licenses",loggers:"server/logger",login:"/services/auth/login",messages:"messages",passwords:"admin/passwords",parser:"search/parser",properties:"properties",roles:"authorization/roles",savedSearches:"saved/searches",settings:"server/settings",users:"/services/authentication/users",typeahead:"search/typeahead",views:"data/ui/views",currentUser:"/services/authentication/current-context",submitEvent:"/services/receivers/simple"}}()});require.define("/lib/jquery.class.js",function(require,module,exports){!function(){var root=exports||this,initializing=!1,fnTest=/xyz/.test(function(){return xyz})?/\b_super\b/:/.*/;root.Class=function(){};root.Class.extend=function(prop){function Class(){!initializing&&this.init&&this.init.apply(this,arguments)}var _super=this.prototype;initializing=!0;var prototype=new this;initializing=!1;for(var name in prop)prototype[name]="function"==typeof prop[name]&&"function"==typeof _super[name]&&fnTest.test(prop[name])?function(name,fn){return function(){var tmp=this._super;this._super=_super[name];var ret=fn.apply(this,arguments);this._super=tmp;return ret}}(name,prop[name]):prop[name];Class.prototype=prototype;Class.constructor=Class;Class.extend=arguments.callee;return Class}}()});require.define("/lib/http.js",function(require,module,exports){!function(){var Class=require("./jquery.class").Class,logger=require("./log").Logger,utils=require("./utils"),root=exports||this,Http=null,queryBuilderMap={5:function(message){var query=message.query||{},post=message.post||{},outputMode=query.output_mode||post.output_mode||"json";utils.startsWith(outputMode,"json")||(outputMode="json");query.output_mode=outputMode;return query},4:function(message){return message.query||{}},"default":function(message){return queryBuilderMap["5"](message)},none:function(message){return message.query||{}}};module.exports=root=Http=Class.extend({init:function(){this.get=utils.bind(this,this.get);this.del=utils.bind(this,this.del);this.post=utils.bind(this,this.post);this.request=utils.bind(this,this.request);this._buildResponse=utils.bind(this,this._buildResponse);this._setSplunkVersion("none")},_setSplunkVersion:function(version){this.version=version},get:function(url,headers,params,timeout,callback){var message={method:"GET",headers:headers,timeout:timeout,query:params};return this.request(url,message,callback)},post:function(url,headers,params,timeout,callback){headers["Content-Type"]="application/x-www-form-urlencoded";var message={method:"POST",headers:headers,timeout:timeout,post:params};return this.request(url,message,callback)},del:function(url,headers,params,timeout,callback){var message={method:"DELETE",headers:headers,timeout:timeout,query:params};return this.request(url,message,callback)},request:function(url,message,callback){var wrappedCallback=function(response){callback=callback||function(){};response.status<400&&"abort"!==response.status?callback(null,response):callback(response)},query=utils.getWithVersion(this.version,queryBuilderMap)(message),post=message.post||{},encodedUrl=url+"?"+Http.encode(query),body=message.body?message.body:Http.encode(post),options={method:message.method,headers:message.headers,timeout:message.timeout,body:body};
return this.makeRequest(encodedUrl,options,wrappedCallback)},makeRequest:function(){throw new Error("UNDEFINED FUNCTION - OVERRIDE REQUIRED")},parseJson:function(){throw new Error("UNDEFINED FUNCTION - OVERRIDE REQUIRED")},_buildResponse:function(error,response,data){var complete_response,json={},contentType=null;response&&response.headers&&(contentType=utils.trim(response.headers["content-type"]||response.headers["Content-Type"]));if(utils.startsWith(contentType,"application/json")&&data)try{json=this.parseJson(data)||{}}catch(e){logger.error("Error in parsing JSON:",data,e);json=data}else json=data;json&&logger.printMessages(json.messages);complete_response={response:response,status:response?response.statusCode:0,data:json,error:error};return complete_response}});Http.encode=function(params){var encodedStr="";for(var key in params)if(params.hasOwnProperty(key)){encodedStr&&"&"!==encodedStr[encodedStr.length-1]&&(encodedStr+="&");var value=params[key];if(value instanceof Array)for(var i=0;i<value.length;i++)encodedStr=encodedStr+key+"="+encodeURIComponent(value[i])+"&";else if("object"==typeof value){for(var innerKey in value)if(value.hasOwnProperty(innerKey)){{value[innerKey]}encodedStr=encodedStr+key+"="+encodeURIComponent(value[innerKey])+"&"}}else encodedStr=encodedStr+key+"="+encodeURIComponent(value)}"&"===encodedStr[encodedStr.length-1]&&(encodedStr=encodedStr.substr(0,encodedStr.length-1));return encodedStr}}()});require.define("/lib/service.js",function(require,module,exports){!function(){var Context=require("./context"),Async=(require("./http"),require("./async")),Paths=require("./paths").Paths,Class=require("./jquery.class").Class,utils=require("./utils"),root=exports||this,Service=null,BaseService=Context.extend({init:function(){this._super.apply(this,arguments)}});module.exports=root=Service=BaseService.extend({init:function(){this._super.apply(this,arguments);this.specialize=utils.bind(this,this.specialize);this.apps=utils.bind(this,this.apps);this.configurations=utils.bind(this,this.configurations);this.indexes=utils.bind(this,this.indexes);this.savedSearches=utils.bind(this,this.savedSearches);this.jobs=utils.bind(this,this.jobs);this.users=utils.bind(this,this.users);this.currentUser=utils.bind(this,this.currentUser);this.views=utils.bind(this,this.views)},specialize:function(owner,app){return new Service(this.http,{scheme:this.scheme,host:this.host,port:this.port,username:this.username,password:this.password,owner:owner,app:app,sessionKey:this.sessionKey,version:this.version})},apps:function(){return new root.Applications(this)},configurations:function(namespace){return new root.Configurations(this,namespace)},indexes:function(namespace){return new root.Indexes(this,namespace)},savedSearches:function(namespace){return new root.SavedSearches(this,namespace)},jobs:function(namespace){return new root.Jobs(this,namespace)},users:function(){return new root.Users(this)},views:function(namespace){return new root.Views(this,namespace)},search:function(query,params,namespace,callback){if(!callback&&utils.isFunction(namespace)){callback=namespace;namespace=null}var jobs=new root.Jobs(this,{},namespace);return jobs.search(query,params,callback)},oneshotSearch:function(query,params,namespace,callback){if(!callback&&utils.isFunction(namespace)){callback=namespace;namespace=null}var jobs=new root.Jobs(this,{},namespace);return jobs.oneshotSearch(query,params,callback)},currentUser:function(callback){callback=callback||function(){};var that=this,req=this.get(Paths.currentUser,{},function(err,response){if(err)callback(err);else{var username=response.data.entry[0].content.username,user=new root.User(that,username);user.fetch(function(){req.wasAborted||callback.apply(null,arguments)})}});return req},serverInfo:function(callback){callback=callback||function(){};var serverInfo=new root.ServerInfo(this);return serverInfo.fetch(callback)},parse:function(query,params,callback){if(!callback&&utils.isFunction(params)){callback=params;params={}}callback=callback||function(){};params=params||{};params.q=query;return this.get(Paths.parser,params,function(err,response){err?callback(err):callback(null,response.data)})},typeahead:function(prefix,count,callback){if(!callback&&utils.isFunction(count)){callback=count;count=10}callback=callback||function(){};var params={count:count||10,prefix:prefix};return this.get(Paths.typeahead,params,function(err,response){if(err)callback(err);else{var results=(response.data||{}).results;callback(null,results||[])}})},log:function(event,params,callback){if(!callback&&utils.isFunction(params)){callback=params;params={}}callback=callback||function(){};params=params||{};utils.isObject(event)&&(event=JSON.stringify(event));var path=this.paths.submitEvent,method="POST",headers={"Content-Type":"text/plain"},body=event,get=params,post={},req=this.request(path,method,get,post,body,headers,function(err,response){err?callback(err):callback(null,response.data)});return req}});root.Endpoint=Class.extend({init:function(service,qualifiedPath){if(!service)throw new Error("Passed in a null Service.");if(!qualifiedPath)throw new Error("Passed in an empty path.");this.service=service;this.qualifiedPath=qualifiedPath;this.get=utils.bind(this,this.get);this.post=utils.bind(this,this.post);this.del=utils.bind(this,this.del)},get:function(relpath,params,callback){var url=this.qualifiedPath;relpath&&(url=url+"/"+relpath);return this.service.get(url,params,callback)},post:function(relpath,params,callback){var url=this.qualifiedPath;relpath&&(url=url+"/"+relpath);return this.service.post(url,params,callback)},del:function(relpath,params,callback){var url=this.qualifiedPath;relpath&&(url=url+"/"+relpath);return this.service.del(url,params,callback)}});root.Resource=root.Endpoint.extend({init:function(service,path,namespace){var fullpath=service.fullpath(path,namespace);this._super(service,fullpath);this.namespace=namespace;this._properties={};this._state={};this._load=utils.bind(this,this._load);this.fetch=utils.bind(this,this.fetch);this.properties=utils.bind(this,this.properties);this.state=utils.bind(this,this.state);this.path=utils.bind(this,this.path)},path:function(){throw new Error("MUST BE OVERRIDDEN")},_load:function(properties){this._properties=properties||{};this._state=properties||{}},fetch:function(){throw new Error("MUST BE OVERRIDDEN")},properties:function(){return this._properties},state:function(){return this._state}});root.Entity=root.Resource.extend({fetchOnUpdate:!1,init:function(service,path,namespace){this._super(service,path,namespace);this._load=utils.bind(this,this._load);this.fetch=utils.bind(this,this.fetch);this.remove=utils.bind(this,this.remove);this.update=utils.bind(this,this.update);this.fields=utils.bind(this,this.fields);this.links=utils.bind(this,this.links);this.acl=utils.bind(this,this.acl);this.author=utils.bind(this,this.author);this.updated=utils.bind(this,this.updated);this.published=utils.bind(this,this.published);this.enable=utils.bind(this,this.enable);this.disable=utils.bind(this,this.disable);this.reload=utils.bind(this,this.reload);this._properties={};this._fields={};this._acl={};this._links={}},_load:function(properties){properties=utils.isArray(properties)?properties[0]:properties;properties=properties||{content:{},fields:{},acl:{},links:{}};this._super(properties);this._properties=properties.content||{};this._fields=properties.fields||this._fields||{};this._acl=properties.acl||{};this._links=properties.links||{};this._author=properties.author||null;this._updated=properties.updated||null;this._published=properties.published||null},fields:function(){return this._fields},acl:function(){return this._acl},links:function(){return this._links},author:function(){return this._author},updated:function(){return this._updated},published:function(){return this._published},fetch:function(options,callback){if(!callback&&utils.isFunction(options)){callback=options;options={}}callback=callback||function(){};options=options||{};var that=this;return this.get("",options,function(err,response){if(err)callback(err);else{that._load(response.data?response.data.entry:null);callback(null,that)}})},remove:function(callback){callback=callback||function(){};return this.del("",{},function(err){callback(err)})},update:function(props,callback){callback=callback||function(){};if(props.hasOwnProperty("name"))throw new Error("Cannot set 'name' field in 'update'");var that=this,req=this.post("",props,function(err,response){if(err||that.fetchOnUpdate)!err&&that.fetchOnUpdate?that.fetch(function(){req.wasAborted||callback.apply(null,arguments)}):callback(err,that);else{that._load(response.data.entry);callback(err,that)}});return req},disable:function(callback){callback=callback||function(){};var that=this;this.post("disable",{},function(err){err?callback(err):callback(null,that)})},enable:function(callback){callback=callback||function(){};var that=this;this.post("enable",{},function(err){err?callback(err):callback(null,that)})},reload:function(callback){callback=callback||function(){};var that=this;this.post("_reload",{},function(err){err?callback(err):callback(null,that)})}});root.Collection=root.Resource.extend({fetchOnEntityCreation:!1,init:function(service,path,namespace){this._super(service,path,namespace);this._load=utils.bind(this,this._load);this.fetch=utils.bind(this,this.fetch);this.create=utils.bind(this,this.create);this.list=utils.bind(this,this.list);this.item=utils.bind(this,this.item);this.instantiateEntity=utils.bind(this,this.instantiateEntity);this._entities=[];this._entitiesByName={};this._properties={};this._paging={};this._links={}},instantiateEntity:function(){throw new Error("MUST BE OVERRIDDEN")},_load:function(properties){this._super(properties);for(var entities=[],entitiesByName={},entityPropertyList=properties.entry||[],i=0;i<entityPropertyList.length;i++){var props=entityPropertyList[i],entity=this.instantiateEntity(props);entity._load(props);entities.push(entity);entitiesByName.hasOwnProperty(entity.name)?entitiesByName[entity.name].push(entity):entitiesByName[entity.name]=[entity]}this._entities=entities;this._entitiesByName=entitiesByName;this._paging=properties.paging||{};this._links=properties.links||{};this._updated=properties.updated||null},links:function(){return this._links},paging:function(){return this._paging},updated:function(){return this._updated},fetch:function(options,callback){if(!callback&&utils.isFunction(options)){callback=options;options={}}callback=callback||function(){};options=options||{};options.count||(options.count=0);var that=this,req=that.get("",options,function(err,response){if(err)callback(err);else{that._load(response.data);callback(null,that)}});return req},item:function(id,namespace){utils.isEmpty(namespace)&&(namespace=null);if(!id)throw new Error("Must suply a non-empty name.");var fullPath=null;if(!this._entitiesByName.hasOwnProperty(id))return null;var entities=this._entitiesByName[id];if(1===entities.length&&!namespace)return entities[0];if(1===entities.length&&namespace){fullPath=this.service.fullpath(entities[0].path(),namespace);return entities[0].qualifiedPath===fullPath?entities[0]:null}if(entities.length>1&&!namespace)throw new Error("Ambiguous match for name '"+id+"'");for(var i=0;i<entities.length;i++){var entity=entities[i];fullPath=this.service.fullpath(entities[i].path(),namespace);if(entity.qualifiedPath===fullPath)return entity}},create:function(params,callback){callback=callback||function(){};var that=this,req=this.post("",params,function(err,response){if(err)callback(err);else{var props=response.data.entry;utils.isArray(props)&&(props=props[0]);var entity=that.instantiateEntity(props);entity._load(props);that.fetchOnEntityCreation?entity.fetch(function(){req.wasAborted||callback.apply(null,arguments)}):callback(null,entity)}});return req},list:function(callback){callback=callback||function(){};return utils.clone(this._entities)}});root.SavedSearch=root.Entity.extend({path:function(){return Paths.savedSearches+"/"+encodeURIComponent(this.name)},init:function(service,name,namespace){this.name=name;this._super(service,this.path(),namespace);this.acknowledge=utils.bind(this,this.acknowledge);this.dispatch=utils.bind(this,this.dispatch);this.history=utils.bind(this,this.history);this.suppressInfo=utils.bind(this,this.suppressInfo)},acknowledge:function(callback){callback=callback||function(){};var that=this,req=this.post("acknowledge",{},function(err){callback(err,that)});return req},dispatch:function(options,callback){if(!callback&&utils.isFunction(options)){callback=options;options={}}callback=callback||function(){};options=options||{};var that=this,req=this.post("dispatch",options,function(err,response){if(err)callback(err);else{var sid=response.data.sid,job=new root.Job(that.service,sid,that.namespace);callback(null,job,that)}});return req},history:function(callback){callback=callback||function(){};var that=this;return this.get("history",{},function(err,response){if(err)callback(err);else{for(var jobs=[],data=response.data.entry||[],i=0;i<data.length;i++){var jobData=response.data.entry[i],namespace=utils.namespaceFromProperties(jobData),job=new root.Job(that.service,jobData.name,namespace);job._load(jobData);jobs.push(job)}callback(null,jobs,that)}})},suppressInfo:function(callback){callback=callback||function(){};var that=this;return this.get("suppress",{},function(err,response){callback(err,response.data.entry.content,that)})},update:function(params,callback){params=params||{};if(params.search)return this._super(params,callback);var update=this._super,req=this.fetch(function(err,search){if(err)callback(err);else{params.search=search.properties().search;update.call(search,params,function(){req.wasAborted||callback.apply(null,arguments)})}});return req}});root.SavedSearches=root.Collection.extend({path:function(){return Paths.savedSearches},instantiateEntity:function(props){var entityNamespace=utils.namespaceFromProperties(props);return new root.SavedSearch(this.service,props.name,entityNamespace)},init:function(service,namespace){this._super(service,this.path(),namespace)}});root.Application=root.Entity.extend({fetchOnUpdate:!0,path:function(){return Paths.apps+"/"+encodeURIComponent(this.name)},init:function(service,name){this.name=name;this._super(service,this.path(),{});this.setupInfo=utils.bind(this,this.setupInfo);this.updateInfo=utils.bind(this,this.updateInfo)},setupInfo:function(callback){callback=callback||function(){};var that=this;return this.get("setup",{},function(err,response){err?callback(err):callback(null,response.data.entry.content,that)})},updateInfo:function(callback){callback=callback||function(){};var that=this;return this.get("update",{},function(err,response){err?callback(err):callback(null,response.data.entry.content,that)})}});root.Applications=root.Collection.extend({fetchOnEntityCreation:!0,path:function(){return Paths.apps},instantiateEntity:function(props){return new root.Application(this.service,props.name,{})},init:function(service){this._super(service,this.path(),{})}});root.ServerInfo=root.Entity.extend({path:function(){return Paths.info},init:function(service){this.name="server-info";this._super(service,this.path(),{})}});root.User=root.Entity.extend({path:function(){return Paths.users+"/"+encodeURIComponent(this.name)},init:function(service,name){this.name=name;this._super(service,this.path(),{})}});root.Users=root.Collection.extend({fetchOnEntityCreation:!0,path:function(){return Paths.users},instantiateEntity:function(props){return new root.User(this.service,props.name,{})},init:function(service){this._super(service,this.path(),{})},create:function(params,callback){callback=callback||function(){};var that=this,req=this.post("",params,function(err){if(err)callback(err);else{var props={name:params.name},entity=that.instantiateEntity(props);entity.fetch(function(){req.wasAborted||callback.apply(null,arguments)})}});return req}});root.View=root.Entity.extend({path:function(){return Paths.views+"/"+encodeURIComponent(this.name)},init:function(service,name,namespace){this.name=name;this._super(service,this.path(),namespace)}});root.Views=root.Collection.extend({path:function(){return Paths.views},instantiateEntity:function(props){var entityNamespace=utils.namespaceFromProperties(props);return new root.View(this.service,props.name,entityNamespace)},init:function(service,namespace){this._super(service,this.path(),namespace)}});root.Index=root.Entity.extend({path:function(){return Paths.indexes+"/"+encodeURIComponent(this.name)},init:function(service,name,namespace){this.name=name;this._super(service,this.path(),namespace);this.submitEvent=utils.bind(this,this.submitEvent)},submitEvent:function(event,params,callback){if(!callback&&utils.isFunction(params)){callback=params;params={}}callback=callback||function(){};params=params||{};params["index"]=this.name;var that=this;return this.service.log(event,params,function(err,result){callback(err,result,that)})},remove:function(callback){if(this.service.versionCompare("5.0")<0)throw new Error("Indexes cannot be removed in Splunk 4.x");return this._super(callback)}});root.Indexes=root.Collection.extend({path:function(){return Paths.indexes},instantiateEntity:function(props){var entityNamespace=utils.namespaceFromProperties(props);return new root.Index(this.service,props.name,entityNamespace)},init:function(service,namespace){this._super(service,this.path(),namespace)},create:function(name,params,callback){if(utils.isObject(name)&&utils.isFunction(params)&&!callback){callback=params;params=name;name=params.name}params=params||{};params["name"]=name;return this._super(params,callback)}});root.ConfigurationStanza=root.Entity.extend({path:function(){return Paths.configurations+"/conf-"+encodeURIComponent(this.file)+"/"+encodeURIComponent(this.name)},init:function(service,file,name,namespace){this.name=name;this.file=file;this._super(service,this.path(),namespace)}});root.ConfigurationFile=root.Collection.extend({path:function(){return Paths.configurations+"/conf-"+encodeURIComponent(this.name)},instantiateEntity:function(props){var entityNamespace=utils.namespaceFromProperties(props);return new root.ConfigurationStanza(this.service,this.name,props.name,entityNamespace)},init:function(service,name,namespace){this.name=name;this._super(service,this.path(),namespace)},create:function(stanzaName,values,callback){if(utils.isObject(stanzaName)&&utils.isFunction(values)&&!callback){callback=values;values=stanzaName;stanzaName=values.name}if(utils.isFunction(values)&&!callback){callback=values;values={}}values=values||{};values["name"]=stanzaName;return this._super(values,callback)}});root.Configurations=root.Collection.extend({fetchOnEntityCreation:!0,path:function(){return Paths.properties},instantiateEntity:function(props){return new root.ConfigurationFile(this.service,props.name,this.namespace)},init:function(service,namespace){if(!namespace||"-"===namespace.owner||"-"===namespace.app)throw new Error("Configurations requires a non-wildcard owner/app");this._super(service,this.path(),namespace)},create:function(filename,callback){utils.isObject(filename)&&(filename=filename["__conf"]);callback=callback||function(){};var that=this,req=this.post("",{__conf:filename},function(err){if(err)callback(err);else{var entity=new root.ConfigurationFile(that.service,filename);entity.fetch(function(){req.wasAborted||callback.apply(null,arguments)})}});return req}});root.Job=root.Entity.extend({path:function(){return Paths.jobs+"/"+encodeURIComponent(this.name)},init:function(service,sid,namespace){this.name=sid;this._super(service,this.path(),namespace);this.sid=sid;this.cancel=utils.bind(this,this.cancel);this.disablePreview=utils.bind(this,this.disablePreview);this.enablePreview=utils.bind(this,this.enablePreview);this.events=utils.bind(this,this.events);this.finalize=utils.bind(this,this.finalize);this.pause=utils.bind(this,this.pause);this.preview=utils.bind(this,this.preview);this.results=utils.bind(this,this.results);this.searchlog=utils.bind(this,this.searchlog);this.setPriority=utils.bind(this,this.setPriority);this.setTTL=utils.bind(this,this.setTTL);this.summary=utils.bind(this,this.summary);this.timeline=utils.bind(this,this.timeline);this.touch=utils.bind(this,this.touch);this.unpause=utils.bind(this,this.unpause)},cancel:function(callback){var req=this.post("control",{action:"cancel"},callback);return req},disablePreview:function(callback){callback=callback||function(){};var that=this,req=this.post("control",{action:"disablepreview"},function(err){callback(err,that)});return req},enablePreview:function(callback){callback=callback||function(){};var that=this,req=this.post("control",{action:"enablepreview"},function(err){callback(err,that)});return req},events:function(params,callback){callback=callback||function(){};params=params||{};params.output_mode=params.output_mode||"json_rows";var that=this;return this.get("events",params,function(err,response){err?callback(err):callback(null,response.data,that)})},finalize:function(callback){callback=callback||function(){};var that=this,req=this.post("control",{action:"finalize"},function(err){callback(err,that)});return req},iterator:function(type,params){return new root.PaginatedEndpointIterator(this[type],params)},pause:function(callback){callback=callback||function(){};var that=this,req=this.post("control",{action:"pause"},function(err){callback(err,that)});return req},preview:function(params,callback){callback=callback||function(){};params=params||{};params.output_mode=params.output_mode||"json_rows";var that=this;return this.get("results_preview",params,function(err,response){err?callback(err):callback(null,response.data,that)})},results:function(params,callback){callback=callback||function(){};params=params||{};params.output_mode=params.output_mode||"json_rows";var that=this;return this.get("results",params,function(err,response){err?callback(err):callback(null,response.data,that)})},searchlog:function(callback){callback=callback||function(){};var that=this;return this.get("search.log",{},function(err,response){err?callback(err):callback(null,response.data,that)})},setPriority:function(value,callback){callback=callback||function(){};var that=this,req=this.post("control",{action:"setpriority",priority:value},function(err){callback(err,that)});return req},setTTL:function(value,callback){callback=callback||function(){};var that=this,req=this.post("control",{action:"setttl",ttl:value},function(err){callback(err,that)});return req},summary:function(params,callback){callback=callback||function(){};var that=this;return this.get("summary",params,function(err,response){err?callback(err):callback(null,response.data,that)})},timeline:function(params,callback){callback=callback||function(){};var that=this;return this.get("timeline",params,function(err,response){err?callback(err):callback(null,response.data,that)})},touch:function(callback){callback=callback||function(){};var that=this,req=this.post("control",{action:"touch"},function(err){callback(err,that)});return req},track:function(options,callbacks){var period=options.period||500;utils.isFunction(callbacks)&&(callbacks={done:callbacks});var noCallbacksAfterReady=!(callbacks.progress||callbacks.done||callbacks.failed||callbacks.error);callbacks.ready=callbacks.ready||function(){};callbacks.progress=callbacks.progress||function(){};callbacks.done=callbacks.done||function(){};callbacks.failed=callbacks.failed||function(){};callbacks.error=callbacks.error||function(){};callbacks._preready=callbacks._preready||function(){};callbacks._stoppedAfterReady=callbacks._stoppedAfterReady||function(){};var that=this,emittedReady=!1,doneLooping=!1;Async.whilst(function(){return!doneLooping},function(nextIteration){that.fetch(function(err,job){if(err)nextIteration(err);else{var dispatchState=job.properties().dispatchState,notReady="QUEUED"===dispatchState||"PARSING"===dispatchState;if(notReady)callbacks._preready(job);else{if(!emittedReady){callbacks.ready(job);emittedReady=!0;if(noCallbacksAfterReady){callbacks._stoppedAfterReady(job);doneLooping=!0;nextIteration();return}}callbacks.progress(job);var props=job.properties();if("DONE"===dispatchState&&props.isDone){callbacks.done(job);doneLooping=!0;nextIteration();return}if("FAILED"===dispatchState&&props.isFailed){callbacks.failed(job);doneLooping=!0;nextIteration();return}}Async.sleep(period,nextIteration)}})},function(err){err&&callbacks.error(err)})},unpause:function(callback){callback=callback||function(){};var that=this,req=this.post("control",{action:"unpause"},function(err){callback(err,that)});return req}});root.Jobs=root.Collection.extend({path:function(){return Paths.jobs},instantiateEntity:function(props){var sid=props.content.sid,entityNamespace=utils.namespaceFromProperties(props);return new root.Job(this.service,sid,entityNamespace)},init:function(service,namespace){this._super(service,this.path(),namespace);this.create=utils.bind(this,this.create)},create:function(query,params,callback){if(utils.isObject(query)&&utils.isFunction(params)&&!callback){callback=params;params=query;query=params.search}callback=callback||function(){};params=params||{};params.search=query;if("oneshot"===(params.exec_mode||"").toLowerCase())throw new Error("Please use splunkjs.Service.Jobs.oneshotSearch for exec_mode=oneshot");if(params.search){var that=this;return this.post("",params,function(err,response){if(err)callback(err);else{var job=new root.Job(that.service,response.data.sid,that.namespace);callback(null,job)}})}callback("Must provide a query to create a search job")},search:function(query,params,callback){return this.create(query,params,callback)},oneshotSearch:function(query,params,callback){if(utils.isObject(query)&&utils.isFunction(params)&&!callback){callback=params;params=query;query=params.search}callback=callback||function(){};params=params||{};params.search=query;params.exec_mode="oneshot";params.search||callback("Must provide a query to create a search job");var outputMode=params.output_mode||"json_rows",path=this.qualifiedPath,method="POST",headers={},post=params,get={output_mode:outputMode},body=null,req=this.service.request(path,method,get,post,body,headers,function(err,response){err?callback(err):callback(null,response.data)});return req}});root.PaginatedEndpointIterator=Class.extend({init:function(endpoint,params){params=params||{};this._endpoint=endpoint;this._pagesize=params.pagesize||0;this._offset=0},next:function(callback){callback=callback||function(){};var that=this,params={count:this._pagesize,offset:this._offset};return this._endpoint(params,function(err,results){if(err)callback(err);else{var numResults=results.rows?results.rows.length:0;that._offset+=numResults;callback(null,results,numResults>0)}})}})}()});require.define("/lib/async.js",function(require,module,exports){!function(){var utils=require("./utils"),root=exports||this;root.whilst=function(condition,body,callback){condition=condition||function(){return!1};body=body||function(done){done()};callback=callback||function(){};var iterationDone=function(err){err?callback(err):root.whilst(condition,body,callback)};condition()?body(iterationDone):callback(null)};root.parallel=function(tasks,callback){if(arguments.length>1&&utils.isFunction(arguments[0])){var args=utils.toArray(arguments);tasks=args.slice(0,args.length-1);callback=args[args.length-1]}tasks=tasks||[];callback=callback||function(){};0===tasks.length&&callback();for(var tasksLeft=tasks.length,results=[],doneCallback=function(idx){return function(err){if(err){callback&&callback(err);callback=null}else{var args=utils.toArray(arguments);args.shift();1===args.length&&(args=args[0]);results[idx]=args;if(0===--tasksLeft){results.unshift(null);callback&&callback.apply(null,results)}}}},i=0;i<tasks.length;i++){var task=tasks[i];task(doneCallback(i))}};root.series=function(tasks,callback){if(arguments.length>1&&utils.isFunction(arguments[0])){var args=utils.toArray(arguments);tasks=args.slice(0,args.length-1);callback=args[args.length-1]}tasks=tasks||[];callback=callback||function(){};var innerSeries=function(task,restOfTasks,resultsSoFar,callback){if(task)task(function(err){if(err){callback&&callback(err);callback=null}else{var args=utils.toArray(arguments);args.shift();1===args.length&&(args=args[0]);resultsSoFar.push(args);innerSeries(restOfTasks[0],restOfTasks.slice(1),resultsSoFar,callback)}});else{resultsSoFar.unshift(null);callback.apply(null,resultsSoFar)}};innerSeries(tasks[0],tasks.slice(1),[],callback)};root.parallelMap=function(vals,fn,callback){vals=vals||[];callback=callback||function(){};for(var tasks=[],createTask=function(val,idx){return function(done){fn(val,idx,done)}},i=0;i<vals.length;i++)tasks.push(createTask(vals[i],i));root.parallel(tasks,function(err){if(err){callback&&callback(err);callback=null}else{var args=utils.toArray(arguments);args.shift();callback(null,args)}})};root.seriesMap=function(vals,fn,callback){vals=vals||[];callback=callback||function(){};for(var tasks=[],createTask=function(val,idx){return function(done){fn(val,idx,done)}},i=0;i<vals.length;i++)tasks.push(createTask(vals[i],i));root.series(tasks,function(err){if(err)callback&&callback(err);else{var args=utils.toArray(arguments);args.shift();callback(null,args)}})};root.parallelEach=function(vals,fn,callback){vals=vals||[];callback=callback||function(){};root.parallelMap(vals,fn,function(err){callback(err)})};root.seriesEach=function(vals,fn,callback){vals=vals||[];callback=callback||function(){};root.seriesMap(vals,fn,function(err){callback(err)})};root.chain=function(tasks,callback){if(arguments.length>1&&utils.isFunction(arguments[0])){var args=utils.toArray(arguments);tasks=args.slice(0,args.length-1);callback=args[args.length-1]}tasks=tasks||[];callback=callback||function(){};if(tasks.length){var innerChain=function(task,restOfTasks,result){var chainCallback=function(err){if(err){callback(err);callback=function(){}}else{var args=utils.toArray(arguments);args.shift();innerChain(restOfTasks[0],restOfTasks.slice(1),args)}},args=result;args.push(restOfTasks.length?chainCallback:callback);task.apply(null,args)};innerChain(tasks[0],tasks.slice(1),[])}else callback()};root.sleep=function(timeout,callback){setTimeout(function(){callback()},timeout)};root.augment=function(callback){var args=Array.prototype.slice.call(arguments,1);return function(){for(var augmentedArgs=Array.prototype.slice.call(arguments),i=0;i<args.length;i++)augmentedArgs.push(args[i]);callback.apply(null,augmentedArgs)}}}()});require.define("/lib/platform/client/jquery_http.js",function(require,module,exports){!function(){var Http=require("../../http"),utils=require("../../utils"),root=exports||this,getHeaders=function(headersString){for(var headers={},headerLines=headersString.split("\n"),i=0;i<headerLines.length;i++)if(""!==utils.trim(headerLines[i])){var headerParts=headerLines[i].split(": ");headers[headerParts[0]]=headerParts[1]}return headers};root.JQueryHttp=Http.extend({init:function(isSplunk){this._super(isSplunk)},makeRequest:function(url,message,callback){var that=this,params={url:url,type:message.method,headers:message.headers,data:message.body||"",dataType:"json",success:utils.bind(this,function(data,error,res){var response={statusCode:res.status,headers:getHeaders(res.getAllResponseHeaders())},complete_response=this._buildResponse(error,response,data);callback(complete_response)}),error:function(res,data,error){var response={statusCode:res.status,headers:getHeaders(res.getAllResponseHeaders())};if("abort"===data){response.statusCode="abort";res.responseText="{}"}var json=JSON.parse(res.responseText),complete_response=that._buildResponse(error,response,json);callback(complete_response)}};return $.ajax(params)},parseJson:function(json){return json}})}()});require.define("/lib/platform/client/proxy_http.js",function(require,module,exports){!function(){function parseUri(str){for(var o=parseUri.options,m=o.parser[o.strictMode?"strict":"loose"].exec(str),uri={},i=14;i--;)uri[o.key[i]]=m[i]||"";
uri[o.q.name]={};uri[o.key[12]].replace(o.q.parser,function($0,$1,$2){$1&&(uri[o.q.name][$1]=$2)});return uri}var Http=require("../../http"),utils=require("../../utils"),root=exports||this,getHeaders=function(headersString){for(var headers={},headerLines=headersString.split("\n"),i=0;i<headerLines.length;i++)if(""!==utils.trim(headerLines[i])){var headerParts=headerLines[i].split(": ");headers[headerParts[0]]=headerParts[1]}return headers};parseUri.options={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};var specials=/[.*+?|()\[\]{}\\$\^]/g,escape=function(str){str=str||"";return str.replace(specials,"\\$&")};root.ProxyHttp=Http.extend({init:function(prefix){this.prefix=prefix;this._super()},makeRequest:function(url,message,callback){message.headers["X-ProxyDestination"]=url;var parsed=parseUri(url),prefixToRemove=""+(parsed.protocol?parsed.protocol:"")+"://"+parsed.authority;url=url.replace(new RegExp(escape(prefixToRemove),"i"),"");url=this.prefix+url;var that=this,params={url:url,type:message.method,headers:message.headers,data:message.body||"",dataType:"text",success:function(data,error,res){if(!req.wasAborted){var response={statusCode:res.status,headers:getHeaders(res.getAllResponseHeaders())},complete_response=that._buildResponse(error,response,data);callback(complete_response)}},error:function(res,data,error){if(!req.wasAborted){var response={statusCode:res.status,headers:getHeaders(res.getAllResponseHeaders())};if("abort"===data){response.statusCode="abort";res.responseText="{}"}var json=res.responseText,complete_response=that._buildResponse(error,response,json);callback(complete_response);"abort"===data&&(req.wasAborted=!0)}}},req=$.ajax(params);return req},parseJson:function(json){return JSON.parse(json)}});root.SplunkWebHttp=root.ProxyHttp.extend({init:function(){this._super("/en-US/splunkd/__raw")}})}()});require.define("/lib/entries/browser.ui.entry.js",function(require,module,exports){!function(exportName){var $script=require("../../contrib/script");window[exportName]||(window[exportName]={});window[exportName].UI||(window[exportName].UI={});var UI=window[exportName].UI,token=0,loadComponent=function(path,token,callback){if(!path)throw new Error("Must specify a path to load from.");callback=callback||function(){};$script(path,token,callback)};UI.loadTimeline=function(path,callback){var timelineToken="timeline"+token++;loadComponent(path,timelineToken,callback);return timelineToken};UI.loadCharting=function(path,callback){var chartToken="charting"+token++;loadComponent(path,chartToken,callback);return chartToken};UI.load=function(paths,callback){if(!paths)throw new Error("Must specify paths to load components from");callback=callback||function(){};var token="all"+token++;$script(paths,token,function(){callback()});return token};UI.ready=function(token,callback){callback=callback||function(){};$script.ready(token,callback)}}(__exportName)});require.define("/contrib/script.js",function(require,module){!function(a,b){"undefined"!=typeof module?module.exports=b():this[a]=b()}("$script",function(){function s(a,b,c){for(c=0,j=a.length;j>c;++c)if(!b(a[c]))return m;return 1}function t(a,b){s(a,function(a){return!b(a)})}function u(a,b,c){function o(a){return a.call?a():f[a]}function p(){if(!--m){f[l]=1,j&&j();for(var a in h)s(a.split("|"),o)&&!t(h[a],o)&&(h[a]=[])}}a=a[n]?a:[a];var e=b&&b.call,j=e?b:c,l=e?a.join(""):b,m=a.length;return setTimeout(function(){t(a,function(a){if(k[a])return l&&(g[l]=1),2==k[a]&&p();k[a]=1,l&&(g[l]=1),v(!d.test(a)&&i?i+a+".js":a,p);return void 0})},0),u}function v(a,d){var e=b.createElement("script"),f=m;e.onload=e.onerror=e[r]=function(){e[p]&&!/^c|loade/.test(e[p])||f||(e.onload=e[r]=null,f=1,k[a]=2,d())},e.async=1,e.src=a,c.insertBefore(e,c.firstChild)}var i,a=this,b=document,c=b.getElementsByTagName("head")[0],d=/^https?:\/\//,e=a.$script,f={},g={},h={},k={},m=!1,n="push",o="DOMContentLoaded",p="readyState",q="addEventListener",r="onreadystatechange";return!b[p]&&b[q]&&(b[q](o,function w(){b.removeEventListener(o,w,m),b[p]="complete"},m),b[p]="loading"),u.get=v,u.order=function(a,b,c){!function d(e){e=a.shift(),a.length?u(e,d):u(e,b,c)}()},u.path=function(a){i=a},u.ready=function(a,b,c){a=a[n]?a:[a];var d=[];return!t(a,function(a){f[a]||d[n](a)})&&s(a,function(a){return f[a]})?b():!function(a){h[a]=h[a]||[],h[a][n](b),c&&c(d)}(a.join("|")),u},u.noConflict=function(){return a.$script=e,this},u})});require.define("/browser.entry.js",function(require){!function(exportName){var previousSplunk=window[exportName],ourSplunk=require("../../index"),jqueryHttp=require("../../lib/platform/client/jquery_http").JQueryHttp,proxyHttps=require("../../lib/platform/client/proxy_http"),proxyHttp=proxyHttps.ProxyHttp,splunkwebHttp=proxyHttps.SplunkWebHttp;window[exportName]=ourSplunk;window[exportName].ProxyHttp=proxyHttp;window[exportName].JQueryHttp=jqueryHttp;window[exportName].SplunkWebHttp=splunkwebHttp;window[exportName].noConflict=function(){window[exportName]=previousSplunk;return ourSplunk};require("../../lib/entries/browser.ui.entry")}(__exportName)});require("/browser.entry.js")}();define("splunkjs/splunk",["jquery"],function(global){return function(){var ret;return ret||global.splunkjs}}(this));define("splunkjs/mvc/tokenescapestring",["require","exports","module"],function(){var TokenEscapeString=function(value){this.value=value};return TokenEscapeString});define("splunkjs/mvc/tokensafestring",["require","exports","module"],function(){var TokenSafeString=function(value){this.value=value};return TokenSafeString});define("splunkjs/mvc/tokenutils",["require","exports","module","underscore","./registry"],function(require){var _=require("underscore"),Registry=require("./registry"),VALUE_ESCAPERS={search:function(v){return JSON.stringify(String(v))},url:function(v){return encodeURIComponent(String(v))},html:function(v){return _.escape(String(v))}};_.extend(VALUE_ESCAPERS,{h:VALUE_ESCAPERS.html,u:VALUE_ESCAPERS.url,s:VALUE_ESCAPERS.search});var TOKEN_NAMESPACE_PREFIX_PATTERN=/(\w+:)?/.source,TOKEN_NAME_CHARS_PATTERN=/([^$|:]+?)(\|[|\w]+)?/.source,TOKEN_PATTERN=/\$/.source+TOKEN_NAMESPACE_PREFIX_PATTERN+TOKEN_NAME_CHARS_PATTERN+/\$/.source,TOKEN_OR_DOLLAR_RE=new RegExp(TOKEN_PATTERN+"|"+/\$\$/.source,"g"),OLD_STYLE_FILTER_CHAIN_RE=/^[suh]{1,3}$/,r=function(regexp){var flags="";regexp.global&&(flags+="g");regexp.multiline&&(flags+="m");regexp.ignoreCase&&(flags+="i");return new RegExp(regexp.source,flags)},TokenUtils={_FILTER_NAMESPACE:"__filters",getTokens:function(searchTemplate,options){options=options||{};for(var defaultTokenNamespace=options.tokenNamespace||"default",tokens=[],rex=r(TOKEN_OR_DOLLAR_RE);;){var match=rex.exec(searchTemplate);if(options._isToken)return match&&0===match.index&&match[0].length===searchTemplate.length&&match[0].length>2;if(!match)break;var tokenNamespace=match[1],tokenName=match[2],filterChain=match[3];if(tokenNamespace||tokenName){tokenNamespace=tokenNamespace?tokenNamespace.substring(0,tokenNamespace.length-1):defaultTokenNamespace;var filters;if(filterChain){var filterNames=TokenUtils._parseFilterChain(filterChain);filters=_.map(filterNames,function(filterName){return{name:filterName}})}else filters=[];tokens.push({namespace:tokenNamespace,name:tokenName,filters:filters})}}return tokens},getTokenNames:function(searchTemplate){var tokens=TokenUtils.getTokens(searchTemplate),tokenNames=[];_.each(tokens,function(token){"default"===token.namespace&&tokenNames.push(token.name)});return tokenNames},replaceTokens:function(str,tokenRegistry,optionsOrEscaper){var options;options=_.isFunction(optionsOrEscaper)?{escaper:optionsOrEscaper}:optionsOrEscaper||{};var extraFilterFunc=options.escaper,defaultTokenNamespace=options.tokenNamespace||"default";return str.replace(r(TOKEN_OR_DOLLAR_RE),function(match,tokenNamespace,tokenName,filterChain){if(!tokenNamespace&&!tokenName)return"$";tokenNamespace=tokenNamespace?tokenNamespace.substring(0,tokenNamespace.length-1):defaultTokenNamespace;var tokenModel=tokenRegistry.get(tokenNamespace);if(void 0===tokenModel)return match;var v=tokenModel.get(tokenName);if(void 0===v)return match;if(filterChain){var filterNames=TokenUtils._parseFilterChain(filterChain,extraFilterFunc,tokenRegistry),filterFuncs=_.map(filterNames,function(filterName){return TokenUtils.getFilter(filterName,tokenRegistry)});if(_.compact(filterFuncs).length!==filterFuncs.length)return match;_.each(filterFuncs,function(filterFunc){filterFunc&&(v=filterFunc(v))})}_.isFunction(extraFilterFunc)&&(v=extraFilterFunc(v));return v})},_parseFilterChain:function(filterChain,suppressedOldFilterFunc,registry){var filterNames=filterChain.substring(1).split("|");if(1===filterNames.length&&OLD_STYLE_FILTER_CHAIN_RE.test(filterNames[0])){filterNames=filterNames[0].split("");suppressedOldFilterFunc&&(filterNames=_.filter(filterNames,function(filterName){var filterFunc=TokenUtils.getFilter(filterName,registry);return filterFunc!==suppressedOldFilterFunc}))}return filterNames},replaceTokenNames:function(str,valuesByTokenName,escaper){var tokenRegistry=new Registry,defaultTokenModel=tokenRegistry.getInstance("default",{create:!0});defaultTokenModel.set(valuesByTokenName);return TokenUtils.replaceTokens(str,tokenRegistry,escaper)},hasToken:function(str){return TokenUtils.getTokens(str).length>0},hasTokenName:function(str){return _.some(TokenUtils.getTokens(str),function(token){return"default"===token.namespace})},isToken:function(p){return TokenUtils.getTokens(p,{_isToken:!0})},isTokenName:function(p){return TokenUtils.isToken(p)&&"default"===TokenUtils.getTokens(p)[0].namespace},getTokenName:function(tokenStr){return TokenUtils.isTokenName(tokenStr)&&TokenUtils.getTokenNames(tokenStr)[0]},quoteAsTokenString:function(literalStr){return _.isString(literalStr)?literalStr.replace(/\$/g,function(){return"$$"}):literalStr},setFilter:function(filterName,filterFunc,registry){var isBuiltinFilter=TokenUtils.getEscaper(filterName);if(isBuiltinFilter||OLD_STYLE_FILTER_CHAIN_RE.test(filterName))throw new Error('Cannot register new filter with reserved name "'+filterName+'".');var filters=registry.getInstance(TokenUtils._FILTER_NAMESPACE,{create:!0});filters.set(filterName,filterFunc)},getFilter:function(filterName,registry){var builtinFilterFunc=TokenUtils.getEscaper(filterName);if(builtinFilterFunc)return builtinFilterFunc;var filters=registry.getInstance(TokenUtils._FILTER_NAMESPACE,{create:!0});return filters.get(filterName)},getEscaper:function(esc){return VALUE_ESCAPERS[esc]}};return TokenUtils});define("splunkjs/mvc/utils",["require","exports","module","jquery","underscore","util/console","splunk.config","./tokenutils"],function(require){var _=(require("jquery"),require("underscore")),console=require("util/console"),splunkConfig=require("splunk.config"),TokenUtils=require("./tokenutils"),ModelSyncer=function(options){options=options||{};this.source=options.source;this.prefix=options.prefix||"";this.dest=options.dest;this.destSetter=options.save||options.saveDest?"save":"set";this.sourceSetter=options.save||options.saveSource?"save":"set";this.debug=options.debug;this.aliasMap=options.alias||{};this.tokens=void 0!==options.tokens?options.tokens:!0;this.include(options.include);this.exclude(options.exclude);if(options.auto===!0){this.auto("push");this.auto("pull")}else _.isString(options.auto)&&this.auto(options.auto)};_.extend(ModelSyncer.prototype,{include:function(attributes){this.includes=_.isArray(attributes)?_.object(attributes,_.map(attributes,function(){return!0})):attributes;return this},exclude:function(attributes){this.excludes=_.isArray(attributes)?_.object(attributes,_.map(attributes,function(){return!0})):attributes;return this},auto:function(what){if("push"===what){this.source.on("change",this.push,this);this.push()}else if("pull"==what){this.dest.on("change",this.pull,this);this.pull()}return this},push:function(m,o){var opts={tokens:this.tokens},attrs=o&&o.unset?m.changed:this.source.toJSON(opts),newAttrs={},alias=this.aliasMap||{},includes=this.includes,excludes=this.excludes||{},p=this.prefix,d=this.dest;_(attrs).each(function(v,k){if((void 0===includes||includes[k])&&!excludes[k]){var a=alias[k],n=void 0!==a?a:p+k;d.get(n,opts)!==v&&(newAttrs[n]=v)}});if(!_(newAttrs).isEmpty()){this.debug&&console.log("PUSH",newAttrs,_.isObject(o)?_.pick(o,["unset"]):void 0);this.dest[this.destSetter](newAttrs,_.extend(opts,_.isObject(o)?_.pick(o,["unset"]):void 0))}},pull:function(m,o){var opts={tokens:this.tokens},attrs=o&&o.unset?m.changed:this.dest.toJSON(opts),newAttrs={},inverseAlias=_.invert(this.aliasMap||{}),includes=this.includes,excludes=this.excludes||{},p=this.prefix,s=this.source;_(attrs).each(function(v,k){if(inverseAlias[k])newAttrs[inverseAlias[k]]=v;else if(k.substring(0,p.length)==p){var n=k.substring(p.length);void 0!==includes&&!includes[n]||excludes[n]||s.get(n,opts)!==v&&(newAttrs[n]=v)}});if(!_(newAttrs).isEmpty()){this.debug&&console.log("PULL",newAttrs,_.isObject(o)?_.pick(o,["unset"]):void 0);this.source[this.sourceSetter](newAttrs,_.extend(opts,_.isObject(o)?_.pick(o,["unset"]):void 0))}},destroy:function(){this.source.off(null,null,this);this.dest.off(null,null,this)}});var utils={getPageInfo:function(){return splunkConfig.INDEPENDENT_MODE?{root:void 0,locale:splunkConfig.LOCALE,app:splunkConfig.APP,page:void 0}:utils._getUrlInfo(window.location.pathname)},_getUrlInfo:_.memoize(function(url){var locale,root,appPath,urlParts=url.substring(1).split("/"),appIndex=_.indexOf(urlParts,"app",1),managerIndex=_.indexOf(urlParts,"manager",1),djIndex=_.indexOf(urlParts,"dj",0);if(djIndex>=0&&(-1===appIndex||appIndex>djIndex)){djIndex>0&&(root=_.first(urlParts,djIndex).join("/"));locale=urlParts[djIndex+1];appPath=_.rest(urlParts,djIndex+2)}else if(appIndex>1){root=_.first(urlParts,appIndex-1).join("/");locale=urlParts[appIndex-1];appPath=_.rest(urlParts,appIndex+1)}else if(managerIndex>1){root=_.first(urlParts,managerIndex-1).join("/");locale=urlParts[managerIndex-1];appPath=_.rest(urlParts,managerIndex+1)}else{locale=urlParts[0];appPath=_.rest(urlParts,2)}return{root:root,locale:locale,app:appPath[0],page:appPath[1]}}),getCurrentApp:function(){return utils.getPageInfo().app},searchEscapeValue:function(v){return JSON.stringify(String(v))},escapeFn:function(esc){return TokenUtils.getEscaper(esc)},escape:function(value,esc){return utils.escapeFn(esc)(value)},replaceTokens:function(str,values,escaper){return TokenUtils.replaceTokenNames(str,values,escaper)},getTokenName:function(tokenStr){return TokenUtils.getTokenName(tokenStr)},discoverReplacementTokens:function(searchTemplate){return TokenUtils.getTokenNames(searchTemplate)},isToken:function(p){return TokenUtils.isTokenName(p)},hasToken:function(str){return TokenUtils.hasTokenName(str)},containsToken:function(obj){return _(obj).some(TokenUtils.hasTokenName)},quoteAsTokenString:function(literalStr){return TokenUtils.quoteAsTokenString(literalStr)},syncModels:function(src,dest,o){var options=o;if(1==arguments.length)options=src;else{options=options||{};_.extend(options,{source:src,dest:dest})}return new ModelSyncer(options)},redirect:function(url,newWindow,target){newWindow?window.open(url,"_blank"):target?window.open(url,target):window.location=url}};return utils});Splunk.namespace("Splunk.Error");Splunk.Error.PROPAGATE=!0;Splunk.Error.loggerMode=Splunk.Logger.mode.Server;Splunk.Error.Handler=new function(){var self=this,logger=Splunk.Logger.getLogger("Splunk.Error",Splunk.Error.loggerMode);self.onerror=function(message,fileName,lineNumber){var output=format(message,fileName,lineNumber);logger.error(output);return!Splunk.Error.PROPAGATE};self.raise=function(error){var output=format(error.message,error.fileName,error.lineNumber);logger.error(output);if(Splunk.Error.PROPAGATE)throw error};var format=function(message,fileName,lineNumber){return"lineNumber="+lineNumber+", message="+message+", fileName="+fileName};self.Error=function(){window.onerror=self.onerror}()};define("splunk.error",["jquery","splunk","splunk.logger"],function(global){return function(){var ret;return ret||global.Splunk.Error}}(this));define("util/ajax_logging",["jquery","underscore","splunk.logger","splunk.util"],function($,_,SplunkLogger,splunkUtils){var LOG_MODE=splunkUtils.getConfigValue("JS_LOGGER_MODE","None"),LOG_LEVEL=splunkUtils.getConfigValue("JS_LOGGER_LEVEL","INFO");if("None"!==LOG_MODE&&"DEBUG"===LOG_LEVEL){var logger=SplunkLogger.getLogger("ajax_logging.js"),URL_BLACKLIST=[SplunkLogger.mode.Server.END_POINT,"services/messages"];$.ajaxPrefilter(function(options){var passesBlacklist=_(URL_BLACKLIST).every(function(blacklistUrl){return-1===options.url.indexOf(blacklistUrl)});if(passesBlacklist){logger.debug("sending AJAX request to ",options.url);logger.trace()}})}});require.config({shim:{"splunkjs/contrib/jquery.deparam":{deps:["jquery"],exports:"jQuery.fn.deparam"}}});define("splunkjs/mvc/mvc",["require","exports","module","underscore","backbone","util/console","../contrib/jquery.deparam","./protections","./registry","splunkjs/generated/urlresolver","splunkjs/splunk","splunk.config","./tokenescapestring","./tokensafestring","./tokenutils","./utils","splunk.error","util/ajax_logging"],function(require){var _=require("underscore"),Backbone=require("backbone"),console=require("util/console"),protections=(require("../contrib/jquery.deparam"),require("./protections")),Registry=require("./registry"),Resolver=require("splunkjs/generated/urlresolver"),sdk=require("splunkjs/splunk"),splunkConfig=require("splunk.config"),TokenEscapeString=require("./tokenescapestring"),TokenSafeString=require("./tokensafestring"),TokenUtils=require("./tokenutils"),utils=require("./utils");require("splunk.error");require("util/ajax_logging");var sessionKey=null,MVCConstructor=function(){this.Components=new Registry;this.initialize.apply(this,arguments)};_.extend(MVCConstructor.prototype,Backbone.Events,{started:!1,initialize:function(){},drilldown:function(path,data){var encoded=$.param(data||{});encoded&&(path=path+"?"+encoded);window.location=path},loadDebugger:function(callback){var that=this;require(["./debugger"],function(Debugger){that.Debugger=new Debugger({registry:that.Components});that.trigger("debugger:ready",that);callback&&callback(that.Debugger)})},loadDrilldown:function(data){var queryArgs=window.location.search.substr(1)||"",args=_.extend({},$.deparam(queryArgs),data),that=this;_.each(args,function(datum,id){if(that.Components.has(id)){var component=that.Components.getInstance(id);component.settings?component.settings.set(datum):component.set?component.set(datum):console.log("Could not find a setter for '"+id+"'",datum)}})},reverse:function(name,app,args){return Resolver.reverse(name,app,args)},_setSessionKey:function(key){sessionKey=key},createService:function(options){options=options||{};sessionKey&&(options.sessionKey=sessionKey);var http=options.http||new sdk.ProxyHttp(splunkConfig.SPLUNKD_PATH);options.scheme=options.scheme||splunkConfig.SCHEME;options.host=options.host||splunkConfig.HOST;options.port=options.port||splunkConfig.PORT;options.version=options.version||"5.0";options.app=options.app||utils.getPageInfo().app||"-";options.owner=options.owner||encodeURIComponent(splunkConfig.USERNAME);return new sdk.Service(http,options)},tokenSafe:function(template){return new TokenSafeString(template)},tokenEscape:function(literal){return new TokenEscapeString(literal)},setFilter:function(filterName,filterFunc){TokenUtils.setFilter(filterName,filterFunc,mvc.Components)},getFilter:function(filterName){return TokenUtils.getFilter(filterName,mvc.Components)}});window.splunkjs||(window.splunkjs={});{var mvc=new MVCConstructor;window.splunkjs.mvc=mvc}if(splunkConfig.DJANGO_ENABLE_PROTECTIONS){protections.enableCSRFProtection($);protections.enableUnauthorizationRedirection($,mvc.reverse(":login"),mvc.reverse(":logout"))}return mvc});define("splunkjs/mvc",["require","exports","module","./mvc/mvc"],function(require){var mvc=require("./mvc/mvc");return mvc});define("mixins/domtracker",["require","exports","module","underscore","jquery"],function(require){var _=require("underscore"),jQuery=require("jquery"),DomTracker={listenToDOM:function($el,eventName,handler){if(!($el instanceof jQuery))throw new Error("listenToDOM supports only jQuery objects");var domListeners=this._domListeners||(this._domListeners=[]),bindedHandler=_.bind(handler,this),eventNames=eventName.split(" ");_.each(eventNames,function(eventName){$el.on(eventName,bindedHandler);var subscription={$el:$el,eventName:eventName,handler:handler,bindedHandler:bindedHandler};domListeners.push(subscription)})},stopListeningDOM:function($el,eventName,handler){if($el&&!($el instanceof jQuery))throw new Error("stopListeningDOM supports only jQuery objects");var domListeners=this._domListeners||(this._domListeners=[]),eventNames=eventName?eventName.split(" "):eventName;this._domListeners=_.filter(domListeners,function(subscription){if(!($el&&!subscription.$el.is($el)||eventNames&&!(_.indexOf(eventNames,subscription.eventName)>=0)||handler&&subscription.handler!==handler)){subscription.$el.off(subscription.eventName,subscription.bindedHandler);return!1}return!0})}};return DomTracker});define("splunkjs/mvc/basemanager",["require","exports","module","underscore","backbone","util/console","mixins/domtracker","./mvc"],function(require){var _=require("underscore"),Backbone=require("backbone"),console=require("util/console"),DomTrackerMixin=require("mixins/domtracker"),mvc=require("./mvc"),BaseManager=Backbone.Model.extend({constructor:function(attributes,options){attributes=attributes||{};options=options||{};var id=options.id||attributes.id;if(void 0===id){id=options.name||attributes.name;void 0!==id&&console.log("Use of 'name' to specify the ID of a Splunk model is deprecated.")}void 0===id&&(id=_.uniqueId("manager_"));this.id=this.name=options.name=options.id=id;var returned=Backbone.Model.prototype.constructor.apply(this,arguments);mvc.Components.registerInstance(this.id,this,{replace:options.replace});return returned},_start:function(){},dispose:function(){this.stopListeningDOM();this.stopListening();mvc.Components.getInstance(this.id)===this&&mvc.Components.revokeInstance(this.id)}});_.extend(BaseManager.prototype,DomTrackerMixin);return BaseManager});define("splunkjs/mvc/splunkresultsmodel",["require","exports","module","underscore","backbone"],function(require){var _=require("underscore"),Backbone=require("backbone"),defaultCondition=function(manager){var content=manager.get("data")||{},previewCount=content.resultPreviewCount||0;return previewCount>0},identityCondition=function(){return!0},ResultsModel=Backbone.Model.extend({defaults:{manager:null,condition:defaultCondition,source:"",autofetch:!0,serialfetch:!0},initialize:function(){this.on("change:autofetch",this.handleAutofetch,this);this.handleAutofetch();this.get("autofetch")&&this._fetch()},handleAutofetch:function(){if(this.get("autofetch")){this.on("change",this._fetch,this);this.get("manager").on("change:data",this._fetch,this)}else{this.off("change",null,this);this.get("manager").off("change:data",null,this)}},sync:function(){return!1},destroy:function(){this.off();this.get("manager").off(null,null,this)},_fetch:function(){this.fetch({autofetch:!0})},fetch:function(options){options=options||{};var isAutofetch=!!options.autofetch,_success=options.success,_error=options.error;options=_.omit(options,["error","success","autofetch"]);var error=function(options,err){_error&&_error(this,err,options);return this},manager=this.get("manager");if(!manager)return error(options,_("No manager").t());var job=manager.job;if(!job)return error(options,_("No job").t());var condition=this.get("condition")||defaultCondition;if(!isAutofetch||condition(manager,job)){var fetchOptions=this._requestOptions(options);if(this._isFetching&&this.get("serialfetch")){this._pendingFetchOptions=fetchOptions;this._pendingFetchOptions.success=_success;this._pendingFetchOptions.error=_error}else{this._isFetching=!0;var that=this,source=fetchOptions.source;delete fetchOptions.source;job[source](fetchOptions,function(err,data){var pendingFetchOptions=that._pendingFetchOptions;that._pendingFetchOptions=null;that._isFetching=!1;if(err){error(options,err);var message=null;err.data&&err.data.messages&&err.data.messages.length&&(message=err.data.messages[0]);var text=message?message.text:"An error occurred while fetching data.";that.trigger("error",text,err)}else{that._data=data;that.trigger("data",that,data);_success&&_success(this,data,options);if(pendingFetchOptions&&!that._isFetching){var manager=that.get("manager");manager&&manager.job&&that.fetch(pendingFetchOptions)}}})}}},_requestOptions:function(options){var requestOptions=this.toJSON();requestOptions=_.omit(requestOptions,["data","manager","autofetch","serialfetch","condition"]);return _.extend(requestOptions,options)},data:function(){return this._data},model:function(){var model=new Backbone.Model(this.data());model.raw=this.data();return model},collection:function(){var i,j,data=this.data();if(!data)return new Backbone.Collection;var fields=data.fields||[],items=[];if(data.results)items=data.results;else if(data.columns){var columns=data.columns||[];for(i=0;i<columns.length;i++)items.push({field:fields[i],values:columns[i]})}else if(data.rows){var rows=data.rows||[];for(i=0;i<rows.length;i++){var row=rows[i],item={};for(j=0;j<fields.length;j++)item[fields[j]]=row[j];items.push(item)}}var collection=new Backbone.Collection(items);collection.raw=data;return collection},hasData:function(){return this.data()?_.isArray(this._data)&&1===this._data.length&&0===this._data[0].count?!1:this._data.results&&0===this._data.results.length?!1:this._data.fields&&0===this._data.fields.length?!1:!0:!1}},{defaultCondition:defaultCondition,identityCondition:identityCondition});return ResultsModel});define("util/Ticker",["underscore","backbone"],function(_,Backbone){var Ticker=function(options){options||(options={});this.interval=options.interval||1e3;this.cid=_.uniqueId("ticker");options.params&&(this.params=options.params);options.tick&&this.tick();options.start&&this.start()};_.extend(Ticker.prototype,Backbone.Events,{start:function(tick){if(this._intervalId)return!1;tick&&this.tick();this._intervalId=setInterval(_.bind(this.tick,this),this.interval);return!0},stop:function(tick){if(this._intervalId){tick&&this.tick();clearInterval(this._intervalId);delete this._intervalId;return!0}return!1},restart:function(options){options||(options={});this.stop();options.interval&&(this.interval=options.interval);options.params&&(this.params=options.params);this.start(options.tick)},tick:function(params){params||(params=this.params);var args=_.isArray(params)?params:[params];this.trigger.apply(this,["tick"].concat(args))}});return Ticker});!function($){var addMethods=function(source){var ancestor=this.superclass&&this.superclass.prototype,properties=$.keys(source);$.keys({toString:!0}).length||properties.push("toString","valueOf");for(var i=0,length=properties.length;length>i;i++){var property=properties[i],value=source[property];if(ancestor&&$.isFunction(value)&&"$super"==$.argumentNames(value)[0])var method=value,value=$.extend($.wrap(function(m){return function(){return ancestor[m].apply(this,arguments)}}(property),method),{valueOf:function(){return method},toString:function(){return method.toString()}});this.prototype[property]=value}return this};$.extend({keys:function(obj){var keys=[];for(var key in obj)keys.push(key);return keys},argumentNames:function(func){var names=func.toString().match(/^[\s\(]*function[^(]*\((.*?)\)/)[1].split(/, ?/);return 1!=names.length||names[0]?names:[]},bind:function(func,scope){return function(){return func.apply(scope,$.makeArray(arguments))}},wrap:function(func,wrapper){var __method=func;return function(){return wrapper.apply(this,[$.bind(__method,this)].concat($.makeArray(arguments)))}},klass:function(){var parent=null,properties=$.makeArray(arguments);$.isFunction(properties[0])&&(parent=properties.shift());var klass=function(){this.initialize.apply(this,arguments)};klass.superclass=parent;klass.subclasses=[];klass.addMethods=addMethods;if(parent){var subclass=function(){};subclass.prototype=parent.prototype;klass.prototype=new subclass;parent.subclasses.push(klass)}for(var i=0;i<properties.length;i++)klass.addMethods(properties[i]);klass.prototype.initialize||(klass.prototype.initialize=function(){});klass.prototype.constructor=klass;return klass}});var bindEvents=function(instance){for(var member in instance)member.match(/^on(.+)/)&&"function"==typeof instance[member]&&instance.element.bind(RegExp.$1,$.bind(instance[member],instance))},behaviorWrapper=function(behavior){return $.klass(behavior,{initialize:function($super,element,args){this.element=$(element);$super&&$super.apply(this,args)}})},attachBehavior=function(el,behavior,args){var wrapper=behaviorWrapper(behavior);instance=new wrapper(el,args);bindEvents(instance);behavior.instances||(behavior.instances=[]);behavior.instances.push(instance);return instance};$.fn.extend({attach:function(){var args=$.makeArray(arguments),behavior=args.shift();return $.livequery&&this.selector?this.livequery(function(){attachBehavior(this,behavior,args)}):this.each(function(){attachBehavior(this,behavior,args)})},attachAndReturn:function(){var args=$.makeArray(arguments),behavior=args.shift();return $.map(this,function(el){return attachBehavior(el,behavior,args)})},attached:function(behavior){var instances=[];if(!behavior.instances)return instances;this.each(function(i,element){$.each(behavior.instances,function(i,instance){instance.element.get(0)==element&&instances.push(instance)})});return instances},firstAttached:function(behavior){return this.attached(behavior)[0]}});var Remote=$.klass({initialize:function(options){"FORM"==this.element.attr("nodeName")?this.element.attach(Remote.Form,options):this.element.attach(Remote.Link,options)}});Remote.Base=$.klass({initialize:function(options){this.options=$.extend({},options||{})},_makeRequest:function(options){$.ajax(options);return!1}});Remote.Link=$.klass(Remote.Base,{onclick:function(){var options=$.extend({url:this.element.attr("href"),type:"GET"},this.options);return this._makeRequest(options)}});Remote.Form=$.klass(Remote.Base,{onclick:function(e){var target=e.target;$.inArray(target.nodeName.toLowerCase(),["input","button"])>=0&&target.type.match(/submit|image/)&&(this._submitButton=target)},onsubmit:function(){var data=this.element.serializeArray();this._submitButton&&data.push({name:this._submitButton.name,value:this._submitButton.value});var options=$.extend({url:this.element.attr("action"),type:this.element.attr("method")||"GET",data:data},this.options);this._makeRequest(options);return!1}});$.ajaxSetup({beforeSend:function(xhr){xhr.setRequestHeader("Accept","text/javascript, text/html, application/xml, text/xml, */*")}})}(jQuery);define("lowpro",["jquery"],function(){});var swfobject=function(){function f(){if(!J){try{var Z=j.getElementsByTagName("body")[0].appendChild(C("span"));Z.parentNode.removeChild(Z)}catch(aa){return}J=!0;for(var X=U.length,Y=0;X>Y;Y++)U[Y]()}}function K(X){J?X():U[U.length]=X}function s(Y){if(typeof O.addEventListener!=D)O.addEventListener("load",Y,!1);else if(typeof j.addEventListener!=D)j.addEventListener("load",Y,!1);else if(typeof O.attachEvent!=D)i(O,"onload",Y);else if("function"==typeof O.onload){var X=O.onload;O.onload=function(){X();Y()}}else O.onload=Y}function h(){T?V():H()
}function V(){var X=j.getElementsByTagName("body")[0],aa=C(r);aa.setAttribute("type",q);var Z=X.appendChild(aa);if(Z){var Y=0;!function(){if(typeof Z.GetVariable!=D){var ab=Z.GetVariable("$version");if(ab){ab=ab.split(" ")[1].split(",");M.pv=[parseInt(ab[0],10),parseInt(ab[1],10),parseInt(ab[2],10)]}}else if(10>Y){Y++;setTimeout(arguments.callee,10);return}X.removeChild(aa);Z=null;H()}()}else H()}function H(){var ag=o.length;if(ag>0)for(var af=0;ag>af;af++){var Y=o[af].id,ab=o[af].callbackFn,aa={success:!1,id:Y};if(M.pv[0]>0){var ae=c(Y);if(ae)if(!F(o[af].swfVersion)||M.wk&&M.wk<312)if(o[af].expressInstall&&A()){var ai={};ai.data=o[af].expressInstall;ai.width=ae.getAttribute("width")||"0";ai.height=ae.getAttribute("height")||"0";ae.getAttribute("class")&&(ai.styleclass=ae.getAttribute("class"));ae.getAttribute("align")&&(ai.align=ae.getAttribute("align"));for(var ah={},X=ae.getElementsByTagName("param"),ac=X.length,ad=0;ac>ad;ad++)"movie"!=X[ad].getAttribute("name").toLowerCase()&&(ah[X[ad].getAttribute("name")]=X[ad].getAttribute("value"));P(ai,ah,Y,ab)}else{p(ae);ab&&ab(aa)}else{w(Y,!0);if(ab){aa.success=!0;aa.ref=z(Y);ab(aa)}}}else{w(Y,!0);if(ab){var Z=z(Y);if(Z&&typeof Z.SetVariable!=D){aa.success=!0;aa.ref=Z}ab(aa)}}}}function z(aa){var X=null,Y=c(aa);if(Y&&"OBJECT"==Y.nodeName)if(typeof Y.SetVariable!=D)X=Y;else{var Z=Y.getElementsByTagName(r)[0];Z&&(X=Z)}return X}function A(){return!a&&F("6.0.65")&&(M.win||M.mac)&&!(M.wk&&M.wk<312)}function P(aa,ab,X,Z){a=!0;E=Z||null;B={success:!1,id:X};var ae=c(X);if(ae){if("OBJECT"==ae.nodeName){l=g(ae);Q=null}else{l=ae;Q=X}aa.id=R;(typeof aa.width==D||!/%$/.test(aa.width)&&parseInt(aa.width,10)<310)&&(aa.width="310");(typeof aa.height==D||!/%$/.test(aa.height)&&parseInt(aa.height,10)<137)&&(aa.height="137");j.title=j.title.slice(0,47)+" - Flash Player Installation";var ad=M.ie&&M.win?"ActiveX":"PlugIn",ac="MMredirectURL="+O.location.toString().replace(/&/g,"%26")+"&MMplayerType="+ad+"&MMdoctitle="+j.title;typeof ab.flashvars!=D?ab.flashvars+="&"+ac:ab.flashvars=ac;if(M.ie&&M.win&&4!=ae.readyState){var Y=C("div");X+="SWFObjectNew";Y.setAttribute("id",X);ae.parentNode.insertBefore(Y,ae);ae.style.display="none";!function(){4==ae.readyState?ae.parentNode.removeChild(ae):setTimeout(arguments.callee,10)}()}u(aa,ab,X)}}function p(Y){if(M.ie&&M.win&&4!=Y.readyState){var X=C("div");Y.parentNode.insertBefore(X,Y);X.parentNode.replaceChild(g(Y),X);Y.style.display="none";!function(){4==Y.readyState?Y.parentNode.removeChild(Y):setTimeout(arguments.callee,10)}()}else Y.parentNode.replaceChild(g(Y),Y)}function g(ab){var aa=C("div");if(M.win&&M.ie)aa.innerHTML=ab.innerHTML;else{var Y=ab.getElementsByTagName(r)[0];if(Y){var ad=Y.childNodes;if(ad)for(var X=ad.length,Z=0;X>Z;Z++)1==ad[Z].nodeType&&"PARAM"==ad[Z].nodeName||8==ad[Z].nodeType||aa.appendChild(ad[Z].cloneNode(!0))}}return aa}function u(ai,ag,Y){var X,aa=c(Y);if(M.wk&&M.wk<312)return X;if(aa){typeof ai.id==D&&(ai.id=Y);if(M.ie&&M.win){var ah="";for(var ae in ai)ai[ae]!=Object.prototype[ae]&&("data"==ae.toLowerCase()?ag.movie=ai[ae]:"styleclass"==ae.toLowerCase()?ah+=' class="'+ai[ae]+'"':"classid"!=ae.toLowerCase()&&(ah+=" "+ae+'="'+ai[ae]+'"'));var af="";for(var ad in ag)ag[ad]!=Object.prototype[ad]&&(af+='<param name="'+ad+'" value="'+ag[ad]+'" />');aa.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+ah+">"+af+"</object>";N[N.length]=ai.id;X=c(ai.id)}else{var Z=C(r);Z.setAttribute("type",q);for(var ac in ai)ai[ac]!=Object.prototype[ac]&&("styleclass"==ac.toLowerCase()?Z.setAttribute("class",ai[ac]):"classid"!=ac.toLowerCase()&&Z.setAttribute(ac,ai[ac]));for(var ab in ag)ag[ab]!=Object.prototype[ab]&&"movie"!=ab.toLowerCase()&&e(Z,ab,ag[ab]);aa.parentNode.replaceChild(Z,aa);X=Z}}return X}function e(Z,X,Y){var aa=C("param");aa.setAttribute("name",X);aa.setAttribute("value",Y);Z.appendChild(aa)}function y(Y){var X=c(Y);if(X&&"OBJECT"==X.nodeName)if(M.ie&&M.win){X.style.display="none";!function(){4==X.readyState?b(Y):setTimeout(arguments.callee,10)}()}else X.parentNode.removeChild(X)}function b(Z){var Y=c(Z);if(Y){for(var X in Y)"function"==typeof Y[X]&&(Y[X]=null);Y.parentNode.removeChild(Y)}}function c(Z){var X=null;try{X=j.getElementById(Z)}catch(Y){}return X}function C(X){return j.createElement(X)}function i(Z,X,Y){Z.attachEvent(X,Y);I[I.length]=[Z,X,Y]}function F(Z){var Y=M.pv,X=Z.split(".");X[0]=parseInt(X[0],10);X[1]=parseInt(X[1],10)||0;X[2]=parseInt(X[2],10)||0;return Y[0]>X[0]||Y[0]==X[0]&&Y[1]>X[1]||Y[0]==X[0]&&Y[1]==X[1]&&Y[2]>=X[2]?!0:!1}function v(ac,Y,ad,ab){if(!M.ie||!M.mac){var aa=j.getElementsByTagName("head")[0];if(aa){var X=ad&&"string"==typeof ad?ad:"screen";if(ab){n=null;G=null}if(!n||G!=X){var Z=C("style");Z.setAttribute("type","text/css");Z.setAttribute("media",X);n=aa.appendChild(Z);M.ie&&M.win&&typeof j.styleSheets!=D&&j.styleSheets.length>0&&(n=j.styleSheets[j.styleSheets.length-1]);G=X}M.ie&&M.win?n&&typeof n.addRule==r&&n.addRule(ac,Y):n&&typeof j.createTextNode!=D&&n.appendChild(j.createTextNode(ac+" {"+Y+"}"))}}}function w(Z,X){if(m){var Y=X?"visible":"hidden";J&&c(Z)?c(Z).style.visibility=Y:v("#"+Z,"visibility:"+Y)}}function L(Y){var Z=/[\\\"<>\.;]/,X=null!=Z.exec(Y);return X&&typeof encodeURIComponent!=D?encodeURIComponent(Y):Y}{var l,Q,E,B,n,G,D="undefined",r="object",S="Shockwave Flash",W="ShockwaveFlash.ShockwaveFlash",q="application/x-shockwave-flash",R="SWFObjectExprInst",x="onreadystatechange",O=window,j=document,t=navigator,T=!1,U=[h],o=[],N=[],I=[],J=!1,a=!1,m=!0,M=function(){var aa=typeof j.getElementById!=D&&typeof j.getElementsByTagName!=D&&typeof j.createElement!=D,ah=t.userAgent.toLowerCase(),Y=t.platform.toLowerCase(),ae=/win/.test(Y?Y:ah),ac=/mac/.test(Y?Y:ah),af=/webkit/.test(ah)?parseFloat(ah.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,X=!1,ag=[0,0,0],ab=null;if(typeof t.plugins!=D&&typeof t.plugins[S]==r){ab=t.plugins[S].description;if(ab&&(typeof t.mimeTypes==D||!t.mimeTypes[q]||t.mimeTypes[q].enabledPlugin)){T=!0;X=!1;ab=ab.replace(/^.*\s+(\S+\s+\S+$)/,"$1");ag[0]=parseInt(ab.replace(/^(.*)\..*$/,"$1"),10);ag[1]=parseInt(ab.replace(/^.*\.(.*)\s.*$/,"$1"),10);ag[2]=/[a-zA-Z]/.test(ab)?parseInt(ab.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else if(typeof O.ActiveXObject!=D)try{var ad=new ActiveXObject(W);if(ad){ab=ad.GetVariable("$version");if(ab){X=!0;ab=ab.split(" ")[1].split(",");ag=[parseInt(ab[0],10),parseInt(ab[1],10),parseInt(ab[2],10)]}}}catch(Z){}return{w3:aa,pv:ag,wk:af,ie:X,win:ae,mac:ac}}();!function(){if(M.w3){(typeof j.readyState!=D&&"complete"==j.readyState||typeof j.readyState==D&&(j.getElementsByTagName("body")[0]||j.body))&&f();if(!J){typeof j.addEventListener!=D&&j.addEventListener("DOMContentLoaded",f,!1);if(M.ie&&M.win){j.attachEvent(x,function(){if("complete"==j.readyState){j.detachEvent(x,arguments.callee);f()}});O==top&&!function(){if(!J){try{j.documentElement.doScroll("left")}catch(X){setTimeout(arguments.callee,0);return}f()}}()}M.wk&&!function(){J||(/loaded|complete/.test(j.readyState)?f():setTimeout(arguments.callee,0))}();s(f)}}}(),function(){M.ie&&M.win&&window.attachEvent("onunload",function(){for(var ac=I.length,ab=0;ac>ab;ab++)I[ab][0].detachEvent(I[ab][1],I[ab][2]);for(var Z=N.length,aa=0;Z>aa;aa++)y(N[aa]);for(var Y in M)M[Y]=null;M=null;for(var X in swfobject)swfobject[X]=null;swfobject=null})}()}return{registerObject:function(ab,X,aa,Z){if(M.w3&&ab&&X){var Y={};Y.id=ab;Y.swfVersion=X;Y.expressInstall=aa;Y.callbackFn=Z;o[o.length]=Y;w(ab,!1)}else Z&&Z({success:!1,id:ab})},getObjectById:function(X){return M.w3?z(X):void 0},embedSWF:function(ab,ah,ae,ag,Y,aa,Z,ad,af,ac){var X={success:!1,id:ah};if(M.w3&&!(M.wk&&M.wk<312)&&ab&&ah&&ae&&ag&&Y){w(ah,!1);K(function(){ae+="";ag+="";var aj={};if(af&&typeof af===r)for(var al in af)aj[al]=af[al];aj.data=ab;aj.width=ae;aj.height=ag;var am={};if(ad&&typeof ad===r)for(var ak in ad)am[ak]=ad[ak];if(Z&&typeof Z===r)for(var ai in Z)typeof am.flashvars!=D?am.flashvars+="&"+ai+"="+Z[ai]:am.flashvars=ai+"="+Z[ai];if(F(Y)){var an=u(aj,am,ah);aj.id==ah&&w(ah,!0);X.success=!0;X.ref=an}else{if(aa&&A()){aj.data=aa;P(aj,am,ah,ac);return}w(ah,!0)}ac&&ac(X)})}else ac&&ac(X)},switchOffAutoHideShow:function(){m=!1},ua:M,getFlashPlayerVersion:function(){return{major:M.pv[0],minor:M.pv[1],release:M.pv[2]}},hasFlashPlayerVersion:F,createSWF:function(Z,Y,X){return M.w3?u(Z,Y,X):void 0},showExpressInstall:function(Z,aa,X,Y){M.w3&&A()&&P(Z,aa,X,Y)},removeSWF:function(X){M.w3&&y(X)},createCSS:function(aa,Z,Y,X){M.w3&&v(aa,Z,Y,X)},addDomLoadEvent:K,addLoadEvent:s,getQueryParamValue:function(aa){var Z=j.location.search||j.location.hash;if(Z){/\?/.test(Z)&&(Z=Z.split("?")[1]);if(null==aa)return L(Z);for(var Y=Z.split("&"),X=0;X<Y.length;X++)if(Y[X].substring(0,Y[X].indexOf("="))==aa)return L(Y[X].substring(Y[X].indexOf("=")+1))}return""},expressInstallCallback:function(){if(a){var X=c(R);if(X&&l){X.parentNode.replaceChild(l,X);if(Q){w(Q,!0);M.ie&&M.win&&(l.style.display="block")}E&&E(B)}a=!1}}}}();define("swfobject",function(global){return function(){var ret;return ret||global.swfobject}}(this));Splunk.namespace("Splunk.Session");Splunk.Session=$.klass({EVENT_BUFFER_TIMEOUT:1e3,UI_INACTIVITY_TIMEOUT:60,START_EVENT:"SessionStart",TIMEOUT_EVENT:"SessionTimeout",RESTART_EVENT:"HaltOnRestart",UI_EVENT_TYPES:["click","keydown","mouseover","scroll"],initialize:function(){this.eventBuffer=[];this.timeoutDelay=Splunk.util.getConfigValue("UI_INACTIVITY_TIMEOUT",this.UI_INACTIVITY_TIMEOUT);this.timeoutDelay*=6e4;this.timeoutID=null;$(document).bind(this.START_EVENT,this.onSessionStart.bind(this));if(!this.timeoutDelay<1){$(document).bind(this.TIMEOUT_EVENT,this.onSessionTimeout.bind(this));$(document).bind(this.UI_EVENT_TYPES.join(" "),this.onUIEvent.bind(this));this.startTimeout()}$(document).trigger(this.START_EVENT,new Date)},onUIEvent:function(){if(this.timeoutID){this.eventBuffer.push("");if(1===this.eventBuffer.length){this.resetTimeout();setTimeout(function(){this.eventBuffer=[]}.bind(this),this.EVENT_BUFFER_TIMEOUT)}}else{this.startTimeout();$(document).trigger(this.START_EVENT,new Date)}},onSessionStart:function(){},onSessionTimeout:function(){},resetTimeout:function(){this.stopTimeout();this.startTimeout()},signalRestart:function(){$(document).trigger(this.RESTART_EVENT)},startTimeout:function(){this.timeoutID=window.setTimeout(this.timeoutHandler.bind(this),this.timeoutDelay)},stopTimeout:function(){if(this.timeoutID){window.clearTimeout(this.timeoutID);this.timeoutID=null}},timeoutHandler:function(){this.stopTimeout();$(document).trigger(this.TIMEOUT_EVENT,new Date)}});Splunk.Session.instance=null;Splunk.Session.getInstance=function(){Splunk.Session.instance||(Splunk.Session.instance=new Splunk.Session);return Splunk.Session.instance};define("splunk.session",["lowpro","splunk","jquery","splunk.logger","splunk.util","swfobject"],function(global){return function(){var ret;return ret||global.Splunk.Session}}(this));define("helpers/Session",["backbone","underscore","splunk.session"],function(Backbone,_,SplunkSession){var Session=function(){this._session=new SplunkSession;this.cid=_.uniqueId();this.timeout="SessionTimeout."+this.cid;this.start="SessionStart."+this.cid;this.restart="HaltOnRestart."+this.cid;$(document).on(this.timeout,function(){this.trigger("timeout")}.bind(this));$(document).on(this.start,function(){this.trigger("start")}.bind(this));$(document).on(this.restart,function(){this.trigger("restart")}.bind(this))};_.extend(Session.prototype,Backbone.Events,{dispose:function(){$(document).off(this.timeout);$(document).off(this.start);$(document).off(this.restart)}});return new Session});define("mixins/modelcollection",["underscore","util/Ticker","helpers/Session"],function(_,Ticker,Session){return{safeFetch:function(){if(this.isFetching())this.touched=arguments;else{delete this.touched;this.fetch.apply(this,arguments)}},isFetching:function(){return this.fetchXhr&&this.fetchXhr.state&&"pending"===this.fetchXhr.state()},fetchAbort:function(){if(this.isFetching()){delete this.touched;_.isFunction(this.fetchXhr.abort)&&this.fetchXhr.abort()}},deepOff:function(){this.fetchAbort();_(this.associated).each(function(associated){_.isFunction(associated.deepOff)&&associated.deepOff()},this);_.isFunction(this.fetchData.deepOff)?this.fetchData.deepOff():this.fetchData.off();this.off()},DEFAULT_POLLING_DELAY:1e3,ticker:null,startPolling:function(options){options=options||{};if(this.ticker)throw new Error("startPolling cannot be called while already polling");this.ticker=new Ticker({interval:options.delay||this.DEFAULT_POLLING_DELAY});this.ticker.on("tick",function(){options.condition&&!options.condition(this)?this.stopPolling():this.safeFetch({data:options.data})},this);options.stopOnError!==!1&&this.on("error",this.stopPolling,this);options.uiInactivity&&Session.on("timeout",this.stopPolling,this);this.ticker.start(!0)},stopPolling:function(){if(this.ticker){this.ticker.stop();this.ticker.off()}this.off("error",this.stopPolling,this);Session.off("timeout",this.stopPolling,this);this.ticker=null}}});define("util/math_utils",["underscore"],function(_){var DECIMAL_OR_SCIENTIFIC_REGEX=/(^[-+]?[0-9]*[.]?[0-9]*$)|(^[-+]?[0-9][.]?[0-9]*e[-+]?[1-9][0-9]*$)/,strictParseFloat=function(str){return DECIMAL_OR_SCIENTIFIC_REGEX.test(str)?parseFloat(str):0/0},roundToDecimal=function(value,exp){if("undefined"==typeof exp||0===+exp)return Math.round(value);value=+value;exp=+exp;if(isNaN(value)||"number"!=typeof exp||exp%1!==0)return 0/0;value=value.toString().split("e");value=Math.round(+(value[0]+"e"+(value[1]?+value[1]-exp:-exp)));value=value.toString().split("e");return+(value[0]+"e"+(value[1]?+value[1]+exp:exp))},isInteger=function(value){var parsedValue=strictParseFloat(value);return!isNaN(parsedValue)&&parsedValue%1===0},nearestMatchAndIndexInArray=function(valueToMatch,values){var closestValue,closestIndex;_.each(values,function(value,index){if(null==closestValue||Math.abs(valueToMatch-value)<Math.abs(closestValue-valueToMatch)){closestValue=value;closestIndex=index}});return{value:closestValue,index:closestIndex}};return{strictParseFloat:strictParseFloat,roundToDecimal:roundToDecimal,isInteger:isInteger,nearestMatchAndIndexInArray:nearestMatchAndIndexInArray}});define("util/general_utils",["jquery","underscore","util/math_utils"],function($,_,mathUtils){var unionWithKey=function(arrayOne,arrayTwo,key){var union=_.union(arrayOne,arrayTwo);return _.map(union,function(field){var ret_hash={};ret_hash[key]=field;return ret_hash})},differenceWithKey=function(arrayOne,arrayTwo,key){var difference=_.difference(arrayOne,arrayTwo);return _.map(difference,function(field){var ret_hash={};ret_hash[key]=field;return ret_hash})},filterObjectByRegexes=function(obj,regexes,options){options=options||{};_(regexes).isArray()||(regexes=[regexes]);regexes=_.map(regexes,function(regex){return regex instanceof RegExp?regex:new RegExp(regex)});var strippedKey,attrs={},strip=_.isString(options.strip)?options.strip:"",allowEmpty=!!options.allowEmpty,allowObject=!!options.allowObject;_.each(obj,function(value,key){strippedKey=key.replace(strip,"");attrs[strippedKey]||_.each(regexes,function(regex){if(regex.test(key)&&!_.isUndefined(value)){if(_.isString(value)&&""==value&&!allowEmpty||_.isObject(value)&&!allowObject)return;attrs[strippedKey]=value}},this)},this);return attrs},deleteFromObjectByRegexes=function(obj,regexes){_(regexes).isArray()||(regexes=[regexes]);regexes=_.map(regexes,function(regex){return regex instanceof RegExp?regex:new RegExp(regex)});var attrs=$.extend(!0,{},obj);_.each(attrs,function(value,key){_.each(regexes,function(regex){regex.test(key)&&delete attrs[key]},this)},this);return attrs},compareWithDirection=function(value1,value2,isAsc){var returnVal=0;if(value1==value2)return returnVal;returnVal=value2>value1?-1:1;return isAsc?returnVal:-returnVal},valuesAreNumeric=function(values){var numericCount=0,nonNullCount=0;_(values).each(function(value){_(value).isArray()&&(value=value.length>0?value[0]:null);if(!_(value).isNull()){nonNullCount++;var floatValue=mathUtils.strictParseFloat(value);_(floatValue).isNaN()||numericCount++}});return 0===nonNullCount?!1:numericCount>=nonNullCount/2},getPercentiles=function(orderedList,lowerPercentile,upperPercentile){if(0===orderedList.length)return{upper:null,lower:null};var f=function(p,ln){var n=p*(ln-1)+1,k=Math.floor(n),d=n-k;return[n,k,d]},v=function(percentile,oList){var fArray=f(percentile,oList.length),k=(fArray[0],fArray[1]),d=fArray[2];return 0===k||1===oList.length?oList[0]:k===oList.length-1?oList[oList.length-1]:oList[k]+d*(oList[k+1]-oList[k])};return{lower:v(lowerPercentile,orderedList),upper:v(upperPercentile,orderedList)}},transferKey=function(obj,oldKey,newKey){if(!_.isUndefined(obj[oldKey])){obj[newKey]=obj[oldKey];delete obj[oldKey]}},invert=function(obj){var new_obj={};for(var prop in obj)obj.hasOwnProperty(prop)&&(new_obj[obj[prop]]=prop);return new_obj},convertNumToString=function(num){return num?num.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"):null},isValidPivotSearch=function(searchString){if(!/^\s*\|\s*pivot\s+/.test(searchString))return!1;searchString=searchString.replace(/(\\"|\\')/g,"");searchString=searchString.replace(/".*"/g,"").replace(/'.*'/g,"");return 2===searchString.split("|").length},strEndsWith=function(str,suffix){return str&&suffix?-1!==str.indexOf(suffix,str.length-suffix.length):!1},getMouseSelection=function(){return window.getSelection?window.getSelection().toString():document.selection?document.selection.createRange().text:null},isTrueEquivalent=function(value){value="string"==typeof value?value.toLowerCase():value;return value===!0||1===value||"true"===value||"1"===value||"on"===value||"yes"===value},isFalseEquivalent=function(value){value="string"==typeof value?value.toLowerCase():value;return value===!1||0===value||"false"===value||"0"===value||"off"===value||"no"===value},isBooleanEquivalent=function(value){return isTrueEquivalent(value)||isFalseEquivalent(value)},normalizeBoolean=function(value,options){options||(options={});return isTrueEquivalent(value)?!0:isFalseEquivalent(value)?!1:options.hasOwnProperty("default")?"boolean"==typeof options["default"]?options["default"]:normalizeBoolean(options["default"]):!1},checkEquality=function(value1,value2){return isBooleanEquivalent(value1)&&isBooleanEquivalent(value2)?normalizeBoolean(value1)===normalizeBoolean(value2):_.isEqual(value1,value2)};return{compareWithDirection:compareWithDirection,unionWithKey:unionWithKey,differenceWithKey:differenceWithKey,filterObjectByRegexes:filterObjectByRegexes,deleteFromObjectByRegexes:deleteFromObjectByRegexes,valuesAreNumeric:valuesAreNumeric,getPercentiles:getPercentiles,transferKey:transferKey,convertNumToString:convertNumToString,invert:invert,isValidPivotSearch:isValidPivotSearch,strEndsWith:strEndsWith,getMouseSelection:getMouseSelection,normalizeBoolean:normalizeBoolean,isBooleanEquivalent:isBooleanEquivalent,checkEquality:checkEquality}});define("util/splunkd_utils",["jquery","underscore","splunk.util","splunk.config"],function($,_,splunkUtils,splunkConfig){var SYSTEM="system",GLOBAL="global",APP="app",USER="user",NOBODY="nobody",WILDCARD="-",VERBOSE="verbose",FAST="fast",SMART="smart",FATAL="fatal",ERROR="error",WARNING="warn",INFO="info",NETWORK_ERROR="network_error",NOT_FOUND="404",fullpath=function(path,options){options=options||{};var isServicesPath=/^\/services/.test(path),isAbsolute=/^\/.*/.test(path);if(isAbsolute&&!isServicesPath)return path;if(isAbsolute&&isServicesPath)return splunkConfig.SPLUNKD_PATH+path;if(!options.app&&!options.owner)return splunkConfig.SPLUNKD_PATH+"/services/"+path;var owner=options.owner||WILDCARD,app=options.app||WILDCARD;options.sharing=(options.sharing||"").toLowerCase();if(options.sharing===APP||options.sharing===GLOBAL)owner=NOBODY;else if(options.sharing===SYSTEM){owner=NOBODY;app=SYSTEM}return splunkConfig.SPLUNKD_PATH+"/servicesNS/"+encodeURIComponent(owner)+"/"+encodeURIComponent(app)+"/"+path},xhrErrorResponseParser=function(response,id){var responseData={},isValidJSON=!0,messages=[];id=id||_("object from SplunkD").t();if(response.hasOwnProperty("responseText")&&response.hasOwnProperty("getResponseHeader")){var contentType=response.getResponseHeader("Content-Type");if(contentType&&contentType.indexOf("application/json")>-1&&response.responseText)try{responseData=JSON.parse(response.responseText)}catch(e){isValidJSON=!1}}response.hasOwnProperty("data")&&(responseData=responseData.data);response.hasOwnProperty("status")&&(404==response.status&&$.isEmptyObject(responseData)?messages.push(createMessageObject(NOT_FOUND,splunkUtils.sprintf(_("Could not retrieve %s. Make sure that this resource exists and has the correct permissions.").t(),id))):(0==response.status||12029==response.status)&&messages.push(createMessageObject(NETWORK_ERROR,_("Your network connection may have been lost or Splunk may be down.").t())));if(isValidJSON)if(responseData.messages)messages=messages.concat(parseMessagesObject(responseData.messages));else if(response.messages){var responseMessages=parseMessagesObject(response.messages);responseMessages.length?messages=messages.concat(responseMessages):messages.push(createMessageObject(ERROR,_("Server error").t()))}else _.isString(response)&&messages.push(createMessageObject(ERROR,response));else messages.push(createMessageObject(ERROR,splunkUtils.sprintf(_("Invalid JSON from: %s.").t(),id)));messages.length||messages.push(createMessageObject(ERROR,_("Server error").t()));return messages},prepareSyncOptions=function(options,baseUrl){var appOwner={},defaults={data:{output_mode:"json"}};if(options&&options.data){appOwner=$.extend(appOwner,{app:options.data.app||void 0,owner:options.data.owner||void 0,sharing:options.data.sharing||void 0});delete options.data.app;delete options.data.owner;delete options.data.sharing}defaults.url=fullpath(baseUrl,appOwner);return $.extend(!0,defaults,options||{})},nameFromString=function(str){str=str||"";return str.toLowerCase().replace(/\s/g,"_").replace(/\W/g,"")},VALUES_REGEX=/(\'.*?\')|(\".*?\")|([^\s]+)/g,QUOTES_REGEX=/^(\".*\")$|^(\'.*\')$/,createSearchFilterString=function(value,keys){var values=value?value.match(VALUES_REGEX):[];return _(keys).map(function(key){return values.length?"("+_.chain(values).map(function(value){if(value.match(QUOTES_REGEX)){var len=value.length;value=value.substring(1,len-1)}return[key,'="*',value.replace(/'/g,"\\'").replace(/"/g,'\\"'),'*"'].join("")},this).join(" AND ").value()+")":[key,"=*"].join("")},this).join(" OR ")},createSearchFilterObj=function(value,keys){var values=value?value.match(VALUES_REGEX):[],filterObj={};if(values.length){var matches=[];_(values).each(function(value){if(value.match(QUOTES_REGEX)){var len=value.length;value=value.substring(1,len-1)}matches.push(value.replace(/'/g,"\\'").replace(/"/g,'"'))},this);_(keys).each(function(key){filterObj[key]=matches},this)}return filterObj},parseError=function(error){var parsedError,passedErrors={};if(error.responseText){try{parsedError=JSON.parse(error.responseText)}catch(e){parsedError={}}parsedError.messages&&_.each(parsedError.messages,function(value){passedErrors["splunkD:"+value.type]=value.text})}else passedErrors=error;return passedErrors},createMessageObject=function(type,message){type=type.toLowerCase();var jsonMsg,jsonStart=message.indexOf("~!~{"),jsonEnd=message.lastIndexOf("}~!~"),messageText=message;if(-1!=jsonStart&&-1!=jsonEnd)try{var jsonBlock=message.slice(jsonStart+3,jsonEnd+1);jsonMsg=JSON.parse(jsonBlock);messageText=jsonMsg.errorMessageEnglish}catch(e){}return{key:_.uniqueId("splunkd_"+type),type:type,message:messageText,text:messageText}},parseMessagesObject=function(messages){return messages?_(messages).map(function(message){return createMessageObject(message.type,message.text)}):[]},messagesContainsOneOfTypes=function(messages,types){if(messages)for(var i=0;i<messages.length;i++)if(-1!=_.indexOf(types,messages[i].type))return!0;return!1},filterMessagesByTypes=function(messages,types){var filteredMessages=[];if(messages)for(var i=0;i<messages.length;i++)-1!=_.indexOf(types,messages[i].type)&&filteredMessages.push(messages[i]);return filteredMessages},normalizeType=function(type){return type===FATAL?ERROR:type===WARNING?"warning":type},addAnchorsToWildcardArray=function(wildcardArray){return _.map(wildcardArray,function(wildcard){return/^\^/.test(wildcard)?wildcard:"^"+wildcard})},createSplunkDMessage=function(type,text){return{messages:[{type:type,text:text}]}},getSharingLabel=function(sharing){switch(sharing){case USER:return _("Private").t();case APP:return _("App").t();case GLOBAL:return _("Global").t();case SYSTEM:return _("Global").t()}},getPermissionLabel=function(sharing,owner){switch(sharing){case USER:return splunkUtils.sprintf(_("Private. Owned by %s.").t(),owner);case APP:return splunkUtils.sprintf(_("Shared in App. Owned by %s.").t(),owner);case GLOBAL:case SYSTEM:return splunkUtils.sprintf(_("Shared Globally. Owned by %s.").t(),owner)}return""},normalizeValuesForPOST=function(values){var valuesCopy=$.extend(!0,{},values);_.each(valuesCopy,function(value,key){"boolean"==typeof value&&(valuesCopy[key]=value?"1":"0")});return valuesCopy},normalizeBooleanTo01String=function(value){var bool=splunkUtils.normalizeBoolean(value);return bool?"1":"0"},isExistingEntity=function(payload){return payload&&payload.entry&&_.isArray(payload.entry)&&payload.entry[0].links&&payload.entry[0].links.alternate&&!/.\/_new$/.test(payload.entry[0].links.alternate)?!0:!1};return{FATAL:FATAL,ERROR:ERROR,WARNING:WARNING,INFO:INFO,NOT_FOUND:NOT_FOUND,NETWORK_ERROR:NETWORK_ERROR,SYSTEM:SYSTEM,GLOBAL:GLOBAL,APP:APP,USER:USER,NOBODY:NOBODY,WILDCARD:WILDCARD,VERBOSE:VERBOSE,FAST:FAST,SMART:SMART,VALUES_REGEX:VALUES_REGEX,QUOTES_REGEX:QUOTES_REGEX,fullpath:fullpath,prepareSyncOptions:prepareSyncOptions,nameFromString:nameFromString,createSearchFilterString:createSearchFilterString,createSearchFilterObj:createSearchFilterObj,parseError:parseError,parseMessagesObject:parseMessagesObject,createMessageObject:createMessageObject,messagesContainsOneOfTypes:messagesContainsOneOfTypes,addAnchorsToWildcardArray:addAnchorsToWildcardArray,createSplunkDMessage:createSplunkDMessage,getSharingLabel:getSharingLabel,getPermissionLabel:getPermissionLabel,normalizeType:normalizeType,filterMessagesByTypes:filterMessagesByTypes,xhrErrorResponseParser:xhrErrorResponseParser,normalizeValuesForPOST:normalizeValuesForPOST,normalizeBooleanTo01String:normalizeBooleanTo01String,isExistingEntity:isExistingEntity}});!function(factory){"object"==typeof exports?module.exports=factory(require("backbone"),require("underscore")):"function"==typeof define&&define.amd&&define("backbone_validation",["backbone","underscore"],factory)}(function(Backbone,_){Backbone.Validation=function(_){var defaultOptions={forceUpdate:!1,selector:"name",labelFormatter:"sentenceCase",valid:Function.prototype,invalid:Function.prototype},formatFunctions={formatLabel:function(attrName,model){return defaultLabelFormatters[defaultOptions.labelFormatter](attrName,model)},format:function(){var args=Array.prototype.slice.call(arguments),text=args.shift();return text.replace(/\{(\d+)\}/g,function(match,number){return"undefined"!=typeof args[number]?args[number]:match})}},flatten=function(obj,into,prefix){into=into||{};prefix=prefix||"";_.each(obj,function(val,key){obj.hasOwnProperty(key)&&(val&&"object"==typeof val&&!(val instanceof Array||val instanceof Date||val instanceof RegExp||val instanceof Backbone.Model||val instanceof Backbone.Collection)?flatten(val,into,prefix+key+"."):into[prefix+key]=val)});return into},Validation=function(){var getValidatedAttrs=function(model){return _.reduce(_.keys(model.validation||{}),function(memo,key){memo[key]=void 0;return memo},{})},getValidators=function(model,attr){var attrValidationSet=model.validation?model.validation[attr]||{}:{};(_.isFunction(attrValidationSet)||_.isString(attrValidationSet))&&(attrValidationSet={fn:attrValidationSet});_.isArray(attrValidationSet)||(attrValidationSet=[attrValidationSet]);return _.reduce(attrValidationSet,function(memo,attrValidation){_.each(_.without(_.keys(attrValidation),"msg"),function(validator){memo.push({fn:defaultValidators[validator],val:attrValidation[validator],msg:attrValidation.msg})});return memo},[])},validateAttr=function(model,attr,value,computed){return _.reduce(getValidators(model,attr),function(memo,validator){var ctx=_.extend({},formatFunctions,defaultValidators),result=validator.fn.call(ctx,value,attr,validator.val,model,computed);return result===!1||memo===!1?!1:result&&!memo?validator.msg||result:memo},"")},validateModel=function(model,attrs){var error,invalidAttrs={},isValid=!0,computed=_.clone(attrs),flattened=flatten(attrs);_.each(flattened,function(val,attr){error=validateAttr(model,attr,val,computed);if(error){invalidAttrs[attr]=error;isValid=!1}});return{invalidAttrs:invalidAttrs,isValid:isValid}},mixin=function(view,options){return{preValidate:function(attr,value){return validateAttr(this,attr,value,_.extend({},this.attributes))},isValid:function(option){var flattened=flatten(this.attributes);if(_.isString(option))return!validateAttr(this,option,flattened[option],_.extend({},this.attributes));if(_.isArray(option))return _.reduce(option,function(memo,attr){return memo&&!validateAttr(this,attr,flattened[attr],_.extend({},this.attributes))},!0,this);option===!0&&this.validate();return this.validation?this._isValid:!0},validate:function(attrs,setOptions){var model=this,validateAll=!attrs,opt=_.extend({},options,setOptions),validatedAttrs=getValidatedAttrs(model),allAttrs=_.extend({},validatedAttrs,model.attributes,attrs),changedAttrs=flatten(attrs||allAttrs),result=validateModel(model,allAttrs);model._isValid=result.isValid;_.each(validatedAttrs,function(val,attr){var invalid=result.invalidAttrs.hasOwnProperty(attr);invalid||opt.valid(view,attr,opt.selector)});_.each(validatedAttrs,function(val,attr){var invalid=result.invalidAttrs.hasOwnProperty(attr),changed=changedAttrs.hasOwnProperty(attr);invalid&&(changed||validateAll)&&opt.invalid(view,attr,result.invalidAttrs[attr],opt.selector)});_.defer(function(){model.trigger("validated",model._isValid,model,result.invalidAttrs);model.trigger("validated:"+(model._isValid?"valid":"invalid"),model,result.invalidAttrs)});return!opt.forceUpdate&&_.intersection(_.keys(result.invalidAttrs),_.keys(changedAttrs)).length>0?result.invalidAttrs:void 0}}},bindModel=function(view,model,options){_.extend(model,mixin(view,options))},unbindModel=function(model){delete model.validate;delete model.preValidate;delete model.isValid},collectionAdd=function(model){bindModel(this.view,model,this.options)},collectionRemove=function(model){unbindModel(model)};return{version:"0.8.1",configure:function(options){_.extend(defaultOptions,options)},bind:function(view,options){var model=view.model,collection=view.collection;options=_.extend({},defaultOptions,defaultCallbacks,options);if("undefined"==typeof model&&"undefined"==typeof collection)throw"Before you execute the binding your view must have a model or a collection.\nSee http://thedersen.com/projects/backbone-validation/#using-form-model-validation for more information.";if(model)bindModel(view,model,options);else if(collection){collection.each(function(model){bindModel(view,model,options)});collection.bind("add",collectionAdd,{view:view,options:options});collection.bind("remove",collectionRemove)}},unbind:function(view){var model=view.model,collection=view.collection;model&&unbindModel(view.model);if(collection){collection.each(function(model){unbindModel(model)});collection.unbind("add",collectionAdd);collection.unbind("remove",collectionRemove)}},mixin:mixin(null,defaultOptions)}}(),defaultCallbacks=Validation.callbacks={valid:function(view,attr,selector){view.$("["+selector+'~="'+attr+'"]').removeClass("invalid").removeAttr("data-error")},invalid:function(view,attr,error,selector){view.$("["+selector+'~="'+attr+'"]').addClass("invalid").attr("data-error",error)
}},defaultPatterns=Validation.patterns={digits:/^\d+$/,number:/^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/,email:/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i,url:/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i},defaultMessages=Validation.messages={required:"{0} is required",acceptance:"{0} must be accepted",min:"{0} must be greater than or equal to {1}",max:"{0} must be less than or equal to {1}",range:"{0} must be between {1} and {2}",length:"{0} must be {1} characters",minLength:"{0} must be at least {1} characters",maxLength:"{0} must be at most {1} characters",rangeLength:"{0} must be between {1} and {2} characters",oneOf:"{0} must be one of: {1}",equalTo:"{0} must be the same as {1}",pattern:"{0} must be a valid {1}"},defaultLabelFormatters=Validation.labelFormatters={none:function(attrName){return attrName},sentenceCase:function(attrName){return attrName.replace(/(?:^\w|[A-Z]|\b\w)/g,function(match,index){return 0===index?match.toUpperCase():" "+match.toLowerCase()}).replace(/_/g," ")},label:function(attrName,model){return model.labels&&model.labels[attrName]||defaultLabelFormatters.sentenceCase(attrName,model)}},defaultValidators=Validation.validators=function(){var trim=String.prototype.trim?function(text){return null===text?"":String.prototype.trim.call(text)}:function(text){var trimLeft=/^\s+/,trimRight=/\s+$/;return null===text?"":text.toString().replace(trimLeft,"").replace(trimRight,"")},isNumber=function(value){return _.isNumber(value)||_.isString(value)&&value.match(defaultPatterns.number)},hasValue=function(value){return!(_.isNull(value)||_.isUndefined(value)||_.isString(value)&&""===trim(value)||_.isArray(value)&&_.isEmpty(value))};return{fn:function(value,attr,fn,model,computed){_.isString(fn)&&(fn=model[fn]);return fn.call(model,value,attr,computed)},required:function(value,attr,required,model,computed){var isRequired=_.isFunction(required)?required.call(model,value,attr,computed):required;return isRequired||hasValue(value)?isRequired&&!hasValue(value)?this.format(defaultMessages.required,this.formatLabel(attr,model)):void 0:!1},acceptance:function(value,attr,accept,model){return"true"===value||_.isBoolean(value)&&value!==!1?void 0:this.format(defaultMessages.acceptance,this.formatLabel(attr,model))},min:function(value,attr,minValue,model){return!isNumber(value)||minValue>value?this.format(defaultMessages.min,this.formatLabel(attr,model),minValue):void 0},max:function(value,attr,maxValue,model){return!isNumber(value)||value>maxValue?this.format(defaultMessages.max,this.formatLabel(attr,model),maxValue):void 0},range:function(value,attr,range,model){return!isNumber(value)||value<range[0]||value>range[1]?this.format(defaultMessages.range,this.formatLabel(attr,model),range[0],range[1]):void 0},length:function(value,attr,length,model){return hasValue(value)&&trim(value).length===length?void 0:this.format(defaultMessages.length,this.formatLabel(attr,model),length)},minLength:function(value,attr,minLength,model){return!hasValue(value)||trim(value).length<minLength?this.format(defaultMessages.minLength,this.formatLabel(attr,model),minLength):void 0},maxLength:function(value,attr,maxLength,model){return!hasValue(value)||trim(value).length>maxLength?this.format(defaultMessages.maxLength,this.formatLabel(attr,model),maxLength):void 0},rangeLength:function(value,attr,range,model){return!hasValue(value)||trim(value).length<range[0]||trim(value).length>range[1]?this.format(defaultMessages.rangeLength,this.formatLabel(attr,model),range[0],range[1]):void 0},oneOf:function(value,attr,values,model){return _.include(values,value)?void 0:this.format(defaultMessages.oneOf,this.formatLabel(attr,model),values.join(", "))},equalTo:function(value,attr,equalTo,model,computed){return value!==computed[equalTo]?this.format(defaultMessages.equalTo,this.formatLabel(attr,model),this.formatLabel(equalTo,model)):void 0},pattern:function(value,attr,pattern,model){return hasValue(value)&&value.toString().match(defaultPatterns[pattern]||pattern)?void 0:this.format(defaultMessages.pattern,this.formatLabel(attr,model),pattern)}}}();return Validation}(_);return Backbone.Validation});define("validation/ValidationMixin",["underscore","backbone","backbone_validation"],function(_,Backbone){_.extend(Backbone.Validation.messages,{required:"{label} is required",acceptance:"{label} must be accepted",min:"{label} must be greater than or equal to {1}",max:"{label} must be less than or equal to {1}",range:"{label} must be between {1} and {2}",length:"{label} must be {1} characters",minLength:"{label} must be at least {1} characters",maxLength:"{label} must be at most {1} characters",rangeLength:"{label} must be between {1} and {2} characters",oneOf:"{label} must be one of: {1}",equalTo:"{label} must be the same as {1}",pattern:"{label} must be a valid {1}"});return Backbone.Validation.mixin});define("models/Base",["jquery","underscore","backbone","mixins/modelcollection","util/general_utils","util/splunkd_utils","validation/ValidationMixin"],function($,_,Backbone,modelcollectionMixin,generalUtils,splunkDUtils,ValidationMixin){var BaseModel=Backbone.Model.extend({initialize:function(attributes,options){Backbone.Model.prototype.initialize.apply(this,arguments);this.error=new Backbone.Model;this.fetchData=options&&options.fetchData?options.fetchData:new Backbone.Model;this.associated=this.associated||{};this.associated.error=this.error;this.fetchData.on("change",_.debounce(function(){this.safeFetch()},0),this);this.on("sync",this._onsync,this);this.on("error",this._onerror,this);this.on("validated",this._rebroadcastValidation,this)},fetch:function(options){var mergedOptions=$.extend(!0,{},{data:this.fetchData.toJSON()},options);this.fetchXhr=Backbone.Model.prototype.fetch.call(this,mergedOptions);var that=this;this.fetchXhr.done(function(){that.touched&&that.safeFetch.apply(that,that.touched)});return this.fetchXhr},clear:function(options){options=options||{};_.each(this.associated,function(value){value instanceof Backbone.Model?value.clear(options):value instanceof Backbone.Collection&&value.reset(null,options)});this.error.clear(options);Backbone.Model.prototype.clear.call(this,options);if(options.setDefaults){var defaults=_.result(this,"defaults");defaults&&this.set(defaults,options)}return this},clone:function(){var clonedModel=Backbone.Model.prototype.clone.call(this);_.each(this.associated,function(value,key){if(value instanceof Backbone.Model){var clonedAsscModel=value.clone();clonedModel[key]=clonedAsscModel;clonedModel.associated[key]=clonedAsscModel}else if(value instanceof Backbone.Collection){var clonedAsscCollection=new value.constructor(value.map(function(model){return model.clone()}));clonedModel[key]=clonedAsscCollection;clonedModel.associated[key]=clonedAsscCollection}});return clonedModel},associatedOff:function(events,callback,context){_(this.associated).each(function(associated){associated.off(events,callback,context);_.isFunction(associated.associatedOff)&&associated.associatedOff(events,callback,context)},this);this.fetchData.off(events,callback,context)},clearErrors:function(){this._rebroadcastValidation(!0,this,{})},_rebroadcastValidation:function(validated,model,error_payload){var allKeys=_.union(_.keys(this.attributes),_.keys(error_payload));_(allKeys).each(function(k){this.trigger("attributeValidated:"+k,!_.has(error_payload,k),k,error_payload[k])},this)},_onerror:function(model,response){model.error.clear();var messages=splunkDUtils.xhrErrorResponseParser(response,this.id);this.trigger("serverValidated",!1,this,messages);model.error.set("messages",messages)},_onsync:function(model,response){model.error.clear();var messages=this.parseSplunkDMessages(response),hasErrors=_(messages).any(function(message){return message.type===splunkDUtils.ERROR||message.type===splunkDUtils.FATAL});this.trigger("serverValidated",!hasErrors,this,messages);hasErrors&&model.error.set("messages",messages)},parseSplunkDMessages:function(response){return response?splunkDUtils.parseMessagesObject(response.messages):[]},filterByKeys:function(keys,options,fetchOptions){options=options||{};var attrs={},strip=_.isString(options.strip)?options.strip:"",allowEmpty=!!options.allowEmpty;_.each(this.toJSON(fetchOptions),function(value,key){-1!=_.indexOf(keys,key)&&(_.isUndefined(value)||(""!==value||allowEmpty)&&(attrs[key.replace(strip,"")]=value))},this);return attrs},filterByWildcards:function(wildcards,options,fetchOptions){return generalUtils.filterObjectByRegexes(this.toJSON(fetchOptions),wildcards,options)},filterChangedByWildcards:function(wildcards,options){return generalUtils.filterObjectByRegexes(this.changedAttributes()||{},wildcards,options)},toObject:function(attr){var value=this.get(attr);try{value=JSON.parse(value)}catch(e){}return value},replace:function(attributes,options){this.clear({silent:!0});this.set(attributes,options)},restoreDefaults:function(options){var defaults=_.isFunction(this.defaults)?this.defaults():this.defaults;this.clear(options);this.set(defaults,options)}});_.extend(BaseModel.prototype,ValidationMixin);_.extend(BaseModel.prototype,modelcollectionMixin);return BaseModel});define("splunkjs/mvc/tokenawaremodel",["require","exports","module","underscore","splunkjs/mvc","./tokenescapestring","./tokensafestring","util/console","./tokenutils","models/Base"],function(require){var _=require("underscore"),mvc=require("splunkjs/mvc"),TokenEscapeString=require("./tokenescapestring"),TokenSafeString=require("./tokensafestring"),console=require("util/console"),TokenUtils=require("./tokenutils"),BaseModel=require("models/Base"),VERBOSE=!1,TokenAwareModel=BaseModel.extend({applyTokensByDefault:!1,retrieveTokensByDefault:!1,constructor:function(attributes,options){attributes=attributes||{};options=options||{};this._tokenNamespace=options.tokenNamespace||void 0;this._retainUnmatchedTokens=options.retainUnmatchedTokens;this._tokenEscaper=options.tokenEscaper||void 0;this._tokenRegistry=options._tokenRegistry||mvc.Components;this.tokens=!!options.tokens;this._applyTokensByDefault=options.hasOwnProperty("applyTokensByDefault")?options.applyTokensByDefault:this.applyTokensByDefault;this._retrieveTokensByDefault=options.hasOwnProperty("retrieveTokensByDefault")?options.retrieveTokensByDefault:this.retrieveTokensByDefault;BaseModel.prototype.constructor.call(this,{});this._templates=new BaseModel({});this._bindings={};this._pushed_properties=[];this.listenTo(this._templates,"change",function(model,options){this._updateBindingsForProperties(model.changed,options)});this.set(attributes,options)},_updateBindingsForProperties:function(properties,options){var that=this;_.each(properties,function(propTemplate,propName){var newBinding;if(void 0===propTemplate)newBinding=void 0;else{var tokens=TokenUtils.getTokens(propTemplate,{tokenNamespace:that._tokenNamespace}),computeValueFunc=function(_retainUnmatchedTokens){if(TokenUtils.isToken(propTemplate)){var token=tokens[0],tokenModel=that._tokenRegistry.getInstance(token.namespace,{create:!0}),tokenValue=tokenModel.get(token.name);if(!_.isString(tokenValue)&&void 0!==tokenValue)return tokenValue}var propValue,templateSatisfied=_.all(tokens,function(token){var tokenModel=that._tokenRegistry.getInstance(token.namespace,{create:!0}),tokenValue=tokenModel.get(token.name),filtersSatisfied=_.all(token.filters,function(filter){var filterFunc=TokenUtils.getFilter(filter.name,that._tokenRegistry);return void 0!==filterFunc});return void 0!==tokenValue&&filtersSatisfied});propValue=templateSatisfied||that._retainUnmatchedTokens||_retainUnmatchedTokens?TokenUtils.replaceTokens(propTemplate,that._tokenRegistry,{tokenNamespace:that._tokenNamespace,escaper:that._tokenEscaper}):void 0;return propValue},items=[];_.each(tokens,function(token){items.push({namespace:token.namespace,name:token.name});_.each(token.filters,function(filter){items.push({namespace:TokenUtils._FILTER_NAMESPACE,name:filter.name})})});newBinding={observes:items,template:propTemplate,computeValue:computeValueFunc}}that._setBinding(propName,newBinding,options)})},_setBinding:function(propName,newBinding,options){var that=this;this._disposeBindingListeners(this._bindings[propName]);this._bindings[propName]=newBinding;if(void 0!==newBinding){newBinding._listeners=[];_.each(newBinding.observes,function(observedItem){var observedContext=that._tokenRegistry.getInstance(observedItem.namespace,{create:!0}),observedPropName=observedItem.name,listener=function(){that._pullPropertyValue(propName)};that.listenTo(observedContext,"change:"+observedPropName,listener);listener.dispose=function(){that.stopListening(observedContext,"change:"+observedPropName,listener)};newBinding._listeners.push(listener)});this._isPushEnabled(propName)&&this._configureBindingForPush(propName);this._isPushEnabled(propName)&&void 0!==this.get(propName)?this._pushPropertyValue(propName,options):this._pullPropertyValue(propName,options)}},_pullPropertyValue:function(propName,options){var binding=this._bindings[propName],propValue=binding.computeValue();VERBOSE&&console.log("PROPAGATE: "+propName+" <- "+propValue);options=options||{};if(options.hasOwnProperty("_silent")){options.silent=options._silent;delete options._silent}BaseModel.prototype.set.call(this,propName,propValue,options)},enablePush:function(propName){if(!this._isPushEnabled(propName)){this._pushed_properties.push(propName);void 0!==this._bindings[propName]&&this._configureBindingForPush(propName)}},_isPushEnabled:function(propName){return _.contains(this._pushed_properties,propName)},_configureBindingForPush:function(propName){var binding=this._bindings[propName];if(TokenUtils.isToken(binding.template)){var that=this,listener=function(){that._pushPropertyValue(propName)};this.listenTo(this,"change:"+propName,listener);listener.dispose=function(){that.stopListening(that,"change:"+propName,listener)};binding._listeners.push(listener)}},_pushPropertyValue:function(propName,options){var binding=this._bindings[propName],newValue=this.get(propName),observedItem=binding.observes[0],observedContext=this._tokenRegistry.getInstance(observedItem.namespace,{create:!0}),observedPropName=observedItem.name;VERBOSE&&console.log("PROPAGATE: "+newValue+" -> "+observedPropName);options=options||{};if(options.hasOwnProperty("_silent")){options.silent=options._silent;delete options._silent}observedContext.set(observedPropName,newValue,options)},set:function(key,val,options){var attrs,that=this;if("object"==typeof key){attrs=key;options=val}else(attrs={})[key]=val;options=options||{};options.hasOwnProperty("tokens")||(options.tokens=this._applyTokensByDefault);var bulkTemplateSets={},bulkTemplateUnsets=[],bulkSelfSets={},queueTemplateSet=function(propName,propTemplate){bulkTemplateSets[propName]=propTemplate},queueLiteralSet=function(propName,propValue){that._isPushEnabled(propName)||bulkTemplateUnsets.push(propName);bulkSelfSets[propName]=propValue};_.each(attrs,function(propValue,propName){propValue instanceof TokenSafeString?queueTemplateSet(propName,propValue.value):propValue instanceof TokenEscapeString?queueLiteralSet(propName,propValue.value):_.isString(propValue)&&options.tokens?queueTemplateSet(propName,propValue):queueLiteralSet(propName,propValue)});var optionsForTemplates=_.clone(options);if(options.hasOwnProperty("silent")){optionsForTemplates._silent=options.silent;delete optionsForTemplates.silent}_.isEmpty(bulkTemplateSets)||this._templates.set(bulkTemplateSets,optionsForTemplates);_.isEmpty(bulkTemplateUnsets)||_.each(bulkTemplateUnsets,function(propName){that._templates&&that._templates.has(propName)&&that._templates.unset(propName,optionsForTemplates)});_.isEmpty(bulkSelfSets)||BaseModel.prototype.set.call(this,bulkSelfSets,options)},get:function(key,options){options||(options={});options.hasOwnProperty("tokens")||(options.tokens=this._retrieveTokensByDefault);return options.tokens?this._templates.has(key)?this._templates.get(key):TokenUtils.quoteAsTokenString(BaseModel.prototype.get.call(this,key)):BaseModel.prototype.get.call(this,key)},extractWithPrefix:function(prefix){var that=this,extractedProperties={};_.each(_.keys(this.attributes),function(propNameOnThis){if(0===propNameOnThis.indexOf(prefix)){var propValue,propName=propNameOnThis.substring(prefix.length),templateValue=that.get(propNameOnThis,{tokens:!0});propValue=void 0!==templateValue?mvc.tokenSafe(templateValue):that.get(propNameOnThis);extractedProperties[propName]=propValue}});return extractedProperties},toJSON:function(options){options||(options={});options.hasOwnProperty("tokens")||(options.tokens=this._retrieveTokensByDefault);if(options.tokens){var that=this,result={};_.each(this.attributes,function(value,key){result[key]=that.get(key,{tokens:!0})});result=_.extend(result,this._templates.toJSON());return result}return BaseModel.prototype.toJSON.apply(this,arguments)},dispose:function(){this._templates.deepOff();_.each(this._bindings,this._disposeBindingListeners);this._bindings={};this.deepOff()},_disposeBindingListeners:function(binding){if(binding){_.each(binding._listeners,function(listener){listener.dispose()});binding._listeners=[]}}});TokenAwareModel._createReportModel=function(attributes){return new TokenAwareModel(attributes||{},{applyTokensByDefault:!0,retainUnmatchedTokens:!0})};return TokenAwareModel});define("splunkjs/mvc/searchmodel",["require","exports","module","underscore","./tokenawaremodel","./tokensafestring","splunk.util"],function(require){var TokenAwareModel=(require("underscore"),require("./tokenawaremodel")),TokenSafeString=require("./tokensafestring"),splunkUtils=require("splunk.util"),SearchSettingsModel=TokenAwareModel.extend({set:function(key,val,options){var attrs;if(null==key)return this;if("object"==typeof key){attrs=key;options=val}else(attrs={})[key]=val;options&&options.qualified&&attrs.search&&(attrs.search=attrs.search instanceof TokenSafeString?new TokenSafeString(splunkUtils.stripLeadingSearchCommand(attrs.search.value)):splunkUtils.stripLeadingSearchCommand(attrs.search));return TokenAwareModel.prototype.set.call(this,attrs,options)},get:function(attribute,options){var result=TokenAwareModel.prototype.get.apply(this,arguments);"search"===attribute&&options&&options.qualified&&result&&(result=splunkUtils.addLeadingSearchCommand(result));return result},resolve:function(options){return this.get("search",options)}});SearchSettingsModel.ALLOWED_ATTRIBUTES=["adhoc_search_level","auto_cancel","auto_finalize_ec","auto_pause","buckets","earliest_time","enable_lookups","exec_mode","force_bundle_replication","indexedRealtime","latest_time","label","lookups","max_count","max_time","namespace","now","preview","reduce_freq","reload_macros","remote_server_list","required_field_list","rf","rt_backfill","rt_blocking","rt_indexfilter","rt_maxblocksecs","rt_queue_size","search","search_listener","search_mode","spawn_process","status_buckets","sync_bundle_replication","time_format","timeout","ttl"];return{SearchSettingsModel:SearchSettingsModel,SearchJob:SearchSettingsModel,SearchQuery:SearchSettingsModel}});define("splunkjs/mvc/jobtracker",["require","underscore","backbone","splunkjs/mvc","util/console"],function(require){var _=require("underscore"),Backbone=require("backbone"),mvc=require("splunkjs/mvc"),console=require("util/console"),MONITORED_PROPERTIES=["dispatchState","scanCount","resultCount","eventCount","eventAvailableCount","isDone","isFailed","isFinalized","doneProgress"],FAST_FETCH_PERIOD=200,SLOW_FETCH_PERIOD=1e3,JobTracker=function(){this.initialize.apply(this,arguments)};_.extend(JobTracker.prototype,Backbone.Events,{initialize:function(){this._active={};this._inflight=null;this._timer=null;this._fresh=!1;this._fetch=_.bind(this._fetch,this)},track:function(job,callbacks){this._active[job.sid]=this._initializeItem(job,callbacks||{});this._fresh=!0;this._scheduleNextFetch()},untrack:function(sid){var item=this._active[sid];if(item){item._stop=!0;delete this._active[sid]}},_initializeItem:function(job,callbacks){var item={job:job,model:new Backbone.Model};_.isFunction(callbacks.progress)&&item.model.on("change",function(){callbacks.progress(job)});_.isFunction(callbacks.ready)&&item.model.once("change:dispatchState",item.callbacks.ready);_.isFunction(callbacks.done)&&item.model.on("done",callbacks.done);_.isFunction(callbacks.failed)&&item.model.on("failed",callbacks.failed);_.isFunction(callbacks.error)&&item.model.on("error",callbacks.error);return item},_scheduleNextFetch:function(){if(!this._timer&&!this._inflight){var timeout=this._fresh?FAST_FETCH_PERIOD:SLOW_FETCH_PERIOD;this._timer=setTimeout(this._fetch,timeout)}},_fetch:function(){this._timer=null;var requestedJobs=_.clone(this._active);if(!_.isEmpty(requestedJobs)){var requestedSIDs=_(requestedJobs).keys(),service=mvc.createService({app:"-",owner:"-"}),tracker=this;this._inflight=service.jobs().get("",{id:requestedSIDs,count:requestedSIDs.length},function(err,response){tracker._inflight=null;if(err){console.error("Error fetching search jobs: %o",err);_(requestedJobs).chain().pluck("model").invoke("trigger",["error",err]);tracker._scheduleNextFetch()}else{var data=response.data,newActive={},oldActive=tracker._active;_(oldActive).each(function(item,sid){requestedJobs.hasOwnProperty(sid)||(newActive[sid]=item)});tracker._fresh=_.isEmpty(newActive)?!1:!0;var returnedSIDs=_(data.entry).map(function(entry){var sid=entry.content.sid,item=requestedJobs[sid],job=item.job,model=item.model;if(item._stop)return sid;job._load(entry);model.set(_.pick(entry.content,MONITORED_PROPERTIES));var props=job.properties(),dispatchState=props.dispatchState;if(props.isFailed||props.isZombie||"FAILED"===dispatchState){model.trigger("failed",job);model.off()}else if(props.isDone||"DONE"===dispatchState){model.trigger("done",job);model.off()}else newActive[sid]=item;return sid});returnedSIDs=_(returnedSIDs);_(requestedSIDs).each(function(sid){if(!returnedSIDs.contains(sid)){var item=oldActive[sid];if(!item)return;if(item._stop)return;if(item.model.has("dispatchState")&&void 0!==item.model.get("dispatchState")){item.model.trigger("error",_("The job has not been found").t());tracker._itemDone(item)}else{newActive[sid]=item;tracker._fresh=!0}}});tracker._active=newActive;tracker._scheduleNextFetch()}})}},_itemDone:function(item){item.model.off()}});return new JobTracker});define("splunkjs/contrib/require-css/normalize",["require","module"],function(){function convertURIBase(uri,fromBase,toBase){if(0===uri.indexOf("data:"))return uri;uri=removeDoubleSlashes(uri);if(uri.match(/^\//)||uri.match(protocolRegEx))return uri;var toBaseProtocol=toBase.match(protocolRegEx),fromBaseProtocol=fromBase.match(protocolRegEx);return!fromBaseProtocol||toBaseProtocol&&toBaseProtocol[1]==fromBaseProtocol[1]&&toBaseProtocol[2]==fromBaseProtocol[2]?relativeURI(absoluteURI(uri,fromBase),toBase):absoluteURI(uri,fromBase)}function absoluteURI(uri,base){"./"==uri.substr(0,2)&&(uri=uri.substr(2));var baseParts=base.split("/"),uriParts=uri.split("/");baseParts.pop();for(;curPart=uriParts.shift();)".."==curPart?baseParts.pop():baseParts.push(curPart);return baseParts.join("/")}function relativeURI(uri,base){var baseParts=base.split("/");baseParts.pop();base=baseParts.join("/")+"/";i=0;for(;base.substr(i,1)==uri.substr(i,1);)i++;for(;"/"!=base.substr(i,1);)i--;base=base.substr(i+1);uri=uri.substr(i+1);baseParts=base.split("/");var uriParts=uri.split("/");out="";for(;baseParts.shift();)out+="../";for(;curPart=uriParts.shift();)out+=curPart+"/";return out.substr(0,out.length-1)}var slashes=/([^:])\/+/g,removeDoubleSlashes=function(uri){return uri.replace(slashes,"$1/")},protocolRegEx=/[^\:\/]*:\/\/([^\/])*/,normalizeCSS=function(source,fromBase,toBase){fromBase=removeDoubleSlashes(fromBase);toBase=removeDoubleSlashes(toBase);for(var result,url,source,urlRegEx=/@import\s*("([^"]*)"|'([^']*)')|url\s*\(\s*(\s*"([^"]*)"|'([^']*)'|[^\)]*\s*)\s*\)/gi;result=urlRegEx.exec(source);){url=result[3]||result[2]||result[5]||result[6]||result[4];var newUrl=convertURIBase(url,fromBase,toBase),quoteLen=result[5]||result[6]?1:0;source=source.substr(0,urlRegEx.lastIndex-url.length-quoteLen-1)+newUrl+source.substr(urlRegEx.lastIndex-quoteLen-1);urlRegEx.lastIndex=urlRegEx.lastIndex+(newUrl.length-url.length)}return source};normalizeCSS.convertURIBase=convertURIBase;return normalizeCSS});define("splunkjs/contrib/require-css/css",["./normalize"],function(normalize){function indexOf(a,e){for(var i=0,l=a.length;l>i;i++)if(a[i]===e)return i;return-1}if("undefined"==typeof window)return{load:function(n,r,load){load()}};var testing=!1,head=document.getElementsByTagName("head")[0],engine=window.navigator.userAgent.match(/Trident\/([^ ;]*)|AppleWebKit\/([^ ;]*)|Opera\/([^ ;]*)|rv\:([^ ;]*)(.*?)Gecko\/([^ ;]*)|MSIE\s([^ ;]*)/),hackLinks=!1;if(engine)if(engine[1]||engine[7]){hackLinks=parseInt(engine[1])<6||parseInt(engine[7])<=9;engine="trident"}else if(engine[2]){hackLinks=!0;engine="webkit"}else if(engine[3]);else if(engine[4]){hackLinks=parseInt(engine[4])<18;engine="gecko"}else testing&&alert("Engine detection failed");else;var cssAPI={};cssAPI.pluginBuilder="./css-builder";var curBuffer=[],onBufferLoad={},bufferResources=[];cssAPI.addBuffer=function(resourceId){if(-1==indexOf(curBuffer,resourceId)&&-1==indexOf(bufferResources,resourceId)){curBuffer.push(resourceId);bufferResources.push(resourceId)}};cssAPI.setBuffer=function(css,isLess){var pathname=window.location.pathname.split("/");pathname.pop();pathname=pathname.join("/")+"/";var baseParts=require.toUrl("base_url").split("/");baseParts.pop();var baseUrl=baseParts.join("/")+"/";baseUrl=normalize.convertURIBase(baseUrl,pathname,"/");baseUrl.match(/^\/|([^\:\/]*:)/)||(baseUrl="/"+baseUrl);"/"!=baseUrl.substr(baseUrl.length-1,1)&&(baseUrl+="/");cssAPI.inject(normalize(css,baseUrl,pathname));for(var i=0;i<curBuffer.length;i++)if(isLess&&".less"==curBuffer[i].substr(curBuffer[i].length-5,5)||!isLess&&".css"==curBuffer[i].substr(curBuffer[i].length-4,4)){!function(resourceId){onBufferLoad[resourceId]=onBufferLoad[resourceId]||!0;setTimeout(function(){"function"==typeof onBufferLoad[resourceId]&&onBufferLoad[resourceId]();delete onBufferLoad[resourceId]},7)}(curBuffer[i]);curBuffer.splice(i--,1)}};cssAPI.attachBuffer=function(resourceId,load){for(var i=0;i<curBuffer.length;i++)if(curBuffer[i]==resourceId){onBufferLoad[resourceId]=load;return!0}if(onBufferLoad[resourceId]===!0){onBufferLoad[resourceId]=load;return!0}if(-1!=indexOf(bufferResources,resourceId)){load();return!0}};var webkitLoadCheck=function(link,callback){setTimeout(function(){for(var i=0;i<document.styleSheets.length;i++){var sheet=document.styleSheets[i];if(sheet.href==link.href)return callback()}webkitLoadCheck(link,callback)},10)},mozillaLoadCheck=function(style,callback){setTimeout(function(){try{style.sheet.cssRules;return callback()}catch(e){}mozillaLoadCheck(style,callback)},10)};if("trident"==engine&&hackLinks)var ieStyles=[],ieQueue=[],ieStyleCnt=0,ieLoad=function(url,callback){var style;ieQueue.push({url:url,cb:callback});style=ieStyles.shift();if(!style&&ieStyleCnt++<12){style=document.createElement("style");head.appendChild(style)}ieLoadNextImport(style)},ieLoadNextImport=function(style){var curImport=ieQueue.shift();if(curImport){style.onload=function(){curImport.cb(curImport.ss);ieLoadNextImport(style)};var curSheet=style.styleSheet;curImport.ss=curSheet.imports[curSheet.addImport(curImport.url)]}else{style.onload=noop;ieStyles.push(style)}};var createLink=function(url){var link=document.createElement("link");link.type="text/css";link.rel="stylesheet";link.href=url;return link},noop=function(){};cssAPI.linkLoad=function(url,callback){var timeout=setTimeout(function(){testing&&alert("timeout");callback()},1e3*waitSeconds-100),_callback=function(){clearTimeout(timeout);link&&(link.onload=noop);setTimeout(callback,7)};if(hackLinks)if("webkit"==engine){var link=createLink(url);webkitLoadCheck(link,_callback);head.appendChild(link)}else if("gecko"==engine){var style=document.createElement("style");style.textContent='@import "'+url+'"';mozillaLoadCheck(style,_callback);head.appendChild(style)}else"trident"==engine&&ieLoad(url,_callback);else{var link=createLink(url);link.onload=_callback;head.appendChild(link)}};var progIds=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],fileCache={},get=function(url,callback,errback){if(fileCache[url])callback(fileCache[url]);else{var xhr,i,progId;if("undefined"!=typeof XMLHttpRequest)xhr=new XMLHttpRequest;else if("undefined"!=typeof ActiveXObject)for(i=0;3>i;i+=1){progId=progIds[i];try{xhr=new ActiveXObject(progId)}catch(e){}if(xhr){progIds=[progId];break}}xhr.open("GET",url,requirejs.inlineRequire?!1:!0);xhr.onreadystatechange=function(){var status,err;if(4===xhr.readyState){status=xhr.status;if(status>399&&600>status){err=new Error(url+" HTTP status: "+status);err.xhr=xhr;errback(err)}else{fileCache[url]=xhr.responseText;callback(xhr.responseText)}}};xhr.send(null)}},stylesheet=document.createElement("style");stylesheet.type="text/css";head.appendChild(stylesheet);cssAPI.inject=stylesheet.styleSheet?function(css){stylesheet.styleSheet.cssText+=css}:function(css){stylesheet.appendChild(document.createTextNode(css))};var importRegEx=/@import\s*(url)?\s*(('([^']*)'|"([^"]*)")|\(('([^']*)'|"([^"]*)"|([^\)]*))\))\s*;?/g,pathname=window.location.pathname.split("/");pathname.pop();pathname=pathname.join("/")+"/";var loadCSS=function(fileUrl,callback,errback){"/"!=fileUrl.substr(0,1)&&(fileUrl="/"+normalize.convertURIBase(fileUrl,pathname,"/"));get(fileUrl,function(css){css=normalize(css,fileUrl,pathname);for(var match,importUrls=[],importIndex=[],importLength=[];match=importRegEx.exec(css);){var importUrl=match[4]||match[5]||match[7]||match[8]||match[9];importUrls.push(importUrl);importIndex.push(importRegEx.lastIndex-match[0].length);importLength.push(match[0].length)}for(var completeCnt=0,i=0;i<importUrls.length;i++)(function(i){loadCSS(importUrls[i],function(importCSS){css=css.substr(0,importIndex[i])+importCSS+css.substr(importIndex[i]+importLength[i]);
for(var lenDiff=importCSS.length-importLength[i],j=i+1;j<importUrls.length;j++)importIndex[j]+=lenDiff;completeCnt++;completeCnt==importUrls.length&&callback(css)},errback)})(i);0==importUrls.length&&callback(css)},errback)};cssAPI.normalize=function(name,normalize){".css"==name.substr(name.length-4,4)&&(name=name.substr(0,name.length-4));return normalize(name)};var waitSeconds,alerted=!1;cssAPI.load=function(cssId,req,load,config,parse){waitSeconds=waitSeconds||config.waitSeconds||7;var resourceId=cssId+(parse?".less":".css");if(!cssAPI.attachBuffer(resourceId,load)){fileUrl=req.toUrl(resourceId);if(!alerted&&testing){alert(hackLinks?"hacking links":"not hacking");alerted=!0}parse?loadCSS(fileUrl,function(css){parse&&(css=parse(css,function(css){cssAPI.inject(css);setTimeout(load,7)}))}):cssAPI.linkLoad(fileUrl,load)}};testing&&(cssAPI.inspect=function(){return stylesheet.styleSheet?stylesheet.styleSheet.cssText:stylesheet.innerHTML?stylesheet.innerHTML:void 0});return cssAPI});requirejs.s.contexts._.nextTick=function(f){f()};require(["css"],function(css){css.addBuffer("splunkjs/css/messages.css")});requirejs.s.contexts._.nextTick=requirejs.nextTick;define("splunkjs/mvc/messages",["require","exports","module","underscore","./mvc","util/console","css!../css/messages.css"],function(require){var _=require("underscore"),console=(require("./mvc"),require("util/console"));require("css!../css/messages.css");var messages={cancelled:{icon:"info-circle",level:"info",message:_("Search was cancelled").t()},refresh:{icon:"info-circle",level:"info",message:_("Search is refreshing...").t()},empty:{icon:"blank",level:"info",message:""},"unresolved-search":{icon:"warning-sign",level:"error",message:_("Search is waiting for input...").t()},"no-events":{icon:"info-circle",level:"info",message:_("Search did not return any events.").t()},"no-results":{icon:"blank",level:"info",message:_("No results found.").t()},"no-search":{icon:"info-circle",level:"info",message:_("No search set.").t()},"no-stats":{icon:"warning-sign",level:"error",message:_("Search isn't generating any statistical results.").t()},"not-started":{icon:"info-circle",level:"info",message:_("No search started.").t()},waiting:{icon:"blank",level:"info",message:_("Waiting for data...").t()},"waiting-queued":{icon:"info-circle",level:"info",message:_("Waiting for search to start: job is queued.").t()},"waiting-preparing":{icon:"info-circle",level:"info",message:_("Waiting for search to start: job is preparing.").t()}},messageTemplate='<div class="splunk-message-container <%- compact ? \'compact\' : \'\' %>">    <div class="alert alert-<%= level %>">         <i class="icon-alert"></i>         <%= message %>     </div> </div>',SPLUNKD_MESSAGE_ORDER={FATAL:1,ERROR:2,WARN:3,INFO:4,DEBUG:5},Messages={messageTemplate:messageTemplate,messages:messages,render:function(info,$el){_.isString(info)&&(info=this.messages[info]);if(info){info.compact=!!info.compact;$el.html(_.template(this.messageTemplate,info))}else console.log("Warning: Unknown message: "+info)},resolve:function(info){return this.messages[info]},_extractErrorMessage:function(state,contentProperty,combineMessages,defaultMessage){if(state){var content=state[contentProperty||"content"];if(content&&content.isZombie)return _("The search job terminated unexpectedly.").t();if(content&&content.messages&&content.messages.length){var msgs=_(content.messages).filter(function(msg){return("ERROR"===msg.type||"FATAL"===msg.type)&&!!msg.text});if(msgs.length){var result=_.chain(msgs).sortBy(function(msg){return SPLUNKD_MESSAGE_ORDER[msg.type]||99}).pluck("text").unique().value();return combineMessages?result.join("; "):result[0]}}}return defaultMessage},getSearchErrorMessage:function(state){return Messages._extractErrorMessage(state,"data",!0)},getSearchFailureMessage:function(jobState){return Messages._extractErrorMessage(jobState,"content",!1,_("The search failed").t())}};return Messages});define("splunkjs/mvc/searchmanager",["require","exports","module","underscore","jquery","./mvc","../splunk","./basemanager","./splunkresultsmodel","./searchmodel","splunkjs/splunk","splunk.config","./tokensafestring","util/console","./jobtracker","./messages"],function(require,exports,module){var _=require("underscore"),$=require("jquery"),mvc=require("./mvc"),Async=require("../splunk").Async,BaseManager=require("./basemanager"),SplunkResultsModel=require("./splunkresultsmodel"),SearchModels=require("./searchmodel"),sdk=require("splunkjs/splunk"),splunkConfig=require("splunk.config"),TokenSafeString=require("./tokensafestring"),console=require("util/console"),JobTracker=require("./jobtracker"),Messages=require("./messages"),PROPERTIES_IGNORED_BY_CACHE=["label","webframework.cache.hash"],SearchManager=BaseManager.extend({moduleId:module.id,defaults:{autostart:!0,cache:!1,cancelOnUnload:!0,runWhenTimeIsUndefined:!0},constructor:function(attributes,options){attributes=attributes||{};options=options||{};if(attributes.queryModel&&attributes.searchModel)throw new Error('Cannot specify two custom settings models via deprecated options "queryModel" and "searchModel".');this.settings=attributes.settings||attributes.queryModel||attributes.searchModel||new SearchModels.SearchSettingsModel({},options);this.query=this.settings;this.search=this.settings;delete attributes.settings;delete attributes.queryModel;delete attributes.searchModel;var returnValue=BaseManager.prototype.constructor.apply(this,arguments);return returnValue},initialize:function(options){options=options||{};this.service=mvc.createService({app:options.app,owner:options.owner});this.settings.has("label")||this.settings.set("label",this.id);this.listenTo(this.settings,"change",this._handleSettingsChange);this._debouncedStartSearch=_.debounce(this.startSearch);this.listenTo(this,"change:autostart",this.handleAutostart);this.listenTo(this,"search:error",function(msg){this.lastError=msg;return!0});this.listenTo(this,"all",function(evt){"search:"===evt.substring(0,"search:".length)&&(this._lastSearchEvent=[evt,Array.prototype.slice.call(arguments,1)])});this.handleAutostart();this._start();this._cancelOnUnload=_.bind(this._cancelOnUnload,this);this.listenTo(this,"change:cancelOnUnload change:cache",this.handleCancelOnUnload);this.handleCancelOnUnload()},_handleSettingsChange:function(){var managerPropertiesChanged=_.omit(this.settings.changed,SearchModels.SearchSettingsModel.ALLOWED_ATTRIBUTES);BaseManager.prototype.set.call(this,managerPropertiesChanged)},handleAutostart:function(){this.get("autostart")?this.listenTo(this.settings,"change",this._handleSettingsChangeOnAutostart,this):this.stopListening(this.settings,"change",this._handleSettingsChangeOnAutostart,this)},_handleSettingsChangeOnAutostart:function(){var jobPropertiesChanged=_.pick(this.settings.changed,SearchModels.SearchSettingsModel.ALLOWED_ATTRIBUTES);_.isEmpty(jobPropertiesChanged)||this._debouncedStartSearch()},handleCancelOnUnload:function(){this.stopListeningDOM($(window),"unload",this._cancelOnUnload);this.get("cancelOnUnload")&&!this.get("cache")&&this.listenToDOM($(window),"unload",this._cancelOnUnload)},_cancelOnUnload:function(){this.job&&!this.job.properties().isDone&&$.ajax({url:splunkConfig.SPLUNKD_PATH+this.job.qualifiedPath+"/control",data:{action:"cancel"},type:"POST",async:!1})},set:function(key,value,options){var attrs;if(_.isObject(key)&&!_.isArray(key)||null===key){attrs=key;options=value}else{attrs={};attrs[key]=value}var settings={};if(_.has(attrs,"search")&&this._isDictionary(attrs.search)){_.extend(settings,attrs.search);delete attrs.search}if(_.has(attrs,"query")&&this._isDictionary(attrs.query)){_.extend(settings,attrs.query);delete attrs.query}_.extend(settings,attrs);this.settings.set(settings,options);BaseManager.prototype.set.call(this,attrs,options)},get:function(){return this.settings.get.apply(this.settings,arguments)},_isDictionary:function(value){return _.isObject(value)&&!(value instanceof TokenSafeString)},_start:function(){this.get("autostart")&&this.startSearch();return this},data:function(source,attrs){if(!source)throw new Error("Cannot get a results model without specifying the source.");attrs=attrs||{};attrs.manager=this;attrs.source=source;return new SplunkResultsModel(attrs)},_startSearchFromSid:function(sid){var that=this,job=new sdk.Service.Job(this.service,sid);job.fetch(function(err){if(err)that.trigger("search:error",_("Error in getting pre-existing search: ").t()+sid);else{var request=job.properties().request;that.settings.set(_.pick(request,SearchModels.SearchSettingsModel.ALLOWED_ATTRIBUTES),{silent:!0,qualified:!0});that.createManager(job)}})},startSearch:function(refresh){this.lastError="";this.refresh=refresh;this.cancel();if(this.has("sid"))this._startSearchFromSid(this.get("sid"));else{var cache=this.get("cache")||!1;_.isBoolean(cache)&&(cache=cache?-1:0);var options=this._createOptionsForSearchJob(),threshold=0>cache?new Date(0).valueOf():(new Date).valueOf()-1e3*cache;if(options.search){var timeRangeIsUnresolved=void 0===this.settings.get("earliest_time",{tokens:!1})&&this.settings.get("earliest_time",{tokens:!0})||void 0===this.settings.get("latest_time",{tokens:!1})&&this.settings.get("latest_time",{tokens:!0});if(!timeRangeIsUnresolved||this.settings.get("runWhenTimeIsUndefined")){if(0===cache){this.createSearch();return this}var filter=options["webframework.cache.hash"]?{search:"request.webframework.cache.hash="+options["webframework.cache.hash"]}:{},that=this;this.service.jobs().fetch(filter,function(err,jobs){if(err){console.log("Error fetching searches");that.trigger("search:error",_("Error fetching searches").t())}else{var list=jobs.list();_.each(options,function(val,key){options[key]=_.isBoolean(val)||_.isNumber(val)?val.toString():val});var matches=[];options=_.omit(options,PROPERTIES_IGNORED_BY_CACHE);for(var i=0;i<list.length;++i){var potentialJob=list[i],request=_.omit(potentialJob.properties().request,PROPERTIES_IGNORED_BY_CACHE),published=new Date(potentialJob.published()).valueOf();_.isEqual(request,options)&&published>threshold&&matches.push(potentialJob)}matches.sort(function(a,b){var aValue=new Date(a.published()).valueOf(),bValue=new Date(b.published()).valueOf();return bValue-aValue});var job=matches[0];job?that.createManager(job):that.createSearch()}});return this}this.trigger("search:error",Messages.resolve("unresolved-search").message)}else this.settings.get("search",{tokens:!0})?this.trigger("search:error",Messages.resolve("unresolved-search").message):this.trigger("search:error",_("No search query provided.").t())}},_createOptionsForSearchJob:function(){var jobSettings=_.pick(this.settings.attributes,SearchModels.SearchSettingsModel.ALLOWED_ATTRIBUTES),options={};_.each(jobSettings,function(v,k){void 0!==v&&(options[k]=v)});options.search=this.settings.get("search",{qualified:!0});options.search&&(options["webframework.cache.hash"]="java5:"+SearchManager._createJava5HashForString(options.search).toString(16));return options},pause:function(){this.job&&this.job.pause()},unpause:function(){this.job&&this.job.unpause();return this},finalize:function(){this.job&&this.job.finalize();return this},cancel:function(){var msg=this.refresh?"refresh":"cancelled";if(!this.get("cache")){if(this.job){JobTracker.untrack(this.job.sid);this.job.cancel();this.job=null;this.trigger("search:"+msg)}return this}},createSearchPinger:function(job){var that=this;Async.whilst(function(){return that.job===job},function(done){var expireDelay,autoCancel,props=job.properties();if(props.isDone||void 0===props.request||void 0===props.request.auto_cancel)expireDelay=props.ttl;else if(void 0!==props.request){autoCancel=props.request&&parseInt(props.request.auto_cancel,10)||1/0;expireDelay=Math.min(autoCancel,props.ttl)}var delay=parseInt(1e3*(expireDelay||30)/3,10);Async.sleep(delay,function(){that.job===job&&job.fetch(done)})},function(){})},createManager:function(job){var that=this,check=_.bind(this._checkJob,this),cacheEnabled=this.get("cache");this.job=job;this.createSearchPinger(job);this.trigger("search:start",job);JobTracker.track(job,{progress:function(job){if(check(job,cacheEnabled)){var properties=job.properties(),state=job.state();that.trigger("search:progress",state,job);that.unset("data",{silent:!0});that.set("data",properties)}},done:function(job){if(check(job,cacheEnabled)){var state=job.state();that.trigger("search:done",state,job)}},failed:function(job){if(check(job,cacheEnabled)){var state=job.state();that.trigger("search:fail",state,job)}}})},_checkJob:function(job,cache){if(this.job!==job){cache||job.cancel();return!1}return!0},createSearch:function(){var options=this._createOptionsForSearchJob(),that=this,cache=this.get("cache"),req=this._inflightCreateXHR=this.service.jobs().create(options,function(err,job){if(req===that._inflightCreateXHR){that._inflightCreateXHR=null;err?"abort"!==err.status&&that.trigger("search:error",_("Could not create search.").t(),err,job):that.createManager(job)}else err||cache||job.cancel()})},replayLastSearchEvent:function(listener){var replayed=!1;if(this._lastSearchEvent){var evtName=this._lastSearchEvent[0],listenerObj=_(this._events[evtName]).find(function(attachedListener){return attachedListener.ctx===listener});if(listenerObj){var args=this._lastSearchEvent[1];listenerObj.callback.apply(listener,args);replayed=!0}}return replayed},getLastSearchEvent:function(){return this._lastSearchEvent},dispose:function(){this.cancel();_.isFunction(this.settings.dispose)&&this.settings.dispose();BaseManager.prototype.dispose.apply(this,arguments)}});SearchManager._createJava5HashForString=function(s){for(var h=0,i=0,n=s.length;n>i;i++)h=(31*h|0)+s.charCodeAt(i)|0;return h};return SearchManager});define("app/sync/URLSync",["jquery","backbone","underscore"],function($,Backbone,_){return function(componentId,id,fieldName){function parseQueryString(){var query,queryBreak=window.location.href.indexOf("?");if(queryBreak>-1){query=window.location.href.slice(queryBreak);return Splunk.util.queryStringToProp(query)}return!1}function setCurrentData(data,current,id){var currentData;current||(current={});if(void 0===current[componentId]){current[componentId]={};current[componentId][id]=data;current[componentId]=JSON.stringify(current[componentId]);return current}if(void 0!==current[componentId]){currentData=JSON.parse(current[componentId]);currentData[id]=data;current[componentId]=JSON.stringify(currentData)}return current}function makeNewURL(data){var newQuery,current=parseQueryString();current=setCurrentData(data,current,id);newQuery=Splunk.util.propToQueryString(current);return newQuery}function relativeNav(query){"?"!==query[0]&&(query="?"+query);router.navigate(window.location.pathname+query,{trigger:!0,replace:!0})}function save(data){var newQuery=makeNewURL(data);relativeNav(newQuery)}var router=new Backbone.Router;this.getEntityName=function(){var data=parseQueryString();return data["form."+fieldName]};this.setEntityName=function(entityName){var query="form."+fieldName+"="+entityName;relativeNav(query)};this.exists=function(){var data=parseQueryString();if(void 0===data[componentId]||""===data[componentId])return!1;if(void 0===id||id===!1)return!0;data=JSON.parse(data[componentId]);return void 0===data[id]?!1:!0};this.createURL=function(models,options){var baseURL,url,json,query,current,urlData={};options=options||{};options=_.extend({fullUrl:!0},options);current=parseQueryString();_.each(models,function(model){json=model.toJSON();setCurrentData(json,urlData,model.id)});urlData=_.extend({},current,urlData);query=Splunk.util.propToQueryString(urlData);if(!options.fullUrl)return query;baseURL=window.location.href;current&&(baseURL=baseURL.split("?")[0]);url=baseURL+"?"+query;return url};this.sync=function(method,model,options){var current,urlData,data;switch(method){case"read":current=parseQueryString();if(!current||void 0===current[componentId])break;urlData=JSON.parse(current[componentId]);void 0!==fieldName&&fieldName!==!1&&void 0!==current[fieldName]&&_.each(urlData,function(item){item[fieldName]=current[fieldName]});options.parseUrl=!0;options.success(model,urlData,options);break;case"create":model.componentId||model.set(model.idAttribute,_.uniqueId());data=model.toJSON();save(data);break;case"update":data=model.toJSON();save(data);break;case"delete":}}}});define("app/models/Pref",["jquery","underscore","backbone","app/sync/URLSync","splunk.util"],function($,_,Backbone,URLSync){return Backbone.Model.extend({defaults:{changes:[],file_name:"prefs",selected:"Default",user_name:Splunk.util.getConfigValue("USERNAME")},initialize:function(){this.debounceSave=_.debounce(this.save,500);this.urlSync=new URLSync(this.get("component_id"),this.id);this.sync=_.debounce(this._sync,25,this)},_sync:function(method,model,options){options=options||{};if(options.isNew){options.data=options.data||{};method="create";options.url=this.onCreateURL();options.data=$.extend(options.data,this.getPOSTData(method,model))}return Backbone.sync.apply(this,arguments)},getPOSTData:function(method,model){return{name:model.id,model:JSON.stringify(model.toJSON())}},onCreateURL:function(){return url=Splunk.util.make_url(["splunkd","servicesNS",this.get("user_name"),this.get("app_name"),"configs","conf-"+this.get("component_id")+"_"+this.get("file_name")+"?output_mode=json"].join("/"))},toJSON:function(){var output=_.clone(this.attributes);delete output.app_name;delete output.changes;delete output.component_id;delete output.entry;delete output.file_name;delete output.generator;delete output.links;delete output.messages;delete output.origin;delete output.paging;delete output.updated;delete output.user_name;return output},url:function(){return url=Splunk.util.make_url(["splunkd","servicesNS",this.get("user_name"),this.get("app_name"),"configs","conf-"+this.get("component_id")+"_"+this.get("file_name"),this.id+"?output_mode=json"].join("/"))},clearClickedEvents:function(){_.each(this.get("lane_prefs"),function(lane_pref){lane_pref.clicked=[]});this.save()}})});define("app/collections/Prefs",["jquery","underscore","backbone","app/models/Pref","app/sync/URLSync","splunk.util"],function($,_,Backbone,Pref,URLSync){return Backbone.Collection.extend({model:Pref,initialize:function(models,options){this.app_name=options.app_name;this.field_name=options.field_name;this.file_name="prefs";this.id=options.id;this.changes=options.changes||[];this.user_name=Splunk.util.getConfigValue("USERNAME");this.on("add",_.bind(this.onModelAdd,this));this.urlSync=new URLSync(this.id,!1,this.field_name)},getPref:function(pref_id){var pref=this.get(pref_id);if(!pref){pref=new Pref({app_name:this.app_name,component_id:this.id,file_name:this.file_name,id:pref_id,name:pref_id,view_name:this.view_name,entity_name:this.entity_name});this.add(pref)}return pref},onModelAdd:function(model){model.save([],{isNew:!0})},sync:function(method,model,options){var entity=this.urlSync.getEntityName();if("read"!==method.toLowerCase())throw new Error("invalid method: "+method);entity&&(this.entity_name=entity);return this.urlSync.exists()?this.urlSync.sync(method,model,options):Backbone.sync.apply(this,arguments)},parse:function(content,options){if(options.parseUrl)return this.parseURL(content,options);var app_name=this.app_name,self=this,changes=this.changes,component_id=this.id,entity_name=this.entity_name,file_name=this.file_name,field_name=this.field_name,output=(this.user_name,_.compact(_.map(content.entry,function(item){if(item.content.model){output=JSON.parse(item.content.model);output.name=output.id=item.name;output.app_name=app_name;output.changes=changes;output.file_name=file_name;output.component_id=component_id;void 0!==output.entity_name&&(self.entity_name=output.entity_name);output[field_name]=entity_name||output[field_name];output.entity_name=entity_name||output.entity_name;return output}})));return output},parseURL:function(content){var self=this,output=[];_.each(content,function(item){item.app_name=self.app_name;item.file_name=self.file_name;item.component_id=self.id;output.push(item)});return output},url:function(){return url=Splunk.util.make_url(["splunkd","servicesNS",this.user_name,this.app_name,"configs","conf-"+this.id+"_"+this.file_name+"?output_mode=json"].join("/"))},serializeToURL:function(options){return this.urlSync.createURL(this.models,options)}})});define("app/collections/SignBoardResults",["jquery","underscore","backbone"],function($,_,Backbone){return Backbone.Collection.extend({pref_id:"swimlanes",initialize:function(model,options){this.options=options||{};this.prefs=this.options.prefs;this.values=new Backbone.Model;this.data=new Backbone.Model;this.clicked=new Backbone.Model;this.dateFormatter=d3.time.format("%a %b %e");this.timeFormatter=d3.time.format("%X");this.zoneFormatter=d3.time.format("%Z");this.onHeaderData=_.debounce(this._onHeaderData,300);this.onBodyData=_.debounce(this._onBodyData,500);this.prefs.on("reset",_.bind(this.onPrefsReset,this));this.on("add",_.bind(this.onAdd,this));this.on("remove",_.bind(this.onRemove,this));this.on("reset",_.bind(this.onReset,this))},onPrefsReset:function(){var pref=this.prefs.getPref(this.pref_id),lane_prefs=pref.get("lane_prefs")||{};_.each(lane_prefs,function(value,key){var clicked=value.clicked||[];this.clicked.set(key,clicked,{silent:!0})},this);this.onClickedChange=_.debounce(this._onClickedChange,1e3);this.clicked.on("change",_.bind(this.onClickedChange,this))},_onClickedChange:function(){var pref=this.prefs.getPref(this.pref_id),lane_prefs=pref.get("lane_prefs")||{};_.each(lane_prefs,function(val,key){var clicked=this.clicked.get(key)||[];lane_prefs[key].clicked=clicked},this);pref.save({lane_prefs:lane_prefs})},onAdd:function(model){var meta=model.get("meta"),earliest_time=meta.earliest_time,latest_time=meta.latest_time,count=Number(model.get("count")),search=meta.search,title=meta.lane_name,metadata=this.data.get("meta")||{},metacount=metadata.count||0,searches=metadata.searches||[],titles=metadata.titles||[];this.setClicked(title,meta.id);if(!metadata.earliest_time||earliest_time<metadata.earliest_time){metadata.earliest_time=earliest_time;metadata.startDate=this.dateFormatter(earliest_time);metadata.startTime=this.timeFormatter(earliest_time);metadata.timeZone=this.zoneFormatter(earliest_time)}if(!metadata.latest_time||latest_time>metadata.latest_time){metadata.latest_time=latest_time;metadata.endDate=this.dateFormatter(latest_time);metadata.endTime=this.timeFormatter(latest_time)}metadata.count=metacount+count;metadata.titles=_.union(titles,[title]);metadata.title=metadata.titles.length>1?"Events":metadata.titles[0];metadata.searches=_.union(searches,[search]);this.data.set("meta",metadata);this.onHeaderData();this.mergeModelAttributes(model);this.onBodyData()},onRemove:function(model){if(this.length<1)this.onReset(this);else{var meta=model.get("meta"),earliest_time=meta.earliest_time,latest_time=meta.latest_time,count=Number(model.get("count")),title=(meta.search,meta.lane_name),metadata=this.data.get("meta")||{},metacount=metadata.count||0,searches=_.uniq(this.map(function(m){return meta.id!==m.get("meta").id?m.get("meta").search:void 0})),titles=_.uniq(this.map(function(m){return meta.id!==m.get("meta").id?m.get("meta").lane_name:void 0}));this.unsetClicked(title,meta.id);if(earliest_time===metadata.earliest_time){var next_earliest_time=this.min(function(m){return meta.id!==m.get("meta").id?m.get("meta").earliest_time:void 0}).get("meta").earliest_time;if(earliest_time!==next_earliest_time){metadata.earliest_time=next_earliest_time;metadata.startDate=this.dateFormatter(next_earliest_time);metadata.startTime=this.timeFormatter(next_earliest_time)}}if(latest_time===metadata.latest_time){var next_latest_time=this.max(function(m){return meta.id!==m.get("meta").id?m.get("meta").latest_time:void 0}).get("meta").latest_time;if(latest_time!==next_latest_time){metadata.latest_time=next_latest_time;metadata.endDate=this.dateFormatter(next_latest_time);metadata.endTime=this.timeFormatter(next_latest_time)}}metadata.count=metacount-count;metadata.titles=titles;metadata.title=metadata.titles.length>1?"Events":metadata.titles[0];metadata.searches=searches;this.data.set("meta",metadata);this.onHeaderData();this.pruneModelAttributes(model);this.onBodyData()}},onReset:function(collection){this.data.clear();this.values.clear();if(collection.length<1)this._onClearAll();else{this.resetClicked(collection);var titles,earliest_time=collection.min(function(model){return model.get("meta").earliest_time}).get("meta").earliest_time,latest_time=collection.max(function(model){return model.get("meta").latest_time}).get("meta").latest_time,startDate=this.dateFormatter(earliest_time),startTime=this.timeFormatter(earliest_time),endDate=this.dateFormatter(latest_time),endTime=this.timeFormatter(latest_time),timeZone=this.zoneFormatter(earliest_time),count=collection.reduce(function(memo,model){return memo+Number(model.get("count"))},0),title=_.uniq(collection.map(function(model){return model.get("meta").lane_name})),searches=_.uniq(collection.map(function(model){return model.get("meta").search}));if(title.length>1){titles=title;title="Events"}this.data.set({meta:{count:count,earliest_time:earliest_time,endDate:endDate,endTime:endTime,latest_time:latest_time,searches:searches,startDate:startDate,startTime:startTime,timeZone:timeZone,title:title,titles:titles}});this._onHeaderData();_.delay(_.bind(function(){collection.each(function(model){var meta=model.get("meta");this.mergeModelAttributes(model);this.setClicked(meta.lane_name,meta.id)},this);this._onBodyData()},this),150)}},existsAfterPrune:function(obj,elm,key){var count=obj[elm]||1,exists=!1;count-=1;if(1>count)obj[elm]&&delete obj[elm];else{obj[elm]=count;exists=!0}this.values.set(key,obj);return exists},incrementValues:function(key,val){var obj=this.values.get(key)||{};_.each(val,function(elm){existing=obj[elm]||0;obj[elm]=existing+1},this);this.values.set(key,obj)},mergeModelAttributes:function(model){_.each(model.attributes,function(vals,key){if("meta"!==key&&"_time"!==key&&"count"!==key){var existing=this.data.get(key);vals=_.flatten([vals]);this.incrementValues(key,vals);if(existing){vals=_.union(existing,vals);this.data.set(key,vals)}else this.data.set(key,vals)}},this)},pruneModelAttributes:function(model){_.each(model.attributes,function(val,key){if("_time"!==key&&"meta"!==key&&"count"!==key){var obj=this.values.get(key),data=this.data.get(key)||[];if(obj){_.each(val,function(elm){this.existsAfterPrune(obj,elm,key)||(data=_.without(data,elm))},this);this.data.set({key:data})}}},this)},_onClearAll:function(){this.data.trigger("clearAll");this.clicked.clear()},_onHeaderData:function(){this.data.trigger("ready:headerData",this.data)},_onBodyData:function(){this.data.trigger("ready:bodyData",this.data)},resetClicked:function(collection){this.clicked.clear();collection.forEach(function(model){var meta=model.get("meta"),lane_name=meta.lane_name,id=meta.id,clicked=this.clicked.get(lane_name)||[];clicked.push(id);this.clicked.set(lane_name,clicked)},this)},setClicked:function(lane_name,id){var clicked=this.clicked.get(lane_name)||[];clicked=_.union(clicked,[id]);this.clicked.set(lane_name,clicked)},unsetClicked:function(lane_name,id){var clicked=this.clicked.get(lane_name)||[];clicked=_.without(clicked,id);this.clicked.set(lane_name,clicked)}})});define("app/models/Event",["jquery","backbone","underscore"],function($,Backbone){return Backbone.Model.extend({initialize:function(){}})});define("app/collections/Events",["jquery","underscore","backbone","app/models/Event"],function($,_,Backbone,Event){return Backbone.Collection.extend({model:Event})});define("app/models/Swimlane",["jquery","backbone","underscore","d3","splunkjs/mvc/searchmanager","splunkjs/mvc","app/collections/Events","splunkjs/mvc/tokenutils"],function($,Backbone,_,d3,SearchManager,SJS,Events,tokenUtils){return Backbone.Model.extend({defaults:{channel:{rect:{className:"channel_rect",x:190,y:0,fill:"transparent",stroke:"#CCCCCC",width:840}},label:{rect:{className:"lane_label_rect",x:0,y:0,fill:"#6E6E6E",width:190},text:{className:"lane_label_text",dx:20,dy:25,fill:"#FFFFFF"}},color:"blue",disabled:!1,height:40,offset:0,order:0,span:"1h",timerange:{earliest_date:"-24h",latest_date:"now"},title:"loading...",token:"entity"},comparitor:"offset",initialize:function(){this.pref=this.get("pref");this.sign_board=this.get("sign_board");this.time_range=this.get("time_range");this.set("entity_name",this.pref.get("entity_name"));this.tokens=SJS.Components.getInstance(this.id,{create:!0});this.onRangeChange=_.debounce(this._onRangeChange,500);this.on("change:color",_.bind(this.updateColorPref,this));this.on("change:selected",_.bind(this.onSelectedChange,this));this.on("change:earliest_epoch change:latest_epoch",_.bind(this.onTimeChange,this));this.on("drag:coordinates",_.bind(this.onDragCoordinates,this));this.on("reorder:lane_order",_.bind(this.savePref,this));this.on("change:constraints",_.bind(this.updateManager,this));this.time_range.on("change:innerTimeRange",_.bind(this.onRangeChange,this));this.pref.on("change:entity_name",_.bind(this.updateEntityName,this))},updateManager:function(){this.setTokens();if(!this.manager&&this.get("selected")){this.updateDrilldown();this.manager=this.getNewManager();this.trigger("add:manager",this.manager)}else if(this.get("selected")){this.updateDrilldown();this.trigger("update:manager",this.manager)}},onDragCoordinates:function(range_x,range_y,is_additive){var label=this.get("label"),channel=this.get("channel"),events=(channel.rect.width,label.rect.width,this.get("events"));if(this.isYIntersect(range_y)){if(!events||events.length<1)return;events.each(function(evt){evt.trigger("click:coordinates",range_x,is_additive)},this)}},isYIntersect:function(range_y){var height=this.get("height"),y1=this.get("offset")*height,y2=y1+height;return!(range_y[0]>y2||range_y[1]<y1)},updateDrilldown:function(){var normalizedDrilldown,drilldown=this.get("drilldown");if(void 0!==drilldown){normalizedDrilldown=tokenUtils.replaceTokenNames(drilldown,this.tokens.attributes,{});this.set("normalizedDrilldown",normalizedDrilldown)}},getNewManager:function(){var innerTimeRange=this.time_range.get("innerTimeRange"),earliest_epoch=this.get("earliest_epoch")||innerTimeRange.earliest_date.getTime()/1e3,latest_epoch=this.get("latest_epoch")||innerTimeRange.latest_date.getTime()/1e3;return new SearchManager({autostart:!1,id:_.uniqueId("channel_manager_"),earliest_time:earliest_epoch,latest_time:latest_epoch,search:this.get("search")},{tokens:!0,tokenNamespace:this.id})},onTimeChange:function(){if(this.manager){this.setTokens();this.manager.search.set({earliest_time:this.get("earliest_epoch"),latest_time:this.get("latest_epoch")});this.manager.trigger("change:innerTimeRange",this.manager);this.sign_board.reset()}},_onRangeChange:function(){if(this.get("selected")){var innerTimeRange=this.time_range.get("innerTimeRange"),earliest_epoch=innerTimeRange.earliest_date.getTime()/1e3,latest_epoch=innerTimeRange.latest_date.getTime()/1e3;this.set({earliest_epoch:earliest_epoch,latest_epoch:latest_epoch})}},updateEntityName:function(model,value){this.set("entity_name",value)},savePref:function(){this.pref.save()},setTokens:function(){this.tokens.set("constraints",this.get("constraints")).set("span",this.time_range.get("span")||this.get("span"))},updateColorPref:function(){var lane_prefs=this.pref.get("lane_prefs")||{},lane_pref=lane_prefs[this.id]||{};lane_pref.color=this.get("color");lane_prefs[this.id]=lane_pref;this.pref.save()},onSelectedChange:function(model){var is_selected=model.get("selected"),group=this.pref.get("selected"),lane_orders=this.pref.get("lane_order")||{},lane_order=lane_orders[group]||[],lane_prefs=this.pref.get("lane_prefs")||{},lane_pref=lane_prefs[this.id]||{};if(void 0!==is_selected){is_selected&&!this.manager&&this.get("constraints")&&this.updateManager();if("Custom"===group){is_selected?lane_order.push(model.id):lane_order=_.without(lane_order,model.id);
lane_order=_.uniq(lane_order);lane_orders[group]=lane_order}lane_pref.selected=is_selected;lane_prefs[this.id]=lane_pref;this.pref.save({lane_prefs:lane_prefs,lane_order:lane_orders})}}})});define("app/models/SwimlaneGroup",["jquery","underscore","backbone"],function($,_,Backbone){return Backbone.Model.extend({})});define("app/collections/SwimlaneGroups",["jquery","underscore","backbone","app/models/SwimlaneGroup"],function($,_,Backbone,SwimlaneGroup){return Backbone.Collection.extend({model:SwimlaneGroup,initialize:function(){this.on("change:selected",_.bind(this.onSelectedChange,this))},onSelectedChange:function(model){_.each(this.filter(function(m){return m!==model}),function(m){m.set({selected:!1},{silent:!0})})}})});!function(factory){"function"==typeof define&&define.amd?define("backbone-mediator",["underscore","backbone"],factory):factory(_,Backbone)}(function(_,Backbone){var Subscriber,channels={},delegateEvents=Backbone.View.prototype.delegateEvents,undelegateEvents=Backbone.View.prototype.undelegateEvents;Backbone.Mediator={subscribe:function(channel,subscription,context,once){channels[channel]||(channels[channel]=[]);channels[channel].push({fn:subscription,context:context||this,once:once})},publish:function(channel){if(channels[channel])for(var subscription,args=[].slice.call(arguments,1),i=0;i<channels[channel].length;i++){subscription=channels[channel][i];subscription.fn.apply(subscription.context,args);if(subscription.once){Backbone.Mediator.unsubscribe(channel,subscription.fn,subscription.context);i--}}},unsubscribe:function(channel,fn,context){if(channels[channel])for(var subscription,i=0;i<channels[channel].length;i++){subscription=channels[channel][i];if(subscription.fn===fn&&subscription.context===context){channels[channel].splice(i,1);i--}}},subscribeOnce:function(channel,subscription,context){Backbone.Mediator.subscribe(channel,subscription,context,!0)}};Subscriber={delegateEvents:function(){delegateEvents.apply(this,arguments);this.setSubscriptions()},undelegateEvents:function(){undelegateEvents.apply(this,arguments);this.unsetSubscriptions()},subscriptions:{},setSubscriptions:function(subscriptions){subscriptions&&_.extend(this.subscriptions||{},subscriptions);subscriptions=subscriptions||this.subscriptions;if(subscriptions&&!_.isEmpty(subscriptions)){this.unsetSubscriptions(subscriptions);_.each(subscriptions,function(subscription,channel){var once;if(subscription.$once){subscription=subscription.$once;once=!0}_.isString(subscription)&&(subscription=this[subscription]);Backbone.Mediator.subscribe(channel,subscription,this,once)},this)}},unsetSubscriptions:function(subscriptions){subscriptions=subscriptions||this.subscriptions;subscriptions&&!_.isEmpty(subscriptions)&&_.each(subscriptions,function(subscription,channel){_.isString(subscription)&&(subscription=this[subscription]);Backbone.Mediator.unsubscribe(channel,subscription.$once||subscription,this)},this)}};_.extend(Backbone.View.prototype,Subscriber);_.extend(Backbone.Mediator,{pub:Backbone.Mediator.publish,sub:Backbone.Mediator.subscribe});return Backbone});define("app/collections/Swimlanes",["jquery","underscore","backbone","app/models/Pref","app/models/Swimlane","app/collections/SwimlaneGroups","splunk.util","backbone-mediator"],function($,_,Backbone,Pref,Swimlane,SwimlaneGroups){return Backbone.Collection.extend({default_groups:{Custom:{id:"Custom",lanes:[],title:"Custom",sync_filter:null}},keys:{"action.swimlane.constraint_fields":"constraint_fields","action.swimlane.constraint_method":"constraint_method","action.swimlane.title":"title","action.swimlane.color":"color",search:"search","action.swimlane.drilldown_search":"drilldown"},model:Swimlane,pref_id:"swimlanes",initialize:function(models,options){this.app_name=options.app_name;this.groups=new SwimlaneGroups;this.managers=options.managers;this.prefs=options.prefs;this.sign_board=options.sign_board;this.time_range=options.time_range;this.user_name=options.user_name||"nobody";this.view_name=options.view_name;this.sync_filter=options.sync_filter;this.sync_filter||(this.sync_filter="swimlane AND display.page."+this.view_name);this.prefs.on("reset",_.bind(this.onPrefReset,this));this.on("drag:selection",_.bind(this.onChannelDragSelection,this));this.on("add:manager",_.bind(this.onManagerAdd,this));this.on("update:manager",_.bind(this.onManagerUpdate,this))},onManagerAdd:function(manager){this.managers.add(manager)},onManagerUpdate:function(manager){this.managers.addToQueue(manager)},onChannelDragSelection:function(x1,x2,y1,y2,offset_y,is_additive){var range_x=this.getRange(x1,x2),range_y=this.getRange(y1,y2,offset_y);this.each(function(model){model.get("selected")===!0&&model.trigger("drag:coordinates",range_x,range_y,is_additive)},this)},getRange:function(c1,c2,offset){offset||(offset=0);c1+=offset;c2=Math.max(c2+offset,0);return c1>c2?[c2,c1]:[c1,c2]},onLaneOrderChange:function(model){var changed=model.changedAttributes(),pref=this.getPref(),selected=pref.get("selected"),lane_order=pref.get("lane_order")||{};if("Custom"===selected&&changed&&changed.lanes){lane_order[selected]=changed.lanes;pref.set({lane_order:lane_order});pref.save()}},onLaneSelection:function(model){var pref=this.getPref(),group_name=pref.get("selected"),group=this.groups.get(group_name),lane_order=group.get("lanes")||[],is_selected=model.get("selected");is_selected?lane_order.push(model.id):lane_order=_.without(lane_order,model.id);lane_order=_.uniq(lane_order);group.set({lanes:lane_order})},onGroupsReset:function(){var pref=this.getPref(),lane_order=(pref.get("selected"),pref.get("lane_order")||{});this.groups.each(function(model){lane_order[model.id]=model.get("lanes")});pref.save({lane_order:lane_order})},onGroupSelection:function(model){var collection=this,lanes=model.get("lanes"),title=model.get("title"),disabled="Custom"!==title?!0:!1,pref=this.getPref();pref.save({selected:title});collection.each(function(m){var idx=_.indexOf(lanes,m.get("id"));m.set(idx>-1?{selected:!0,disabled:disabled}:{selected:!1,disabled:disabled})})},onPrefReset:function(){this.groups.on("reset",_.bind(this.onGroupsReset,this));this.fetch({reset:!0,success:_.bind(this.onFetch,this)})},getPref:function(){return this.prefs.getPref(this.pref_id)},onFetch:function(){var model,pref=this.getPref();pref&&(model=this.groups.find(function(m){return m.get("title")===pref.get("selected")}));if(model)model.set("selected",!0);else if(this.groups.length>0){model=this.groups.at(0);model.set("selected",!0)}this.onGroupSelection(model);this.groups.on("change:selected",_.bind(this.onGroupSelection,this));this.groups.on("change:lanes",_.bind(this.onLaneOrderChange,this));this.on("change:selected",_.bind(this.onLaneSelection,this))},parse:function(resp){var view_name=this.view_name,flag="collection_name",groups=this.default_groups,keys=this.keys,sign_board=this.sign_board,time_range=this.time_range,pref=this.getPref(),group_prefs=pref.get("lane_order")||{},lane_prefs=pref.get("lane_prefs")||{},swimlanes=_.map(resp.entry,function(entry){var obj={};_.each(entry.content,function(val,key){if(_.contains(_.keys(keys),key))obj[keys[key]]=val;else if(key.indexOf(view_name)>-1&&key.indexOf(flag)>-1){var order_key=key.replace(flag,"order"),order=Number(entry.content[order_key]),group=entry.content[key],lane_order=group_prefs[group],title=obj["title"];lane_order&&lane_order.length<1&&(lane_order=void 0);groups[group]?lane_order||groups[group]["lanes"].splice(order,0,title):groups[group]={id:group,lanes:lane_order||[title],title:group}}});obj["id"]=obj["title"];obj["pref"]=pref;obj["sign_board"]=sign_board;obj["time_range"]=time_range;if(lane_prefs[obj["id"]]){obj["color"]=lane_prefs[obj["id"]].color||obj["color"];obj["selected"]=lane_prefs[obj["id"]].selected||!1}return obj});groups["Custom"].lanes=group_prefs["Custom"]||[];this.groups.reset(_.map(groups,function(v){return v}));return swimlanes},url:function(){return Splunk.util.make_url(this.app_name?"/splunkd/servicesNS/"+this.user_name+"/"+this.app_name+"/saved/searches?search="+this.sync_filter+"&output_mode=json":"/splunkd/services/saved/searches?search="+this.sync_filter+"&output_mode=json")}})});define("models/SplunkDWhiteList",["jquery","backbone","underscore","models/Base","util/splunkd_utils"],function($,Backbone,_,BaseModel,splunkDUtils){return BaseModel.extend({initialize:function(){BaseModel.prototype.initialize.apply(this,arguments)},concatOptionalRequired:function(){var optional=(this.get("optional")||[]).slice(0),required=(this.get("required")||[]).slice(0);return optional.concat(required)},url:"",sync:function(method,model,options){var defaults={data:{output_mode:"json"},url:_.isFunction(model.url)?model.url():model.url};switch(method){case"read":defaults.data=_.extend(defaults.data,options.data||{});delete options.data;defaults.url=splunkDUtils.fullpath(defaults.url);break;default:throw new Error("invalid method: "+method)}return Backbone.sync.call(this,method,model,$.extend(!0,defaults,options))},parse:function(response){var entity=response.entry?$.extend(!0,{},response.entry[0]):{},data=entity.fields||{};data.wildcard&&(data.wildcard=splunkDUtils.addAnchorsToWildcardArray(data.wildcard));return data}})});define("models/services/ACL",["jquery","backbone","models/Base","util/splunkd_utils"],function($,Backbone,BaseModel,splunkDUtils){return BaseModel.extend({initialize:function(){BaseModel.prototype.initialize.apply(this,arguments)},sync:function(method,model,options){var defaults={data:{output_mode:"json"}};switch(method){case"update":defaults.processData=!0;defaults.type="POST";defaults.url=splunkDUtils.fullpath(model.id);$.extend(!0,defaults,options);break;default:throw new Error("invalid method: "+method)}return Backbone.sync.call(this,method,model,defaults)}})});define("models/ACLReadOnly",["jquery","underscore","backbone","models/Base","util/splunkd_utils"],function($,_,Backbone,BaseModel,splunkd_utils){return BaseModel.extend({initialize:function(){BaseModel.prototype.initialize.apply(this,arguments)},permsToObj:function(){var perms=$.extend(!0,{},this.get("perms"));perms.read=perms.read||[];perms.write=perms.write||[];return perms},toDataPayload:function(){var perms=this.permsToObj(),data={sharing:this.get("sharing"),owner:this.get("owner")};data.sharing!==splunkd_utils.USER&&0!==perms.read.length&&(data["perms.read"]=-1!=_.indexOf(perms.read,"*")?"*":perms.read.join(","));data.sharing!==splunkd_utils.USER&&0!==perms.write.length&&(data["perms.write"]=-1!=_.indexOf(perms.write,"*")?"*":perms.write.join(","));return data},canWrite:function(){return this.get("can_write")}})});define("models/SplunkDBase",["jquery","underscore","backbone","models/Base","models/SplunkDWhiteList","models/services/ACL","models/ACLReadOnly","util/splunkd_utils","util/console"],function($,_,Backbone,BaseModel,SplunkDWhiteList,ACLModel,ACLReadOnlyModel,splunkd_utils,console){var syncCreate=function(model,options){var bbXHR,splunkDWhiteListXHR,url,deferredResponse=$.Deferred(),defaults={data:{output_mode:"json"}};url=_.isFunction(model.url)?model.url():model.url;splunkDWhiteListXHR=this.splunkDWhiteList.fetch({url:splunkd_utils.fullpath(url,{})+"/_new",success:function(){var app_and_owner={};options.data&&(app_and_owner=$.extend(app_and_owner,{app:options.data.app||void 0,owner:options.data.owner||void 0,sharing:options.data.sharing||void 0}));defaults.url=splunkd_utils.fullpath(url,app_and_owner);defaults.processData=!0;$.extend(!0,defaults.data,model.whiteListAttributes());$.extend(!0,defaults,options);delete defaults.data.app;delete defaults.data.owner;delete defaults.data.sharing;defaults.data=splunkd_utils.normalizeValuesForPOST(defaults.data);bbXHR=Backbone.sync.call(null,"create",model,defaults);bbXHR.done(function(){deferredResponse.resolve.apply(deferredResponse,arguments)});bbXHR.fail(function(){deferredResponse.reject.apply(deferredResponse,arguments)})}});splunkDWhiteListXHR.fail(function(){deferredResponse.reject.apply(deferredResponse,arguments)});return deferredResponse.promise()},syncRead=function(model,options){var bbXHR,url,deferredResponse=$.Deferred(),defaults={data:{output_mode:"json"}};if((window.$C["SPLUNKD_FREE_LICENSE"]||options.isFreeLicense)&&model.FREE_PAYLOAD){options.success&&options.success(model.FREE_PAYLOAD);return deferredResponse.resolve.apply(deferredResponse,[model.FREE_PAYLOAD])}if(model.isNew()){url=_.isFunction(model.url)?model.url():model.url;url+="/_new"}else url=model.urlRoot?model.urlRoot+"/"+model.id:model.id;var app_and_owner={};options.data&&(app_and_owner=$.extend(app_and_owner,{app:options.data.app||void 0,owner:options.data.owner||void 0,sharing:options.data.sharing||void 0}));defaults.url=splunkd_utils.fullpath(url,app_and_owner);$.extend(!0,defaults,options);delete defaults.data.app;delete defaults.data.owner;delete defaults.data.sharing;bbXHR=Backbone.sync.call(this,"read",model,defaults);bbXHR.done(function(){deferredResponse.resolve.apply(deferredResponse,arguments)});bbXHR.fail(function(){deferredResponse.reject.apply(deferredResponse,arguments)});return deferredResponse.promise()},syncUpdate=function(model,options){var bbXHR,splunkDWhiteListXHR,url,deferredResponse=$.Deferred(),defaults={data:{output_mode:"json"}},id=model.id;url=splunkd_utils.fullpath(id,{});var mergedOptions=$.extend(!0,{},options,{url:url,success:function(){var fetchOptions=$.extend(!0,{},options);$.extend(!0,defaults.data,model.whiteListAttributes(fetchOptions));$.extend(!0,defaults,options);defaults.processData=!0;defaults.type="POST";defaults.url=url;defaults.data=splunkd_utils.normalizeValuesForPOST(defaults.data);bbXHR=Backbone.sync.call(null,"update",model,defaults);bbXHR.done(function(){deferredResponse.resolve.apply(deferredResponse,arguments)});bbXHR.fail(function(){deferredResponse.reject.apply(deferredResponse,arguments)})}});this.splunkDWhiteList.clear();splunkDWhiteListXHR=this.splunkDWhiteList.fetch(mergedOptions);splunkDWhiteListXHR.fail(function(){deferredResponse.reject.apply(deferredResponse,arguments)});return deferredResponse.promise()},syncDelete=function(model,options){var bbXHR,deferredResponse=$.Deferred(),defaults={data:{output_mode:"json"}};if(options.data&&options.data.output_mode){defaults.url=splunkd_utils.fullpath(model.id,{})+"?output_mode="+encodeURIComponent(options.data.output_mode);delete options.data.output_mode}else{defaults.url=splunkd_utils.fullpath(model.id,{})+"?output_mode="+encodeURIComponent(defaults.data.output_mode);delete defaults.data.output_mode}$.extend(!0,defaults,options);defaults.processData=!0;bbXHR=Backbone.sync.call(this,"delete",model,defaults);bbXHR.done(function(){deferredResponse.resolve.apply(deferredResponse,arguments)});bbXHR.fail(function(){deferredResponse.reject.apply(deferredResponse,arguments)});return deferredResponse.promise()},Model=BaseModel.extend({initialize:function(attributes,options){BaseModel.prototype.initialize.apply(this,arguments);this.splunkDWhiteList=options&&options.splunkDWhiteList?options.splunkDWhiteList:new SplunkDWhiteList;this.initializeAssociated();this.on("change:id",function(){var alt=this.id;alt&&(alt+="/acl");this.acl.set("id",alt)},this);options&&options.splunkDPayload&&this.setFromSplunkD(options.splunkDPayload,{silent:!0})},parseSplunkDMessages:function(response){var messages=BaseModel.prototype.parseSplunkDMessages.call(this,response);response&&response.entry&&response.entry.length>0&&(messages=_.union(messages,splunkd_utils.parseMessagesObject(response.entry[0].messages)));return messages},initializeAssociated:function(){var RootClass=this.constructor;this.associated=this.associated||{};this.links=this.links||new RootClass.Links;this.associated.links=this.links;this.generator=this.generator||new RootClass.Generator;this.associated.generator=this.generator;this.paging=this.paging||new RootClass.Paging;this.associated.paging=this.paging;if(!this.entry){this.entry=new RootClass.Entry;$.extend(this.entry,{links:new RootClass.Entry.Links,acl:new RootClass.Entry.ACL,content:new RootClass.Entry.Content,fields:new RootClass.Entry.Fields});this.entry.associated.links=this.entry.links;this.entry.associated.acl=this.entry.acl;this.entry.associated.content=this.entry.content;this.entry.associated.fields=this.entry.fields}this.associated.entry=this.entry;this.acl=this.acl||new ACLModel;this.associated.acl=this.acl},url:"",sync:function(method,model,options){switch(method){case"create":return syncCreate.call(this,model,options);case"read":return syncRead.call(this,model,options);case"update":return syncUpdate.call(this,model,options);case"delete":return syncDelete.call(this,model,options);default:throw new Error("invalid method: "+method)}},parse:function(response,options){options=options||{};options.skipClone||(response=$.extend(!0,{},response));this.initializeAssociated();if(response&&response.entry&&0!==response.entry.length){var response_entry=response.entry[0];if(splunkd_utils.isExistingEntity(response)){this.id=response_entry.links.alternate;response.id=response_entry.links.alternate;this.acl.set("id",this.id+"/acl")}this.links.set(response.links);delete response.links;this.generator.set(response.generator);delete response.generator;this.paging.set(response.paging);delete response.paging;this.entry.links.set(response_entry.links);delete response_entry.links;this.entry.acl.set(response_entry.acl);delete response_entry.acl;this.entry.content.set(response_entry.content);delete response_entry.content;response_entry.fields&&response_entry.fields.wildcard&&(response_entry.fields.wildcard=splunkd_utils.addAnchorsToWildcardArray(response_entry.fields.wildcard));this.entry.fields.set(response_entry.fields);delete response_entry.fields;this.entry.set(response_entry);delete response.entry;return response}console.log("Response has no content to parse")},whiteListAttributes:function(fetchOptions){var whiteListOptAndReq=this.splunkDWhiteList.concatOptionalRequired(),whiteListWild=this.splunkDWhiteList.get("wildcard")||[],contentAttrs=this.entry.content.filterByKeys(whiteListOptAndReq,{allowEmpty:!0},fetchOptions);return _.extend(contentAttrs,this.entry.content.filterByWildcards(whiteListWild,{allowEmpty:!0},fetchOptions))},setFromSplunkD:function(payload,options){this.attributes={};options=options||{};options.skipClone||(payload=$.extend(!0,{},payload));var oldId=this.id;if(payload){if(payload.entry&&payload.entry[0]){var payload_entry=payload.entry[0];if(payload_entry.links){if(splunkd_utils.isExistingEntity(payload)){this.set({id:payload_entry.links.alternate},{silent:!0});this.acl.set({id:payload_entry.links.alternate+"/acl"},options)}this.entry.links.set(payload_entry.links,options);delete payload_entry.links}if(payload_entry.acl){this.entry.acl.set(payload_entry.acl,options);delete payload_entry.acl}if(payload_entry.content){this.entry.content.set(payload_entry.content,options);delete payload_entry.content}if(payload_entry.fields){payload_entry.fields.wildcard&&(payload_entry.fields.wildcard=splunkd_utils.addAnchorsToWildcardArray(payload_entry.fields.wildcard));this.entry.fields.set(payload_entry.fields,options);delete payload_entry.fields}this.entry.set(payload_entry,options);delete payload.entry}if(payload.links){this.links.set(payload.links,options);delete payload.links}if(payload.generator){this.generator.set(payload.generator,options);delete payload.generator}if(payload.paging){this.paging.set(payload.paging,options);delete payload.paging}this.set(payload,options);this.id!==oldId&&this.trigger("change:"+this.idAttribute)}},toSplunkD:function(){var payload={};payload=$.extend(!0,{},this.toJSON());payload.links=$.extend(!0,{},this.links.toJSON());payload.generator=$.extend(!0,{},this.generator.toJSON());payload.paging=$.extend(!0,{},this.paging.toJSON());payload.entry=[$.extend(!0,{},this.entry.toJSON())];payload.entry[0].links=$.extend(!0,{},this.entry.links.toJSON());payload.entry[0].acl=$.extend(!0,{},this.entry.acl.toJSON());payload.entry[0].content=$.extend(!0,{},this.entry.content.toJSON());payload.entry[0].fields=$.extend(!0,{},this.entry.fields.toJSON());delete payload.id;return payload}},{Links:BaseModel,Generator:BaseModel,Paging:BaseModel,Entry:BaseModel.extend({initialize:function(){BaseModel.prototype.initialize.apply(this,arguments)}},{Links:BaseModel,ACL:ACLReadOnlyModel,Content:BaseModel,Fields:BaseModel})});return Model});(function(undefined){function padToken(func,count){return function(a){return leftZeroFill(func.call(this,a),count)}}function ordinalizeToken(func,period){return function(a){return this.lang().ordinal(func.call(this,a),period)}}function Language(){}function Moment(config){extend(this,config)}function Duration(duration){var data=this._data={},years=duration.years||duration.year||duration.y||0,months=duration.months||duration.month||duration.M||0,weeks=duration.weeks||duration.week||duration.w||0,days=duration.days||duration.day||duration.d||0,hours=duration.hours||duration.hour||duration.h||0,minutes=duration.minutes||duration.minute||duration.m||0,seconds=duration.seconds||duration.second||duration.s||0,milliseconds=duration.milliseconds||duration.millisecond||duration.ms||0;this._milliseconds=milliseconds+1e3*seconds+6e4*minutes+36e5*hours;this._days=days+7*weeks;this._months=months+12*years;data.milliseconds=milliseconds%1e3;seconds+=absRound(milliseconds/1e3);data.seconds=seconds%60;minutes+=absRound(seconds/60);data.minutes=minutes%60;hours+=absRound(minutes/60);data.hours=hours%24;days+=absRound(hours/24);days+=7*weeks;data.days=days%30;months+=absRound(days/30);data.months=months%12;years+=absRound(months/12);data.years=years}function extend(a,b){for(var i in b)b.hasOwnProperty(i)&&(a[i]=b[i]);return a}function absRound(number){return 0>number?Math.ceil(number):Math.floor(number)}function leftZeroFill(number,targetLength){for(var output=number+"";output.length<targetLength;)output="0"+output;return output}function addOrSubtractDurationFromMoment(mom,duration,isAdding){var currentDate,ms=duration._milliseconds,d=duration._days,M=duration._months;ms&&mom._d.setTime(+mom+ms*isAdding);d&&mom.date(mom.date()+d*isAdding);if(M){currentDate=mom.date();mom.date(1).month(mom.month()+M*isAdding).date(Math.min(currentDate,mom.daysInMonth()))}}function isArray(input){return"[object Array]"===Object.prototype.toString.call(input)}function compareArrays(array1,array2){var i,len=Math.min(array1.length,array2.length),lengthDiff=Math.abs(array1.length-array2.length),diffs=0;for(i=0;len>i;i++)~~array1[i]!==~~array2[i]&&diffs++;return diffs+lengthDiff}function normalizeUnits(units){return units?unitAliases[units]||units.toLowerCase().replace(/(.)s$/,"$1"):units}function loadLang(key,values){values.abbr=key;languages[key]||(languages[key]=new Language);languages[key].set(values);return languages[key]}function getLangDefinition(key){if(!key)return moment.fn._lang;!languages[key]&&hasModule&&require("./lang/"+key);return languages[key]}function removeFormattingTokens(input){return input.match(/\[.*\]/)?input.replace(/^\[|\]$/g,""):input.replace(/\\/g,"")}function makeFormatFunction(format){var i,length,array=format.match(formattingTokens);for(i=0,length=array.length;length>i;i++)array[i]=formatTokenFunctions[array[i]]?formatTokenFunctions[array[i]]:removeFormattingTokens(array[i]);return function(mom){var output="";for(i=0;length>i;i++)output+=array[i]instanceof Function?array[i].call(mom,format):array[i];return output}}function formatMoment(m,format){function replaceLongDateFormatTokens(input){return m.lang().longDateFormat(input)||input}for(var i=5;i--&&localFormattingTokens.test(format);)format=format.replace(localFormattingTokens,replaceLongDateFormatTokens);formatFunctions[format]||(formatFunctions[format]=makeFormatFunction(format));return formatFunctions[format](m)}function getParseRegexForToken(token){switch(token){case"DDDD":return parseTokenThreeDigits;case"YYYY":return parseTokenFourDigits;case"YYYYY":return parseTokenSixDigits;case"S":case"SS":case"SSS":case"DDD":return parseTokenOneToThreeDigits;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":case"a":case"A":return parseTokenWord;case"X":return parseTokenTimestampMs;case"Z":case"ZZ":return parseTokenTimezone;case"T":return parseTokenT;case"MM":case"DD":case"YY":case"HH":case"hh":case"mm":case"ss":case"M":case"D":case"d":case"H":case"h":case"m":case"s":return parseTokenOneOrTwoDigits;default:return new RegExp(token.replace("\\",""))}}function addTimeToArrayFromToken(token,input,config){var a,datePartArray=config._a;switch(token){case"M":case"MM":datePartArray[1]=null==input?0:~~input-1;break;case"MMM":case"MMMM":a=getLangDefinition(config._l).monthsParse(input);null!=a?datePartArray[1]=a:config._isValid=!1;break;case"D":case"DD":case"DDD":case"DDDD":null!=input&&(datePartArray[2]=~~input);break;case"YY":datePartArray[0]=~~input+(~~input>68?1900:2e3);break;case"YYYY":case"YYYYY":datePartArray[0]=~~input;break;case"a":case"A":config._isPm="pm"===(input+"").toLowerCase();break;case"H":case"HH":case"h":case"hh":datePartArray[3]=~~input;break;case"m":case"mm":datePartArray[4]=~~input;break;case"s":case"ss":datePartArray[5]=~~input;break;case"S":case"SS":case"SSS":datePartArray[6]=~~(1e3*("0."+input));break;case"X":config._d=new Date(1e3*parseFloat(input));break;case"Z":case"ZZ":config._useUTC=!0;a=(input+"").match(parseTimezoneChunker);a&&a[1]&&(config._tzh=~~a[1]);a&&a[2]&&(config._tzm=~~a[2]);if(a&&"+"===a[0]){config._tzh=-config._tzh;config._tzm=-config._tzm}}null==input&&(config._isValid=!1)}function dateFromArray(config){var i,date,input=[];if(!config._d){for(i=0;7>i;i++)config._a[i]=input[i]=null==config._a[i]?2===i?1:0:config._a[i];input[3]+=config._tzh||0;input[4]+=config._tzm||0;date=new Date(0);if(config._useUTC){date.setUTCFullYear(input[0],input[1],input[2]);date.setUTCHours(input[3],input[4],input[5],input[6])}else{date.setFullYear(input[0],input[1],input[2]);date.setHours(input[3],input[4],input[5],input[6])}config._d=date}}function makeDateFromStringAndFormat(config){var i,parsedInput,tokens=config._f.match(formattingTokens),string=config._i;config._a=[];for(i=0;i<tokens.length;i++){parsedInput=(getParseRegexForToken(tokens[i]).exec(string)||[])[0];parsedInput&&(string=string.slice(string.indexOf(parsedInput)+parsedInput.length));formatTokenFunctions[tokens[i]]&&addTimeToArrayFromToken(tokens[i],parsedInput,config)}config._isPm&&config._a[3]<12&&(config._a[3]+=12);config._isPm===!1&&12===config._a[3]&&(config._a[3]=0);dateFromArray(config)}function makeDateFromStringAndArray(config){var tempConfig,tempMoment,bestMoment,i,currentScore,scoreToBeat=99;for(i=config._f.length;i>0;i--){tempConfig=extend({},config);tempConfig._f=config._f[i-1];makeDateFromStringAndFormat(tempConfig);tempMoment=new Moment(tempConfig);if(tempMoment.isValid()){bestMoment=tempMoment;break}currentScore=compareArrays(tempConfig._a,tempMoment.toArray());if(scoreToBeat>currentScore){scoreToBeat=currentScore;bestMoment=tempMoment}}extend(config,bestMoment)}function makeDateFromString(config){var i,string=config._i;if(isoRegex.exec(string)){config._f="YYYY-MM-DDT";for(i=0;4>i;i++)if(isoTimes[i][1].exec(string)){config._f+=isoTimes[i][0];break}parseTokenTimezone.exec(string)&&(config._f+=" Z");makeDateFromStringAndFormat(config)}else config._d=new Date(string)}function makeDateFromInput(config){var input=config._i,matched=aspNetJsonRegex.exec(input);if(input===undefined)config._d=new Date;else if(matched)config._d=new Date(+matched[1]);else if("string"==typeof input)makeDateFromString(config);else if(isArray(input)){config._a=input.slice(0);dateFromArray(config)}else config._d=new Date(input instanceof Date?+input:input)}function substituteTimeAgo(string,number,withoutSuffix,isFuture,lang){return lang.relativeTime(number||1,!!withoutSuffix,string,isFuture)}function relativeTime(milliseconds,withoutSuffix,lang){var seconds=round(Math.abs(milliseconds)/1e3),minutes=round(seconds/60),hours=round(minutes/60),days=round(hours/24),years=round(days/365),args=45>seconds&&["s",seconds]||1===minutes&&["m"]||45>minutes&&["mm",minutes]||1===hours&&["h"]||22>hours&&["hh",hours]||1===days&&["d"]||25>=days&&["dd",days]||45>=days&&["M"]||345>days&&["MM",round(days/30)]||1===years&&["y"]||["yy",years];args[2]=withoutSuffix;args[3]=milliseconds>0;args[4]=lang;return substituteTimeAgo.apply({},args)}function weekOfYear(mom,firstDayOfWeek,firstDayOfWeekOfYear){var adjustedMoment,end=firstDayOfWeekOfYear-firstDayOfWeek,daysToDayOfWeek=firstDayOfWeekOfYear-mom.day();daysToDayOfWeek>end&&(daysToDayOfWeek-=7);end-7>daysToDayOfWeek&&(daysToDayOfWeek+=7);adjustedMoment=moment(mom).add("d",daysToDayOfWeek);return{week:Math.ceil(adjustedMoment.dayOfYear()/7),year:adjustedMoment.year()}}function makeMoment(config){var input=config._i,format=config._f;if(null===input||""===input)return null;"string"==typeof input&&(config._i=input=getLangDefinition().preparse(input));if(moment.isMoment(input)){config=extend({},input);config._d=new Date(+input._d)}else format?isArray(format)?makeDateFromStringAndArray(config):makeDateFromStringAndFormat(config):makeDateFromInput(config);return new Moment(config)}function makeGetterAndSetter(name,key){moment.fn[name]=moment.fn[name+"s"]=function(input){var utc=this._isUTC?"UTC":"";if(null!=input){this._d["set"+utc+key](input);return this}return this._d["get"+utc+key]()}}function makeDurationGetter(name){moment.duration.fn[name]=function(){return this._data[name]}}function makeDurationAsGetter(name,factor){moment.duration.fn["as"+name]=function(){return+this/factor}}for(var moment,i,VERSION="2.0.0",round=Math.round,languages={},hasModule="undefined"!=typeof module&&module.exports,aspNetJsonRegex=/^\/?Date\((\-?\d+)/i,aspNetTimeSpanJsonRegex=/(\-)?(\d*)?\.?(\d+)\:(\d+)\:(\d+)\.?(\d{3})?/,formattingTokens=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|SS?S?|X|zz?|ZZ?|.)/g,localFormattingTokens=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g,parseTokenOneOrTwoDigits=/\d\d?/,parseTokenOneToThreeDigits=/\d{1,3}/,parseTokenThreeDigits=/\d{3}/,parseTokenFourDigits=/\d{1,4}/,parseTokenSixDigits=/[+\-]?\d{1,6}/,parseTokenWord=/[0-9]*[a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,parseTokenTimezone=/Z|[\+\-]\d\d:?\d\d/i,parseTokenT=/T/i,parseTokenTimestampMs=/[\+\-]?\d+(\.\d{1,3})?/,isoRegex=/^\s*\d{4}-\d\d-\d\d((T| )(\d\d(:\d\d(:\d\d(\.\d\d?\d?)?)?)?)?([\+\-]\d\d:?\d\d)?)?/,isoFormat="YYYY-MM-DDTHH:mm:ssZ",isoTimes=[["HH:mm:ss.S",/(T| )\d\d:\d\d:\d\d\.\d{1,3}/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],parseTimezoneChunker=/([\+\-]|\d\d)/gi,proxyGettersAndSetters="Date|Hours|Minutes|Seconds|Milliseconds".split("|"),unitMillisecondFactors={Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6},unitAliases={ms:"millisecond",s:"second",m:"minute",h:"hour",d:"day",w:"week",M:"month",y:"year"},formatFunctions={},ordinalizeTokens="DDD w W M D d".split(" "),paddedTokens="M D H h m s w W".split(" "),formatTokenFunctions={M:function(){return this.month()+1},MMM:function(format){return this.lang().monthsShort(this,format)},MMMM:function(format){return this.lang().months(this,format)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(format){return this.lang().weekdaysMin(this,format)},ddd:function(format){return this.lang().weekdaysShort(this,format)},dddd:function(format){return this.lang().weekdays(this,format)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return leftZeroFill(this.year()%100,2)},YYYY:function(){return leftZeroFill(this.year(),4)},YYYYY:function(){return leftZeroFill(this.year(),5)},gg:function(){return leftZeroFill(this.weekYear()%100,2)},gggg:function(){return this.weekYear()},ggggg:function(){return leftZeroFill(this.weekYear(),5)},GG:function(){return leftZeroFill(this.isoWeekYear()%100,2)},GGGG:function(){return this.isoWeekYear()
},GGGGG:function(){return leftZeroFill(this.isoWeekYear(),5)},e:function(){return this.weekday()},E:function(){return this.isoWeekday()},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return~~(this.milliseconds()/100)},SS:function(){return leftZeroFill(~~(this.milliseconds()/10),2)},SSS:function(){return leftZeroFill(this.milliseconds(),3)},Z:function(){var a=-this.zone(),b="+";if(0>a){a=-a;b="-"}return b+leftZeroFill(~~(a/60),2)+":"+leftZeroFill(~~a%60,2)},ZZ:function(){var a=-this.zone(),b="+";if(0>a){a=-a;b="-"}return b+leftZeroFill(~~(10*a/6),4)},X:function(){return this.unix()}};ordinalizeTokens.length;){i=ordinalizeTokens.pop();formatTokenFunctions[i+"o"]=ordinalizeToken(formatTokenFunctions[i],i)}for(;paddedTokens.length;){i=paddedTokens.pop();formatTokenFunctions[i+i]=padToken(formatTokenFunctions[i],2)}formatTokenFunctions.DDDD=padToken(formatTokenFunctions.DDD,3);Language.prototype={set:function(config){var prop,i;for(i in config){prop=config[i];"function"==typeof prop?this[i]=prop:this["_"+i]=prop}},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(m){return this._months[m.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(m){return this._monthsShort[m.month()]},monthsParse:function(monthName){var i,mom,regex;this._monthsParse||(this._monthsParse=[]);for(i=0;12>i;i++){if(!this._monthsParse[i]){mom=moment([2e3,i]);regex="^"+this.months(mom,"")+"|^"+this.monthsShort(mom,"");this._monthsParse[i]=new RegExp(regex.replace(".",""),"i")}if(this._monthsParse[i].test(monthName))return i}},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(m){return this._weekdays[m.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(m){return this._weekdaysShort[m.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(m){return this._weekdaysMin[m.day()]},weekdaysParse:function(weekdayName){var i,mom,regex;this._weekdaysParse||(this._weekdaysParse=[]);for(i=0;7>i;i++){if(!this._weekdaysParse[i]){mom=moment([2e3,1]).day(i);regex="^"+this.weekdays(mom,"")+"|^"+this.weekdaysShort(mom,"")+"|^"+this.weekdaysMin(mom,"");this._weekdaysParse[i]=new RegExp(regex.replace(".",""),"i")}if(this._weekdaysParse[i].test(weekdayName))return i}},_longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},longDateFormat:function(key){var output=this._longDateFormat[key];if(!output&&this._longDateFormat[key.toUpperCase()]){output=this._longDateFormat[key.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(val){return val.slice(1)});this._longDateFormat[key]=output}return output},meridiem:function(hours,minutes,isLower){return hours>11?isLower?"pm":"PM":isLower?"am":"AM"},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},calendar:function(key,mom){var output=this._calendar[key];return"function"==typeof output?output.apply(mom):output},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(number,withoutSuffix,string,isFuture){var output=this._relativeTime[string];return"function"==typeof output?output(number,withoutSuffix,string,isFuture):output.replace(/%d/i,number)},pastFuture:function(diff,output){var format=this._relativeTime[diff>0?"future":"past"];return"function"==typeof format?format(output):format.replace(/%s/i,output)},ordinal:function(number){return this._ordinal.replace("%d",number)},_ordinal:"%d",preparse:function(string){return string},postformat:function(string){return string},week:function(mom){return weekOfYear(mom,this._week.dow,this._week.doy).week},_week:{dow:0,doy:6}};moment=function(input,format,lang){return makeMoment({_i:input,_f:format,_l:lang,_isUTC:!1})};moment.utc=function(input,format,lang){return makeMoment({_useUTC:!0,_isUTC:!0,_l:lang,_i:input,_f:format})};moment.unix=function(input){return moment(1e3*input)};moment.duration=function(input,key){var sign,ret,isDuration=moment.isDuration(input),isNumber="number"==typeof input,duration=isDuration?input._data:isNumber?{}:input,matched=aspNetTimeSpanJsonRegex.exec(input);if(isNumber)key?duration[key]=input:duration.milliseconds=input;else if(matched){sign="-"===matched[1]?-1:1;duration={y:0,d:~~matched[2]*sign,h:~~matched[3]*sign,m:~~matched[4]*sign,s:~~matched[5]*sign,ms:~~matched[6]*sign}}ret=new Duration(duration);isDuration&&input.hasOwnProperty("_lang")&&(ret._lang=input._lang);return ret};moment.version=VERSION;moment.defaultFormat=isoFormat;moment.lang=function(key,values){if(!key)return moment.fn._lang._abbr;values?loadLang(key,values):languages[key]||getLangDefinition(key);moment.duration.fn._lang=moment.fn._lang=getLangDefinition(key)};moment.langData=function(key){key&&key._lang&&key._lang._abbr&&(key=key._lang._abbr);return getLangDefinition(key)};moment.isMoment=function(obj){return obj instanceof Moment};moment.isDuration=function(obj){return obj instanceof Duration};moment.fn=Moment.prototype={clone:function(){return moment(this)},valueOf:function(){return+this._d},unix:function(){return Math.floor(+this._d/1e3)},toString:function(){return this.format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._d},toJSON:function(){return formatMoment(moment(this).utc(),"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},toArray:function(){var m=this;return[m.year(),m.month(),m.date(),m.hours(),m.minutes(),m.seconds(),m.milliseconds()]},isValid:function(){null==this._isValid&&(this._isValid=this._a?!compareArrays(this._a,(this._isUTC?moment.utc(this._a):moment(this._a)).toArray()):!isNaN(this._d.getTime()));return!!this._isValid},utc:function(){this._isUTC=!0;return this},local:function(){this._isUTC=!1;return this},format:function(inputString){var output=formatMoment(this,inputString||moment.defaultFormat);return this.lang().postformat(output)},add:function(input,val){var dur;dur="string"==typeof input?moment.duration(+val,input):moment.duration(input,val);addOrSubtractDurationFromMoment(this,dur,1);return this},subtract:function(input,val){var dur;dur="string"==typeof input?moment.duration(+val,input):moment.duration(input,val);addOrSubtractDurationFromMoment(this,dur,-1);return this},diff:function(input,units,asFloat){var diff,output,that=this._isUTC?moment(input).utc():moment(input).local(),zoneDiff=6e4*(this.zone()-that.zone());units=normalizeUnits(units);if("year"===units||"month"===units){diff=432e5*(this.daysInMonth()+that.daysInMonth());output=12*(this.year()-that.year())+(this.month()-that.month());output+=(this-moment(this).startOf("month")-(that-moment(that).startOf("month")))/diff;"year"===units&&(output/=12)}else{diff=this-that-zoneDiff;output="second"===units?diff/1e3:"minute"===units?diff/6e4:"hour"===units?diff/36e5:"day"===units?diff/864e5:"week"===units?diff/6048e5:diff}return asFloat?output:absRound(output)},from:function(time,withoutSuffix){return moment.duration(this.diff(time)).lang(this.lang()._abbr).humanize(!withoutSuffix)},fromNow:function(withoutSuffix){return this.from(moment(),withoutSuffix)},calendar:function(){var diff=this.diff(moment().startOf("day"),"days",!0),format=-6>diff?"sameElse":-1>diff?"lastWeek":0>diff?"lastDay":1>diff?"sameDay":2>diff?"nextDay":7>diff?"nextWeek":"sameElse";return this.format(this.lang().calendar(format,this))},isLeapYear:function(){var year=this.year();return year%4===0&&year%100!==0||year%400===0},isDST:function(){return this.zone()<moment([this.year()]).zone()||this.zone()<moment([this.year(),5]).zone()},day:function(input){var day=this._isUTC?this._d.getUTCDay():this._d.getDay();if(null!=input){if("string"==typeof input){input=this.lang().weekdaysParse(input);if("number"!=typeof input)return this}return this.add({d:input-day})}return day},month:function(input){var utc=this._isUTC?"UTC":"";if(null!=input){if("string"==typeof input){input=this.lang().monthsParse(input);if("number"!=typeof input)return this}this._d["set"+utc+"Month"](input);return this}return this._d["get"+utc+"Month"]()},startOf:function(units){units=normalizeUnits(units);switch(units){case"year":this.month(0);case"month":this.date(1);case"week":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}"week"===units&&this.day(0);return this},endOf:function(units){return this.startOf(units).add(units,1).subtract("ms",1)},isAfter:function(input,units){units="undefined"!=typeof units?units:"millisecond";return+this.clone().startOf(units)>+moment(input).startOf(units)},isBefore:function(input,units){units="undefined"!=typeof units?units:"millisecond";return+this.clone().startOf(units)<+moment(input).startOf(units)},isSame:function(input,units){units="undefined"!=typeof units?units:"millisecond";return+this.clone().startOf(units)===+moment(input).startOf(units)},zone:function(){return this._isUTC?0:this._d.getTimezoneOffset()},daysInMonth:function(){return moment.utc([this.year(),this.month()+1,0]).date()},dayOfYear:function(input){var dayOfYear=round((moment(this).startOf("day")-moment(this).startOf("year"))/864e5)+1;return null==input?dayOfYear:this.add("d",input-dayOfYear)},weekYear:function(input){var year=weekOfYear(this,this.lang()._week.dow,this.lang()._week.doy).year;return null==input?year:this.add("y",input-year)},isoWeekYear:function(input){var year=weekOfYear(this,1,4).year;return null==input?year:this.add("y",input-year)},week:function(input){var week=this.lang().week(this);return null==input?week:this.add("d",7*(input-week))},isoWeek:function(input){var week=weekOfYear(this,1,4).week;return null==input?week:this.add("d",7*(input-week))},weekday:function(input){var weekday=(this._d.getDay()+7-this.lang()._week.dow)%7;return null==input?weekday:this.add("d",input-weekday)},isoWeekday:function(input){var weekday=(this._d.getDay()+6)%7;return null==input?weekday:this.add("d",input-weekday)},lang:function(key){if(key===undefined)return this._lang;this._lang=getLangDefinition(key);return this}};for(i=0;i<proxyGettersAndSetters.length;i++)makeGetterAndSetter(proxyGettersAndSetters[i].toLowerCase().replace(/s$/,""),proxyGettersAndSetters[i]);makeGetterAndSetter("year","FullYear");moment.fn.days=moment.fn.day;moment.fn.months=moment.fn.month;moment.fn.weeks=moment.fn.week;moment.fn.isoWeeks=moment.fn.isoWeek;moment.duration.fn=Duration.prototype={weeks:function(){return absRound(this.days()/7)},valueOf:function(){return this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*~~(this._months/12)},humanize:function(withSuffix){var difference=+this,output=relativeTime(difference,!withSuffix,this.lang());withSuffix&&(output=this.lang().pastFuture(difference,output));return this.lang().postformat(output)},get:function(units){units=normalizeUnits(units);return this[units.toLowerCase()+"s"]()},as:function(units){units=normalizeUnits(units);return this["as"+units.charAt(0).toUpperCase()+units.slice(1)+"s"]()},lang:moment.fn.lang};for(i in unitMillisecondFactors)if(unitMillisecondFactors.hasOwnProperty(i)){makeDurationAsGetter(i,unitMillisecondFactors[i]);makeDurationGetter(i.toLowerCase())}makeDurationAsGetter("Weeks",6048e5);moment.duration.fn.asMonths=function(){return(+this-31536e6*this.years())/2592e6+12*this.years()};moment.lang("en",{ordinal:function(number){var b=number%10,output=1===~~(number%100/10)?"th":1===b?"st":2===b?"nd":3===b?"rd":"th";return number+output}});hasModule&&(module.exports=moment);"undefined"==typeof ender&&(this["moment"]=moment);"function"==typeof define&&define.amd&&define("moment",[],function(){return moment})}).call(this);define("util/moment",["splunk.i18n","moment"],function(i18n,moment){var initFn=i18n.moment_install;"function"==typeof initFn&&initFn(moment);return moment});define("util/time",["underscore","splunk.i18n","splunk.util","util/moment"],function(_,i18n,splunkUtils,moment){var BD_TIME_REGEX_MILLIS=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})\.(\d+)[+-]{1}\d{2}[:]?\d{2}$/,BD_TIME_REGEX_NO_MILLIS=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})[+-]{1}\d{2}[:]?\d{2}$/,u={},language=i18n.locale_name().substring(0,2),ISO_PATTERN="%Y-%m-%dT%H:%M:%S.%Q%:z";u.s=u.sec=u.secs=u.second=u.seconds={abbr:"s",singular:_("second").t(),plural:_("seconds").t()};u.m=u.min=u.mins=u.minute=u.minutes={abbr:"m",singular:_("minute").t(),plural:_("minutes").t()};u.h=u.hr=u.hrs=u.hour=u.hours={abbr:"h",singular:_("hour").t(),plural:_("hours").t()};u.d=u.day=u.days={abbr:"d",singular:_("day").t(),plural:_("days").t()};u.w=u.week=u.weeks={abbr:"w",singular:_("week").t(),plural:_("weeks").t()};u.mon=u.month=u.months={abbr:"mon",singular:_("month").t(),plural:_("months").t()};u.q=u.qtr=u.qtrs=u.quarter=u.quarters={abbr:"q",singular:_("quarter").t(),plural:_("quarters").t()};u.y=u.yr=u.yrs=u.year=u.years={abbr:"y",singular:_("year").t(),plural:_("years").t()};var TIME_UNITS=u,BdTime=function(isoString){var bdPieces=BD_TIME_REGEX_MILLIS.exec(isoString)||BD_TIME_REGEX_NO_MILLIS.exec(isoString);if(bdPieces){this.year=parseInt(bdPieces[1],10);this.month=parseInt(bdPieces[2],10);this.day=parseInt(bdPieces[3],10);this.hour=parseInt(bdPieces[4],10);this.minute=parseInt(bdPieces[5],10);this.second=parseInt(bdPieces[6],10);this.millisecond=bdPieces.length>7?parseInt(bdPieces[7],10):0}else this.isInvalid=!0},extractBdTime=function(timeString){return new BdTime(timeString)},bdTimeToDateObject=function(bdTime){var year=bdTime.year,month=bdTime.month-1,day=bdTime.day,hour=bdTime.hour,minute=bdTime.minute,second=bdTime.second,millisecond=bdTime.millisecond;return new Date(year,month,day,hour,minute,second,millisecond)},isoToDateObject=function(isoString){var bdTime=extractBdTime(isoString);return bdTimeToDateObject(bdTime)},jsDateToSplunkDateTimeWithMicroseconds=function(jsDate){var dateTime=new i18n.DateTime({date:jsDate,year:jsDate.getFullYear(),month:jsDate.getMonth()+1,day:jsDate.getDate(),hour:jsDate.getHours(),minute:jsDate.getMinutes(),second:jsDate.getSeconds(),microsecond:1e3*jsDate.getMilliseconds()});dateTime.weekday=function(){var d=this.date.getDay()-1;0>d&&(d=6);return d};return dateTime},determineLabelGranularity=function(times){if(1===times.length)return"second";times[0]instanceof BdTime||(times=_(times).map(extractBdTime));var seconds=[],minutes=[],hours=[],days=[],months=[],allInListMatch=function(list,matchMe){for(var i=0;i<list.length;i++)if(list[i]!==matchMe)return!1;return!0};_(times).each(function(time){seconds.push(time.second);minutes.push(time.minute);hours.push(time.hour);days.push(time.day);months.push(time.month)});return allInListMatch(seconds,0)?allInListMatch(minutes,0)?allInListMatch(hours,0)?allInListMatch(days,1)?allInListMatch(months,1)?"year":"month":"day":"hour":"minute":"second"},isValidIsoTime=function(str){return BD_TIME_REGEX_MILLIS.test(str)||BD_TIME_REGEX_NO_MILLIS.test(str)},convertToLocalTime=function(epochTime){return epochTime?new Date(1e3*epochTime).toLocaleString():null},convertToRelativeTime=function(endTime,startTime,withoutSuffix){if(!endTime)return null;var endMoment=moment.unix(endTime);return void 0!==startTime?endMoment.from(moment.unix(startTime),withoutSuffix):endMoment.fromNow(withoutSuffix)},convertAmountAndUnitToSeconds=function(amount,unit){var seconds=amount;switch(unit){case"d":seconds*=86400;break;case"h":seconds*=3600;break;case"m":seconds*=60}return seconds},getRelativeStringFromSeconds=function(seconds,removeAgo){_.isString(seconds)&&(seconds=parseInt(seconds,10));var now=new Date,startTime=now.getTime()/1e3,endTime=startTime-seconds;return convertToRelativeTime(endTime,startTime,removeAgo)},normalizeUnit=function(abbr,required){var hasUnit=TIME_UNITS.hasOwnProperty(abbr),defaultUnit=required===!1?"":TIME_UNITS.s.abbr;return hasUnit?TIME_UNITS[abbr].abbr:defaultUnit},parseTimeString=function(timeString){if(!_.isString(timeString))return!1;var parse=timeString.match(/^\s*(rt|)([-+]?)(\d*)([a-zA-Z]*)(@?)([a-zA-Z]*)(\d*)\s*$/);if(parse){var normalizedUnit=normalizeUnit(parse[4],!1),hasSnap=""!==parse[5];return{amount:normalizedUnit?parseInt(parse[3],10)||1:0,unit:normalizedUnit,hasSnap:hasSnap,snapUnit:normalizeUnit(parse[6],!1),snapUnitAmount:parseInt(parse[7],10),isNow:"now"===parse[4],isRealTime:"rt"===parse[1],isPositive:"+"===parse[2]||!0,parse:parse}}return!1},isRealtime=function(time){return _.isString(time)&&0===time.indexOf("rt")},stripRTSafe=function(timeString,isLatest){var sign,parsedTimeString,strippedString;if(!isRealtime(timeString))return timeString;parsedTimeString=parseTimeString(timeString);if(!parsedTimeString)return timeString;if(parsedTimeString.unit||parsedTimeString.isNow)return parsedTimeString.parse.slice(2,parsedTimeString.parse.length).join("");strippedString=parsedTimeString.parse.slice(3,parsedTimeString.parse.length).join("");if(strippedString){sign=parsedTimeString.isPositive?"+":"-";return sign+strippedString}return isLatest?"":"0"},rangeFromIsoAndOffset=function(iso,offset){var lowerRange=new Date(iso),upperRange=new Date(iso);switch(offset){case"w":lowerRange.setDate(lowerRange.getDate()-7);upperRange.setDate(upperRange.getDate()+7);break;case"d":lowerRange.setDate(lowerRange.getDate()-1);upperRange.setDate(upperRange.getDate()+1);break;case"h":lowerRange.setHours(lowerRange.getHours()-1);upperRange.setHours(upperRange.getHours()+1);break;case"m":lowerRange.setMinutes(lowerRange.getMinutes()-1);upperRange.setMinutes(upperRange.getMinutes()+1);break;case"s":lowerRange.setSeconds(lowerRange.getSeconds()-1);upperRange.setSeconds(upperRange.getSeconds()+1);break;case"ms":lowerRange.setMilliseconds(lowerRange.getMilliseconds()-1);upperRange.setMilliseconds(upperRange.getMilliseconds()+1)}return{lowerRange:lowerRange,upperRange:upperRange}},isAbsolute=function(time){return void 0===time?!1:_.isNumber(time)||!/^(now|-|\+|@|rt).*/.test(time)},isEpoch=function(time){return _.isNumber(time)||_.isString(time)&&/^\d+((\.\d+)|(\d*))$/.test(time)&&"0"!==time},timeAndJsDateIsWholeDay=function(time,jsDate){return isAbsolute(time)&&jsDate?0==jsDate.getHours()&&0==jsDate.getMinutes()&&0==jsDate.getSeconds()&&0==jsDate.getMilliseconds():!1},isNow=function(time){return time?_.isString(time)&&(""===time||/now/.test(time)):!0},isEmpty=function(time){return"0"===time?!0:!time},findPresetLabel=function(presetsCollection,earliest,latest){var presetModel;if(presetsCollection.length>0){presetModel=presetsCollection.find(function(model){var timesConfEarliest=model.entry.content.get("earliest_time"),timesConfLatest=model.entry.content.get("latest_time"),noEarliests=isEmpty(timesConfEarliest)&&isEmpty(earliest),noLatests=isEmpty(timesConfLatest)&&isEmpty(latest),isDisabled=model.isDisabled(),isSubMenu=model.isSubMenu();return!(isDisabled||isSubMenu||!noEarliests&&timesConfEarliest!=earliest||!noLatests&&timesConfLatest!=latest)});if(presetModel)return presetModel.entry.content.get("label")}return!1},generateRealtimeLabel=function(earliest,latest){var earliestParse,latestIsNow;if(isRealtime(earliest)||isRealtime(latest)){earliestParse=parseTimeString(earliest);latestIsNow=isNow(latest);var labelTemplates={s:_("%t second window").t(),m:_("%t minute window").t(),h:_("%t hour window").t(),d:_("%t day window").t(),w:_("%t week window").t(),mon:_("%t month window").t(),q:_("%t quarter window").t(),y:_("%t year window").t()};return earliestParse&&earliestParse.amount&&latestIsNow&&labelTemplates.hasOwnProperty(earliestParse.unit)?labelTemplates[earliestParse.unit].replace(/%t/,earliestParse.amount):_("Real-time").t()}return!1},generateRelativeTimeLabel=function(earliest,latest){var earliestParse=parseTimeString(earliest),latestParse=(isNow(latest),parseTimeString(latest));if(!earliestParse||earliestParse.isRealTime||latestParse.isRealTime)return!1;if(!(!earliestParse.amount||earliestParse.snapUnit&&earliestParse.unit!==earliestParse.snapUnit||!(latestParse.isNow||latestParse.snapUnit&&!latestParse.amount)||latestParse.snapUnit&&earliestParse.unit!==latestParse.snapUnit)){var relativeLabel=_("Last %amount %unit").t();relativeLabel=relativeLabel.replace(/%amount/,earliestParse.amount);relativeLabel=relativeLabel.replace(/%unit/,TIME_UNITS[earliestParse.unit][earliestParse.amount>1?"plural":"singular"]);return relativeLabel}return!1},generateBetweenTimeLabel=function(earliest,earliestJSDate,latest,latestJSDate){var earliestIsWholeDay=timeAndJsDateIsWholeDay(earliest,earliestJSDate),latestIsWholeDay=timeAndJsDateIsWholeDay(latest,latestJSDate);if(earliestIsWholeDay&&latestIsWholeDay){if("en"==language)return i18n.format_datetime_range(null,earliestJSDate,latestJSDate,!0);var dateLabel=_("%1 through %2").t(),labelDate=new Date(latestJSDate.getTime());labelDate.setDate(labelDate.getDate()-1);return dateLabel.replace("%1",i18n.format_date(earliestJSDate,"short")).replace("%2",i18n.format_date(labelDate,"short"))}return!1},generateSinceDateLabel=function(earliest,earliestJSDate,latest){var earliestIsWholeDay=timeAndJsDateIsWholeDay(earliest,earliestJSDate),latestIsNow=isNow(latest);if(earliestIsWholeDay&&latestIsNow){var dateLabel=_("Since %1").t();return dateLabel.replace("%1",i18n.format_date(earliestJSDate,"short"))}return!1},generateBeforeDateLabel=function(earliest,latest,latestJSDate){if(isEmpty(earliest)&&timeAndJsDateIsWholeDay(latest,latestJSDate)){var dateLabel=_("Before %1").t();return dateLabel.replace("%1",i18n.format_date(latestJSDate,"short"))}return!1},generateDateTimeRangeLabel=function(earliest,latest){return!isEmpty(earliest)&&isAbsolute(earliest)&&isAbsolute(latest)?_("Date time range").t():!1},generateSinceTimeRangeLabel=function(earliest,latest){return isAbsolute(earliest)&&isNow(latest)?_("Since date time").t():!1},generateBeforeTimeRangeLabel=function(earliest,latest){return isEmpty(earliest)&&isAbsolute(latest)?_("Before date time").t():!1},generateAllTimeLabel=function(earliest,latest){return isEmpty(earliest)&&isNow(latest)?_("All time").t():!1},generateLabel=function(presetsCollection,earliest,earliestJSDate,latest,latestJSDate){return generateAllTimeLabel(earliest,latest)||findPresetLabel(presetsCollection,earliest,latest)||generateRealtimeLabel(earliest,latest)||generateRelativeTimeLabel(earliest,latest)||generateBetweenTimeLabel(earliest,earliestJSDate,latest,latestJSDate)||generateSinceDateLabel(earliest,earliestJSDate,latest)||generateBeforeDateLabel(earliest,latest,latestJSDate)||generateDateTimeRangeLabel(earliest,latest)||generateSinceTimeRangeLabel(earliest,latest)||generateBeforeTimeRangeLabel(earliest,latest)||_("Custom time").t()};return{extractBdTime:extractBdTime,bdTimeToDateObject:bdTimeToDateObject,rangeFromIsoAndOffset:rangeFromIsoAndOffset,isoToDateObject:isoToDateObject,determineLabelGranularity:determineLabelGranularity,isValidIsoTime:isValidIsoTime,TIME_UNITS:TIME_UNITS,ISO_PATTERN:ISO_PATTERN,normalizeUnit:normalizeUnit,parseTimeString:parseTimeString,isRealtime:isRealtime,stripRTSafe:stripRTSafe,isAbsolute:isAbsolute,isEpoch:isEpoch,timeAndJsDateIsWholeDay:timeAndJsDateIsWholeDay,isNow:isNow,isEmpty:isEmpty,findPresetLabel:findPresetLabel,generateRealtimeLabel:generateRealtimeLabel,generateRelativeTimeLabel:generateRelativeTimeLabel,generateBetweenTimeLabel:generateBetweenTimeLabel,generateSinceDateLabel:generateSinceDateLabel,generateBeforeDateLabel:generateBeforeDateLabel,generateDateTimeRangeLabel:generateDateTimeRangeLabel,generateSinceTimeRangeLabel:generateSinceTimeRangeLabel,generateBeforeTimeRangeLabel:generateBeforeTimeRangeLabel,generateAllTimeLabel:generateAllTimeLabel,generateLabel:generateLabel,convertToRelativeTime:convertToRelativeTime,convertToLocalTime:convertToLocalTime,jsDateToSplunkDateTimeWithMicroseconds:jsDateToSplunkDateTimeWithMicroseconds,getRelativeStringFromSeconds:getRelativeStringFromSeconds,convertAmountAndUnitToSeconds:convertAmountAndUnitToSeconds}});define("models/services/data/ui/Time",["jquery","splunk.util","models/SplunkDBase","util/time"],function($,splunkutil,SplunkDBaseModel,time_utils){return SplunkDBaseModel.extend({url:"data/ui/times",initialize:function(){SplunkDBaseModel.prototype.initialize.apply(this,arguments)},isRealTime:function(){return this.isDisabled()?!1:time_utils.isRealtime(this.entry.content.get("latest_time"))},isPeriod:function(){if(this.isDisabled())return!1;var earliest=this.entry.content.get("earliest_time"),latest=this.entry.content.get("latest_time");return earliest&&-1!=earliest.indexOf("@")&&0!=earliest.indexOf("-")?!0:earliest&&latest&&-1!=earliest.indexOf("@")&&-1!=latest.indexOf("@")?!0:!1},isLast:function(){if(this.isDisabled())return!1;if(this.isPeriod())return!1;var earliest=this.entry.content.get("earliest_time");return earliest?0==earliest.indexOf("-"):!1},isOther:function(){return this.isDisabled()?!1:!(this.isRealTime()||this.isPeriod()||this.isLast()||this.isSubMenu())},isDisabled:function(){return this.entry.content.get("disabled")},isSubMenu:function(){return"1"===this.entry.content.get("is_sub_menu")}})});define("models/shared/fetchdata/EAIFetchData",["underscore","models/Base"],function(_,Base){return Base.extend({defaults:{filter:{}},toJSON:function(){var json=Base.prototype.toJSON.apply(this,arguments);if(json.sortKey){json.sort_key=json.sortKey;json.sort_dir=json.sortDirection}delete json.sortKey;delete json.sortDirection;if(_(json.filter).size()>0){var search=[];_(json.filter).each(function(match,key){search.push(key+"=*"+match+"*")});json.search=search.join(" ")}delete json.filter;return json}})});define("collections/Base",["jquery","underscore","backbone","mixins/modelcollection","models/Base","splunk.util","util/splunkd_utils"],function($,_,Backbone,modelcollectionMixin,Base,splunkUtils,splunkDUtils){var BaseCollection=Backbone.Collection.extend({initialize:function(models,options){Backbone.Collection.prototype.initialize.apply(this,arguments);this.fetchData=options&&options.fetchData?options.fetchData:new Base;this.fetchData.on("change",_.debounce(function(){this.safeFetch()},0),this);this.associated=this.associated||{};this.on("sync",this._onsync,this);this.on("error",this._onerror,this);this.on("reset",this.previousModelsOff,this)},fetch:function(options){var mergedOptions=$.extend(!0,{},{data:this.fetchData.toJSON()},options);this.fetchXhr=Backbone.Collection.prototype.fetch.call(this,mergedOptions);var that=this;this.fetchXhr.done(function(){that.touched&&that.safeFetch.apply(that,that.touched)});return this.fetchXhr},_onerror:function(collection,response){var messages=splunkDUtils.xhrErrorResponseParser(response,this.id);this.trigger("serverValidated",!1,this,messages)},_onsync:function(collection,response){var messages=this.parseSplunkDMessages(response),hasErrors=_(messages).any(function(message){return message.type===splunkDUtils.ERROR||message.type===splunkDUtils.FATAL});this.trigger("serverValidated",!hasErrors,this,messages)},parseSplunkDMessages:function(response){return response?splunkDUtils.parseMessagesObject(response.messages):[]},deepOff:function(){modelcollectionMixin.deepOff.apply(this,arguments);this.each(function(model){_.isFunction(model.deepOff)&&model.deepOff()})},associatedOff:function(events,callback,context){_(this.associated).each(function(associated){associated.off(events,callback,context);_.isFunction(associated.associatedOff)&&associated.associatedOff(events,callback,context)},this);this.each(function(model){_.isFunction(model.associatedOff)&&model.associatedOff(events,callback,context)});this.fetchData.off(events,callback,context)},previousModelsOff:function(models,options){_(options.previousModels).each(function(model){_.isFunction(model.deepOff)&&model.deepOff()})},reverse:function(options){options||(options={});var reversedModels=[].concat(this.models).reverse();if(options.mutate===!1)return reversedModels;this.reset(reversedModels,options);return void 0},isValid:function(options){return this.all(function(model){return model.isValid(options)})},deepClone:function(){return new this.constructor(this.invoke("clone"))}});_.extend(BaseCollection.prototype,modelcollectionMixin);return BaseCollection});define("collections/SplunkDsBase",["jquery","underscore","backbone","models/SplunkDBase","models/shared/fetchdata/EAIFetchData","collections/Base","util/splunkd_utils"],function($,_,Backbone,SplunkDBaseModel,EAIFetchData,Base,splunkDUtils){return Base.extend({model:SplunkDBaseModel,initialize:function(models,options){options=options||{};options.fetchData=options.fetchData||new EAIFetchData;Base.prototype.initialize.call(this,models,options)},fetch:function(options){return Base.prototype.fetch.call(this,$.extend(!0,{},{reset:!0},options))},sync:function(method,collection,options){options=options||{};var url,defaults={data:{output_mode:"json"},traditional:!0};switch(method){case"read":if((window.$C["SPLUNKD_FREE_LICENSE"]||options.isFreeLicense)&&collection.FREE_PAYLOAD){options.success&&options.success(collection,collection.FREE_PAYLOAD,options);var dfd=$.Deferred();return dfd.resolve.apply(dfd,[collection,collection.FREE_PAYLOAD,options])}url=_.isFunction(collection.url)?collection.url():collection.url;var appOwner={};options.data&&(appOwner=$.extend(appOwner,{app:options.data.app||void 0,owner:options.data.owner||void 0,sharing:options.data.sharing||void 0}));defaults.url=splunkDUtils.fullpath(url,appOwner);$.extend(!0,defaults,options);delete defaults.data.app;delete defaults.data.owner;delete defaults.data.sharing;return Backbone.sync.call(this,"read",collection,defaults);default:throw new Error("invalid method: "+method)}},parse:function(response){var results=response.entry,header=$.extend(!0,{},response);delete header.entry;return _.map(results,function(result){var container=$.extend(!0,{},header);container.entry=[$.extend(!0,{},result)];return container})},setFromSplunkD:function(payload,options){this.reset(payload,$.extend({parse:!0},options))}},{availableWithUserWildCardSearchString:function(owner){return'((eai:acl.sharing="user" AND eai:acl.owner="'+owner+'") OR (eai:acl.sharing!="user"))'}})});define("collections/services/data/ui/Times",["models/services/data/ui/Time","collections/SplunkDsBase"],function(TimeModel,SplunkDsBaseCollection){var TimesCollection=SplunkDsBaseCollection.extend({url:"data/ui/times",model:TimeModel,initialize:function(){SplunkDsBaseCollection.prototype.initialize.apply(this,arguments)},filterToRealTime:function(){return this.filter(function(model){return model.isRealTime()})},filterToPeriod:function(){return this.filter(function(model){return model.isPeriod()})},filterToLast:function(){return this.filter(function(model){return model.isLast()})},filterToOther:function(){return this.filter(function(model){return model.isOther()})},comparator:function(model){return parseInt(model.entry.content.get("order"),10)}});return TimesCollection});define("models/shared/Application",["models/Base"],function(BaseModel){return BaseModel.extend({initialize:function(){BaseModel.prototype.initialize.apply(this,arguments)},getPermissions:function(permission){return{app:this.get("app"),owner:"private"===permission?this.get("owner"):"nobody"}}})});define("models/services/AppLocal",["models/SplunkDBase"],function(SplunkDBaseModel){return SplunkDBaseModel.extend({url:"apps/local",initialize:function(){SplunkDBaseModel.prototype.initialize.apply(this,arguments)},appAllowsDisable:function(){return this.entry.links.get("disable")?!0:!1}})});define("app/models/AttributesTable",["jquery","underscore","backbone"],function($,_,Backbone){return Backbone.Model.extend({initialize:function(attributes,options){this.collection=options.swimlanes;
this.collection.on("reset",_.bind(this.fetchAll,this));this.fieldName=this.collection.prefs.field_name},url:function(){return Splunk.util.make_url("/custom/SA-Utils/identitymapper/reverse_lookup?"+this.query)},fetchAll:function(){if(this.collection.length>0){var value=this.collection.at(0).pref.get("entity_name"),constraint_method=this.collection.at(0).get("constraint_method");this.constraint_method=constraint_method;this.query="value="+value+"&constraint_method="+constraint_method;this.value=value}this.collection.each(function(model){var constraint_fields=model.get("constraint_fields");if("undefined"!=typeof value&&constraint_fields&&constraint_method)this.query+="&constraint_fields="+constraint_fields;else if("undefined"==typeof value){this.trigger("entity:undefined");model.trigger("entity:undefined")}},this);var that=this;this.fetch({success:function(m,resp){0===resp.count&&that.trigger("entity:notFound");that.collection.length===resp.clauses.length?_.map(_.zip(that.collection.models,resp.clauses),function(f){f[0].set("constraints",f[1])}):that.trigger("entity:invalid")},error:function(){that.trigger("entity:invalid")}})},parse:function(result){this.clear();_.each(result.records[0],function(val,key){var existing=this.get(key);existing?this.set(key,_.union(existing,val)):this.set(key,val)},this)},setNewEntity:function(entity){var pref=this.collection.getPref();pref.set("identity",entity);pref.set("entity_name",entity);this.collection.prefs.urlSync.setEntityName(entity);pref.save();this.trigger("setEntityName");this.fetchAll()}})});define("models/services/search/TimeParser",["jquery","underscore","backbone","models/Base","util/splunkd_utils"],function($,_,Backbone,BaseModel,splunkd_utils){return BaseModel.extend({initialize:function(options){BaseModel.prototype.initialize.call(this,options)},sync:function(method,model,options){switch(method){case"read":var syncOptions=splunkd_utils.prepareSyncOptions(options,model.url);if(""===options.data.time){model.set({key:"",value:""});return}return Backbone.sync.call(this,"read",model,syncOptions);default:throw"Operation not supported"}},url:"/services/search/timeparser",parse:function(response){if(!response)return{};var key=_.keys(response)[0],value=response[key];return{key:key,value:value}},idAttribute:"key"})});define("collections/services/search/TimeParsers",["underscore","backbone","models/services/search/TimeParser","collections/Base","util/splunkd_utils"],function(_,Backbone,TimeParserModel,CollectionsBase,splunkDUtils){return CollectionsBase.extend({model:TimeParserModel,intialize:function(){CollectionsBase.prototype.initialize.apply(this,arguments)},sync:function(method,collection,options){var appOwner={},defaults={data:{output_mode:"json"},traditional:!0};switch(method){case"read":if(options&&options.data){appOwner=$.extend(appOwner,{app:options.data.app||void 0,owner:options.data.owner||void 0});delete options.data.app;delete options.data.owner}defaults.url=splunkDUtils.fullpath(collection.url,appOwner);$.extend(!0,defaults,options||{});return Backbone.sync.call(this,"read",collection,defaults);default:throw"Operation not supported"}},url:"/services/search/timeparser",parse:function(response){var model,models=[];for(var key in response){model={};model[key]=response[key];models.push(model)}return models}})});define("models/shared/TimeRange",["jquery","underscore","splunk.i18n","models/Base","collections/services/search/TimeParsers","util/splunkd_utils","util/time"],function($,_,i18n,BaseModel,TimeParsersCollection,splunkd_utils,time_utils){return BaseModel.extend({initialize:function(){BaseModel.prototype.initialize.apply(this,arguments);this.timeParsers=new TimeParsersCollection;this.associated.timeParsers=this.timeParsers;this.units=time_utils.TIME_UNITS},clear:function(){delete this.timeParsersXHR;return BaseModel.prototype.clear.apply(this,arguments)},defaults:{enableRealTime:!0},validation:{earliest:[{},{fn:"validateTime"}],latest:[{},{fn:"validateTime"}]},validateTime:function(value,attr,computedState){var earliest_time_attr=computedState.earliest||"",latest_time_attr=computedState.latest||"",enableRealTime=this.get("enableRealTime"),is_earliest_rt=time_utils.isRealtime(earliest_time_attr),is_latest_rt=time_utils.isRealtime(latest_time_attr),earliest_time=time_utils.stripRTSafe(earliest_time_attr,!1),latest_time=time_utils.stripRTSafe(latest_time_attr,!0);if(earliest_time&&latest_time&&earliest_time===latest_time&&"latest"===attr)return _("You cannot have equivalent times.").t();if(enableRealTime){if(is_earliest_rt&&!is_latest_rt&&"latest"===attr)return _("You must set a rt value for latest time if you set a rt value for earliest time.").t();if(!is_earliest_rt&&is_latest_rt&&"earliest"===attr)return _("You must set a rt value for earliest time if you set a rt value for latest time.").t()}else if(is_earliest_rt&&is_latest_rt&&"latest"===attr||is_earliest_rt&&!is_latest_rt&&"earliest"===attr||is_latest_rt&&!is_earliest_rt&&"latest"===attr)return _("rt time values are not allowed").t()},sync:function(method,model,options){var error_msg,latest,earliest,deferredResponse=$.Deferred(),rootOptions=options,times=[],data={};model.trigger("request",model,deferredResponse,options);switch(method){case"create":earliest=time_utils.stripRTSafe((model.get("earliest")||"")+"",!1);earliest&&times.push(earliest);latest=time_utils.stripRTSafe((model.get("latest")||"")+"",!0);latest&&times.push(latest);if(!times.length){options.success(data);deferredResponse.resolve.apply(deferredResponse);return deferredResponse.promise()}this.timeParsers.reset([]);this.timeParsersXHR=this.timeParsers.fetch({data:{time:times,output_time_format:"%s.%Q|%Y-%m-%dT%H:%M:%S.%Q%:z"},success:function(){var timeParserEarliest=this.timeParsers.get(earliest),timeParserEarliestParts=timeParserEarliest?(timeParserEarliest.get("value")||"").split("|"):[],timeParserEarliestEpoch=timeParserEarliestParts[0],timeParserEarliestISO=timeParserEarliestParts[1],timeParserLatest=this.timeParsers.get(latest),timeParserLatestParts=timeParserLatest?(timeParserLatest.get("value")||"").split("|"):[],timeParserLatestEpoch=timeParserLatestParts[0],timeParserLatestISO=timeParserLatestParts[1];timeParserEarliest&&(data.earliest_epoch=parseFloat(timeParserEarliestEpoch));timeParserLatest&&(data.latest_epoch=parseFloat(timeParserLatestEpoch));if(timeParserEarliestISO){data.earliest_iso=timeParserEarliestISO;data.earliest_date=time_utils.isoToDateObject(timeParserEarliestISO)}if(timeParserLatestISO){data.latest_iso=timeParserLatestISO;data.latest_date=time_utils.isoToDateObject(timeParserLatestISO)}if(timeParserEarliest&&timeParserLatest){var earliestRounded=Math.round(1e3*data.earliest_epoch)/1e3,latestRounded=Math.round(1e3*data.latest_epoch)/1e3;earliestRounded===latestRounded&&(error_msg=splunkd_utils.createSplunkDMessage(splunkd_utils.ERROR,_("You cannot have equivalent times.").t()));earliestRounded>latestRounded&&(error_msg=splunkd_utils.createSplunkDMessage(splunkd_utils.ERROR,_("Earliest time cannot be greater than latest time.").t()));if(error_msg){rootOptions.error(error_msg);return}}rootOptions.success(data)}.bind(this),error:function(){var message=splunkd_utils.createSplunkDMessage(splunkd_utils.ERROR,_("You have an invalid time in your range.").t());rootOptions.error(message)}});this.timeParsersXHR.done(function(){deferredResponse.resolve.apply(deferredResponse,arguments)});this.timeParsersXHR.fail(function(){deferredResponse.reject.apply(deferredResponse,arguments)});return deferredResponse.promise();default:throw"Operation not supported"}},getTimeParse:function(attr){return time_utils.parseTimeString(this.get(attr))},isRealtime:function(attr){return time_utils.isRealtime(this.get(attr))},isAbsolute:function(attr){return time_utils.isAbsolute(this.get(attr))},isEpoch:function(attr){return time_utils.isEpoch(this.get(attr))},isWholeDay:function(attr){return time_utils.timeAndJsDateIsWholeDay(this.get(attr),this.get(attr+"_date"))},latestIsNow:function(){return time_utils.isNow(this.get("latest"))},hasNoEarliest:function(){return time_utils.isEmpty(this.get("earliest"))},generateLabel:function(presets){return time_utils.generateLabel(presets,this.get("earliest"),this.get("earliest_date"),this.get("latest"),this.get("latest_date"))},fetchAbort:function(){BaseModel.prototype.fetchAbort();this.timeParsersXHR&&this.timeParsersXHR.state&&"pending"===this.timeParsersXHR.state()&&this.timeParsersXHR.abort()}})});define("entityUtils",["jquery","backbone","underscore","d3"],function($){return{roundTo:function(x,numDigits){numDigits=Math.pow(10,numDigits);return Math.round(x*numDigits)/numDigits},hasHorizScroll:function(){return $(document).width()>$(window).width()+10}}});!function(global,evalScript){var _namespaces={},_imported={},_loading={},_sourcePaths={},_resourceTypeInfo={},_resourceInfo={},_resourceDependencyList=[],_mixinCount=0,_mixinDependencies=null,_normalizePath=function(path){return":class"===path.substring(path.length-6)?path.substring(0,path.length-6):path},_getPathInfo=function(path){var pathInfo={};pathInfo.path=path;var typeIndex=path.indexOf(":");pathInfo.classPath=0>typeIndex?path:path.substring(0,typeIndex);pathInfo.type=0>typeIndex?"class":path.substring(typeIndex+1);if(!pathInfo.classPath||!pathInfo.type)return null;var namespaceIndex=pathInfo.classPath.lastIndexOf(".");pathInfo.namespace=0>namespaceIndex?"":pathInfo.classPath.substring(0,namespaceIndex);pathInfo.className=0>namespaceIndex?pathInfo.classPath:pathInfo.classPath.substring(namespaceIndex+1);pathInfo.name="class"===pathInfo.type?pathInfo.className:pathInfo.className+":"+pathInfo.type;return pathInfo},_getSourcePath=function(path){path+=".";var sourcePath,url,sourcePathList=[];for(sourcePath in _sourcePaths)_sourcePaths.hasOwnProperty(sourcePath)&&sourcePathList.push(sourcePath);sourcePathList.sort();for(var i=sourcePathList.length-1;i>=0;i--){sourcePath=sourcePathList[i];if(path.substring(0,sourcePath.length)===sourcePath){url=_sourcePaths[sourcePath]+path.substring(sourcePath.length).replace(/\./g,"/");return url.substring(0,url.length-1)}}url=path.replace(/\./g,"/");return url.substring(0,url.length-1)},_appendConstructor=function(baseConstructor,mixinConstructor){var constructor=function(){baseConstructor.apply(this,arguments);mixinConstructor.call(this)};return constructor},jg_namespace=global.jg_namespace=function(path,closure){if(null==path)throw new Error("Parameter path must be non-null.");if("string"!=typeof path)throw new Error("Parameter path must be a string.");if(null!=closure&&"function"!=typeof closure)throw new Error("Parameter closure must be a function.");var ns=_namespaces[path];if(!ns){var subPath,scope,subPaths=path?path.split("."):[];ns=global;for(var i=0,l=subPaths.length;l>i;i++){subPath=subPaths[i];scope=ns[subPath];scope||(scope=ns[subPath]={});ns=scope}_namespaces[path]=ns}closure&&closure.call(ns,ns);return ns},jg_import=global.jg_import=function(path){if(null==path)throw new Error("Parameter path must be non-null.");if("string"!=typeof path)throw new Error("Parameter path must be a string.");if(!path)throw new Error("Parameter path must be non-empty.");path=_normalizePath(path);var resource=_imported[path];if(null==resource){if(_loading[path])throw new Error("Recursive dependency on resource "+path+".");var resourceInfo=_getPathInfo(path);if(!resourceInfo)throw new Error('Invalid resource path "'+path+'".');var ns=jg_namespace(resourceInfo.namespace);resource=ns[resourceInfo.name];if(null==resource){var typeInfo=_resourceTypeInfo[resourceInfo.type];if(!typeInfo)throw new Error('Unknown resource type "'+resourceInfo.type+'". Ensure the resource type is registered via jg_import.registerResourceType().');try{_loading[path]=!0;resourceInfo.url=_getSourcePath(resourceInfo.classPath)+typeInfo.extension;resourceInfo.source=null;try{var xhr=global.ActiveXObject?new global.ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest;xhr.open("GET",resourceInfo.url,!1);xhr.send(null);(200==xhr.status||0==xhr.status)&&(resourceInfo.source=xhr.responseText)}catch(e){}if(null==resourceInfo.source)throw new Error("Failed to load resource "+path+" from url "+resourceInfo.url+". Ensure the correct source path is set for this resource via jg_import.setSourcePath().");var resourceInfoCopy={};for(var p in resourceInfo)resourceInfo.hasOwnProperty(p)&&(resourceInfoCopy[p]=resourceInfo[p]);try{var result=typeInfo.parser.call(resourceInfoCopy,resourceInfoCopy);resource=ns[resourceInfo.name];null==resource&&(resource=result)}catch(e){if(null!=e&&e.__jg_import_Error)throw e;var message=e instanceof Error?e.message:String(e);e=new Error("Error in resource "+path+": "+message);e.__jg_import_Error=!0;throw e}if(null==resource)throw new Error("Failed to define resource "+path+".");ns[resourceInfo.name]=resource}finally{delete _loading[path]}}resourceInfo.resource=resource;_resourceInfo[path]=resourceInfo;_resourceDependencyList.push(path);_imported[path]=resource}return resource};jg_import.define=function(path,closure){if(null==path)throw new Error("Parameter path must be non-null.");if("string"!=typeof path)throw new Error("Parameter path must be a string.");if(!path)throw new Error("Parameter path must be non-empty.");if(null==closure)throw new Error("Parameter closure must be non-null.");if("function"!=typeof closure)throw new Error("Parameter closure must be a function.");path=_normalizePath(path);var resource=_imported[path];if(null==resource){var resourceInfo=_getPathInfo(path);if(!resourceInfo)throw new Error('Invalid resource path "'+path+'".');var ns=jg_namespace(resourceInfo.namespace);resource=ns[resourceInfo.name];if(null==resource){var result=closure.call(ns,ns);resource=ns[resourceInfo.name];null==resource&&(resource=result);if(null==resource)throw new Error("Failed to define resource "+path+".");ns[resourceInfo.name]=resource}if(!_loading[path]&&null==_imported[path]){resourceInfo.resource=resource;_resourceInfo[path]=resourceInfo;_resourceDependencyList.push(path);_imported[path]=resource}}return resource};jg_import.setSourcePath=function(path,url){if(null==path)throw new Error("Parameter path must be non-null.");if("string"!=typeof path)throw new Error("Parameter path must be a string.");if(null==url)throw new Error("Parameter url must be non-null.");if("string"!=typeof url)throw new Error("Parameter url must be a string.");path&&"."!==path.charAt(path.length-1)&&(path+=".");url&&"/"!==url.charAt(url.length-1)&&(url+="/");_sourcePaths[path]=url};jg_import.registerResourceType=function(type,extension,parser){if(null==type)throw new Error("Parameter type must be non-null.");if("string"!=typeof type)throw new Error("Parameter type must be a string.");if(!type)throw new Error("Parameter type must be non-empty.");if(null==extension)throw new Error("Parameter extension must be non-null.");if("string"!=typeof extension)throw new Error("Parameter extension must be a string.");if(null==parser)throw new Error("Parameter parser must be non-null.");if("function"!=typeof parser)throw new Error("Parameter parser must be a function.");var typeInfo={};typeInfo.extension=extension;typeInfo.parser=parser;_resourceTypeInfo[type]=typeInfo};jg_import.getResourceInfo=function(path){if(null!=path&&"string"!=typeof path)throw new Error("Parameter path must be a string.");if(!path){for(var resourceInfoList=[],i=0,l=_resourceDependencyList.length;l>i;i++)resourceInfoList.push(jg_import.getResourceInfo(_resourceDependencyList[i]));return resourceInfoList}path=_normalizePath(path);var resourceInfo=_resourceInfo[path];if(!resourceInfo)return null;var resourceInfoCopy={};for(var p in resourceInfo)resourceInfo.hasOwnProperty(p)&&(resourceInfoCopy[p]=resourceInfo[p]);return resourceInfoCopy};global.jg_extend=function(baseClass,closure){if(null==baseClass)throw new Error("Parameter baseClass must be non-null.");if("function"!=typeof baseClass)throw new Error("Parameter baseClass must be a class.");if(null!=closure&&"function"!=typeof closure)throw new Error("Parameter closure must be a function.");var constructor=baseClass,base=baseClass.prototype;baseClass=function(){};baseClass.prototype=base;var c=function(){constructor.apply(this,arguments)},proto=c.prototype=new baseClass;proto.constructor=c;if(closure){closure.call(proto,c,base,proto);if(c.prototype!==proto)throw new Error('Class member "prototype" cannot be overridden.');if(proto.constructor!==c){if("function"!=typeof proto.constructor)throw new Error('Instance member "constructor" must be a function.');constructor=proto.constructor;proto.constructor=c}}return c},global.jg_static=function(closure){if(null!=closure&&"function"!=typeof closure)throw new Error("Parameter closure must be a function.");var c={};closure&&closure.call(c,c);return c},global.jg_mixin=function(target,source,base){if(null==target)throw new Error("Parameter target must be non-null.");if(null==source)throw new Error("Parameter source must be non-null.");var id=source.__jg_mixin_id;id||(id=source.__jg_mixin_id="m"+ ++_mixinCount);id="__jg_has_mixin_"+id;if(target[id])return base;var baseConstructor=null!=base&&base.hasOwnProperty("constructor")&&"function"==typeof base.constructor?base.constructor:function(){},baseClass=function(){};baseClass.prototype=null!=base?base:Object.prototype;base=new baseClass;base.constructor=baseConstructor;var member,mixin=source.mixin;if(null!=mixin&&"function"==typeof mixin){var mixinBase=new baseClass;for(member in target)target.hasOwnProperty(member)&&(mixinBase[member]=target[member]);mixinBase.constructor=baseConstructor;try{_mixinDependencies||(_mixinDependencies=[]);_mixinDependencies.push(base);var constructor=target.constructor;mixin.call(target,mixinBase,target);if(target.constructor!==constructor)throw new Error('Target member "constructor" cannot be overridden.')}finally{_mixinDependencies.pop();0==_mixinDependencies.length&&(_mixinDependencies=null)}}for(member in source)source.hasOwnProperty(member)&&"mixin"!==member&&"constructor"!==member&&"__"!==member.substring(0,2)&&(target[member]=source[member]);for(member in target)target.hasOwnProperty(member)&&"constructor"!==member&&(base[member]=target[member]);var sourceConstructor=source.hasOwnProperty("constructor")&&"function"==typeof source.constructor?source.constructor:null;if(sourceConstructor){base.constructor=_appendConstructor(base.constructor,sourceConstructor);if(_mixinDependencies)for(var dependentMixin,i=_mixinDependencies.length-1;i>=0;i--){dependentMixin=_mixinDependencies[i];dependentMixin.constructor=_appendConstructor(dependentMixin.constructor,sourceConstructor)}}target[id]=!0;return base},global.jg_has_mixin=function(target,source){if(null==target)throw new Error("Parameter target must be non-null.");if(null==source)throw new Error("Parameter source must be non-null.");var id=source.__jg_mixin_id;if(!id)return!1;id="__jg_has_mixin_"+id;return 1==target[id]};jg_import.registerResourceType("class",".js",function(resourceInfo){evalScript(global,resourceInfo.source)})}(this,function(global,script){eval.call(global,script)});define("jg_global",function(global){return function(){var ret,fn;fn=function(){return{jg_namespace:this.jg_namespace,jg_extend:this.jg_extend,jg_static:this.jg_static,jg_mixin:this.jg_mixin,jg_has_mixin:this.jg_has_mixin}};ret=fn.apply(global,arguments);return ret||global.jg_namespace}}(this));define("splunk/time/TimeZone",["require","jg_global"],function(require){var jg_extend=require("jg_global").jg_extend;return jg_extend(Object,function(){this.getStandardOffset=function(){return 0};this.getOffset=function(){return 0}})});define("splunk/time/SimpleTimeZone",["require","jg_global","splunk/time/TimeZone"],function(require){var jg_extend=require("jg_global").jg_extend,TimeZone=require("splunk/time/TimeZone");return jg_extend(TimeZone,function(){this._offset=0;this.constructor=function(offset){this._offset=void 0!==offset?offset:0};this.getStandardOffset=function(){return this._offset};this.getOffset=function(){return this._offset}})});define("splunk/time/LocalTimeZone",["require","jg_global","splunk/time/TimeZone"],function(require){var jg_extend=require("jg_global").jg_extend,TimeZone=require("splunk/time/TimeZone");return jg_extend(TimeZone,function(){this.getStandardOffset=function(){var date=new Date(0);return 60*-date.getTimezoneOffset()};this.getOffset=function(time){var date=new Date(1e3*time);return 60*-date.getTimezoneOffset()}})});define("splunk/time/TimeZones",["require","jg_global","splunk/time/LocalTimeZone","splunk/time/SimpleTimeZone"],function(require){var jg_static=require("jg_global").jg_static,LocalTimeZone=require("splunk/time/LocalTimeZone"),SimpleTimeZone=require("splunk/time/SimpleTimeZone");return jg_static(function(TimeZones){TimeZones.LOCAL=new LocalTimeZone;TimeZones.UTC=new SimpleTimeZone(0)})});define("splunk/time/DateTime",["require","jg_global","splunk/time/SimpleTimeZone","splunk/time/TimeZone","splunk/time/TimeZones"],function(require){var jg_extend=require("jg_global").jg_extend,SimpleTimeZone=require("splunk/time/SimpleTimeZone"),TimeZone=require("splunk/time/TimeZone"),TimeZones=require("splunk/time/TimeZones");return jg_extend(Object,function(DateTime){var _ISO_DATE_TIME_PATTERN=/([\+\-])?(\d{4,})(?:(?:\-(\d{2}))(?:(?:\-(\d{2}))(?:(?:[T ](\d{2}))(?:(?:\:(\d{2}))(?:(?:\:(\d{2}(?:\.\d+)?)))?)?(?:(Z)|([\+\-])(\d{2})(?:\:(\d{2}))?)?)?)?)?/,_normalizePrecision=function(value){return Number(value.toFixed(6))},_pad=function(value,digits,fractionDigits){if(value!=value)return"NaN";if(1/0==value)return"Infinity";if(value==-1/0)return"-Infinity";digits=void 0!==digits?digits:0;fractionDigits=void 0!==fractionDigits?fractionDigits:0;var str=value.toFixed(20),decimalIndex=str.indexOf(".");0>decimalIndex?decimalIndex=str.length:str=1>fractionDigits?str.substring(0,decimalIndex):str.substring(0,decimalIndex)+"."+str.substring(decimalIndex+1,decimalIndex+fractionDigits+1);for(var i=decimalIndex;digits>i;i++)str="0"+str;return str};this._year=0;this._month=1;this._day=1;this._weekday=0;this._hours=0;this._minutes=0;this._seconds=0;this._timeZone=TimeZones.LOCAL;this._timeZoneOffset=0;this._time=0;this._isValid=!0;this.constructor=function(yearOrTimevalue,month,day,hours,minutes,seconds,timeZone){switch(arguments.length){case 0:var now=new Date;this._time=now.getTime()/1e3;this._updateProperties();break;case 1:if("number"==typeof yearOrTimevalue){this._time=yearOrTimevalue;this._updateProperties()}else if("string"==typeof yearOrTimevalue){var match,matches=_ISO_DATE_TIME_PATTERN.exec(yearOrTimevalue),numMatches=matches?matches.length:0;match=numMatches>1?matches[1]:null;var yearSign="-"==match?-1:1;match=numMatches>2?matches[2]:null;this._year=match?yearSign*Number(match):0;match=numMatches>3?matches[3]:null;this._month=match?Number(match):1;match=numMatches>4?matches[4]:null;this._day=match?Number(match):1;match=numMatches>5?matches[5]:null;this._hours=match?Number(match):0;match=numMatches>6?matches[6]:null;this._minutes=match?Number(match):0;match=numMatches>7?matches[7]:null;this._seconds=match?Number(match):0;match=numMatches>8?matches[8]:null;var timeZoneUTC="Z"==match;match=numMatches>9?matches[9]:null;var timeZoneSign="-"==match?-1:1;match=numMatches>10?matches[10]:null;var timeZoneHours=match?Number(match):0/0;match=numMatches>11?matches[11]:null;var timeZoneMinutes=match?Number(match):0/0;this._timeZone=timeZoneUTC?TimeZones.UTC:isNaN(timeZoneHours)||isNaN(timeZoneMinutes)?TimeZones.LOCAL:new SimpleTimeZone(timeZoneSign*(60*timeZoneHours+timeZoneMinutes)*60);this._updateTime()}else{this._time=0/0;this._updateProperties()}break;default:if("number"==typeof yearOrTimevalue){this._year=yearOrTimevalue;this._month=void 0!==month?month:1;this._day=void 0!==day?day:1;this._hours=void 0!==hours?hours:0;this._minutes=void 0!==minutes?minutes:0;this._seconds=void 0!==seconds?seconds:0;this._timeZone=timeZone instanceof TimeZone?timeZone:TimeZones.LOCAL;this._updateTime()}else{this._time=0/0;this._updateProperties()}}};this.getYear=function(){return this._year};this.setYear=function(value){this._year=value;this._updateTime()};this.getMonth=function(){return this._month};this.setMonth=function(value){this._month=value;this._updateTime()};this.getDay=function(){return this._day};this.setDay=function(value){this._day=value;this._updateTime()};this.getWeekday=function(){return this._weekday};this.getHours=function(){return this._hours};this.setHours=function(value){this._hours=value;this._updateTime()};this.getMinutes=function(){return this._minutes};this.setMinutes=function(value){this._minutes=value;this._updateTime()};this.getSeconds=function(){return this._seconds};this.setSeconds=function(value){this._seconds=value;this._updateTime()};this.getTimeZone=function(){return this._timeZone};this.setTimeZone=function(value){this._timeZone=value instanceof TimeZone?value:TimeZones.LOCAL;this._updateTime()};this.getTimeZoneOffset=function(){return this._timeZoneOffset};this.getTime=function(){return this._time};this.setTime=function(value){this._time=value;this._updateProperties()};this.toUTC=function(){return this.toTimeZone(TimeZones.UTC)};this.toLocal=function(){return this.toTimeZone(TimeZones.LOCAL)};this.toTimeZone=function(timeZone){var date=new DateTime;date.setTimeZone(timeZone);date.setTime(this._time);return date};this.clone=function(){var date=new DateTime;date.setTimeZone(this._timeZone);date.setTime(this._time);return date};this.equals=function(toCompare){return this._time===toCompare._time&&this._timeZoneOffset===toCompare._timeZoneOffset};this.toString=function(){if(!this._isValid)return"Invalid Date";var str="";str+=this._year<0?"-"+_pad(-this._year,4):_pad(this._year,4);str+="-"+_pad(this._month,2)+"-"+_pad(this._day,2);str+="T"+_pad(this._hours,2)+":"+_pad(this._minutes,2)+":"+_pad(this._seconds,2,3);var timeZoneOffset=this._timeZoneOffset/60;if(0==timeZoneOffset)str+="Z";else{str+=0>timeZoneOffset?"-":"+";0>timeZoneOffset&&(timeZoneOffset=-timeZoneOffset);var timeZoneHours=Math.floor(timeZoneOffset/60),timeZoneMinutes=Math.floor(timeZoneOffset%60);str+=_pad(timeZoneHours,2)+":"+_pad(timeZoneMinutes,2)}return str};this.valueOf=function(){return this._time};this._updateTime=function(){if(this._validate()){var years=this._year,months=this._month-1,days=this._day-1,hours=this._hours,minutes=this._minutes,seconds=this._seconds,secondsPerMinute=60,secondsPerHour=60*secondsPerMinute,secondsPerDay=24*secondsPerHour,totalMonths=months+12*years,wholeMonths=Math.floor(totalMonths),subMonths=totalMonths-wholeMonths,totalSeconds=seconds+minutes*secondsPerMinute+hours*secondsPerHour+days*secondsPerDay,wholeSeconds=Math.floor(totalSeconds),subSeconds=totalSeconds-wholeSeconds,date=new Date(0);date.setUTCFullYear(0);date.setUTCMonth(wholeMonths);if(0!=subMonths){date.setUTCMonth(date.getUTCMonth()+1);date.setUTCDate(0);var monthsTotalSeconds=date.getUTCDate()*subMonths*secondsPerDay,monthsWholeSeconds=Math.floor(monthsTotalSeconds),monthsSubSeconds=monthsTotalSeconds-monthsWholeSeconds;wholeSeconds+=monthsWholeSeconds;subSeconds+=monthsSubSeconds;if(subSeconds>=1){subSeconds--;wholeSeconds++}date.setUTCDate(1)}date.setUTCSeconds(wholeSeconds);var time=date.getTime()/1e3+subSeconds,timeZone=this._timeZone;this._time=time-timeZone.getOffset(time-timeZone.getStandardOffset());this._updateProperties()}};this._updateProperties=function(){if(this._validate()){var time=_normalizePrecision(this._time),timeZoneOffset=_normalizePrecision(this._timeZone.getOffset(time)),totalSeconds=time+timeZoneOffset,wholeSeconds=Math.floor(totalSeconds),subSeconds=_normalizePrecision(totalSeconds-wholeSeconds);if(subSeconds>=1){subSeconds=0;wholeSeconds++}var date=new Date(1e3*wholeSeconds);this._year=date.getUTCFullYear();this._month=date.getUTCMonth()+1;this._day=date.getUTCDate();this._weekday=date.getUTCDay();this._hours=date.getUTCHours();this._minutes=date.getUTCMinutes();this._seconds=date.getUTCSeconds()+subSeconds;this._time=time;this._timeZoneOffset=timeZoneOffset;this._validate()}};this._validate=function(){if(this._isValid){this._year*=1;this._month*=1;this._day*=1;this._weekday*=1;this._hours*=1;this._minutes*=1;this._seconds*=1;this._timeZoneOffset*=1;this._time*=1;var checksum=this._year+this._month+this._day+this._weekday+this._hours+this._minutes+this._seconds+this._timeZoneOffset+this._time;(isNaN(checksum)||1/0==checksum||checksum==-1/0||!this._timeZone)&&(this._isValid=!1)}else{this._year*=1;this._time*=1;if(this._year>-1/0&&this._year<1/0){this._month=1;this._day=1;this._hours=0;this._minutes=0;this._seconds=0;this._isValid=!0}else this._time>-1/0&&this._time<1/0&&(this._isValid=!0)}if(!this._isValid){this._year=0/0;this._month=0/0;this._day=0/0;this._weekday=0/0;this._hours=0/0;this._minutes=0/0;this._seconds=0/0;this._timeZoneOffset=0/0;this._time=0/0}return this._isValid}})});define("splunk/time/Duration",["require","jg_global"],function(require){var jg_extend=require("jg_global").jg_extend;return jg_extend(Object,function(Duration){var _ISO_DURATION_PATTERN=/P(?:(\-?\d+(?:\.\d+)?)Y)?(?:(\-?\d+(?:\.\d+)?)M)?(?:(\-?\d+(?:\.\d+)?)D)?(?:T(?:(\-?\d+(?:\.\d+)?)H)?(?:(\-?\d+(?:\.\d+)?)M)?(?:(\-?\d+(?:\.\d+)?)S)?)?/;this.years=0;this.months=0;this.days=0;this.hours=0;this.minutes=0;this.seconds=0;this.constructor=function(yearsOrTimestring,months,days,hours,minutes,seconds){if(1==arguments.length&&"string"==typeof yearsOrTimestring){var match,matches=_ISO_DURATION_PATTERN.exec(yearsOrTimestring),numMatches=matches?matches.length:0;match=numMatches>1?matches[1]:null;this.years=match?Number(match):0;match=numMatches>2?matches[2]:null;this.months=match?Number(match):0;match=numMatches>3?matches[3]:null;this.days=match?Number(match):0;match=numMatches>4?matches[4]:null;this.hours=match?Number(match):0;match=numMatches>5?matches[5]:null;this.minutes=match?Number(match):0;match=numMatches>6?matches[6]:null;this.seconds=match?Number(match):0}else{this.years="number"==typeof yearsOrTimestring?yearsOrTimestring:0;this.months=void 0!==months?months:0;this.days=void 0!==days?days:0;this.hours=void 0!==hours?hours:0;this.minutes=void 0!==minutes?minutes:0;this.seconds=void 0!==seconds?seconds:0}};this.clone=function(){return new Duration(this.years,this.months,this.days,this.hours,this.minutes,this.seconds)};this.equals=function(toCompare){return this.years==toCompare.years&&this.months==toCompare.months&&this.days==toCompare.days&&this.hours==toCompare.hours&&this.minutes==toCompare.minutes&&this.seconds==toCompare.seconds};this.toString=function(){var str="";str+="P"+this.years+"Y"+this.months+"M"+this.days+"D";str+="T"+this.hours+"H"+this.minutes+"M"+this.seconds+"S";return str}})});define("splunk/time/TimeUtils",["require","jg_global","splunk/time/DateTime","splunk/time/Duration","splunk/time/SimpleTimeZone","splunk/time/TimeZones"],function(require){var jg_static=require("jg_global").jg_static,DateTime=require("splunk/time/DateTime"),Duration=require("splunk/time/Duration"),SimpleTimeZone=require("splunk/time/SimpleTimeZone"),TimeZones=require("splunk/time/TimeZones");return jg_static(function(TimeUtils){TimeUtils.EPOCH=new DateTime(0).toUTC();TimeUtils.daysInMonth=function(date){date=new DateTime(date.getYear(),date.getMonth()+1,0,0,0,0,TimeZones.UTC);return date.getDay()};TimeUtils.addDurations=function(duration1,duration2){return new Duration(duration1.years+duration2.years,duration1.months+duration2.months,duration1.days+duration2.days,duration1.hours+duration2.hours,duration1.minutes+duration2.minutes,duration1.seconds+duration2.seconds)};TimeUtils.addDateDuration=function(date,duration){date=0==duration.years&&0==duration.months&&0==duration.days?date.clone():new DateTime(date.getYear()+duration.years,date.getMonth()+duration.months,date.getDay()+duration.days,date.getHours(),date.getMinutes(),date.getSeconds(),date.getTimeZone());date.setTime(date.getTime()+(3600*duration.hours+60*duration.minutes+duration.seconds));return date};TimeUtils.subtractDates=function(date1,date2){date2=date2.toTimeZone(date1.getTimeZone());
var isNegative=date1.getTime()<date2.getTime();if(isNegative){var temp=date1;date1=date2;date2=temp}var years,months,days,hours,minutes,seconds,date3,sameTimeZoneOffset=date1.getTimeZoneOffset()==date2.getTimeZoneOffset();if(sameTimeZoneOffset)date3=date1;else if(date1.getYear()==date2.getYear()&&date1.getMonth()==date2.getMonth()&&date1.getDay()==date2.getDay())date3=date2;else{date3=new DateTime(date1.getYear(),date1.getMonth(),date1.getDay(),date2.getHours(),date2.getMinutes(),date2.getSeconds(),date2.getTimeZone());if(date3.getTime()>date1.getTime()){date3=new DateTime(date1.getYear(),date1.getMonth(),date1.getDay()-1,date2.getHours(),date2.getMinutes(),date2.getSeconds(),date2.getTimeZone());(date3.getTime()<date2.getTime()||date3.getYear()==date2.getYear()&&date3.getMonth()==date2.getMonth()&&date3.getDay()==date2.getDay())&&(date3=date2)}}years=date3.getYear()-date2.getYear();months=date3.getMonth()-date2.getMonth();days=date3.getDay()-date2.getDay();if(sameTimeZoneOffset){hours=date3.getHours()-date2.getHours();minutes=date3.getMinutes()-date2.getMinutes();seconds=date3.getSeconds()-date2.getSeconds();if(0>seconds){seconds+=60;minutes--}if(0>minutes){minutes+=60;hours--}if(0>hours){hours+=24;days--}seconds=_normalizePrecision(seconds)}else{seconds=date1.getTime()-date3.getTime();var wholeSeconds=Math.floor(seconds),subSeconds=_normalizePrecision(seconds-wholeSeconds);if(subSeconds>=1){subSeconds=0;wholeSeconds++}minutes=Math.floor(wholeSeconds/60);seconds=wholeSeconds%60+subSeconds;hours=Math.floor(minutes/60);minutes%=60}if(0>days){date3=new DateTime(date2.getYear(),date2.getMonth()+1,0,0,0,0,TimeZones.UTC);days+=date3.getDay();months--}if(0>months){months+=12;years--}if(isNegative){years=-years;months=-months;days=-days;hours=-hours;minutes=-minutes;seconds=-seconds}return new Duration(years,months,days,hours,minutes,seconds)};TimeUtils.subtractDurations=function(duration1,duration2){return new Duration(duration1.years-duration2.years,duration1.months-duration2.months,duration1.days-duration2.days,duration1.hours-duration2.hours,duration1.minutes-duration2.minutes,duration1.seconds-duration2.seconds)};TimeUtils.subtractDateDuration=function(date,duration){date=0==duration.years&&0==duration.months&&0==duration.days?date.clone():new DateTime(date.getYear()-duration.years,date.getMonth()-duration.months,date.getDay()-duration.days,date.getHours(),date.getMinutes(),date.getSeconds(),date.getTimeZone());date.setTime(date.getTime()-(3600*duration.hours+60*duration.minutes+duration.seconds));return date};TimeUtils.multiplyDuration=function(duration,scalar){return new Duration(duration.years*scalar,duration.months*scalar,duration.days*scalar,duration.hours*scalar,duration.minutes*scalar,duration.seconds*scalar)};TimeUtils.divideDuration=function(duration,scalar){return new Duration(duration.years/scalar,duration.months/scalar,duration.days/scalar,duration.hours/scalar,duration.minutes/scalar,duration.seconds/scalar)};TimeUtils.ceilDate=function(date,units){var date2=date.toTimeZone(new SimpleTimeZone(date.getTimeZoneOffset()));_ceilDateInternal(date2,units);return _toTimeZoneStable(date2,date.getTimeZone())};TimeUtils.ceilDuration=function(duration,units,referenceDate){referenceDate||(referenceDate=TimeUtils.EPOCH);var date=TimeUtils.addDateDuration(referenceDate,duration),isNegative=date.getTime()<referenceDate.getTime();duration=isNegative?TimeUtils.subtractDates(referenceDate,date):TimeUtils.subtractDates(date,referenceDate);if(!units){units=new Duration;duration.years>0?units.years=1:duration.months>0?units.months=1:duration.days>0?units.days=1:duration.hours>0?units.hours=1:duration.minutes>0?units.minutes=1:duration.seconds>0&&(units.seconds=1)}if(isNegative){_floorDurationInternal(duration,units,date);return TimeUtils.multiplyDuration(duration,-1)}_ceilDurationInternal(duration,units,referenceDate);return duration};TimeUtils.floorDate=function(date,units){var date2=date.toTimeZone(new SimpleTimeZone(date.getTimeZoneOffset()));_floorDateInternal(date2,units);return _toTimeZoneStable(date2,date.getTimeZone())};TimeUtils.floorDuration=function(duration,units,referenceDate){referenceDate||(referenceDate=TimeUtils.EPOCH);var date=TimeUtils.addDateDuration(referenceDate,duration),isNegative=date.getTime()<referenceDate.getTime();duration=isNegative?TimeUtils.subtractDates(referenceDate,date):TimeUtils.subtractDates(date,referenceDate);if(!units){units=new Duration;duration.years>0?units.years=1:duration.months>0?units.months=1:duration.days>0?units.days=1:duration.hours>0?units.hours=1:duration.minutes>0?units.minutes=1:duration.seconds>0&&(units.seconds=1)}if(isNegative){_ceilDurationInternal(duration,units,date);return TimeUtils.multiplyDuration(duration,-1)}_floorDurationInternal(duration,units,referenceDate);return duration};TimeUtils.roundDate=function(date,units){var date2=date.toTimeZone(new SimpleTimeZone(date.getTimeZoneOffset()));_roundDateInternal(date2,units);return _toTimeZoneStable(date2,date.getTimeZone())};TimeUtils.roundDuration=function(duration,units,referenceDate){referenceDate||(referenceDate=TimeUtils.EPOCH);var date=TimeUtils.addDateDuration(referenceDate,duration),isNegative=date.getTime()<referenceDate.getTime();duration=isNegative?TimeUtils.subtractDates(referenceDate,date):TimeUtils.subtractDates(date,referenceDate);if(!units){units=new Duration;duration.years>0?units.years=1:duration.months>0?units.months=1:duration.days>0?units.days=1:duration.hours>0?units.hours=1:duration.minutes>0?units.minutes=1:duration.seconds>0&&(units.seconds=1)}if(isNegative){_roundDurationInternal(duration,units,date);return TimeUtils.multiplyDuration(duration,-1)}_roundDurationInternal(duration,units,referenceDate);return duration};TimeUtils.normalizeDuration=function(duration,referenceDate){referenceDate||(referenceDate=TimeUtils.EPOCH);var date=TimeUtils.addDateDuration(referenceDate,duration);return TimeUtils.subtractDates(date,referenceDate)};TimeUtils.durationToSeconds=function(duration,referenceDate){referenceDate||(referenceDate=TimeUtils.EPOCH);var date=TimeUtils.addDateDuration(referenceDate,duration);return _normalizePrecision(date.getTime()-referenceDate.getTime())};TimeUtils.secondsToDuration=function(seconds,referenceDate){referenceDate||(referenceDate=TimeUtils.EPOCH);var date=new DateTime(referenceDate.getTime()+seconds).toTimeZone(referenceDate.getTimeZone());return TimeUtils.subtractDates(date,referenceDate)};var _ceilDateInternal=function(date,units){var ceilYear=units.years>0,ceilMonth=ceilYear||units.months>0,ceilDay=ceilMonth||units.days>0,ceilHours=ceilDay||units.hours>0,ceilMinutes=ceilHours||units.minutes>0,ceilSeconds=ceilMinutes||units.seconds>0;if(ceilSeconds){date.getSeconds()>0&&date.setSeconds(units.seconds>0?Math.min(Math.ceil(date.getSeconds()/units.seconds)*units.seconds,60):60);if(ceilMinutes){date.getMinutes()>0&&date.setMinutes(units.minutes>0?Math.min(Math.ceil(date.getMinutes()/units.minutes)*units.minutes,60):60);if(ceilHours){date.getHours()>0&&date.setHours(units.hours>0?Math.min(Math.ceil(date.getHours()/units.hours)*units.hours,24):24);if(ceilDay){if(date.getDay()>1){var daysInMonth=TimeUtils.daysInMonth(date);date.setDay(units.days>0?Math.min(Math.ceil((date.getDay()-1)/units.days)*units.days,daysInMonth)+1:daysInMonth+1)}if(ceilMonth){date.getMonth()>1&&date.setMonth(units.months>0?Math.min(Math.ceil((date.getMonth()-1)/units.months)*units.months,12)+1:13);ceilYear&&units.years>0&&date.setYear(Math.ceil(date.getYear()/units.years)*units.years)}}}}}},_ceilDurationInternal=function(duration,units,referenceDate){var ceilYears=units.years>0,ceilMonths=ceilYears||units.months>0,ceilDays=ceilMonths||units.days>0,ceilHours=ceilDays||units.hours>0,ceilMinutes=ceilHours||units.minutes>0,ceilSeconds=ceilMinutes||units.seconds>0,daysInMonth=TimeUtils.daysInMonth(referenceDate);if(ceilSeconds){if(duration.seconds>0){duration.seconds=units.seconds>0?Math.min(Math.ceil(duration.seconds/units.seconds)*units.seconds,60):60;_normalizeDuration(duration,daysInMonth)}if(ceilMinutes){if(duration.minutes>0){duration.minutes=units.minutes>0?Math.min(Math.ceil(duration.minutes/units.minutes)*units.minutes,60):60;_normalizeDuration(duration,daysInMonth)}if(ceilHours){if(duration.hours>0){duration.hours=units.hours>0?Math.min(Math.ceil(duration.hours/units.hours)*units.hours,24):24;_normalizeDuration(duration,daysInMonth)}if(ceilDays){if(duration.days>0){duration.days=units.days>0?Math.min(Math.ceil(duration.days/units.days)*units.days,daysInMonth):daysInMonth;_normalizeDuration(duration,daysInMonth)}if(ceilMonths){if(duration.months>0){duration.months=units.months>0?Math.min(Math.ceil(duration.months/units.months)*units.months,12):12;_normalizeDuration(duration,daysInMonth)}if(ceilYears&&units.years>0){duration.years=Math.ceil(duration.years/units.years)*units.years;_normalizeDuration(duration,daysInMonth)}}}}}}},_floorDateInternal=function(date,units){var floorYear=units.years>0,floorMonth=floorYear||units.months>0,floorDay=floorMonth||units.days>0,floorHours=floorDay||units.hours>0,floorMinutes=floorHours||units.minutes>0,floorSeconds=floorMinutes||units.seconds>0;if(floorSeconds){date.getSeconds()>0&&date.setSeconds(units.seconds>0?Math.floor(date.getSeconds()/units.seconds)*units.seconds:0);if(floorMinutes){date.getMinutes()>0&&date.setMinutes(units.minutes>0?Math.floor(date.getMinutes()/units.minutes)*units.minutes:0);if(floorHours){date.getHours()>0&&date.setHours(units.hours>0?Math.floor(date.getHours()/units.hours)*units.hours:0);if(floorDay){date.getDay()>1&&date.setDay(units.days>0?Math.floor((date.getDay()-1)/units.days)*units.days+1:1);if(floorMonth){date.getMonth()>1&&date.setMonth(units.months>0?Math.floor((date.getMonth()-1)/units.months)*units.months+1:1);floorYear&&units.years>0&&date.setYear(Math.floor(date.getYear()/units.years)*units.years)}}}}}},_floorDurationInternal=function(duration,units,referenceDate){var floorYears=units.years>0,floorMonths=floorYears||units.months>0,floorDays=floorMonths||units.days>0,floorHours=floorDays||units.hours>0,floorMinutes=floorHours||units.minutes>0,floorSeconds=floorMinutes||units.seconds>0,daysInMonth=TimeUtils.daysInMonth(referenceDate);if(floorSeconds){if(duration.seconds>0){duration.seconds=units.seconds>0?Math.floor(duration.seconds/units.seconds)*units.seconds:0;_normalizeDuration(duration,daysInMonth)}if(floorMinutes){if(duration.minutes>0){duration.minutes=units.minutes>0?Math.floor(duration.minutes/units.minutes)*units.minutes:0;_normalizeDuration(duration,daysInMonth)}if(floorHours){if(duration.hours>0){duration.hours=units.hours>0?Math.floor(duration.hours/units.hours)*units.hours:0;_normalizeDuration(duration,daysInMonth)}if(floorDays){if(duration.days>0){duration.days=units.days>0?Math.floor(duration.days/units.days)*units.days:0;_normalizeDuration(duration,daysInMonth)}if(floorMonths){if(duration.months>0){duration.months=units.months>0?Math.floor(duration.months/units.months)*units.months:0;_normalizeDuration(duration,daysInMonth)}if(floorYears&&units.years>0){duration.years=Math.floor(duration.years/units.years)*units.years;_normalizeDuration(duration,daysInMonth)}}}}}}},_roundDateInternal=function(date,units){var roundYear=units.years>0,roundMonth=roundYear||units.months>0,roundDay=roundMonth||units.days>0,roundHours=roundDay||units.hours>0,roundMinutes=roundHours||units.minutes>0,roundSeconds=roundMinutes||units.seconds>0;if(roundSeconds){date.getSeconds()>0&&date.setSeconds(units.seconds>0?Math.min(Math.round(date.getSeconds()/units.seconds)*units.seconds,60):date.getSeconds()>=30?60:0);if(roundMinutes){date.getMinutes()>0&&date.setMinutes(units.minutes>0?Math.min(Math.round(date.getMinutes()/units.minutes)*units.minutes,60):date.getMinutes()>=30?60:0);if(roundHours){date.getHours()>0&&date.setHours(units.hours>0?Math.min(Math.round(date.getHours()/units.hours)*units.hours,24):date.getHours()>=12?24:0);if(roundDay){if(date.getDay()>1){var daysInMonth=TimeUtils.daysInMonth(date);date.setDay(units.days>0?Math.min(Math.round((date.getDay()-1)/units.days)*units.days,daysInMonth)+1:date.getDay()>=Math.floor(daysInMonth/2+1)?daysInMonth+1:1)}if(roundMonth){date.getMonth()>1&&date.setMonth(units.months>0?Math.min(Math.round((date.getMonth()-1)/units.months)*units.months,12)+1:date.getMonth()>=7?13:1);roundYear&&units.years>0&&date.setYear(Math.round(date.getYear()/units.years)*units.years)}}}}}},_roundDurationInternal=function(duration,units,referenceDate){var roundYears=units.years>0,roundMonths=roundYears||units.months>0,roundDays=roundMonths||units.days>0,roundHours=roundDays||units.hours>0,roundMinutes=roundHours||units.minutes>0,roundSeconds=roundMinutes||units.seconds>0,daysInMonth=TimeUtils.daysInMonth(referenceDate);if(roundSeconds){if(duration.seconds>0){duration.seconds=units.seconds>0?Math.min(Math.round(duration.seconds/units.seconds)*units.seconds,60):duration.seconds>=30?60:0;_normalizeDuration(duration,daysInMonth)}if(roundMinutes){if(duration.minutes>0){duration.minutes=units.minutes>0?Math.min(Math.round(duration.minutes/units.minutes)*units.minutes,60):duration.minutes>=30?60:0;_normalizeDuration(duration,daysInMonth)}if(roundHours){if(duration.hours>0){duration.hours=units.hours>0?Math.min(Math.round(duration.hours/units.hours)*units.hours,24):duration.hours>=12?24:0;_normalizeDuration(duration,daysInMonth)}if(roundDays){if(duration.days>0){duration.days=units.days>0?Math.min(Math.round(duration.days/units.days)*units.days,daysInMonth):duration.days>=Math.floor(daysInMonth/2)?daysInMonth:0;_normalizeDuration(duration,daysInMonth)}if(roundMonths){if(duration.months>0){duration.months=units.months>0?Math.min(Math.round(duration.months/units.months)*units.months,12):duration.months>=6?12:0;_normalizeDuration(duration,daysInMonth)}if(roundYears&&units.years>0){duration.years=Math.round(duration.years/units.years)*units.years;_normalizeDuration(duration,daysInMonth)}}}}}}},_toTimeZoneStable=function(date,timeZone){var date2=date.toTimeZone(timeZone);if(date2.getYear()==date.getYear()&&date2.getMonth()==date.getMonth()&&date2.getDay()==date.getDay()&&date2.getHours()==date.getHours()&&date2.getMinutes()==date.getMinutes()&&date2.getSeconds()==date.getSeconds())return date2;var date3=date.clone();date3.setTimeZone(timeZone);return date3.getYear()==date.getYear()&&date3.getMonth()==date.getMonth()&&date3.getDay()==date.getDay()&&date3.getHours()==date.getHours()&&date3.getMinutes()==date.getMinutes()&&date3.getSeconds()==date.getSeconds()?date3:date2},_normalizeDuration=function(duration,daysInMonth){var years=duration.years,wholeYears=Math.floor(years),subYears=years-wholeYears,months=duration.months+12*subYears,wholeMonths=Math.floor(months),subMonths=months-wholeMonths,days=duration.days+subMonths*daysInMonth,wholeDays=Math.floor(days),subDays=days-wholeDays,hours=duration.hours+24*subDays,wholeHours=Math.floor(hours),subHours=hours-wholeHours,minutes=duration.minutes+60*subHours,wholeMinutes=Math.floor(minutes),subMinutes=minutes-wholeMinutes,seconds=duration.seconds+60*subMinutes,wholeSeconds=Math.floor(seconds),subSeconds=_normalizePrecision(seconds-wholeSeconds);if(subSeconds>=1){subSeconds=0;wholeSeconds++}wholeMinutes+=Math.floor(wholeSeconds/60);wholeSeconds%=60;wholeHours+=Math.floor(wholeMinutes/60);wholeMinutes%=60;wholeDays+=Math.floor(wholeHours/24);wholeHours%=24;wholeMonths+=Math.floor(wholeDays/daysInMonth);wholeDays%=daysInMonth;wholeYears+=Math.floor(wholeMonths/12);wholeMonths%=12;duration.years=wholeYears;duration.months=wholeMonths;duration.days=wholeDays;duration.hours=wholeHours;duration.minutes=wholeMinutes;duration.seconds=wholeSeconds+subSeconds},_normalizePrecision=function(value){return Number(value.toFixed(6))}})});define("app/models/TimeRange",["jquery","underscore","backbone","models/shared/TimeRange","entityUtils","util/time","splunk/time/TimeUtils","splunk/time/DateTime","splunkjs/mvc","d3"],function($,_,Backbone,TimeRange,util,time_utils,TimeUtils,DateTime,SJS,d3){return TimeRange.extend({defaults:{changes:["change:earliest","change:latest","change:inner_earliest","change:inner_latest","change:outerTimeRange","change:innerTimeRange"],earliest:"@d",enableRealTime:!1,latest:"now",innerPos:{left:0,right:100},minResolution:1.65,outerTimeRange:{units:"hours"},timeScale:d3.time.scale().range([0,100]),totalInnerTime:{minutes:0,hours:0,days:0},useRelativeInnerPos:!0},msPerDay:864e5,msPerHour:36e5,msPerMinute:6e4,pref_id:"timeRange",initialize:function(){TimeRange.prototype.initialize.apply(this,arguments);this.app_name=this.get("app_name");this.prefs=this.get("prefs");this.view_name=this.get("view_name");this.timeScale=this.get("timeScale");this.tokens=SJS.Components.getInstance("default");this.useRelativeInnerPos=this.get("useRelativeInnerPos");this.prefs.on("reset",_.bind(this.onPrefsReset,this))},onPrefsReset:function(){this.pref=this.prefs.getPref(this.pref_id);this.save({earliest:this.pref.get("earliest")||this.get("earliest"),latest:this.pref.get("latest")||this.get("latest")});this.trigger("prefs_loaded");this.pref.on("sync",_.bind(this.setTimeTokens,this))},validate:function(attrs){return void 0===attrs.earliest||void 0===attrs.latest?"either earliest or latest is undefined":"r"===attrs.earliest[0]&&"t"===attrs.earliest[1]?"invalid time range: realtime":"r"===attrs.latest[0]&&"t"===attrs.latest[1]?"invalid time range: realtime":0===attrs.earliest?"invalid time range: all time":void 0},validatePos:function(pos){pos.left===pos.right&&(0===pos.left?pos.right=pos.right+1:pos.left=pos.left-1);return pos},getRelativeInnerTimeRange:function(innerPos,outerTimeRange){var innerTimeRange={};this.timeScale.domain([outerTimeRange.earliest_date,outerTimeRange.latest_date]);innerPos=this.validatePos(innerPos);if(innerPos.left<innerPos.right){this.set("swapped",!1);innerTimeRange.earliest_date=this.timeScale.invert(innerPos.left);innerTimeRange.latest_date=this.timeScale.invert(innerPos.right)}else{this.set("swapped",!0);innerTimeRange.earliest_date=this.timeScale.invert(innerPos.right);innerTimeRange.latest_date=this.timeScale.invert(innerPos.left)}return innerTimeRange},sync:function(method,model){var ret=TimeRange.prototype.sync.apply(this,arguments),that=this;$.when(ret).done(function(){that.onSync(model)})},onSync:function(model){var outerRange,range,isValid,innerPos=this.pref.get("innerPos")||{},innerTimeRange=this.pref.get("innerTimeRange")||{},innerTimeScale=d3.time.scale().range([0,79]),outerTimeRange={earliest_date:new Date(model.get("earliest_iso")),latest_date:new Date(model.get("latest_iso"))},shouldSnapTo=!0,updateInner=!1;if(void 0!==innerPos.left&&void 0!==innerPos.right&&this.useRelativeInnerPos===!0){innerTimeRange=this.getRelativeInnerTimeRange(innerPos,outerTimeRange);this.set({innerPos:innerPos},{silent:!0});shouldSnapTo=!1;updateInner=!0}else{if(void 0===innerTimeRange.earliest_date||null===innerTimeRange.earliest_date){updateInner=!0;innerTimeRange.earliest_date=outerTimeRange.earliest_date}else innerTimeRange.earliest_date=new Date(innerTimeRange.earliest_date);if(void 0===innerTimeRange.latest_date||null===innerTimeRange.latest_date){updateInner=!0;innerTimeRange.latest_date=outerTimeRange.latest_date}else innerTimeRange.latest_date=new Date(innerTimeRange.latest_date);innerTimeRange.earliest_date.getTime()===innerTimeRange.latest_date.getTime()&&(innerTimeRange.earliest_date=new Date(innerTimeRange.earliest_date.getTime()-6e4))}if(updateInner){this.pref.set({innerTimeRange:innerTimeRange},{silent:!0});this.pref.save()}range=(innerTimeRange.latest_date.getTime()-innerTimeRange.earliest_date.getTime())/1e3;outerRange=(outerTimeRange.latest_date.getTime()-outerTimeRange.earliest_date.getTime())/1e3;innerTimeScale.domain([innerTimeRange.earliest_date,innerTimeRange.latest_date]);isValid=this.set({innerTimeRange:innerTimeRange,innerTimeScale:innerTimeScale,outerTimeRange:outerTimeRange,span:Math.round(range/80,0).toString()+"s",outerSpan:Math.round(outerRange/80,0).toString()+"s"},{validate:!0});if(null===this.validationError){this.onRangeChange();this.setAbsoluteRanges(shouldSnapTo);this.trigger("change:outerTimeRange");updateInner&&this.trigger("change:innerPos")}else console.error("timerange validation error")},onRangeChange:function(){this.get("innerTimeRange")||this.get("outerTimeRange");this.pref.save({earliest:this.get("earliest"),latest:this.get("latest")});this.tokens.set({earliest:this.get("earliest"),latest:this.get("latest")})},rescaleGripperPositions:function(shouldSnapTo){var innerTimeRange=(this.get("outerTimeRange"),this.get("innerTimeRange")),left=Math.min(100,Math.max(0,this.timeScale(innerTimeRange.earliest_date))),right=Math.min(100,Math.max(0,this.timeScale(innerTimeRange.latest_date)));this.updateGrippers({left:left,right:right},shouldSnapTo)},updateGrippers:function(pos,shouldSnapTo){var innerTimeScale,movingBoth,range,newPos={},innerTimeRange={};void 0===shouldSnapTo&&(shouldSnapTo=!0);movingBoth=void 0!==pos.left&&void 0!==pos.right?!0:!1;_.extend(newPos,this.get("innerPos"),pos);shouldSnapTo===!0&&this.snapToMins(1,newPos,movingBoth);newPos=this.validatePos(newPos);if(newPos.left<newPos.right){this.set("swapped",!1);innerTimeRange.earliest_date=this.timeScale.invert(newPos.left);innerTimeRange.latest_date=this.timeScale.invert(newPos.right)}else{this.set("swapped",!0);innerTimeRange.earliest_date=this.timeScale.invert(newPos.right);innerTimeRange.latest_date=this.timeScale.invert(newPos.left)}innerTimeRange.earliest_date.getTime()===innerTimeRange.latest_date.getTime()&&(innerTimeRange.earliest_date=new Date(innerTimeRange.earliest_date.getTime()-6e4));range=(innerTimeRange.latest_date.getTime()-innerTimeRange.earliest_date.getTime())/1e3;innerTimeScale=d3.time.scale().range([0,79]).domain([innerTimeRange.earliest_date,innerTimeRange.latest_date]);this.set({innerPos:newPos,innerTimeRange:innerTimeRange,totalInnerTime:this.calculateTotalInner(innerTimeRange),innerTimeScale:innerTimeScale,span:Math.round(range/80,0).toString()+"s"});this.pref.set({innerTimeRange:innerTimeRange,innerPos:newPos},{silent:!0});this.pref.debounceSave()},clamp:function(pos){var range=this.timeScale.range();pos.left=Math.max(range[0],Math.min(range[1],pos.left));pos.right=Math.max(range[0],Math.min(range[1],pos.right))},snapToMins:function(numMins,pos,movingBoth){var earliestMin,latestMin,earliest=this.timeScale.invert(pos.left),latest=this.timeScale.invert(pos.right),outerTimeRange=this.get("outerTimeRange"),earliestRem=earliest.getMinutes()%numMins,latestRem=latest.getMinutes()%numMins,newPos={},range=this.timeScale.range(),width=Math.abs(pos.right-pos.left);if(pos.left>range[0]&&pos.left<range[1]){earliestMin=earliest.getMinutes()-earliestRem;earliest.setMinutes(earliestMin);earliest.setSeconds(0);newPos.left=this.timeScale(Math.max(outerTimeRange.earliest_date,earliest))}else newPos.left=pos.left;if(movingBoth)newPos.right=newPos.left+width;else if(pos.right>range[0]&&pos.right<range[1]){latestMin=latest.getMinutes()-latestRem;latest.setMinutes(latestMin);latest.setSeconds(0);newPos.right=this.timeScale(Math.min(outerTimeRange.latest_date,latest))}else newPos.right=pos.right;this.clamp(newPos);pos.left=newPos.left;pos.right=newPos.right},setTimeTokens:function(){var innerTimeRange=this.get("innerTimeRange"),span=this.get("span");innerTimeRange&&this.tokens.set({inner_earliest:innerTimeRange.earliest_date,inner_latest:innerTimeRange.latest_date,span:span})},enforceMinimumResolution:function(pos,newPos){newPos.right-newPos.left<this.minResolution&&(void 0!==pos.left?newPos.left=newPos.right-this.minResolution:void 0!==pos.right&&(newPos.right=newPos.left+this.minResolution));return newPos},setAbsoluteRanges:function(shouldSnapTo){var outerTimeRange={earliest_date:this.get("outerTimeRange").earliest_date,latest_date:this.get("outerTimeRange").latest_date},innerTimeRange=this.get("innerTimeRange"),earliest=this.dateTimeFactory(outerTimeRange.earliest_date),latest=this.dateTimeFactory(outerTimeRange.latest_date);outerTimeRange.units=this.getUnits(earliest,latest);outerTimeRange.duration=TimeUtils.subtractDates(latest,earliest);this.timeScale.domain([outerTimeRange.earliest_date,outerTimeRange.latest_date]);this.set({innerTimeRange:innerTimeRange,outerTimeRange:outerTimeRange,totalInnerTime:this.calculateTotalInner({earliest_date:innerTimeRange.earliest_date,latest_date:innerTimeRange.latest_date})});this.rescaleGripperPositions(shouldSnapTo)},calculateTotalInner:function(innerTimeRange){var start,end,totalHours,totalDays,totalMinutes,dateDuration;start=new Date(innerTimeRange.earliest_date);end=new Date(innerTimeRange.latest_date);dateDuration=end-start;totalDays=dateDuration/this.msPerDay;totalDays=1>totalDays?0:util.roundTo(totalDays,1);dateDuration-=totalDays*this.msPerDay;totalHours=dateDuration/this.msPerHour;totalHours=1>totalHours?0:util.roundTo(totalHours,1);dateDuration-=totalHours*this.msPerHour;totalMinutes=dateDuration/this.msPerMinute;totalMinutes=1>totalMinutes?0:util.roundTo(totalMinutes,1);dateDuration-=totalMinutes*this.msPerMinute;return{minutes:totalMinutes,hours:totalHours,days:totalDays}},dateTimeFactory:function(date){return new DateTime(date.getUTCFullYear(),date.getUTCMonth()+1,date.getUTCDate(),date.getUTCHours(),date.getUTCMinutes(),date.getUTCSeconds(),1e3*date.getUTCMilliseconds())},getTimeFormat:function(timeRange){var formatStr;if(void 0===timeRange)return d3.time.format("%H:%M");timeRange.years>=1?formatStr="%e/%m/%Y":timeRange.days>=5?formatStr="%m/%d":timeRange.days>=3?formatStr="%m/%d %H:%M":timeRange.days>1?formatStr="%H:%M":timeRange.days<=1&&(formatStr="%H:%M:%S");return d3.time.format(formatStr)},getUnits:function(earliest,latest){var duration=TimeUtils.subtractDates(latest,earliest);return duration.years>0?"years":duration.months>0?"months":duration.days>1?"days":"hours"}})});define("app/models/TimeRangeLinegraph",["jquery","backbone","underscore","d3","splunkjs/mvc/tokenutils","splunkjs/mvc/searchmanager"],function($,Backbone,_,d3,tokenUtils,SearchManager){return Backbone.Model.extend({initialize:function(options){this.managers=options.managers;this.timeRange=options.timeRange;this.swimlanes=options.swimlanes;this.onConstraintChange=_.debounce(this._onConstraintChange,1200);this.onSelectedChange=_.debounce(this._onSwimlaneChange,200);this.swimlanes.on("change:constraints",_.bind(this.onConstraintChange,this))},_onConstraintChange:function(){this.timeRange.on("change:outerTimeRange",_.bind(this.onSelectedChange,this));this.swimlanes.on("change:selected",_.bind(this.onSelectedChange,this));this._onSwimlaneChange()},_onSwimlaneChange:function(){var selected=this.getSelectedLanes(),search=this.createMergedSearch(selected);if(selected&&!(selected.length<1)&&search){this.set("mergedSearch",search);this.runSearch()}},onSearchStart:function(){this.set("loading",!0)},onSearchDone:function(){this.set("loading",!1)},onData:function(){var min,max,collection=this._data.collection();if(collection.models.length){collection.each(function(m){var time,numEvents;time=m.get("_time");m.set("_time",new Date(time));numEvents=m.get("numEvents");m.set("numEvents",Number(numEvents))});min=collection.min(function(m){return m.get("numEvents")});max=collection.max(function(m){return m.get("numEvents")});this.set({earliest:this.timeRange.get("outerTimeRange").earliest_date,latest:this.timeRange.get("outerTimeRange").latest_date,min:min.get("numEvents"),max:max.get("numEvents")})}this.set("data",collection)},createMergedSearch:function(selected){var mergedSearch="";_.each(selected,function(swimlane,i){if(swimlane.get("constraints")){var tokens=_.extend({},swimlane.attributes,{span:this.timeRange.get("outerSpan")}),search=tokenUtils.replaceTokenNames(swimlane.get("search"),tokens,{});"|"!==search[0]&&(search="search "+search);mergedSearch+=i>0?" | append ["+search+"]":search}},this);mergedSearch.length>0?mergedSearch+=" | stats sum(count) as numEvents by _time":mergedSearch=void 0;return mergedSearch},runSearch:function(){var outerTimeRange=this.timeRange.get("outerTimeRange");if(this.manager){this.manager.trigger("search:cancel",void 0,this.manager.job);this.manager.off("search:start");this.manager.off("search:done");this._data.off("data");this.manager.cancel()}this.manager=new SearchManager({autostart:!1,id:_.uniqueId("timerange_linegraph_"),earliest_time:outerTimeRange.earliest_date.getTime()/1e3,latest_time:outerTimeRange.latest_date.getTime()/1e3,search:this.get("mergedSearch")},{tokens:!1});this.managers.add(this.manager);this.manager.on("search:start",this.onSearchStart,this);this.manager.on("search:done",this.onSearchDone,this);this._data=this.manager.data("preview");this._data.on("data",_.bind(this.onData,this))},getSelectedLanes:function(){return this.swimlanes.filter(function(swimlane){return swimlane.get("selected")})}})});define("models/services/authentication/User",["underscore","models/SplunkDBase"],function(_,SplunkDBaseModel){return SplunkDBaseModel.extend({FREE_PAYLOAD:{links:{create:"/services/authentication/users/_new"},generator:{},entry:[{name:"admin",links:{alternate:"/services/authentication/users/admin",list:"/services/authentication/users/admin",edit:"/services/authentication/users/admin"},author:"system",acl:{app:"",can_list:!0,can_write:!0,modifiable:!1,owner:"system",perms:{read:["*"],write:["*"]},removable:!1,sharing:"system"},fields:{required:[],optional:["defaultApp","email","password","realname","restart_background_jobs","roles","tz"],wildcard:[]},content:{isFree:!0,capabilities:[],defaultApp:"launcher",defaultAppIsUserOverride:!1,defaultAppSourceRole:"system","eai:acl":null,email:"changeme@example.com",password:"********",realname:"Administrator",restart_background_jobs:!0,roles:["admin"],type:"Splunk",tz:""}}],paging:{total:1,perPage:30,offset:0},messages:[]},urlRoot:"authentication/users",url:"authentication/users",initialize:function(){SplunkDBaseModel.prototype.initialize.apply(this,arguments)},getCapabilities:function(){return this.entry.content.get("capabilities")||[]},hasCapability:function(capability){return this.isFree()?!0:this.isNew()||-1!==_.indexOf(this.getCapabilities(),capability)},canAccelerateDataModel:function(){return this.isFree()?!1:this.hasCapability("accelerate_datamodel")},canAccelerateReport:function(){return this.isFree()?!1:this.hasCapability("accelerate_search")&&this.hasCapability("schedule_search")},canSearch:function(){return this.hasCapability("search")},canRTSearch:function(){return this.hasCapability("rtsearch")},canScheduleRTSearch:function(){return this.hasCapability("schedule_rtsearch")},canScheduleSearch:function(){return this.hasCapability("schedule_search")},canEditMonitor:function(){return this.hasCapability("edit_monitor")},canManageRemoteApps:function(){return this.hasCapability("rest_apps_management")},canEditViewHtml:function(){return this.hasCapability("edit_view_html")},canEmbed:function(){return this.isFree()?!1:this.hasCapability("embed_report")},isFree:function(){return this.entry.content.get("isFree")}})});define("app/models/LaneName",["jquery","backbone","underscore"],function($,Backbone){return Backbone.Model.extend({initialize:function(){this.title=this.attributes.title||"undefined"}})});define("app/views/EventView",["jquery","backbone","underscore","d3","entityUtils"],function($,Backbone,_,d3){return Backbone.View.extend({className:"event",tagName:"rect",hexMap:{blue:"#005ad5",yellow:" #fac51c",red:"#d85d3c",orange:"#f7902b",purple:"#956d95",green:"#9ac23c"},initialize:function(options){this.options=options||{};this.height=this.options.height;this.model=this.options.model;this.offset=this.options.offset;this.opacity=this.options.opacity;this.result=this.options.result;this.width=this.options.width;this.x=this.options.x;this.y=this.options.y;this.tooltip=d3.select("#swimlane_tooltip");this.parent_svg=d3.select(this.el);this.svg=this.parent_svg.append(this.tagName).classed(this.className,!0);this.el=this.svg[0][0];this.model.on("change:color",_.bind(this.onColorChange,this));
this.model.sign_board.on("add",_.bind(this.onSignBoardAdd,this));this.model.sign_board.on("remove",_.bind(this.onSignBoardRemove,this));this.model.sign_board.on("reset",_.bind(this.onSignBoardReset,this));this.result.on("click:coordinates",_.bind(this.onXCoordinates,this))},onColorChange:function(){this.svg.attr("fill",this.colorToHex(this.model.get("color")))},activateClick:function(){this.svg.attr("stroke","#111111")},deactivateClick:function(){this.svg.attr("stroke","transparent")},onSignBoardAdd:function(){this.isSelected()?this.activateClick():this.deactivateClick()},onSignBoardRemove:function(){this.isSelected()||this.deactivateClick()},onSignBoardReset:function(collection){collection.length<1?this.deactivateClick():this.isSelected()?this.activateClick():this.deactivateClick()},onXCoordinates:function(range_x){var x1=this.x,x2=this.x+this.width-1;if(!(range_x[0]>x2||range_x[1]<x1)){this.model.sign_board.add(this.result);this.activateClick()}},renderTooltip:function(r,m,offset){var timeFormatter,output,scale=m.time_range.get("innerTimeScale"),innerTimeRange=m.time_range.get("innerTimeRange"),timeDiff=m.time_range.calculateTotalInner(innerTimeRange);timeFormatter=d3.time.format(timeDiff.days<1?"%I:%M:%S %p":"%m/%d %I:%M:%S %p");output=timeFormatter(new Date(r.get("_time")))+" - "+timeFormatter(new Date(scale.invert(offset+1)))+"<br/>"+r.get("count")+"&nbsp;Events";return output},initBehaviors:function(){var tooltip=this.tooltip,model=this.model,offset=this.offset,result=this.result,renderTooltip=($(tooltip.node().parentNode),this.renderTooltip);this.svg.on("click",_.bind(this.onClick,this)).on("mouseover",function(){tooltip.transition().duration(500).style({opacity:.8,visibility:"visible"})}).on("mousemove",function(){var left=d3.select(this).attr("x"),absTop=(this.getBoundingClientRect().height,navigator.userAgent.toLowerCase().indexOf("firefox")>-1,window.navigator.platform.toLowerCase().indexOf("win")>-1,this.getBoundingClientRect().top+$(document).scrollTop()),top=absTop-5-tooltip.node().getBoundingClientRect().height;tooltip.style("left",left+"px").style("top",top+"px").html(function(){return renderTooltip(result,model,offset)}).style("text-align","left")}).on("mouseout",function(){tooltip.transition().duration(200).style({opacity:1e-6,visibility:"hidden"})})},onClick:function(){d3.event.metaKey||d3.event.ctrlKey?this.isSelected()?this.model.sign_board.remove(this.result):this.model.sign_board.add(this.result):this.model.sign_board.reset(this.result)},colorToHex:function(color){return this.hexMap[color]?this.hexMap[color]:"#005ad5"},isSelected:function(){var meta=this.result.get("meta"),lane_name=meta.lane_name,id=meta.id,clicked=this.model.sign_board.clicked.get(lane_name)||[];return _.contains(clicked,id)?!0:!1},render:function(){this.svg.attr("x",this.x).attr("y",this.y).attr("height",this.height).attr("width",this.width-1).attr("fill-opacity",this.opacity).attr("fill",this.colorToHex(this.model.get("color"))).attr("stroke","transparent").attr("stroke-width",.7);this.isSelected()&&this.model.sign_board.add(this.result);this.initBehaviors();return this}})});define("app/views/ChannelView",["jquery","backbone","underscore","d3","app/collections/Events","app/views/EventView"],function($,Backbone,_,d3,Events,EventView){return Backbone.View.extend({className:"lane_channel",spinner_fill:"url(#spinner_fill)",tagName:"g",initialize:function(options){this.options=options||{};this.model=this.options.model;this.sign_board=this.model.sign_board;this.time_range=this.model.time_range;this.svg=d3.select(this.el).append(this.tagName).classed(this.className,!0);this.el=this.svg[0][0];this.svg.attr("transform","translate("+[4,0]+")");this.svg.call(this.setupDrag());this.data=null;this.manager=null;this.rect=null;this.renderContainer();this.showSpinner=_.debounce(this._showSpinner,100);this.hideSpinner=_.debounce(this._hideSpinner,100);this.addSearchManager();this.model.on("add:manager",_.bind(this.addSearchManager,this));this.model.get("entity_name")||this._hideSpinner()},setupDrag:function(){var height=this.model.get("height"),offset=this.model.get("offset"),isRightClick=!1,last_x=null,last_y=null,orig_x=null,orig_y=null,that=this,is_additive=!1,dragData={},drag=d3.behavior.drag().on("dragstart",function(){is_additive=d3.event.sourceEvent.metaKey||d3.event.sourceEvent.ctrlKey?!0:!1;isRightClick=that.isRightClick(d3.event.sourceEvent);if(!isRightClick){d3.event.sourceEvent.stopPropagation();dragData.offset=$(that.el).offset();dragData.x=$(window).scrollLeft()+d3.event.sourceEvent.clientX-dragData.offset.left;dragData.y=$(window).scrollTop()+d3.event.sourceEvent.clientY-dragData.offset.top;that.svg.selectAll("rect.dragger").remove();dragData.rect=that.svg.append("rect").classed("dragger",!0).attr("x",dragData.x).attr("y",dragData.y).attr("width",0).attr("height",0).attr("fill","#303030").attr("opacity",.5)}}).on("dragend",function(){if(!isRightClick){dragData.rect.remove();if(null!==orig_x&&null!==orig_y){is_additive||that.model.sign_board.reset();_.delay(function(){that.model.trigger("drag:selection",orig_x,last_x,orig_y,last_y,height*offset,is_additive);last_x=last_y=orig_x=orig_y=null},200)}}}).on("drag",function(){if(!isRightClick){null===orig_x&&(orig_x=d3.event.x);null===orig_y&&(orig_y=d3.event.y);var width=d3.event.x-orig_x,height=d3.event.y-orig_y;last_x=d3.event.x;last_y=d3.event.y;dragData.rect.attr("x",orig_x).attr("y",orig_y).attr("width",Math.abs(width)).attr("height",Math.abs(height));0>width&&dragData.rect.attr("x",d3.event.x);0>height&&dragData.rect.attr("y",d3.event.y)}});return drag},isRightClick:function(sourceEvent){return 1!==sourceEvent.which?!0:sourceEvent.ctrlKey===!0?!0:!1},addSearchManager:function(){if(this.model.manager){var previous_data=this.model.get("previous_data");this.manager=this.model.manager;this.manager.set("done",!0);this.data=this.manager.data("preview");this.data.on("data",_.bind(this.onData,this));this.manager.on("search:start",_.bind(this.onSearchStart,this));this.manager.on("search:progress",_.bind(this.onSearchProgress,this));this.manager.on("search:done",_.bind(this.onSearchDone,this));this.manager.on("search:error",_.bind(this.onSearchError,this));this.manager.on("change:innerTimeRange",_.bind(this.onInnerTimeRangeChange,this));previous_data&&this.render(previous_data)}},onInnerTimeRangeChange:function(){this.destroyEvents();this.clearErrorMessage();this.showSpinner();this.model.pref.clearClickedEvents()},onSearchStart:function(){this.manager.set("done",!1);this.destroyEvents();this.showSpinner();this.clearErrorMessage()},onSearchProgress:function(properties){properties=properties||{};var content=properties.content||{},previewCount=content.resultPreviewCount||0,isJobDone=content.isDone||!1;0===previewCount&&isJobDone&&this.noResults()},onSearchDone:function(){this.manager.set("done",!0);this.hideSpinner()},onSearchError:function(a){console.error("Search Error: ",this.model.id,a,this.manager);this.hideSpinner();this.errorMessageIcon.text("");this.errorMessageText.text("Error.  Search did not run correctly")},onData:function(){var collection=this.data.collection();collection&&collection.length>0&&this.render(collection)},renderContainer:function(){var channel=this.model.get("channel"),height=this.model.get("height");this.rect=this.svg.append("rect").classed(channel.rect.className,!0).attr("x",channel.rect.x).attr("y",channel.rect.y).attr("width",channel.rect.width).attr("height",height).attr("fill",channel.rect.fill).attr("stroke",channel.rect.stroke);this.loadingIcon=this.svg.append("g").attr("transform","translate(525,5)");this.loadingIcon.append("rect").attr("fill","white").attr("width",150).attr("height",height-1).attr("transform","translate(0,-4)");this.loadingIcon.append("use").attr("xlink:href","#loader").attr("transform","scale(0.5)").attr("width",200);this.loadingIcon.append("text").text("Loading...").attr("transform","translate(50,12)");this.errorMessage=this.svg.append("g").attr("transform","translate(520, 25)");this.errorMessageIcon=this.errorMessage.append("text").classed("errorMessageIcon",!0).style("font-family","fontello");this.errorMessageText=this.errorMessage.append("text").classed("errorMessageText",!0).attr("x",20)},_showSpinner:function(){this.loadingIcon.attr("display","block")},_hideSpinner:function(){this.loadingIcon.attr("display","none")},noResults:function(){this.hideSpinner();this.destroyEvents();this.model.set({previous_data:new Backbone.Collection});this.errorMessageText.text("Search returned no results")},destroyEvents:function(){this.svg.selectAll("rect.event").remove();this.svg.selectAll("rect.clicked").remove()},clearErrorMessage:function(){this.errorMessageIcon.text("");this.errorMessageText.text("")},render:function(collection){var sorted_coll=collection.clone(),model=(this.sign_board,this.model),channel=model.get("channel"),height=model.get("height"),base_x=channel.rect.x,width=channel.rect.width/80,el=this.el,scale=this.time_range.get("innerTimeScale"),count_scale=d3.scale.pow().range([.3,1]),events=new Events;this.destroyEvents();if(!collection||collection.length<1){this.noResults();return this}this.hideSpinner();this.clearErrorMessage();sorted_coll.comparator=function(a,b){var ca=Number(a.get("count")),cb=Number(b.get("count"));return ca>cb?1:cb>ca?-1:ca===cb?0:void 0};sorted_coll.sort();count_scale.domain([Number(sorted_coll.at(0).get("count")),Number(sorted_coll.at(sorted_coll.length-1).get("count"))]);collection.each(function(m){var _time=m.get("_time"),t=new Date(_time),idx=Math.max(0,Math.round(scale(t),0)),opacity=Math.round(10*count_scale(m.get("count")))/10,offset=scale(t),x=idx*width+base_x,meta={search:model.manager.get("data").normalizedSearch,drilldown:model.get("normalizedDrilldown"),lane_name:model.id,earliest_time:new Date(t),latest_time:new Date(scale.invert(idx+1)),id:_time,offset:offset};m.set("meta",meta);new EventView({el:el,height:Number(height)-4,offset:offset,model:model,result:m,opacity:opacity,width:width,x:x,y:2}).render();events.add(m)});model.set({events:events});model.set({previous_data:collection},{silent:!0});return this}})});define("app/views/LaneNameView",["jquery","backbone","underscore","d3"],function($,Backbone,_,d3){return Backbone.View.extend({className:"lane_label",tagName:"g",initialize:function(){this.svg=d3.select(this.el).append(this.tagName).classed(this.className,!0);this.el=this.svg[0][0]},render:function(){var label=this.model.get("label"),height=this.model.get("height"),title=this.model.get("title");this.svg.append("rect").classed(label.rect.className,!0).attr("x",label.rect.x).attr("y",label.rect.y).attr("height",height).attr("width",label.rect.width).attr("fill",label.rect.fill).attr("stroke",label.rect.stroke);this.svg.append("rect").attr("class","lane_label_border_bottom").attr("x",label.rect.x).attr("y",label.rect.y+height).attr("height",1).attr("width",label.rect.width-1).attr("stroke","#828282");this.svg.append("text").classed(label.text.className,!0).attr("dx",label.text.dx).attr("dy",label.text.dy).attr("fill",label.text.fill).style("font-family","'helvetica neue',helvetica,arial").text(title);return this}})});define("app/views/SwimlaneView",["jquery","backbone","underscore","d3","app/models/LaneName","app/views/ChannelView","app/views/LaneNameView"],function($,Backbone,_,d3,LaneName,ChannelView,LaneNameView){return Backbone.View.extend({className:"swimlane",tagName:"g",initialize:function(){this.svg=d3.select(this.el).append(this.tagName).classed(this.className,!0).attr("data-id",this.model.id);this.el=this.svg[0][0]},render:function(){new LaneNameView({el:this.el,model:this.model}).render();new ChannelView({el:this.el,model:this.model});this.initBehaviors();return this},initBehaviors:function(){var getOrigin=this.getOrigin,addGripPad=this.addGripPad,onDrag=this.onDrag,onDragEnd=this.onDragEnd,last_y=0,model=this.model,height=this.model.get("height"),label=this.model.get("label"),length=this.model.collection.where({selected:!0}).length,offset=this.model.get("offset"),detectRightClick=this.isRightClick,isRightClick=!1,translate=this.getTranslate(),this_svg=this.svg,label_group=this.svg.select(".lane_label"),total_y=length*height,offset_y=offset*height,max_y=total_y-height,min_y=0-offset_y,x=label.rect.x,y=label.rect.y;this.svg.attr("transform",translate);label_group.on("mouseover",function(){addGripPad(this,x,y,height)}).on("mouseout",function(){this_svg.selectAll("line.grip_handle_line").remove()});label_group.call(d3.behavior.drag().origin(getOrigin).on("dragstart",function(){isRightClick=detectRightClick(d3.event.sourceEvent);isRightClick||addGripPad(this,x,y,height)}).on("drag",function(){isRightClick||(last_y=onDrag(this,min_y,max_y,offset_y))}).on("dragend",function(){isRightClick||onDragEnd(this_svg,this,last_y,model)}))},isRightClick:function(sourceEvent){return 1!==sourceEvent.which?!0:sourceEvent.ctrlKey===!0?!0:!1},getOrigin:function(){var t=d3.select(this.parentNode),tf=d3.transform(t.attr("transform")),x=t.attr("x"),y=t.attr("y");return{x:x+tf.translate[0],y:y+tf.translate[1]}},getTranslate:function(){return"translate(0,"+this.model.get("offset")*this.model.get("height")+")"},addGripPad:function(node,x,y,height){var this_svg=d3.select(node),lines=this_svg.selectAll("line.grip_handle_line").data([0,1,2]);lines.enter().append("line").classed("grip_handle_line",!0).style("fill","#6E6E6E").style("stroke","#CDCDCD").style("stroke-width",1).style("stroke-dasharray","2 ,2").attr("x1",function(d){return x+4+3*d}).attr("x2",function(d){return x+4+3*d}).attr("y1",function(){return y+2}).attr("y2",function(){return y+height-2});lines.exit().remove()},onDrag:function(node,min_y,max_y,offset_y){var x=Math.min(d3.event.x,20),y=Math.min(max_y-offset_y,Math.max(min_y,d3.event.y-offset_y));node.parentNode.parentNode.appendChild(node.parentNode);d3.select(node).attr("transform","translate("+[x,y]+")");return y},onDragEnd:function(this_svg,node,y,model){var group=model.pref.get("selected"),height=model.get("height"),length=model.collection.where({selected:!0}).length,lanes_order=model.pref.get("lane_order")||{},lane_order=lanes_order[group]||[],max=length*height,offset=model.get("offset"),index=(d3.scale.linear().domain([0,max]).range([0,length]),Math.round(y/height));this_svg.selectAll("line.grip_handle_line").remove();if(0===index)d3.select(node).attr("transform","translate("+[0,0]+")");else{lane_order=_.without(lane_order,model.id);lane_order.splice(offset+index,0,model.id);lanes_order[group]=lane_order;model.pref.set({lane_order:lanes_order},{silent:!0});model.trigger("reorder:lane_order",model,lane_order)}}})});define("app/views/SwimlanesView",["jquery","backbone","underscore","d3","app/views/SwimlaneView","entityUtils","splunk.util"],function($,Backbone,_,d3,SwimlaneView){return Backbone.View.extend({tagName:"g",transform:{x:0,y:40},className:"swimLanes",initialize:function(options){this.options=options||{};this.parent_svg=d3.select(this.el);this.svg=this.parent_svg.append(this.tagName).classed(this.className,!0);this.el=this.svg[0][0];this.time_range=this.options.model;this.shortFormat=d3.time.format("%H:%M");this.longFormat=d3.time.format("%m/%d %H:%M");this.svg.attr("transform","translate("+[this.transform.x,this.transform.y]+")");this.xAxis=this.svg.append("g").classed("xAxis",!0);this.xAxis.attr("transform","translate("+[180,0]+")");this.collection.on("reset change:selected reorder:lane_order",_.bind(this.render,this));this.time_range.on("change:innerTimeRange",_.bind(this.renderAxis,this))},render:function(){if(this.collection.length<1)return this;var totalHeight,collection=this.collection,model0=collection.at(0),channel=(model0.get("height"),model0.get("channel")),width=channel.rect.width,pref=model0.pref,group=pref.get("selected"),lanes_order=pref.get("lane_order"),lane_order=_.uniq(lanes_order[group]);this.width=width;this.svg.selectAll("g.swimlane").remove();_.each(lane_order,function(id,offset){var model=collection.get(id);if(model){model.set({offset:offset});this.renderOne(this.el,model)}},this);totalHeight=this.getTotalHeight();this.parent_svg.attr("height",totalHeight);this.resizeTicks();return this},getTotalHeight:function(){var height,model0=this.collection.at(0);if(void 0!==model0){height=model0.get("height");return this.collection.where({selected:!0}).length*height+height}return 0},resizeTicks:function(){var totalHeight=this.getTotalHeight(),ticks=this.svg.selectAll(".tick line");ticks.attr("y2",totalHeight).attr("transform","translate(0-5)")},renderOne:function(el,model){return new SwimlaneView({el:el,model:model}).render()},renderAxis:function(){var innerTimeRange,timeFormat,timeScale,xAxis,previousDate,timeDiff,width=this.width||840,numTicks=8,self=this;innerTimeRange=this.time_range.get("innerTimeRange");if(void 0!==innerTimeRange){timeDiff=this.time_range.calculateTotalInner(innerTimeRange);timeDiff.minutes<4&&timeDiff.days<1&&timeDiff.hours<1&&(numTicks=2);timeScale=d3.time.scale().domain([innerTimeRange.earliest_date,innerTimeRange.latest_date]).range([0,width]);xAxis=d3.svg.axis().scale(timeScale).orient("top").ticks(numTicks).tickFormat(function(currentDate){void 0===previousDate&&(previousDate=currentDate);timeFormat=currentDate.getDay()>previousDate.getDay()?self.longFormat:self.shortFormat;previousDate=currentDate;return timeFormat(currentDate)}).tickPadding(15);this.xAxis.call(xAxis);this.resizeTicks()}}})});!function($){var Modal=function(element,options){this.options=options;this.$element=$(element).delegate('[data-dismiss="modal"]',"click.dismiss.modal",$.proxy(this.hide,this));this.options.remote&&this.$element.find(".modal-body").load(this.options.remote)};Modal.prototype={constructor:Modal,toggle:function(){return this[this.isShown?"hide":"show"]()},show:function(){var that=this,e=$.Event("show");this.$element.trigger(e);if(!this.isShown&&!e.isDefaultPrevented()){this.isShown=!0;this.escape();this.backdrop(function(){var transition=$.support.transition&&that.$element.hasClass("fade");that.$element.parent().length||that.$element.appendTo(document.body);that.$element.show();transition&&that.$element[0].offsetWidth;that.$element.addClass("in").attr("aria-hidden",!1);that.enforceFocus();transition?that.$element.one($.support.transition.end,function(){that.$element.focus().trigger("shown")}):that.$element.focus().trigger("shown")})}},hide:function(e){e&&e.preventDefault();e=$.Event("hide");this.$element.trigger(e);if(this.isShown&&!e.isDefaultPrevented()){this.isShown=!1;this.escape();$(document).off("focusin.modal");this.$element.removeClass("in").attr("aria-hidden",!0);$.support.transition&&this.$element.hasClass("fade")?this.hideWithTransition():this.hideModal()}},enforceFocus:function(){var that=this;$(document).on("focusin.modal",function(e){that.$element[0]===e.target||that.$element.has(e.target).length||that.$element.focus()})},escape:function(){var that=this;this.isShown&&this.options.keyboard?this.$element.on("keyup.dismiss.modal",function(e){27==e.which&&that.hide()}):this.isShown||this.$element.off("keyup.dismiss.modal")},hideWithTransition:function(){var that=this,timeout=setTimeout(function(){that.$element.off($.support.transition.end);that.hideModal()},500);this.$element.one($.support.transition.end,function(){clearTimeout(timeout);that.hideModal()})},hideModal:function(){var that=this;this.$element.hide();this.backdrop(function(){that.removeBackdrop();that.$element.trigger("hidden")})},removeBackdrop:function(){this.$backdrop&&this.$backdrop.remove();this.$backdrop=null},backdrop:function(callback){var animate=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var doAnimate=$.support.transition&&animate;this.$backdrop=$('<div class="modal-backdrop '+animate+'" />').appendTo(document.body);this.$backdrop.click("static"==this.options.backdrop?$.proxy(this.$element[0].focus,this.$element[0]):$.proxy(this.hide,this));doAnimate&&this.$backdrop[0].offsetWidth;this.$backdrop.addClass("in");if(!callback)return;doAnimate?this.$backdrop.one($.support.transition.end,callback):callback()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass("in");$.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one($.support.transition.end,callback):callback()}else callback&&callback()}};var old=$.fn.modal;$.fn.modal=function(option){return this.each(function(){var $this=$(this),data=$this.data("modal"),options=$.extend({},$.fn.modal.defaults,$this.data(),"object"==typeof option&&option);data||$this.data("modal",data=new Modal(this,options));"string"==typeof option?data[option]():options.show&&data.show()})};$.fn.modal.defaults={backdrop:!0,keyboard:!0,show:!0};$.fn.modal.Constructor=Modal;$.fn.modal.noConflict=function(){$.fn.modal=old;return this};$(document).on("click.modal.data-api",'[data-toggle="modal"]',function(e){var $this=$(this),href=$this.attr("href"),$target=$($this.attr("data-target")||href&&href.replace(/.*(?=#[^\s]+$)/,"")),option=$target.data("modal")?"toggle":$.extend({remote:!/#/.test(href)&&href},$target.data(),$this.data());e.preventDefault();$target.modal(option).one("hide",function(){$this.focus()})})}(window.jQuery);define("bootstrap.modal",["jquery"],function(){});define("contrib/text",{load:function(id){throw new Error("Dynamic load not allowed: "+id)}});define("contrib/text!app/templates/SwimlanePicker.html",[],function(){return'<input class="laneCheck" type="checkbox"><%= title %></input>\n<div class="swimlaneChosenColor swimlaneColor <%= color %>"></div>\n<div class="icon-triangle-down-small swimlaneTriangle"></div>\n\n'});define("contrib/text!app/templates/SwimlaneColorPicker.html",[],function(){return'<div class="swimlaneColorPickerBackground"></div>\n<div class="swimlaneColorPicker">\n	<div class="swimlaneColor large blue" data-color="blue"></div>\n	<div class="swimlaneColor large green" data-color="green"></div>\n	<div class="swimlaneColor large purple" data-color="purple"></div>\n	<div class="swimlaneColor large yellow" data-color="yellow"></div>\n	<div class="swimlaneColor large orange" data-color="orange"></div>\n	<div class="swimlaneColor large red" data-color="red"></div>\n</div>\n'});define("app/views/SwimlaneColorPickerView",["jquery","underscore","backbone","contrib/text!app/templates/SwimlaneColorPicker.html"],function($,_,Backbone,SwimlaneColorPickerTemplate){return Backbone.View.extend({initialize:function(options){this.options=options||{};this.model=this.options.model},render:function(){this.$el.html(_.template(SwimlaneColorPickerTemplate));this.close();return this},open:function(){this.$el.show()},isOpen:function(){return!this.$el.is(":hidden")},close:function(){this.$el.hide()},isClosed:function(){return this.$el.is(":hidden")},events:{"click .swimlaneColor":"chooseColor","click .swimlaneColorPickerBackground":"close"},chooseColor:function(e){var color=$(e.target).attr("data-color");this.model.set("color",color);this.close()}})});define("app/views/SwimlanePickerView",["jquery","underscore","backbone","contrib/text!app/templates/SwimlanePicker.html","app/views/SwimlaneColorPickerView"],function($,_,Backbone,SwimlanePickerTemplate,SwimlaneColorPickerView){return Backbone.View.extend({className:"swimlanePicker",initialize:function(options){this.options=options||{};this.model=this.options.model;this.colorPicker=new SwimlaneColorPickerView({model:this.model});this.model.on("change:selected",_.bind(this.onSelected,this));this.model.on("change:disabled",_.bind(this.onDisabled,this));this.model.on("change:color",_.bind(this.changeColor,this))},change:function(e){this.model.set("selected",$(e.target).is(":checked"))},changeColor:function(model,color){var prevColor=model.previous("color");this.$(".swimlaneChosenColor").removeClass(prevColor);this.$(".swimlaneChosenColor").addClass(color);this.model.set("color",color)},events:{"change input":"change","click .swimlaneChosenColor":"toggleColorPicker"},onDisabled:function(){this.$("input").prop("disabled",this.model.get("disabled"))},onSelected:function(){this.$("input").prop("checked",this.model.get("selected"))},render:function(){this.$el.html(_.template(SwimlanePickerTemplate,{selected:this.model.get("selected"),title:this.model.id,color:this.model.get("color")}));this.model.get("selected")&&this.$el.find(".laneCheck").prop("checked",!0);this.$el.append(this.colorPicker.render().el);return this},toggleColorPicker:function(){this.colorPicker.isClosed()?this.colorPicker.open():this.colorPicker.close()}})});define("app/views/SwimlanePickersView",["jquery","underscore","backbone","app/views/SwimlanePickerView"],function($,_,Backbone,SwimlanePickerView){return Backbone.View.extend({initialize:function(options){this.options=options||{};this.collection=this.options.collection;this.collection.on("reset",_.bind(this.render,this))},render:function(){this.renderAll();return this},renderAll:function(){this.$el.empty();this.collection.each(_.bind(this.renderOne,this))},renderOne:function(model){this.$el.append(new SwimlanePickerView({model:model}).render().el)}})});define("contrib/text!app/templates/SwimlaneGroup.html",[],function(){return'<input type="radio" name="swimlaneGroups" value="<%= title %>"><%= title %></input>\n'});define("app/views/SwimlaneGroupView",["jquery","underscore","backbone","contrib/text!app/templates/SwimlaneGroup.html"],function($,_,Backbone,SwimlaneGroupTemplate){return Backbone.View.extend({className:"swimlaneGroup",initialize:function(){this.input=null;this.model.on("change:selected",_.bind(this.onSelect,this))},checked:function(){this.model.set("selected",!0)},events:{"click input":"checked"},onSelect:function(){this.$input.prop("checked",this.model.get("selected"))},render:function(){this.$el.html(_.template(SwimlaneGroupTemplate,this.model.attributes));this.$input=this.$el.find("input");this.onSelect();return this}})});define("app/views/SwimlaneGroupsView",["jquery","underscore","backbone","app/views/SwimlaneGroupView"],function($,_,Backbone,SwimlaneGroupView){return Backbone.View.extend({initialize:function(options){this.options=options||{};this.lanes=this.options.collection;this.collection=this.options.collection.groups;this.collection.on("reset",_.bind(this.render,this))},render:function(){this.empty();this.renderAll();return this},renderAll:function(){var collection=this.collection.clone(),custom=collection.find(function(m){return"Custom"===m.get("title")});collection.remove(custom,{silent:!0});collection.each(_.bind(this.renderOne,this));this.renderOne(custom)},renderOne:function(model){this.$el.append(new SwimlaneGroupView({model:model}).render().el)},empty:function(){this.$el.empty()}})});define("app/views/SwimlaneModalView",["jquery","underscore","backbone","bootstrap.modal","app/views/SwimlanePickersView","app/views/SwimlaneGroupsView"],function($,_,Backbone,modal,SwimlanePickersView,SwimlaneGroupsView){return Backbone.View.extend({initialize:function(options){this.options=options||{};this.collection=this.options.collection;this.swimlanePickersView=new SwimlanePickersView({el:this.$(this.options.swimlanes_el),collection:this.collection});this.swimlaneGroupsView=new SwimlaneGroupsView({el:this.$(this.options.collections_el),collection:this.collection});$(this.options.edit_el).click(_.bind(this.open,this));return this},open:function(){this.$el.modal("show")},close:function(){this.$el.modal("hide")},events:{"click .close":"close"}})});define("contrib/text!app/templates/ShareButtonPopup.html",[],function(){return'<div class="popUp">\n	<div class="popUpTitle">Share Link:</div>\n	<input class="popUpVal"/>\n</div>'});define("app/views/ShareButtonView",["jquery","backbone","underscore","d3","contrib/text!app/templates/ShareButtonPopup.html","backbone-mediator"],function($,Backbone,_,d3,ShareButtonPopupTemplate){return Backbone.View.extend({initialize:function(){var $popUp,self=this;this.popUpVisible=!1;$popUp=$(_.template(ShareButtonPopupTemplate,{}));this.$el.after($popUp);$popUp.on("click",function(e){e.stopPropagation()});this.$el.on("click",function(e){var url;e.stopPropagation();url=self.model.getUrl();$popUp.find("input").val(url);if(self.popUpVisible){$popUp.hide();self.popUpVisible=!1}else{$popUp.show();self.popUpVisible=!0}});$(window).on("click",function(){if(self.popUpVisible){$popUp.hide();self.popUpVisible=!1}})},render:function(){}})});define("app/models/ShareButton",["jquery","backbone","underscore","d3","backbone-mediator"],function($,Backbone){return Backbone.Model.extend({initialize:function(options){this.prefs=options.prefs},getUrl:function(){var url=this.prefs.serializeToURL();return url}})});define("app/models/GotoSearch",["jquery","backbone","underscore","d3"],function($,Backbone,_){return Backbone.Model.extend({initialize:function(options){this.baseUrl=Splunk.util.make_url("app","SplunkEnterpriseSecuritySuite","search");this.url="#";this.collection=options.collection;this.swimlanes=options.swimlanes;this.update=_.debounce(this._update,50);this.collection.on("add remove reset",function(){this.update()},this)},_update:function(){var earliest,latest,url,currentSearch,mergedSearch="",i=0,queryData={},drilldowns={};if(this.collection.models.length>0){earliest=this.collection.min(function(model){return model.get("meta").earliest_time}).get("meta").earliest_time;latest=this.collection.max(function(model){return model.get("meta").latest_time}).get("meta").latest_time;_.each(this.collection.models,function(model){var meta,laneName;meta=model.get("meta");laneName=meta.lane_name;if(void 0===drilldowns[laneName]){currentSearch="";drilldowns[laneName]=meta.drilldown;if(meta.drilldown){currentSearch="|"!==meta.drilldown[0]?"search "+meta.drilldown:meta.drilldown;mergedSearch+=i>0?" | append ["+currentSearch+"]":currentSearch;i+=1}}});queryData={q:mergedSearch,earliest:earliest.getTime()/1e3,latest:latest.getTime()/1e3};url=this.baseUrl+"?"+Splunk.util.propToQueryString(queryData);this.set("url",url)}}})});define("app/views/GotoSearchView",["jquery","backbone","underscore","d3"],function($,Backbone){return Backbone.View.extend({initialize:function(){var self=this;this.$el.on("click",function(){window.open(self.model.get("url"))})},render:function(){return this}})});define("app/models/CreateNotableEvent",["jquery","backbone","underscore","d3"],function($,Backbone){return Backbone.Model.extend({defaults:function(){},initialize:function(options){this.prefs=options.prefs;this.baseUrl=Splunk.util.make_url("app","SplunkEnterpriseSecuritySuite","ess_notable_event_create");this.collection=options.collection;this.url="#";this.collection.on("add remove reset",function(){this.update()},this)},update:function(){var qs,drilldown_url,currentPath,url=this.baseUrl,view_name="asset_investigator";document.location.pathname.indexOf("identity_investigator")>0&&(view_name="identity_investigator");currentPath=Splunk.util.make_url("app","SplunkEnterpriseSecuritySuite",view_name);drilldown_url=currentPath+"?"+this.prefs.serializeToURL({fullUrl:!1});qs=Splunk.util.propToQueryString({drilldown_name:"View in entity investigator",drilldown_url:drilldown_url});url+="?"+qs;this.set("url",url)}})});define("app/views/CreateNotableEventView",["jquery","backbone","underscore","d3","backbone-mediator"],function($,Backbone){return Backbone.View.extend({initialize:function(){var self=this;this.$el.on("click",function(){window.location=self.model.get("url")})},render:function(){}})});define("contrib/text!app/templates/SignBoardHeader.html",[],function(){return'<div class="title">\r\n<%= title %>\r\n<% if(count>1) { %>\r\n    (<%= count %>)\r\n<% } %>\r\n</div>\r\n<div class="dateRange">\r\n    <div class="startDate">\r\n	<div><%= startDate  %></div> \r\n	<div><%= startTime %></div>\r\n    </div>\r\n    <div class="centerDate">-</div>\r\n    <div class="endDate">\r\n	<div><%= endDate %></div>\r\n	<div><%= endTime %></div>\r\n    </div>\r\n    <div class="timezone">GMT<%= timeZone %></div> \r\n    <div class="clear"></div>\r\n</div>\r\n'});define("app/views/SignBoardHeaderView",["jquery","underscore","backbone","contrib/text!app/templates/SignBoardHeader.html"],function($,_,Backbone,Template){return Backbone.View.extend({template:_.template(Template),initialize:function(){this.model.on("ready:headerData",_.bind(this.render,this));
this.model.on("clearAll",_.bind(this.emptyAll,this))},emptyAll:function(){this.$el.empty()},render:function(){this.emptyAll();this.$el.append(this.template(this.model.get("meta")));return this}})});define("contrib/text!app/templates/SignBoardRow.html",[],function(){return'<div class="signBoardRow">\n  <div class="signBoardRowLeft"><%= name %></div>\n  <div class="signBoardRowRight">\n    <div class="alwaysVisible">\n    </div>\n    <div class="toggleable" style="display:none;">\n    </div>\n  </div>\n</div>\n\n<div class="clear"></div>'});define("contrib/text!app/templates/SignBoardVal.html",[],function(){return"<div><%= val %></div>"});define("contrib/text!app/templates/SignBoardToggle.html",[],function(){return'<div class="toggleHandle">\r\n  <div class="showMore">+<%= numHiddenItems %> more</div>\r\n  <div class="showLess" style="display:none;">Show Less</div>\r\n</div>'});define("app/views/SignBoardBodyView",["jquery","underscore","backbone","contrib/text!app/templates/SignBoardRow.html","contrib/text!app/templates/SignBoardVal.html","contrib/text!app/templates/SignBoardToggle.html"],function($,_,Backbone,SignBoardRowTemplate,SignBoardValTemplate,SignBoardToggleTemplate){return Backbone.View.extend({initialize:function(){this.model.on("ready:bodyData",_.bind(this.render,this));this.model.on("clearAll",_.bind(this.emptyAll,this))},emptyAll:function(){this.$el.empty()},render:function(){var keys=_.sortBy(_.keys(this.model.attributes),function(x){return x});this.emptyAll();_.each(keys,function(k){var $val,$rightSide,item=this.model.get(k),maxShown=2,showToggleHandle=!1,numHiddenItems=0;if("meta"!==k&&"count"!==k&&"_time"!==k){$template=$(_.template(SignBoardRowTemplate,{name:k}));$rightSide=$template.find(".signBoardRowRight");this.$el.append($template);_.each(item,function(itemName,i){$val=_.template(SignBoardValTemplate,{val:itemName});if(maxShown>i)$rightSide.find(".alwaysVisible").append($val);else{$rightSide.find(".toggleable").append($val);showToggleHandle=!0;numHiddenItems++}});showToggleHandle&&$rightSide.append(_.template(SignBoardToggleTemplate,{numHiddenItems:numHiddenItems}))}},this);return this}})});define("app/views/SignBoardView",["jquery","backbone","underscore","d3","app/views/ShareButtonView","app/models/ShareButton","app/models/GotoSearch","app/views/GotoSearchView","app/models/CreateNotableEvent","app/views/CreateNotableEventView","app/views/SignBoardHeaderView","app/views/SignBoardBodyView"],function($,Backbone,_,d3,ShareButtonView,ShareButton,GotoSearch,GotoSearchView,CreateNotableEvent,CreateNotableEventView,SignBoardHeaderView,SignBoardBodyView){return Backbone.View.extend({initialize:function(options){this.options=options||{};this.collection=this.options.collection;this.elements={$body:this.$el.find(".signBoardBody"),$header:this.$el.find(".signBoardHeader"),$toSearch:this.$el.find(".toSearch"),$share:this.$el.find(".share"),$createNotable:this.$el.find(".createNotable")};this.svg=d3.select(this.el).insert("svg",".signBoardBody").attr("width",260).attr("height",60);this.showSpinner=_.throttle(this._showSpinner,100);this.hideSpinner=_.throttle(_.debounce(this._hideSpinner,50),1e3);this.gotoSearchView=new GotoSearchView({model:new GotoSearch({collection:this.collection}),el:this.elements.$toSearch});this.shareButtonView=new ShareButtonView({model:new ShareButton({prefs:this.options.prefs}),el:this.elements.$share});this.createNotableEventView=new CreateNotableEventView({model:new CreateNotableEvent({collection:this.collection,prefs:this.options.prefs}),el:this.elements.$createNotable});this.signBoardHeaderView=new SignBoardHeaderView({model:this.collection.data,el:this.elements.$header});this.signBoardBodyView=new SignBoardBodyView({model:this.collection.data,el:this.elements.$body});this.renderLoadingIcon();this.collection.data.on("ready:headerData",_.bind(this.renderHeader,this));this.collection.data.on("ready:bodyData",_.bind(this.renderBody,this));this.collection.data.on("clearAll",_.bind(this.hide,this));this.$el.on("click",".toggleHandle",function(){var $this=$(this);$this.prev().toggle("fast");$this.find(".showMore").toggle();$this.find(".showLess").toggle()})},hide:function(){this.$el.css("visibility","hidden")},show:function(){this.$el.css("visibility","visible")},renderLoadingIcon:function(){this.loadingIcon=this.svg.append("g").attr("transform","translate(50,10)");this.loadingIcon.append("use").attr("xlink:href","#loader").attr("transform","scale(0.5)").attr("width",200);this.loadingIcon.append("text").text("Loading...").attr("transform","translate(50,12)")},_showSpinner:function(){this.elements.$body.empty().hide();this.svg.style("display","block")},_hideSpinner:function(){this.svg.style("display","none");this.elements.$body.show()},renderHeader:function(){if(!this.collection||this.collection.length<1){this.hide();return this}this.show();this.showSpinner();return this},renderBody:function(){this.hideSpinner();return this}})});define("app/views/TimeRangeLinegraphView",["jquery","backbone","underscore","d3"],function($,Backbone,_,d3){return Backbone.View.extend({initialize:function(options){this.options=options||{};this.width=this.options.width;this.height=this.options.height;this.svg=this.options.svg;this.time_range=this.options.time_range;this.linechart=d3.select(this.el);this.id=_.uniqueId("TimeRangeLinegraphView-");this.clipId=this.id+"-clip";this.time_range.on("change:outerTimeRange",_.bind(this.render,this));this.clipPath=this.linechart.append("clipPath").attr("id",this.clipId);this.loadingIndicator=this.linechart.append("use").attr("xlink:href","#loader").attr("transform","scale(0.5) translate(700, 0)").attr("width",200).style("visibility","hidden");this.model.on("change:data",this.render,this);this.model.on("change:loading",this.onLoading,this)},getClipId:function(){return this.clipId},clear:function(){this.linechart.selectAll("path").remove();this.clipPath.selectAll("path").remove()},onLoading:function(){var loading=this.model.get("loading");if(loading){this.clear();this.loadingIndicator.style("visibility","visible")}else this.loadingIndicator.style("visibility","hidden")},render:function(){var data,yScale,xScale,lineGen,areaGen,earliest=this.model.get("earliest"),latest=this.model.get("latest");data=this.model.get("data");if(data){yScale=d3.scale.linear().domain([this.model.get("min"),this.model.get("max")]).range([this.height,0]);xScale=d3.time.scale().domain([earliest,latest]).range([0,this.width]);lineGen=d3.svg.line().x(function(d){return xScale(d.get("_time").getTime())}).y(function(d){return yScale(d.get("numEvents"))});areaGen=d3.svg.area().x(function(d){return xScale(d.get("_time").getTime())}).y0(this.height).y1(function(d){return yScale(d.get("numEvents"))});this.linechart.append("path").attr("class","line").attr("clip-path","url(#"+this.clipId+")").attr("d",lineGen(data.models));this.clipPath.append("path").attr("d",areaGen(data.models));this.linechart.append("path").attr("class","area").attr("clip-path","url(#"+this.clipId+")").attr("id",this.clipId).attr("d",areaGen(data.models))}}})});define("mixins/viewlogging",["underscore","backbone","splunk.logger","splunk.util"],function(_,Backbone,SplunkLogger,splunkUtils){var logMode=splunkUtils.getConfigValue("JS_LOGGER_MODE","None"),logLevel=splunkUtils.getConfigValue("JS_LOGGER_LEVEL","INFO"),shouldAttachLogging="None"!==logMode&&"DEBUG"===logLevel,domEventBlacklist=["mousemove","scroll"],logger=null;return{delegateEvents:function(events){if(!shouldAttachLogging)return Backbone.View.prototype.delegateEvents.call(this,events);events=events||_.result(this,"events");if(!events)return Backbone.View.prototype.delegateEvents.call(this,events);var wrappedEvents={};_(events).each(function(handler,eventName){var normalizedHandler=_.isFunction(handler)?handler:this[handler];if(_.isFunction(normalizedHandler)&&-1===_(domEventBlacklist).indexOf(eventName)){var viewId=this.moduleId+"/"+this.cid;wrappedEvents[eventName]=function(){logger||(logger=SplunkLogger.getLogger("viewlogging.js"));logger.debug("view "+viewId+" is handling event "+eventName.replace(/\s+/g," "));normalizedHandler.apply(this,arguments)}}else wrappedEvents[eventName]=handler},this);return Backbone.View.prototype.delegateEvents.call(this,wrappedEvents)}}});define("views/Base",["jquery","backbone","underscore","mixins/viewlogging","util/console"],function($,Backbone,_,viewloggingmixin,console){var BaseView=Backbone.View.extend({awake:!0,touch:!1,active:!1,constructor:function(options){this.options=options||{};this.children={};this.options.moduleId&&(this.moduleId=this.options.moduleId);this.options.template&&(this.template=this.options.template);this.template&&(this.compiledTemplate=this.compileTemplate(this.template));Backbone.View.apply(this,arguments)},initialize:function(){var render=this.render;this.render=_.bind(function(){var end,start=(new Date).getTime();this.awake?render.apply(this):this.touch=!0;end=(new Date).getTime();this.options.instrument!==!1&&this.$el.attr("data-render-time",(end-start)/1e3);return this},this);this.$el.attr("data-cid",this.cid);if(this.moduleId){var className=this.cssNamespace();this.options.dontAddModuleIdAsClass||this.$el.addClass(className);this.$el.attr("data-view",this.moduleId)}},invokeOnChildren:function(method){if(!_.isString(method))throw new Error("Your method must be a string");var argsForMethod=Array.prototype.slice.call(arguments,1);_.each(this.children,function(child){_.isArray(child)?_.each(child,function(view){_.isFunction(view[method])&&view[method].apply(view,argsForMethod)}):_.isFunction(child[method])&&child[method].apply(child,argsForMethod)})},eachChild:function(iterator,context){if(!_.isFunction(iterator))throw new Error("Your iterator must be a function");_.each(this.children,function(child){_.isArray(child)?_.each(child,function(view){iterator.call(context,view)}):iterator.call(context,child)})},wake:function(options){options||(options={});this.awake=!0;if(this.touch){this.touch=!1;options.syncRender?this.render():this.debouncedRender()}this.invokeOnChildren("wake",options);return this},sleep:function(){this.awake=!1;this.invokeOnChildren("sleep");return this},debouncedRender:function(){this._debouncedRender||(this._debouncedRender=_.debounce(this.render,0));this._debouncedRender.apply(this,arguments)},debouncedReflow:function(){this._debouncedReflow||(this._debouncedReflow=_.debounce(this.reflow,0));this._debouncedReflow.apply(this,arguments)},compileTemplate:_.memoize(function(templateStr){return _.template(templateStr)}),cssNamespace:function(){return(this.moduleId||"").toLowerCase().replace(/\//g,"-").replace(/\_/g,"").replace(/^views-/,"").replace(/-master$/,"")},uniqueNS:function(){return(this.moduleId||"unidentified").toLowerCase().replace(/\//g,"-")+"-"+this.cid},startListening:function(){},stopListening:function(){if(0===arguments.length){this.modelsOff(this.model);this.collectionsOff(this.collection)}Backbone.View.prototype.stopListening.apply(this,arguments)},remove:function(){this.removeChildren();if(this._isAddedToDocument){this.onRemovedFromDocument();this._isAddedToDocument=!1}this.stopListening();this.$el.remove();return this},debouncedRemove:function(options){options||(options={});var defaults={detach:!1};_.defaults(options,defaults);options.detach&&this.$el.detach();this._debouncedRemove||(this._debouncedRemove=_.debounce(this.remove,0));this._debouncedRemove.apply(this,arguments);return this},removeChildren:function(){this.invokeOnChildren("remove")},ensureDeactivated:function(options){this.active&&this.deactivate(options)},activate:function(options){options||(options={});var clonedOptions=_.extend({startListening:!0,trigger:!0},options);delete options.startListening;delete options.trigger;!this.active&&clonedOptions.startListening&&this.startListening();if(this.active)console.debug("Calling activate again on view:"+this.moduleId,this.cid);else{this.active=!0;clonedOptions.trigger&&this.trigger("activated")}options.deep&&this.invokeOnChildren("activate",options);return this},deactivate:function(options){options||(options={});var clonedOptions=_.extend({stopListening:!0,trigger:!0},options);delete options.stopListening;delete options.trigger;options.deep&&this.invokeOnChildren("deactivate",options);this.active&&clonedOptions.stopListening&&this.stopListening();if(this.active){this.active=!1;clonedOptions.trigger&&this.trigger("deactivated")}else console.debug("Calling deactivate again on view:"+this.moduleId,this.cid);return this},modelsOff:function(model){if(model instanceof Backbone.Model){_.isFunction(model.associatedOff)&&model.associatedOff(null,null,this);model.off(null,null,this)}else _(model).each(function(mod){this.modelsOff(mod)},this);return this},collectionsOff:function(collection){collection instanceof Backbone.Collection?collection.off(null,null,this):_(collection).each(function(coll){this.collectionsOff(coll)},this);return this},detach:function(){if(this._isAddedToDocument){this.onRemovedFromDocument();this._isAddedToDocument=!1}this.$el.detach()},replaceContentsOf:function($container){if(_.isString($container))throw new Error("replaceContentsOf does not support selectors or HTML strings");$container=$($container);$container.empty();return this.attachToDocument($container,"appendTo")},appendTo:function($container){return this.attachToDocument($container,"appendTo")},prependTo:function($container){return this.attachToDocument($container,"prependTo")},replaceAll:function($container){return this.attachToDocument($container,"replaceAll")},insertAfter:function($container){return this.attachToDocument($container,"insertAfter")},insertBefore:function($container){return this.attachToDocument($container,"insertBefore")},attachToDocument:function($container,attachmentMethod){if(_.isString($container))throw new Error(attachmentMethod+" does not support selectors or HTML strings");$container=$($container);if(0===$container.length)return this;var container=$container[0],oldParent=this.el.parentNode;if(oldParent&&oldParent!==container&&this._isAddedToDocument){this.onRemovedFromDocument();this._isAddedToDocument=!1}this.$el[attachmentMethod]($container);if(oldParent!==container&&this.isAttachedToDocument()){this._isAddedToDocument=!0;this.onAddedToDocument()}return this},onAddedToDocument:function(){this.eachChild(function(child){if(_.isFunction(child.onAddedToDocument)&&this.isAncestorOf(child)&&!child._isAddedToDocument){child._isAddedToDocument=!0;child.onAddedToDocument()}},this)},onRemovedFromDocument:function(){this.eachChild(function(child){if(_.isFunction(child.onRemovedFromDocument)&&this.isAncestorOf(child)&&child._isAddedToDocument){child.onRemovedFromDocument();child._isAddedToDocument=!1}},this)},isAttachedToDocument:function(){return $.contains(document.documentElement,this.el)},isAncestorOf:function(descendant){return descendant.el?$.contains(this.el,descendant.el):!1},isDescendantOf:function(ancestor){return ancestor.el?$.contains(ancestor.el,this.el):!1},reflow:function(){this.invokeOnChildren("reflow")},getAncestors:function(depth){for(var results=[],parent=this.$el;;){parent=parent.parent();if(!(parent.length>0))break;var dataView=parent.attr("data-view");_(dataView).isUndefined()||_(dataView).isEmpty()||results.unshift(dataView);if(!_(depth).isUndefined()&&depth==results.length)break}return results}});_.extend(BaseView.prototype,viewloggingmixin);return BaseView});define("views/shared/timerangepicker/dialog/Presets",["jquery","underscore","backbone","module","views/Base","util/time"],function($,_,Backbone,module,Base,time_utils){return Base.extend({moduleId:module.id,className:"accordion-inner",initialize:function(){this.label=_("Presets").t();var defaults={showRealTime:!0,showRealTimeOnly:!1,showRelative:!0,showAllTime:!0};_.defaults(this.options,defaults);Base.prototype.initialize.apply(this,arguments);this.activate()},startListening:function(){this.collection&&this.listenTo(this.collection,"reset",this.render)},supportsRange:function(){var earliest=this.model.get("earliest"),latest=this.model.get("latest");return time_utils.generateAllTimeLabel(earliest,latest)||time_utils.findPresetLabel(this.collection,earliest,latest)},events:{"click a":function(e){e.preventDefault();var $target=$(e.currentTarget);this.model.save({earliest:$target.data("earliest"),latest:$target.data("latest")});this.model.trigger("applied")}},render:function(){var periodPresets=this.options.showRelative&&!this.options.showRealTimeOnly?this.collection.filterToPeriod():!1,hasPeriodPresets=periodPresets&&periodPresets.length,lastPresets=this.options.showRelative&&!this.options.showRealTimeOnly?this.collection.filterToLast():!1,hasLastPresets=lastPresets&&lastPresets.length,template=_.template(this.template,{_:_,realTimePresets:this.options.showRealTime?this.collection.filterToRealTime():!1,periodPresets:periodPresets,hasPeriodPresets:hasPeriodPresets,lastPresets:lastPresets,hasLastPresets:hasLastPresets,otherPresets:this.options.showRealTimeOnly?!1:this.collection.filterToOther(),options:this.options,isAllTime:this.isAllTime,listElementPartial:this.listElementPartial});this.$el.html(template);return this},isAllTime:function(model){var noEarliest=!model.entry.content.get("earliest_time")||"0"==model.entry.content.get("earliest_time"),noLatest=!model.entry.content.get("latest_time")||"now"==model.entry.content.get("latest_time");return noEarliest&&noLatest},listElementPartial:_.template('            <li><a href="#" data-earliest="<%- model.entry.content.get("earliest_time") || "" %>" data-latest="<%- model.entry.content.get("latest_time") || "" %>"><%- _(model.entry.content.get("label")).t() %></a></li>        '),template:'            <% if (realTimePresets && realTimePresets.length) { %>                <ul class="unstyled presets-group">                    <li><%- _("Real-time").t() %></li>                    <% _.each(realTimePresets, function(model) { %>                        <%= listElementPartial({model: model}) %>                    <% }); %>                </ul>                <div class="presets-divider-wrap"><div class="presets-divider"></div></div>            <% } %>            <% if (hasPeriodPresets && hasLastPresets) { %>                    <ul class="unstyled presets-group">                        <li><%- _("Relative").t() %></li>                        <% _.each(periodPresets, function(model) { %>                            <%= listElementPartial({model: model}) %>                        <% }); %>                    </ul>                    <ul class="unstyled presets-group">                        <li>&nbsp;</li>                        <% _.each(lastPresets, function(model) { %>                             <%= listElementPartial({model: model}) %>                        <% }); %>                    </ul>                    <div class="presets-divider-wrap"><div class="presets-divider"></div></div>            <% } else if (hasPeriodPresets) { %>                <ul class="unstyled presets-group">                    <li><%- _("Relative").t() %></li>                    <% _.each(periodPresets, function(model) { %>                        <%= listElementPartial({model: model}) %>                    <% }); %>                </ul>                <div class="presets-divider-wrap"><div class="presets-divider"></div></div>            <% } else if (hasLastPresets) { %>                <ul class="unstyled presets-group">                    <li><%- _("Relative").t() %></li>                    <% _.each(lastPresets, function(model) { %>                        <%= listElementPartial({model: model}) %>                   <% }); %>                </ul>                <div class="presets-divider-wrap"><div class="presets-divider"></div></div>            <% } %>            <% if (otherPresets && otherPresets.length) { %>                <ul class="unstyled presets-group">                    <li><%- _("Other").t() %></li>                    <% _.each(otherPresets, function(model) { %>                        <% if (!(isAllTime(model) && !options.showAllTime)) { %>                            <%= listElementPartial({model: model}) %>                        <% } %>                    <% }); %>                </ul>            <% } %>        '})});define("views/shared/controls/Control",["jquery","underscore","backbone","module","views/Base"],function($,_,Backbone,module,Base){return Base.extend({moduleId:module.id,className:"control",initialize:function(){Base.prototype.initialize.apply(this,arguments);var defaults={defaultValue:"",enabled:!0,validate:!1,forceUpdate:!1,updateModel:!0};_.defaults(this.options,defaults);this._value=this.options.defaultValue;this.model&&this.activate({skipSetValueRender:!0});return this},startListening:function(){this.model&&this.listenTo(this.model,"change:"+this.options.modelAttribute,this.setValueFromModel)},activate:function(options){options=options||{};if(this.active)return Base.prototype.activate.apply(this,arguments);this.model&&this.setValueFromModel(options.skipSetValueRender?!1:!0);return Base.prototype.activate.apply(this,arguments)},getValue:function(){return this._value},getModelAttribute:function(){return this.options.modelAttribute},setValue:function(value,render){var returnValue=this._setValue(value,render);this.options.updateModel&&this.updateModel();return returnValue},_setValue:function(value,render,suppressEvent){value=this.normalizeValue(value);if(this._value!==value){var oldValue=this._value;this._value=value;render===!1||this.render();suppressEvent||this.trigger("change",value,oldValue,this)}else render&&this.render();return this},normalizeValue:function(value){return value},unsetValue:function(){this.model.unset(this.getModelAttribute())},setValueFromModel:function(render){this._setValue(this.model.get(this.options.modelAttribute),render);return this},updateModel:function(){var updateOptions={validate:this.options.validate,forceUpdate:this.options.forceUpdate};return this.model?this.model[this.options.save?"save":"set"](this.getUpdatedModelAttributes(),updateOptions):!0},getUpdatedModelAttributes:function(){var updatedAttrs={};updatedAttrs[this.options.modelAttribute]=this._value;return updatedAttrs},enable:function(){this.$el.removeClass("enabled")},disable:function(){this.$el.addClass("enabled")}})});define("views/shared/delegates/Base",["views/Base"],function(BaseView){return BaseView.extend({initialize:function(){},wake:function(){},sleep:function(){},remove:function(){this.stopListening();return this},detach:function(){throw new Error("detach is not supported by delegates.")},appendTo:function(){throw new Error("jQuery-like attachment methods are not supported by delegates.")},prependTo:function(){throw new Error("jQuery-like attachment methods are not supported by delegates.")},replaceAll:function(){throw new Error("jQuery-like attachment methods are not supported by delegates.")},insertBefore:function(){throw new Error("jQuery-like attachment methods are not supported by delegates.")},insertAfter:function(){throw new Error("jQuery-like attachment methods are not supported by delegates.")}})});define("views/shared/delegates/PopdownDialog",["jquery","underscore","views/shared/delegates/Base"],function($,_,DelegateBase){return DelegateBase.extend({initialize:function(){var defaults={arrow:".arrow",mode:"dialog",adjustPosition:!0,minMargin:20,allowPopUp:!0,direction:"auto",zIndex:"auto",scrollContainer:window,ignoreClasses:[]};_.defaults(this.options,defaults);this.isShown=!1;this.addEventHandlers=_.bind(this.addEventHandlers,this);this.dialogClick=_.bind(this.dialogClick,this);this.keepInBoundsDebounced=_.debounce(this.keepInBounds,100);this.$el.attr("id")||this.$el.attr("id","dialog-"+this.cid);this.options.show&&this.show(this.options.show)},events:{click:"dialogClick","keydown a:last":function(e){if(!e.shiftKey&&9===e.keyCode){e.preventDefault();this.$el.find("a").first().focus()}},"keydown a:first":function(e){if(e.shiftKey&&9===e.keyCode){e.preventDefault();this.$el.find("a").last().focus()}},"keydown .close":function(e){if(13===e.keyCode){this.trigger("focus-on-activator");this.hide()}}},arrow:function(){return this.$el.find(this.options.arrow).first()},scrollContainer:function(){this.$scrollContainer||(this.$scrollContainer=$(this.options.scrollContainer));return this.$scrollContainer},toggle:function($toggle){this.trigger("toggle",$toggle);this[this.isShown?"hide":"show"]($toggle);this.trigger("toggled",$toggle);return!0},show:function($toggle){this.trigger("show",$toggle);this.isShown||_.defer(this.addEventHandlers,$toggle);"auto"!=this.options.zIndex&&this.$el.css("zIndex",this.options.zIndex);this.options.adjustPosition&&$toggle&&this.adjustPosition($toggle);this.isShown=!0;this.$el.addClass("open").show();$toggle.attr("data-dialog-id",this.$el.attr("id"));this.trigger("shown",$toggle)},hide:function(){if(!this.isShown)return!1;this.trigger("hide");this.removeEventHandlers();this.isShown=!1;this.$el.removeClass("open").hide();this.trigger("hidden")},addEventHandlers:function(){$("html").on("mousedown.popdown."+this.cid,this.bodyMouseDown.bind(this));$(window).on("keydown."+this.cid,this.windowKeydown.bind(this));if(this.options.scrollContainer!==window){this.scrollPosition={top:this.scrollContainer().scrollTop(),left:this.scrollContainer().scrollLeft()};this.scrollContainer().on("scroll."+this.cid,this.containerScroll.bind(this))}return this},removeEventHandlers:function(){$("html").off("."+this.cid);$(window).off("."+this.cid);this.options.scrollContainer!==window&&this.scrollContainer().off("."+this.cid);return this},deactivate:function(){this.hide();return DelegateBase.prototype.deactivate.apply(this,arguments)},stopListening:function(){this.removeEventHandlers();return DelegateBase.prototype.stopListening.apply(this,arguments)},measure:function($el,offsets){var measures={};measures.width=$el.outerWidth();measures.halfWidth=measures.width/2;measures.height=$el.outerHeight();measures.halfHeight=measures.height/2;if(offsets!==!1){measures.offset=$el.offset();measures.position=$el.position();measures.center={left:measures.offset.left+measures.halfWidth,top:measures.offset.top+measures.halfHeight}}return measures},adjustPosition:function($toggle){var dir=this.options.direction;this["adjustPosition"+dir.charAt(0).toUpperCase()+dir.slice(1)]($toggle)},adjustPositionAuto:function($toggle){this.$el.css({top:-9999,left:-9999,bottom:"auto"});this.$el.show();var m={},shift={left:0,top:0},positionFromTop=!0;m.toggle=this.measure($toggle);m.dialog=this.measure(this.$el);m.arrow=this.measure(this.arrow(),!1);m.window=this.measure($(window),!1);m.window.top=$(window).scrollTop();m.window.bottom=m.window.height+$(window).scrollTop();m.dialogParent={offset:this.$el.offsetParent().offset()};m.toggle.relativeOffset={left:m.toggle.offset.left-m.dialogParent.offset.left+m.toggle.halfWidth,top:Math.floor(m.toggle.offset.top-m.dialogParent.offset.top)};m.toggle.center.left<m.dialog.halfWidth+this.options.minMargin?shift.left=m.dialog.halfWidth-m.toggle.center.left+this.options.minMargin:m.toggle.center.left+m.dialog.halfWidth+this.options.minMargin>m.window.width&&(shift.left=m.window.width-(m.toggle.center.left+m.dialog.halfWidth+this.options.minMargin));shift.left=Math.round(shift.left);var popDownDialogBottom=m.toggle.offset.top+m.toggle.height+m.dialog.height+this.options.minMargin,popUpDialogTop=m.toggle.offset.top-m.dialog.height-this.options.minMargin;if(popDownDialogBottom>m.window.bottom&&this.options.allowPopUp&&popUpDialogTop>m.window.top){shift.top=-m.dialog.height-m.arrow.halfWidth;shift.bottom=m.toggle.height+m.arrow.halfWidth;this.$el.addClass("up");positionFromTop=this.options.attachDialogTo||this.$el.parent()[0]==$("body")[0]||this.$el.parent()[0]==$(".modal:visible")[0]}else{shift.top=m.toggle.height;this.$el.removeClass("up");if(popDownDialogBottom>m.window.bottom){this.scrollContainer().scrollTop(this.scrollContainer().scrollTop()+popDownDialogBottom-m.window.bottom);m.toggle.offset=$toggle.offset();m.toggle.relativeOffset.top=m.toggle.offset.top-m.dialogParent.offset.top}}this.position={top:positionFromTop?shift.top+m.toggle.relativeOffset.top:"auto",left:m.toggle.relativeOffset.left,marginLeft:-m.dialog.halfWidth+shift.left,bottom:positionFromTop?"auto":shift.bottom};this.$el.css(this.position);this.arrow().css("marginLeft",0-m.arrow.halfWidth-shift.left);m.dialog.halfWidth-m.arrow.halfWidth-shift.left<8?this.$el.css("borderTopLeftRadius",Math.max(m.dialog.halfWidth-m.arrow.halfWidth-shift.left,0)):this.$el.css("borderTopLeftRadius","")},adjustPositionRight:function($toggle){this.$el.addClass("right");this.$el.css({top:-9999,left:-9999});this.$el.show();var m={},shift={left:0,top:0},calculateTop=function(){return Math.round(shift.top)+m.toggle.relativeOffset.top-m.dialog.halfHeight+m.toggle.halfHeight}.bind(this);m.toggle=this.measure($toggle);m.dialog=this.measure(this.$el);m.arrow=this.measure(this.arrow(),!1);m.window=this.measure($(window),!1);m.window.top=$(window).scrollTop();m.window.bottom=m.window.height+$(window).scrollTop();m.arrow.minMargin=10;m.arrow.maxShift=m.dialog.halfHeight-m.arrow.halfHeight-m.arrow.minMargin;m.dialogParent={offset:this.$el.offsetParent().offset()};m.toggle.relativeOffset={left:m.toggle.offset.left-m.dialogParent.offset.left+m.toggle.width,top:Math.floor(m.toggle.offset.top-m.dialogParent.offset.top)};m.toggle.center.top-m.window.top<m.dialog.halfHeight+this.options.minMargin?shift.top=m.dialog.halfHeight-(m.toggle.center.top-m.window.top)+this.options.minMargin:m.toggle.center.top+m.dialog.halfHeight+this.options.minMargin>m.window.bottom&&(shift.top=m.window.bottom-(m.toggle.center.top+m.dialog.halfHeight+this.options.minMargin));calculateTop()<this.options.minMargin&&(shift.top=shift.top+(this.options.minMargin-calculateTop()));shift.top>m.arrow.maxShift?shift.top-=shift.top-m.arrow.maxShift:-shift.top>m.arrow.maxShift&&(shift.top-=shift.top+m.arrow.maxShift);this.position={top:calculateTop(),left:m.toggle.relativeOffset.left,marginLeft:m.arrow.halfWidth};this.$el.css(this.position);this.arrow().css("marginTop",0-m.arrow.halfHeight-shift.top)},containerScroll:function(){var newScrollTop=this.scrollContainer().scrollTop(),newScrollLeft=this.scrollContainer().scrollLeft();this.position.top=this.position.top+(this.scrollPosition.top-newScrollTop);this.position.left=this.position.left+(this.scrollPosition.left-newScrollLeft);this.$el.css(this.position);this.scrollPosition={top:newScrollTop,left:newScrollLeft};this.keepInBoundsDebounced()},keepInBounds:function(){var containerTop=this.scrollContainer().offset().top,containerBottom=containerTop+this.scrollContainer().outerHeight(),elEdge=this.$el.hasClass("up")?this.$el.offset().top+this.$el.outerHeight():this.$el.offset().top;(containerTop>elEdge||elEdge>containerBottom)&&this.hide()},bodyMouseDown:function(e){var $target=$(e.target);if(this.isShown&&!$.contains(this.$el[0],e.target)&&e.target!==this.$el[0]){for(var i=0;i<this.options.ignoreClasses.length;i++)if($target.closest("."+this.options.ignoreClasses[i]).length)return;this.hide(e)}},dialogClick:function(){"dialog"!=this.options.mode&&this.hide()},windowKeydown:function(e){var escapeKeyCode=27,enterKeyCode=13;if(e.keyCode==escapeKeyCode){this.trigger("focus-on-activator");this.hide();return!0}e.keyCode==enterKeyCode&&this.bodyMouseDown(e);return!0},pointTo:function($toggle){this.isShown?this.adjustPosition($toggle):this.show($toggle)}})});define("views/shared/delegates/Popdown",["jquery","underscore","views/shared/delegates/Base","views/shared/delegates/PopdownDialog"],function($,_,DelegateBase,PopdownDialog){return DelegateBase.extend({initialize:function(){var defaults={toggle:"> .popdown-toggle, > .dropdown-toggle",dialog:"> .popdown-dialog, > .dropdown-menu",arrow:".arrow",mode:"menu",adjustPosition:!0,minMargin:20,attachDialogTo:!1,allowPopUp:!0,scrollContainer:window,ignoreClasses:[]};_.defaults(this.options,defaults);this.children={};this.events={};this.events["mousedown "+this.options.toggle]="toggle";
this.events["keydown "+this.options.toggle]="keydownToggle";this.events["click "+this.options.toggle]="clickToggle";this.delegateEvents(this.events);this.$activeToggle=this.$(this.options.toggle).first();this.options.show&&this.show()},delegate:function(){if(!this.children.delegate){var options=$.extend(!0,{},this.options);options.el=options.dialog instanceof $?options.dialog[0]:this.$(options.dialog)[0];_.isString(options.scrollContainer)&&(options.scrollContainer=this.$activeToggle.closest(options.scrollContainer));this.children.delegate=new PopdownDialog(options);this.listenTo(this.children.delegate,"toggle",this.hearToggle);this.listenTo(this.children.delegate,"toggled",this.hearToggled);this.listenTo(this.children.delegate,"show",this.hearShow);this.listenTo(this.children.delegate,"shown",this.hearShown);this.listenTo(this.children.delegate,"hide",this.hearHide);this.listenTo(this.children.delegate,"hidden",this.hearHidden);options.attachDialogTo&&$(options.attachDialogTo).append(this.children.delegate.el)}return this.children.delegate},toggle:function(e){e.preventDefault();if(!$(e.currentTarget).is(".disabled, :disabled")){this.delegate().toggle($(e.currentTarget));return!0}},hearToggle:function($toggle){this.trigger("toggle",$toggle)},hearToggled:function($toggle){this.trigger("toggled",$toggle)},show:function(){this.delegate().show(this.$activeToggle)},hearShow:function($toggle){this.trigger("show",$toggle);$(window).on("resize.popdown."+this.cid,this.windowResize.bind(this));this.$activeToggle.removeClass("active");this.$activeToggle=$toggle.addClass("active")},hearShown:function($toggle){this.trigger("shown",$toggle)},hide:function(){if(!this.delegate().isShown)return!1;$(window).off("."+this.cid);this.$activeToggle.removeClass("active");$.contains(this.children.delegate.el,$(":focus")[0])&&this.$activeToggle.focus();this.children.delegate.hide()},clickToggle:function(e){e.preventDefault()},keydownToggle:function(e){var enterKeyCode=13;e.keyCode==enterKeyCode&&this.toggle(e)},hearHide:function($toggle){$(window).off(".popdown."+this.cid);this.trigger("hide",$toggle);this.$activeToggle.removeClass("active")},hearHidden:function($toggle){this.trigger("hidden",$toggle)},stopListening:function(){this.children.delegate&&this.children.delegate.remove();return DelegateBase.prototype.stopListening.apply(this,arguments)},adjustPosition:function(){this.delegate();this.children.delegate.adjustPosition(this.$activeToggle)},windowResize:function(){this.children.delegate&&this.children.delegate.isShown&&this.adjustPosition(this.$activeToggle)},pointTo:function($activeToggle){this.$activeToggle=$activeToggle;this.delegate().adjustPosition(this.$activeToggle)},remove:function(){DelegateBase.prototype.remove.apply(this);this.children.delegate&&this.children.delegate.remove();this.children.delegate&&this.options.attachDialogTo&&this.children.delegate.$el.remove();delete this.children.delegate;$(window).off("resize.popdown."+this.cid);$(window).off("."+this.cid);this.undelegateEvents();return this}})});!function($){var Tooltip=function(element,options){this.init("tooltip",element,options)};Tooltip.prototype={constructor:Tooltip,init:function(type,element,options){var eventIn,eventOut,triggers,trigger,i;this.type=type;this.$element=$(element);this.options=this.getOptions(options);this.enabled=!0;triggers=this.options.trigger.split(" ");for(i=triggers.length;i--;){trigger=triggers[i];if("click"==trigger)this.$element.on("click."+this.type,this.options.selector,$.proxy(this.toggle,this));else if("manual"!=trigger){eventIn="hover"==trigger?"mouseenter":"focus";eventOut="hover"==trigger?"mouseleave":"blur";this.$element.on(eventIn+"."+this.type,this.options.selector,$.proxy(this.enter,this));this.$element.on(eventOut+"."+this.type,this.options.selector,$.proxy(this.leave,this))}}this.options.selector?this._options=$.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},getOptions:function(options){options=$.extend({},$.fn[this.type].defaults,this.$element.data(),options);options.delay&&"number"==typeof options.delay&&(options.delay={show:options.delay,hide:options.delay});return options},enter:function(e){var self,defaults=$.fn[this.type].defaults,options={};this._options&&$.each(this._options,function(key,value){defaults[key]!=value&&(options[key]=value)},this);self=$(e.currentTarget)[this.type](options).data(this.type);if(!self.options.delay||!self.options.delay.show)return self.show();clearTimeout(this.timeout);self.hoverState="in";this.timeout=setTimeout(function(){"in"==self.hoverState&&self.show()},self.options.delay.show)},leave:function(e){var self=$(e.currentTarget)[this.type](this._options).data(this.type);this.timeout&&clearTimeout(this.timeout);if(!self.options.delay||!self.options.delay.hide)return self.hide();self.hoverState="out";this.timeout=setTimeout(function(){"out"==self.hoverState&&self.hide()},self.options.delay.hide)},show:function(){var $tip,pos,actualWidth,actualHeight,placement,tp,e=$.Event("show");if(this.hasContent()&&this.enabled){this.$element.trigger(e);if(e.isDefaultPrevented())return;$tip=this.tip();this.setContent();this.options.animation&&$tip.addClass("fade");placement="function"==typeof this.options.placement?this.options.placement.call(this,$tip[0],this.$element[0]):this.options.placement;$tip.detach().css({top:0,left:0,display:"block"});this.options.container?$tip.appendTo(this.options.container):$tip.insertAfter(this.$element);pos=this.getPosition();actualWidth=$tip[0].offsetWidth;actualHeight=$tip[0].offsetHeight;switch(placement){case"bottom":tp={top:pos.top+pos.height,left:pos.left+pos.width/2-actualWidth/2};break;case"top":tp={top:pos.top-actualHeight,left:pos.left+pos.width/2-actualWidth/2};break;case"left":tp={top:pos.top+pos.height/2-actualHeight/2,left:pos.left-actualWidth};break;case"right":tp={top:pos.top+pos.height/2-actualHeight/2,left:pos.left+pos.width}}this.applyPlacement(tp,placement);this.$element.trigger("shown")}},applyPlacement:function(offset,placement){var actualWidth,actualHeight,delta,replace,$tip=this.tip(),width=$tip[0].offsetWidth,height=$tip[0].offsetHeight;$tip.offset(offset).addClass(placement).addClass("in");actualWidth=$tip[0].offsetWidth;actualHeight=$tip[0].offsetHeight;if("top"==placement&&actualHeight!=height){offset.top=offset.top+height-actualHeight;replace=!0}if("bottom"==placement||"top"==placement){delta=0;if(offset.left<0){delta=-2*offset.left;offset.left=0;$tip.offset(offset);actualWidth=$tip[0].offsetWidth;actualHeight=$tip[0].offsetHeight}this.replaceArrow(delta-width+actualWidth,actualWidth,"left")}else this.replaceArrow(actualHeight-height,actualHeight,"top");replace&&$tip.offset(offset)},replaceArrow:function(delta,dimension,position){this.arrow().css(position,delta?50*(1-delta/dimension)+"%":"")},setContent:function(){var $tip=this.tip(),title=this.getTitle();$tip.find(".tooltip-inner")[this.options.html?"html":"text"](title);$tip.removeClass("fade in top bottom left right")},hide:function(){function removeWithAnimation(){var timeout=setTimeout(function(){$tip.off($.support.transition.end).detach()},500);$tip.one($.support.transition.end,function(){clearTimeout(timeout);$tip.detach()})}var $tip=this.tip(),e=$.Event("hide");this.$element.trigger(e);if(!e.isDefaultPrevented()){$tip.removeClass("in");$.support.transition&&this.$tip.hasClass("fade")?removeWithAnimation():$tip.detach();this.$element.trigger("hidden");return this}},fixTitle:function(){var $e=this.$element;($e.attr("title")||"string"!=typeof $e.attr("data-original-title"))&&$e.attr("data-original-title",$e.attr("title")||"").attr("title","")},hasContent:function(){return this.getTitle()},getPosition:function(){var el=this.$element[0];return $.extend({},"function"==typeof el.getBoundingClientRect?el.getBoundingClientRect():{width:el.offsetWidth,height:el.offsetHeight},this.$element.offset())},getTitle:function(){var title,$e=this.$element,o=this.options;title=$e.attr("data-original-title")||("function"==typeof o.title?o.title.call($e[0]):o.title);return title},tip:function(){return this.$tip=this.$tip||$(this.options.template)},arrow:function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},validate:function(){if(!this.$element[0].parentNode){this.hide();this.$element=null;this.options=null}},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},toggleEnabled:function(){this.enabled=!this.enabled},toggle:function(e){var self=e?$(e.currentTarget)[this.type](this._options).data(this.type):this;self.tip().hasClass("in")?self.hide():self.show()},destroy:function(){this.hide().$element.off("."+this.type).removeData(this.type)}};var old=$.fn.tooltip;$.fn.tooltip=function(option){return this.each(function(){var $this=$(this),data=$this.data("tooltip"),options="object"==typeof option&&option;data||$this.data("tooltip",data=new Tooltip(this,options));"string"==typeof option&&data[option]()})};$.fn.tooltip.Constructor=Tooltip;$.fn.tooltip.defaults={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1};$.fn.tooltip.noConflict=function(){$.fn.tooltip=old;return this}}(window.jQuery);define("bootstrap.tooltip",["jquery"],function(){});define("views/shared/controls/SyntheticSelectControl",["jquery","underscore","backbone","module","views/shared/controls/Control","views/shared/delegates/Popdown","util/math_utils","bootstrap.tooltip"],function($,_,Backbone,module,Control,Popdown,math_utils){return Control.extend({moduleId:module.id,className:"control btn-group",keys:{UP_ARROW:38,DOWN_ARROW:40},items:void 0,groupedItems:void 0,renderList:!0,initialize:function(){var defaults={toggleClassName:"",menuClassName:"",iconClassName:"icon-large",iconURLClassName:"icon-large",descriptionPosition:"right",label:"",popdownOptions:{el:this.el},html:"",nearestValue:!1,prompt:void 0};_.defaults(this.options,defaults);_.defaults(this.options.popdownOptions,defaults.popdownOptions);this.normalizeItems(this.options.items,this.options.groupedItems);var modelAttribute=this.options.modelAttribute;modelAttribute&&this.$el.attr("data-name",modelAttribute);Control.prototype.initialize.apply(this,arguments)},activate:function(options){options=options||{};if(this.active)return Control.prototype.activate.apply(this,arguments);this.renderList=!0;this.items=void 0;this.groupedItems=void 0;this.normalizeItems(this.options.items,this.options.groupedItems);Control.prototype.activate.apply(this,arguments)},setItems:function(items){this.normalizeItems(items,void 0);this.debouncedRender()},setGroupedItems:function(groupedItems){this.normalizeItems(void 0,groupedItems);this.debouncedRender()},normalizeItems:function(items,groupedItems){if(!items&&groupedItems){this.items=[];this.groupedItems=groupedItems.slice();if(!(groupedItems instanceof Array&&groupedItems[0].items instanceof Array&&!_.isUndefined(groupedItems[0].items[0].value)))throw new Error("Invalid groupedItems Input");_.each(groupedItems,function(value){_.each(value.items,function(item){this.items.push(item)},this)},this)}else if(items){this.items=items.slice();this.groupedItems=[];var group={};group.label="";group.items=this.items;this.groupedItems.push(group)}if(this.options.nearestValue){this.valuesAsInts=[];_.each(this.items,function(item){var convertedToInt=parseInt(item.value,10);if(_.isNaN(convertedToInt))throw new Error("You cannot use the nearestValue option with a SyntheticSelect control that has values other than ints!");this.valuesAsInts.push(convertedToInt)},this)}this.renderList=!0},stopListening:function(){if(0===arguments.length){$(window).off("."+this.cid);this.$menu&&this.$menu.off("."+this.cid)}Control.prototype.stopListening.apply(this,arguments)},show:function(){this.$menu.find(".icon-check:visible").closest("a").focus();this.$menu.on("click."+this.cid,"a",this.click.bind(this));$(window).on("keydown."+this.cid,this.keydown.bind(this));this.trigger("popdownShown")},hide:function(){$(window).off("."+this.cid);this.$menu.off("."+this.cid);this.trigger("popdownHidden")},disable:function(){this.options.enabled=!1;this.$("a.dropdown-toggle").addClass("disabled")},enable:function(){this.options.enabled=!0;this.$("a.dropdown-toggle").removeClass("disabled")},tooltip:function(options){this.$("a.dropdown-toggle").tooltip(options)},click:function(e){var $currentTarget=$(e.currentTarget);if(!$currentTarget.hasClass("disabled")){this.setValue($currentTarget.data("value"),!0);this.$(".dropdown-toggle").focus()}e.preventDefault()},keydown:function(e){if(e.shiftKey||e.ctrlKey||e.metaKey||e.altKey)return!0;var $focused=$(":focus"),selectedItem=-1,focusValue=$focused.data("value"),attachedTo=this.options.popdownOptions.attachDialogTo?$(this.options.popdownOptions.attachDialogTo)[0]:this.el;$.contains(attachedTo,$focused[0])&&_.each(this.items,function(element,key){element["value"]==focusValue?selectedItem=key:!1},this);if(e.keyCode===this.keys["DOWN_ARROW"]){if(selectedItem<this.items.length-1){this.$menu.find("li:eq("+(selectedItem+1)+") > a").focus();return!1}e.preventDefault()}else{if(e.keyCode===this.keys["UP_ARROW"]){if(selectedItem>0){this.$menu.find("li:eq("+(selectedItem-1)+") > a").focus();return!1}this.$(".dropdown-toggle").focus();return!1}if(e.keyCode>=48&&e.keyCode<=57||e.keyCode>=65&&e.keyCode<=90||e.keyCode>=97&&e.keyCode<=122||e.keyCode>=128&&e.keyCode<=165){var found=!1;this.$menu.find(" a").each(function(){if(!found){var option=$(this),firstChar=option.text().replace(/^\s\s*/,"").substring(0,1).toLowerCase(),keyChar=String.fromCharCode(e.keyCode).toLowerCase();keyChar==firstChar&&option.focus()}})}}},findItem:function(){if(!this.items||!this.items.length)return void 0;if(_(this._value).isUndefined()&&!_(this.options.prompt).isUndefined())return{label:this.options.prompt,value:void 0};if(this.options.nearestValue){var nearestObject=math_utils.nearestMatchAndIndexInArray(this._value,this.valuesAsInts);if(void 0!=nearestObject.index)return this.items[nearestObject.index]}return _.find(this.items,function(element){return _.isEqual(this._value,element.value)},this)||this.items[0]},render:function(){var groupedItems=this.groupedItems,items=this.items;if(!items||!items.length)return this;var item=this.findItem();if(this.renderList){var template=this.compiledTemplate({groupedItems:groupedItems,item:item,options:this.options,menuWidthClass:"normal"!=this.options.menuWidth?"dropdown-menu-"+this.options.menuWidth:""});this.$el.html(template);this.$el.find(".dropdown-menu a").each(function(i,el){$(el).data("value",items[i].value)});this.$menu=this.$(".dropdown-menu");if(this.children.popdown){this.children.popdown.remove();this.stopListening(this.children.popdown);delete this.children.popdown}this.children.popdown=new Popdown($.extend(!0,{},this.options.popdownOptions));this.listenTo(this.children.popdown,"shown",this.show);this.listenTo(this.children.popdown,"hidden",this.hide);this.renderList=!1}var additionalClassNames=this.options.additionalClassNames;additionalClassNames&&this.$el.addClass(additionalClassNames);this.$menu.find("a").each(function(i,el){var $el=$(el);$el.find(".icon-check")[_.isEqual($el.data("value"),item.value)?"show":"hide"]()});item.label&&this.$(".dropdown-toggle > .link-label").text(_(this.options.label).t()+" "+_(item.label).t());this.$(".dropdown-toggle > i").attr("class","icon-"+item.icon);return this},template:'            <a class="dropdown-toggle <%- options.toggleClassName %>" href="#">                <% if (item.icon) { %> <i class="icon-<%-item.icon%> icon-large"></i><% } %>                <span class="link-label"><%- options.label %> <%- item.label %></span><span class="caret"></span>            </a>            <div class="dropdown-menu dropdown-menu-selectable <%- options.menuClassName %> <%- menuWidthClass %> ">            <div class="arrow"></div>                <% _.each(groupedItems, function(group, key, fullItems) { %>                <ul>                <% _.each(group.items, function(element, index, list) { %>                    <li><a class="synthetic-select <%- element.enabled === false ? "disabled" : ""%>" href="#" data-value="<%- element.value %>">                        <i class="icon-check"></i>                        <% if (element.icon) { %> <i class="icon-<%-element.icon%> <%-options.iconClassName %>"></i><% } %>                        <% if (element.iconURL) { %> <img class="<%-options.iconURLClassName %>" src="<%-element.iconURL%>" alt="icon"><% } %>                        <span class="link-label"><%- element.label %></span>                        <% if (element.description && (options.descriptionPosition == "right")) { %> <span class="link-description"><%- element.description %></span><% } %>                        <% if (element.description && (options.descriptionPosition == "bottom")) { %> <span class="link-description-below"><%- element.description %></span><% } %>                    </a></li>                <% }); %>                </ul>                <% }); %>            </div>        '})});define("models/shared/FlashMessage",["models/Base"],function(BaseModel){return BaseModel.extend({initialize:function(){BaseModel.prototype.initialize.apply(this,arguments)},idAttribute:"key"})});define("collections/shared/FlashMessages",["collections/Base","models/shared/FlashMessage"],function(BaseCollection,FlashMessageModel){return BaseCollection.extend({model:FlashMessageModel,initialize:function(){BaseCollection.prototype.initialize.apply(this,arguments)}})});define("helpers/FlashMessagesHelper",["jquery","underscore","models/shared/FlashMessage","util/splunkd_utils"],function($,_,FlashMessageModel,splunkDUtils){var FlashMessagesHelper=function(flashMessagesCollection,options){this.options=options||{};this.defaults=$.extend(!0,{},this.options);_.defaults(this.defaults,{removeDuplicates:!0});if(_.isUndefined(flashMessagesCollection))throw"FlashMessagesHelper must be created with a valid FlashMessages collection";this.flashMessagesCollection=flashMessagesCollection;this.registered={};this.clientModelMessages={};this.serverModelMessages={};this.generalMessages={}};FlashMessagesHelper.prototype={register:function(obj,whitelist){this.registered[obj.cid]={instance:obj};whitelist&&(this.registered[obj.cid]["whitelist"]=_(whitelist).isArray()?whitelist:[whitelist]);obj.on("serverValidated",_.debounce(this.serverValidationHandler,0),this);obj.on("validated",_.debounce(this.clientValidationHandler,0),this)},unregister:function(obj){obj.off(null,null,this);delete this.clientModelMessages[obj.cid];delete this.serverModelMessages[obj.cid];delete this.registered[obj.cid]},destroy:function(){var registeredObjects=_(this.registered).pluck("instance");_(registeredObjects).each(function(obj){this.unregister(obj)},this)},clientValidationHandler:function(isValid,model,invalidAttrs){this.clientModelMessages[model.cid]=invalidAttrs;this.updateFlashMessageCollection()},serverValidationHandler:function(isValid,model,messages){this.serverModelMessages[model.cid]=messages;this.updateFlashMessageCollection()},addGeneralMessage:function(id,message){this.generalMessages[id]=message;this.updateFlashMessageCollection()},removeGeneralMessage:function(id){if(_(this.generalMessages).has(id)){delete this.generalMessages[id];this.updateFlashMessageCollection()}},getGeneralMessagesSize:function(){return _(this.generalMessages).size()},getClientModelMessagesSize:function(){return _(this.clientModelMessages).size()},getServerModelMessagesSize:function(){return _(this.serverModelMessages).size()},updateFlashMessageCollection:function(){var clientMessages=[],serverMessages=[],generalMessages=[];_(this.clientModelMessages).each(function(clientMsgs){_(clientMsgs).each(function(msg){clientMessages.push(new FlashMessageModel({type:splunkDUtils.ERROR,html:msg}))},this)},this);_(this.serverModelMessages).each(function(serverMsgs,cid){var whitelist=this.registered[cid]?this.registered[cid].whitelist:null;_(serverMsgs).each(function(msg){(!whitelist||_(whitelist).contains(msg.type))&&serverMessages.push(new FlashMessageModel({type:splunkDUtils.normalizeType(msg.type),html:_.escape(msg.message)}))},this)},this);_(this.generalMessages).each(function(msg){generalMessages.push(new FlashMessageModel({type:splunkDUtils.normalizeType(msg.type),html:msg.html}))},this);var allMessages=_.union(clientMessages,serverMessages,generalMessages);this.defaults.removeDuplicates&&(allMessages=_(allMessages).uniq(function(msg){return msg.get("html")}));this.defaults.postProcess&&(allMessages=this.defaults.postProcess(allMessages));this.flashMessagesCollection.reset(allMessages)}};return FlashMessagesHelper});define("views/shared/FlashMessages",["jquery","underscore","backbone","views/Base","collections/shared/FlashMessages","helpers/FlashMessagesHelper","module"],function($,_,Backbone,Base,FlashMessagesCollection,FlashMessagesHelper,module){return Base.extend({moduleId:module.id,className:"alerts",initialize:function(options){Base.prototype.initialize.call(this,options);this.flashMsgCollection=new FlashMessagesCollection;this.flashMsgHelper=new FlashMessagesHelper(this.flashMsgCollection,this.options.helperOptions);this.activate({skipRender:!0});this.beforeUnloadHandler=_(function(){this.sleep()}).bind(this);$(window).on("beforeunload",this.beforeUnloadHandler)},startListening:function(){this.listenTo(this.flashMsgCollection,"add remove reset",this.render)},activate:function(options){options=options||{};if(this.active)return Base.prototype.activate.apply(this,arguments);if(this.model instanceof Backbone.Model){this.flashMsgHelper.register(this.model,this.options.whitelist);this.model.error&&this.model.error.get("messages")&&this.flashMsgHelper.serverValidationHandler(!0,this.model,this.model.error.get("messages"))}else _(this.model).each(function(model){this.flashMsgHelper.register(model,this.options.whitelist);model.error&&model.error.get("messages")&&this.flashMsgHelper.serverValidationHandler(!0,model,model.error.get("messages"))},this);if(this.collection instanceof Backbone.Collection){this.flashMsgHelper.register(this.collection,this.options.whitelist);this.collection.each(function(model){this.flashMsgHelper.register(model,this.options.whitelist)},this)}else _(this.collection).each(function(collection){this.flashMsgHelper.register(collection,this.options.whitelist);collection.each(function(model){this.flashMsgHelper.register(model,this.options.whitelist)},this)},this);options.skipRender||this.render();return Base.prototype.activate.apply(this,arguments)},deactivate:function(){if(!this.active)return Base.prototype.deactivate.apply(this,arguments);this.flashMsgCollection.reset();Base.prototype.deactivate.apply(this,arguments);this.model instanceof Backbone.Model?this.flashMsgHelper.unregister(this.model):_(this.model).each(function(model){this.flashMsgHelper.unregister(model)},this);if(this.collection instanceof Backbone.Collection){this.flashMsgHelper.unregister(this.collection);this.collection.each(function(model){this.flashMsgHelper.unregister(model)},this)}else _(this.collection).each(function(collection){this.flashMsgHelper.unregister(collection);collection.each(function(model){this.flashMsgHelper.unregister(model)},this)},this);return this},register:function(obj,whitelist){this.flashMsgHelper.register(obj,whitelist)},unregister:function(obj){this.flashMsgHelper.unregister(obj)},remove:function(){this.flashMsgHelper.destroy();$(window).off("beforeunload",this.beforeUnloadHandler);return Base.prototype.remove.apply(this,arguments)},render:function(){this.$el.empty();this.$el.append(this.compiledTemplate({flashMessages:this.flashMsgCollection}));this.flashMsgCollection.length?this.$el.show():this.$el.hide();return this},template:'                <% flashMessages.each(function(flashMessage){ %>                     <div class="alert alert-<%- flashMessage.get("type") %>">                        <i class="icon-alert"></i>                        <%= flashMessage.get("html") %>                    </div>                <% }); %>             '})});define("contrib/text!views/shared/timerangepicker/dialog/Relative.html",[],function(){return'<div class="form form-horizontal">\n	<div class="relative-time-container">\n		<div class="control-group col-1 earliest_time">\n			<label for="earliest_<%- cid %>" class="control-label" title="<%- _("Earliest:").t() %>"><%- _("Earliest:").t() %></label>\n			<div class="controls">\n				<div class="input-append">\n					<input type="text" size="5" value="<%- time %>" class="earliest_input timerangepicker-relative-earliest-time" id="earliest_<%- cid %>"/>\n				</div>\n				<label for="earliest_no_snap_to_<%- cid %>" class="radio">\n					<input type="radio" name="earliest_snap" class="earliest_snap" id="earliest_no_snap_to_<%- cid %>" value="0" checked="checked"/>\n				     <%- _("No Snap-to").t() %>\n				</label>\n				<label class="earliest_snap_label radio" for="earliest_snap_to_<%- cid %>">\n					<input type="radio" name="earliest_snap" class="earliest_snap" id="earliest_snap_to_<%- cid %>" value="1"/>\n				<span class="text"><%= rangeMap[selectedRange].earliest %></span></label>\n\n				<span id="earliest_hint_<%- cid %>" class="help-block help-block-timestamp"></span>\n			</div>\n		</div><!-- /.control-group -->\n\n		<div class="control-group col-2 latest_time">\n			<label class="control-label" for="<%- cid %>" title="<%- _("Latest:").t() %>"><%- _("Latest:").t() %></label>\n			<div class="controls">\n				<label for="latest_no_snap_to_<%- cid %>" class="radio">\n					<input type="radio" name="latest_snap" class="latest_snap" id="latest_no_snap_to_<%- cid %>" value="0" checked="checked"/>\n					<%- _("now").t() %>\n				</label>\n				<label class="latest_snap_label radio" for="latest_snap_to_<%- cid %>">\n					<input type="radio" name="latest_snap" class="latest_snap" id="latest_snap_to_<%- cid %>" value="1"/>\n				<span class="text"><%= rangeMap[selectedRange].latest %></span></label>\n\n				 <span id="latest_hint_<%- cid %>" class="help-block help-block-timestamp"></span>\n			</div>\n		</div><!-- /.control-group -->\n\n		<div class="col-3">\n			<button class="apply btn" id="apply_<%- cid %>"><%- _("Apply").t() %></button>\n		</div>\n	</div>\n</div>\n'});define("views/shared/timerangepicker/dialog/Relative",["jquery","underscore","backbone","module","models/services/search/TimeParser","models/shared/TimeRange","views/Base","views/shared/controls/SyntheticSelectControl","views/shared/FlashMessages","util/time","util/splunkd_utils","splunk.i18n","contrib/text!views/shared/timerangepicker/dialog/Relative.html"],function($,_,Backbone,module,TimeParserModel,TimeRangeModel,Base,SyntheticSelectControl,FlashMessages,time_utils,splunkd_utils,i18n,relativeTemplate){return Base.extend({moduleId:module.id,className:"accordion-inner",template:relativeTemplate,initialize:function(){Base.prototype.initialize.apply(this,arguments);_.defaults(this.options,{appendSelectDropdownsTo:"body"});this.label=_("Relative").t();this.model={timeRange:this.model,workingRange:new TimeRangeModel,earliestTimeParser:new TimeParserModel,latestTimeParser:new TimeParserModel};this.syncInternals();this.rangeMap={s:{earliest:_("Beginning of second").t(),latest:_("Beginning of current second").t()},m:{earliest:_("Beginning of minute").t(),latest:_("Beginning of current minute").t()},h:{earliest:_("Beginning of hour").t(),latest:_("Beginning of current hour").t()},d:{earliest:_("Beginning of day").t(),latest:_("Beginning of today").t()},w:{earliest:_("First day of week").t(),latest:_("First day of this week").t()},mon:{earliest:_("First day of month").t(),latest:_("First day of this month").t()},q:{earliest:_("First day of quarter").t(),latest:_("First day of this quarter").t()},y:{earliest:_("First day of year").t(),latest:_("First day of this year").t()}};this.children.rangeTypeSelect=new SyntheticSelectControl({model:this.model.workingRange,items:[{value:"s",label:_("Seconds Ago").t()},{value:"m",label:_("Minutes Ago").t()},{value:"h",label:_("Hours Ago").t()},{value:"d",label:_("Days Ago").t()},{value:"w",label:_("Weeks Ago").t()},{value:"mon",label:_("Months Ago").t()},{value:"q",label:_("Quarters Ago").t()},{value:"y",label:_("Years Ago").t()}],modelAttribute:"relative_range_unit",className:"btn-group timerangepicker-relative_range_unit",toggleClassName:"btn",menuWidth:"narrow",popdownOptions:{attachDialogTo:this.options.appendSelectDropdownsTo},save:!1});this.children.flashMessages=new FlashMessages({model:{workingRange:this.model.workingRange,earliestTimeParser:this.model.earliestTimeParser,latestTimeParser:this.model.latestTimeParser}});this.activate()},startListening:function(){this.listenTo(this.model.workingRange,"change:relative_range_unit",function(){var timeRange=this.model.workingRange.get("relative_range_unit");this.$(".earliest_snap_label .text").html(this.rangeMap[timeRange].earliest);this.$(".latest_snap_label .text").html(this.rangeMap[timeRange].latest);this.fetchEarliestTime();this.fetchLatestTime()});this.listenTo(this.model.workingRange,"change:relative_earliest_snap_to change:relative_earliest_value",_.debounce(this.fetchEarliestTime,0));this.listenTo(this.model.workingRange,"change:relative_latest_snap_to",_.debounce(this.fetchLatestTime,0));this.listenTo(this.model.earliestTimeParser,"change",this.updateEarliestHint);this.listenTo(this.model.earliestTimeParser,"error",function(){this.$("#earliest_hint_"+this.cid).html(this.model.earliestTimeParser.error.get("messages")[0].message);this.disableApply()});this.listenTo(this.model.latestTimeParser,"change",this.updateLatestHint);this.listenTo(this.model.latestTimeParser,"error",function(){this.$("#latest_hint_"+this.cid).html(this.model.latestTimeParser.error.get("messages")[0].message);this.disableApply()});this.listenTo(this.model.timeRange,"change:earliest change:latest prepopulate",_.debounce(this.prepopulate,0))},syncInternals:function(){this.model.workingRange.set($.extend(!0,{},this.model.timeRange.toJSON(),{relative_range_unit:"s"}));this.model.earliestTimeParser.set({key:time_utils.stripRTSafe(this.model.timeRange.get("earliest"),!1),value:this.model.timeRange.get("earliest_iso")});this.model.latestTimeParser.set({key:time_utils.stripRTSafe(this.model.timeRange.get("latest"),!0),value:this.model.timeRange.get("latest_iso")})},activate:function(){if(this.active)return Base.prototype.activate.apply(this,arguments);this.syncInternals();return Base.prototype.activate.apply(this,arguments)},deactivate:function(){if(!this.active)return Base.prototype.deactivate.apply(this,arguments);Base.prototype.deactivate.apply(this,arguments);this.model.workingRange.fetchAbort();this.model.workingRange.clear({setDefaults:!0});this.model.earliestTimeParser.fetchAbort();this.model.earliestTimeParser.clear({setDefaults:!0});this.model.latestTimeParser.fetchAbort();this.model.latestTimeParser.clear({setDefaults:!0});return this},updateEarliestHint:function(){var date=time_utils.isoToDateObject(this.model.earliestTimeParser.get("value"));this.$("#earliest_hint_"+this.cid).html(i18n.format_datetime_microseconds(time_utils.jsDateToSplunkDateTimeWithMicroseconds(date),"short","full"));this.enableApply()},updateLatestHint:function(){var date=time_utils.isoToDateObject(this.model.latestTimeParser.get("value"));this.$("#latest_hint_"+this.cid).html(i18n.format_datetime_microseconds(time_utils.jsDateToSplunkDateTimeWithMicroseconds(date),"short","full"));this.enableApply()},prepopulate:function(){var earliestParse=this.model.timeRange.getTimeParse("earliest"),latestParse=this.model.timeRange.getTimeParse("latest"),attrValues={};if(earliestParse){attrValues.relative_earliest_value=earliestParse.amount;attrValues.relative_earliest_snap_to=earliestParse.hasSnap?1:0;attrValues.relative_latest_snap_to=latestParse&&latestParse.hasSnap?1:0;this.rangeMap.hasOwnProperty(earliestParse.unit)&&(attrValues.relative_range_unit=earliestParse.unit);
this.model.workingRange.set(attrValues);this.$(".earliest_input").val(earliestParse.amount);this.$("[name=earliest_snap][value="+this.model.workingRange.get("relative_earliest_snap_to")+"]").prop("checked",!0);this.$("[name=latest_snap][value="+this.model.workingRange.get("relative_latest_snap_to")+"]").prop("checked",!0)}},supportsRange:function(){return time_utils.generateRelativeTimeLabel(this.model.timeRange.get("earliest"),this.model.timeRange.get("latest"))},getEarliestTime:function(){var amount=this.model.workingRange.get("relative_earliest_value"),unit=this.model.workingRange.get("relative_range_unit")||"s",snap=this.model.workingRange.get("relative_earliest_snap_to");return amount?"-"+amount+unit+(snap?"@"+unit:""):null},fetchEarliestTime:function(){var time=this.getEarliestTime(),id=time_utils.stripRTSafe(this.model.earliestTimeParser.id,!1);if(time&&time!==id)this.model.earliestTimeParser.fetch({data:{time:time}});else if(this.model.earliestTimeParser.get("value"))this.updateEarliestHint();else{this.$("#earliest_hint_"+this.cid).html("");this.enableApply()}},getLatestTime:function(){var type=this.model.workingRange.get("relative_range_unit")||"mon",snap=this.model.workingRange.get("relative_latest_snap_to"),time="now";snap&&(time="@"+type);return time},fetchLatestTime:function(){var time=this.getLatestTime(),id=this.model.latestTimeParser.id;time&&time!==id?this.model.latestTimeParser.fetch({data:{time:time}}):this.model.latestTimeParser.get("value")?this.updateLatestHint():this.$("#latest_hint_"+this.cid).html("")},events:{"keyup .earliest_input":function(){this.model.workingRange.set("relative_earliest_value",this.$("#earliest_"+this.cid).val())},"change .earliest_snap":function(){var value=parseInt(this.$("input:radio[name=earliest_snap]:checked").val(),10);this.model.workingRange.set("relative_earliest_snap_to",value)},"change .latest_snap":function(){var value=parseInt(this.$("input:radio[name=latest_snap]:checked").val(),10);this.model.workingRange.set("relative_latest_snap_to",value)},"click .apply":function(event){if($(event.currentTarget).hasClass("disabled"))event.preventDefault();else{var that=this,earliest=this.getEarliestTime(),latest=this.getLatestTime();if(!earliest){var error=splunkd_utils.createSplunkDMessage(splunkd_utils.ERROR,"Earliest cannot be blank.");this.model.earliestTimeParser.trigger("error",this.model.earliestTimeParser,error);return!1}this.disableApply();this.model.workingRange.save({earliest:earliest,latest:latest},{success:function(model){that.enableApply();that.model.timeRange.set({earliest:earliest,latest:latest,earliest_epoch:model.get("earliest_epoch"),latest_epoch:model.get("latest_epoch"),earliest_iso:model.get("earliest_iso"),latest_iso:model.get("latest_iso"),earliest_date:new Date(model.get("earliest_date").getTime()),latest_date:new Date(model.get("latest_date").getTime())});that.model.timeRange.trigger("applied")},error:function(){that.disableApply()}});event.preventDefault()}}},generateLabel:function(){return"Custom Time"},enableApply:function(){this.$("#apply_"+this.cid).removeClass("disabled")},disableApply:function(){this.$("#apply_"+this.cid).addClass("disabled")},render:function(){var template=_.template(this.template,{cid:this.cid,time:this.model.workingRange.get("relative_earliest_value")||"",rangeMap:this.rangeMap,selectedRange:this.model.workingRange.get("relative_range_unit")||"mon",_:_});this.$el.html(template);this.children.flashMessages.render().prependTo(this.$el);this.children.rangeTypeSelect.render().insertAfter(this.$(".earliest_input"));this.model.latestTimeParser.isNew()&&this.fetchLatestTime();return this}})});define("contrib/text!views/shared/timerangepicker/dialog/RealTime.html",[],function(){return'<div class="form form-horizontal real-time-container">\n    <div class="control-group col-1">\n        <label class="control-label" for="earliest_<%- cid %>" title="<%- _("Earliest:").t() %>"><%- _("Earliest:").t() %></label>\n        <div class="controls">\n            <div class="input-append"><input type="text" size="5" value="<%- time %>" class="earliest_input timerangepicker-real-time-earliest-time" id="earliest_<%- cid %>"/></div>\n\n            <span id="hint_<%- cid %>" class="help-block help-block-timestamp"></span>\n        </div>\n    </div>\n    <div class="control-group col-2">\n        <label class="control-label" title="<%- _("Latest:").t() %>"><%- _("Latest:").t() %></label>\n        <div class="controls">\n            <span class="form-value uneditable-input">now</span>\n        </div>\n    </div>\n    <div class="col-3">\n        <button class="apply btn" id="apply_<%- cid %>"><%- _("Apply").t() %></button>\n    </div>\n\n</div>\n'});define("views/shared/timerangepicker/dialog/RealTime",["jquery","underscore","backbone","module","models/services/search/TimeParser","models/shared/TimeRange","views/Base","views/shared/controls/SyntheticSelectControl","views/shared/FlashMessages","util/time","splunk.i18n","contrib/text!views/shared/timerangepicker/dialog/RealTime.html"],function($,_,Backbone,module,TimeParserModel,TimeRangeModel,Base,SyntheticSelectControl,FlashMessages,time_utils,i18n,realTimeTemplate){return Base.extend({moduleId:module.id,className:"accordion-inner",template:realTimeTemplate,defaultRangeType:"s",initialize:function(){Base.prototype.initialize.apply(this,arguments);_.defaults(this.options,{appendSelectDropdownsTo:"body"});this.label=_("Real-time").t();this.model={timeRange:this.model,workingRange:new TimeRangeModel,earliestTimeParser:new TimeParserModel};this.syncInternals();this.children.rangeTypeSelect=new SyntheticSelectControl({model:this.model.workingRange,items:[{value:"s",label:_("Seconds Ago").t()},{value:"m",label:_("Minutes Ago").t()},{value:"h",label:_("Hours Ago").t()},{value:"d",label:_("Days Ago").t()},{value:"w",label:_("Weeks Ago").t()},{value:"mon",label:_("Months Ago").t()},{value:"q",label:_("Quarters Ago").t()},{value:"y",label:_("Years Ago").t()}],modelAttribute:"realtime_range_type",className:"btn-group timerangepicker-realtime_range_type",toggleClassName:"btn",menuWidth:"narrow",popdownOptions:{attachDialogTo:this.options.appendSelectDropdownsTo},save:!1});this.children.flashMessages=new FlashMessages({model:{workingRange:this.model.workingRange,earliestTimeParser:this.model.earliestTimeParser}});this.activate()},startListening:function(){this.listenTo(this.model.workingRange,"change:realtime_range_type change:realtime_earliest_value",_.debounce(function(){this.fetchEarliestTime()}.bind(this),0));this.listenTo(this.model.earliestTimeParser,"change",this.updateEarliestHint);this.listenTo(this.model.earliestTimeParser,"error",function(){this.$("#hint_"+this.cid).html(this.model.earliestTimeParser.error.get("messages")[0].message);this.disableApply()});this.listenTo(this.model.timeRange,"change:earliest change:latest prepopulate",_.debounce(this.prepopulate,0))},syncInternals:function(){this.model.workingRange.set($.extend(!0,{},this.model.timeRange.toJSON(),{realtime_range_type:this.defaultRangeType}));this.model.earliestTimeParser.set({key:time_utils.stripRTSafe(this.model.timeRange.get("earliest"),!1),value:this.model.timeRange.get("earliest_iso")})},activate:function(){if(this.active)return Base.prototype.activate.apply(this,arguments);this.syncInternals();return Base.prototype.activate.apply(this,arguments)},deactivate:function(){if(!this.active)return Base.prototype.deactivate.apply(this,arguments);Base.prototype.deactivate.apply(this,arguments);this.model.workingRange.fetchAbort();this.model.workingRange.clear({setDefaults:!0});this.model.earliestTimeParser.fetchAbort();this.model.earliestTimeParser.clear({setDefaults:!0});return this},updateEarliestHint:function(){var date=time_utils.isoToDateObject(this.model.earliestTimeParser.get("value"));this.$("#hint_"+this.cid).html(i18n.format_datetime_microseconds(time_utils.jsDateToSplunkDateTimeWithMicroseconds(date),"short","full"));this.enableApply()},prepopulate:function(){var earliestParse=this.model.timeRange.getTimeParse("earliest"),attrValues={};if(earliestParse){this.$(".earliest_input").val(earliestParse.amount);attrValues.realtime_earliest_value=earliestParse.amount;attrValues.realtime_range_type=earliestParse.unit;this.model.workingRange.set(attrValues)}},supportsRange:function(){var earliestParse=this.model.timeRange.getTimeParse("earliest"),latestParse=this.model.timeRange.getTimeParse("latest");return earliestParse?earliestParse.isRealTime&&earliestParse.amount&&!earliestParse.snapUnit&&latestParse.isRealTime&&latestParse.isNow&&!latestParse.snapUnit:!1},getEarliestTime:function(withoutRT){var amount=this.model.workingRange.get("realtime_earliest_value"),type=this.model.workingRange.get("realtime_range_type")||this.defaultRangeType;return amount?(withoutRT?"":"rt")+"-"+amount+type:null},fetchEarliestTime:function(){var time=this.getEarliestTime(!0),id=time_utils.stripRTSafe(this.model.earliestTimeParser.id,!1);if(time&&time!==id)this.model.earliestTimeParser.fetch({data:{time:time}});else if(this.model.earliestTimeParser.get("value"))this.updateEarliestHint();else{this.$("#hint_"+this.cid).html("");this.enableApply()}},events:{"keyup .earliest_input":function(){this.model.workingRange.set("realtime_earliest_value",this.$("#earliest_"+this.cid).val())},"click .apply":function(event){if($(event.currentTarget).hasClass("disabled"))event.preventDefault();else{var that=this,earliest=this.getEarliestTime();this.disableApply();this.model.workingRange.save({earliest:earliest,latest:"rtnow"},{success:function(model){that.enableApply();that.model.timeRange.set({earliest:earliest,latest:"rtnow",earliest_epoch:model.get("earliest_epoch"),latest_epoch:model.get("latest_epoch"),earliest_iso:model.get("earliest_iso"),latest_iso:model.get("latest_iso"),earliest_date:new Date(model.get("earliest_date").getTime()),latest_date:new Date(model.get("latest_date").getTime())});that.model.timeRange.trigger("applied")},error:function(){that.enableApply()}});event.preventDefault()}}},enableApply:function(){this.$("#apply_"+this.cid).removeClass("disabled")},disableApply:function(){this.$("#apply_"+this.cid).addClass("disabled")},render:function(){var template=_.template(this.template,{_:_,cid:this.cid,time:this.model.workingRange.get("realtime_earliest_value")||""});this.$el.html(template);this.children.flashMessages.render().prependTo(this.$el);this.children.rangeTypeSelect.render().insertAfter(this.$(".earliest_input"));return this}})});!function($,undefined){function focusable(element,isTabIndexNotNaN){var map,mapName,img,nodeName=element.nodeName.toLowerCase();if("area"===nodeName){map=element.parentNode;mapName=map.name;if(!element.href||!mapName||"map"!==map.nodeName.toLowerCase())return!1;img=$("img[usemap=#"+mapName+"]")[0];return!!img&&visible(img)}return(/input|select|textarea|button|object/.test(nodeName)?!element.disabled:"a"===nodeName?element.href||isTabIndexNotNaN:isTabIndexNotNaN)&&visible(element)}function visible(element){return $.expr.filters.visible(element)&&!$(element).parents().addBack().filter(function(){return"hidden"===$.css(this,"visibility")}).length}var uuid=0,runiqueId=/^ui-id-\d+$/;$.ui=$.ui||{};$.extend($.ui,{version:"1.10.3",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}});$.fn.extend({focus:function(orig){return function(delay,fn){return"number"==typeof delay?this.each(function(){var elem=this;setTimeout(function(){$(elem).focus();fn&&fn.call(elem)},delay)}):orig.apply(this,arguments)}}($.fn.focus),scrollParent:function(){var scrollParent;scrollParent=$.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test($.css(this,"position"))&&/(auto|scroll)/.test($.css(this,"overflow")+$.css(this,"overflow-y")+$.css(this,"overflow-x"))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test($.css(this,"overflow")+$.css(this,"overflow-y")+$.css(this,"overflow-x"))}).eq(0);return/fixed/.test(this.css("position"))||!scrollParent.length?$(document):scrollParent},zIndex:function(zIndex){if(zIndex!==undefined)return this.css("zIndex",zIndex);if(this.length)for(var position,value,elem=$(this[0]);elem.length&&elem[0]!==document;){position=elem.css("position");if("absolute"===position||"relative"===position||"fixed"===position){value=parseInt(elem.css("zIndex"),10);if(!isNaN(value)&&0!==value)return value}elem=elem.parent()}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++uuid)})},removeUniqueId:function(){return this.each(function(){runiqueId.test(this.id)&&$(this).removeAttr("id")})}});$.extend($.expr[":"],{data:$.expr.createPseudo?$.expr.createPseudo(function(dataName){return function(elem){return!!$.data(elem,dataName)}}):function(elem,i,match){return!!$.data(elem,match[3])},focusable:function(element){return focusable(element,!isNaN($.attr(element,"tabindex")))},tabbable:function(element){var tabIndex=$.attr(element,"tabindex"),isTabIndexNaN=isNaN(tabIndex);return(isTabIndexNaN||tabIndex>=0)&&focusable(element,!isTabIndexNaN)}});$("<a>").outerWidth(1).jquery||$.each(["Width","Height"],function(i,name){function reduce(elem,size,border,margin){$.each(side,function(){size-=parseFloat($.css(elem,"padding"+this))||0;border&&(size-=parseFloat($.css(elem,"border"+this+"Width"))||0);margin&&(size-=parseFloat($.css(elem,"margin"+this))||0)});return size}var side="Width"===name?["Left","Right"]:["Top","Bottom"],type=name.toLowerCase(),orig={innerWidth:$.fn.innerWidth,innerHeight:$.fn.innerHeight,outerWidth:$.fn.outerWidth,outerHeight:$.fn.outerHeight};$.fn["inner"+name]=function(size){return size===undefined?orig["inner"+name].call(this):this.each(function(){$(this).css(type,reduce(this,size)+"px")})};$.fn["outer"+name]=function(size,margin){return"number"!=typeof size?orig["outer"+name].call(this,size):this.each(function(){$(this).css(type,reduce(this,size,!0,margin)+"px")})}});$.fn.addBack||($.fn.addBack=function(selector){return this.add(null==selector?this.prevObject:this.prevObject.filter(selector))});$("<a>").data("a-b","a").removeData("a-b").data("a-b")&&($.fn.removeData=function(removeData){return function(key){return arguments.length?removeData.call(this,$.camelCase(key)):removeData.call(this)}}($.fn.removeData));$.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase());$.support.selectstart="onselectstart"in document.createElement("div");$.fn.extend({disableSelection:function(){return this.bind(($.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(event){event.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}});$.extend($.ui,{plugin:{add:function(module,option,set){var i,proto=$.ui[module].prototype;for(i in set){proto.plugins[i]=proto.plugins[i]||[];proto.plugins[i].push([option,set[i]])}},call:function(instance,name,args){var i,set=instance.plugins[name];if(set&&instance.element[0].parentNode&&11!==instance.element[0].parentNode.nodeType)for(i=0;i<set.length;i++)instance.options[set[i][0]]&&set[i][1].apply(instance.element,args)}},hasScroll:function(el,a){if("hidden"===$(el).css("overflow"))return!1;var scroll=a&&"left"===a?"scrollLeft":"scrollTop",has=!1;if(el[scroll]>0)return!0;el[scroll]=1;has=el[scroll]>0;el[scroll]=0;return has}})}(jQuery);define("jquery.ui.core",["jquery"],function(){});!function($,undefined){var uuid=0,slice=Array.prototype.slice,_cleanData=$.cleanData;$.cleanData=function(elems){for(var elem,i=0;null!=(elem=elems[i]);i++)try{$(elem).triggerHandler("remove")}catch(e){}_cleanData(elems)};$.widget=function(name,base,prototype){var fullName,existingConstructor,constructor,basePrototype,proxiedPrototype={},namespace=name.split(".")[0];name=name.split(".")[1];fullName=namespace+"-"+name;if(!prototype){prototype=base;base=$.Widget}$.expr[":"][fullName.toLowerCase()]=function(elem){return!!$.data(elem,fullName)};$[namespace]=$[namespace]||{};existingConstructor=$[namespace][name];constructor=$[namespace][name]=function(options,element){if(!this._createWidget)return new constructor(options,element);arguments.length&&this._createWidget(options,element);return void 0};$.extend(constructor,existingConstructor,{version:prototype.version,_proto:$.extend({},prototype),_childConstructors:[]});basePrototype=new base;basePrototype.options=$.widget.extend({},basePrototype.options);$.each(prototype,function(prop,value){proxiedPrototype[prop]=$.isFunction(value)?function(){var _super=function(){return base.prototype[prop].apply(this,arguments)},_superApply=function(args){return base.prototype[prop].apply(this,args)};return function(){var returnValue,__super=this._super,__superApply=this._superApply;this._super=_super;this._superApply=_superApply;returnValue=value.apply(this,arguments);this._super=__super;this._superApply=__superApply;return returnValue}}():value});constructor.prototype=$.widget.extend(basePrototype,{widgetEventPrefix:existingConstructor?basePrototype.widgetEventPrefix:name},proxiedPrototype,{constructor:constructor,namespace:namespace,widgetName:name,widgetFullName:fullName});if(existingConstructor){$.each(existingConstructor._childConstructors,function(i,child){var childPrototype=child.prototype;$.widget(childPrototype.namespace+"."+childPrototype.widgetName,constructor,child._proto)});delete existingConstructor._childConstructors}else base._childConstructors.push(constructor);$.widget.bridge(name,constructor)};$.widget.extend=function(target){for(var key,value,input=slice.call(arguments,1),inputIndex=0,inputLength=input.length;inputLength>inputIndex;inputIndex++)for(key in input[inputIndex]){value=input[inputIndex][key];input[inputIndex].hasOwnProperty(key)&&value!==undefined&&(target[key]=$.isPlainObject(value)?$.isPlainObject(target[key])?$.widget.extend({},target[key],value):$.widget.extend({},value):value)}return target};$.widget.bridge=function(name,object){var fullName=object.prototype.widgetFullName||name;$.fn[name]=function(options){var isMethodCall="string"==typeof options,args=slice.call(arguments,1),returnValue=this;options=!isMethodCall&&args.length?$.widget.extend.apply(null,[options].concat(args)):options;this.each(isMethodCall?function(){var methodValue,instance=$.data(this,fullName);if(!instance)return $.error("cannot call methods on "+name+" prior to initialization; attempted to call method '"+options+"'");if(!$.isFunction(instance[options])||"_"===options.charAt(0))return $.error("no such method '"+options+"' for "+name+" widget instance");methodValue=instance[options].apply(instance,args);if(methodValue!==instance&&methodValue!==undefined){returnValue=methodValue&&methodValue.jquery?returnValue.pushStack(methodValue.get()):methodValue;return!1}}:function(){var instance=$.data(this,fullName);instance?instance.option(options||{})._init():$.data(this,fullName,new object(options,this))});return returnValue}};$.Widget=function(){};$.Widget._childConstructors=[];$.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(options,element){element=$(element||this.defaultElement||this)[0];this.element=$(element);this.uuid=uuid++;this.eventNamespace="."+this.widgetName+this.uuid;this.options=$.widget.extend({},this.options,this._getCreateOptions(),options);this.bindings=$();this.hoverable=$();this.focusable=$();if(element!==this){$.data(element,this.widgetFullName,this);this._on(!0,this.element,{remove:function(event){event.target===element&&this.destroy()}});this.document=$(element.style?element.ownerDocument:element.document||element);this.window=$(this.document[0].defaultView||this.document[0].parentWindow)}this._create();this._trigger("create",null,this._getCreateEventData());this._init()},_getCreateOptions:$.noop,_getCreateEventData:$.noop,_create:$.noop,_init:$.noop,destroy:function(){this._destroy();this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData($.camelCase(this.widgetFullName));this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled");this.bindings.unbind(this.eventNamespace);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus")},_destroy:$.noop,widget:function(){return this.element},option:function(key,value){var parts,curOption,i,options=key;if(0===arguments.length)return $.widget.extend({},this.options);if("string"==typeof key){options={};parts=key.split(".");key=parts.shift();if(parts.length){curOption=options[key]=$.widget.extend({},this.options[key]);for(i=0;i<parts.length-1;i++){curOption[parts[i]]=curOption[parts[i]]||{};curOption=curOption[parts[i]]}key=parts.pop();if(value===undefined)return curOption[key]===undefined?null:curOption[key];curOption[key]=value}else{if(value===undefined)return this.options[key]===undefined?null:this.options[key];options[key]=value}}this._setOptions(options);return this},_setOptions:function(options){var key;for(key in options)this._setOption(key,options[key]);return this},_setOption:function(key,value){this.options[key]=value;if("disabled"===key){this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!value).attr("aria-disabled",value);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus")}return this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(suppressDisabledCheck,element,handlers){var delegateElement,instance=this;if("boolean"!=typeof suppressDisabledCheck){handlers=element;element=suppressDisabledCheck;suppressDisabledCheck=!1}if(handlers){element=delegateElement=$(element);this.bindings=this.bindings.add(element)}else{handlers=element;element=this.element;delegateElement=this.widget()}$.each(handlers,function(event,handler){function handlerProxy(){return suppressDisabledCheck||instance.options.disabled!==!0&&!$(this).hasClass("ui-state-disabled")?("string"==typeof handler?instance[handler]:handler).apply(instance,arguments):void 0}"string"!=typeof handler&&(handlerProxy.guid=handler.guid=handler.guid||handlerProxy.guid||$.guid++);var match=event.match(/^(\w+)\s*(.*)$/),eventName=match[1]+instance.eventNamespace,selector=match[2];selector?delegateElement.delegate(selector,eventName,handlerProxy):element.bind(eventName,handlerProxy)})},_off:function(element,eventName){eventName=(eventName||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace;element.unbind(eventName).undelegate(eventName)},_delay:function(handler,delay){function handlerProxy(){return("string"==typeof handler?instance[handler]:handler).apply(instance,arguments)}var instance=this;return setTimeout(handlerProxy,delay||0)},_hoverable:function(element){this.hoverable=this.hoverable.add(element);this._on(element,{mouseenter:function(event){$(event.currentTarget).addClass("ui-state-hover")},mouseleave:function(event){$(event.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(element){this.focusable=this.focusable.add(element);this._on(element,{focusin:function(event){$(event.currentTarget).addClass("ui-state-focus")},focusout:function(event){$(event.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(type,event,data){var prop,orig,callback=this.options[type];data=data||{};event=$.Event(event);event.type=(type===this.widgetEventPrefix?type:this.widgetEventPrefix+type).toLowerCase();event.target=this.element[0];orig=event.originalEvent;if(orig)for(prop in orig)prop in event||(event[prop]=orig[prop]);this.element.trigger(event,data);return!($.isFunction(callback)&&callback.apply(this.element[0],[event].concat(data))===!1||event.isDefaultPrevented())}};$.each({show:"fadeIn",hide:"fadeOut"},function(method,defaultEffect){$.Widget.prototype["_"+method]=function(element,options,callback){"string"==typeof options&&(options={effect:options});var hasOptions,effectName=options?options===!0||"number"==typeof options?defaultEffect:options.effect||defaultEffect:method;options=options||{};"number"==typeof options&&(options={duration:options});hasOptions=!$.isEmptyObject(options);options.complete=callback;options.delay&&element.delay(options.delay);hasOptions&&$.effects&&$.effects.effect[effectName]?element[method](options):effectName!==method&&element[effectName]?element[effectName](options.duration,options.easing,callback):element.queue(function(next){$(this)[method]();callback&&callback.call(element[0]);next()})}})}(jQuery);define("jquery.ui.widget",["jquery.ui.core"],function(){});!function($,undefined){function Datepicker(){this._curInst=null;this._keyEvent=!1;this._disabledInputs=[];this._datepickerShowing=!1;this._inDialog=!1;this._mainDivId="ui-datepicker-div";this._inlineClass="ui-datepicker-inline";this._appendClass="ui-datepicker-append";this._triggerClass="ui-datepicker-trigger";this._dialogClass="ui-datepicker-dialog";this._disableClass="ui-datepicker-disabled";this._unselectableClass="ui-datepicker-unselectable";this._currentClass="ui-datepicker-current-day";this._dayOverClass="ui-datepicker-days-cell-over";this.regional=[];this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""};this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1};$.extend(this._defaults,this.regional[""]);this.dpDiv=bindHover($("<div id='"+this._mainDivId+"' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"))}function bindHover(dpDiv){var selector="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return dpDiv.delegate(selector,"mouseout",function(){$(this).removeClass("ui-state-hover");-1!==this.className.indexOf("ui-datepicker-prev")&&$(this).removeClass("ui-datepicker-prev-hover");-1!==this.className.indexOf("ui-datepicker-next")&&$(this).removeClass("ui-datepicker-next-hover")}).delegate(selector,"mouseover",function(){if(!$.datepicker._isDisabledDatepicker(instActive.inline?dpDiv.parent()[0]:instActive.input[0])){$(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover");$(this).addClass("ui-state-hover");-1!==this.className.indexOf("ui-datepicker-prev")&&$(this).addClass("ui-datepicker-prev-hover");-1!==this.className.indexOf("ui-datepicker-next")&&$(this).addClass("ui-datepicker-next-hover")}})}function extendRemove(target,props){$.extend(target,props);for(var name in props)null==props[name]&&(target[name]=props[name]);return target}$.extend($.ui,{datepicker:{version:"1.10.3"}});var instActive,PROP_NAME="datepicker";$.extend(Datepicker.prototype,{markerClassName:"hasDatepicker",maxRows:4,_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(settings){extendRemove(this._defaults,settings||{});return this},_attachDatepicker:function(target,settings){var nodeName,inline,inst;nodeName=target.nodeName.toLowerCase();inline="div"===nodeName||"span"===nodeName;if(!target.id){this.uuid+=1;target.id="dp"+this.uuid}inst=this._newInst($(target),inline);inst.settings=$.extend({},settings||{});"input"===nodeName?this._connectDatepicker(target,inst):inline&&this._inlineDatepicker(target,inst)},_newInst:function(target,inline){var id=target[0].id.replace(/([^A-Za-z0-9_\-])/g,"\\\\$1");return{id:id,input:target,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:inline,dpDiv:inline?bindHover($("<div class='"+this._inlineClass+" ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")):this.dpDiv}},_connectDatepicker:function(target,inst){var input=$(target);inst.append=$([]);inst.trigger=$([]);if(!input.hasClass(this.markerClassName)){this._attachments(input,inst);input.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp);this._autoSize(inst);$.data(target,PROP_NAME,inst);inst.settings.disabled&&this._disableDatepicker(target)}},_attachments:function(input,inst){var showOn,buttonText,buttonImage,appendText=this._get(inst,"appendText"),isRTL=this._get(inst,"isRTL");inst.append&&inst.append.remove();if(appendText){inst.append=$("<span class='"+this._appendClass+"'>"+appendText+"</span>");input[isRTL?"before":"after"](inst.append)}input.unbind("focus",this._showDatepicker);inst.trigger&&inst.trigger.remove();showOn=this._get(inst,"showOn");("focus"===showOn||"both"===showOn)&&input.focus(this._showDatepicker);if("button"===showOn||"both"===showOn){buttonText=this._get(inst,"buttonText");buttonImage=this._get(inst,"buttonImage");inst.trigger=$(this._get(inst,"buttonImageOnly")?$("<img/>").addClass(this._triggerClass).attr({src:buttonImage,alt:buttonText,title:buttonText}):$("<button type='button'></button>").addClass(this._triggerClass).html(buttonImage?$("<img/>").attr({src:buttonImage,alt:buttonText,title:buttonText}):buttonText));input[isRTL?"before":"after"](inst.trigger);inst.trigger.click(function(){if($.datepicker._datepickerShowing&&$.datepicker._lastInput===input[0])$.datepicker._hideDatepicker();else if($.datepicker._datepickerShowing&&$.datepicker._lastInput!==input[0]){$.datepicker._hideDatepicker();$.datepicker._showDatepicker(input[0])}else $.datepicker._showDatepicker(input[0]);return!1})}},_autoSize:function(inst){if(this._get(inst,"autoSize")&&!inst.inline){var findMax,max,maxI,i,date=new Date(2009,11,20),dateFormat=this._get(inst,"dateFormat");if(dateFormat.match(/[DM]/)){findMax=function(names){max=0;maxI=0;for(i=0;i<names.length;i++)if(names[i].length>max){max=names[i].length;maxI=i}return maxI};date.setMonth(findMax(this._get(inst,dateFormat.match(/MM/)?"monthNames":"monthNamesShort")));date.setDate(findMax(this._get(inst,dateFormat.match(/DD/)?"dayNames":"dayNamesShort"))+20-date.getDay())}inst.input.attr("size",this._formatDate(inst,date).length)}},_inlineDatepicker:function(target,inst){var divSpan=$(target);if(!divSpan.hasClass(this.markerClassName)){divSpan.addClass(this.markerClassName).append(inst.dpDiv);$.data(target,PROP_NAME,inst);this._setDate(inst,this._getDefaultDate(inst),!0);this._updateDatepicker(inst);this._updateAlternate(inst);inst.settings.disabled&&this._disableDatepicker(target);inst.dpDiv.css("display","block")}},_dialogDatepicker:function(input,date,onSelect,settings,pos){var id,browserWidth,browserHeight,scrollX,scrollY,inst=this._dialogInst;if(!inst){this.uuid+=1;id="dp"+this.uuid;this._dialogInput=$("<input type='text' id='"+id+"' style='position: absolute; top: -100px; width: 0px;'/>");this._dialogInput.keydown(this._doKeyDown);$("body").append(this._dialogInput);inst=this._dialogInst=this._newInst(this._dialogInput,!1);inst.settings={};$.data(this._dialogInput[0],PROP_NAME,inst)
}extendRemove(inst.settings,settings||{});date=date&&date.constructor===Date?this._formatDate(inst,date):date;this._dialogInput.val(date);this._pos=pos?pos.length?pos:[pos.pageX,pos.pageY]:null;if(!this._pos){browserWidth=document.documentElement.clientWidth;browserHeight=document.documentElement.clientHeight;scrollX=document.documentElement.scrollLeft||document.body.scrollLeft;scrollY=document.documentElement.scrollTop||document.body.scrollTop;this._pos=[browserWidth/2-100+scrollX,browserHeight/2-150+scrollY]}this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px");inst.settings.onSelect=onSelect;this._inDialog=!0;this.dpDiv.addClass(this._dialogClass);this._showDatepicker(this._dialogInput[0]);$.blockUI&&$.blockUI(this.dpDiv);$.data(this._dialogInput[0],PROP_NAME,inst);return this},_destroyDatepicker:function(target){var nodeName,$target=$(target),inst=$.data(target,PROP_NAME);if($target.hasClass(this.markerClassName)){nodeName=target.nodeName.toLowerCase();$.removeData(target,PROP_NAME);if("input"===nodeName){inst.append.remove();inst.trigger.remove();$target.removeClass(this.markerClassName).unbind("focus",this._showDatepicker).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress).unbind("keyup",this._doKeyUp)}else("div"===nodeName||"span"===nodeName)&&$target.removeClass(this.markerClassName).empty()}},_enableDatepicker:function(target){var nodeName,inline,$target=$(target),inst=$.data(target,PROP_NAME);if($target.hasClass(this.markerClassName)){nodeName=target.nodeName.toLowerCase();if("input"===nodeName){target.disabled=!1;inst.trigger.filter("button").each(function(){this.disabled=!1}).end().filter("img").css({opacity:"1.0",cursor:""})}else if("div"===nodeName||"span"===nodeName){inline=$target.children("."+this._inlineClass);inline.children().removeClass("ui-state-disabled");inline.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!1)}this._disabledInputs=$.map(this._disabledInputs,function(value){return value===target?null:value})}},_disableDatepicker:function(target){var nodeName,inline,$target=$(target),inst=$.data(target,PROP_NAME);if($target.hasClass(this.markerClassName)){nodeName=target.nodeName.toLowerCase();if("input"===nodeName){target.disabled=!0;inst.trigger.filter("button").each(function(){this.disabled=!0}).end().filter("img").css({opacity:"0.5",cursor:"default"})}else if("div"===nodeName||"span"===nodeName){inline=$target.children("."+this._inlineClass);inline.children().addClass("ui-state-disabled");inline.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!0)}this._disabledInputs=$.map(this._disabledInputs,function(value){return value===target?null:value});this._disabledInputs[this._disabledInputs.length]=target}},_isDisabledDatepicker:function(target){if(!target)return!1;for(var i=0;i<this._disabledInputs.length;i++)if(this._disabledInputs[i]===target)return!0;return!1},_getInst:function(target){try{return $.data(target,PROP_NAME)}catch(err){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(target,name,value){var settings,date,minDate,maxDate,inst=this._getInst(target);if(2===arguments.length&&"string"==typeof name)return"defaults"===name?$.extend({},$.datepicker._defaults):inst?"all"===name?$.extend({},inst.settings):this._get(inst,name):null;settings=name||{};if("string"==typeof name){settings={};settings[name]=value}if(inst){this._curInst===inst&&this._hideDatepicker();date=this._getDateDatepicker(target,!0);minDate=this._getMinMaxDate(inst,"min");maxDate=this._getMinMaxDate(inst,"max");extendRemove(inst.settings,settings);null!==minDate&&settings.dateFormat!==undefined&&settings.minDate===undefined&&(inst.settings.minDate=this._formatDate(inst,minDate));null!==maxDate&&settings.dateFormat!==undefined&&settings.maxDate===undefined&&(inst.settings.maxDate=this._formatDate(inst,maxDate));"disabled"in settings&&(settings.disabled?this._disableDatepicker(target):this._enableDatepicker(target));this._attachments($(target),inst);this._autoSize(inst);this._setDate(inst,date);this._updateAlternate(inst);this._updateDatepicker(inst)}},_changeDatepicker:function(target,name,value){this._optionDatepicker(target,name,value)},_refreshDatepicker:function(target){var inst=this._getInst(target);inst&&this._updateDatepicker(inst)},_setDateDatepicker:function(target,date){var inst=this._getInst(target);if(inst){this._setDate(inst,date);this._updateDatepicker(inst);this._updateAlternate(inst)}},_getDateDatepicker:function(target,noDefault){var inst=this._getInst(target);inst&&!inst.inline&&this._setDateFromField(inst,noDefault);return inst?this._getDate(inst):null},_doKeyDown:function(event){var onSelect,dateStr,sel,inst=$.datepicker._getInst(event.target),handled=!0,isRTL=inst.dpDiv.is(".ui-datepicker-rtl");inst._keyEvent=!0;if($.datepicker._datepickerShowing)switch(event.keyCode){case 9:$.datepicker._hideDatepicker();handled=!1;break;case 13:sel=$("td."+$.datepicker._dayOverClass+":not(."+$.datepicker._currentClass+")",inst.dpDiv);sel[0]&&$.datepicker._selectDay(event.target,inst.selectedMonth,inst.selectedYear,sel[0]);onSelect=$.datepicker._get(inst,"onSelect");if(onSelect){dateStr=$.datepicker._formatDate(inst);onSelect.apply(inst.input?inst.input[0]:null,[dateStr,inst])}else $.datepicker._hideDatepicker();return!1;case 27:$.datepicker._hideDatepicker();break;case 33:$.datepicker._adjustDate(event.target,event.ctrlKey?-$.datepicker._get(inst,"stepBigMonths"):-$.datepicker._get(inst,"stepMonths"),"M");break;case 34:$.datepicker._adjustDate(event.target,event.ctrlKey?+$.datepicker._get(inst,"stepBigMonths"):+$.datepicker._get(inst,"stepMonths"),"M");break;case 35:(event.ctrlKey||event.metaKey)&&$.datepicker._clearDate(event.target);handled=event.ctrlKey||event.metaKey;break;case 36:(event.ctrlKey||event.metaKey)&&$.datepicker._gotoToday(event.target);handled=event.ctrlKey||event.metaKey;break;case 37:(event.ctrlKey||event.metaKey)&&$.datepicker._adjustDate(event.target,isRTL?1:-1,"D");handled=event.ctrlKey||event.metaKey;event.originalEvent.altKey&&$.datepicker._adjustDate(event.target,event.ctrlKey?-$.datepicker._get(inst,"stepBigMonths"):-$.datepicker._get(inst,"stepMonths"),"M");break;case 38:(event.ctrlKey||event.metaKey)&&$.datepicker._adjustDate(event.target,-7,"D");handled=event.ctrlKey||event.metaKey;break;case 39:(event.ctrlKey||event.metaKey)&&$.datepicker._adjustDate(event.target,isRTL?-1:1,"D");handled=event.ctrlKey||event.metaKey;event.originalEvent.altKey&&$.datepicker._adjustDate(event.target,event.ctrlKey?+$.datepicker._get(inst,"stepBigMonths"):+$.datepicker._get(inst,"stepMonths"),"M");break;case 40:(event.ctrlKey||event.metaKey)&&$.datepicker._adjustDate(event.target,7,"D");handled=event.ctrlKey||event.metaKey;break;default:handled=!1}else 36===event.keyCode&&event.ctrlKey?$.datepicker._showDatepicker(this):handled=!1;if(handled){event.preventDefault();event.stopPropagation()}},_doKeyPress:function(event){var chars,chr,inst=$.datepicker._getInst(event.target);if($.datepicker._get(inst,"constrainInput")){chars=$.datepicker._possibleChars($.datepicker._get(inst,"dateFormat"));chr=String.fromCharCode(null==event.charCode?event.keyCode:event.charCode);return event.ctrlKey||event.metaKey||" ">chr||!chars||chars.indexOf(chr)>-1}},_doKeyUp:function(event){var date,inst=$.datepicker._getInst(event.target);if(inst.input.val()!==inst.lastVal)try{date=$.datepicker.parseDate($.datepicker._get(inst,"dateFormat"),inst.input?inst.input.val():null,$.datepicker._getFormatConfig(inst));if(date){$.datepicker._setDateFromField(inst);$.datepicker._updateAlternate(inst);$.datepicker._updateDatepicker(inst)}}catch(err){}return!0},_showDatepicker:function(input){input=input.target||input;"input"!==input.nodeName.toLowerCase()&&(input=$("input",input.parentNode)[0]);if(!$.datepicker._isDisabledDatepicker(input)&&$.datepicker._lastInput!==input){var inst,beforeShow,beforeShowSettings,isFixed,offset,showAnim,duration;inst=$.datepicker._getInst(input);if($.datepicker._curInst&&$.datepicker._curInst!==inst){$.datepicker._curInst.dpDiv.stop(!0,!0);inst&&$.datepicker._datepickerShowing&&$.datepicker._hideDatepicker($.datepicker._curInst.input[0])}beforeShow=$.datepicker._get(inst,"beforeShow");beforeShowSettings=beforeShow?beforeShow.apply(input,[input,inst]):{};if(beforeShowSettings!==!1){extendRemove(inst.settings,beforeShowSettings);inst.lastVal=null;$.datepicker._lastInput=input;$.datepicker._setDateFromField(inst);$.datepicker._inDialog&&(input.value="");if(!$.datepicker._pos){$.datepicker._pos=$.datepicker._findPos(input);$.datepicker._pos[1]+=input.offsetHeight}isFixed=!1;$(input).parents().each(function(){isFixed|="fixed"===$(this).css("position");return!isFixed});offset={left:$.datepicker._pos[0],top:$.datepicker._pos[1]};$.datepicker._pos=null;inst.dpDiv.empty();inst.dpDiv.css({position:"absolute",display:"block",top:"-1000px"});$.datepicker._updateDatepicker(inst);offset=$.datepicker._checkOffset(inst,offset,isFixed);inst.dpDiv.css({position:$.datepicker._inDialog&&$.blockUI?"static":isFixed?"fixed":"absolute",display:"none",left:offset.left+"px",top:offset.top+"px"});if(!inst.inline){showAnim=$.datepicker._get(inst,"showAnim");duration=$.datepicker._get(inst,"duration");inst.dpDiv.zIndex($(input).zIndex()+1);$.datepicker._datepickerShowing=!0;$.effects&&$.effects.effect[showAnim]?inst.dpDiv.show(showAnim,$.datepicker._get(inst,"showOptions"),duration):inst.dpDiv[showAnim||"show"](showAnim?duration:null);$.datepicker._shouldFocusInput(inst)&&inst.input.focus();$.datepicker._curInst=inst}}}},_updateDatepicker:function(inst){this.maxRows=4;instActive=inst;inst.dpDiv.empty().append(this._generateHTML(inst));this._attachHandlers(inst);inst.dpDiv.find("."+this._dayOverClass+" a").mouseover();var origyearshtml,numMonths=this._getNumberOfMonths(inst),cols=numMonths[1],width=17;inst.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width("");cols>1&&inst.dpDiv.addClass("ui-datepicker-multi-"+cols).css("width",width*cols+"em");inst.dpDiv[(1!==numMonths[0]||1!==numMonths[1]?"add":"remove")+"Class"]("ui-datepicker-multi");inst.dpDiv[(this._get(inst,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl");inst===$.datepicker._curInst&&$.datepicker._datepickerShowing&&$.datepicker._shouldFocusInput(inst)&&inst.input.focus();if(inst.yearshtml){origyearshtml=inst.yearshtml;setTimeout(function(){origyearshtml===inst.yearshtml&&inst.yearshtml&&inst.dpDiv.find("select.ui-datepicker-year:first").replaceWith(inst.yearshtml);origyearshtml=inst.yearshtml=null},0)}},_shouldFocusInput:function(inst){return inst.input&&inst.input.is(":visible")&&!inst.input.is(":disabled")&&!inst.input.is(":focus")},_checkOffset:function(inst,offset,isFixed){var dpWidth=inst.dpDiv.outerWidth(),dpHeight=inst.dpDiv.outerHeight(),inputWidth=inst.input?inst.input.outerWidth():0,inputHeight=inst.input?inst.input.outerHeight():0,viewWidth=document.documentElement.clientWidth+(isFixed?0:$(document).scrollLeft()),viewHeight=document.documentElement.clientHeight+(isFixed?0:$(document).scrollTop());offset.left-=this._get(inst,"isRTL")?dpWidth-inputWidth:0;offset.left-=isFixed&&offset.left===inst.input.offset().left?$(document).scrollLeft():0;offset.top-=isFixed&&offset.top===inst.input.offset().top+inputHeight?$(document).scrollTop():0;offset.left-=Math.min(offset.left,offset.left+dpWidth>viewWidth&&viewWidth>dpWidth?Math.abs(offset.left+dpWidth-viewWidth):0);offset.top-=Math.min(offset.top,offset.top+dpHeight>viewHeight&&viewHeight>dpHeight?Math.abs(dpHeight+inputHeight):0);return offset},_findPos:function(obj){for(var position,inst=this._getInst(obj),isRTL=this._get(inst,"isRTL");obj&&("hidden"===obj.type||1!==obj.nodeType||$.expr.filters.hidden(obj));)obj=obj[isRTL?"previousSibling":"nextSibling"];position=$(obj).offset();return[position.left,position.top]},_hideDatepicker:function(input){var showAnim,duration,postProcess,onClose,inst=this._curInst;if(inst&&(!input||inst===$.data(input,PROP_NAME))&&this._datepickerShowing){showAnim=this._get(inst,"showAnim");duration=this._get(inst,"duration");postProcess=function(){$.datepicker._tidyDialog(inst)};$.effects&&($.effects.effect[showAnim]||$.effects[showAnim])?inst.dpDiv.hide(showAnim,$.datepicker._get(inst,"showOptions"),duration,postProcess):inst.dpDiv["slideDown"===showAnim?"slideUp":"fadeIn"===showAnim?"fadeOut":"hide"](showAnim?duration:null,postProcess);showAnim||postProcess();this._datepickerShowing=!1;onClose=this._get(inst,"onClose");onClose&&onClose.apply(inst.input?inst.input[0]:null,[inst.input?inst.input.val():"",inst]);this._lastInput=null;if(this._inDialog){this._dialogInput.css({position:"absolute",left:"0",top:"-100px"});if($.blockUI){$.unblockUI();$("body").append(this.dpDiv)}}this._inDialog=!1}},_tidyDialog:function(inst){inst.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar")},_checkExternalClick:function(event){if($.datepicker._curInst){var $target=$(event.target),inst=$.datepicker._getInst($target[0]);($target[0].id!==$.datepicker._mainDivId&&0===$target.parents("#"+$.datepicker._mainDivId).length&&!$target.hasClass($.datepicker.markerClassName)&&!$target.closest("."+$.datepicker._triggerClass).length&&$.datepicker._datepickerShowing&&(!$.datepicker._inDialog||!$.blockUI)||$target.hasClass($.datepicker.markerClassName)&&$.datepicker._curInst!==inst)&&$.datepicker._hideDatepicker()}},_adjustDate:function(id,offset,period){var target=$(id),inst=this._getInst(target[0]);if(!this._isDisabledDatepicker(target[0])){this._adjustInstDate(inst,offset+("M"===period?this._get(inst,"showCurrentAtPos"):0),period);this._updateDatepicker(inst)}},_gotoToday:function(id){var date,target=$(id),inst=this._getInst(target[0]);if(this._get(inst,"gotoCurrent")&&inst.currentDay){inst.selectedDay=inst.currentDay;inst.drawMonth=inst.selectedMonth=inst.currentMonth;inst.drawYear=inst.selectedYear=inst.currentYear}else{date=new Date;inst.selectedDay=date.getDate();inst.drawMonth=inst.selectedMonth=date.getMonth();inst.drawYear=inst.selectedYear=date.getFullYear()}this._notifyChange(inst);this._adjustDate(target)},_selectMonthYear:function(id,select,period){var target=$(id),inst=this._getInst(target[0]);inst["selected"+("M"===period?"Month":"Year")]=inst["draw"+("M"===period?"Month":"Year")]=parseInt(select.options[select.selectedIndex].value,10);this._notifyChange(inst);this._adjustDate(target)},_selectDay:function(id,month,year,td){var inst,target=$(id);if(!$(td).hasClass(this._unselectableClass)&&!this._isDisabledDatepicker(target[0])){inst=this._getInst(target[0]);inst.selectedDay=inst.currentDay=$("a",td).html();inst.selectedMonth=inst.currentMonth=month;inst.selectedYear=inst.currentYear=year;this._selectDate(id,this._formatDate(inst,inst.currentDay,inst.currentMonth,inst.currentYear))}},_clearDate:function(id){var target=$(id);this._selectDate(target,"")},_selectDate:function(id,dateStr){var onSelect,target=$(id),inst=this._getInst(target[0]);dateStr=null!=dateStr?dateStr:this._formatDate(inst);inst.input&&inst.input.val(dateStr);this._updateAlternate(inst);onSelect=this._get(inst,"onSelect");onSelect?onSelect.apply(inst.input?inst.input[0]:null,[dateStr,inst]):inst.input&&inst.input.trigger("change");if(inst.inline)this._updateDatepicker(inst);else{this._hideDatepicker();this._lastInput=inst.input[0];"object"!=typeof inst.input[0]&&inst.input.focus();this._lastInput=null}},_updateAlternate:function(inst){var altFormat,date,dateStr,altField=this._get(inst,"altField");if(altField){altFormat=this._get(inst,"altFormat")||this._get(inst,"dateFormat");date=this._getDate(inst);dateStr=this.formatDate(altFormat,date,this._getFormatConfig(inst));$(altField).each(function(){$(this).val(dateStr)})}},noWeekends:function(date){var day=date.getDay();return[day>0&&6>day,""]},iso8601Week:function(date){var time,checkDate=new Date(date.getTime());checkDate.setDate(checkDate.getDate()+4-(checkDate.getDay()||7));time=checkDate.getTime();checkDate.setMonth(0);checkDate.setDate(1);return Math.floor(Math.round((time-checkDate)/864e5)/7)+1},parseDate:function(format,value,settings){if(null==format||null==value)throw"Invalid arguments";value="object"==typeof value?value.toString():value+"";if(""===value)return null;var iFormat,dim,extra,date,iValue=0,shortYearCutoffTemp=(settings?settings.shortYearCutoff:null)||this._defaults.shortYearCutoff,shortYearCutoff="string"!=typeof shortYearCutoffTemp?shortYearCutoffTemp:(new Date).getFullYear()%100+parseInt(shortYearCutoffTemp,10),dayNamesShort=(settings?settings.dayNamesShort:null)||this._defaults.dayNamesShort,dayNames=(settings?settings.dayNames:null)||this._defaults.dayNames,monthNamesShort=(settings?settings.monthNamesShort:null)||this._defaults.monthNamesShort,monthNames=(settings?settings.monthNames:null)||this._defaults.monthNames,year=-1,month=-1,day=-1,doy=-1,literal=!1,lookAhead=function(match){var matches=iFormat+1<format.length&&format.charAt(iFormat+1)===match;matches&&iFormat++;return matches},getNumber=function(match){var isDoubled=lookAhead(match),size="@"===match?14:"!"===match?20:"y"===match&&isDoubled?4:"o"===match?3:2,digits=new RegExp("^\\d{1,"+size+"}"),num=value.substring(iValue).match(digits);if(!num)throw"Missing number at position "+iValue;iValue+=num[0].length;return parseInt(num[0],10)},getName=function(match,shortNames,longNames){var index=-1,names=$.map(lookAhead(match)?longNames:shortNames,function(v,k){return[[k,v]]}).sort(function(a,b){return-(a[1].length-b[1].length)});$.each(names,function(i,pair){var name=pair[1];if(value.substr(iValue,name.length).toLowerCase()===name.toLowerCase()){index=pair[0];iValue+=name.length;return!1}});if(-1!==index)return index+1;throw"Unknown name at position "+iValue},checkLiteral=function(){if(value.charAt(iValue)!==format.charAt(iFormat))throw"Unexpected literal at position "+iValue;iValue++};for(iFormat=0;iFormat<format.length;iFormat++)if(literal)"'"!==format.charAt(iFormat)||lookAhead("'")?checkLiteral():literal=!1;else switch(format.charAt(iFormat)){case"d":day=getNumber("d");break;case"D":getName("D",dayNamesShort,dayNames);break;case"o":doy=getNumber("o");break;case"m":month=getNumber("m");break;case"M":month=getName("M",monthNamesShort,monthNames);break;case"y":year=getNumber("y");break;case"@":date=new Date(getNumber("@"));year=date.getFullYear();month=date.getMonth()+1;day=date.getDate();break;case"!":date=new Date((getNumber("!")-this._ticksTo1970)/1e4);year=date.getFullYear();month=date.getMonth()+1;day=date.getDate();break;case"'":lookAhead("'")?checkLiteral():literal=!0;break;default:checkLiteral()}if(iValue<value.length){extra=value.substr(iValue);if(!/^\s+/.test(extra))throw"Extra/unparsed characters found in date: "+extra}-1===year?year=(new Date).getFullYear():100>year&&(year+=(new Date).getFullYear()-(new Date).getFullYear()%100+(shortYearCutoff>=year?0:-100));if(doy>-1){month=1;day=doy;for(;;){dim=this._getDaysInMonth(year,month-1);if(dim>=day)break;month++;day-=dim}}date=this._daylightSavingAdjust(new Date(year,month-1,day));if(date.getFullYear()!==year||date.getMonth()+1!==month||date.getDate()!==day)throw"Invalid date";return date},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:24*(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925))*60*60*1e7,formatDate:function(format,date,settings){if(!date)return"";var iFormat,dayNamesShort=(settings?settings.dayNamesShort:null)||this._defaults.dayNamesShort,dayNames=(settings?settings.dayNames:null)||this._defaults.dayNames,monthNamesShort=(settings?settings.monthNamesShort:null)||this._defaults.monthNamesShort,monthNames=(settings?settings.monthNames:null)||this._defaults.monthNames,lookAhead=function(match){var matches=iFormat+1<format.length&&format.charAt(iFormat+1)===match;matches&&iFormat++;return matches},formatNumber=function(match,value,len){var num=""+value;if(lookAhead(match))for(;num.length<len;)num="0"+num;return num},formatName=function(match,value,shortNames,longNames){return lookAhead(match)?longNames[value]:shortNames[value]},output="",literal=!1;if(date)for(iFormat=0;iFormat<format.length;iFormat++)if(literal)"'"!==format.charAt(iFormat)||lookAhead("'")?output+=format.charAt(iFormat):literal=!1;else switch(format.charAt(iFormat)){case"d":output+=formatNumber("d",date.getDate(),2);break;case"D":output+=formatName("D",date.getDay(),dayNamesShort,dayNames);break;case"o":output+=formatNumber("o",Math.round((new Date(date.getFullYear(),date.getMonth(),date.getDate()).getTime()-new Date(date.getFullYear(),0,0).getTime())/864e5),3);break;case"m":output+=formatNumber("m",date.getMonth()+1,2);break;case"M":output+=formatName("M",date.getMonth(),monthNamesShort,monthNames);break;case"y":output+=lookAhead("y")?date.getFullYear():(date.getYear()%100<10?"0":"")+date.getYear()%100;break;case"@":output+=date.getTime();break;case"!":output+=1e4*date.getTime()+this._ticksTo1970;break;case"'":lookAhead("'")?output+="'":literal=!0;break;default:output+=format.charAt(iFormat)}return output},_possibleChars:function(format){var iFormat,chars="",literal=!1,lookAhead=function(match){var matches=iFormat+1<format.length&&format.charAt(iFormat+1)===match;matches&&iFormat++;return matches};for(iFormat=0;iFormat<format.length;iFormat++)if(literal)"'"!==format.charAt(iFormat)||lookAhead("'")?chars+=format.charAt(iFormat):literal=!1;else switch(format.charAt(iFormat)){case"d":case"m":case"y":case"@":chars+="0123456789";break;case"D":case"M":return null;case"'":lookAhead("'")?chars+="'":literal=!0;break;default:chars+=format.charAt(iFormat)}return chars},_get:function(inst,name){return inst.settings[name]!==undefined?inst.settings[name]:this._defaults[name]},_setDateFromField:function(inst,noDefault){if(inst.input.val()!==inst.lastVal){var dateFormat=this._get(inst,"dateFormat"),dates=inst.lastVal=inst.input?inst.input.val():null,defaultDate=this._getDefaultDate(inst),date=defaultDate,settings=this._getFormatConfig(inst);try{date=this.parseDate(dateFormat,dates,settings)||defaultDate}catch(event){dates=noDefault?"":dates}inst.selectedDay=date.getDate();inst.drawMonth=inst.selectedMonth=date.getMonth();inst.drawYear=inst.selectedYear=date.getFullYear();inst.currentDay=dates?date.getDate():0;inst.currentMonth=dates?date.getMonth():0;inst.currentYear=dates?date.getFullYear():0;this._adjustInstDate(inst)}},_getDefaultDate:function(inst){return this._restrictMinMax(inst,this._determineDate(inst,this._get(inst,"defaultDate"),new Date))},_determineDate:function(inst,date,defaultDate){var offsetNumeric=function(offset){var date=new Date;date.setDate(date.getDate()+offset);return date},offsetString=function(offset){try{return $.datepicker.parseDate($.datepicker._get(inst,"dateFormat"),offset,$.datepicker._getFormatConfig(inst))}catch(e){}for(var date=(offset.toLowerCase().match(/^c/)?$.datepicker._getDate(inst):null)||new Date,year=date.getFullYear(),month=date.getMonth(),day=date.getDate(),pattern=/([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,matches=pattern.exec(offset);matches;){switch(matches[2]||"d"){case"d":case"D":day+=parseInt(matches[1],10);break;case"w":case"W":day+=7*parseInt(matches[1],10);break;case"m":case"M":month+=parseInt(matches[1],10);day=Math.min(day,$.datepicker._getDaysInMonth(year,month));break;case"y":case"Y":year+=parseInt(matches[1],10);day=Math.min(day,$.datepicker._getDaysInMonth(year,month))}matches=pattern.exec(offset)}return new Date(year,month,day)},newDate=null==date||""===date?defaultDate:"string"==typeof date?offsetString(date):"number"==typeof date?isNaN(date)?defaultDate:offsetNumeric(date):new Date(date.getTime());newDate=newDate&&"Invalid Date"===newDate.toString()?defaultDate:newDate;if(newDate){newDate.setHours(0);newDate.setMinutes(0);newDate.setSeconds(0);newDate.setMilliseconds(0)}return this._daylightSavingAdjust(newDate)},_daylightSavingAdjust:function(date){if(!date)return null;date.setHours(date.getHours()>12?date.getHours()+2:0);return date},_setDate:function(inst,date,noChange){var clear=!date,origMonth=inst.selectedMonth,origYear=inst.selectedYear,newDate=this._restrictMinMax(inst,this._determineDate(inst,date,new Date));inst.selectedDay=inst.currentDay=newDate.getDate();inst.drawMonth=inst.selectedMonth=inst.currentMonth=newDate.getMonth();inst.drawYear=inst.selectedYear=inst.currentYear=newDate.getFullYear();origMonth===inst.selectedMonth&&origYear===inst.selectedYear||noChange||this._notifyChange(inst);this._adjustInstDate(inst);inst.input&&inst.input.val(clear?"":this._formatDate(inst))},_getDate:function(inst){var startDate=!inst.currentYear||inst.input&&""===inst.input.val()?null:this._daylightSavingAdjust(new Date(inst.currentYear,inst.currentMonth,inst.currentDay));return startDate},_attachHandlers:function(inst){var stepMonths=this._get(inst,"stepMonths"),id="#"+inst.id.replace(/\\\\/g,"\\");inst.dpDiv.find("[data-handler]").map(function(){var handler={prev:function(){$.datepicker._adjustDate(id,-stepMonths,"M")},next:function(){$.datepicker._adjustDate(id,+stepMonths,"M")},hide:function(){$.datepicker._hideDatepicker()},today:function(){$.datepicker._gotoToday(id)},selectDay:function(){$.datepicker._selectDay(id,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this);return!1},selectMonth:function(){$.datepicker._selectMonthYear(id,this,"M");return!1},selectYear:function(){$.datepicker._selectMonthYear(id,this,"Y");return!1}};$(this).bind(this.getAttribute("data-event"),handler[this.getAttribute("data-handler")])})},_generateHTML:function(inst){var maxDraw,prevText,prev,nextText,next,currentText,gotoDate,controls,buttonPanel,firstDay,showWeek,dayNames,dayNamesMin,monthNames,monthNamesShort,beforeShowDay,showOtherMonths,selectOtherMonths,defaultDate,html,dow,row,group,col,selectedDate,cornerClass,calender,thead,day,daysInMonth,leadDays,curRows,numRows,printDate,dRow,tbody,daySettings,otherMonth,unselectable,tempDate=new Date,today=this._daylightSavingAdjust(new Date(tempDate.getFullYear(),tempDate.getMonth(),tempDate.getDate())),isRTL=this._get(inst,"isRTL"),showButtonPanel=this._get(inst,"showButtonPanel"),hideIfNoPrevNext=this._get(inst,"hideIfNoPrevNext"),navigationAsDateFormat=this._get(inst,"navigationAsDateFormat"),numMonths=this._getNumberOfMonths(inst),showCurrentAtPos=this._get(inst,"showCurrentAtPos"),stepMonths=this._get(inst,"stepMonths"),isMultiMonth=1!==numMonths[0]||1!==numMonths[1],currentDate=this._daylightSavingAdjust(inst.currentDay?new Date(inst.currentYear,inst.currentMonth,inst.currentDay):new Date(9999,9,9)),minDate=this._getMinMaxDate(inst,"min"),maxDate=this._getMinMaxDate(inst,"max"),drawMonth=inst.drawMonth-showCurrentAtPos,drawYear=inst.drawYear;if(0>drawMonth){drawMonth+=12;drawYear--}if(maxDate){maxDraw=this._daylightSavingAdjust(new Date(maxDate.getFullYear(),maxDate.getMonth()-numMonths[0]*numMonths[1]+1,maxDate.getDate()));maxDraw=minDate&&minDate>maxDraw?minDate:maxDraw;for(;this._daylightSavingAdjust(new Date(drawYear,drawMonth,1))>maxDraw;){drawMonth--;if(0>drawMonth){drawMonth=11;drawYear--}}}inst.drawMonth=drawMonth;inst.drawYear=drawYear;prevText=this._get(inst,"prevText");prevText=navigationAsDateFormat?this.formatDate(prevText,this._daylightSavingAdjust(new Date(drawYear,drawMonth-stepMonths,1)),this._getFormatConfig(inst)):prevText;prev=this._canAdjustMonth(inst,-1,drawYear,drawMonth)?"<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click' title='"+prevText+"'><span class='ui-icon ui-icon-circle-triangle-"+(isRTL?"e":"w")+"'>"+prevText+"</span></a>":hideIfNoPrevNext?"":"<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='"+prevText+"'><span class='ui-icon ui-icon-circle-triangle-"+(isRTL?"e":"w")+"'>"+prevText+"</span></a>";nextText=this._get(inst,"nextText");nextText=navigationAsDateFormat?this.formatDate(nextText,this._daylightSavingAdjust(new Date(drawYear,drawMonth+stepMonths,1)),this._getFormatConfig(inst)):nextText;next=this._canAdjustMonth(inst,1,drawYear,drawMonth)?"<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click' title='"+nextText+"'><span class='ui-icon ui-icon-circle-triangle-"+(isRTL?"w":"e")+"'>"+nextText+"</span></a>":hideIfNoPrevNext?"":"<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='"+nextText+"'><span class='ui-icon ui-icon-circle-triangle-"+(isRTL?"w":"e")+"'>"+nextText+"</span></a>";currentText=this._get(inst,"currentText");gotoDate=this._get(inst,"gotoCurrent")&&inst.currentDay?currentDate:today;currentText=navigationAsDateFormat?this.formatDate(currentText,gotoDate,this._getFormatConfig(inst)):currentText;controls=inst.inline?"":"<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>"+this._get(inst,"closeText")+"</button>";buttonPanel=showButtonPanel?"<div class='ui-datepicker-buttonpane ui-widget-content'>"+(isRTL?controls:"")+(this._isInRange(inst,gotoDate)?"<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'>"+currentText+"</button>":"")+(isRTL?"":controls)+"</div>":"";firstDay=parseInt(this._get(inst,"firstDay"),10);firstDay=isNaN(firstDay)?0:firstDay;showWeek=this._get(inst,"showWeek");dayNames=this._get(inst,"dayNames");dayNamesMin=this._get(inst,"dayNamesMin");monthNames=this._get(inst,"monthNames");monthNamesShort=this._get(inst,"monthNamesShort");beforeShowDay=this._get(inst,"beforeShowDay");showOtherMonths=this._get(inst,"showOtherMonths");selectOtherMonths=this._get(inst,"selectOtherMonths");defaultDate=this._getDefaultDate(inst);html="";for(row=0;row<numMonths[0];row++){group="";this.maxRows=4;for(col=0;col<numMonths[1];col++){selectedDate=this._daylightSavingAdjust(new Date(drawYear,drawMonth,inst.selectedDay));cornerClass=" ui-corner-all";calender="";if(isMultiMonth){calender+="<div class='ui-datepicker-group";if(numMonths[1]>1)switch(col){case 0:calender+=" ui-datepicker-group-first";cornerClass=" ui-corner-"+(isRTL?"right":"left");break;case numMonths[1]-1:calender+=" ui-datepicker-group-last";cornerClass=" ui-corner-"+(isRTL?"left":"right");break;default:calender+=" ui-datepicker-group-middle";cornerClass=""}calender+="'>"}calender+="<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix"+cornerClass+"'>"+(/all|left/.test(cornerClass)&&0===row?isRTL?next:prev:"")+(/all|right/.test(cornerClass)&&0===row?isRTL?prev:next:"")+this._generateMonthYearHeader(inst,drawMonth,drawYear,minDate,maxDate,row>0||col>0,monthNames,monthNamesShort)+"</div><table class='ui-datepicker-calendar'><thead><tr>";thead=showWeek?"<th class='ui-datepicker-week-col'>"+this._get(inst,"weekHeader")+"</th>":"";for(dow=0;7>dow;dow++){day=(dow+firstDay)%7;thead+="<th"+((dow+firstDay+6)%7>=5?" class='ui-datepicker-week-end'":"")+"><span title='"+dayNames[day]+"'>"+dayNamesMin[day]+"</span></th>"}calender+=thead+"</tr></thead><tbody>";daysInMonth=this._getDaysInMonth(drawYear,drawMonth);drawYear===inst.selectedYear&&drawMonth===inst.selectedMonth&&(inst.selectedDay=Math.min(inst.selectedDay,daysInMonth));leadDays=(this._getFirstDayOfMonth(drawYear,drawMonth)-firstDay+7)%7;curRows=Math.ceil((leadDays+daysInMonth)/7);numRows=isMultiMonth?this.maxRows>curRows?this.maxRows:curRows:curRows;this.maxRows=numRows;printDate=this._daylightSavingAdjust(new Date(drawYear,drawMonth,1-leadDays));for(dRow=0;numRows>dRow;dRow++){calender+="<tr>";tbody=showWeek?"<td class='ui-datepicker-week-col'>"+this._get(inst,"calculateWeek")(printDate)+"</td>":"";for(dow=0;7>dow;dow++){daySettings=beforeShowDay?beforeShowDay.apply(inst.input?inst.input[0]:null,[printDate]):[!0,""];otherMonth=printDate.getMonth()!==drawMonth;unselectable=otherMonth&&!selectOtherMonths||!daySettings[0]||minDate&&minDate>printDate||maxDate&&printDate>maxDate;
tbody+="<td class='"+((dow+firstDay+6)%7>=5?" ui-datepicker-week-end":"")+(otherMonth?" ui-datepicker-other-month":"")+(printDate.getTime()===selectedDate.getTime()&&drawMonth===inst.selectedMonth&&inst._keyEvent||defaultDate.getTime()===printDate.getTime()&&defaultDate.getTime()===selectedDate.getTime()?" "+this._dayOverClass:"")+(unselectable?" "+this._unselectableClass+" ui-state-disabled":"")+(otherMonth&&!showOtherMonths?"":" "+daySettings[1]+(printDate.getTime()===currentDate.getTime()?" "+this._currentClass:"")+(printDate.getTime()===today.getTime()?" ui-datepicker-today":""))+"'"+(otherMonth&&!showOtherMonths||!daySettings[2]?"":" title='"+daySettings[2].replace(/'/g,"&#39;")+"'")+(unselectable?"":" data-handler='selectDay' data-event='click' data-month='"+printDate.getMonth()+"' data-year='"+printDate.getFullYear()+"'")+">"+(otherMonth&&!showOtherMonths?"&#xa0;":unselectable?"<span class='ui-state-default'>"+printDate.getDate()+"</span>":"<a class='ui-state-default"+(printDate.getTime()===today.getTime()?" ui-state-highlight":"")+(printDate.getTime()===currentDate.getTime()?" ui-state-active":"")+(otherMonth?" ui-priority-secondary":"")+"' href='#'>"+printDate.getDate()+"</a>")+"</td>";printDate.setDate(printDate.getDate()+1);printDate=this._daylightSavingAdjust(printDate)}calender+=tbody+"</tr>"}drawMonth++;if(drawMonth>11){drawMonth=0;drawYear++}calender+="</tbody></table>"+(isMultiMonth?"</div>"+(numMonths[0]>0&&col===numMonths[1]-1?"<div class='ui-datepicker-row-break'></div>":""):"");group+=calender}html+=group}html+=buttonPanel;inst._keyEvent=!1;return html},_generateMonthYearHeader:function(inst,drawMonth,drawYear,minDate,maxDate,secondary,monthNames,monthNamesShort){var inMinYear,inMaxYear,month,years,thisYear,determineYear,year,endYear,changeMonth=this._get(inst,"changeMonth"),changeYear=this._get(inst,"changeYear"),showMonthAfterYear=this._get(inst,"showMonthAfterYear"),html="<div class='ui-datepicker-title'>",monthHtml="";if(secondary||!changeMonth)monthHtml+="<span class='ui-datepicker-month'>"+monthNames[drawMonth]+"</span>";else{inMinYear=minDate&&minDate.getFullYear()===drawYear;inMaxYear=maxDate&&maxDate.getFullYear()===drawYear;monthHtml+="<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>";for(month=0;12>month;month++)(!inMinYear||month>=minDate.getMonth())&&(!inMaxYear||month<=maxDate.getMonth())&&(monthHtml+="<option value='"+month+"'"+(month===drawMonth?" selected='selected'":"")+">"+monthNamesShort[month]+"</option>");monthHtml+="</select>"}showMonthAfterYear||(html+=monthHtml+(!secondary&&changeMonth&&changeYear?"":"&#xa0;"));if(!inst.yearshtml){inst.yearshtml="";if(secondary||!changeYear)html+="<span class='ui-datepicker-year'>"+drawYear+"</span>";else{years=this._get(inst,"yearRange").split(":");thisYear=(new Date).getFullYear();determineYear=function(value){var year=value.match(/c[+\-].*/)?drawYear+parseInt(value.substring(1),10):value.match(/[+\-].*/)?thisYear+parseInt(value,10):parseInt(value,10);return isNaN(year)?thisYear:year};year=determineYear(years[0]);endYear=Math.max(year,determineYear(years[1]||""));year=minDate?Math.max(year,minDate.getFullYear()):year;endYear=maxDate?Math.min(endYear,maxDate.getFullYear()):endYear;inst.yearshtml+="<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>";for(;endYear>=year;year++)inst.yearshtml+="<option value='"+year+"'"+(year===drawYear?" selected='selected'":"")+">"+year+"</option>";inst.yearshtml+="</select>";html+=inst.yearshtml;inst.yearshtml=null}}html+=this._get(inst,"yearSuffix");showMonthAfterYear&&(html+=(!secondary&&changeMonth&&changeYear?"":"&#xa0;")+monthHtml);html+="</div>";return html},_adjustInstDate:function(inst,offset,period){var year=inst.drawYear+("Y"===period?offset:0),month=inst.drawMonth+("M"===period?offset:0),day=Math.min(inst.selectedDay,this._getDaysInMonth(year,month))+("D"===period?offset:0),date=this._restrictMinMax(inst,this._daylightSavingAdjust(new Date(year,month,day)));inst.selectedDay=date.getDate();inst.drawMonth=inst.selectedMonth=date.getMonth();inst.drawYear=inst.selectedYear=date.getFullYear();("M"===period||"Y"===period)&&this._notifyChange(inst)},_restrictMinMax:function(inst,date){var minDate=this._getMinMaxDate(inst,"min"),maxDate=this._getMinMaxDate(inst,"max"),newDate=minDate&&minDate>date?minDate:date;return maxDate&&newDate>maxDate?maxDate:newDate},_notifyChange:function(inst){var onChange=this._get(inst,"onChangeMonthYear");onChange&&onChange.apply(inst.input?inst.input[0]:null,[inst.selectedYear,inst.selectedMonth+1,inst])},_getNumberOfMonths:function(inst){var numMonths=this._get(inst,"numberOfMonths");return null==numMonths?[1,1]:"number"==typeof numMonths?[1,numMonths]:numMonths},_getMinMaxDate:function(inst,minMax){return this._determineDate(inst,this._get(inst,minMax+"Date"),null)},_getDaysInMonth:function(year,month){return 32-this._daylightSavingAdjust(new Date(year,month,32)).getDate()},_getFirstDayOfMonth:function(year,month){return new Date(year,month,1).getDay()},_canAdjustMonth:function(inst,offset,curYear,curMonth){var numMonths=this._getNumberOfMonths(inst),date=this._daylightSavingAdjust(new Date(curYear,curMonth+(0>offset?offset:numMonths[0]*numMonths[1]),1));0>offset&&date.setDate(this._getDaysInMonth(date.getFullYear(),date.getMonth()));return this._isInRange(inst,date)},_isInRange:function(inst,date){var yearSplit,currentYear,minDate=this._getMinMaxDate(inst,"min"),maxDate=this._getMinMaxDate(inst,"max"),minYear=null,maxYear=null,years=this._get(inst,"yearRange");if(years){yearSplit=years.split(":");currentYear=(new Date).getFullYear();minYear=parseInt(yearSplit[0],10);maxYear=parseInt(yearSplit[1],10);yearSplit[0].match(/[+\-].*/)&&(minYear+=currentYear);yearSplit[1].match(/[+\-].*/)&&(maxYear+=currentYear)}return(!minDate||date.getTime()>=minDate.getTime())&&(!maxDate||date.getTime()<=maxDate.getTime())&&(!minYear||date.getFullYear()>=minYear)&&(!maxYear||date.getFullYear()<=maxYear)},_getFormatConfig:function(inst){var shortYearCutoff=this._get(inst,"shortYearCutoff");shortYearCutoff="string"!=typeof shortYearCutoff?shortYearCutoff:(new Date).getFullYear()%100+parseInt(shortYearCutoff,10);return{shortYearCutoff:shortYearCutoff,dayNamesShort:this._get(inst,"dayNamesShort"),dayNames:this._get(inst,"dayNames"),monthNamesShort:this._get(inst,"monthNamesShort"),monthNames:this._get(inst,"monthNames")}},_formatDate:function(inst,day,month,year){if(!day){inst.currentDay=inst.selectedDay;inst.currentMonth=inst.selectedMonth;inst.currentYear=inst.selectedYear}var date=day?"object"==typeof day?day:this._daylightSavingAdjust(new Date(year,month,day)):this._daylightSavingAdjust(new Date(inst.currentYear,inst.currentMonth,inst.currentDay));return this.formatDate(this._get(inst,"dateFormat"),date,this._getFormatConfig(inst))}});$.fn.datepicker=function(options){if(!this.length)return this;if(!$.datepicker.initialized){$(document).mousedown($.datepicker._checkExternalClick);$.datepicker.initialized=!0}0===$("#"+$.datepicker._mainDivId).length&&$("body").append($.datepicker.dpDiv);var otherArgs=Array.prototype.slice.call(arguments,1);return"string"!=typeof options||"isDisabled"!==options&&"getDate"!==options&&"widget"!==options?"option"===options&&2===arguments.length&&"string"==typeof arguments[1]?$.datepicker["_"+options+"Datepicker"].apply($.datepicker,[this[0]].concat(otherArgs)):this.each(function(){"string"==typeof options?$.datepicker["_"+options+"Datepicker"].apply($.datepicker,[this].concat(otherArgs)):$.datepicker._attachDatepicker(this,options)}):$.datepicker["_"+options+"Datepicker"].apply($.datepicker,[this[0]].concat(otherArgs))};$.datepicker=new Datepicker;$.datepicker.initialized=!1;$.datepicker.uuid=(new Date).getTime();$.datepicker.version="1.10.3"}(jQuery);define("jquery.ui.datepicker",["jquery","jquery.ui.widget","splunk.i18n"],function(global){return function(){var ret,fn;fn=function(jQuery,widget,i18n){var initFn=i18n.jQuery_ui_datepicker_install;"function"==typeof initFn&&initFn(jQuery);return jQuery.ui.datepicker};ret=fn.apply(global,arguments);return ret||global.jquery.ui.datepicker}}(this));define("models/shared/DateInput",["jquery","underscore","models/Base","jquery.ui.datepicker","strftime"],function($,_,BaseModel){var ISO_WITH_TZ_REGEX=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})\.(\d+)/,DateTime=BaseModel.extend({initialize:function(){BaseModel.prototype.initialize.apply(this,arguments)},defaults:function(){var now=new Date;return this.convertDateToAttrsObject(now)},validation:{year:{required:!0,range:[1e3,9999],pattern:"digits",msg:_("Year must be a 4 digit number.").t()},month:{required:!0,range:[0,11],pattern:"digits",msg:_("Month must be a number between 0 and 11.").t()},day:{required:!0,range:[1,31],pattern:"digits",msg:_("Day must be a number between 1 and 31.").t()},hour:[{required:!0,range:[0,24],pattern:"digits",msg:_("Hour must be a number between 0 and 24.").t()},{fn:"validateFullTime"}],minute:[{required:!0,range:[0,59],pattern:"digits",msg:_("Minute must be a number between 0 and 59.").t()},{fn:"validateFullTime"}],second:[{required:!0,range:[0,59],pattern:"digits",msg:_("Second must be a number between 0 and 59.").t()},{fn:"validateFullTime"}],millisecond:[{required:!0,range:[0,999],pattern:"digits",msg:_("Millisecond must be a number between 0 and 999.").t()},{fn:"validateFullTime"}]},validateFullTime:function(value,attr,computedState){return 24===computedState.hour&&("minute"===attr||"second"===attr||"millisecond"===attr)&&value>0?_("You cannot set the time greater than 24:00:00.000.").t():void 0},setHoursMinSecFromStr:function(time,options){var error_msg,error_object,timeArray=time.split(":");if(3==timeArray.length){var secondsArray=timeArray[2].split(".");if(2==secondsArray.length)return this.set({hour:parseInt(timeArray[0],10),minute:parseInt(timeArray[1],10),second:parseInt(secondsArray[0],10),millisecond:parseInt(secondsArray[1],10)},options);error_msg=_("Could not parse the time stamp given into second and millisecond.").t()}else error_msg=_("Could not parse the time stamp given into hour, minute, second, and millisecond.").t();error_object={second:error_msg};this.trigger("validated",!1,this,error_object);this.trigger("validated:invalid",this,error_object);return!1},setMonDayYearFromJSDate:function(jsDate,options){return this.set({year:jsDate.getFullYear(),month:jsDate.getMonth(),day:jsDate.getDate(),hour:0,minute:0,second:0,millisecond:0},options)},setFromJSDate:function(jsDate,options){return this.set(this.convertDateToAttrsObject(jsDate),options)},jsDate:function(){var year=this.get("year"),month=this.get("month"),day=this.get("day"),hour=this.get("hour"),minute=this.get("minute"),second=this.get("second"),millisecond=this.get("millisecond");if(!(!this.isValid(!0)||_.isUndefined(year)||_.isUndefined(month)||_.isUndefined(day)||_.isUndefined(hour)||_.isUndefined(minute)||_.isUndefined(second)||_.isUndefined(millisecond)))return new Date(year,month,day,hour,minute,second,millisecond);throw"You have an invalid DateTime object for creating a JSDate."},strftime:function(formatString){return this.jsDate().strftime(formatString)},isoWithoutTZ:function(){return this.strftime("%Y-%m-%dT%H:%M:%S.%Q")},time:function(){return this.strftime("%H:%M:%S.%Q")},dateFormat:function(){return $.datepicker._defaults["dateFormat"]},formattedDate:function(){return $.datepicker.formatDate(this.dateFormat(),this.jsDate())},convertDateToAttrsObject:function(jsDate){return{year:jsDate.getFullYear(),month:jsDate.getMonth(),day:jsDate.getDate(),hour:jsDate.getHours(),minute:jsDate.getMinutes(),second:jsDate.getSeconds(),millisecond:jsDate.getMilliseconds()}}},{createFromIsoString:function(isoString){var pieces=ISO_WITH_TZ_REGEX.exec(isoString);if(!pieces||8!==pieces.length)throw"Invalid ISO string: "+isoString;var dtModel=new DateTime({year:parseInt(pieces[1],10),month:parseInt(pieces[2],10)-1,day:parseInt(pieces[3],10),hour:parseInt(pieces[4],10),minute:parseInt(pieces[5],10),second:parseInt(pieces[6],10),millisecond:parseInt(pieces[7],10)});if(!dtModel.isValid(!0))throw"Invalid time encoded: "+isoString;return dtModel}});return DateTime});define("views/shared/controls/DateControl",["jquery","underscore","backbone","module","views/shared/controls/Control","jquery.ui.datepicker"],function($,_,Backbone,module,Control){return Control.extend({moduleId:module.id,tagName:"span",className:"pull-left",initialize:function(){var defaults={inputClassName:"",help:"MM/DD/YYYY"};_.defaults(this.options,defaults);Control.prototype.initialize.call(this,this.options)},startListening:function(){Control.prototype.startListening.apply(this,arguments);this.listenTo(this.model,"change",this.render)},activate:function(options){options=options||{};if(this.active)return Control.prototype.activate.apply(this,arguments);options.skipSetValueRender||this.render();return Control.prototype.activate.apply(this,arguments)},events:{"change input[type=text]":function(){this.setValue(this.$("input").datepicker("getDate"),!1)}},updateModel:function(){var updateOptions={validate:this.options.validate,forceUpdate:this.options.forceUpdate};return this.model?this.model.setMonDayYearFromJSDate(this._value,updateOptions):!0},render:function(){if(!this.el.innerHTML){var template=_.template(this.template,{options:this.options});this.$el.html(template);this.$("input").datepicker({defaultDate:this.model.jsDate()});var additionalClassNames=this.options.additionalClassNames;additionalClassNames&&this.$el.addClass(additionalClassNames)}var inputDate=this.$("input").datepicker("getDate"),modelDate=this.model.jsDate();inputDate&&inputDate.getTime()===modelDate.getTime()||this.$("input").datepicker("setDate",modelDate);this.$("input").blur();return this},template:'            <input type="text" size="8" class="<%= options.inputClassName %>" value=""/>        '})});define("views/shared/timerangepicker/dialog/daterange/BetweenDates",["jquery","underscore","backbone","module","models/shared/DateInput","models/shared/TimeRange","views/Base","views/shared/controls/DateControl","views/shared/FlashMessages"],function($,_,Backbone,module,DateInputModel,TimeRangeModel,Base,DateControl,FlashMessages){return Base.extend({moduleId:module.id,initialize:function(){Base.prototype.initialize.apply(this,arguments);this.model={timeRange:this.model,workingRange:new TimeRangeModel,earliestDateInput:new DateInputModel,latestDateInput:new DateInputModel};this.syncInternals();this.children.earliestTimeInput=new DateControl({model:this.model.earliestDateInput,inputClassName:"timerangepicker-earliest-date",validate:!0});this.children.latestTimeInput=new DateControl({model:this.model.latestDateInput,inputClassName:"timerangepicker-latest-date",validate:!0});this.children.flashMessages=new FlashMessages({model:{workingRange:this.model.workingRange,earliestDateInput:this.model.earliestDateInput,latestDateInput:this.model.latestDateInput}});this.activate()},startListening:function(){this.listenTo(this.model.timeRange,"change:earliest_date change:latest_date prepopulate",_.debounce(this.prepopulate,0));this.listenTo(this.model.earliestDateInput,"validated:invalid",this.disableApply);this.listenTo(this.model.earliestDateInput,"validated:valid",this.enableApply);this.listenTo(this.model.earliestDateInput,"change",function(){this.model.workingRange.trigger("validated",!0,this.model.workingRange,{});this.model.workingRange.trigger("serverValidated",!0,this.model.workingRange,[])});this.listenTo(this.model.latestDateInput,"validated:invalid",this.disableApply);this.listenTo(this.model.latestDateInput,"validated:valid",this.enableApply);this.listenTo(this.model.latestDateInput,"change",function(){this.model.workingRange.trigger("validated",!0,this.model.workingRange,{});this.model.workingRange.trigger("serverValidated",!0,this.model.workingRange,[])})},syncInternals:function(){this.yesterday=new Date;this.yesterday.setDate(this.yesterday.getDate()-1);this.yesterday.setHours(0,0,0,0);this.model.earliestDateInput.setFromJSDate(this.yesterday,{silent:!0});this.today=new Date;this.today.setHours(0,0,0,0);this.model.latestDateInput.setFromJSDate(this.today,{silent:!0})},activate:function(){if(this.active)return Base.prototype.activate.apply(this,arguments);this.syncInternals();return Base.prototype.activate.apply(this,arguments)},deactivate:function(){if(!this.active)return Base.prototype.deactivate.apply(this,arguments);Base.prototype.deactivate.apply(this,arguments);this.model.workingRange.fetchAbort();this.model.workingRange.clear({setDefaults:!0});this.model.earliestDateInput.clear({setDefaults:!0});this.model.latestDateInput.clear({setDefaults:!0});return this},prepopulate:function(){var earliest=this.model.timeRange.get("earliest_date"),latest=this.model.timeRange.get("latest_date");!this.model.timeRange.hasNoEarliest()&&earliest&&this.model.earliestDateInput.setFromJSDate(earliest,{validate:!0});if(latest){var latestDate=new Date(latest.getTime());0==latestDate.getHours()&&latestDate.setDate(latestDate.getDate()-1,{validate:!0});this.model.latestDateInput.setFromJSDate(latestDate,{validate:!0})}},events:{"click .apply":function(event){if($(event.currentTarget).hasClass("disabled"))event.preventDefault();else{this.model.earliestDateInput.setHoursMinSecFromStr("00:00:00.000",{silent:!0,validate:!0});this.model.latestDateInput.setHoursMinSecFromStr("24:00:00.000",{silent:!0,validate:!0});var that=this,earliestIsoWithoutTZ=this.model.earliestDateInput.isoWithoutTZ(),latestIsoWithoutTZ=this.model.latestDateInput.isoWithoutTZ();this.disableApply();this.model.workingRange.save({earliest:earliestIsoWithoutTZ,latest:latestIsoWithoutTZ},{success:function(model){that.enableApply();that.model.timeRange.set({earliest:model.get("earliest_epoch"),latest:model.get("latest_epoch"),earliest_epoch:model.get("earliest_epoch"),latest_epoch:model.get("latest_epoch"),earliest_iso:model.get("earliest_iso"),latest_iso:model.get("latest_iso"),earliest_date:new Date(model.get("earliest_date").getTime()),latest_date:new Date(model.get("latest_date").getTime())});that.model.timeRange.trigger("applied")},error:function(){that.enableApply()}});event.preventDefault()}}},generateLabel:function(){var earliest=this.model.earliestDateInput.jsDate(),latest=this.model.latestDateInput.jsDate();latest.setDate(latest.getDate()-1);return earliest.toDateString().slice(4,-5)+" - "+latest.toDateString().slice(4,-5)},enableApply:function(){this.$("#apply_"+this.cid).removeClass("disabled")},disableApply:function(){this.$("#apply_"+this.cid).addClass("disabled")},render:function(){var template=_.template(this.template,{_:_,cid:this.cid});this.$el.html(template);this.children.flashMessages.render().appendTo(this.$(".flash_messages"));this.children.earliestTimeInput.render().prependTo(this.$(".earliest-date"));this.children.latestTimeInput.render().prependTo(this.$(".latest-date"));return this},template:'            <div class="time-between-dates">                <div class="flash_messages"></div>                <div class="earliest-date col-1">                    <span class="help-block"><%- _("00:00:00").t() %></span>                </div>                <label class="control-label"><%- _("and").t() %></label>                <div class="latest-date col-2">                    <span class="help-block"><%- _("24:00:00").t() %></span>                </div>                <div class="col-3">                    <button class="apply btn" id="apply_<%- cid %>"><%- _("Apply").t() %></button>                </div>            </div>            '})});define("views/shared/timerangepicker/dialog/daterange/BeforeDate",["jquery","underscore","backbone","module","models/shared/DateInput","models/shared/TimeRange","views/Base","views/shared/controls/DateControl","views/shared/FlashMessages"],function($,_,Backbone,module,DateInputModel,TimeRangeModel,Base,DateControl,FlashMessages){return Base.extend({moduleId:module.id,initialize:function(){Base.prototype.initialize.apply(this,arguments);this.model={timeRange:this.model,workingRange:new TimeRangeModel,latestDateInput:new DateInputModel};this.syncInternals();this.children.latestTimeInput=new DateControl({model:this.model.latestDateInput,validate:!0});this.children.flashMessages=new FlashMessages({model:{workingRange:this.model.workingRange,latestDateInput:this.model.latestDateInput}});this.activate()},startListening:function(){this.listenTo(this.model.timeRange,"change:latest_date prepopulate",_.debounce(this.prepopulate,0));this.listenTo(this.model.latestDateInput,"validated:invalid",this.disableApply);this.listenTo(this.model.latestDateInput,"validated:valid",this.enableApply);this.listenTo(this.model.latestDateInput,"change",function(){this.model.workingRange.trigger("validated",!0,this.model.workingRange,{});this.model.workingRange.trigger("serverValidated",!0,this.model.workingRange,[])})},syncInternals:function(){this.today=new Date;this.today.setHours(0,0,0,0);this.model.latestDateInput.setFromJSDate(this.today,{silent:!0})},activate:function(){if(this.active)return Base.prototype.activate.apply(this,arguments);this.syncInternals();return Base.prototype.activate.apply(this,arguments)},deactivate:function(){if(!this.active)return Base.prototype.deactivate.apply(this,arguments);Base.prototype.deactivate.apply(this,arguments);this.model.workingRange.fetchAbort();this.model.workingRange.clear({setDefaults:!0});this.model.latestDateInput.clear({setDefaults:!0});return this},prepopulate:function(){var latest=this.model.timeRange.get("latest_date");if(latest){this.model.latestDateInput.setFromJSDate(latest,{validate:!0});this.model.latestDateInput.setHoursMinSecFromStr("00:00:00.000",{silent:!0})}},events:{"click .apply":function(event){if($(event.currentTarget).hasClass("disabled"))event.preventDefault();else{this.model.latestDateInput.setHoursMinSecFromStr("00:00:00.000",{silent:!0,validate:!0});var that=this,latestIsoWithoutTZ=this.model.latestDateInput.isoWithoutTZ();this.disableApply();this.model.workingRange.save({earliest:"",latest:latestIsoWithoutTZ},{success:function(model){that.enableApply();that.model.timeRange.set({earliest:"",latest:model.get("latest_epoch"),earliest_epoch:model.get("earliest_epoch"),latest_epoch:model.get("latest_epoch"),earliest_iso:model.get("earliest_iso"),latest_iso:model.get("latest_iso"),earliest_date:new Date(0),latest_date:new Date(model.get("latest_date").getTime())});that.model.timeRange.trigger("applied")},error:function(){that.enableApply()}});event.preventDefault()}}},enableApply:function(){this.$("#apply_"+this.cid).removeClass("disabled")},disableApply:function(){this.$("#apply_"+this.cid).addClass("disabled")},render:function(){var template=_.template(this.template,{_:_,cid:this.cid});this.$el.html(template);this.children.flashMessages.render().appendTo(this.$(".flash_messages"));this.children.latestTimeInput.render().prependTo(this.$(".latest_time"));return this},template:'                <div class="time-before-date">                    <div class="flash_messages"></div>                    <div class="latest_time col-1">                        <span class="help-block"><%- _("00:00:00").t() %></span>                    </div>                    <div class="col-2">                        <button class="apply btn" id="apply_<%- cid %>"><%- _("Apply").t() %></button>                    </div>                </div>            '})});define("views/shared/timerangepicker/dialog/daterange/AfterDate",["jquery","underscore","backbone","module","models/shared/DateInput","models/shared/TimeRange","views/Base","views/shared/controls/DateControl","views/shared/FlashMessages"],function($,_,Backbone,module,DateInputModel,TimeRangeModel,Base,DateControl,FlashMessages){return Base.extend({moduleId:module.id,initialize:function(){Base.prototype.initialize.apply(this,arguments);this.model={timeRange:this.model,workingRange:new TimeRangeModel,earliestDateInput:new DateInputModel};this.syncInternals();this.children.earliestTimeInput=new DateControl({model:this.model.earliestDateInput,validate:!0});this.children.flashMessages=new FlashMessages({model:{workingRange:this.model.workingRange,earliestDateInput:this.model.earliestDateInput}});this.activate()},startListening:function(){this.listenTo(this.model.timeRange,"change:earliest_date prepopulate",_.debounce(this.prepopulate,0));this.listenTo(this.model.earliestDateInput,"validated:invalid",this.disableApply);this.listenTo(this.model.earliestDateInput,"validated:valid",this.enableApply);this.listenTo(this.model.earliestDateInput,"change",function(){this.model.workingRange.trigger("validated",!0,this.model.workingRange,{});this.model.workingRange.trigger("serverValidated",!0,this.model.workingRange,[])})},syncInternals:function(){this.yesterday=new Date;this.yesterday.setDate(this.yesterday.getDate()-1);this.yesterday.setHours(0,0,0,0);this.model.earliestDateInput.setFromJSDate(this.yesterday,{silent:!0})},activate:function(){if(this.active)return Base.prototype.activate.apply(this,arguments);this.syncInternals();return Base.prototype.activate.apply(this,arguments)},deactivate:function(){if(!this.active)return Base.prototype.deactivate.apply(this,arguments);Base.prototype.deactivate.apply(this,arguments);this.model.workingRange.fetchAbort();this.model.workingRange.clear({setDefaults:!0});this.model.earliestDateInput.clear({setDefaults:!0});return this},prepopulate:function(){var earliest=this.model.timeRange.get("earliest_date");if(earliest&&!this.model.timeRange.hasNoEarliest()){this.model.earliestDateInput.setFromJSDate(earliest,{validate:!0});this.model.earliestDateInput.setHoursMinSecFromStr("00:00:00.000",{silent:!0})}},events:{"click .apply":function(event){if($(event.currentTarget).hasClass("disabled"))event.preventDefault();else{var that=this,earliestIsoWithoutTZ=this.model.earliestDateInput.isoWithoutTZ();this.disableApply();this.model.workingRange.save({earliest:earliestIsoWithoutTZ,latest:"now"},{success:function(model){that.enableApply();that.model.timeRange.set({earliest:model.get("earliest_epoch"),latest:"now",earliest_epoch:model.get("earliest_epoch"),latest_epoch:model.get("latest_epoch"),earliest_iso:model.get("earliest_iso"),latest_iso:model.get("latest_iso"),earliest_date:new Date(model.get("earliest_date").getTime()),latest_date:new Date(model.get("latest_date").getTime())});that.model.timeRange.trigger("applied")},error:function(){that.enableApply()}});event.preventDefault()}}},enableApply:function(){this.$("#apply_"+this.cid).removeClass("disabled")},disableApply:function(){this.$("#apply_"+this.cid).addClass("disabled")},render:function(){var template=_.template(this.template,{_:_,cid:this.cid});this.$el.html(template);this.children.flashMessages.render().appendTo(this.$(".flash_messages"));this.children.earliestTimeInput.render().prependTo(this.$(".earliest_time"));return this},template:'                <div class="time-after-date">                    <div class="flash_messages"></div>                    <div class="earliest_time col-1">                        <span class="help-block"><%- _("00:00:00").t() %></span>                    </div>                    <div class="col-2">                        <button class="apply btn" id="apply_<%- cid %>"><%- _("Apply").t() %></button>                    </div>                </div>            '})});define("views/shared/timerangepicker/dialog/daterange/Master",["jquery","underscore","backbone","module","views/Base","views/shared/controls/SyntheticSelectControl","views/shared/timerangepicker/dialog/daterange/BetweenDates","views/shared/timerangepicker/dialog/daterange/BeforeDate","views/shared/timerangepicker/dialog/daterange/AfterDate"],function($,_,Backbone,module,Base,SyntheticSelectControl,BetweenDates,BeforeDate,AfterDate){return Base.extend({className:"accordion-inner",moduleId:module.id,initialize:function(){Base.prototype.initialize.apply(this,arguments);_.defaults(this.options,{appendSelectDropdownsTo:"body"});this.label=_("Date Range").t();this.children.rangeTypeSelect=new SyntheticSelectControl({model:this.model,items:[{value:"between_dates",label:_("Between").t()},{value:"before_date",label:_("Before").t()},{value:"after_date",label:_("Since").t()}],modelAttribute:"range_type",className:"timerangepicker-range-type",toggleClassName:"btn",menuWidth:"narrow",popdownOptions:{attachDialogTo:this.options.appendSelectDropdownsTo},save:!1});var rangeTypeOptions={model:this.model,parentCid:this.cid};this.children.betweenDates=new BetweenDates(rangeTypeOptions);this.children.beforeDate=new BeforeDate(rangeTypeOptions);this.children.afterDate=new AfterDate(rangeTypeOptions);this.activate()},startListening:function(){this.listenTo(this.model,"change:range_type",function(){var range_type=this.model.get("range_type")||"";this.children.betweenDates.$el.hide();this.children.beforeDate.$el.hide();this.children.afterDate.$el.hide();switch(range_type){case"before_date":this.children.beforeDate.$el.show();break;case"after_date":this.children.afterDate.$el.show();break;default:this.children.betweenDates.$el.show()}});this.listenTo(this.model,"change:earliest change:latest prepopulate",_.debounce(this.prepopulate,0))},prepopulate:function(){var earliestIsAbsolute=this.model.isAbsolute("earliest"),hasNoEarliest=this.model.hasNoEarliest(),latestIsAbsolute=this.model.isAbsolute("latest");!hasNoEarliest&&earliestIsAbsolute&&latestIsAbsolute?this.model.set("range_type","between_dates"):hasNoEarliest&&latestIsAbsolute?this.model.set("range_type","before_date"):earliestIsAbsolute&&this.model.latestIsNow()&&this.model.set("range_type","after_date")},supportsRange:function(){var hasNoEarliest=this.model.hasNoEarliest(),latestIsNow=this.model.latestIsNow(),earliestIsWholeDay=this.model.isWholeDay("earliest"),latestIsWholeDay=this.model.isWholeDay("latest");return hasNoEarliest&&latestIsNow?!1:earliestIsWholeDay&&latestIsWholeDay||earliestIsWholeDay&&latestIsNow||hasNoEarliest&&latestIsWholeDay},render:function(){this.$el.append(this.children.rangeTypeSelect.render().el);var template=_.template(this.template,{cid:this.cid});this.$el.append(template);this.children.betweenDates.render().appendTo(this.$(".date-range-container"));this.children.beforeDate.render().appendTo(this.$(".date-range-container"));this.children.beforeDate.$el.hide();this.children.afterDate.render().appendTo(this.$(".date-range-container"));this.children.afterDate.$el.hide();return this},template:'                    <div class="form form-inline date-range-container">                    </div>                '})});define("views/shared/timerangepicker/dialog/dateandtimerange/timeinput/HoursMinutesSeconds",["jquery","underscore","backbone","module","views/Base"],function($,_,Backbone,module,Base){return Base.extend({tagName:"span",className:"view-time-range-picker-time-and-date-range-hours-minutes-seconds pull-left",moduleId:module.id,initialize:function(){Base.prototype.initialize.apply(this,arguments);this.activate()},startListening:function(){this.listenTo(this.model,"attributeValidated:second",function(isValid){isValid?this.$("input").removeClass("error"):this.$("input").addClass("error")});this.listenTo(this.model,"change",this.updateTime)},events:{'keyup input[type="text"]':function(){this.stopListening(this.model,"change",this.updateTime);this.model.setHoursMinSecFromStr(this.$("input").val(),{validate:!0});this.listenTo(this.model,"change",this.updateTime)}},updateTime:function(){var time=this.model.time();this.$("input").val(time).removeClass("error")},render:function(){var time=this.model.time(),template=_.template(this.template,{time:time});this.$el.html(template);return this},template:'            <input type="text" size="10" value="<%- time %>"/>            <span class="help-block"><%- _("HH:MM:SS.SSS").t() %></span>            '})});define("views/shared/timerangepicker/dialog/dateandtimerange/timeinput/Master",["jquery","underscore","backbone","module","views/Base","views/shared/controls/DateControl","views/shared/timerangepicker/dialog/dateandtimerange/timeinput/HoursMinutesSeconds"],function($,_,Backbone,module,Base,DateControl,HoursMinutesSeconds){return Base.extend({className:"form form-inline",moduleId:module.id,initialize:function(){Base.prototype.initialize.apply(this,arguments);
this.children.monthDayYear=new DateControl({parentCid:this.cid,model:this.model.dateTime,className:"control pull-left",inputClassName:this.options.inputClassName||"date",validate:!0});this.children.hoursMinutesSeconds=new HoursMinutesSeconds({model:this.model.dateTime})},render:function(){if(this.el.innerHTML){this.children.monthDayYear.render();this.children.hoursMinutesSeconds.render()}else{var template=_.template(this.template,{_:_,cid:this.cid,label:this.options.label});this.$el.html(template);this.children.monthDayYear.render().appendTo(this.$(".time-mdy").last());this.children.hoursMinutesSeconds.render().appendTo(this.$(".time-hms").last())}return this},template:'                <span class="time-datetime-range">                    <label class="control-label" for="monthdayyear_<%- cid %>" title="<%- label %><%- _(":").t() %>"><%- label %><%- _(":").t() %></label>                    <span class="time-mdy"></span>                    <span class="time-hms"></span>                </span>            '})});define("views/shared/timerangepicker/dialog/dateandtimerange/Master",["jquery","underscore","backbone","module","models/shared/DateInput","models/shared/TimeRange","views/Base","views/shared/timerangepicker/dialog/dateandtimerange/timeinput/Master","views/shared/FlashMessages","util/time"],function($,_,Backbone,module,DateInputModel,TimeRangeModel,Base,TimeInput,FlashMessages,time_utils){return Base.extend({className:"accordion-inner",moduleId:module.id,initialize:function(){Base.prototype.initialize.apply(this,arguments);this.model={timeRange:this.model,workingRange:new TimeRangeModel,earliestDateInput:new DateInputModel,latestDateInput:new DateInputModel};this.syncInternals();this.label=_("Date & Time Range").t();this.earliest_errored=!1;this.latest_errored=!1;this.children.earliestTimeInput=new TimeInput({label:_("Earliest").t(),inputClassName:"date-earliest",model:{dateTime:this.model.earliestDateInput}});this.children.latestTimeInput=new TimeInput({label:_("Latest").t(),inputClassName:"date-latest",model:{dateTime:this.model.latestDateInput}});this.children.flashMessages=new FlashMessages({model:{workingRange:this.model.workingRange,earliestDateInput:this.model.earliestDateInput,latestDateInput:this.model.latestDateInput}});this.activate()},startListening:function(){this.listenTo(this.model.workingRange,"sync error",this.enableApply);this.listenTo(this.model.earliestDateInput,"validated:invalid",function(){this.earliest_errored=!0;this.disableApply()});this.listenTo(this.model.earliestDateInput,"validated:valid",function(){this.earliest_errored=!1;this.enableApply()});this.listenTo(this.model.latestDateInput,"validated:invalid",function(){this.latest_errored=!0;this.disableApply()});this.listenTo(this.model.latestDateInput,"validated:valid",function(){this.latest_errored=!1;this.enableApply()});this.listenTo(this.model.earliestDateInput,"change",function(){this.model.workingRange.trigger("validated",!0,this.model.workingRange,{})});this.listenTo(this.model.latestDateInput,"change",function(){this.model.workingRange.trigger("validated",!0,this.model.workingRange,{})});this.listenTo(this.model.timeRange,"change:earliest_iso change:latest_iso prepopulate",_.debounce(this.prepopulate,0))},syncInternals:function(){this.yesterday=new Date;this.yesterday.setDate(this.yesterday.getDate()-1);this.yesterday.setHours(12,0,0,0);this.model.earliestDateInput.setFromJSDate(this.yesterday,{silent:!0});this.today=new Date;this.today.setHours(12,0,0,0);this.model.latestDateInput.setFromJSDate(this.today,{silent:!0})},activate:function(){if(this.active)return Base.prototype.activate.apply(this,arguments);this.syncInternals();return Base.prototype.activate.apply(this,arguments)},deactivate:function(){if(!this.active)return Base.prototype.deactivate.apply(this,arguments);Base.prototype.deactivate.apply(this,arguments);this.model.workingRange.fetchAbort();this.model.workingRange.clear({setDefaults:!0});this.model.earliestDateInput.clear({setDefaults:!0});this.model.latestDateInput.clear({setDefaults:!0});return this},remove:function(){Base.prototype.remove.apply(this,arguments);this.model.workingRange.deepOff();this.model.workingRange.fetchAbort()},prepopulate:function(){var earliest_date=(this.model.timeRange.get("earliest_iso"),this.model.timeRange.get("latest_iso"),this.model.timeRange.get("earliest_date")),latest_date=this.model.timeRange.get("latest_date");earliest_date&&this.model.earliestDateInput.setFromJSDate(earliest_date,{validate:!0});latest_date&&this.model.latestDateInput.setFromJSDate(latest_date,{validate:!0})},supportsRange:function(){return time_utils.generateDateTimeRangeLabel(this.model.timeRange.get("earliest"),this.model.timeRange.get("latest"))},events:{"click .apply":function(event){if($(event.currentTarget).hasClass("disabled"))event.preventDefault();else{if(!this.earliest_errored&&!this.latest_errored){var that=this,earliestIsoWithoutTZ=this.model.earliestDateInput.isoWithoutTZ(),latestIsoWithoutTZ=this.model.latestDateInput.isoWithoutTZ();this.disableApply();this.model.workingRange.save({earliest:earliestIsoWithoutTZ,latest:latestIsoWithoutTZ},{success:function(model){that.enableApply();that.model.timeRange.set({earliest:model.get("earliest_epoch"),latest:model.get("latest_epoch"),earliest_epoch:model.get("earliest_epoch"),latest_epoch:model.get("latest_epoch"),earliest_iso:model.get("earliest_iso"),latest_iso:model.get("latest_iso"),earliest_date:new Date(model.get("earliest_date").getTime()),latest_date:new Date(model.get("latest_date").getTime())});that.model.timeRange.trigger("applied")},error:function(){that.enableApply()}})}event.preventDefault()}}},enableApply:function(){this.$("#apply_"+this.cid).removeClass("disabled")},disableApply:function(){this.$("#apply_"+this.cid).addClass("disabled")},render:function(){var template=_.template(this.template,{_:_,cid:this.cid});this.$el.html(template);this.children.flashMessages.render().insertBefore(this.$(".apply"));this.children.earliestTimeInput.render().insertBefore(this.$(".apply"));this.children.latestTimeInput.render().insertBefore(this.$(".apply"));return this},template:'                    <button class="apply btn pull-left" id="apply_<%- cid %>"><%- _("Apply").t() %></button>                '})});define("views/shared/timerangepicker/dialog/advanced/timeinput/Hint",["jquery","underscore","backbone","module","views/Base","util/time","splunk.i18n"],function($,_,Backbone,module,Base,time_utils,i18n){return Base.extend({moduleId:module.id,tagName:"span",initialize:function(){Base.prototype.initialize.apply(this,arguments);this.activate()},startListening:function(){this.listenTo(this.model.timeParser,"error sync",this.render)},render:function(){var parseError=this.model.timeParser.error.get("messages"),date=time_utils.isoToDateObject(this.model.timeParser.get("value")),error=parseError||isNaN(date.getTime()),template=_.template(this.template,{_:_,timeParser:this.model.timeParser,error:error,value:error||i18n.format_datetime_microseconds(time_utils.jsDateToSplunkDateTimeWithMicroseconds(date),"short","full")});this.$el.html(template);return this},template:'            <% if (error) { %>                <%- _("Invalid time").t() %>            <% } else if (timeParser.get("value")) { %>                <%- value %>            <% } %>            '})});define("views/shared/timerangepicker/dialog/advanced/timeinput/Master",["jquery","underscore","backbone","module","views/Base","views/shared/timerangepicker/dialog/advanced/timeinput/Hint","util/time"],function($,_,Backbone,module,Base,Hint,time_utils){return Base.extend({className:"form form-inline pull-left",moduleId:module.id,initialize:function(){Base.prototype.initialize.apply(this,arguments);this.children.hint=new Hint({model:{timeParser:this.model.timeParser}});this.activate()},startListening:function(){this.listenTo(this.model.working,"change:"+this.options.modelAttribute,function(){this.update_value();this.update_hint()})},events:{'keyup input[type="text"]':"update_hint",'focusout input[type="text"]':"update_hint"},update_hint:function(){var time=time_utils.stripRTSafe(this.$("input").val()||this.options.blankValue,this.options.isLatest)||"now";this.model.timeParser.fetch({data:{time:time}})},update_value:function(){var time=this.model.working.get(this.options.modelAttribute)||"";time!==this.options.blankValue&&this.$("input").val(time)},render:function(){var template=_.template(this.template,{_:_,cid:this.cid,label:this.options.label,time:this.model.working.get(this.options.modelAttribute)||""});this.$el.html(template);this.children.hint.render().replaceContentsOf(this.$("#hint_"+this.cid));this.update_hint();return this},template:'            <div class="time-advanced">                <label class="control-label" for="<%- cid %>" title="<%- label %><%- _(":").t() %>"><%- label %><%- _(":").t() %></label>                <div class="controls">                    <input type="text" size="18" value="<%- time %>" id="<%- cid %>"/>                    <span id="hint_<%- cid %>" class="help-block help-block-timestamp"></span>                </div>            </div>            '})});define("uri/route",["underscore","splunk.util","splunk.config","util/console"],function(_,splunkutil,splunkConfig,console){var exports={};exports.encodeRoot=function(path,locale){splunkConfig.INDEPENDENT_MODE&&console.warn("route: Trying to generate URL in independent mode when URL structure is unknown");var parts=_.map((path||"").split("/"),function(part){return encodeURIComponent(part)});path=parts.join("/");path=path?"/"+path:path;return path+"/"+encodeURIComponent(locale)};exports.staticFile=function(root,locale,version,file){return exports.encodeRoot(root,locale)+"/static/"+encodeURIComponent(version)+"/"+encodeURIComponent(file)};exports.img=function(root,locale,version,file){return exports.encodeRoot(root,locale)+"/static/"+encodeURIComponent(version)+"/img/"+encodeURIComponent(file)};exports.page=function(root,locale,app,page,options){"undefined"==typeof page&&(page="");var url=exports.encodeRoot(root,locale)+"/app/"+encodeURIComponent(app);_.isArray(page)?_.each(page,function(dir){url+="/"+encodeURIComponent(dir)}):url+="/"+encodeURIComponent(page);if(options){options.data&&(url=url+"?"+splunkutil.propToQueryString(options.data));options.absolute&&(url=window.location.protocol+"//"+window.location.host+url)}return url};exports.appIcon=function(root,locale,owner,app,options){var size="";window&&window.devicePixelRatio>1&&(size="_2x");return exports.splunkdNS(root,locale,owner,app,"static/appIcon"+size+".png",options)};exports.appIconAlt=function(root,locale,owner,app,options){var size="";window&&window.devicePixelRatio>1&&(size="_2x");return exports.splunkdNS(root,locale,owner,app,"static/appIconAlt"+size+".png",options)};exports.appLogo=function(root,locale,owner,app,options){var size="";window&&window.devicePixelRatio>1&&(size="_2x");return exports.splunkdNS(root,locale,owner,app,"static/appLogo"+size+".png",options)};exports.splunkdNS=function(root,locale,owner,app,path){return exports.encodeRoot(root,locale)+"/splunkd/__raw/servicesNS/"+encodeURIComponent(owner)+"/"+encodeURIComponent(app)+"/"+path};exports.pivot=function(root,locale,app,options){return exports.page(root,locale,app,"pivot",options)};exports.data_model_manager=function(root,locale,app,options){return exports.page(root,locale,app,"data_model_manager",options)};exports.data_model_editor=function(root,locale,app,options){return exports.page(root,locale,app,"data_model_editor",options)};exports.search=function(root,locale,app,options){return exports.page(root,locale,app,"search",options)};exports.report=function(root,locale,app,options){return exports.page(root,locale,app,"report",options)};exports.reports=function(root,locale,app,options){return exports.page(root,locale,app,"reports",options)};exports.alert=function(root,locale,app,options){return exports.page(root,locale,app,"alert",options)};exports.alerts=function(root,locale,app,options){return exports.page(root,locale,app,"alerts",options)};exports.editDashboard=function(root,locale,app,name,options){return exports.page(root,locale,app,[name,"edit"],options)};exports.logout=function(root,locale){return exports.encodeRoot(root,locale)+"/account/logout"};exports.embed=function(root,locale,embedToken,savedSearchId){var url,data={s:savedSearchId,oid:embedToken};if(splunkConfig.EMBED_URI)url=splunkConfig.EMBED_URI+"/";else{url=window.location.protocol+"//"+window.location.host+"/";root&&(url+=root+"/")}return url+locale+"/embed?"+splunkutil.propToQueryString(data)};exports.jobInspector=function(root,locale,app,sid){var data={sid:sid,namespace:app};return exports.encodeRoot(root,locale)+"/search/inspector?"+splunkutil.propToQueryString(data)};exports.ifx=function(root,locale,app,sid,offset){var data={sid:sid,namespace:app,offset:offset};return exports.encodeRoot(root,locale)+"/ifx?"+splunkutil.propToQueryString(data)};exports.manager=function(root,locale,app,page,options){var url=exports.encodeRoot(root,locale)+"/manager/"+encodeURIComponent(app);_.isArray(page)?_.each(page,function(dir){url+="/"+encodeURIComponent(dir)}):url+="/"+encodeURIComponent(page);options&&options.data&&(url=url+"?"+splunkutil.propToQueryString(options.data));return url};exports.managerEdit=function(root,locale,app,page,id,options){options=options||{};options=$.extend(!0,{data:{action:"edit",uri:id}},options);return exports.manager(root,locale,app,page,options)};exports.triggeredAlerts=function(root,locale,app,options){var url=exports.encodeRoot(root,locale)+"/alerts/"+encodeURIComponent(app);options&&options.data&&(url=url+"?"+splunkutil.propToQueryString(options.data));return url};exports.docSearch=function(locale,version,isFree,isTrial,search){var base="http://docs.splunk.com/Special:SplunkSearch/docs",params={locale:locale,versionNumber:version,license:isFree?"free":"pro",installType:isTrial?"trial":"prod",q:search};return base+"?"+splunkutil.propToQueryString(params)};exports.docHelp=function(root,locale,location){var url=exports.encodeRoot(root,locale)+"/help",params={location:location};return url+"?"+splunkutil.propToQueryString(params)};exports.docHelpInAppContext=function(root,locale,location,appName,appVersion,appAllowsDisable,appDocSectionOverride){var url=exports.encodeRoot(root,locale)+"/help",params={location:location};appAllowsDisable&&(params.location=appDocSectionOverride?"["+appDocSectionOverride+"]"+params.location:"["+appName+":"+appVersion+"]"+params.location);return url+"?"+splunkutil.propToQueryString(params)};exports.exportUrl=function(root,locale,sid,filename,format,limit,maxResults,count,isReport,options){options=options||{};var resultType=isReport?"results":"event",url=exports.encodeRoot(root,locale)+"/api/search/jobs/"+encodeURIComponent(sid)+"/"+resultType,params={isDownload:!0,timeFormat:options.timeFormat||"%FT%T.%Q%:z",maxLines:0,count:count,filename:filename||"",outputMode:format,"spl_ctrl-limit":limit,"spl_ctrl-count":maxResults};url+="?"+splunkutil.propToQueryString(params);return url};exports.getContextualPageRouter=function(applicationModel){var root=applicationModel.get("root"),locale=applicationModel.get("locale"),app=applicationModel.get("app"),nonPageMethods=["page","docSearch","docHelp","docHelpInAppContext","exportUrl","exportUrl","getContextualPageRouter","pageStart","encodeRoot"],routeNames=_(exports).chain().functions().difference(nonPageMethods),router={};_(routeNames).each(function(route){var routeFn=exports[route];router[route]=function(){var fullArgs=[root,locale,app].concat(_(arguments).toArray());return routeFn.apply(null,fullArgs)}});return router};exports.appNavUrl=function(root,locale,app){return exports.encodeRoot(root,locale)+"/appnav/"+encodeURIComponent(app||"")};exports.viewStrings=function(root,locale,app,view){return exports.page(root,locale,app,view)+"/strings"};return exports});define("views/shared/timerangepicker/dialog/advanced/Master",["jquery","underscore","backbone","module","views/Base","views/shared/timerangepicker/dialog/advanced/timeinput/Master","views/shared/FlashMessages","models/services/search/TimeParser","models/shared/TimeRange","uri/route","util/console","util/time"],function($,_,Backbone,module,Base,TimeInput,FlashMessages,TimeParserModel,TimeRangeModel,route,console,time_utils){return Base.extend({moduleId:module.id,className:"accordion-inner",initialize:function(){Base.prototype.initialize.apply(this,arguments);this.label=_("Advanced").t();this.model.workingRange=new TimeRangeModel;this.model.earliestTimeParser=new TimeParserModel;this.model.latestTimeParser=new TimeParserModel;this.syncInternals();this.children.earliestTimeInput=new TimeInput({model:{working:this.model.workingRange,timeParser:this.model.earliestTimeParser},label:_("Earliest").t(),blankValue:"0",modelAttribute:"earliest",isLatest:!1});this.children.latestTimeInput=new TimeInput({model:{working:this.model.workingRange,timeParser:this.model.latestTimeParser},label:_("Latest").t(),blankValue:"",modelAttribute:"latest",isLatest:!0});this.children.flashMessages=new FlashMessages({model:{workingRange:this.model.workingRange,earliestTimeParser:this.model.earliestTimeParser,latestTimeParser:this.model.latestTimeParser}});this.activate()},syncInternals:function(){this.model.workingRange.set($.extend(!0,{enableRealTime:this.options.enableCustomAdvancedRealTime},this.model.timeRange.toJSON()));this.model.earliestTimeParser.set({key:time_utils.stripRTSafe(this.model.timeRange.get("earliest"),!1),value:this.model.timeRange.get("earliest_iso")});this.model.latestTimeParser.set({key:time_utils.stripRTSafe(this.model.timeRange.get("latest"),!0),value:this.model.timeRange.get("latest_iso")})},startListening:function(){this.listenTo(this.model.timeRange,"change:earliest change:latest prepopulate",_.debounce(function(){this.model.workingRange.set({earliest:this.model.timeRange.get("earliest"),latest:this.model.timeRange.get("latest")})},0));this.listenTo(this.model.workingRange,"validated",function(validated){validated||this.enableApply()})},activate:function(){if(this.active)return Base.prototype.activate.apply(this,arguments);this.syncInternals();return Base.prototype.activate.apply(this,arguments)},deactivate:function(){if(!this.active)return Base.prototype.deactivate.apply(this,arguments);Base.prototype.deactivate.apply(this,arguments);this.model.workingRange.fetchAbort();this.model.workingRange.clear({setDefaults:!0});this.model.earliestTimeParser.fetchAbort();this.model.earliestTimeParser.clear({setDefaults:!0});this.model.latestTimeParser.fetchAbort();this.model.latestTimeParser.clear({setDefaults:!0});return this},remove:function(){Base.prototype.remove.apply(this,arguments);_.chain(this.model).omit(["appLocal","application","timeRange"]).each(function(model){model.deepOff();model.fetchAbort()})},supportsRange:function(){return!0},events:{"click .apply":function(event){if($(event.currentTarget).hasClass("disabled"))event.preventDefault();else{var that=this,earliest=this.children.earliestTimeInput.$("input").val()||"0",latest=this.children.latestTimeInput.$("input").val()||"";this.disableApply();this.model.workingRange.save({earliest:earliest,latest:latest},{success:function(model){that.enableApply();var latest_date=model.get("latest_date"),latest_js_date=latest_date?Date(latest_date.getTime()):latest_date;that.model.timeRange.set({earliest:model.get("earliest"),latest:model.get("latest"),earliest_epoch:model.get("earliest_epoch"),latest_epoch:model.get("latest_epoch"),earliest_iso:model.get("earliest_iso"),latest_iso:model.get("latest_iso"),earliest_date:new Date(model.get("earliest_date").getTime()),latest_date:latest_js_date});that.model.timeRange.trigger("applied")},error:function(){that.enableApply()}});event.preventDefault()}}},enableApply:function(){this.$("#apply_"+this.cid).removeClass("disabled")},disableApply:function(){this.$("#apply_"+this.cid).addClass("disabled")},render:function(){var docRoute="http://docs.splunk.com/";this.model.appLocal&&this.model.application?docRoute=route.docHelp(this.model.application.get("root"),this.model.application.get("locale"),"learnmore.timerange.picker"):console.warn("The timerangepicker advanced view needs the AppLocal and Application model passed to it");var template=_.template(this.template,{_:_,cid:this.cid,docRoute:docRoute});this.$el.html(template);this.children.flashMessages.render().insertBefore(this.$(".apply"));this.children.earliestTimeInput.render().insertBefore(this.$(".apply"));this.children.latestTimeInput.render().insertBefore(this.$(".apply"));return this},template:'                    <button class="apply btn" id="apply_<%- cid %>"><%- _("Apply").t() %></button>                    <a href="<%- docRoute %>" target="_blank" title="<%- _("Splunk help").t() %>" class="btn-documentation"><%- _("Documentation").t() %> <i class="icon-external"></i></a>            '})});define("views/shared/delegates/Accordion",["jquery","underscore","views/shared/delegates/Base"],function($,_,DelegateBase){return DelegateBase.extend({initialize:function(){var defaults={group:".accordion-group",toggle:".accordion-toggle",body:".accordion-body",defaultGroup:".accordion-group:first-child",icon:".icon-accordion-toggle",inactiveIconClass:"icon-triangle-right-small",activeIconClass:"icon-triangle-down-small",activeClass:"active",speed:300};_.defaults(this.options,defaults);this.$(this.options.body).hide();this.$(this.options.icon).addClass(this.options.inactiveIconClass);this.show(this.$(this.options.defaultGroup),!1)},events:{"click .accordion-toggle":"toggle"},toggle:function(e){e.preventDefault();var $group=$(e.currentTarget).closest(this.options.group);if(!$group.hasClass(this.options.activeClass)){this.trigger("toggle");this.show($group,!0);this.trigger("toggled")}},show:function(group,animate){var that=this,$newGroup=$(group),$activeGroup=this.$(this.options.group+"."+this.options.activeClass),showComplete=function(){that.trigger("shown")},hideComplete=function(){that.trigger("hidden")};this.trigger("show");this.trigger("hide");$activeGroup.removeClass(this.options.activeClass);$newGroup.addClass(this.options.activeClass);$activeGroup.find(this.options.icon).addClass(this.options.inactiveIconClass).removeClass(this.options.activeIconClass);$newGroup.find(this.options.icon).addClass(this.options.activeIconClass).removeClass(this.options.inactiveIconClass);if(animate){$activeGroup.find(this.options.body).slideUp({duration:this.options.speed,queue:!1,complete:hideComplete});$newGroup.find(this.options.body).slideDown({duration:this.options.speed,queue:!1,complete:showComplete})}else{$activeGroup.find(this.options.body).hide({duration:0,queue:!1,complete:hideComplete});$newGroup.find(this.options.body).show({duration:0,queue:!1,complete:showComplete})}}})});define("views/shared/timerangepicker/dialog/Master",["jquery","underscore","backbone","module","models/services/authentication/User","views/Base","views/shared/timerangepicker/dialog/Presets","views/shared/timerangepicker/dialog/Relative","views/shared/timerangepicker/dialog/RealTime","views/shared/timerangepicker/dialog/daterange/Master","views/shared/timerangepicker/dialog/dateandtimerange/Master","views/shared/timerangepicker/dialog/advanced/Master","views/shared/delegates/Accordion"],function($,_,Backbone,module,UserModel,Base,Presets,Relative,RealTime,DateRange,DateAndTimeRange,Advanced,Accordion){return Base.extend({moduleId:module.id,className:"accordion view-new-time-range-picker-dialog",initialize:function(){this.model.user=this.model.user||new UserModel;var canRTSearch=this.model.user.canRTSearch(),defaults={showPresets:!0,showPresetsRealTime:canRTSearch,showPresetsRealTimeOnly:!1,showPresetsRelative:!0,showPresetsAllTime:!0,showCustom:!0,showCustomRealTime:canRTSearch,showCustomRelative:!0,showCustomDate:!0,showCustomDateTime:!0,showCustomAdvanced:!0,enableCustomAdvancedRealTime:canRTSearch,appendSelectDropdownsTo:"body"};_.defaults(this.options,defaults);Base.prototype.initialize.apply(this,arguments);this.renderedDfd=$.Deferred();this.options.showPresets&&this.collection&&(this.children.presets=new Presets({collection:this.collection,model:this.model.timeRange,showRealTime:this.options.showPresetsRealTime,showRealTimeOnly:this.options.showPresetsRealTimeOnly,showRelative:this.options.showPresetsRelative,showAllTime:this.options.showPresetsAllTime}));if(this.options.showCustom){this.options.showCustomRelative&&(this.children.relative=new Relative({model:this.model.timeRange,appendSelectDropdownsTo:this.options.appendSelectDropdownsTo}));this.options.showCustomRealTime&&(this.children.realtime=new RealTime({model:this.model.timeRange,appendSelectDropdownsTo:this.options.appendSelectDropdownsTo}));this.options.showCustomDate&&(this.children.daterange=new DateRange({model:this.model.timeRange,appendSelectDropdownsTo:this.options.appendSelectDropdownsTo}));this.options.showCustomDateTime&&(this.children.dateandtimerange=new DateAndTimeRange({model:this.model.timeRange}));this.options.showCustomAdvanced&&(this.children.advanced=new Advanced({model:{timeRange:this.model.timeRange,appLocal:this.model.appLocal,application:this.model.application},enableCustomAdvancedRealTime:this.options.enableCustomAdvancedRealTime}))}this.activate({skipOnChange:!0})},startListening:function(){this.listenTo(this.model.timeRange,"change:earliest_epoch change:latest_epoch",_.debounce(this.onChange,0));this.collection&&this.listenTo(this.collection,"reset",this.onChange)},activate:function(options){options=options||{};if(this.active)return Base.prototype.activate.apply(this,arguments);Base.prototype.activate.apply(this,arguments);options.skipOnChange||this.onChange();return this},onChange:function(){$.when(this.renderedDfd).then(function(){return this.$el.is(":visible")?!1:this.children.accordion.show(this.getBestGroup(),!1)}.bind(this))},getBestGroup:function(){var bestPanel=!1;_.each(this.children,function(panel){if(bestPanel)return!1;bestPanel=panel.supportsRange()?panel:bestPanel;return void 0},this);bestPanel=bestPanel||this.children.presets||this.children.advanced||this.children.daterange||this.children.dateandtimerange||this.children.relative||this.children.realtime;return bestPanel.$el.closest(".accordion-group")},render:function(){var template=_.template(this.template,{cid:this.cid,panels:this.children});this.$el.html(template);_.each(this.children,function(panel,key){panel.render().appendTo(this.$("#"+key+"_"+this.cid+" .accordion-body"))},this);this.children.accordion=new Accordion({el:this.el,defaultGroup:this.getBestGroup()});this.renderedDfd.resolve();return this},onShown:function(){this.$(".accordion-group.active a.accordion-toggle").focus()},template:'                <% _.each(panels, function(panel, key) { %>                 <div class="accordion-group" id="<%- key + "_" + cid %>">                    <div class="accordion-heading">                      <a class="accordion-toggle" href="#">                        <i class="icon-accordion-toggle"></i><%- panel.label %>                      </a>                    </div>                    <div class="accordion-body">                    </div>                </div>                <% }); %>             '})});define("app/views/TimeRangePickerView",["jquery","underscore","module","views/Base","views/shared/timerangepicker/dialog/Master","views/shared/delegates/Popdown","collections/SplunkDsBase","splunk.util","util/console"],function($,_,module,BaseView,Dialog,Popdown,SplunkDsBaseV2,splunk_util,console){return BaseView.extend({moduleId:module.id,className:"btn-group",initialize:function(options){this.options=options||{};var defaults={timerangeClassName:"btn"};_.defaults(this.options,defaults);BaseView.prototype.initialize.call(this,options);this.children.dialog=new Dialog($.extend({model:{timeRange:this.model.timeRange,user:this.model.user,appLocal:this.model.appLocal,application:this.model.application},collection:this.collection},this.options.dialogOptions||{}));this.collection&&this.collection.on("reset",function(){console.log("timerangepicker setting label because of collection reset");this.setLabel()},this);this.listenToModels();this.model.timeRange.trigger("prepopulate")},listenToModels:function(){this.model.timeRange.on("change:earliest change:latest",_.debounce(this.timeRangeChange,0),this);this.model.timeRange.on("applied",this.timeRangeApplied,this);this.model.timeRange.on("change:earliest_epoch change:latest_epoch change:earliest change:latest",_.debounce(this.setLabel,0),this)},stopListeningToModels:function(){this.model.timeRange.off(null,null,this)},timeRangeChange:function(){this.stopListeningToModels();this.listenToModels()},timeRangeApplied:function(){this.children.popdown.hide()},setLabel:function(){var timeLabel=this.model.timeRange.generateLabel(this.collection||new SplunkDsBaseV2);this.$el.children("a").find(".time-label").text(_(timeLabel).t())},render:function(){this.$el.html(this.compiledTemplate({options:this.options}));this.$(".popdown-dialog").append(this.children.dialog.render().el);this.children.popdown=new Popdown({el:this.el,toggle:"> a",mode:"dialog",attachDialogTo:"body",ignoreClasses:["ui-datepicker","ui-datepicker-header","dropdown-menu"]});this.children.popdown.on("shown",function(){if(this.children.dialog.$(".accordion-group.active").length)this.children.dialog.onShown();else{var timePanel="presets";this.children.dialog.children[timePanel].$el.closest(".accordion-group").find(".accordion-toggle").first().click();this.children.dialog.onShown()}},this);this.setLabel();return this},template:'                <a class=" splBorder splBorder-nsew splBackground-primary <%- options.timerangeClassName %>" href="#"><span class="time-label"></span><span class="caret"></span></a>                <div class="popdown-dialog">                    <div class="arrow"></div>                </div>                '})});define("app/views/TimeRangeViewportView",["jquery","backbone","underscore","d3","entityUtils"],function($,Backbone,_,d3){return Backbone.View.extend({initialize:function(options){this.options=options||{};this.centerDragOrigin=0;this.dragOffset=0;this.svg=this.options.svg;this.width=this.options.width;this.clipId=this.options.clipId;this.tooltip=d3.select("#time_tooltip");this.element_map=this.getElementMap();this.renderInnerTimeRangeInfo=_.throttle(this._renderInnerTimeRangeInfo,16);this.element_map.borderTopRight.attr("x2",this.width);this.element_map.highlight.attr("clip-path","url(#"+this.options.clipId+")").style("visibility","hidden");this.gripperWidth=this.element_map.leftGripper.attr("width");this.innerTimeRangeScale=d3.scale.linear().domain([0,100]).range([0,this.width]);this.setupDrag();this.model.on("change:outerTimeRange",function(){this.renderOuterTimeline()},this);this.model.on("change:innerPos",function(){this.setGripperPosition();this.renderInnerTimeRangeInfo()},this)},getGripperDiff:function(){var diff=Math.abs(this.leftGripperX-this.rightGripperX);isNaN(diff)&&(diff=0);return diff},renderToolTip:function(timeRange,duration){var output="earliest: "+timeRange.earliest_date+"<br/>latest: "+timeRange.latest_date+"<br/>duration: "+duration;return output},setupDrag:function(){var leftDrag=this.handleLeftGripperDrag,rightDrag=this.handleRightGripperDrag,centerDrag=this.handleCenterDrag,dragOffset=this.dragOffset,centerDragOrigin=(this.onDragStart,this.centerDragOrigin),model=this.model,width=this.width,gripperWidth=this.gripperWidth,innerTimeRangeScale=this.innerTimeRangeScale,tooltip=this.tooltip,renderToolTip=this.renderToolTip,elements=this.element_map,formatTotalTime=this.formatTotalTime;d3.select(this.el).select(".grippers").attr("transform","translate(0,14)");this.element_map.leftGripper.call(d3.behavior.drag().on("drag",function(){leftDrag(model,width,gripperWidth,innerTimeRangeScale)}));this.element_map.rightGripper.call(d3.behavior.drag().on("drag",function(){rightDrag(model,width,gripperWidth,innerTimeRangeScale)
}));this.element_map.innerTimeRangeInfo.select(".totalTime rect").call(d3.behavior.drag().on("drag",function(){centerDrag(model,width,innerTimeRangeScale,dragOffset,elements)}).on("dragstart",function(){centerDragOrigin=d3.event.sourceEvent.clientX;dragOffset=model.get("swapped")?centerDragOrigin-elements.rightGripper.node().getBoundingClientRect().left:centerDragOrigin-elements.leftGripper.node().getBoundingClientRect().left}));this.element_map.highlight.call(d3.behavior.drag().on("drag",function(){centerDrag(model,width,innerTimeRangeScale,dragOffset,elements)}).on("dragstart",function(){centerDragOrigin=d3.event.sourceEvent.clientX;dragOffset=centerDragOrigin-elements.leftGripper.node().getBoundingClientRect().left}));this.element_map.innerTimeRangeInfo.on("mouseover",function(){var enableTooltip=model.get("enableTooltip");enableTooltip!==!1&&tooltip.transition().duration(200).style({opacity:.8,visibility:"visible"})}).on("mousemove",function(){var top,coords=this.getBoundingClientRect(),left=coords.left-70,totalInnerTime=($(this),model.get("totalInnerTime")),innerTimeRange=model.get("innerTimeRange"),duration=formatTotalTime(totalInnerTime),enableTooltip=model.get("enableTooltip"),extraOffset=(navigator.userAgent.toLowerCase().indexOf("firefox")>-1,window.navigator.platform.toLowerCase().indexOf("win")>-1,40);if(enableTooltip!==!1){tooltip.style("left",left+"px").html(function(){return renderToolTip(innerTimeRange,duration)}).style("text-align","left");top=coords.top+$(document).scrollTop()+extraOffset;tooltip.style("top",top+"px")}}).on("mouseout",function(){tooltip.transition().duration(200).style({opacity:1e-6,visibility:"hidden"})})},handleLeftGripperDrag:function(model,width,gripperWidth,innerTimeRangeScale){var x=Math.max(0,Math.min(width-gripperWidth,d3.event.x));model.updateGrippers({left:innerTimeRangeScale.invert(x)})},handleRightGripperDrag:function(model,width,gripperWidth,innerTimeRangeScale){var x=Math.max(0,Math.min(width-gripperWidth,d3.event.x));model.updateGrippers({right:innerTimeRangeScale.invert(x)})},handleCenterDrag:function(model,width,innerTimeRangeScale,dragOffset,elements){var dx,x1,x2,current,distToEnd,mouseCurrentX,domSpaceX1,distToStart;current=model.get("innerPos");mouseCurrentX=d3.event.sourceEvent.clientX;domSpaceX1=elements.leftGripper.node().getBoundingClientRect().left;x1=innerTimeRangeScale(current.left);x2=innerTimeRangeScale(current.right);dx=d3.event.sourceEvent.clientX-(domSpaceX1+dragOffset);distToStart=x1;distToEnd=width-x2;0>dx?0>distToStart+dx&&(dx=-distToStart):0>distToEnd-dx&&(dx=distToEnd);if(0!==dx){x1=innerTimeRangeScale(current.left)+dx;x2=innerTimeRangeScale(current.right)+dx;model.updateGrippers({right:innerTimeRangeScale.invert(x2),left:innerTimeRangeScale.invert(x1)})}},parseTranslate:function(el){var translateStr=el.attr("transform"),re=/\((.*)\)/,result=re.exec(translateStr);result=result[1].split(",");return{x:Number(result[0]),y:Number(result[1])}},setGripperPosition:function(){var innerPos=this.model.get("innerPos");this.leftGripperX=this.innerTimeRangeScale(innerPos.left);this.rightGripperX=this.innerTimeRangeScale(innerPos.right);this.element_map.leftGripper.attr("transform","translate("+this.leftGripperX+", 0)");this.element_map.rightGripper.attr("transform","translate("+this.rightGripperX+", 0)")},render:function(){this.setGripperPosition();this.renderOuterTimeline();this.renderInnerTimeRangeInfo();return this},updateTopBorder:function(){var swapped=this.model.get("swapped");if(swapped){this.element_map.borderTopLeft.attr("x2",this.rightGripperX);this.element_map.borderTopRight.attr("x1",this.leftGripperX)}else{this.element_map.borderTopLeft.attr("x2",this.leftGripperX);this.element_map.borderTopRight.attr("x1",this.rightGripperX)}},_renderInnerTimeRangeInfo:function(){var centerTextWidth,startTimeTextWidth,endTimeTextWidth,outerTimeRange=this.model.get("outerTimeRange"),innerTimeRange=this.model.get("innerTimeRange")||outerTimeRange,timeFormat=this.model.getTimeFormat(outerTimeRange.duration),diff=this.getGripperDiff(),swapped=this.model.get("swapped"),totalInnerTime=this.model.get("totalInnerTime");this.element_map.innerTimeRangeInfo.select(".totalTime rect").attr("width",diff);swapped?this.element_map.innerTimeRangeInfo.select(".totalTime rect").attr("transform","translate(-"+diff+")"):this.element_map.innerTimeRangeInfo.select(".totalTime rect").attr("transform",null);this.element_map.innerTimeRangeInfo.attr("transform","translate("+this.leftGripperX+",50)");this.updateTopBorder(this.leftGripperX,this.rightGripperX);this.element_map.highlight.attr("width",diff).style("visibility","visible");if(swapped){this.element_map.highlight.attr("x",this.rightGripperX);this.element_map.startTimeLabel.text(timeFormat(innerTimeRange.latest_date));this.element_map.endTimeLabel.text(timeFormat(innerTimeRange.earliest_date))}else{this.element_map.highlight.attr("x",this.leftGripperX);this.element_map.startTimeLabel.text(timeFormat(innerTimeRange.earliest_date));this.element_map.endTimeLabel.text(timeFormat(innerTimeRange.latest_date))}startTimeTextWidth=this.element_map.startTimeLabel.node().getComputedTextLength();endTimeTextWidth=this.element_map.endTimeLabel.node().getComputedTextLength();if(startTimeTextWidth+endTimeTextWidth>diff){this.element_map.innerTimeRangeInfoText.text("");this.element_map.endTimeLabel.attr("visibility","hidden");this.element_map.startTimeLabel.attr("visibility","hidden");this.model.set({enableTooltip:!0})}else{this.element_map.endTimeLabel.attr("visibility","visible");this.element_map.startTimeLabel.attr("visibility","visible");this.element_map.innerTimeRangeInfoText.text("view: "+this.formatTotalTime(totalInnerTime));this.model.set({enableTooltip:!1});centerTextWidth=this.element_map.innerTimeRangeInfoText.node().getComputedTextLength();if(swapped){this.element_map.startTimeLabel.attr("transform","translate("+[0-startTimeTextWidth,0]+")");this.element_map.endTimeLabel.attr("transform","translate(0,0)");this.element_map.innerTimeRangeInfoText.attr("transform","translate("+(-diff/2-centerTextWidth/2)+",0)")}else{this.element_map.startTimeLabel.attr("transform","translate(0,0)");this.element_map.endTimeLabel.attr("transform","translate("+[0-endTimeTextWidth,0]+")");this.element_map.innerTimeRangeInfoText.attr("transform","translate("+(diff/2-centerTextWidth/2)+",0)")}}this.element_map.innerTimeRangeInfo.select(".endTime").attr("transform","translate("+(this.rightGripperX-this.leftGripperX)+",0)")},renderOuterTimeline:function(){var outerTimeRange,timeScale,timeFormat,xAxis;outerTimeRange=this.model.get("outerTimeRange");timeFormat=this.model.getTimeFormat(outerTimeRange.duration);timeScale=d3.time.scale().domain([outerTimeRange.earliest_date,outerTimeRange.latest_date]).range([0,this.width]);xAxis=d3.svg.axis().scale(timeScale).orient("bottom").ticks(5).tickFormat(timeFormat).tickPadding(2);this.element_map.outerTimeRange.classed("outerTimeRange",!0).call(xAxis);d3.select(this.el).selectAll(".outerTimeRange .tick line").attr("y2",-50);this._renderInnerTimeRangeInfo()},getElementMap:function(){return{$innerTimeRange:this.$el.find(".innerTimeRange"),innerTimeRange:d3.select(this.el).select(".innerTimeRange"),outerTimeRange:d3.select(this.el).select(".outerTimeRange"),totalTime:d3.select(this.el).select(".totalTime"),startTime:d3.select(this.el).select(".startTime"),endTime:d3.select(this.el).select(".endTime"),leftGripper:this.svg.select(".gripper.left"),rightGripper:this.svg.select(".gripper.right"),innerTimeRangeInfo:this.svg.select(".innerTimeRangeInfo"),innerTimeRangeInfoText:this.svg.select(".innerTimeRangeInfo .totalTime text"),startTimeLabel:this.svg.select(".innerTimeRangeInfo .startTime text"),endTimeLabel:this.svg.select(".innerTimeRangeInfo .endTime text"),highlight:this.svg.select(".blueHighlight"),highlightGroup:this.svg.select(".blueHighlightGroup"),borderTopLeft:this.svg.select(".borderTopLeft"),borderTopRight:this.svg.select(".borderTopRight")}},formatTotalTime:function(time){var str="";time.days>0&&(str+=time.days+"d ");time.hours>0&&(str+=time.hours+"h ");time.minutes>0&&(str+=time.minutes+"m");return str}})});define("contrib/text!app/templates/AttributesTable.html",[],function(){return'<span class="value">\n    <%= value %>\n</span>\n<span class="detail">\n    <%= detail.join(", ") %>\n</span>\n<table>\n    <tr>\n    <% var i = 1;\n        _.each(attrs, function(val, key) { %>\n       \n            <td>\n                <%= key %>: \n                <span class="attrVal"><%= val.join(", ") %></span>\n            </td>\n        <% if (i % 4 === 0) { %>\n            </tr>\n            <tr>\n        <% }\n        i += 1 %>\n        \n    <% }); %>\n    </tr>\n</table>'});define("app/views/AttributesTableView",["jquery","underscore","backbone","contrib/text!app/templates/AttributesTable.html"],function($,_,Backbone,Template){var unneeded=["identity_tag","tag","key","asset_id","asset_tag","asset","identity","count"];return Backbone.View.extend({initialize:function(options){this.options=options||{};this.model=this.options.model;this.renderLoader();this.render=_.debounce(this._render,100);this.model.on("change",_.bind(this.render,this));this.undefinedEntity=_.debounce(this._undefinedEntity,100);this.model.on("entity:undefined",this.undefinedEntity,this);this.unfoundEntity=_.debounce(this._unfoundEntity,100);this.model.on("entity:notFound",this.unfoundEntity,this);this.invalidEntity=_.debounce(this._invalidEntity,100);this.model.on("entity:invalid",this.invalidEntity,this);this.model.on("setEntityName",_.bind(this.showLoader,this))},renderLoader:function(){var width=this.$el.width();this.svg=d3.select("svg.loadingIcon");this.loadingIcon=this.svg.append("g").attr("transform","translate("+(width/2-150)+",5)");this.loadingIcon.append("use").attr("xlink:href","#loader").attr("transform","scale(0.5)").attr("width",200);this.loadingIcon.append("text").text("Loading...").attr("transform","translate(50,12)")},showLoader:function(){this.$(".attributes").hide();this.svg.style("display","block")},hideLoader:function(){this.$(".attributes").show();this.svg.style("display","none")},_render:function(){var value=this.model.value,detail=this.model.get("asset")||this.model.get("identity")||[],attrs=_.omit(this.model.attributes,unneeded);this.hideLoader();this.$(".attributes").html(_.template(Template,{value:value,detail:detail,attrs:attrs}));this.spaceTable()},_undefinedEntity:function(){this.hideLoader();this.$(".attributes").text("Entity name is not specified.  Search for "+this.model.fieldName+" to populate.")},_unfoundEntity:function(){this.hideLoader();this.$(".attributes").text(this.model.value+" is not a known "+this.model.fieldName+".")},_invalidEntity:function(){this.hideLoader();this.$(".attributes").text(this.model.value+" is not a known "+this.model.fieldName+".")},spaceTable:function(){var width=this.$(".attributes").width()/4;this.$("td").width(width)}})});define("app/views/InvestigatorInputView",["jquery","underscore","backbone"],function($,_,Backbone){return Backbone.View.extend({initialize:function(options){this.options=options||{};this.model=this.options.model;this.render=_.debounce(this._render,100);this.model.on("change entity:notFound",_.bind(this.render,this))},_render:function(){this.$("input").is(":focus")||this.$("input").val(this.model.value)},events:{"keydown input":"keydown","click .search":"search"},keydown:function(e){var chara=e.which,ENTER_CHAR=13,ESC_CHAR=27;chara===ENTER_CHAR?this.search():chara===ESC_CHAR&&this.$("input").blur()},search:function(){var val=this.$("input").val();if(val){this.$("input").blur();this.model.setNewEntity(val)}}})});define("contrib/text!app/templates/SVGDefs.html",[],function(){return'<svg width=0 height=0>\n\n    <defs>\n      <circle class="loaderCircle" id="loaderCircle" cx="0" cy="50" r="5"/>\n      <clipPath id="loaderClip">\n        <rect width="400" height="100" transform="translate(-10,0)" />\n      </clipPath>\n      <g transform="translate(10, 0)" id="loader" clip-path="url(#loaderClip)">\n        <use xlink:href="#loaderCircle" transform="translate(0, 0)"/>\n        <use xlink:href="#loaderCircle" transform="translate(30, 0)"/>\n        <use xlink:href="#loaderCircle" transform="translate(60, 0)"/>\n        <use xlink:href="#loaderCircle" transform="translate(90, 0)"/>\n        <use xlink:href="#loaderCircle" transform="translate(120, 0)"/>\n        <use xlink:href="#loaderCircle" transform="translate(150, 0)"/>\n        <use xlink:href="#loaderCircle" transform="translate(180, 0)"/>\n        <use xlink:href="#loaderCircle" transform="translate(210, 0)"/>\n        <use xlink:href="#loaderCircle" transform="translate(240, 0)"/>\n        <use xlink:href="#loaderCircle" transform="translate(270, 0)"/>\n      \n        <g id="loaderBoldCircles">\n          <circle id="a" class="loaderBoldCircle" cx="0" cy="50" r="9">\n          </circle>\n          \n          <circle id="b" class="loaderBoldCircle" cx="-30" cy="50" r="8">\n          </circle>\n          \n          <circle id="c" class="loaderBoldCircle" cx="-60" cy="50" r="7">\n          </circle>\n        </g>\n      </g>\n\n    </defs>\n\n</svg>\n'});define("contrib/text!app/templates/InvestigatorInput.html",[],function(){return'<div id="investigatorHeader">\n    <div id="investigatorTitle" class="title">\n        <%= entityName %> Investigator\n    </div>\n    <div id="investigatorInput">\n        <input type="text"  placeholder="search for <%= entityName.toLowerCase() %>"/>\n        <div class="btn search">search</div>\n    </div>\n</div>'});define("contrib/text!app/templates/SwimlanesContainerOuter.html",[],function(){return'<div id="swimlanesContainerOuter">\n    <div id="swimlanesContainer">\n\n    </div>\n</div>'});define("contrib/text!app/templates/SwimlaneModal.html",[],function(){return'<div class="modal hide" id="swimlaneModal">\n  <div class="swimlane_modal_header">\n    <button class="close icon-x-circle"></button>\n    <h1>Edit Lanes</h1>\n  </div>\n  <div class="modal-body">\n    <h5>Collection</h5>\n    <div id="swimlaneCollectionPicker">\n    </div>\n\n    <h5>Individual Lanes</h5>\n    <div id="swimlanePickers">\n    </div>\n  </div>\n</div>\n'});define("contrib/text!app/templates/SwimlaneMouseover.html",[],function(){return'<div id="swimlane_tooltip" style="visibility: hidden; opacity: .0000001; z-index: 1000;"> \n</div>\n'});define("contrib/text!app/templates/TimeRangeMouseover.html",[],function(){return'<div id="time_tooltip" style="visibility: hidden; opacity: .0000001; z-index: 1000;"> \n</div>\n'});define("contrib/text!app/templates/TimeRangeContainer.html",[],function(){return'  <div class="bottomContainer">\n    <div class="input input-timerangepicker timeRangePicker" id="timeRangePicker">\n        <label>&nbsp;</label>\n    </div>\n\n    <svg id="timeRange" height="<%= height %>" width="<%= width %>">\n      <g class="timeRangeContainer" transform="<%= outer_translate %>">\n        <line x0="0" x1="843" class="lightTopBorder"/>\n\n        <line x0="0" x1="0" class="borderTopLeft"/>\n        <line x0="0" x1="0" class="borderTopRight"/>\n\n        <rect class="border" transform="translate(0,-1)" width="843" height="51"></rect>\n        <g class="outerTimeRange" transform="<%= translate %>"></g>\n        <g class="lineChart" transform="translate(0,0)"></g>\n        <g class="innerTimeRange">\n          <rect class="blueHighlight" width="<%= width %>" height="<%= height %>"></rect>\n\n          <g class="innerTimeRangeInfo">\n            <g class="totalTime">\n              <rect height="20"/>\n              <text dy="15"></text>\n            </g>\n            <g transform="translate(0,35)">\n              <g class="startTime"><text transform="translate(0,0)"></text></g>\n              <g class="endTime"><text transform="translate(-45,0)"></text></g>\n            </g>\n          </g>\n          <g class="grippers">\n            <g class="gripper left">\n              <g class="gripperOffset" transform="translate(-4,0)">\n                <line x1="4" y1="36" x2="4" y2="-14"/>\n                <rect width="10" height="22" transform="translate(0,0)"/>\n\n                <line class="gripperInnerLine" x1="2" x2="2" y1="0" y2="22"/>\n                <line class="gripperInnerLine" x1="5" x2="5" y1="0" y2="22"/>\n                <line class="gripperInnerLine" x1="8" x2="8" y1="0" y2="22"/>\n              </g>\n            </g>\n\n            <g class="gripper right">\n              <g class="gripperOffset" transform="translate(-5,0)">\n                <line x1="4" y1="36" x2="4" y2="-14"/>\n                <rect width="10" height="22" transform="translate(0,0)"></rect>\n\n                <line class="gripperInnerLine" x1="2" x2="2" y1="0" y2="22"/>\n                <line class="gripperInnerLine" x1="5" x2="5" y1="0" y2="22"/>\n                <line class="gripperInnerLine" x1="8" x2="8" y1="0" y2="22"/>\n              </g>\n            </g>\n          </g>\n        </g>\n      </g>\n    </svg>\n\n  </div>\n'});define("contrib/text!app/templates/SignBoardContainer.html",[],function(){return'  <div class="signBoardContainer">\n    <div class="signBoardHeader"></div>\n    <div class="signBoardActions">\n      <div class="signBoardAction icon toSearch icon-search" title="Go to Search"></div>\n      <div class="signBoardAction icon share icon-external" title="Share"></div>\n      <div class="signBoardAction icon createNotable icon-bell" title="Create Notable Event"></div>\n    </div>\n    <div class="signBoardBody"></div>\n  </div>\n'});define("contrib/text!app/templates/EditSwimlanesContainer.html",[],function(){return'  <div class="editSwimlanes">\n    <span class="icon title">\n      <span class="icon-gear"></span>\n      Edit\n    </span>\n  </div>\n'});define("contrib/text!app/templates/SwimlanesContainer.html",[],function(){return'  <svg id="swimlanes" height="40" width="1085">\n  </svg>\n'});define("contrib/text!app/templates/AttributesTableContainer.html",[],function(){return'<div id="attributesTableOuter">\n  <div id="attributesTable">\n    <svg class="loadingIcon" height="50px">\n\n    </svg>\n    <div class="attributes">\n    \n    </div>\n  </div>\n</div>'});define("app/collections/Managers",["jquery","underscore","backbone"],function($,_,Backbone){return Backbone.Collection.extend({initialize:function(models,options){this.max_concurrency=options.max_concurrency||2;this.queue=new Backbone.Collection;this.interval=500;this.timer=setInterval(_.bind(this.checkQueue,this),this.interval);this.on("add change:innerTimeRange",_.bind(this.addToQueue,this));this.on("search:cancel search:done",_.bind(this.onSearchDone,this))},addToQueue:function(manager){manager.set({running:!1});this.queue.add(manager)},checkQueue:function(){if(!(this.queue.length<1)){var to_add,running_jobs=this.queue.where({running:!0}),available_slots=this.max_concurrency-running_jobs.length;if(available_slots>0){to_add=this.queue.where({running:!1}).slice(0,available_slots);_.each(to_add,function(item){item.set({running:!0});item.startSearch()})}}},onSearchDone:function(search,job){if(job){var manager=this.queue.filter(function(model){return model.job?model.job.sid===job.sid:!1});if(manager.length>0){manager=manager[0];this.queue.remove(manager);manager.set({running:!1})}}}})});define("app/components/investigator",["require","exports","module","underscore","d3","backbone","jquery","splunkjs/mvc","splunkjs/mvc/searchmanager","app/collections/Prefs","app/collections/SignBoardResults","app/collections/Swimlanes","collections/services/data/ui/Times","models/shared/Application","models/services/AppLocal","app/models/AttributesTable","app/models/TimeRange","app/models/TimeRangeLinegraph","models/services/authentication/User","app/views/SwimlanesView","app/views/SwimlaneModalView","app/views/SignBoardView","app/views/TimeRangeLinegraphView","app/views/TimeRangePickerView","app/views/TimeRangeViewportView","app/views/AttributesTableView","app/views/InvestigatorInputView","contrib/text!app/templates/SVGDefs.html","contrib/text!app/templates/InvestigatorInput.html","contrib/text!app/templates/SwimlanesContainerOuter.html","contrib/text!app/templates/SwimlaneModal.html","contrib/text!app/templates/SwimlaneMouseover.html","contrib/text!app/templates/TimeRangeMouseover.html","contrib/text!app/templates/TimeRangeContainer.html","contrib/text!app/templates/SignBoardContainer.html","contrib/text!app/templates/EditSwimlanesContainer.html","contrib/text!app/templates/SwimlanesContainer.html","contrib/text!app/templates/AttributesTableContainer.html","app/collections/Managers"],function(require){var _=require("underscore"),d3=require("d3"),Backbone=require("backbone"),$=require("jquery"),Prefs=(require("splunkjs/mvc"),require("splunkjs/mvc/searchmanager"),require("app/collections/Prefs")),SignBoardResults=require("app/collections/SignBoardResults"),Swimlanes=require("app/collections/Swimlanes"),Times=require("collections/services/data/ui/Times"),Application=require("models/shared/Application"),AppLocal=require("models/services/AppLocal"),AttributesTable=require("app/models/AttributesTable"),TimeRange=require("app/models/TimeRange"),TimeRangeLinegraph=require("app/models/TimeRangeLinegraph"),User=require("models/services/authentication/User"),SwimlanesView=require("app/views/SwimlanesView"),SwimlaneModalView=require("app/views/SwimlaneModalView"),SignBoardView=require("app/views/SignBoardView"),TimeRangeLinegraphView=require("app/views/TimeRangeLinegraphView"),TimeRangePickerView=require("app/views/TimeRangePickerView"),TimeRangeViewportView=require("app/views/TimeRangeViewportView"),AttributesTableView=require("app/views/AttributesTableView"),InvestigatorInputView=require("app/views/InvestigatorInputView"),SVGDefsTemplate=require("contrib/text!app/templates/SVGDefs.html"),InvestigatorInputTemplate=require("contrib/text!app/templates/InvestigatorInput.html"),SwimlanesContainerOuterTemplate=require("contrib/text!app/templates/SwimlanesContainerOuter.html"),SwimlaneModalTemplate=require("contrib/text!app/templates/SwimlaneModal.html"),SwimlaneMouseoverTemplate=require("contrib/text!app/templates/SwimlaneMouseover.html"),TimeRangeMouseoverTemplate=require("contrib/text!app/templates/TimeRangeMouseover.html"),TimeRangeContainerTemplate=require("contrib/text!app/templates/TimeRangeContainer.html"),SignBoardContainerTemplate=require("contrib/text!app/templates/SignBoardContainer.html"),EditSwimlanesContainerTemplate=require("contrib/text!app/templates/EditSwimlanesContainer.html"),SwimlanesContainerTemplate=require("contrib/text!app/templates/SwimlanesContainer.html"),AttributesTableContainerTemplate=require("contrib/text!app/templates/AttributesTableContainer.html"),Managers=require("app/collections/Managers"),Investigator=Backbone.View.extend({moduleId:"investigator",className:"investigator",initialize:function(options){var timeRangeLinegraphView,timeRangeSvg,timeRangeLinegraph,app_name=options.app_name,field_name=options.field_name||"identity",fieldNameCap=field_name.charAt(0).toUpperCase()+field_name.slice(1),max_concurrency=options.max_concurrency||2,view_name=options.view_name,id=options.id,leftPadding=60,linegraphHeight=50,rightPadding=60,timeRangeHeight=95,timeRangeWidth=843,containerEl=options.el,swimlanesContainerEl="#swimlanesContainer",outerTimeRangeContainerEl=".timeRangeContainer",outerTimeRangeLineChartEl=".lineChart",outerTimeRangeSvgEl="svg#timeRange",signBoardContainerEl=".signBoardContainer",swimlaneModalCollectionEl="#swimlaneCollectionPicker",swimlaneModalEditEl=".editSwimlanes",swimlaneModalEl="#swimlaneModal",swimlaneModalSwimlaneEl="#swimlanePickers",swimlanesSvgEl="svg#swimlanes",timeRangePickerEl="#timeRangePicker",attributesTableEl="#attributesTable",investigatorInputEl="#investigatorInput",application=new Application,appLocal=new AppLocal,user=new User,sync_filter=options.sync_filter||null,swimlanesManagers=new Managers([],{max_concurrency:max_concurrency}),linegraphManagers=new Managers([],{max_concurrency:1}),prefs=new Prefs([],{app_name:app_name,changes:["change:selected","change:lane_prefs","change:earliest","change:latest"],field_name:field_name,id:id,view_name:view_name}),signBoardResults=new SignBoardResults([],{prefs:prefs}),timeRange=new TimeRange({app_name:app_name,earliest:"@d",latest:"now",prefs:prefs,view_name:view_name}),swimlanes=new Swimlanes([],{app_name:app_name,id:id,max_concurrency:max_concurrency,prefs:prefs,sign_board:signBoardResults,time_range:timeRange,view_name:view_name,managers:swimlanesManagers,sync_filter:sync_filter}),attributesTable=new AttributesTable({},{swimlanes:swimlanes}),times=new Times;Backbone.emulateHTTP=!0;Backbone.emulateJSON=!0;times.fetch();$(containerEl).append(_.template(SwimlaneMouseoverTemplate)).append(_.template(TimeRangeMouseoverTemplate)).append(_.template(InvestigatorInputTemplate,{entityName:fieldNameCap})).append(_.template(AttributesTableContainerTemplate)).append(_.template(SwimlanesContainerOuterTemplate));$(swimlanesContainerEl).append(_.template(EditSwimlanesContainerTemplate)).append(_.template(SwimlanesContainerTemplate)).append(_.template(SignBoardContainerTemplate)).append(_.template(SwimlaneModalTemplate)).append(_.template(TimeRangeContainerTemplate,{height:timeRangeHeight,outer_translate:"translate("+[leftPadding,0]+")",translate:"translate("+[0,linegraphHeight]+")",width:timeRangeWidth+leftPadding+rightPadding})).append(_.template(SVGDefsTemplate));timeRangeSvg=d3.select(outerTimeRangeSvgEl);new InvestigatorInputView({model:attributesTable,el:$(investigatorInputEl)});new AttributesTableView({model:attributesTable,el:$(attributesTableEl)});new SwimlanesView({collection:swimlanes,el:swimlanesSvgEl,model:timeRange});new SwimlaneModalView({el:$(swimlaneModalEl),collection:swimlanes,collections_el:swimlaneModalCollectionEl,swimlanes_el:swimlaneModalSwimlaneEl,edit_el:swimlaneModalEditEl});timeRangeLinegraph=new TimeRangeLinegraph({managers:linegraphManagers,swimlanes:swimlanes,timeRange:timeRange});timeRangeLinegraphView=new TimeRangeLinegraphView({el:$(timeRangeSvg.select(outerTimeRangeLineChartEl).node()),height:linegraphHeight,model:timeRangeLinegraph,svg:timeRangeSvg,time_range:timeRange,width:timeRangeWidth});new TimeRangeViewportView({clipId:timeRangeLinegraphView.getClipId(),el:$(timeRangeSvg.select(outerTimeRangeContainerEl).node()),height:timeRangeHeight,model:timeRange,svg:timeRangeSvg,width:timeRangeWidth});new TimeRangePickerView({collection:times,dialogOptions:{showPresets:!0,showPresetsRelative:!0,showPresetsRealTime:!1,showPresetsAllTime:!1,showCustomRealTime:!1,showCustomRelative:!1,enableCustomAdvancedRealTime:!1},el:$(timeRangePickerEl),model:{application:application,appLocal:appLocal,timeRange:timeRange,user:user}}).render();new SignBoardView({el:$(signBoardContainerEl),collection:signBoardResults,prefs:prefs});prefs.fetch({reset:!0})},render:function(){return this}});return Investigator});define("splunkjs/mvc/settings",["require","exports","module","./tokenawaremodel"],function(require){var TokenAwareModel=require("./tokenawaremodel"),Settings=TokenAwareModel.extend({sync:function(){return!1}});return Settings});define("splunkjs/mvc/basesplunkview",["require","exports","module","underscore","./mvc","util/console","backbone","./settings","mixins/viewlogging"],function(require){var _=require("underscore"),mvc=require("./mvc"),console=require("util/console"),Backbone=require("backbone"),Settings=require("./settings"),viewloggingmixin=require("mixins/viewlogging"),BaseSplunkView=Backbone.View.extend({_numConfigureCalls:0,omitFromSettings:[],constructor:function(options,settingsOptions){options=options||{};settingsOptions=settingsOptions||{};options.settingsOptions=_.extend(options.settingsOptions||{},settingsOptions);this._removed=!1;var id=options.id;if(void 0===id&&options.name){id=options.name;console.warn("Use of 'name' to specify the ID of a Splunk model is deprecated.")}void 0===id&&(id=_.uniqueId("view_"));this.name=this.id=options.name=options.id=id;this.options=_.extend({},this.options,options);var returned=Backbone.View.prototype.constructor.apply(this,arguments);0==this._numConfigureCalls&&this.configure();mvc.Components.registerInstance(this.id,this,{replace:settingsOptions.replace});return returned},configure:function(){this._numConfigureCalls++;if(this._numConfigureCalls>1)throw new Error("BaseSplunkView.configure() called multiple times.");var settings=this.options.settings;if(settings&&settings instanceof Settings){this.settings=settings;return this}var localOmitFromSettings=(this.omitFromSettings||[]).concat(["model","collection","el","attributes","className","tagName","events","settingsOptions"]),settingsAttributes=_.omit(this.options,localOmitFromSettings),settingsOptions=this.options.settingsOptions;this.settings=new Settings(settingsAttributes,settingsOptions);return this},initialize:function(){Backbone.View.prototype.initialize.apply(this,arguments)},remove:function(){this._removed=!0;this.settings.dispose();Backbone.View.prototype.remove.apply(this,arguments);mvc.Components.getInstance(this.id)===this&&mvc.Components.revokeInstance(this.id);return this},dispose:function(){this.remove()},setElement:function(){Backbone.View.prototype.setElement.apply(this,arguments);this.$el.addClass("splunk-view");this.className&&this.$el.addClass(this.className);this.$el.attr("id")||this.$el.attr("id",this.id);return this},bindToComponentSetting:function(settingName,fn,fnContext){this.listenTo(this.settings,"change:"+settingName,function(model,value){var oldComponentName=this.settings.previous(settingName),newComponentName=value;this.unbindFromComponent(oldComponentName,fn,fnContext);this.bindToComponent(newComponentName,fn,fnContext)},this);var initialComponentName=this.settings.get(settingName);this.bindToComponent(initialComponentName,fn,fnContext)},bindToComponent:function(id,fn,fnContext){if(!id||!fn)return this;this.listenTo(mvc.Components,"change:"+id,fn,fnContext);if(mvc.Components.has(id)){var ctx=mvc.Components.get(id);_.defer(_.bind(function(){this._removed||fn.apply(fnContext,[mvc.Components,ctx,{}])},this))}return this},unbindFromComponent:function(id,fn,fnContext){if(!id)return this;mvc.Components.off("change:"+id,fn,fnContext);return this}});_.extend(BaseSplunkView.prototype,viewloggingmixin);return BaseSplunkView});define("contrib/text!views/shared/splunkbar/AppMenu.html",[],function(){return'<%\n    currentAppname = currentApp ? currentApp.name : \'search\';   // TODO: search fallback is not always safe assumption\n%>\n<a href="#" class="dropdown-toggle"><%- currentApp ? _(\'App: \').t() + _(currentApp.label).t() : _(\'Apps\').t() %><b class="caret"></b></a>\n<div class="dropdown-menu dropdown-menu-selectable dropdown-menu-tall" id="global-apps-menu">\n    <div class="arrow"></div>\n    <ul class="menu-list">\n        <% _.each(apps, function(i) { %>\n        <li>\n            <a href="<%- i.href %>">\n                <% if (currentApp && i.name === currentApp.name) { %> <i class="icon-check"></i><% } %>\n                <% if (i.icon) { %> <img data-icosrc="<%-i.icon%>" alt="menu icon" class="menu-icon" style="display:none;"><% } %>\n                <span class="menu-label"><%- _(i.label).t() %></span>\n            </a>\n        </li>\n        <% }); %>\n    </ul>\n    <ul>\n        <li><a href="<%- make_url(\'manager\', currentAppname, \'apps\',\'local\') %>"><%- _("Manage Apps").t() %></a></li>\n        <% if(canManageRemoteApps){ %>\n        <li id="findMoreAppsNav"><a href="<%- make_url(\'manager\', currentAppname, \'apps\',\'remote\') %>" ><%- _("Find More Apps").t() %></a></li>\n        <%} %>\n    </ul>\n</div>\n'});define("views/shared/splunkbar/AppMenu",["jquery","module","views/Base","views/shared/delegates/Popdown","splunk.util","contrib/text!views/shared/splunkbar/AppMenu.html","uri/route"],function($,module,BaseView,Popdown,splunk_util,appsTemplate,route){return BaseView.extend({moduleId:module.id,template:appsTemplate,tagName:"li",className:"dropdown menu-apps",initialize:function(){this.haveIcons=!1;
BaseView.prototype.initialize.apply(this,arguments);this.options.activeMenu&&"app"===this.options.activeMenu.name&&(this.currentApp=this.model.application.get("app"));this.collection.apps.on("ready change reset",this.debouncedRender,this);this.model.user.on("ready change",this.debouncedRender,this);this.collection.apps.length>0&&this.debouncedRender()},render:function(){this.haveIcons=!1;var app,that=this,curApp=null,apps=this.collection.apps.map(function(model){var appIcon=route.appIconAlt(that.model.application.get("root"),that.model.application.get("locale"),that.model.application.get("owner"),model.entry.get("name"));app={href:splunk_util.make_url("/app/"+model.entry.get("name")),label:model.entry.content.get("label"),name:model.entry.get("name"),icon:appIcon};model.entry.get("name")===that.currentApp&&(curApp=app);return app}),html=this.compiledTemplate({apps:apps,currentApp:curApp,make_url:splunk_util.make_url,canManageRemoteApps:that.model.user.canManageRemoteApps()});this.$el.html(html);this.popdown=new Popdown({el:this.$("#global-apps-menu").parent(),mode:"dialog"});this.popdown.on("show",this.setIcons,this);return this},setIcons:function(){if(!this.haveIcons){this.haveIcons=!0;var icons=this.$el.find(".menu-icon");icons.each(function(index,ico){ico=$(ico);ico.attr("src",ico.attr("data-icosrc")).show()})}}})});define("contrib/text!views/shared/splunkbar/SystemMenuSection.html",[],function(){return"<i class=\"icon icon-<%-this.model.get('icon')%>\"></i>\n<h5><%=this.model.get('label')%></h5>\n<ul class=\"menu\">\n    <% var addedItems = []; %>\n    <%_.each(this.model.get('items'), function(item, i){ %>\n        <% if(_.indexOf(addedItems, item.entry.content.get('menu.label')) === -1) {%>    \n            <li><a href=\"<%-item.get('url')%>\"><%-_(item.entry.content.get('menu.label')).t() || _(item.entry.get('name')).t() || ''%></a></li>\n            <% addedItems.push(item.entry.content.get('menu.label')); %>\n        <%}%>\n    <%});%>\n</ul>\n"});define("views/shared/splunkbar/SystemMenuSection",["jquery","underscore","module","views/Base","contrib/text!views/shared/splunkbar/SystemMenuSection.html"],function($,_,module,BaseView,systemMenuSectionTemplate){return BaseView.extend({moduleId:module.id,template:systemMenuSectionTemplate,className:"menu-section",initialize:function(){BaseView.prototype.initialize.apply(this,arguments);var itemsArray=this.model.get("items");itemsArray.sort(function(a,b){return parseInt(a.get("order"),10)-parseInt(b.get("order"),10)})},render:function(){var html=this.compiledTemplate(this.model);this.$el.html(html);return this}})});define("contrib/text!views/shared/splunkbar/SystemMenu.html",[],function(){return'<a href="#" class="dropdown-toggle"><%- _("Settings").t() %><b class="caret"></b></a>\n<div class="popdown-dialog mega-menu" id="global-system-menu">\n    <div class="arrow"></div>\n    <div class="popdown-dialog-body">\n    </div><!-- /.popdown-dialog-body -->\n</div><!-- /.podown -->'});define("views/shared/splunkbar/SystemMenu",["jquery","underscore","backbone","module","splunk.util","views/Base","views/shared/delegates/Popdown","views/shared/splunkbar/SystemMenuSection","contrib/text!views/shared/splunkbar/SystemMenu.html"],function($,_,Backbone,module,splunk_util,BaseView,Popdown,SystemMenuSection,systemMenuTemplate){return BaseView.extend({moduleId:module.id,template:systemMenuTemplate,tagName:"li",className:"dropdown menu-system",initialize:function(){var self=this;BaseView.prototype.initialize.apply(this,arguments);self.debouncedRender();this.collection.sections.on("ready",function(){self.debouncedRender()},this)},render:function(){var html=this.compiledTemplate({}),$html=$(html),$menu=$html.find(".popdown-dialog-body");this.addSections($menu);this.sectionCount<2&&$menu.parent().addClass("mega-menu-narrow");this.$el.html($html);var popup=this.$el.find("#global-system-menu");this.children.popdown=new Popdown({el:popup.parent(),mode:"dialog"});return this},addSections:function($menu){var self=this;this.sectionCount=0;this.collection.sections.each(function(section){if(!section.get("items")||0!==section.get("items").length){var sectionView=self.children[section.get("id")]=new SystemMenuSection({model:section});self.sectionCount++;$menu.append(sectionView.render().el)}})}})});define("contrib/text!views/shared/splunkbar/UserMenu.html",[],function(){return'<a href="#" class="dropdown-toggle"><span class="realname"><%-realName%></span><b class="caret"></b></a>\n<div class="dropdown-menu dropdown-menu-narrow global-user-menu">\n    <div class="arrow"></div>\n    <ul>\n        <li><a href="<%-accountLink%>" class="edit"><%- _("Edit Account").t() %></a></li>\n        <% if (logoutLink) { %>\n        <li><a href="<%-logoutLink%>" class="logout"><%- _("Logout").t() %></a></li>\n        <% } %>\n    </ul>\n</div>'});define("views/shared/splunkbar/UserMenu",["underscore","module","views/Base","views/shared/delegates/Popdown","contrib/text!views/shared/splunkbar/UserMenu.html","uri/route"],function(_,module,BaseView,Popdown,userMenuTemplate,route){return BaseView.extend({moduleId:module.id,template:userMenuTemplate,tagName:"li",className:"dropdown user",initialize:function(){BaseView.prototype.initialize.apply(this,arguments);this.model.user.on("change",this.render,this);this.model.webConf.on("change reset",this.render,this);this.model.user.entry.get("name")&&this.render()},checkSSO:function(){var trustedIP=this.model.webConf&&this.model.webConf.entry&&this.model.webConf.entry.content&&this.model.webConf.entry.content.get("trustedIP");this.SSOModeOn="string"==typeof trustedIP&&trustedIP.length>0&&this.model.config&&"string"==typeof this.model.config.get("REMOTE-USER")},render:function(){this.checkSSO();var realName=this.model.user.entry.content.get("realname"),userName=this.model.user.entry.get("name");realName&&realName.length||(realName=userName);var rootUrl=this.model.application.get("root"),locale=this.model.application.get("locale"),accountLink=route.manager(rootUrl,locale,this.model.application.get("app"),["authentication","changepassword",userName],{data:{action:"edit"}}),logoutLink=this.SSOModeOn?null:route.logout(rootUrl,locale),html=this.compiledTemplate({userName:userName,realName:realName,accountLink:accountLink,logoutLink:logoutLink});this.$el.html(html);var popup=this.$el.find(".global-user-menu");this.popdown=new Popdown({el:popup.parent(),mode:"dialog"});return this}})});define("views/shared/delegates/StopScrollPropagation",["jquery","underscore","views/shared/delegates/Base"],function($,_,DelegateBase){return DelegateBase.extend({initialize:function(){var defaults={selector:""};_.defaults(this.options,defaults);this.events={};this.events["mousewheel "+this.options.selector]="mousewheel";this.events["DOMMouseScroll "+this.options.selector]="mousewheel";this.delegateEvents(this.events)},mousewheel:function(e){var delta=-e.originalEvent.wheelDelta||20*e.originalEvent.detail;e.currentTarget.scrollTop+=delta;e.stopPropagation();e.preventDefault()}})});define("models/services/Message",["models/SplunkDBase"],function(SplunkDBaseModel){return SplunkDBaseModel.extend({url:"messages",initialize:function(){SplunkDBaseModel.prototype.initialize.apply(this,arguments)}})});define("collections/services/Messages",["jquery","models/services/Message","collections/SplunkDsBase"],function($,MessageModel,SplunkDsBaseCollection){return SplunkDsBaseCollection.extend({model:MessageModel,url:"messages",initialize:function(){SplunkDsBaseCollection.prototype.initialize.apply(this,arguments)},destroyAll:function(){if(this.destroying===!0)return this.destroyDFD;this.destroying=!0;var that=this;this.destroyDFD=new $.Deferred(function(dfd){function destroyNext(){var dummyDefered=new $.Deferred;if(that.length>0){var model=that.pop(),destroyPromise=model.destroy()||dummyDefered.resolve().promise();destroyPromise.always(destroyNext);return destroyPromise}dfd.resolve()}destroyNext()});this.destroyDFD.then(function(){that.destroying=!1});return this.destroyDFD.promise()}})});define("views/shared/splunkbar/messages/Message",["jquery","underscore","backbone","module","views/Base","splunk.util","util/time"],function($,_,Backbone,module,BaseView,splunk_util,time_utils){return BaseView.extend({moduleId:module.id,className:"view-navbar-global navbar navbar-fixed-top",messageMap:{restart_required:_("Splunk must be restarted for changes to take effect. [[/manager/search/control|Click here to restart from the Manager]].").t()},initialize:function(){BaseView.prototype.initialize.apply(this,arguments)},render:function(){var msg,msgFullId=this.model.id,msgId=this.model.entry.get("name")||"",msgLevel=this.model.entry.content.get("severity")||"warn";msg=msgId&&this.messageMap[msgId]?this.messageMap[msgId]:this.model.entry.content.get("message")||"";var msgTime=this.model.entry.content.get("timeCreated_iso");if(msgTime){var dateObj=time_utils.isoToDateObject(msgTime);msgTime=dateObj.toLocaleString()}var html=this.compiledTemplate({msgId:msgId,msgFullId:msgFullId,msg:splunk_util.getWikiTransform(msg),msgLevel:msgLevel,msgTime:msgTime||""});this.$el=$(html);return this},template:'<li class="<%- msgLevel %>" data-id="<%- msgFullId %>">                <i class="message-icon icon-<%- msgLevel %>"></i>                <span class="message-content"><%= msg %></span>                <span class="message-time"><%= msgTime %></span>                <a href="#" class="delete-message"><i class="icon-x-circle"></i></a>            </li>'})});define("views/shared/splunkbar/messages/LegacyMessage",["jquery","underscore","backbone","module","views/Base","splunk.util"],function($,_,Backbone,module,BaseView,splunk_util){return BaseView.extend({moduleId:module.id,className:"view-navbar-global navbar navbar-fixed-top",messageMap:{restart_required:_("Splunk must be restarted for changes to take effect. [[/manager/search/control|Click here to restart from the Manager]].").t()},initialize:function(){BaseView.prototype.initialize.apply(this,arguments)},render:function(){var msg,msgId=(this.model.get("id")||"").toLowerCase(),msgLevel=this.model.get("severity")||"warn";msg=msgId&&this.messageMap[msgId]?this.messageMap[msgId]:this.model.get("content")||"";var html=this.compiledTemplate({msgId:msgId,msg:splunk_util.getWikiTransform(msg),msgLevel:msgLevel});this.$el=$(html);return this},template:'<li class="<%- msgLevel %>" data-islegacy="1" data-id="<%- msgId %>">                <span class="message-content"><%= msg %></span>                <a href="#" class="delete-message"><i class="icon-x-circle"></i></a>            </li>'})});define("contrib/text!views/shared/splunkbar/messages/Master.html",[],function(){return'<a href="#" class="dropdown-toggle">\n    <span class="label label-warning" style="display: none;"><%- collection.length %></span> <%- _("Messages").t() %><b class="caret"></b>\n</a>\n<div class="dropdown-menu" id="global-messages-menu">\n\n    <div class="arrow"></div>\n    <ul class="message-list" style="display: none;">\n    </ul>\n    <div class="no-messages">\n        <%- _("You have no messages.").t() %>\n    </div>\n    <div class="popdown-dialog-footer" style="display: none;">\n        <a href="#" class="delete-all-messages btn pull-right"><%- _("Delete All").t() %></a>\n    </div>\n</div>\n'});define("views/shared/splunkbar/messages/Master",["jquery","underscore","module","views/Base","views/shared/delegates/Popdown","views/shared/delegates/StopScrollPropagation","collections/services/Messages","views/shared/splunkbar/messages/Message","views/shared/splunkbar/messages/LegacyMessage","contrib/text!views/shared/splunkbar/messages/Master.html","util/general_utils"],function($,_,module,BaseView,Popdown,StopScrollPropagation,MessagesCollection,MessageView,LegacyMessageView,MasterTemplate,general_utils){return BaseView.extend({moduleId:module.id,template:MasterTemplate,tagName:"li",className:"dropdown messages",initialize:function(){BaseView.prototype.initialize.apply(this,arguments);this.legacyMessages=this.collection.legacyMessages||!1;this.collection=this.collection.messages;this.collection.on("change reset remove",this.renderMessages,this);this.legacyMessages&&this.legacyMessages.on("reset remove",this.renderMessages,this);this.isLocalMouseSelection=!1},events:{"click .message-list .delete-message":"deleteMessage","click .delete-all-messages":"deleteAllMessages","mouseup .message-list":function(){this.isLocalMouseSelection=!0}},render:function(){var html=this.compiledTemplate({collection:this.collection});this.$el.html(html);this.children.popdown=new Popdown({el:this.el,mode:"dialog"});this.children.stopScrollPropagation=new StopScrollPropagation({el:this.$("#global-messages-menu ul"),mode:"dialog"});return this},renderMessages:function(forceUpdate){if(!(forceUpdate!==!0&&this.isLocalMouseSelection&&general_utils.getMouseSelection()&&general_utils.getMouseSelection().length>0)){this.isLocalMouseSelection=!1;var numMessages=this.collection.length;this.legacyMessages&&(numMessages+=this.legacyMessages.length);this.$(".label-warning").text(numMessages);_.each(this.children,function(view,key){if("message"==key.substr(0,7)){this.children[key].remove();delete this.children[key]}},this);var messageView;this.collection.each(function(model){messageView=new MessageView({model:model});this.children["message"+model.get("id")]=messageView;this.$("#global-messages-menu .message-list").append(messageView.render().$el)},this);var numLegacyMessages=0;if(this.legacyMessages){numLegacyMessages=this.legacyMessages.length;this.legacyMessages.each(function(model){messageView=new LegacyMessageView({model:model});this.children["messageLegacy"+model.get("id")]=messageView;this.$("#global-messages-menu .message-list").append(messageView.render().$el)},this)}if(this.collection.length>0||numLegacyMessages>0){this.$(".label-warning, .popdown-dialog-footer, .message-list").show();this.$("#global-messages-menu").addClass("dropdown-menu-wide");this.$(".no-messages").hide();this.$("#global-messages-menu").is(":visible")&&this.children.popdown.adjustPosition()}else{this.$(".label-warning, .popdown-dialog-footer, .message-list").hide();this.$("#global-messages-menu").removeClass("dropdown-menu-wide");this.$(".no-messages").show()}}},deleteMessage:function(evt){evt.preventDefault();var toRemove,$li=$(evt.currentTarget).parent(),id=$li.data("id"),isLegacy=$li.data("islegacy");if(this.legacyMessages&&isLegacy){toRemove=this.legacyMessages.get(id);toRemove&&this.legacyMessages.remove(toRemove)}else{toRemove=this.collection.get(id);toRemove&&toRemove.destroy()}0!==this.collection.length||this.legacyMessages!==!1&&0!==this.legacyMessages.length||this.children.popdown.hide();this.renderMessages(!0)},deleteAllMessages:function(evt){evt.preventDefault();this.collection.destroyAll();this.legacyMessages&&this.legacyMessages.reset();this.children.popdown.hide()}})});define("contrib/text!views/shared/splunkbar/ActivityMenu.html",[],function(){return'<a href="#" class="dropdown-toggle"><%- _("Activity").t() %><b class="caret"></b></a>\n<div class="dropdown-menu dropdown-menu-narrow" id="global-activity-menu">\n    <div class="arrow"></div>\n    <ul>\n        <li>\n            <a class="primary-link" href="<%= jobLink %>"><%- _("Jobs").t() %></a>\n            <a class="secondary-link" href="<%= jobLink %>" target="_blank"><i class="icon-external"></i></a>\n        </li>\n        <li>\n            <a class="primary-link" href="<%= alertsLink %>"><%- _("Triggered Alerts").t() %></a>\n            <a class="secondary-link" href="<%= alertsLink %>" target="_blank"><i class="icon-external"></i></a>\n        </li>\n	<% if (typeof statusLink !== "undefined" && statusLink !== null) { %>\n		<li>\n		    <a class="primary-link" href="<%= statusLink %>"><%- _("System Activity").t() %></a>\n		    <a class="secondary-link" href="<%= statusLink %>" target="_blank"><i class="icon-external"></i></a>\n		</li>\n	<% } %>\n    </ul>\n</div>\n'});define("views/shared/splunkbar/ActivityMenu",["underscore","jquery","module","views/Base","views/shared/delegates/Popdown","contrib/text!views/shared/splunkbar/ActivityMenu.html","splunk.util","uri/route"],function(_,$,module,BaseView,Popdown,activityMenuTemplate,splunk_util,route){return BaseView.extend({moduleId:module.id,template:activityMenuTemplate,tagName:"li",className:"dropdown activity",initialize:function(){BaseView.prototype.initialize.apply(this,arguments);this.render();this.model.application.on("change",this.render);this.model.user.on("change",this.render)},render:function(){if("undefined"==typeof this.model.application.get("app")||"undefined"==typeof this.model.user.entry.content.get("roles"))return this;var app=this.model.application.get("app"),isAdmin=this.model.user.entry.content.get("roles").indexOf("admin")>-1,jobLink=route.page(this.model.application.get("root"),this.model.application.get("locale"),app,"job_management"),alertsLink=route.triggeredAlerts(this.model.application.get("root"),this.model.application.get("locale"),app),statusLink=null;"system"==app&&(jobLink=route.page(this.model.application.get("root"),this.model.application.get("locale"),"search","job_management"));isAdmin&&(statusLink=route.page(this.model.application.get("root"),this.model.application.get("locale"),"search","status_index"));var html=this.compiledTemplate({jobLink:jobLink,alertsLink:alertsLink,statusLink:statusLink});this.$el.html(html);this.children.popdown=new Popdown({el:this.el,mode:"dialog"});return this}})});define("views/shared/controls/TextControl",["underscore","module","views/shared/controls/Control"],function(_,module,Control){return Control.extend({moduleId:module.id,initialize:function(){var defaults={inputClassName:"",placeholder:"",prepend:!1,append:!1,useSyntheticPlaceholder:!1,trimLeadingSpace:!0,trimTrailingSpace:!0,password:!1,updateOnKeyUp:!1};_.defaults(this.options,defaults);this.options.placeholder&&!this.supportsNativePlaceholder()&&(this.options.useSyntheticPlaceholder=!0);this.options.modelAttribute&&this.$el.attr("data-name",this.options.modelAttribute);this.options.updateOnKeyUp&&this.listenTo(this,"keyup",this.onInputChange);Control.prototype.initialize.apply(this,arguments)},events:{"change input":function(){this.onInputChange()},"click .placeholder":function(){this.$input.focus()},"keyup input":function(e){this.updatePlaceholder();this.trigger("keyup",e,this.$input.val())},"mouseup input":function(){this.updatePlaceholder()}},onInputChange:function(){var inputValue=this.$input.val();this.options.trimLeadingSpace&&(inputValue=inputValue.replace(/^\s+/g,""));this.options.trimTrailingSpace&&(inputValue=inputValue.replace(/\s+$/g,""));this.setValue(inputValue,!1);this.updatePlaceholder()},updatePlaceholder:function(){this.options.useSyntheticPlaceholder&&this.$placeholder[""===this.$input.val()?"show":"hide"]()},supportsNativePlaceholder:function(){return"placeholder"in document.createElement("input")},disable:function(){this.$input.hide();this.$disabledInput.css("display","inline-block")},enable:function(){this.$input.show();this.$disabledInput.hide()},render:function(){if(this.el.innerHTML){this.$input.val(this._value);this.$disabledInput.text(this._value)}else{var template=_.template(this.template,{options:this.options,value:this._value||""});this.$el.html(template);this.$input=this.$("input");this.$disabledInput=this.$(".uneditable-input");this.options.useSyntheticPlaceholder&&(this.$placeholder=this.$(".placeholder"));this.options.prepend&&this.$el.addClass("input-prepend").prepend(this.options.prepend);this.options.append&&this.$el.addClass("input-append").append(this.options.append)}this.updatePlaceholder();var additionalClassNames=this.options.additionalClassNames;additionalClassNames&&this.$el.addClass(additionalClassNames);return this},template:'        <span class="uneditable-input <%= options.inputClassName %>"             <% if(options.enabled){ %>style="display:none"<%}%>><%- value %></span>        <input type="<% if (options.password){%>password<%}else{%>text<%}%>"                name="<%- options.modelAttribute || "" %>"                class="<%= options.inputClassName %>"                value="<%- value %>"                <% if(options.placeholder && !options.useSyntheticPlaceholder){ %>placeholder="<%- options.placeholder %>"<%}%>                <% if(!options.enabled){ %>style="display:none"<%}%>>            <% if (options.useSyntheticPlaceholder) { %> <span class="placeholder"><%- options.placeholder %></span><% } %>        '})});!function($){$(function(){$.support.transition=function(){var transitionEnd=function(){var name,el=document.createElement("bootstrap"),transEndEventNames={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(name in transEndEventNames)if(void 0!==el.style[name])return transEndEventNames[name]}();return transitionEnd&&{end:transitionEnd}}()})}(window.jQuery);define("bootstrap.transition",["jquery"],function(){});define("views/shared/Modal",["jquery","underscore","views/Base","bootstrap.transition","bootstrap.modal"],function($,_,Base){var CLASS_NAME="modal fade",CLASS_MODAL_WIDE="modal-wide",HEADER_CLASS="modal-header",BODY_CLASS="modal-body modal-body-scrolling",FOOTER_CLASS="modal-footer",HEADER_SELECTOR="."+HEADER_CLASS,HEADER_TITLE_SELECTOR=HEADER_SELECTOR+" > h3",LOADING_CLASS="modal-loading",LOADING_SELECTOR="."+LOADING_CLASS,LOADING_HORIZONTAL='<div class="'+LOADING_CLASS+'"></div>',BODY_SELECTOR=".modal-body",BODY_FORM_SELECTOR=BODY_SELECTOR+" > div.form",FORM_HORIZONTAL='<div class="form form-horizontal"></div>',FORM_HORIZONTAL_COMPLEX='<div class="form form-horizontal form-complex"></div>',FORM_HORIZONTAL_JUSTIFIED='<div class="form form-horizontal form-justified"></div>',FOOTER_SELECTOR="."+FOOTER_CLASS,BUTTON_CANCEL='<a href="#" class="btn cancel modal-btn-cancel pull-left" data-dismiss="modal">'+_("Cancel").t()+"</a>",BUTTON_BACK='<a href="#" class="btn back modal-btn-back">'+_("Back").t()+"</a>",BUTTON_SAVE='<a href="#" class="btn btn-primary modal-btn-primary pull-right">'+_("Save").t()+"</a>",BUTTON_DONE='<a href="#" class="btn btn-primary modal-btn-primary pull-right" data-dismiss="modal">'+_("Done").t()+"</a>",BUTTON_DELETE='<a href="#" class="btn btn-primary modal-btn-primary">'+_("Delete").t()+"</a>",BUTTON_NEXT='<a href="#" class="btn btn-primary modal-btn-primary">'+_("Next").t()+"</a>",BUTTON_CONTINUE='<a href="#" class="btn modal-btn-continue pull-left" data-dismiss="modal">'+_("Continue Editing").t()+"</a>",TEMPLATE='                <div class="'+HEADER_CLASS+'">                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>                    <h3 class="modal-title">&nbsp;</h3>                </div>                <div class="'+BODY_CLASS+'">                </div>                <div class="'+FOOTER_CLASS+'">                </div>            ',KEY_CODES={ENTER:13,TAB:9},INPUT_SELECTOR='.btn, input[type="text"], input[type="password"], textarea';return Base.extend({className:CLASS_NAME,attributes:{style:"display:none",tabIndex:-1},initialize:function(){Base.prototype.initialize.apply(this,arguments);var defaults={show:!1,keyboard:!0,backdrop:!0};this.keydownEventCode=null;this.keydownEventTarget=null;this.$el.modal(_.extend({},defaults,_.pick(this.options,["backdrop","keyboard","show","remote"])));this.shown=!1;this.options.onHiddenRemove&&this.on("hidden",this.remove,this)},events:{show:function(e){e.target===e.currentTarget&&this.trigger("show")},shown:function(e){if(e.target===e.currentTarget){this.shown=!0;var $textInputs=this.$(INPUT_SELECTOR),textInputsLength=$textInputs.length;if(textInputsLength>0)for(var i=0;textInputsLength>i;i++){var $textInput=$($textInputs[i]);if($textInput.is(":visible")&&"hidden"!==$textInput.css("visibility")){$textInput.focus();break}}this.trigger("shown")}},hide:function(e){e.target===e.currentTarget&&this.trigger("hide")},hidden:function(e){if(e.target===e.currentTarget){this.shown=!1;this.trigger("hidden")}},keydown:function(e){var keyCode=e.which;this.keydownEventCode=e.which;this.keydownEventTarget=e.target;if(keyCode===KEY_CODES.TAB){var tabbableSelectors="a[href]:not(.synthetic-select), area[href], input:not([disabled]),select:not([disabled]), textarea:not([disabled]),button:not([disabled]), iframe, object, embed, *[tabindex],*[contenteditable]",tabbableElements=this.el.querySelectorAll(tabbableSelectors);tabbableElements=_.uniq(tabbableElements);for(var i=0;i<tabbableElements.length;i++){var $tabbableElement=$(tabbableElements[i]);if(!$tabbableElement.is(":visible")||"hidden"===$tabbableElement.css("visibility")){tabbableElements.splice(i,1);i--}}var firstElement=tabbableElements[0],lastElement=tabbableElements[tabbableElements.length-1];if(_.contains(tabbableElements,e.target)){e.preventDefault();e.target!==lastElement||e.shiftKey?e.target===firstElement&&e.shiftKey?lastElement.focus():e.shiftKey?tabbableElements[_.indexOf(tabbableElements,e.target)-1].focus():tabbableElements[_.indexOf(tabbableElements,e.target)+1].focus():firstElement.focus()}}},keyup:function(e){var keyCode=e.which;if(keyCode===KEY_CODES.ENTER&&this.keydownEventCode===KEY_CODES.ENTER){var $target=$(e.target);e.target!==this.keydownEventTarget&&$(this.keydownEventTarget).is("input")&&"text"===$(this.keydownEventTarget).attr("type")&&($target=$(this.keydownEventTarget));if($target.is("input")&&"text"===$target.attr("type")&&1===this.$el.find(".btn-primary:visible").length){$target.is(INPUT_SELECTOR)&&$target.blur();e.preventDefault();this.keydownEventCode=null;this.keydownEventTarget=null;this.$el.find(".btn-primary:visible").click()}}}},hide:function(){this.$el.modal("hide")},show:function(){this.$el.modal("show")},toggle:function(){this.$el.modal("toggle")},remove:function(){this.shown&&this.hide();Base.prototype.remove.apply(this,arguments)}},{CLASS_NAME:CLASS_NAME,CLASS_MODAL_WIDE:CLASS_MODAL_WIDE,HEADER_CLASS:HEADER_CLASS,BODY_CLASS:BODY_CLASS,FOOTER_CLASS:FOOTER_CLASS,HEADER_SELECTOR:HEADER_SELECTOR,HEADER_TITLE_SELECTOR:HEADER_TITLE_SELECTOR,BODY_SELECTOR:BODY_SELECTOR,BODY_FORM_SELECTOR:BODY_FORM_SELECTOR,LOADING_CLASS:LOADING_CLASS,LOADING_SELECTOR:LOADING_SELECTOR,LOADING_HORIZONTAL:LOADING_HORIZONTAL,FOOTER_SELECTOR:FOOTER_SELECTOR,TEMPLATE:TEMPLATE,FORM_HORIZONTAL:FORM_HORIZONTAL,FORM_HORIZONTAL_COMPLEX:FORM_HORIZONTAL_COMPLEX,FORM_HORIZONTAL_JUSTIFIED:FORM_HORIZONTAL_JUSTIFIED,BUTTON_CANCEL:BUTTON_CANCEL,BUTTON_BACK:BUTTON_BACK,BUTTON_SAVE:BUTTON_SAVE,BUTTON_CONTINUE:BUTTON_CONTINUE,BUTTON_DELETE:BUTTON_DELETE,BUTTON_DONE:BUTTON_DONE,BUTTON_NEXT:BUTTON_NEXT})});define("contrib/text!views/shared/whatsnewdialog/Master.html",[],function(){return'<h2><%=_("Empower More People").t()%></h2>\n<div class="feature">\n    <h3><%=_("Dashboard Editor Enhancements").t()%></h3>\n    <p><%=_("Build rich, dynamic dashboards with a point-and-click UI.").t()%></p>\n    <a href="<%=docLink%>whatsnew.dashboardeditor" class="external" target="_blank"><%=_("Documentation").t()%></a>\n</div>\n\n<div class="feature">\n    <h3><%=_("Contextual Drilldown").t()%></h3>\n    <p><%=_("Easy access to contextual information and analytics without leaving the page.").t()%></p>\n    <a href="<%=docLink%>whatsnew.contextualdrill" class="external" target="_blank"><%=_("Documentation").t()%></a>\n</div>\n\n<div class="feature">\n    <h3><%=_("Chart Overlay").t()%></h3>\n    <p><%=_("Plot disparate data on top of each other to visualize trends.").t()%></p>\n    <a href="<%=docLink%>whatsnew.chartoverlay" class="external" target="_blank"><%=_("Documentation").t()%></a>\n</div>\n\n<div class="feature">\n    <h3><%=_("Data Model Enhancements").t()%></h3>\n    <p><%=_("Create and share data models more easily via the new Data Model builder.").t()%></p>\n    <a href="<%=docLink%>whatsnew.newdatamodel" class="external" target="_blank"><%=_("Documentation").t()%></a>\n</div>\n\n<div class="feature">\n    <h3><%=_("Pan and Zoom Chart Controls").t()%></h3>\n    <p><%=_("Intuitively explore large amounts of data in your visualizations.").t()%></p>\n    <a href="<%=docLink%>whatsnew.panandzoom" class="external" target="_blank"><%=_("Documentation").t()%></a>\n</div>\n\n<h2><%=_("Mission Critical Enterprise").t()%></h2>\n<div class="feature">\n    <h3><%=_("Multi-site Clustering").t()%></h3>\n    <p><%=_("Site aware index replication across multiple locations for high availability of data in the event of an entire site failure.").t()%></p>\n    <a href="<%=docLink%>whatsnew.multisite" class="external" target="_blank"><%=_("Documentation").t()%></a>\n</div>\n\n<div class="feature">\n    <h3><%=_("Search Affinity").t()%></h3>\n    <p><%=_("Increase search efficiency with site-aware index replication so that search heads can distribute searches based on location.").t()%></p>\n    <a href="<%=docLink%>whatsnew.searchaffinity" class="external" target="_blank"><%=_("Documentation").t()%></a>\n</div>\n\n<div class="feature">\n    <h3><%=_("Data Preview with Structured Inputs").t()%></h3>\n    <p><%=_("View and interact with fields found in a file header or within the body of your structured data source.").t()%></p>\n    <a href="<%=docLink%>whatsnew.previewstructured" class="external" target="_blank"><%=_("Documentation").t()%></a>\n</div>\n\n<div class="feature">\n    <h3><%=_("zLinux Forwarder").t()%></h3>\n    <p><%=_("Expand your ability to collect data from Mainframes running the zLinux operating system.").t()%></p>\n    <a href="<%=docLink%>whatsnew.zlinuxforwarder" class="external" target="_blank"><%=_("Documentation").t()%></a>\n</div>\n\n<div class="feature">\n    <h3><%=_("Low Privilege Windows Universal Forwarder").t()%></h3>\n    <p><%=_("Run the Splunk Universal forwarder on Windows platforms as a domain user without having to grant local administrator privileges.").t()%></p>\n    <a href="<%=docLink%>whatsnew.windowsforwarder" class="external" target="_blank"><%=_("Documentation").t()%></a>\n</div>\n\n\n\n\n<h2><%=_("Better Collaboration").t()%></h2>\n<div class="feature">\n    <h3><%=_("Custom Email Alerts").t()%></h3>\n    <p><%=_("Create actionable alerts by controlling both the content and format of the email.").t()%></p>\n    <a href="<%=docLink%>whatsnew.newemailalerts" class="external" target="_blank"><%=_("Documentation").t()%></a>\n</div>\n\n<div class="feature">\n    <h3><%=_("Embedded Reports").t()%></h3>\n    <p><%=_("Combine Splunk charts with any HTML-based dashboard or web-page with simplified sharing controls.").t()%></p>\n    <a href="<%=docLink%>whatsnew.embeddedreports" class="external" target="_blank"><%=_("Documentation").t()%></a>\n</div>\n'});define("views/shared/whatsnewdialog/Master",["jquery","underscore","module","views/Base","views/shared/Modal","uri/route","splunk.util","contrib/text!views/shared/whatsnewdialog/Master.html"],function($,_,module,Base,Modal,route,splunk_util,Template){return Modal.extend({moduleId:module.id,template:Template,initialize:function(){Modal.prototype.initialize.apply(this,arguments);var self=this;this.on("hidden",function(){self.$el.remove();self.modalWrapper.remove()});this.render()},render:function(){var imgPath=splunk_util.make_url("/static/img/"),docLink=route.docHelp(this.model.application.get("root"),this.model.application.get("locale"),""),template=this.compiledTemplate({imgPath:imgPath,docLink:docLink});this.$el.html(Modal.TEMPLATE);this.$(Modal.HEADER_TITLE_SELECTOR).html(_("What's new in 6.1").t());this.$(Modal.BODY_SELECTOR).html(template);this.modalWrapper=$('<div class="splunk-components"></div>');$(this.el).appendTo(this.modalWrapper);this.modalWrapper.appendTo("body");this.show();return this}})});define("contrib/text!views/shared/splunkbar/HelpMenu.html",[],function(){return'<a href="#" class="dropdown-toggle"><%- _("Help").t() %><b class="caret"></b></a>\n<div class="dropdown-menu" id="global-help-menu">\n    <div class="arrow"></div>\n    <ul>\n        <li><a class="whatsnew" href="#"><%- _("What\'s New in 6.1").t() %></a></li>\n        <li><a class="external" href="<%- makeDocLink(\'search_app.tutorial\') %>" target="_blank"><%- _("Tutorials").t() %></a></li>\n        <li><a class="external" href="http://splunk-base.splunk.com/" target="_blank"><%- _("Splunk Answers").t() %></a></li>\n        <li><a class="external" href="http://www.splunk.com/support" target="_blank"><%- _("Contact Support").t() %></a></li>\n        <li><a class="external" href="<%- docLink %>" target="_blank"><%- _("Documentation").t() %></a></li>\n    </ul>\n    <form class="form-search" action="#help" method="get">\n    </form>\n</div>\n'
});define("views/shared/splunkbar/HelpMenu",["underscore","jquery","module","views/Base","views/shared/delegates/Popdown","views/shared/controls/TextControl","views/shared/whatsnewdialog/Master","contrib/text!views/shared/splunkbar/HelpMenu.html","splunk.util","uri/route"],function(_,$,module,BaseView,Popdown,TextControl,WhatsNewDialogView,helpMenuTemplate,splunk_util,route){return BaseView.extend({moduleId:module.id,template:helpMenuTemplate,tagName:"li",className:"dropdown help",initialize:function(){BaseView.prototype.initialize.apply(this,arguments);this.children.searchInput=new TextControl({placeholder:_("Search Documentation").t(),inputClassName:"input-medium search-query"});this.model.appLocal.on("change reset",this.debouncedRender,this);this.debouncedRender()},events:{"keypress input":"onDocsSearch","click .whatsnew":"onWhatsNew","click .dropdown-menu a":"closePopdown"},render:function(){var html=this.compiledTemplate({docLink:this.makeDocLinkForPage(),makeDocLink:this.makeDocLink.bind(this)});this.$el.html(html);var popup=this.$("#global-help-menu");popup.find(".form-search").append(this.children.searchInput.render().el);this.children.popdown=new Popdown({el:popup.parent(),mode:"dialog"});return this},onDocsSearch:function(evt){if(13===evt.keyCode){var s=$(evt.target).val();evt.preventDefault();evt.stopPropagation();$.when(this.serverInfoDfd).then(function(){var url=route.docSearch(this.model.application.get("locale"),this.model.serverInfo.entry.content.get("version"),splunk_util.normalizeBoolean(this.model.serverInfo.entry.content.get("isFree")),splunk_util.normalizeBoolean(this.model.serverInfo.entry.content.get("isTrial")),s);window.open(url)}.bind(this));$(evt.target).val("");this.closePopdown();evt.preventDefault()}},makeDocLink:function(location){return route.docHelpInAppContext(this.model.application.get("root"),this.model.application.get("locale"),location,this.model.application.get("app"),this.model.appLocal.entry.content.get("version"),this.model.appLocal.appAllowsDisable(),this.model.appLocal.entry.content.get("docs_section_override"))},makeDocLinkForPage:function(){var location,link="/help";if("_admin"===this.model.application.get("page")){location="manager";if(window&&window.location&&"string"==typeof window.location.pathname){var pathname=window.location.pathname;pathname=pathname.substring(pathname.indexOf("/manager/")+9);pathname=pathname.substring(pathname.indexOf("/")+1);pathname=pathname.replace(new RegExp("/","g"),".");location+="."+pathname}link=route.docHelp(this.model.application.get("root"),this.model.application.get("locale"),location)}else{location=["app",this.model.application.get("app"),this.model.application.get("page")].join(".");link=this.makeDocLink(location)}return link},onWhatsNew:function(e){e&&e.preventDefault();this.children.whatsNewDialog=new WhatsNewDialogView({model:this.model})},closePopdown:function(){this.children.popdown.hide()}})});define("views/shared/WaitSpinner",["underscore","module","views/Base"],function(_,module,BaseView){return BaseView.extend({moduleId:module.id,tagName:"div",initialize:function(){var defaults={size:"small",color:"gray",frameWidth:14,frameCount:8,fps:10};_.defaults(this.options,defaults);BaseView.prototype.initialize.apply(this,arguments);this.$el.addClass("spinner-"+this.options.size+"-"+this.options.color);this.frame=0},stop:function(){this.active=!1;this.interval&&window.clearInterval(this.interval);return this},start:function(){this.active=!0;this.interval&&window.clearInterval(this.interval);this.interval=setInterval(this.step.bind(this),1e3/this.options.fps);return this},step:function(){this.$el.css("backgroundPosition","-"+this.frame*this.options.frameWidth+"px top ");this.frame++;this.frame=this.frame==this.options.frameCount?0:this.frame;return this},remove:function(){this.stop();BaseView.prototype.remove.apply(this,arguments)},render:function(){return this}})});define("contrib/text!views/shared/splunkbar/messages/NoConnectionOverlay.html",[],function(){return'<div class="modal-backdrop fade in"></div>\n<div class="modal disconnection-warning-modal">\n	<h3><%= _("Reconnecting to Splunk server").t() %></h3>\n	<p><%= _("Your network connection may have been lost or Splunk server may be down.").t() %></p>\n</div>\n'});define("views/shared/splunkbar/messages/NoConnectionOverlay",["underscore","module","views/Base","views/shared/WaitSpinner","contrib/text!views/shared/splunkbar/messages/NoConnectionOverlay.html","splunk.util"],function(_,module,BaseView,WaitSpinnerView,Template,splunkUtil){var image=new Image;image.src=splunkUtil.make_url("/static/img/skins/default/loading_medium_green.png");var image2x=new Image;image2x.src=splunkUtil.make_url("/static/img/skins/default/loading_medium_green_2x.png");return BaseView.extend({moduleId:module.id,template:Template,className:"splunk-components",initialize:function(){BaseView.prototype.initialize.apply(this,arguments);var spinnerOptions={color:"green",size:"medium",frameWidth:19};this.children.spinner=new WaitSpinnerView(spinnerOptions);this.visible=!1;this.$el.hide()},show:function(){if(!this.visible){this.visible=!0;this.$el.show();this.children.spinner.start()}},hide:function(){if(this.visible){this.visible=!1;this.$el.hide();this.children.spinner.stop()}},render:function(){this.$el.html(this.compiledTemplate);this.$(".modal").append(this.children.spinner.render().el);return this}})});define("models/services/data/UserPref",["models/SplunkDBase"],function(SplunkDBaseModel){return SplunkDBaseModel.extend({url:"data/user-prefs",id:"data/user-prefs/general",initialize:function(){SplunkDBaseModel.prototype.initialize.apply(this,arguments)}})});define("models/services/server/ServerInfo",["models/SplunkDBase","splunk.util"],function(SplunkDBaseModel,splunk_util){return SplunkDBaseModel.extend({urlRoot:"server/info",id:"server-info",initialize:function(){SplunkDBaseModel.prototype.initialize.apply(this,arguments)},hasAddOn:function(addOn){var addOns=this.entry.content.get("addOns");return addOns?addOns.hasOwnProperty(addOn):!1},hasHadoopAddon:function(){return this.hasAddOn("hadoop")},isFreeLicense:function(){return splunk_util.normalizeBoolean(this.entry.content.get("isFree"))},hasEnterpriseLicense:function(){return"Enterprise"==this.entry.content.get("activeLicenseGroup")},getBranding:function(){return this.entry.content.get("product_type")}})});define("models/services/configs/Web",["models/SplunkDBase"],function(SplunkDBaseModel){return SplunkDBaseModel.extend({url:"configs/conf-web",urlRoot:"configs/conf-web",initialize:function(){SplunkDBaseModel.prototype.initialize.apply(this,arguments)}})});define("models/services/authentication/CurrentContext",["models/SplunkDBase"],function(SplunkDBaseModel){return SplunkDBaseModel.extend({url:"authentication/current-context",initialize:function(){SplunkDBaseModel.prototype.initialize.apply(this,arguments)}})});define("collections/services/authentication/CurrentContexts",["models/services/authentication/CurrentContext","collections/SplunkDsBase"],function(CurrentContextModel,SplunkDsBaseCollection){return SplunkDsBaseCollection.extend({model:CurrentContextModel,url:"authentication/current-context",initialize:function(){SplunkDsBaseCollection.prototype.initialize.apply(this,arguments)}})});define("collections/services/AppLocals",["jquery","underscore","backbone","models/services/AppLocal","collections/SplunkDsBase","util/general_utils"],function($,_,Backbone,AppModel,SplunkDsBaseCollection,general_utils){return SplunkDsBaseCollection.extend({model:AppModel,url:"apps/local",initialize:function(){SplunkDsBaseCollection.prototype.initialize.apply(this,arguments)},sortWithString:function(appOrderString){appOrderString="string"==typeof appOrderString?appOrderString:"";var indexDictionary={},appOrderArray=appOrderString.split(",");if(_.isArray(appOrderArray)&&appOrderArray.length>0)for(var i=0,len=appOrderArray.length;len>i;i++)indexDictionary[appOrderArray[i]]=i;this.comparator=function(appA,appB){var nameA=appA.entry.get("name"),nameB=appB.entry.get("name"),labelA=appA.entry.content.get("label"),labelB=appB.entry.content.get("label"),positionA=indexDictionary[nameA],positionB=indexDictionary[nameB],isNumberA=_.isNumber(positionA),isNumberB=_.isNumber(positionB);return isNumberA&&isNumberB?positionB>positionA?-1:1:isNumberA||isNumberB?isNumberA&&!isNumberB?-1:!isNumberA&&isNumberB?1:void 0:general_utils.compareWithDirection(labelA,labelB,!0)};this.sort()}})});define("models/services/data/ui/Manager",["models/SplunkDBase"],function(SplunkDBaseModel){return SplunkDBaseModel.extend({url:"data/ui/manager",initialize:function(){SplunkDBaseModel.prototype.initialize.apply(this,arguments)}})});define("collections/services/data/ui/Managers",["models/services/data/ui/Manager","collections/SplunkDsBase"],function(ManagerModel,SplunkDsBaseCollection){return SplunkDsBaseCollection.extend({url:"data/ui/manager",model:ManagerModel,initialize:function(){SplunkDsBaseCollection.prototype.initialize.apply(this,arguments)}})});define("models/shared/splunkbar/SystemMenuSection",["models/Base"],function(BaseModel){return BaseModel.extend({initialize:function(){BaseModel.prototype.initialize.apply(this,arguments);this.get("items")||this.set({items:[]})}})});define("collections/shared/splunkbar/SystemMenuSections",["models/shared/splunkbar/SystemMenuSection","collections/Base"],function(SystemMenuSectionModel,BaseCollection){return BaseCollection.extend({model:SystemMenuSectionModel,initialize:function(){BaseCollection.prototype.initialize.apply(this,arguments)},comparator:function(a,b){var x=a.get("order"),y=b.get("order");return x===y?0:x>y?1:-1}})});define("contrib/text!views/shared/splunkbar/Master.html",[],function(){return'\n<div class="navbar-inner">\n    <div class="no_connection-overlay"></div>\n    <a href="<%-homeLink%>" class="brand" title="splunk &gt; <%- _(\'listen to your data\').t() %>">splunk<strong>&gt;</strong></a>\n    <ul class="navbar-global-nav nav">\n        <li class="dropdown apps">\n            <a href="#" class="dropdown-toggle"><%- _("Apps").t() %><b class="caret"></b></a>\n        </li>\n    </ul>\n\n    <ul class="navbar-global-nav nav pull-right">\n        <li class="dropdown user"></li>\n        <li class="dropdown messages"><a href="#" class="dropdown-toggle"><%- _("Messages").t() %><b class="caret"></b></a></li>\n        <li class="dropdown system<%- options.section==\'system\' ? \' active \' : \'\'%>">\n            <a href="#" class="dropdown-toggle"><%- _("System").t() %><b class="caret"></b></a>\n        </li>\n        <li class="dropdown activity"><a href="#"><%- _("Activity").t() %></a></li>\n        <li class="dropdown help"><a href="#" class="dropdown-toggle"><%- _("Help").t() %><b class="caret"></b></a></li>\n    </ul><!-- /.user-nav -->\n</div><!-- /.navbar-inner -->\n'});define("util/csrf_protection",["jquery","splunk.util"],function($,splunkUtils){var HEADER_NAME="X-Splunk-Form-Key",FORM_KEY=splunkUtils.getFormKey();if(FORM_KEY){if(!$)throw"Splunk's jQuery.ajax extension requires jQuery.";$.ajaxPrefilter(function(options,originalOptions,jqXHR){options["type"]&&"GET"==options["type"].toUpperCase()||jqXHR.setRequestHeader(HEADER_NAME,FORM_KEY)});$(document).ready(function(){$(document).bind("ajaxError",function(event,xhr){var pathname=window.location.pathname;401!==xhr.status||-1!==pathname.indexOf("/account/logout")||(document.location=splunkUtils.make_url("account/login?return_to="+encodeURIComponent(pathname+document.location.search)))})})}});define("util/ajax_no_cache",["jquery"],function($){if(!$)throw"ajax_no_cache requires jQuery.";$.ajaxPrefilter(function(options){options.type&&"GET"==options.type.toUpperCase()&&void 0===options.cache&&(options.cache=!1)})});define("views/shared/splunkbar/Master",["jquery","underscore","backbone","module","splunk.util","helpers/Session","views/Base","views/shared/delegates/Popdown","views/shared/splunkbar/AppMenu","views/shared/splunkbar/SystemMenu","views/shared/splunkbar/UserMenu","views/shared/splunkbar/messages/Master","views/shared/splunkbar/ActivityMenu","views/shared/splunkbar/HelpMenu","views/shared/splunkbar/messages/NoConnectionOverlay","models/services/data/UserPref","models/services/AppLocal","models/services/authentication/User","models/services/server/ServerInfo","models/services/configs/Web","models/shared/Application","collections/services/authentication/CurrentContexts","collections/services/AppLocals","collections/services/Messages","collections/services/data/ui/Managers","collections/shared/splunkbar/SystemMenuSections","contrib/text!views/shared/splunkbar/Master.html","uri/route","splunk.util","util/splunkd_utils","util/csrf_protection","util/ajax_no_cache"],function($,_,Backbone,module,splunk_util,Session,BaseView,Popdown,AppMenuView,SystemMenu,UserMenu,MessagesView,ActivityMenu,HelpMenu,NoConnectionOverlay,UserPrefModel,AppLocalModel,UserModel,ServerInfoModel,WebConfModel,ApplicationModel,CurrentContextsCollection,AppsCollection,MessagesCollection,ManagersCollection,SystemMenuSectionsCollection,globalTemplate,route,splunkUtil,splunkDUtils){var View=BaseView.extend({moduleId:module.id,template:globalTemplate,className:"navbar",initialize:function(){BaseView.prototype.initialize.apply(this,arguments);this.MAX_RETRIES_BEFORE_FAIL=3;this.MESSAGES_POLLING_DELAY_STANDARD=6e4;this.MESSAGES_POLLING_DELAY_HI_FREQ=1e3;this.isFreeDfd=$.Deferred();this.cntRetries=0;this.model&&this.model.serverInfo&&this.model.serverInfo.entry.content.has("isFree")?splunkUtil.normalizeBoolean(this.model.serverInfo.entry.content.get("isFree"))?this.isFreeDfd.resolve():this.isFreeDfd.reject():this.model&&this.model.serverInfo&&this.model.serverInfo.on("change reset",function(){splunkUtil.normalizeBoolean(this.model.serverInfo.entry.content.get("isFree"))?this.isFreeDfd.resolve():this.isFreeDfd.reject()}.bind(this));Session.on("restart timeout",function(){this.collection.messages.stopPolling()},this);Session.on("start",function(){this.collection.messages.startPolling()},this)},remove:function(){BaseView.prototype.remove.apply(this,arguments);Session.off("restart timeout start",null,this);return this},render:function(){var homeLink=route.page(this.model.application.get("root"),this.model.application.get("locale"),"launcher","home"),html=this.compiledTemplate({makeUrl:splunk_util.make_url,options:this.options,homeLink:homeLink});this.$el.html(html);var activeMenu=this.getActiveMenu();this.children.apps=new AppMenuView({collection:this.collection,model:this.model,activeMenu:activeMenu});this.$(".apps.dropdown").replaceWith(this.children.apps.el);this.children.systemMenu=new SystemMenu({collection:{sections:this.collection.sections},model:{application:this.model.application}});this.$(".system.dropdown").replaceWith(this.children.systemMenu.el);this.isFreeDfd.fail(function(){this.children.userMenu=new UserMenu({collection:{currentContext:this.model.currentContext},model:{user:this.model.user,application:this.model.application,webConf:this.model.webConf,config:this.model.config}});this.$(".user.dropdown").replaceWith(this.children.userMenu.el)}.bind(this));this.children.messages=new MessagesView({collection:{messages:this.collection.messages,legacyMessages:this.collection.legacyMessages}});this.children.noConnectionOverlay=new NoConnectionOverlay;$("body").append(this.children.noConnectionOverlay.render().el);this.collection.messages.on("serverValidated",function(success,context,messages){if(success&&this.cntRetries>0){this.restartMessagePolling(this.MESSAGES_POLLING_DELAY_STANDARD);this.children.noConnectionOverlay.hide();this.cntRetries=0}else{var netErrorMsg=_.find(messages,function(msg){return msg.type==splunkDUtils.NETWORK_ERROR||"network_error"});if(netErrorMsg){0==this.cntRetries&&this.restartMessagePolling(this.MESSAGES_POLLING_DELAY_HI_FREQ);this.cntRetries>=this.MAX_RETRIES_BEFORE_FAIL&&this.children.noConnectionOverlay.show();this.cntRetries+=1}}},this);this.$(".messages.dropdown").replaceWith(this.children.messages.render().el);this.restartMessagePolling(this.MESSAGES_POLLING_DELAY_STANDARD);this.children.activityMenu=new ActivityMenu({model:{user:this.model.user,application:this.model.application}});this.$(".activity").replaceWith(this.children.activityMenu.el);this.children.helpMenu=new HelpMenu({model:this.model});this.$(".help").replaceWith(this.children.helpMenu.el);activeMenu&&this.$(activeMenu.selector).addClass("active");return this},restartMessagePolling:function(interval){this.collection.messages.stopPolling();this.collection.messages.startPolling({delay:interval,uiInactivity:!0,stopOnError:!1,data:{count:1e3}})},getActiveMenu:function(){var path=Backbone.history.location.pathname,pathComponents=path.split("/"),pathComponentsLen=pathComponents.length,appAndPageComponents=[pathComponents[pathComponentsLen-2],pathComponents[pathComponentsLen-1]],appAndPage=appAndPageComponents.join("/"),locale=this.model.application.get("locale"),app=this.model.application.get("app"),activityPages=["search/status_index","search/search_status","search/search_detail_activity","search/search_activity_by_user","search/splunkweb_status","search/internal_messages","search/scheduler_status","search/scheduler_user_app","search/scheduler_savedsearch","search/scheduler_status_errors","search/pdf_activity"],changePasswordPage="authentication/changepassword",jobManagerPage=app+"/job_management",triggeredAlertsPage=locale+"/alerts",homePage="launcher/home",managerPage=locale+"/manager",activeMenuSelector=null,activeMenuName="";if(activityPages.indexOf(appAndPage)>-1||path.indexOf(jobManagerPage)>-1||path.indexOf(triggeredAlertsPage)>-1){activeMenuSelector=".activity";activeMenuName="activity"}else if(path.indexOf(changePasswordPage)>-1){activeMenuSelector=".user";activeMenuName="user"}else if(path.indexOf(managerPage)>-1){activeMenuSelector="menu-system";activeMenuName="manager"}else if(path.indexOf(homePage)>-1){activeMenuSelector=".brand";activeMenuName="home"}else{activeMenuSelector=".menu-apps";activeMenuName="app"}return{selector:activeMenuSelector,name:activeMenuName}}},{create:function(options){options=options||{};options.collection=options.collection||{};options.model=options.model||{};var applicationDfd=$.Deferred();options.model.application||(options.model.application=new ApplicationModel);options.model.application.get("app")?applicationDfd.resolve():options.model.application.on("change",applicationDfd.resolve);if(!options.model.appLocal){options.model.appLocal=new AppLocalModel;applicationDfd.done(function(){"system"!==options.model.application.get("app")&&options.model.appLocal.fetch({url:splunkDUtils.fullpath(options.model.appLocal.url+"/"+encodeURIComponent(options.model.application.get("app"))),data:{app:options.model.application.get("app"),owner:options.model.application.get("owner")}})})}var currentUserIdDfd=$.Deferred();currentUserIdDfd.resolve(options.model.application.get("owner"));var appsCollection,appsDfd=$.Deferred();if(options.collection.apps)appsDfd.resolve();else{appsCollection=options.collection.apps=new AppsCollection;$.when(currentUserIdDfd).done(function(){appsCollection.fetch({data:{sort_key:"name",sort_dir:"asc",app:"-",owner:options.model.application.get("owner"),search:"visible=true AND disabled=0 AND name!=launcher",count:-1}});appsCollection.on("reset sort",appsDfd.resolve)})}if(!options.model.userPref){options.model.userPref=new UserPrefModel;options.model.userPref.fetch({data:{app:"user-prefs",owner:options.model.application.get("owner"),count:-1}});appsCollection=options.collection.apps;options.model.userPref.on("change",function(){appsDfd.done(function(){appsCollection.sortWithString(options.model.userPref.entry.content.get("appOrder"));appsCollection.trigger("ready")})})}if(!options.model.user){options.model.user=new UserModel;$.when(currentUserIdDfd).done(function(currentUserId){options.model.user.set("id",encodeURIComponent(currentUserId));options.model.user.fetch()})}if(!options.collection.messages){options.collection.messages=new MessagesCollection;options.collection.messages.fetchData.set({sort_key:"timeCreated_epochSecs",sort_dir:"desc"})}if(!options.collection.managers){options.collection.managers=new ManagersCollection;$.when(currentUserIdDfd).done(function(currentUsername){options.collection.managers.fetch({data:{app:"-",owner:currentUsername,count:0,digest:1}})})}var sections=options.collection.sections=new SystemMenuSectionsCollection;sections.add({id:"knowledge_configurations",label:_("Knowledge").t(),icon:"bookmark",order:1});sections.add({id:"auth_configurations",label:_("Users and authentication").t(),icon:"user",order:6});sections.add({id:"deployment_configurations",label:_("Distributed environment").t(),icon:"distributed-environment",order:5});sections.add({id:"system_configurations",label:_("System").t(),icon:"settings",order:2});sections.add({id:"data_configurations",label:_("Data").t(),icon:"data",order:4});options.collection.managers.on("reset",function(){options.collection.managers.each(function(manager){var menuUrl=manager.entry.content.get("menu.url")||"",sectionName=manager.entry.content.get("menu.name"),disabledByLicense=splunkUtil.normalizeBoolean(manager.entry.content.get("disabled_by_license")||!1),order=manager.entry.content.get("menu.order")||1e3,pageStart=route.encodeRoot(options.model.application.get("root"),options.model.application.get("locale")),url=pageStart+splunk_util.sprintf(menuUrl,{namespace:options.model.application.get("app")||"NOTHING"});if(!disabledByLicense&&sectionName){var section=sections.get(sectionName);if(section){var sectionItems=section.get("items");sectionItems&&sectionItems.push(manager)}}manager.set({url:url,order:order})});sections.trigger("ready")});if(!options.model.serverInfo){options.model.serverInfo=new ServerInfoModel;options.model.serverInfo.fetch()}options.model.webConf=new WebConfModel({id:"settings"});options.model.webConf.fetch();return new View(options)}});return View});define("contrib/text!views/shared/appbar/NavItem.html",[],function(){return'<% var hasSubmenu = item.submenu && item.submenu.length && item.submenu.length > 0; %>\n<a href="<%-item.uri%>" title="<%- _(item.label).t() %>" class="<%=hasSubmenu ? \'dropdown-toggle\' : \'\'%>" <%=hasSubmenu ? \'data-toggle="popdown"\' : \'\'%>>\n    <%- _(item.label).t() %>\n    <%if(hasSubmenu){%>\n       <b class="caret"></b>\n    <%}%>\n</a>\n<%if(hasSubmenu){%>\n    <div class="dropdown-menu">\n    	<div class="arrow"></div>\n    	<div class="slideNavPlaceHolder"></div>\n    </div>\n<%}%>\n'});define("contrib/text!views/shared/AppNav-SlideNavTemplate.html",[],function(){return'<%if(!submenu){return "";}%>\n<ul class="slidenavList scroll-group">\n    <% _.each(submenu, function(i, index) { %>\n    <li data-index="<%=index%>" class="<%=i.divider ? \'divider\':\'\'%>">\n        <% if(!i.divider){ %>\n            <% if(i.submenu && i.submenu.length>0){ %>\n                <a href="#">\n                    <%- _.unescape(_(i.label).t()) %>\n                </a>\n                <i class="icon-triangle-right-small"></i>\n            <%}else if (i.hasOwnProperty(\'reportUri\')) { %>\n                <a href="<%=i.reportUri%>" class="primary-link">\n                    <%- _.unescape(_(i.label).t()) %>\n                </a>\n                <a href="<%=i.uri%>" class="secondary-link">\n                    <i class="icon-<%= i.hasOwnProperty(\'dispatchView\') && i.dispatchView === \'pivot\' ? \'pivot\' : \'search\' %>"></i>\n                </a>\n            <%} else { %>\n                <a href="<%=i.uri%>">\n                    <%- _.unescape(_(i.label).t()) %>\n                </a>\n            <%}%>\n        <%}%>\n    </li>\n    <% }); %>\n</ul>\n'});!function($,undefined){function getOffsets(offsets,width,height){return[parseFloat(offsets[0])*(rpercent.test(offsets[0])?width/100:1),parseFloat(offsets[1])*(rpercent.test(offsets[1])?height/100:1)]}function parseCss(element,property){return parseInt($.css(element,property),10)||0}function getDimensions(elem){var raw=elem[0];return 9===raw.nodeType?{width:elem.width(),height:elem.height(),offset:{top:0,left:0}}:$.isWindow(raw)?{width:elem.width(),height:elem.height(),offset:{top:elem.scrollTop(),left:elem.scrollLeft()}}:raw.preventDefault?{width:0,height:0,offset:{top:raw.pageY,left:raw.pageX}}:{width:elem.outerWidth(),height:elem.outerHeight(),offset:elem.offset()}}$.ui=$.ui||{};var cachedScrollbarWidth,max=Math.max,abs=Math.abs,round=Math.round,rhorizontal=/left|center|right/,rvertical=/top|center|bottom/,roffset=/[\+\-]\d+(\.[\d]+)?%?/,rposition=/^\w+/,rpercent=/%$/,_position=$.fn.position;$.position={scrollbarWidth:function(){if(cachedScrollbarWidth!==undefined)return cachedScrollbarWidth;var w1,w2,div=$("<div style='display:block;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),innerDiv=div.children()[0];$("body").append(div);w1=innerDiv.offsetWidth;div.css("overflow","scroll");w2=innerDiv.offsetWidth;w1===w2&&(w2=div[0].clientWidth);div.remove();return cachedScrollbarWidth=w1-w2},getScrollInfo:function(within){var overflowX=within.isWindow?"":within.element.css("overflow-x"),overflowY=within.isWindow?"":within.element.css("overflow-y"),hasOverflowX="scroll"===overflowX||"auto"===overflowX&&within.width<within.element[0].scrollWidth,hasOverflowY="scroll"===overflowY||"auto"===overflowY&&within.height<within.element[0].scrollHeight;return{width:hasOverflowY?$.position.scrollbarWidth():0,height:hasOverflowX?$.position.scrollbarWidth():0}},getWithinInfo:function(element){var withinElement=$(element||window),isWindow=$.isWindow(withinElement[0]);return{element:withinElement,isWindow:isWindow,offset:withinElement.offset()||{left:0,top:0},scrollLeft:withinElement.scrollLeft(),scrollTop:withinElement.scrollTop(),width:isWindow?withinElement.width():withinElement.outerWidth(),height:isWindow?withinElement.height():withinElement.outerHeight()}}};$.fn.position=function(options){if(!options||!options.of)return _position.apply(this,arguments);options=$.extend({},options);var atOffset,targetWidth,targetHeight,targetOffset,basePosition,dimensions,target=$(options.of),within=$.position.getWithinInfo(options.within),scrollInfo=$.position.getScrollInfo(within),collision=(options.collision||"flip").split(" "),offsets={};dimensions=getDimensions(target);target[0].preventDefault&&(options.at="left top");targetWidth=dimensions.width;targetHeight=dimensions.height;targetOffset=dimensions.offset;basePosition=$.extend({},targetOffset);$.each(["my","at"],function(){var horizontalOffset,verticalOffset,pos=(options[this]||"").split(" ");1===pos.length&&(pos=rhorizontal.test(pos[0])?pos.concat(["center"]):rvertical.test(pos[0])?["center"].concat(pos):["center","center"]);pos[0]=rhorizontal.test(pos[0])?pos[0]:"center";pos[1]=rvertical.test(pos[1])?pos[1]:"center";horizontalOffset=roffset.exec(pos[0]);verticalOffset=roffset.exec(pos[1]);offsets[this]=[horizontalOffset?horizontalOffset[0]:0,verticalOffset?verticalOffset[0]:0];options[this]=[rposition.exec(pos[0])[0],rposition.exec(pos[1])[0]]});1===collision.length&&(collision[1]=collision[0]);"right"===options.at[0]?basePosition.left+=targetWidth:"center"===options.at[0]&&(basePosition.left+=targetWidth/2);"bottom"===options.at[1]?basePosition.top+=targetHeight:"center"===options.at[1]&&(basePosition.top+=targetHeight/2);atOffset=getOffsets(offsets.at,targetWidth,targetHeight);basePosition.left+=atOffset[0];basePosition.top+=atOffset[1];return this.each(function(){var collisionPosition,using,elem=$(this),elemWidth=elem.outerWidth(),elemHeight=elem.outerHeight(),marginLeft=parseCss(this,"marginLeft"),marginTop=parseCss(this,"marginTop"),collisionWidth=elemWidth+marginLeft+parseCss(this,"marginRight")+scrollInfo.width,collisionHeight=elemHeight+marginTop+parseCss(this,"marginBottom")+scrollInfo.height,position=$.extend({},basePosition),myOffset=getOffsets(offsets.my,elem.outerWidth(),elem.outerHeight());"right"===options.my[0]?position.left-=elemWidth:"center"===options.my[0]&&(position.left-=elemWidth/2);"bottom"===options.my[1]?position.top-=elemHeight:"center"===options.my[1]&&(position.top-=elemHeight/2);position.left+=myOffset[0];position.top+=myOffset[1];if(!$.support.offsetFractions){position.left=round(position.left);position.top=round(position.top)}collisionPosition={marginLeft:marginLeft,marginTop:marginTop};$.each(["left","top"],function(i,dir){$.ui.position[collision[i]]&&$.ui.position[collision[i]][dir](position,{targetWidth:targetWidth,targetHeight:targetHeight,elemWidth:elemWidth,elemHeight:elemHeight,collisionPosition:collisionPosition,collisionWidth:collisionWidth,collisionHeight:collisionHeight,offset:[atOffset[0]+myOffset[0],atOffset[1]+myOffset[1]],my:options.my,at:options.at,within:within,elem:elem})});options.using&&(using=function(props){var left=targetOffset.left-position.left,right=left+targetWidth-elemWidth,top=targetOffset.top-position.top,bottom=top+targetHeight-elemHeight,feedback={target:{element:target,left:targetOffset.left,top:targetOffset.top,width:targetWidth,height:targetHeight},element:{element:elem,left:position.left,top:position.top,width:elemWidth,height:elemHeight},horizontal:0>right?"left":left>0?"right":"center",vertical:0>bottom?"top":top>0?"bottom":"middle"};elemWidth>targetWidth&&abs(left+right)<targetWidth&&(feedback.horizontal="center");elemHeight>targetHeight&&abs(top+bottom)<targetHeight&&(feedback.vertical="middle");feedback.important=max(abs(left),abs(right))>max(abs(top),abs(bottom))?"horizontal":"vertical";options.using.call(this,props,feedback)});elem.offset($.extend(position,{using:using}))})};$.ui.position={fit:{left:function(position,data){var newOverRight,within=data.within,withinOffset=within.isWindow?within.scrollLeft:within.offset.left,outerWidth=within.width,collisionPosLeft=position.left-data.collisionPosition.marginLeft,overLeft=withinOffset-collisionPosLeft,overRight=collisionPosLeft+data.collisionWidth-outerWidth-withinOffset;if(data.collisionWidth>outerWidth)if(overLeft>0&&0>=overRight){newOverRight=position.left+overLeft+data.collisionWidth-outerWidth-withinOffset;position.left+=overLeft-newOverRight}else position.left=overRight>0&&0>=overLeft?withinOffset:overLeft>overRight?withinOffset+outerWidth-data.collisionWidth:withinOffset;else overLeft>0?position.left+=overLeft:overRight>0?position.left-=overRight:position.left=max(position.left-collisionPosLeft,position.left)},top:function(position,data){var newOverBottom,within=data.within,withinOffset=within.isWindow?within.scrollTop:within.offset.top,outerHeight=data.within.height,collisionPosTop=position.top-data.collisionPosition.marginTop,overTop=withinOffset-collisionPosTop,overBottom=collisionPosTop+data.collisionHeight-outerHeight-withinOffset;if(data.collisionHeight>outerHeight)if(overTop>0&&0>=overBottom){newOverBottom=position.top+overTop+data.collisionHeight-outerHeight-withinOffset;position.top+=overTop-newOverBottom}else position.top=overBottom>0&&0>=overTop?withinOffset:overTop>overBottom?withinOffset+outerHeight-data.collisionHeight:withinOffset;else overTop>0?position.top+=overTop:overBottom>0?position.top-=overBottom:position.top=max(position.top-collisionPosTop,position.top)}},flip:{left:function(position,data){var newOverRight,newOverLeft,within=data.within,withinOffset=within.offset.left+within.scrollLeft,outerWidth=within.width,offsetLeft=within.isWindow?within.scrollLeft:within.offset.left,collisionPosLeft=position.left-data.collisionPosition.marginLeft,overLeft=collisionPosLeft-offsetLeft,overRight=collisionPosLeft+data.collisionWidth-outerWidth-offsetLeft,myOffset="left"===data.my[0]?-data.elemWidth:"right"===data.my[0]?data.elemWidth:0,atOffset="left"===data.at[0]?data.targetWidth:"right"===data.at[0]?-data.targetWidth:0,offset=-2*data.offset[0];if(0>overLeft){newOverRight=position.left+myOffset+atOffset+offset+data.collisionWidth-outerWidth-withinOffset;(0>newOverRight||newOverRight<abs(overLeft))&&(position.left+=myOffset+atOffset+offset)
}else if(overRight>0){newOverLeft=position.left-data.collisionPosition.marginLeft+myOffset+atOffset+offset-offsetLeft;(newOverLeft>0||abs(newOverLeft)<overRight)&&(position.left+=myOffset+atOffset+offset)}},top:function(position,data){var newOverTop,newOverBottom,within=data.within,withinOffset=within.offset.top+within.scrollTop,outerHeight=within.height,offsetTop=within.isWindow?within.scrollTop:within.offset.top,collisionPosTop=position.top-data.collisionPosition.marginTop,overTop=collisionPosTop-offsetTop,overBottom=collisionPosTop+data.collisionHeight-outerHeight-offsetTop,top="top"===data.my[1],myOffset=top?-data.elemHeight:"bottom"===data.my[1]?data.elemHeight:0,atOffset="top"===data.at[1]?data.targetHeight:"bottom"===data.at[1]?-data.targetHeight:0,offset=-2*data.offset[1];if(0>overTop){newOverBottom=position.top+myOffset+atOffset+offset+data.collisionHeight-outerHeight-withinOffset;position.top+myOffset+atOffset+offset>overTop&&(0>newOverBottom||newOverBottom<abs(overTop))&&(position.top+=myOffset+atOffset+offset)}else if(overBottom>0){newOverTop=position.top-data.collisionPosition.marginTop+myOffset+atOffset+offset-offsetTop;position.top+myOffset+atOffset+offset>overBottom&&(newOverTop>0||abs(newOverTop)<overBottom)&&(position.top+=myOffset+atOffset+offset)}}},flipfit:{left:function(){$.ui.position.flip.left.apply(this,arguments);$.ui.position.fit.left.apply(this,arguments)},top:function(){$.ui.position.flip.top.apply(this,arguments);$.ui.position.fit.top.apply(this,arguments)}}};!function(){var testElement,testElementParent,testElementStyle,offsetLeft,i,body=document.getElementsByTagName("body")[0],div=document.createElement("div");testElement=document.createElement(body?"div":"body");testElementStyle={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"};body&&$.extend(testElementStyle,{position:"absolute",left:"-1000px",top:"-1000px"});for(i in testElementStyle)testElement.style[i]=testElementStyle[i];testElement.appendChild(div);testElementParent=body||document.documentElement;testElementParent.insertBefore(testElement,testElementParent.firstChild);div.style.cssText="position: absolute; left: 10.7432222px;";offsetLeft=$(div).offset().left;$.support.offsetFractions=offsetLeft>10&&11>offsetLeft;testElement.innerHTML="";testElementParent.removeChild(testElement)}()}(jQuery);define("jquery.ui.position",["jquery.ui.widget"],function(){});define("splunk.widget.slidenav",["jquery","jquery.ui.widget","jquery.ui.position"],function($){return $.widget("splunk.slidenav",{options:{levelTemplate:"",navData:{},childPropertyName:"children",backText:"Back"},_create:function(){var self=this;this.isAnimating=!1;this.$el=$(this.element);this.$wrap=$('<div class="auto"></div>');this.$el.append(this.$wrap);this._chain=[this.addLevel(this.options.navData)];this.$backButton=$(self.templateBack());this.$el.prepend(this.$backButton);this.$backButton.on("click",function(event){self.back();event.preventDefault()});this.$el.on("click","LI",function(event){var li=$(event.target).closest("LI");self.select(li,event)})},addLevel:function(navData){var newLevel=$(this.options.levelTemplate(navData));this.$wrap.append(newLevel);this._chain&&newLevel.position({of:this._chain[this._chain.length-1],my:"left top",at:"right top",collision:"none",offset:"0 0"});newLevel.data("slidenav",navData);return newLevel},select:function(selected,event){if(this.isAnimating)return!1;var ul=selected.closest("ul"),navData=ul.data("slidenav"),selectedIndex=selected.data("index");selected.find("a").addClass("slideNavActiveParent");selected=navData[this.options.childPropertyName][selectedIndex];if(selected[this.options.childPropertyName]&&selected[this.options.childPropertyName].length>0){event&&event.preventDefault();this.next(selected)}else this._trigger("select",event,selected)},next:function(selected){var current=this._chain[this._chain.length-1]||null;selected.domReference=selected.domReference||this.addLevel(selected);this._chain.push(this.slide(selected.domReference.show(),function(){current.find("a").prop("tabindex","-1");selected.domReference.find("a").first().focus()}));this.$backButton.show()},back:function(){if(this._chain.length<=1||this.isAnimating)return!1;2===this._chain.length&&this.$backButton.hide();var $hide=this._chain.pop(),to=this._chain[this._chain.length-1];to.find(".slideNavActiveParent").removeClass("slideNavActiveParent").focus();this.slide(to,function(){$hide.scrollTop(0).hide();to.find("a").prop("tabindex","0")})},slide:function(to,callback){var self=this;this.$wrap.outerHeight(to.outerHeight());this.isAnimating=!0;this.$wrap.animate({left:-to.position().left},{duration:200,complete:function(){self.isAnimating=!1;callback&&callback.apply(self,arguments)}});return to},templateBack:function(){return this.options.templateBack||'<div class="backbutton" style="display: none;"><a href="#" class="slidenavback "><i class="icon-chevron-left"></i>'+this.options.backText+"</a></div>"}})});define("views/shared/appbar/NavItem",["jquery","underscore","module","views/Base","views/shared/delegates/Popdown","contrib/text!views/shared/appbar/NavItem.html","contrib/text!views/shared/AppNav-SlideNavTemplate.html","views/shared/delegates/StopScrollPropagation","splunk.widget.slidenav"],function($,_,module,BaseView,Popdown,templateNavItem,templateSlideNav,StopScrollPropagation){var templateSlideNavCompiled=_.template(templateSlideNav),View=BaseView.extend({moduleId:module.id,className:"nav-item",tagName:"li",initialize:function(){BaseView.prototype.initialize.apply(this,arguments)},render:function(){var html;html=this.options.navItemObj.divider?_.template(this.dividerTemplate,{}):_.template(templateNavItem,{item:this.options.navItemObj,isActive:this.options.isActive});this.$el.append(html);this.$el.addClass("nav-item-"+this.options.navItemObj.viewName);if(this.options.navItemObj.submenu&&this.options.navItemObj.submenu.length>0){this.$el.addClass("dropdown");this.slideNav=this.$el.find(".slideNavPlaceHolder").slidenav({navData:this.options.navItemObj,levelTemplate:templateSlideNavCompiled,childPropertyName:"submenu",backText:_("Back").t()});this.popdown=new Popdown({el:this.$el,dialog:this.slidenav,mode:"dialog"});this.children.stopScrollPropagation=new StopScrollPropagation({el:this.slideNav.find(".slidenavList")})}return this},dividerTemplate:'<span class="divider" style="display: block;float: left;height: 10px;margin: 0 15px;opacity: 0.2;"></span>'});return View});define("views/shared/appbar/AppNav",["jquery","underscore","backbone","module","views/Base","views/shared/appbar/NavItem"],function($,_,Backbone,module,BaseView,NavItem){return BaseView.extend({moduleId:module.id,tagName:"ul",className:"nav nav-pills",initialize:function(){BaseView.prototype.initialize.apply(this,arguments);this.listenTo(this.model.appNav,"change:nav",this.debouncedRender);this.listenTo(this.model.application,"change:page",this.setActiveItem)},render:function(){var self=this,navData=this.model.appNav.get("nav");if(!navData)return this;this.$el.html("");$.each(navData,function(index,navItemObj){var navItemView=new NavItem({navItemObj:navItemObj});self.$el.append(navItemView.render().$el)});this.setActiveItem.call(this);return this},setActiveItem:function(){var self=this;if(this.model.application.get("page")){var activePage=this.model.application.get("page"),activeItem=self.$el.find(".nav-item-"+activePage);activeItem.addClass("active")}}})});define("contrib/text!views/shared/appbar/AppLabel.html",[],function(){return'<a class="app-link" href="<%=appLink%>">\n    <div class="app-logo"></div>\n\n    <div class="app-name">\n        <span class="app-label">\n            <%-_(appLabel).t()%>\n        </span>\n    </div>\n</a>\n'});define("views/shared/appbar/AppLabel",["underscore","module","views/Base","contrib/text!views/shared/appbar/AppLabel.html"],function(_,module,BaseView,templateAppLabel){return BaseView.extend({moduleId:module.id,className:"app-bar-label-wrapper",initialize:function(){BaseView.prototype.initialize.apply(this,arguments);this.model.appNav.on("change",this.render,this)},showLogo:function(){this.$el.find(".app-logo").show();this.$el.find(".app-name").hide()},showName:function(){this.$el.find(".app-name").show();this.$el.find(".app-logo").hide()},render:function(){var label=this.model.appNav.get("label")||"",html=_.template(templateAppLabel,{appLink:this.model.appNav.get("link"),appLabel:label,appIcon:this.model.appNav.get("icon"),appLogo:this.model.appNav.get("logo")});this.$el.html(html);this.setAppLabelDisplay();return this},setAppLabelDisplay:function(){if(this.model.appNav.get("logo")){var img=new Image;img.onload=function(){if(parseInt(img.width,10)<2)this.showName();else{this.$el.find(".app-logo").empty().append(img);this.showLogo()}}.bind(this);img.onerror=function(){this.showName()}.bind(this);img.src=this.model.appNav.get("logo")}}})});define("models/services/data/ui/Nav",["models/SplunkDBase"],function(SplunkDBaseModel){return SplunkDBaseModel.extend({url:"data/ui/nav",id:"data/ui/nav",initialize:function(){SplunkDBaseModel.prototype.initialize.apply(this,arguments)}})});define("models/services/data/ui/View",["jquery","splunk.util","models/SplunkDBase","underscore"],function($,splunkutil,SplunkDBaseModel,_){return SplunkDBaseModel.extend({url:"data/ui/views",initialize:function(){SplunkDBaseModel.prototype.initialize.apply(this,arguments)},isXML:function(){return"views"===this.entry.content.get("eai:type")},isHTML:function(){return"html"===this.entry.content.get("eai:type")},getViewType:function(){var typeLabel="n/a";this.isXML()?typeLabel="XML":this.isHTML()&&(typeLabel="HTML");return typeLabel},getLabel:function(){return this.entry.content.get("label")||this.entry.get("name")},isRoot:function(nodeName){function lower(s){return s&&s.toLowerCase()||s}if(!this.isXML())return!1;var $xmlDoc=(this.entry.content.get("eai:data"),this.get$XML()),rootNode=$xmlDoc.find(":eq(0)")[0];return rootNode?arguments.length>1?_.any(arguments,function(nodeName){return lower(rootNode.nodeName)===lower(nodeName)}):lower(rootNode.nodeName)===lower(nodeName):!1},isAdvanced:function(visibility){var $xmlDoc,$root,type,isVisible;if(!this.isRoot("view"))return!1;if(visibility){$xmlDoc=this.get$XML();$root=$xmlDoc.find(":eq(0)");type=$root.attr("type");isVisible=$root.attr("isVisible");if(type&&"html"==type)return!1;if(isVisible&&!splunkutil.normalizeBoolean(isVisible))return!1}return!0},get$XML:function(){var xmlDoc,data=this.isXML()&&this.entry.content.get("eai:data")||"<dashboard/>";try{xmlDoc=$.parseXML(data)}catch(e){xmlDoc=$.parseXML("<dashboard/>")}$(xmlDoc).find("script").remove();return $(xmlDoc)},isDashboard:function(){return this.isRoot("dashboard")},isForm:function(){return this.isRoot("form")},isSimpleXML:function(){return this.isXML()&&this.isRoot("dashboard","form")}})});define("collections/services/data/ui/Views",["jquery","backbone","models/services/data/ui/View","collections/SplunkDsBase","splunk.util"],function($,Backbone,ViewModel,SplunkDsBaseCollection){return SplunkDsBaseCollection.extend({url:"data/ui/views",model:ViewModel,initialize:function(){SplunkDsBaseCollection.prototype.initialize.apply(this,arguments)}})});define("models/services/SavedSearch",["jquery","backbone","util/splunkd_utils","models/Base","models/SplunkDBase","underscore","splunk.util"],function($,Backbone,splunkd_utils,BaseModel,SplunkDBaseModel,_,splunkUtil){var Embed=BaseModel.extend({initialize:function(){BaseModel.prototype.initialize.apply(this,arguments)},sync:function(method,model,options){var defaults={data:{output_mode:"json"}};switch(method){case"update":defaults.processData=!0;defaults.type="POST";defaults.url=splunkd_utils.fullpath(model.id);$.extend(!0,defaults,options);break;default:throw new Error("invalid method: "+method)}return Backbone.sync.call(this,method,model,defaults)}});return SplunkDBaseModel.extend({url:"saved/searches",initialize:function(){SplunkDBaseModel.prototype.initialize.apply(this,arguments);this.on("change:id",function(){var shareLink,unshareLink;if(this.id){shareLink=this.id+"/embed";unshareLink=this.id+"/unembed"}this.embed.set("id",shareLink);this.unembed.set("id",unshareLink)},this);this.embed.on("sync",function(){this.safeFetch()},this);this.unembed.on("sync",function(){this.safeFetch()},this)},initializeAssociated:function(){SplunkDBaseModel.prototype.initializeAssociated.apply(this,arguments);this.embed=this.embed||new this.constructor.Embed;this.associated.embed=this.embed;this.unembed=this.unembed||new this.constructor.Embed;this.associated.unembed=this.unembed},parse:function(response,options){response=this.migrateAttributes(response,options);_.extend(options,{skipClone:!0});this.initializeAssociated();if(splunkd_utils.isExistingEntity(response)){var id=response.entry[0].links.alternate;this.embed.set("id",id+"/embed");this.unembed.set("id",id+"/unembed")}return SplunkDBaseModel.prototype.parse.call(this,response,options)},setFromSplunkD:function(payload,options){payload=this.migrateAttributes(payload,options);_.extend(options,{skipClone:!0});if(splunkd_utils.isExistingEntity(payload)){var id=payload.entry[0].links.alternate;this.embed.set("id",id+"/embed");this.unembed.set("id",id+"/unembed")}return SplunkDBaseModel.prototype.setFromSplunkD.call(this,payload,options)},migrateAttributes:function(response,options){options=options||{};options.skipClone||(response=$.extend(!0,{},response));if(response&&response.entry&&response.entry[0].content){var content=response.entry[0].content,format=content["action.email.format"];-1!=_.indexOf(["html","plain","pdf"],format)?response.entry[0].content["action.email.format"]="table":"csv"===format&&splunkUtil.normalizeBoolean(content["action.email.sendresults"])&&!(splunkUtil.normalizeBoolean(content["action.email.sendcsv"])||splunkUtil.normalizeBoolean(content["action.email.sendpdf"])||splunkUtil.normalizeBoolean(content["action.email.inline"]))&&(response.entry[0].content["action.email.sendcsv"]="1")}return response}},{Embed:Embed})});define("collections/services/SavedSearches",["models/services/SavedSearch","collections/SplunkDsBase"],function(Model,Collection){return Collection.extend({initialize:function(){Collection.prototype.initialize.apply(this,arguments)},url:"saved/searches",model:Model})});define("contrib/text!views/shared/appbar/Master.html",[],function(){return'<h2 class="app-name pull-right"></h2>\n<div class="nav">\n</div>\n'});define("helpers/AppNav",["jquery","underscore","backbone","splunk.util"],function($,_,Backbone,splunk_util){function getMatchingItems(collection,match,seen){return collection.filter(function(it){var itApp=it.entry.acl.get("app"),itName=it.entry.get("name"),isGlobal="global"===it.entry.acl.get("sharing");return isGlobal||itApp===app?match?itName.toLowerCase().indexOf(match.toLowerCase())>-1&&!(seen&&seen.indexOf(app+"/"+itName)>-1):!(seen&&seen.indexOf(app+"/"+itName)>-1):!1})}function getViewProps(viewName){var obj,view,i,v;views=views||[];for(i=0;i<views.length;i++){v=views.at(i);if(v.entry.get("name").toLowerCase()===viewName.toLowerCase()){if(v.entry.acl.get("app")==app){view=v;break}"global"==v.entry.acl.get("sharing")&&(view=v)}}if(!view)return!1;if(!view.entry.content.get("isVisible"))return!1;obj={label:view.entry.content.get("label")||viewName,uri:splunk_util.make_url("app",app,viewName),viewName:viewName,app:app};return obj}function getSavedProps(name){var obj,saved=searches.find(function(s){return s.entry.get("name").toLowerCase()===name.toLowerCase()});if(!saved)return!1;obj={uri:splunk_util.make_full_url("app/"+encodeURIComponent(app)+"/@go",{s:saved.id}),sharing:saved.get("sharing"),label:name,reportUri:splunk_util.make_full_url("app/"+encodeURIComponent(app)+"/report",{s:saved.id})};saved.entry.content.get("request.ui_dispatch_view")&&(obj.dispatchView=saved.entry.content.get("request.ui_dispatch_view"));return obj}function sanatizeHref(href){if("string"!=typeof href)return!1;var decodedhref=$("<div></div>").html(href).text();decodedhref=window.decodeURI(decodedhref);decodedhref=decodedhref.replace(/(\r\n|\n|\r|\s)/gm,"").toLowerCase();(decodedhref.indexOf(":")>-1&&decodedhref.indexOf("javascript:")>-1||decodedhref.indexOf("vbscript:")>-1||decodedhref.indexOf("data:")>-1||decodedhref.indexOf("livescript:")>-1)&&(href=!1);return href}function parseNavXml(nav){var c,output=[];for(c=0;c<nav.length;c++){var obj,node=nav[c],$node=$(node),nodeName=splunk_util.lowerTrimStr(node.nodeName);if("collection"===nodeName){obj={label:$node.attr("label"),uri:"#"};var children=parseNavXml($node.children());if(!children.submenu.length||!_.find(children.submenu,function(obj){return!obj.divider}))continue;_.extend(obj,children)}else if("view"===nodeName){var viewName=$node.attr("name"),isDefault=splunk_util.normalizeBoolean($node.attr("default")||"false"),source=splunk_util.lowerTrimStr($node.attr("source")),match=$node.attr("match");if(viewName){obj=getViewProps(viewName);if(!obj)continue;isDefault&&(obj.isDefault=isDefault);seenViews.push(app+"/"+viewName)}else if(source){var i,matchedViews=[];"all"==source?matchedViews=getMatchingItems(views,match):"unclassified"==source&&(matchedViews=getMatchingItems(views,match,seenViews));for(i=0;i<matchedViews.length;i++){viewName=matchedViews[i].entry.get("name");obj=getViewProps(viewName);if(obj&&matchedViews[i].entry.content.get("isDashboard")){seenViews.push(app+"/"+viewName);output.push(obj)}}obj=!1}}else if("saved"===nodeName){var savedName=$node.attr("name");source=splunk_util.lowerTrimStr($node.attr("source"));match=$node.attr("match");if(savedName){obj=getSavedProps(savedName);if(!obj)continue;seenSearches.push(app+"/"+savedName)}else if(source){var matchedSearches=[];"all"==source?matchedSearches=getMatchingItems(searches,match):"unclassified"==source&&(matchedSearches=getMatchingItems(searches,match,seenSearches));for(i=0;i<matchedSearches.length;i++){savedName=matchedSearches[i].entry.get("name");obj=getSavedProps(savedName);if(obj){seenSearches.push(app+"/"+savedName);output.push(obj)}}obj=!1}}else if("a"===nodeName){var href=sanatizeHref($node.attr("href"));if(href===!1)obj=!1;else{0===href.indexOf("/")&&"/"!==href[1]&&(href=splunk_util.make_url(href));obj={label:$node.text(),uri:href,viewName:$node.attr("name")||""}}}else obj="divider"===nodeName?{label:"",divider:!0}:{label:"unknown node in nav"};obj&&output.push(obj)}return{submenu:output}}function parseNavModel(nav,viewsCollection,savedSearchCollection,rootPath){var xmlNavString=nav.entry.content.get("eai:data").replace(/\&/g,"&amp;"),navXmlObj=$($.parseXML(xmlNavString)),root=navXmlObj.find("nav"),searchView=root.attr("search_view"),appColor=root.attr("color");seenViews=seenSearches=[];app=nav.entry.content.get("eai:appName");views=viewsCollection;rootEndpoint=rootPath||"";searches=new Backbone.Collection(savedSearchCollection.filter(function(model){var appMatch=model.entry.acl.get("app")==app,isGlobal="global"==model.entry.acl.get("sharing");return appMatch||isGlobal}));return{nav:parseNavXml(root.children()).submenu,searchView:searchView,color:appColor}}function parseNavCollection(navsCollection,viewsCollection,savedSearchCollection,rootPath){var result=[];rootEndpoint=rootPath||"";seenViews=seenSearches=[];if(!navsCollection||0==navsCollection.length)return null;navsCollection.each(function(nav){result.push(parseNavModel(nav,viewsCollection,savedSearchCollection))});return result}var app,views,rootEndpoint,searches,seenViews=[],seenSearches=[];return{parseNavModel:parseNavModel,parseNavCollection:parseNavCollection}});define("util/color_utils",["underscore"],function(_){var hslColorFromRgbColor=function(rgbColor){var r=rgbColor[0],g=rgbColor[1],b=rgbColor[2];if(null===r||null===g||null===b||isNaN(r)||isNaN(g)||isNaN(b))return null;if(0>r||0>g||0>b||r>255||g>255||b>255)return null;r/=255;g/=255;b/=255;var minRGB=Math.min(r,Math.min(g,b)),maxRGB=Math.max(r,Math.max(g,b)),chroma=maxRGB-minRGB,h_prime=0;0==chroma?h_prime=0:maxRGB==r?h_prime=(g-b)/chroma%6:maxRGB==g?h_prime=(b-r)/chroma+2:maxRGB==b&&(h_prime=(r-g)/chroma+4);for(var h=60*h_prime;0>h;)h+=360;for(;h>360;)h-=360;var l=.5*(maxRGB+minRGB),s=0;s=0==chroma?0:chroma/(1-Math.abs(2*l-1));0>s&&(s=0);s>1&&(s=1);0>l&&(l=0);l>1&&(l=1);return[h,100*s,100*l]},rgbColorFromHslColor=function(hslColor){if(3!=hslColor.length)return null;var h=hslColor[0],s=hslColor[1],l=hslColor[2];s/=100;l/=100;for(;0>h;)h+=360;for(;h>360;)h-=360;if(0>h||h>360||0>s||s>1||0>l||l>1)return null;var c=(1-Math.abs(2*l-1))*s,h1=h/60,x=c*(1-Math.abs(h1%2-1)),r1=0,g1=0,b1=0;if(1>h1){r1=c;g1=x}else if(2>h1){r1=x;g1=c}else if(3>h1){g1=c;b1=x}else if(4>h1){g1=x;b1=c}else if(5>h1){r1=x;b1=c}else{r1=c;b1=x}var m=l-.5*c,r=r1+m,g=g1+m,b=b1+m;r*=255;g*=255;b*=255;return[r,g,b]},rgbColorFromRgbString=function(rgbColorString){var rgbValueStrings=rgbColorString.match(/^rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/);if(null===rgbValueStrings)return null;var rgbColor=[parseInt(rgbValueStrings[1],10),parseInt(rgbValueStrings[2],10),parseInt(rgbValueStrings[3],10)];return rgbColor},rgbStringFromRgbColor=function(rgbColor){if(3!=rgbColor.length)return null;var roundedRgbColor=_.map(rgbColor,Math.round),rgbString="rgb("+roundedRgbColor[0]+", "+roundedRgbColor[1]+", "+roundedRgbColor[2]+")";return rgbString},hslStringFromHslColor=function(hslColor){if(3!=hslColor.length)return null;var roundedHslColor=_.map(hslColor,Math.round),hslString="hsl("+roundedHslColor[0]+", "+roundedHslColor[1]+"%, "+roundedHslColor[2]+"%)";return hslString},hslColorFromHslString=function(hslColorString){var hslValueStrings=hslColorString.match(/^hsl\(\s*(\d+)\s*,\s*(\d+)%\s*,\s*(\d+)%\s*\)$/);if(null===hslValueStrings)return null;var hslColor=[parseInt(hslValueStrings[1],10),parseInt(hslValueStrings[2],10),parseInt(hslValueStrings[3],10)];return hslColor},rgbColorFromHexString=function(hexColorString){var normHexColorString=normalizeHexString(hexColorString),hexValueStrings=normHexColorString.match(/^#?([\dA-Fa-f]{2})([\dA-Fa-f]{2})([\dA-Fa-f]{2})$/);if(null===hexValueStrings)return null;var rgbColor=[parseInt(hexValueStrings[1],16),parseInt(hexValueStrings[2],16),parseInt(hexValueStrings[3],16)];return rgbColor},hexStringFromRgbColor=function(rgbColor){if(3!=rgbColor.length)return null;var roundedRgbColor=_.map(rgbColor,Math.round),hexComponents=_.map(roundedRgbColor,function(num){var hex=num.toString(16);hex.length<2&&(hex="0"+hex);return hex.toUpperCase()}),hexString="#"+hexComponents[0]+hexComponents[1]+hexComponents[2];return hexString},normalizeHexString=function(hexString){var normString="#"+hexString.replace("#","");normString=normString.toUpperCase();var hexValueStrings=normString.match(/^#?([\dA-F])([\dA-F])([\dA-F])$/);null!==hexValueStrings&&(normString="#"+hexValueStrings[1]+hexValueStrings[1]+hexValueStrings[2]+hexValueStrings[2]+hexValueStrings[3]+hexValueStrings[3]);return normString},modifyLuminosityOfHslColor=function(hslColor,luminosityMultiplier){var modHslColor=hslColor.slice(0);modHslColor[2]*=luminosityMultiplier;modHslColor[2]>100?modHslColor[2]=100:modHslColor[2]<0&&(modHslColor[2]=100);return modHslColor},modifyLuminosityOfRgbColor=function(rgbColor,luminosityMultiplier){var hslColor=hslColorFromRgbColor(rgbColor),modHslColor=modifyLuminosityOfHslColor(hslColor,luminosityMultiplier),modRgbColor=rgbColorFromHslColor(modHslColor);return modRgbColor},modifyLuminosityOfHexString=function(hexString,luminosityMultiplier){var rgbColor=rgbColorFromHexString(hexString),modRgbColor=modifyLuminosityOfRgbColor(rgbColor,luminosityMultiplier),modHexString=hexStringFromRgbColor(modRgbColor);return modHexString},generateGradientStylesWithMidColor=function(startColor,midColor,colorStop,endColor){for(var gradients=[" -webkit-gradient(linear, 0 0, 0 100%, from(@startColor), color-stop(@colorStop, @midColor), to(@endColor)) "," -webkit-linear-gradient(@startColor, @midColor @colorStop, @endColor) "," -moz-linear-gradient(top, @startColor, @midColor @colorStop, @endColor) "," -o-linear-gradient(@startColor, @midColor @colorStop, @endColor) "," linear-gradient(@startColor, @midColor @colorStop, @endColor) "," progid:DXImageTransform.Microsoft.gradient(startColorstr='@startColor', endColorstr='@endColor', GradientType=0) "],i=0;i<gradients.length;i++){gradients[i]=gradients[i].replace(/@startColor/g,startColor);gradients[i]=gradients[i].replace(/@midColor/g,midColor);gradients[i]=gradients[i].replace(/@colorStop/g,colorStop);gradients[i]=gradients[i].replace(/@endColor/g,endColor)}return gradients},generateGradientStyles=function(startColor,endColor){for(var gradients=[" -moz-linear-gradient(top, @startColor, @endColor) "," -webkit-gradient(linear, 0 0, 0 100%, from(@startColor), to(@endColor))"," -webkit-linear-gradient(top, @startColor, @endColor) "," -o-linear-gradient(top, @startColor, @endColor) "," linear-gradient(to bottom, @startColor, @endColor) "," progid:DXImageTransform.Microsoft.gradient(startColorstr='@startColor', endColorstr='@endColor', GradientType=0)  "],i=0;i<gradients.length;i++){gradients[i]=gradients[i].replace(/@startColor/g,startColor);gradients[i]=gradients[i].replace(/@endColor/g,endColor)}return gradients};return{hslColorFromRgbColor:hslColorFromRgbColor,rgbColorFromHslColor:rgbColorFromHslColor,hslColorFromHslString:hslColorFromHslString,rgbColorFromRgbString:rgbColorFromRgbString,hslStringFromHslColor:hslStringFromHslColor,rgbStringFromRgbColor:rgbStringFromRgbColor,rgbColorFromHexString:rgbColorFromHexString,hexStringFromRgbColor:hexStringFromRgbColor,normalizeHexString:normalizeHexString,modifyLuminosityOfHslColor:modifyLuminosityOfHslColor,modifyLuminosityOfRgbColor:modifyLuminosityOfRgbColor,modifyLuminosityOfHexString:modifyLuminosityOfHexString,generateGradientStylesWithMidColor:generateGradientStylesWithMidColor,generateGradientStyles:generateGradientStyles}});define("views/shared/appbar/Master",["jquery","underscore","backbone","module","views/Base","views/shared/appbar/NavItem","views/shared/appbar/AppNav","views/shared/appbar/AppLabel","models/shared/Application","models/services/data/ui/Nav","models/services/AppLocal","collections/services/data/ui/Views","collections/services/SavedSearches","contrib/text!views/shared/appbar/Master.html","helpers/AppNav","uri/route","util/color_utils","util/console"],function($,_,Backbone,module,BaseView,NavItem,AppNavView,AppLabelView,ApplicationModel,NavModel,AppModel,ViewsCollection,SavedSearchesCollection,templateMaster,appNavParser,route,color_utils,console){var View=BaseView.extend({moduleId:module.id,className:"app-bar",initialize:function(options){BaseView.prototype.initialize.apply(this,arguments);this.children.appNav=new AppNavView({model:this.model,collection:this.collection});this.children.appLabel=new AppLabelView({model:this.model,collection:this.collection});this.setBannerColor();this.model.appNav.on("change:color",this.setBannerColor,this);options.autoRender!==!1&&this.debouncedRender()},render:function(){var html=_.template(templateMaster);this.$el.html(html);this.$el.find(".nav").html(this.children.appNav.render().el);this.$el.find(".app-name").html(this.children.appLabel.render().el);return this},setBannerColor:function(){if(!this.model.appNav)return!1;var navColor=color_utils.normalizeHexString(this.model.appNav.get("color")||""),isHexColor=/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(navColor);if(!isHexColor)return!1;this.$el.css("background-color",navColor);return void 0}},{END_GRADIENT_LUMINOSITY:.9,createWithAppNavUrl:function(options){var self=this,app=options.model.application.get("app"),owner=options.model.application.get("owner"),applicationDfd=new $.Deferred;app&&owner?applicationDfd.resolve(app,owner):options.model.application.once("change",function(){var app=options.model.application.get("app"),owner=options.model.application.get("owner");app&&owner&&applicationDfd.resolve(app,owner)});applicationDfd.done(function(){var url=route.appNavUrl(options.model.application.get("root"),options.model.application.get("locale"),options.model.application.get("app"));$.ajax({url:url,dataType:"json"}).done(function(data){self._applyAppNavData(data,options.model.appNav,options,!1)}).fail(function(){self.createWithBackbone(options)})})},createWithAppNavModel:function(options){var appNav=options.model.appNav;this._applyAppNavData(appNav.entry.content.toJSON(),appNav,options,!1)},createWithBackbone:function(options){function updateNavData(){var appLabel,data=appNavParser.parseNavModel(options.model.splunkDappNav,options.collection.views,options.collection.savedSearches,options.model.application.get("root"));data.appLabel?appLabel=data.appLabel:options.model.app&&options.model.app.entry&&options.model.app.entry.content&&options.model.app.entry.content.get("label")&&(appLabel=options.model.app.entry.content.get("label")||"");self._applyAppNavData({nav:data.nav,color:data.color,label:appLabel,defaultView:data.defaultView,searchView:data.searchView},options.model.appNav,options,!1)}var self=this,applicationDfd=$.Deferred(),appNavDfd=$.Deferred(),viewsDfd=$.Deferred(),savedSearchesDfd=$.Deferred(),app=options.model.application.get("app"),owner=options.model.application.get("owner");app&&owner?applicationDfd.resolve(app,owner):options.model.application.once("change",function(){var app=options.model.application.get("app"),owner=options.model.application.get("owner");app&&owner&&applicationDfd.resolve(app,owner)});if(!options.model.app){options.model.app=new AppModel;applicationDfd.done(function(app,owner){options.model.app.set({id:"apps/local/"+app});options.model.app.fetch({data:{app:app,owner:owner}})})}if(!options.collection.views){options.collection.views=new ViewsCollection;applicationDfd.done(function(app,owner){options.collection.views.fetch({data:{app:app,owner:owner,count:-1,digest:1}})})}if(!options.collection.savedSearches){options.collection.savedSearches=new SavedSearchesCollection;applicationDfd.done(function(app){options.collection.savedSearches.fetch({data:{app:app,owner:"-",search:"is_visible=1 AND disabled=0",count:-1}})})}if(!options.model.splunkDappNav){options.model.splunkDappNav=new NavModel;applicationDfd.done(function(app,owner){options.model.splunkDappNav.fetch({data:{app:app,owner:owner}})})}options.collection.views.once("reset",viewsDfd.resolve);options.collection.savedSearches.once("reset",savedSearchesDfd.resolve);options.model.splunkDappNav.once("change",appNavDfd.resolve);$.when(viewsDfd,savedSearchesDfd,appNavDfd).then(updateNavData)},_applyAppNavData:function(data,appNav,options,fromCache){var app=options.model.application,appLink=route.page(app.get("root"),app.get("locale")||"",app.get("app")),appIcon=route.appIcon(app.get("root"),app.get("locale")||"",app.get("owner"),app.get("app")),appLogo=route.appLogo(app.get("root"),app.get("locale")||"",app.get("owner"),app.get("app"));if(console.DEBUG_ENABLED)if(this._lastApply)console.log("Applying app nav data %o after %o ms",data,(new Date).getTime()-this._lastApply);else{this._lastApply=(new Date).getTime();console.log("Applying app nav data: %o",data)}appNav.set({nav:data.nav,color:data.color,label:data.label,icon:appIcon,logo:appLogo,link:appLink,defaultView:data.defaultView,searchView:data.searchView});fromCache||this._cacheValue(data,options)},_supportsSessionStorage:function(){return"sessionStorage"in window&&window.sessionStorage},_cachePrefix:"splunk-appnav",_cacheKey:function(app){return[this._cachePrefix,app.get("app"),app.get("owner"),app.get("locale")].join(":")},_cacheValue:function(data,options){if(this._supportsSessionStorage()){data=_(data).pick("nav","color","label","defaultView","searchView");console.log("Caching app nav data: %o",data);try{window.sessionStorage.setItem(this._cacheKey(options.model.application),JSON.stringify(data))}catch(e){console.warn("Update to store app nav data in sessionStorage: ",e)}}},_createFromCache:function(options){if(this._supportsSessionStorage())try{var cacheKey=this._cacheKey(options.model.application),cachedData=JSON.parse(window.sessionStorage.getItem(cacheKey));
if(cachedData){console.log("Applying cached app nav data: %o",cachedData);var appNav=new Backbone.Model;this._applyAppNavData(cachedData,appNav,options,!0);options.model.appNav=appNav;_.delay(_.bind(this._loadDefault,this,options),1e3);return}}catch(e){console.warn("Unable load cached app nav data: ",e)}this._createDefault(options)},_loadDefault:function(options){options.appServerUrl?this.createWithAppNavUrl(options):this.createWithBackbone(options)},_createDefault:function(options){if(options.model.appNav)this.createWithAppNavModel(options);else{options.model.appNav=new Backbone.Model;this._loadDefault(options)}},create:function(options){options=options||{};options.collection=options.collection||{};options.model=options.model||{};options.useSessionStorageCache===!0?this._createFromCache(options):this._createDefault(options);return new View(options)}});return View});define("splunkjs/mvc/sharedmodels",["require","exports","module","jquery","underscore","models/shared/Application","models/services/AppLocal","models/services/authentication/User","collections/services/data/ui/Times","./utils","splunk.config","util/splunkd_utils","models/services/server/ServerInfo","collections/services/AppLocals"],function(require){var $=require("jquery"),_=require("underscore"),AppModel=require("models/shared/Application"),AppLocalModel=require("models/services/AppLocal"),UserModel=require("models/services/authentication/User"),TimeRangesCollection=require("collections/services/data/ui/Times"),utils=require("./utils"),splunkConfig=require("splunk.config"),splunkd_utils=require("util/splunkd_utils"),ServerInfo=require("models/services/server/ServerInfo"),AppLocalCollection=require("collections/services/AppLocals"),pageInfo=utils.getPageInfo(),createSharedModels=function(){return{appLocal:{model:new AppLocalModel,fetch:_.memoize(function(){var appModel=_STORAGE["app"].model,model=_STORAGE["appLocal"].model,dfd=model.dfd=model.fetch({url:splunkd_utils.fullpath(model.url+"/"+encodeURIComponent(appModel.get("app"))),data:{app:appModel.get("app"),owner:appModel.get("owner")}});model.dfd=dfd;return dfd})},user:{model:new UserModel,fetch:_.memoize(function(){var appModel=_STORAGE["app"].model,model=_STORAGE["user"].model,dfd=model.dfd=model.fetch({url:splunkd_utils.fullpath(model.url+"/"+encodeURIComponent(appModel.get("owner"))),data:{app:appModel.get("app"),owner:appModel.get("owner")}});model.dfd=dfd;return dfd})},times:{model:new TimeRangesCollection,fetch:_.memoize(function(){var appModel=_STORAGE["app"].model,model=_STORAGE["times"].model,dfd=model.dfd=model.fetch({data:{app:appModel.get("app"),owner:appModel.get("owner")}});return dfd})},app:{model:new AppModel({owner:splunkConfig.USERNAME,root:pageInfo.root,locale:pageInfo.locale,app:pageInfo.app,page:pageInfo.page}),fetch:function(){return $.Deferred().resolve(_STORAGE["app"].model)}},serverInfo:{model:new ServerInfo,fetch:_.memoize(function(){var model=_STORAGE["serverInfo"].model,dfd=model.dfd=model.fetch();return dfd})},appLocals:{model:new AppLocalCollection,fetch:_.memoize(function(){var appModel=_STORAGE["app"].model,model=_STORAGE["appLocals"].model,dfd=model.dfd=model.fetch({data:{sort_key:"name",sort_dir:"desc",app:"-",owner:appModel.get("owner"),search:"visible=true AND disabled=0 AND name!=launcher",count:-1}});return dfd})}}},_STORAGE=createSharedModels();return{get:function(name){if(!_STORAGE.hasOwnProperty(name))throw new Error("There is no shared model '"+name+"'");var container=_STORAGE[name];container.fetch();return container.model},_setAppOwner:function(name){this.get("app").set("owner",name)},_clear:function(){_STORAGE=createSharedModels()}}});define("helpers/user_agent",["underscore"],function(_){var TESTS={Chrome:/chrome/i,Firefox:/firefox/i,Safari:/safari/i,IE:/(?=.*msie ([\d.]+))|(?=.*trident)(?=.*rv\:([\d.]+))/i,IE11:/(?=.*trident)(?=.*rv\:11)/i,IE10:/msie 10\.0/i,IE9:/msie 9\.0/i,IE8:/msie 8\.0/i,IE7:/msie 7\.0/i,SafariiPhone:/iPhone/,SafariiPad:/iPad/},IE_URL_LIMIT=2048,helper={agentString:window.navigator.userAgent,isChrome:function(){return TESTS.Chrome.test(helper.agentString)},isFirefox:function(){return TESTS.Firefox.test(helper.agentString)},isIE:function(){return TESTS.IE.test(helper.agentString)},isIE11:function(){return TESTS.IE11.test(helper.agentString)},isIE10:function(){return TESTS.IE10.test(helper.agentString)},isIE9:function(){return TESTS.IE9.test(helper.agentString)},isIE8:function(){return TESTS.IE8.test(helper.agentString)},isIE7:function(){return TESTS.IE7.test(helper.agentString)},isSafari:function(){return!helper.isChrome()&&!helper.isSafariiPhone()&&!helper.isSafariiPad()&&TESTS.Safari.test(helper.agentString)},isSafariiPhone:function(){return TESTS.SafariiPhone.test(helper.agentString)},isSafariiPad:function(){return TESTS.SafariiPad.test(helper.agentString)},isiOS:function(){return helper.isSafariiPhone()||helper.isSafariiPad()},isIELessThan:function(testVersion){return helper.isIE()&&parseFloat(TESTS.IE.exec(helper.agentString).sort(function(a,b){return b-a})[0])<testVersion},isInIE7DocumentMode:function(){return 7==document.documentMode?!0:!1},hasUrlLimit:function(){return helper.isIE()?!0:!1},getUrlLimit:function(){return helper.hasUrlLimit()?IE_URL_LIMIT:1/0}};_(_.functions(helper)).chain().each(function(fnName){helper[fnName]=_(helper[fnName]).memoize()});return helper});define("models/config",["jquery","splunk.config","models/Base"],function($,$C,BaseModel){var Model=BaseModel.extend({id:"config",initialize:function(){BaseModel.prototype.initialize.apply(this,arguments)},sync:function(method){throw new Error("invalid method: "+method)}});return new Model($.extend(!0,{},$C))});define("splunkjs/mvc/headerview",["require","exports","module","./mvc","./basesplunkview","views/shared/splunkbar/Master","views/shared/appbar/Master","./sharedmodels","helpers/user_agent","models/config"],function(require,exports,module){var BaseSplunkView=(require("./mvc"),require("./basesplunkview")),GlobalNav=require("views/shared/splunkbar/Master"),AppNav=require("views/shared/appbar/Master"),sharedModels=require("./sharedmodels"),userAgent=require("helpers/user_agent"),config=require("models/config"),HeaderView=BaseSplunkView.extend({moduleId:module.id,className:"splunk-header",options:{appbar:!0,acceleratedAppNav:!1,useSessionStorageCache:!1},initialize:function(){this.configure();this.model=this.model||{};this.model.application=sharedModels.get("app");this.model.user=sharedModels.get("user");this.model.appLocal=sharedModels.get("appLocal");this.model.serverInfo=sharedModels.get("serverInfo");var acceleratedAppNav=this.settings.get("acceleratedAppNav")&&userAgent.isIE7();this.collection=this.collection||{};this.collection.appLocals=sharedModels.get("appLocals");this.globalNav=GlobalNav.create({model:{application:this.model.application,appLocal:this.model.appLocal,user:this.model.user,serverInfo:this.model.serverInfo,config:config},collection:{apps:this.collection.appLocals}});this.settings.get("appbar")&&(this.appNav=AppNav.create({model:{application:this.model.application,app:this.model.appLocal},appServerUrl:acceleratedAppNav,useSessionStorageCache:this.settings.get("useSessionStorageCache"),autoRender:!1}))},render:function(){this.$el.empty().append(this.globalNav.render().el);this.settings.get("appbar")&&this.$el.append(this.appNav.render().el);return this}});return HeaderView});define("util/router_utils",["jquery","underscore","backbone","splunk.util","helpers/user_agent"],function($,_,Backbone,splunkutil,userAgent){var exports={},routeStripper=/^[#\/]|\s+$/g,inMemoryHistory={};exports.AGENT_HAS_URL_LIMIT=userAgent.hasUrlLimit();exports.URL_MAX_LENGTH=userAgent.getUrlLimit();var fragmentIsLegal=function(fragment){if(!exports.AGENT_HAS_URL_LIMIT)return!0;var loc=window.location,urlMinusFragment=loc.href.split("#")[0];return urlMinusFragment.length+fragment.length<exports.URL_MAX_LENGTH},historyIdCounter=0,nextHistoryId=function(){return"_suid_"+ ++historyIdCounter},historyIdRegex=/^#?_suid_\d+$/,fragmentIsHistoryId=function(fragment){return historyIdRegex.test(fragment)},storeFullFragment=function(fragment){var historyId=nextHistoryId();inMemoryHistory[historyId]=fragment;return historyId};Backbone.history.getFragment=function(fragment,forcePushState){var trailingSlash=/\/$/;if(null==fragment)if(this._hasPushState||!this._wantsHashChange||forcePushState){fragment=this.location.pathname;var search=window.location.search;search&&(fragment+=search);var root=this.root.replace(trailingSlash,"");fragment.indexOf(root)||(fragment=fragment.substr(root.length))}else fragment=this.getHash();fragmentIsHistoryId(fragment)&&(fragment=inMemoryHistory[fragment]||"");return exports.strip_route(fragment)};Backbone.history.navigate=function(fragment,options){var History=Backbone.History;if(!History.started)return!1;options&&options!==!0||(options={trigger:!!options});var url=this.root+(fragment=this.getFragment(fragment||""));if(this.fragment!==fragment){this.fragment=fragment;""===fragment&&"/"!==url&&(url=url.slice(0,-1));if(this._hasPushState)this.history[options.replace?"replaceState":"pushState"]({},document.title,url);else{if(!this._wantsHashChange)return this.location.assign(url);this._updateHash(this.location,fragment,options.replace);if(this.iframe&&fragment!==this.getFragment(this.getHash(this.iframe))){options.replace||this.iframe.document.open().close();this._updateHash(this.iframe.location,fragment,options.replace)}}return options.trigger?this.loadUrl(fragment):void 0}};Backbone.history._updateHash=_(Backbone.history._updateHash).wrap(function(originalFn,location,fragment,replace){if(!fragmentIsLegal(fragment)){fragment=storeFullFragment(fragment);if(replace){var currentHash=this.getHash();delete inMemoryHistory[currentHash]}}originalFn.call(Backbone.history,location,fragment,replace)});exports.strip_route=function(route){return route.replace(routeStripper,"")};exports.start_backbone_history=function(forceNoPushState){var hasPushstate="pushState"in window.history;forceNoPushState||!hasPushstate||userAgent.isIE()?$(document).ready(function(){var hash=Backbone.history.getHash(),splitHash=hash.split("?"),hashPath=splitHash[0]||"",hashQuery=splunkutil.queryStringToProp(splitHash[1]||""),locationQuery=splunkutil.queryStringToProp(window.location.search.split("?")[1]||""),mergedQuery=$.extend(locationQuery,hashQuery),flattenedQuery=splunkutil.propToQueryString(mergedQuery),adjustedHash=(hashPath&&!fragmentIsHistoryId(hashPath)?hashPath:exports.strip_route(window.location.pathname))+(flattenedQuery?"?"+flattenedQuery:"");fragmentIsLegal(adjustedHash)||(adjustedHash=storeFullFragment(adjustedHash));window.location.replace(window.location.href.split("#")[0]+"#"+adjustedHash);Backbone.history.start()}):Backbone.history.start({pushState:!0})};return exports});define("models/services/configs/AlertAction",["underscore","models/SplunkDBase"],function(_,Base){return Base.extend({urlRoot:"configs/conf-alert_actions",getSetting:function(key,defaultValue){return this.entry.content.has(key)?this.entry.content.get(key):defaultValue},initialize:function(){Base.prototype.initialize.apply(this,arguments)}})});define("models/services/search/jobs/Control",["jquery","backbone","models/Base","util/splunkd_utils"],function($,Backbone,BaseModel,splunkDUtils){return BaseModel.extend({initialize:function(){BaseModel.prototype.initialize.apply(this,arguments)},sync:function(method,model,options){var defaults={data:{output_mode:"json"}};switch(method){case"update":defaults.processData=!0;defaults.type="POST";defaults.url=splunkDUtils.fullpath(model.id);$.extend(!0,defaults,options);break;default:throw new Error("invalid method: "+method)}return Backbone.sync.call(this,method,model,defaults)}})});define("models/services/search/Job",["jquery","underscore","backbone","models/Base","models/ACLReadOnly","models/services/ACL","models/services/search/jobs/Control","util/splunkd_utils","splunk.util","util/console"],function($,_,Backbone,BaseModel,ACLReadOnlyModel,ACLModel,ControlModel,splunkd_utils,splunkUtil,console){var syncCreate=function(model,options){var rootOptions=options,rootModel=model,deferredResponse=$.Deferred(),createModel=new BaseModel,fetchModel=new BaseModel,createDefaults={data:{rf:"*",auto_cancel:Model.DEFAULT_AUTO_CANCEL,status_buckets:300,output_mode:"json"}},app_and_owner={},customAttrs=this.getCustomDataPayload();options=options||{};options.data=options.data||{};app_and_owner=$.extend(app_and_owner,{app:options.data.app||void 0,owner:options.data.owner||void 0,sharing:options.data.sharing||void 0});var url=splunkd_utils.fullpath(model.url,app_and_owner);$.extend(!0,createDefaults.data,customAttrs||{});$.extend(!0,createDefaults.data,options.data);delete createDefaults.data.app;delete createDefaults.data.owner;delete createDefaults.data.sharing;createDefaults.data.search&&(createDefaults.data.search=splunkUtil.addLeadingSearchCommand(createDefaults.data.search,!0));options.data=$.extend(!0,{},app_and_owner);model.trigger("request",model,deferredResponse,options);var createDeferred=createModel.save({},{url:url,processData:!0,data:createDefaults.data,success:function(createModel){rootModel.set("id",createModel.get("sid"));var fetchDeferred=fetchModel.fetch({url:url+"/"+encodeURIComponent(createModel.get("sid")),data:{output_mode:"json"},success:function(fetchModel,response){rootOptions.success(response)},error:function(fetchModel,response){rootOptions.error(response)}});fetchDeferred.done(function(){deferredResponse.resolve.apply(deferredResponse,arguments)});fetchDeferred.fail(function(){deferredResponse.reject.apply(deferredResponse,arguments)})},error:function(createModel,response){rootOptions.error(response)}});createDeferred.fail(function(){deferredResponse.reject.apply(deferredResponse,arguments)});return deferredResponse.promise()},syncRead=function(model,options){var defaults={data:{output_mode:"json"}},app_and_owner={};if(model.isNew())throw new Error("You cannot read a job without an id.");options&&options.data&&(app_and_owner=$.extend(app_and_owner,{app:options.data.app||void 0,owner:options.data.owner||void 0,sharing:options.data.sharing||void 0}));defaults.url=splunkd_utils.fullpath(model.url+"/"+encodeURIComponent(model.id),app_and_owner);$.extend(!0,defaults,options||{});delete defaults.data.app;delete defaults.data.owner;delete defaults.data.sharing;return Backbone.sync.call(this,"read",model,defaults)},syncUpdate=function(model,options){var defaults={data:{output_mode:"json"}},app_and_owner={},customAttrs=this.getCustomDataPayload();options&&options.data&&(app_and_owner=$.extend(app_and_owner,{app:options.data.app||void 0,owner:options.data.owner||void 0,sharing:options.data.sharing||void 0}));$.extend(!0,defaults.data,customAttrs||{});defaults.url=splunkd_utils.fullpath(model.url+"/"+encodeURIComponent(model.id),app_and_owner);defaults.processData=!0;defaults.type="POST";$.extend(!0,defaults,options||{});delete defaults.data.app;delete defaults.data.owner;delete defaults.data.sharing;return Backbone.sync.call(this,"update",model,defaults)},syncDelete=function(model,options){var defaults={data:{output_mode:"json"}},url=model.url+"/"+encodeURIComponent(model.id);if(options.data&&options.data.output_mode){defaults.url=splunkd_utils.fullpath(url,{})+"?output_mode="+encodeURIComponent(options.data.output_mode);delete options.data.output_mode}else{defaults.url=splunkd_utils.fullpath(url,{})+"?output_mode="+encodeURIComponent(defaults.data.output_mode);delete defaults.data.output_mode}$.extend(!0,defaults,options);defaults.processData=!0;return Backbone.sync.call(this,"delete",model,defaults)},Model=BaseModel.extend({url:"search/jobs",initialize:function(attributes,options){BaseModel.prototype.initialize.apply(this,arguments);this.initializeAssociated();this.entry.links.on("change:control",function(){this.control.set("id",this.entry.links.get("control"))},this);this.entry.links.on("change:alternate",function(){var alt=this.entry.links.get("alternate");alt&&(alt+="/acl");this.acl.set("id",alt)},this);options&&options.splunkDPayload&&this.setFromSplunkD(options.splunkDPayload,{silent:!0})},parseSplunkDMessages:function(response){var messages=BaseModel.prototype.parseSplunkDMessages.call(this,response);if(response&&response.entry&&response.entry.length>0){var entry=response.entry[0],content=entry.content||{};messages=_.union(messages,splunkd_utils.parseMessagesObject(entry.messages),splunkd_utils.parseMessagesObject(content.messages));content.isZombie&&messages.push(splunkd_utils.createMessageObject(splunkd_utils.FATAL,"Job terminated unexpectedly"))}return messages},initializeAssociated:function(){var RootClass=this.constructor;this.associated=this.associated||{};this.links=this.links||new RootClass.Links;this.associated.links=this.links;this.generator=this.generator||new RootClass.Generator;this.associated.generator=this.generator;this.paging=this.paging||new RootClass.Paging;this.associated.paging=this.paging;if(!this.entry){this.entry=new RootClass.Entry;this.entry.links=new RootClass.Entry.Links;this.entry.associated.links=this.entry.links;this.entry.acl=new RootClass.Entry.ACL;this.entry.associated.acl=this.entry.acl;this.entry.content=new RootClass.Entry.Content;this.entry.content.performance=new RootClass.Entry.Content.Performance;this.entry.content.associated.performance=this.entry.content.performance;this.entry.content.request=new RootClass.Entry.Content.Request;this.entry.content.associated.request=this.entry.content.request;this.entry.content.runtime=new RootClass.Entry.Content.Runtime;this.entry.content.associated.runtime=this.entry.content.runtime;this.entry.content.custom=new RootClass.Entry.Content.Custom;this.entry.content.associated.custom=this.entry.content.custom;this.entry.associated.content=this.entry.content}this.associated.entry=this.entry;this.control=this.control||new ControlModel;this.associated.control=this.control;this.acl=this.acl||new ACLModel;this.associated.acl=this.acl},sync:function(method,model,options){switch(method){case"create":return syncCreate.call(this,model,options);case"read":return syncRead.call(this,model,options);case"update":return syncUpdate.call(this,model,options);case"delete":return syncDelete.call(this,model,options);default:throw new Error("invalid method: "+method)}},parse:function(response){response=$.extend(!0,{},response);this.initializeAssociated();if(response&&response.entry&&0!==response.entry.length){var response_entry=response.entry[0];this.id=response_entry.content.sid;response.id=response_entry.content.sid;this.links.set(response.links);delete response.links;this.generator.set(response.generator);delete response.generator;this.paging.set(response.paging);delete response.paging;this.entry.links.set(response_entry.links);delete response_entry.links;this.entry.acl.set(response_entry.acl);delete response_entry.acl;this.entry.content.performance.set(response_entry.content.performance);delete response_entry.content.performance;this.entry.content.request.set(response_entry.content.request);delete response_entry.content.request;this.entry.content.runtime.set(response_entry.content.runtime);delete response_entry.content.runtime;this.entry.content.custom.set(response_entry.content.custom);delete response_entry.content.custom;this.entry.content.set(response_entry.content);delete response_entry.content;this.entry.set(response_entry);delete response.entry;return response}console.log("Response has no content to parse")},setFromSplunkD:function(payload,options){this.attributes={};var cloned_payload=$.extend(!0,{},payload),oldId=this.id;if(cloned_payload){if(cloned_payload.entry&&cloned_payload.entry[0]){var payload_entry=cloned_payload.entry[0];if(payload_entry.content){this.set({id:payload_entry.content.sid},{silent:!0});cloned_payload.id=payload_entry.content.sid;if(payload_entry.content.performance){this.entry.content.performance.set(payload_entry.content.performance,options);delete payload_entry.content.performance}if(payload_entry.content.request){this.entry.content.request.set(payload_entry.content.request,options);delete payload_entry.content.request}if(payload_entry.content.runtime){this.entry.content.runtime.set(payload_entry.content.runtime,options);delete payload_entry.content.runtime}if(payload_entry.content.custom){this.entry.content.custom.set(payload_entry.content.custom,options);delete payload_entry.content.custom}this.entry.content.set(payload_entry.content,options);delete payload_entry.content}if(payload_entry.links){this.entry.links.set(payload_entry.links,options);payload_entry.links.control&&this.control.set("id",payload_entry.links.control,options);payload_entry.links.alternate&&this.acl.set("id",payload_entry.links.alternate+"/acl",options);delete payload_entry.links}if(payload_entry.acl){this.entry.acl.set(payload_entry.acl,options);delete payload_entry.acl}this.entry.set(payload_entry,options);delete cloned_payload.entry}if(cloned_payload.links){this.links.set(cloned_payload.links,options);delete cloned_payload.links}if(cloned_payload.generator){this.generator.set(cloned_payload.generator,options);delete cloned_payload.generator}if(cloned_payload.paging){this.paging.set(cloned_payload.paging,options);delete cloned_payload.paging}this.set(cloned_payload,options);this.id!==oldId&&this.trigger("change:"+this.idAttribute)}},toSplunkD:function(){var payload={};payload=$.extend(!0,{},this.toJSON());payload.links=$.extend(!0,{},this.links.toJSON());payload.generator=$.extend(!0,{},this.generator.toJSON());payload.paging=$.extend(!0,{},this.paging.toJSON());payload.entry=[$.extend(!0,{},this.entry.toJSON())];payload.entry[0].links=$.extend(!0,{},this.entry.links.toJSON());payload.entry[0].acl=$.extend(!0,{},this.entry.acl.toJSON());payload.entry[0].content=$.extend(!0,{},this.entry.content.toJSON());payload.entry[0].content.performance=$.extend(!0,{},this.entry.content.performance.toJSON());payload.entry[0].content.request=$.extend(!0,{},this.entry.content.request.toJSON());payload.entry[0].content.runtime=$.extend(!0,{},this.entry.content.runtime.toJSON());payload.entry[0].content.custom=$.extend(!0,{},this.entry.content.custom.toJSON());delete payload.id;return payload},getCustomDataPayload:function(){var payload=$.extend(!0,{},this.entry.content.custom.toJSON()),keys=_.keys(payload);_.each(keys,function(key){var newKey="custom."+key;payload[newKey]=payload[key];delete payload[key]});return payload},canSummarize:function(){return splunkUtil.normalizeBoolean(this.entry.content.get("canSummarize"))}},{QUEUED:"QUEUED",PARSING:"PARSING",RUNNING:"RUNNING",PAUSED:"PAUSED",FINALIZING:"FINALIZING",FAILED:"FAILED",DONE:"DONE",DEFAULT_AUTO_CANCEL:30,DEFAULT_AUTO_PAUSE:30,DEFAULT_POLLING_INTERVAL:1e3,DEFAULT_METADATA_POLLING_INTERVAL:3e3,DEFAULT_KEEP_ALIVE_INTERVAL:15e3,Links:BaseModel,Generator:BaseModel,Paging:BaseModel,Entry:BaseModel.extend({initialize:function(){BaseModel.prototype.initialize.apply(this,arguments)}},{Links:BaseModel,ACL:ACLReadOnlyModel,Content:BaseModel.extend({initialize:function(){BaseModel.prototype.initialize.apply(this,arguments)}},{Performance:BaseModel,Request:BaseModel,Runtime:BaseModel,Custom:BaseModel})})});return Model});define("models/search/Job",["jquery","underscore","backbone","models/services/search/Job","util/splunkd_utils","util/time","util/console","splunk.util","helpers/Session","util/Ticker"],function($,_,Backbone,SearchJob,splunkd_utils,time_utils,console,splunkUtil,Session,Ticker){var JobModel=SearchJob.extend({initialize:function(attributes,options){SearchJob.prototype.initialize.apply(this,arguments);this.options=options||{};this.setInstanceDefaults();this.entry.content.on("change",function(){var changedAttributes=this.entry.content.changedAttributes(),previousAttributes=this.entry.content.previousAttributes();this.handleJobProgress(changedAttributes,previousAttributes)},this);this.entry.content.on("change:dispatchState",function(){if(this.entry.content.get("dispatchState")&&!this.isPreparing()&&!this.prepared){this.prepared=!0;this.trigger("prepared")}},this);this.ticker=new Ticker({interval:100});this.ticker.on("tick",function(){this.safeFetch({data:{app:this.entry.acl.get("app"),owner:this.entry.acl.get("owner"),sharing:this.entry.acl.get("sharing")}})},this);this.entry.content.on("change:dispatchState",function(){(this.entry.content.get("isDone")||this.entry.content.get("isFailed"))&&this.stopPolling()},this);this.on("prepared",function(){var attemptCount=0,maxAttempts=30,_private_progress=function(){var count;attemptCount++;if(this.entry.content.get("isDone")||this.entry.content.get("isFailed"))this.off("sync",_private_progress,this);else{count=this.entry.content.get(this.isReportSearch()?this.entry.content.get("isPreviewEnabled")?"resultPreviewCount":"resultCount":"eventAvailableCount");if(count>0||attemptCount===maxAttempts){this.off("sync",_private_progress,this);this.trigger("slowDownPoller")}}}.bind(this);this.on("slowDownPoller",function(){this._poll&&this.ticker.restart({interval:this.pollingDelay})},this);this.on("sync",_private_progress,this)},this);this.on("error",function(){splunkd_utils.messagesContainsOneOfTypes(this.error.get("messages"),[splunkd_utils.NOT_FOUND,splunkd_utils.FATAL])&&this.handleJobDestroy()},this);this.entry.content.on("change:isFailed",function(){this.entry.content.get("isFailed")&&this.handleJobDestroy()},this);this.on("destroy",this.handleJobDestroy,this)},setInstanceDefaults:function(){this._poll=!1;this.pollingDelay=this.options.delay||SearchJob.DEFAULT_POLLING_INTERVAL;this.prepared=this.entry.content.get("dispatchState")&&!this.isPreparing();this.processKeepAlive=this.options.processKeepAlive||!1;this.keepAlivePoller=null;this.keepAliveInterval=this.options.keepAliveInterval||SearchJob.DEFAULT_KEEP_ALIVE_INTERVAL},clear:function(){SearchJob.prototype.clear.apply(this,arguments);this.setInstanceDefaults();return this},handleJobProgress:function(changed,previous){if(this.isNew())return!1;var jobIsRealTime=this.entry.content.get("isRealTimeSearch"),jobIsReportSearch=this.entry.content.get("reportSearch"),jobAdHocModeIsVerbose=this.getAdhocSearchMode()===splunkd_utils.VERBOSE,jobPreviewEnabled=this.entry.content.get("isPreviewEnabled"),jobIsDoneInModel=this.entry.content.get("isDone"),changeIsEmpty=_.isEmpty(changed);if(changeIsEmpty||!jobIsDoneInModel&&jobIsReportSearch&&!jobPreviewEnabled&&!jobAdHocModeIsVerbose)return!1;var scanCountChanged=!_(changed.scanCount).isUndefined()&&changed.scanCount>previous.scanCount,eventCountChanged=!_(changed.eventCount).isUndefined(),resultCountChanged=!_(changed.resultCount).isUndefined(),jobIsDone=!_(changed.isDone).isUndefined()&&changed.isDone===!0,jobIsUpdated=scanCountChanged||eventCountChanged||resultCountChanged||jobIsDone||jobIsRealTime;if(!jobIsUpdated)return!1;this.trigger("jobProgress");var links=this.entry.links;this.trigger("jobProgress:"+JobModel.RESULTS_PREVIEW,links.get(JobModel.RESULTS_PREVIEW));this.trigger("jobProgress:"+JobModel.RESULTS,links.get(JobModel.RESULTS));this.trigger("jobProgress:"+JobModel.SUMMARY,links.get(JobModel.SUMMARY));this.trigger("jobProgress:"+JobModel.TIMELINE,links.get(JobModel.TIMELINE));this.trigger("jobProgress:"+JobModel.EVENTS,links.get(JobModel.EVENTS));jobIsDone&&this.processKeepAlive&&this.startKeepAlive();return!0},registerJobProgressLinksChild:function(linksKey,child,callback,scope){var id=this.entry.links.get(linksKey);if(id){child.set("id",id);callback.call(scope);this.on("jobProgress",callback,scope);return!0}console.warn("Search Job Model: You attempted to register a child model with a links key that doesn't exist. Have you fetched your job lately? Key:",linksKey);return!1},unregisterJobProgressLinksChild:function(callback,scope){this.off("jobProgress",callback,scope)},handleJobDestroy:function(){this.stopPolling();this.processKeepAlive=!1;this.stopKeepAlive();this.fetchAbort();this.control.fetchAbort()},startKeepAlive:function(){this.stopPolling();Session.on("timeout",this.stopKeepAlive,this);Session.on("start",this.startKeepAlive,this);this.stopKeepAlive();this.keepAlivePoller=new Ticker({interval:this.keepAliveInterval});this.keepAlivePoller.on("tick",function(){this.control.save({},{data:{action:"touch"},success:function(model){console.log("touched job:",model.id)}.bind(this),error:function(model,response){if(!response.hasOwnProperty("status")||0!=response.status&&12029!=response.status){console.log("error touching job (stopping keep alive):",model.id);this.stopKeepAlive()}}.bind(this)})},this);this.keepAlivePoller.start()},stopKeepAlive:function(){if(this.keepAlivePoller){this.keepAlivePoller.stop();this.keepAlivePoller.off()}},startPolling:function(force){if(!this._poll||force){this._poll=!0;Session.off("timeout",null,this);Session.off("start",null,this);Session.on("timeout",this.stopPolling,this);Session.on("start",function(){this.startPolling(!0)},this);(force||!this.entry.content.get("isDone")&&!this.entry.content.get("isFailed"))&&this.ticker.start(!0)}},stopPolling:function(){if(this._poll){this._poll=!1;Session.off("timeout",null,this);Session.off("start",null,this);this.ticker.stop()}},noParamControlUpdate:function(action,options){options&&options.data&&delete options.data;return this.control.save({},$.extend(!0,options,{data:{action:action}}))},pause:function(options){return this.noParamControlUpdate("pause",options)},unpause:function(options){return this.noParamControlUpdate("unpause",options)},finalize:function(options){return this.noParamControlUpdate("finalize",options)},cancel:function(options){return this.noParamControlUpdate("cancel",options)},touch:function(options){return this.noParamControlUpdate("touch",options)},setTTL:function(ttl,options){options&&options.data&&delete options.data;return this.control.save({},$.extend(!0,options,{data:{action:"setttl",ttl:ttl}}))},setPriority:function(priority,options){options&&options.data&&delete options.data;return this.control.save({},$.extend(!0,options,{data:{action:"setpriority",priority:priority}}))},enablePreview:function(options){return this.noParamControlUpdate("enablepreview",options)},disablePreview:function(options){return this.noParamControlUpdate("disablepreview",options)},setPreview:function(preview,options){var currentPreview=this.entry.content.get("isPreviewEnabled");if(preview!==currentPreview)return preview?this.enablePreview(options):this.disablePreview(options);options&&options.success&&_.isFunction(options.success)&&options.success(this,{},options);return $.Deferred().resolve()},saveControlUpdate:function(action,options){options=options||{};options.data=options.data||{};var data={action:action,auto_cancel:options.data.auto_cancel,auto_pause:options.data.auto_pause,email_list:options.data.email_list,email_subject:options.data.email_subject,email_results:options.data.email_results,ttl:options.data.ttl};options&&options.data&&delete options.data;return this.control.save({},$.extend(!0,options,{data:data}))},saveJob:function(options){return this.saveControlUpdate("save",options)},unsaveJob:function(options){return this.saveControlUpdate("unsave",options)},makeWorldReadable:function(options){var data=(this.entry.acl.get("owner"),{sharing:splunkd_utils.GLOBAL,owner:this.entry.acl.get("owner"),"perms.read":"*"});options&&options.data&&delete options.data;return this.acl.save({},$.extend(!0,options,{data:data}))},undoWorldReadable:function(options){var owner=this.entry.acl.get("owner"),data={sharing:splunkd_utils.GLOBAL,owner:owner,"perms.read":""};options&&options.data&&delete options.data;return this.acl.save({},$.extend(!0,options,{data:data}))},isSharedAccordingToTTL:function(defaultSaveTTL){var perms=this.entry.acl.permsToObj();return-1!=perms.read.indexOf("*")&&this.entry.content.get("ttl")===defaultSaveTTL?!0:!1},saveIsBackground:function(options){this.entry.content.custom.set("isBackground","1");return this.save({},options)},isBackground:function(){return splunkUtil.normalizeBoolean(this.entry.content.custom.get("isBackground"))
},resultCountSafe:function(){return this.entry.content.get(this.entry.content.get("isPreviewEnabled")&&!this.entry.content.get("isDone")?"resultPreviewCount":"resultCount")},eventAvailableCountSafe:function(){return 0==this.entry.content.get("statusBuckets")?this.resultCountSafe():this.entry.content.get("eventAvailableCount")},latestTimeSafe:function(){var entry=this.entry;return entry.content.get("latestTime")||entry.get("published")},isQueued:function(){return this.checkUppercaseValue("dispatchState",JobModel.QUEUED)},isParsing:function(){return this.checkUppercaseValue("dispatchState",JobModel.PARSING)},isFinalizing:function(){return this.checkUppercaseValue("dispatchState",JobModel.FINALIZING)},isPreparing:function(){return this.isQueued()||this.isParsing()},isRunning:function(){return!(this.isNew()||this.entry.content.get("isPaused")||this.entry.content.get("isDone")||this.isPreparing()||this.isFinalizing())},isReportSearch:function(){return this.entry.content.get("reportSearch")?!0:!1},isOverAllTime:function(){var dispatchEarliestTime=this.getDispatchEarliestTime();return!(dispatchEarliestTime&&"0"!==dispatchEarliestTime||this.getDispatchLatestTime())},isRealtime:function(){return this.entry.content.get("isRealTimeSearch")},checkUppercaseValue:function(key,uc_value){var value=this.entry.content.get(key);return value?value.toUpperCase()===uc_value:!1},getDispatchEarliestTime:function(){var earliest=this.entry.content.request.get("earliest_time");return void 0===earliest?this.entry.content.get("searchEarliestTime"):earliest},getDispatchEarliestTimeOrAllTime:function(){return"scheduler"===this.entry.content.get("delegate")&&void 0!==this.entry.content.get("searchLatestTime")?this.entry.content.get("searchEarliestTime")||"":this.entry.content.request.get("earliest_time")||""},getDispatchLatestTime:function(){var latest=this.entry.content.request.get("latest_time");return void 0===latest?this.entry.content.get("searchLatestTime"):latest},getDispatchLatestTimeOrAllTime:function(){var searchLatestTime=this.entry.content.get("searchLatestTime");return"scheduler"===this.entry.content.get("delegate")&&void 0!==searchLatestTime?searchLatestTime:this.entry.content.request.get("latest_time")||""},getStrippedEventSearch:function(){var search=this.entry.content.get("eventSearch");search&&(search=splunkUtil.stripLeadingSearchCommand(search));return search},getSearch:function(){var search=this.entry.get("name");return search?search:this.entry.content.request.get("search")},getAdhocSearchMode:function(){var delegate,mode=this.entry.content.request.get("adhoc_search_level"),statusBuckets=this.entry.content.get("statusBuckets");if(!mode){if(void 0!==statusBuckets&&0==statusBuckets)return splunkd_utils.FAST;delegate=this.entry.content.get("delegate");if(this.entry.content.get("isSavedSearch")&&"scheduler"===delegate)return splunkd_utils.FAST}return mode},canBePausedOnRemove:function(){return this.isNew()||this.entry.content.get("isDone")||this.get("cannotPauseOnRemove")||this.entry.content.get("isPaused")||this.isBackground()||this.entry.content.get("isSaved")?!1:!0},deepOff:function(){SearchJob.prototype.deepOff.apply(this,arguments);Session.off(null,null,this)}},{RESULTS_PREVIEW:"results_preview",SUMMARY:"summary",TIMELINE:"timeline",EVENTS:"events",RESULTS:"results",createMetaDataSearch:function(search,deferred,applicationModel){var job=new JobModel({},{delay:SearchJob.DEFAULT_METADATA_POLLING_INTERVAL});job.save({},{data:{app:applicationModel.get("app"),owner:applicationModel.get("owner"),search:search,preview:"true",earliest_time:"rt",latest_time:"rt",auto_cancel:SearchJob.DEFAULT_AUTO_CANCEL,max_count:1e5},success:function(){deferred.resolve()},error:function(){deferred.resolve()}});return job}});return JobModel});define("util/pdf_utils",["underscore","jquery","splunk.util","util/console","models/services/configs/AlertAction","models/search/Job","splunk.config"],function(_,$,splunkUtil,console,AlertAction,Job,splunkConfig){function sendPDFEmail(view,app,to,options){var dfd=$.Deferred();getEmailAlertSettings().done(function(emailSettings){to=to.split(/[,\s]+/).join(",");var commandParams={server:emailSettings.getSetting("mailserver","localhost"),use_ssl:emailSettings.getSetting("use_ssl","false"),use_tls:emailSettings.getSetting("use_tls","false"),to:to,sendpdf:"True",from:emailSettings.getSetting("from","splunk@localhost"),papersize:options.paperSize||"a2",paperorientation:options.paperOrientation||"portrait",pdfview:view},searchString="| sendemail "+_(commandParams).map(function(v,k){return[k,JSON.stringify(v)].join("=")}).join(" ");console.log("Starting search %o",searchString);var job=new Job;job.save({},{data:{search:searchString,earliest_time:"0",latest_time:"now",app:app,namespace:app,owner:splunkConfig.USERNAME,ui_dispatch_app:app,ui_dispatch_view:view,preview:!1}}).done(_.bind(function(){job.startPolling();job.entry.content.on("change:isDone",function(m,isDone){if(isDone){var messages=job.entry.content.get("messages");_(messages).each(function(msg){"ERROR"===msg.type&&console.error(msg.text)});_(messages).any(function(msg){return"ERROR"===msg.type})?dfd.reject(_(messages).pluck("text")[0]):dfd.resolve();_.defer(_.bind(job.destroy,job))}});job.entry.content.on("change:isFailed",function(m,isFailed){isFailed&&dfd.reject();_.defer(_.bind(job.destroy,job))});job.on("error",function(){dfd.reject("Error creating search job");_.defer(_.bind(job.destroy,job))})},this)).fail(_.bind(function(){console.log("Search creation fail",arguments)},this))}).fail(function(){dfd.reject()});return dfd.promise()}function encodeXMLForCustomEndpoint(xml){return xml.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}var TYPE_PDFGEN="pdfgen",TYPE_DEPRECATED="deprecated",isPdfServiceAvailable=_.once(function(){var dfd=$.Deferred();splunkConfig["PDFGEN_IS_AVAILABLE"]?dfd.resolve(!0,TYPE_PDFGEN):$.getJSON(splunkUtil.make_url("report/is_enabled")).success(function(data){data&&"enabled"==data.status?dfd.resolve(!0,TYPE_DEPRECATED):dfd.resolve(!1,data&&data.status)}).error(function(){dfd.resolve(!1)});return dfd.promise()}),getEmailAlertSettings=_.once(function(){var dfd=$.Deferred(),emailAlertSettings=new AlertAction({id:"email"});emailAlertSettings.fetch().done(function(){dfd.resolve(emailAlertSettings)}).fail(function(){dfd.reject()});return dfd.promise()}),downloadReportFromXML=function(xml,app,params){var baseURL=splunkUtil.make_full_url("splunkd/__raw/services/pdfgen/render"),form=$('<form method="POST" target="_blank"></form>').attr("action",baseURL);$("<input/>").attr({type:"hidden",name:"input-dashboard-xml",value:encodeXMLForCustomEndpoint(xml)}).appendTo(form);$("<input/>").attr({type:"hidden",name:"namespace",value:app}).appendTo(form);$("<input/>").attr({type:"hidden",name:"splunk_form_key",value:splunkUtil.getFormKey()}).appendTo(form);params&&_.each(params,function(v,k){$("<input/>").attr({type:"hidden",name:k,value:v}).appendTo(form)});console.log("submitting form",form[0]);form.appendTo(document.body).submit();_.defer(function(){form.remove()})},getRenderURL=function(view,app,params,viewType){var dfd=$.Deferred();isPdfServiceAvailable().done(function(bool,type){var inputType=viewType?"input-"+viewType:"input-dashboard",data={namespace:app};data[inputType]=view;if(type===TYPE_PDFGEN){params=_.extend(data,params||{});dfd.resolve(splunkUtil.make_full_url("splunkd/__raw/services/pdfgen/render",params))}else type===TYPE_DEPRECATED?dfd.resolve([splunkUtil.make_url("app",app,view),splunkUtil.propToQueryString({output:"pdf"})].join("?")):dfd.reject()}).fail(function(){dfd.reject()});return dfd.promise()};return{isPdfServiceAvailable:isPdfServiceAvailable,getRenderURL:getRenderURL,downloadReportFromXML:downloadReportFromXML,getEmailAlertSettings:getEmailAlertSettings,sendTestEmail:sendPDFEmail}});define("models/services/data/ui/Viewstate",["underscore","models/SplunkDBase","util/splunkd_utils","splunk.util"],function(_,BaseModel,splunkd_utils,splunkUtil){return BaseModel.extend({url:"data/ui/viewstates",initialize:function(){BaseModel.prototype.initialize.apply(this,arguments)},getFlattenedAndDedupedModules:function(){var content=this.entry.content.toJSON(),flattenedModules={};delete content["eai:acl"];delete content["eai:appName"];delete content["eai:userName"];delete content["disabled"];_.each(content,function(value,module){var keySplit=module.split("."),key=keySplit[0].split("_")[0],child=keySplit[1];flattenedModules[key]||(flattenedModules[key]={});flattenedModules[key][child]||(flattenedModules[key][child]=value)});return flattenedModules},convertToReportPoperties:function(){var eventsTabSelected,statsTabSelected,vizTabSelected,buttonSwitcher,count,softWrap,segmentation,fields,rowNumbers,flattenedModules=this.getFlattenedAndDedupedModules(),props={};if(flattenedModules["ButtonSwitcher"]){buttonSwitcher=flattenedModules["ButtonSwitcher"]["selected"];if("splIcon-results-table"===buttonSwitcher){props["display.general.type"]="statistics";statsTabSelected=!0}else if("splIcon-events-list"===buttonSwitcher){props["display.general.type"]="events";eventsTabSelected=!0}}else{props["display.general.type"]="visualizations";vizTabSelected=!0}flattenedModules["AxisScaleFormatter"]&&(props["display.visualizations.charting.axisY.scale"]=flattenedModules["AxisScaleFormatter"]["default"]);if(flattenedModules["FancyChartTypeFormatter"]){props["display.visualizations.type"]="charting";props["display.visualizations.charting.chart"]=flattenedModules["FancyChartTypeFormatter"]["default"]}if(flattenedModules["ChartTypeFormatter"]){props["display.visualizations.type"]="charting";props["display.visualizations.charting.chart"]=flattenedModules["ChartTypeFormatter"]["default"]}flattenedModules["LegendFormatter"]&&(props["display.visualizations.charting.legend.placement"]=flattenedModules["LegendFormatter"]["default"]);flattenedModules["LineMarkerFormatter"]&&(props["display.visualizations.charting.axisX.markers"]=splunkd_utils.normalizeBooleanTo01String(flattenedModules["LineMarkerFormatter"]["default"]));flattenedModules["NullValueFormatter"]&&(props["display.visualizations.charting.chart.nullValueMode"]=flattenedModules["NullValueFormatter"]["default"]);flattenedModules["StackModeFormatter"]&&(props["display.visualizations.charting.chart.stackMode"]=flattenedModules["StackModeFormatter"]["default"]);flattenedModules["XAxisTitleFormatter"]&&(props["display.visualizations.charting.axisTitleX.text"]=flattenedModules["XAxisTitleFormatter"]["default"]);flattenedModules["YAxisRangeMaximumFormatter"]&&(props["display.visualizations.charting.axisY.maximumNumber"]=flattenedModules["YAxisRangeMaximumFormatter"]["default"]);flattenedModules["YAxisRangeMinimumFormatter"]&&(props["display.visualizations.charting.axisY.minimumNumber"]=flattenedModules["YAxisRangeMinimumFormatter"]["default"]);flattenedModules["YAxisRangeMinimumFormatter"]&&(props["display.visualizations.charting.axisY.minimumNumber"]=flattenedModules["YAxisRangeMinimumFormatter"]["default"]);flattenedModules["YAxisTitleFormatter"]&&(props["display.visualizations.charting.axisTitleY.text"]=flattenedModules["YAxisTitleFormatter"]["default"]);flattenedModules["FlashChart"]&&(props["display.visualizations.chartHeight"]=flattenedModules["FlashChart"]["height"].replace("px",""));flattenedModules["JSChart"]&&(props["display.visualizations.chartHeight"]=flattenedModules["JSChart"]["height"].replace("px",""));flattenedModules["FlashTimeline"]&&(props["display.page.search.timeline.format"]=splunkUtil.normalizeBoolean(flattenedModules["FlashTimeline"]["minimized"])?"compact":"hidden");if(flattenedModules["Count"]){count=flattenedModules["Count"]["default"]||flattenedModules["Count"]["count"];statsTabSelected||vizTabSelected?props["display.prefs.statistics.count"]=count:props["display.prefs.events.count"]=count}flattenedModules["DataOverlay"]&&(props["display.statistics.overlay"]=flattenedModules["DataOverlay"]["default"]||flattenedModules["DataOverlay"]["dataOverlayMode"]);if(flattenedModules["HiddenSoftWrap"]){softWrap=splunkd_utils.normalizeBooleanTo01String(flattenedModules["HiddenSoftWrap"]["enable"]);if(statsTabSelected||vizTabSelected)props["display.statistics.wrap"]=softWrap;else{props["display.events.list.wrap"]=softWrap;props["display.events.table.wrap"]=softWrap}}if(flattenedModules["SoftWrap"]){softWrap=splunkd_utils.normalizeBooleanTo01String(flattenedModules["SoftWrap"]["enable"]);if(statsTabSelected||vizTabSelected)props["display.statistics.wrap"]=softWrap;else{props["display.events.list.wrap"]=softWrap;props["display.events.table.wrap"]=softWrap}}flattenedModules["MaxLines"]&&(props["display.events.maxLines"]=flattenedModules["MaxLines"]["default"]||flattenedModules["MaxLines"]["maxLines"]);if(flattenedModules["RowNumbers"]){rowNumbers=flattenedModules["RowNumbers"]["default"]||flattenedModules["RowNumbers"]["displayRowNumbers"];rowNumbers=splunkd_utils.normalizeBooleanTo01String(rowNumbers);statsTabSelected||vizTabSelected?props["display.statistics.rowNumbers"]=rowNumbers:props["display.events.rowNumbers"]=rowNumbers}if(flattenedModules["Segmentation"]){segmentation=flattenedModules["Segmentation"]["default"]||flattenedModules["Segmentation"]["segmentation"];if(statsTabSelected||vizTabSelected)["row","cell","none"].indexOf(segmentation)>-1&&(props["display.statistics.drilldown"]=segmentation);else if(["inner","outer","full","none"].indexOf(segmentation)>-1){props["display.events.list.drilldown"]=segmentation;props["display.events.raw.drilldown"]=segmentation}}if(flattenedModules["FieldPicker"]){fields=flattenedModules["FieldPicker"]["fields"].split(",");props["display.events.fields"]='["'+fields.join('","')+'"]';props["display.page.search.showFields"]=splunkd_utils.normalizeBooleanTo01String(flattenedModules["FieldPicker"]["sidebarDisplay"])}return props}})});define("collections/services/search/Jobs",["models/services/search/Job","collections/SplunkDsBase"],function(JobModel,SplunkDsBaseCollection){return SplunkDsBaseCollection.extend({url:"search/jobs",model:JobModel,initialize:function(){SplunkDsBaseCollection.prototype.initialize.apply(this,arguments)}})});define("collections/search/Jobs",["underscore","models/search/Job","collections/services/search/Jobs"],function(_,JobModel,JobsCollection){return JobsCollection.extend({model:JobModel,comparator:function(job){var date=new Date(job.entry.get("published"));return date.valueOf()||0},initialize:function(){JobsCollection.prototype.initialize.apply(this,arguments)},fetchNonAutoSummaryJobs:function(options){var omit_autosummary='(NOT _AUTOSUMMARY AND NOT "|*summarize*action=")',filters={};options=options||{};options.data=options.data||{};options.data.count=options.data.count||10;options.data.offset=options.data.offset||0;options.data.sortKey=options.data.sortKey||"dispatch_time";options.data.sortDir=options.data.sortDir||"desc";options.data.search=options.data.search?omit_autosummary+" AND ("+options.data.search+")":omit_autosummary;filters["NOT isDataPreview"]="1";options.data.app&&"*"!==options.data.app&&(filters["eai:acl.app"]=options.data.app);delete options.data.app;options.data.owner&&"*"!==options.data.owner&&(filters["eai:acl.owner"]=options.data.owner);delete options.data.owner;options.data.label&&(filters.label=options.data.label);delete options.data.label;if(options.data.jobStatus&&"*"!==options.data.jobStatus)if("running"===options.data.jobStatus){filters["isDone"]=0;filters["isPaused"]=0;filters["isFinalized"]=0}else"done"===options.data.jobStatus?filters["isDone"]=1:"paused"===options.data.jobStatus?filters["isPaused"]=1:"finalized"===options.data.jobStatus&&(filters["isFinalized"]=1);delete options.data.jobStatus;_.each(filters,function(value,key){options.data.search=options.data.search+" "+key+'="'+value+'"'});return this.fetch(options)}})});define("models/search/Report",["jquery","underscore","models/services/SavedSearch","models/services/data/ui/Viewstate","collections/search/Jobs","util/time","util/splunkd_utils","util/general_utils","splunk.util","splunk.i18n","uri/route","util/math_utils"],function($,_,SavedSearch,Viewstate,JobsCollection,time_utils,splunkd_utils,general_utils,splunkUtil,i18n,route,math_utils){var ReportModel=SavedSearch.extend({reportTree:{match:{"display.general.type":{visualizations:{match:{"display.visualizations.type":{singlevalue:{view:"single",icon:"single-value",label:_("Single Value").t()},charting:{match:{"display.visualizations.charting.chart":{line:{view:"line",icon:"chart-line",label:_("Line").t()},area:{view:"area",icon:"chart-area",label:_("Area").t()},column:{view:"column",icon:"chart-column",label:_("Column").t()},bar:{view:"bar",icon:"chart-bar",label:_("Bar").t()},pie:{view:"pie",icon:"chart-pie",label:_("Pie").t()},scatter:{view:"scatter",icon:"chart-scatter",label:_("Scatter").t()},radialGauge:{view:"radialGauge",icon:"gauge-radial",label:_("Radial").t()},fillerGauge:{view:"fillerGauge",icon:"gauge-filler",label:_("Filler").t()},markerGauge:{view:"markerGauge",icon:"gauge-marker",label:_("Marker").t()}}}},mapping:{view:"mapping",icon:"location",label:_("Map").t()}}}},statistics:{view:"statistics"},events:{view:"events"}}}},initialize:function(){SavedSearch.prototype.initialize.apply(this,arguments);this.jobs=new JobsCollection;this.associated.jobs=this.jobs},sync:function(method,model,options){options=options||{};_.defaults(options,{migrateViewState:!0});if(!options.migrateViewState||"read"!==method)return SavedSearch.prototype.sync.apply(this,arguments);var bbXHR,deferredResponse=$.Deferred(),viewstateDeferred=$.Deferred(),savedSearchProxy=new SavedSearch({id:this.id});model.trigger("request",model,deferredResponse,options);bbXHR=savedSearchProxy.fetch($.extend(!0,{},options,{success:function(model,savedSearchResponse){this.setFromSplunkD(savedSearchProxy.toSplunkD());var name,viewstate,vsid=this.entry.content.get("vsid"),displayview=this.entry.content.get("displayview"),hasBeenMigrated=splunkUtil.normalizeBoolean(this.entry.content.get("display.general.migratedFromViewState"));if(vsid&&displayview&&!hasBeenMigrated){name=/.*:/.test(vsid)?vsid:displayview+":"+vsid;viewstate=new Viewstate;viewstate.fetch({url:splunkd_utils.fullpath(viewstate.url+"/"+encodeURIComponent(name),{app:options.data.app,owner:options.data.owner}),success:function(){var viewstateConversionAttrs=viewstate.convertToReportPoperties();viewstateConversionAttrs["display.general.migratedFromViewState"]="1";this.entry.content.set(viewstateConversionAttrs);options.success(savedSearchResponse);viewstateDeferred.resolve()}.bind(this),error:function(){this.entry.content.set("display.general.migratedFromViewState","1");options.success(savedSearchResponse);viewstateDeferred.resolve()}.bind(this)})}else{options.success(savedSearchResponse);viewstateDeferred.resolve()}}.bind(this),error:function(model,savedSearchResponse){options.error(savedSearchResponse)}.bind(this)}));$.when(viewstateDeferred).then(function(){bbXHR.done(function(){deferredResponse.resolve.apply(deferredResponse,arguments)}.bind(this))}.bind(this));bbXHR.fail(function(){deferredResponse.reject.apply(deferredResponse,arguments)}.bind(this));return deferredResponse.promise()},parse:function(){var parsedResponse=SavedSearch.prototype.parse.apply(this,arguments),contentModel=this.entry.content;contentModel.has("display.visualizations.type")&&contentModel.set({"display.visualizations.type":contentModel.get("display.visualizations.type").toLowerCase()});return parsedResponse},fetchJobs:function(options){var label=this.entry.get("name");if(!label)throw"Report must have a name to associate it with Jobs";options=options||{};options.data=options.data||{};options.data.app=this.entry.acl.get("app");options.data.owner=this.entry.acl.get("owner");options.data.label=label;return this.jobs.fetchNonAutoSummaryJobs(options)},openInView:function(){return"pivot"===this.entry.content.get("request.ui_dispatch_view")||""===this.entry.content.get("request.ui_dispatch_view")&&this.isPivotReport()?"pivot":"search"},getVizType:function(){var that=this,_vizTree=function(tree){if(tree&&tree.view)return tree;if(tree&&tree.match){var match;_(tree.match).each(function(v,k){match=v[that.entry.content.get(k)]},that);if(match)return _vizTree(match)}};return _vizTree(this.reportTree.match["display.general.type"].visualizations)},isAlert:function(){var is_scheduled=this.entry.content.get("is_scheduled"),alert_type=this.entry.content.get("alert_type"),alert_track=this.entry.content.get("alert.track"),actions=this.entry.content.get("actions"),isRealTime=this.isRealTime();return is_scheduled&&("always"!==alert_type||alert_track||isRealTime&&actions)},isRealTime:function(){var isEarliestRealtime=time_utils.isRealtime(this.entry.content.get("dispatch.earliest_time")),isLatestRealtime=time_utils.isRealtime(this.entry.content.get("dispatch.latest_time"));return isEarliestRealtime&&isLatestRealtime},isPivotReport:function(){return general_utils.isValidPivotSearch(this.entry.content.get("search"))},stripAlertAttributes:function(options){return this.entry.content.set({"alert.track":0,alert_type:"always",is_scheduled:0},options)},stripReportAttributesToSaveAsAlert:function(options){return this.entry.content.set({auto_summarize:!1},options)},stripPivotAttributes:function(){this.entry.content.set({"display.page.pivot.dataModel":""})},setTimeRangeWarnings:function(reportPristine){var pristineEarliest,pristineLatest,earliest=this.entry.content.get("dispatch.earliest_time"),latest=this.entry.content.get("dispatch.latest_time"),messages=[];(!time_utils.isEmpty(earliest)&&time_utils.isAbsolute(earliest)||!time_utils.isEmpty(latest)&&time_utils.isAbsolute(latest))&&messages.push(splunkd_utils.createMessageObject(splunkd_utils.WARNING,_("Your report has an absolute time range.").t()));if(reportPristine)if(reportPristine.isAlert()){pristineEarliest=reportPristine.entry.content.get("dispatch.earliest_time");pristineLatest=reportPristine.entry.content.get("dispatch.latest_time");if(earliest!==pristineEarliest||latest!==pristineLatest){this.entry.content.set({"dispatch.earliest_time":pristineEarliest,"dispatch.latest_time":pristineLatest});messages.push(splunkd_utils.createMessageObject(splunkd_utils.WARNING,_("Your changes to the time range of this alert will not be saved.").t()))}}else if(!reportPristine.isRealTime()&&reportPristine.entry.content.get("is_scheduled")&&this.isRealTime()){this.entry.content.set({is_scheduled:!1});messages.push(splunkd_utils.createMessageObject(splunkd_utils.WARNING,_("Saving a scheduled report as a real-time report will remove the schedule.").t()))}messages.length&&this.error.set({messages:messages})},setAccelerationWarning:function(canSummarize,reportPristine){var isCurrentModeVerbose=this.entry.content.get("display.page.search.mode")===splunkd_utils.VERBOSE,messages=[];if(canSummarize){if(isCurrentModeVerbose&&(_.isUndefined(reportPristine)||reportPristine.entry.content.get("display.page.search.mode")===splunkd_utils.VERBOSE)){messages.push(splunkd_utils.createMessageObject(splunkd_utils.WARNING,_("A report running in verbose mode cannot be accelerated. Your search mode will be saved as Smart Mode.").t()));this.entry.content.set("display.page.search.mode",splunkd_utils.SMART)}else if(isCurrentModeVerbose&&!_.isUndefined(reportPristine)){messages.push(splunkd_utils.createMessageObject(splunkd_utils.WARNING,_("A report running in verbose mode cannot be accelerated. Your search mode will not be saved.").t()));this.entry.content.set("display.page.search.mode",reportPristine.entry.content.get("display.page.search.mode"))}}else{messages.push(splunkd_utils.createMessageObject(splunkd_utils.WARNING,_("This report cannot be accelerated. Acceleration will be disabled.").t()));this.entry.content.set("auto_summarize",!1)}if(messages.length){this.trigger("serverValidated",!1,this,messages);this.error.set({messages:messages})}},setPivotWarning:function(){var messages=[];if(this.isPivotReport()){messages.push(splunkd_utils.createMessageObject(splunkd_utils.WARNING,_("Saving from Search will prevent this report from opening in Pivot.").t()));this.stripPivotAttributes()}if(messages.length){this.trigger("serverValidated",!1,this,messages);this.error.set({messages:messages})}},setDisplayType:function(isTransforming,reportSearch,options){var type=this.entry.content.get("display.general.type")||"statistics",searchSpecificDefaults=reportSearch?this.getSearchSpecificDefaults(reportSearch):{};"events"===type?isTransforming&&(type=searchSpecificDefaults["display.general.type"]||"statistics"):("statistics"===type||"visualizations"===type)&&(isTransforming||(type="events"));this.entry.content.set({"display.general.type":type},options)},getSearchSpecificDefaults:function(reportSearch){return/(^geostats)|([|\s]geostats\s)/.test(reportSearch||"")?{"display.general.type":"visualizations","display.visualizations.type":"mapping"}:{}},isDirty:function(otherReport,whitelist){whitelist=whitelist||ReportModel.DIRTY_WHITELIST;var thisContent=general_utils.filterObjectByRegexes(this.entry.content.toJSON(),whitelist),otherContent=general_utils.filterObjectByRegexes(otherReport.entry.content.toJSON(),whitelist);return!_.isEqual(thisContent,otherContent)},canDelete:function(){return this.entry.links.get("remove")?!0:!1},canWrite:function(canScheduleSearch,canRTSearch){return!(!this.entry.acl.get("can_write")||this.entry.content.get("is_scheduled")&&!canScheduleSearch||this.isRealTime()&&!canRTSearch)},canClone:function(canScheduleSearch,canRTSearch){return!(this.entry.content.get("is_scheduled")&&!canScheduleSearch||this.isRealTime()&&!canRTSearch)},canEmbed:function(canScheduleSearch,canEmbed){return this.entry.acl.get("can_write")&&canScheduleSearch&&!this.isRealTime()&&canEmbed},getAlertTriggerConditionString:function(){var type=this.entry.content.get("alert_type"),earliestTime=this.entry.content.get("dispatch.earliest_time"),latestTime=this.entry.content.get("dispatch.latest_time"),isRealtime=earliestTime&&time_utils.isRealtime(earliestTime)||latestTime&&time_utils.isRealtime(latestTime),threshold=this.entry.content.get("alert_threshold"),timeParse=time_utils.parseTimeString(earliestTime),alertCondition=this.entry.content.get("alert_condition"),isAllTimeRT="rt"===earliestTime||"rt"===latestTime;switch(type){case"always":return isRealtime?_("Per-Result.").t():_("Number of Results is > 0.").t();case"number of events":case"number of hosts":case"number of sources":if(isAllTimeRT)return _("Unsupported.").t();var typeText={"number of events":_("Results").t(),"number of hosts":_("Hosts").t(),"number of sources":_("Sources").t()};switch(this.entry.content.get("alert_comparator")){case"greater than":if(!isRealtime)return splunkUtil.sprintf(_("Number of %(typetext)s is > %(threshold)s.").t(),{typetext:typeText[type],threshold:threshold});switch(timeParse.unit){case"m":return splunkUtil.sprintf(i18n.ungettext("Number of %(typetext)s is > %(threshold)s in %(timeAmount)s minute.","Number of %(typetext)s is > %(threshold)s in %(timeAmount)s minutes.",timeParse.amount),{typetext:typeText[type],threshold:threshold,timeAmount:timeParse.amount});case"h":return splunkUtil.sprintf(i18n.ungettext("Number of %(typetext)s is > %(threshold)s in %(timeAmount)s hour.","Number of %(typetext)s is > %(threshold)s in %(timeAmount)s hours.",timeParse.amount),{typetext:typeText[type],threshold:threshold,timeAmount:timeParse.amount});case"d":return splunkUtil.sprintf(i18n.ungettext("Number of %(typetext)s is > %(threshold)s in %(timeAmount)s day.","Number of %(typetext)s is > %(threshold)s in %(timeAmount)s days.",timeParse.amount),{typetext:typeText[type],threshold:threshold,timeAmount:timeParse.amount})}break;case"less than":if(!isRealtime)return splunkUtil.sprintf(_("Number of %(typetext)s is < %(threshold)s.").t(),{typetext:typeText[type],threshold:threshold});switch(timeParse.unit){case"m":return splunkUtil.sprintf(i18n.ungettext("Number of %(typetext)s is < %(threshold)s in %(timeAmount)s minute.","Number of %(typetext)s is < %(threshold)s in %(timeAmount)s minutes.",timeParse.amount),{typetext:typeText[type],threshold:threshold,timeAmount:timeParse.amount});case"h":return splunkUtil.sprintf(i18n.ungettext("Number of %(typetext)s is < %(threshold)s in %(timeAmount)s hour.","Number of %(typetext)s is < %(threshold)s in %(timeAmount)s hours.",timeParse.amount),{typetext:typeText[type],threshold:threshold,timeAmount:timeParse.amount});case"d":return splunkUtil.sprintf(i18n.ungettext("Number of %(typetext)s is < %(threshold)s in %(timeAmount)s day.","Number of %(typetext)s is < %(threshold)s in %(timeAmount)s days.",timeParse.amount),{typetext:typeText[type],threshold:threshold,timeAmount:timeParse.amount})}break;case"equal to":if(!isRealtime)return splunkUtil.sprintf(_("Number of %(typetext)s is = %(threshold)s.").t(),{typetext:typeText[type],threshold:threshold});switch(timeParse.unit){case"m":return splunkUtil.sprintf(i18n.ungettext("Number of %(typetext)s is = %(threshold)s in %(timeAmount)s minute.","Number of %(typetext)s is = %(threshold)s in %(timeAmount)s minutes.",timeParse.amount),{typetext:typeText[type],threshold:threshold,timeAmount:timeParse.amount});case"h":return splunkUtil.sprintf(i18n.ungettext("Number of %(typetext)s is = %(threshold)s in %(timeAmount)s hour.","Number of %(typetext)s is = %(threshold)s in %(timeAmount)s hours.",timeParse.amount),{typetext:typeText[type],threshold:threshold,timeAmount:timeParse.amount});case"d":return splunkUtil.sprintf(i18n.ungettext("Number of %(typetext)s is = %(threshold)s in %(timeAmount)s day.","Number of %(typetext)s is = %(threshold)s in %(timeAmount)s days.",timeParse.amount),{typetext:typeText[type],threshold:threshold,timeAmount:timeParse.amount})}break;case"not equal to":if(!isRealtime)return splunkUtil.sprintf(_("Number of %(typetext)s is &#8800; %(threshold)s.").t(),{typetext:typeText[type],threshold:threshold});switch(timeParse.unit){case"m":return splunkUtil.sprintf(i18n.ungettext("Number of %(typetext)s is &#8800; %(threshold)s in %(timeAmount)s minute.","Number of %(typetext)s is &#8800; %(threshold)s in %(timeAmount)s minutes.",timeParse.amount),{typetext:typeText[type],threshold:threshold,timeAmount:timeParse.amount});case"h":return splunkUtil.sprintf(i18n.ungettext("Number of %(typetext)s is &#8800; %(threshold)s in %(timeAmount)s hour.","Number of %(typetext)s is &#8800; %(threshold)s in %(timeAmount)s hours.",timeParse.amount),{typetext:typeText[type],threshold:threshold,timeAmount:timeParse.amount});case"d":return splunkUtil.sprintf(i18n.ungettext("Number of %(typetext)s is &#8800; %(threshold)s in %(timeAmount)s day.","Number of %(typetext)s is &#8800; %(threshold)s in %(timeAmount)s days.",timeParse.amount),{typetext:typeText[type],threshold:threshold,timeAmount:timeParse.amount})}break;case"drops by":return splunkUtil.sprintf(_("Number of %(typetext)s drops by %(threshold)s.").t(),{typetext:typeText[type],threshold:threshold});case"rises by":return splunkUtil.sprintf(_("Number of %(typetext)s rises by %(threshold)s.").t(),{typetext:typeText[type],threshold:threshold})}break;case"custom":if(isAllTimeRT)return _("Unsupported.").t();if(!isRealtime)return splunkUtil.sprintf(_('Custom. "%s".').t(),alertCondition);switch(timeParse.unit){case"m":return splunkUtil.sprintf(i18n.ungettext('Custom. "%(alertCondition)s" in %(timeAmount)s minute.','Custom. "%(alertCondition)s" in %(timeAmount)s minutes.',timeParse.amount),{alertCondition:alertCondition,timeAmount:timeParse.amount});case"h":return splunkUtil.sprintf(i18n.ungettext('Custom. "%(alertCondition)s" in %(timeAmount)s hour.','Custom. "%(alertCondition)s" in %(timeAmount)s hours.',timeParse.amount),{alertCondition:alertCondition,timeAmount:timeParse.amount});case"d":return splunkUtil.sprintf(i18n.ungettext('Custom. "%(alertCondition)s" in %(timeAmount)s day.','Custom. "%(alertCondition)s" in %(timeAmount)s days.',timeParse.amount),{alertCondition:alertCondition,timeAmount:timeParse.amount})
}}},getStringOfActions:function(){var actionArray=[];if(this.entry.content.get("action.email")||this.entry.content.get("action.script")){var actions=this.entry.content.get("actions");-1!=actions.search("email")&&actionArray.push(_("Send Email").t());-1!=actions.search("script")&&actionArray.push(_("Run a Script").t())}this.entry.content.get("alert.track")&&actionArray.push(_("List in Triggered Alerts").t());return actionArray.join(_(", ").t())},routeToViewReport:function(root,locale,app,sid){var data={s:this.id};if(this.isAlert())return route.alert(root,locale,app,{data:data});sid&&(data.sid=sid);return route.report(root,locale,app,{data:data})},getNearestMaxlines:function(){var maxLines=parseInt(this.entry.content.get("display.events.maxLines"),10);isNaN(maxLines)&&(maxLines=5);return""+math_utils.nearestMatchAndIndexInArray(maxLines,[5,10,20,50,100,200,0]).value},getSortingSearch:function(){var search,content=this.entry.content,offset=content.get("display.prefs.events.offset"),count=content.get("display.prefs.events.count"),sortColumn=content.get("display.events.table.sortColumn");!sortColumn||_.isUndefined(offset)||_.isUndefined(count)||(search="| sort "+(parseInt(offset,10)+parseInt(count,10))+("desc"===content.get("display.events.table.sortDirection")?" - ":" ")+sortColumn);return search},getDisplayEventsFields:function(options){options||(options={});var object,fields=[];_.each(this.entry.content.toObject("display.events.fields")||[],function(value){if(options.key){object={};object[options.key]=value;fields.push(object)}else fields.push(value)});return fields}},{DOCUMENT_TYPES:{ALERT:"alert",PIVOT_REPORT:"pivot-report",REPORT:"report"},DIRTY_WHITELIST:["^dispatch.earliest_time$","^dispatch.latest_time$","^display.events.fields$","^display.events.list.drilldown$","^display.events.list.wrap$","^display.events.maxLines$","^display.events.raw.drilldown$","^display.events.rowNumbers$","^display.events.table.drilldown$","^display.events.table.wrap$","^display.events.type$","^display.general.enablePreview$","^display.general.migratedFromViewState$","^display.general.timeRangePicker.show$","^display.general.type$","^display.page.pivot.dataModel$","^display.page.search.mode$","^display.page.search.showFields$","^display.page.search.timeline.format$","^display.page.search.timeline.scale$","^display.statistics.drilldown$","^display.statistics.overlay$","^display.statistics.rowNumbers$","^display.statistics.wrap$","^display.visualizations.chartHeight$","^display.visualizations.charting.axisLabelsX.majorLabelStyle.overflowMode$","^display.visualizations.charting.axisLabelsX.majorLabelStyle.rotation$","^display.visualizations.charting.axisLabelsX.majorUnit$","^display.visualizations.charting.axisLabelsY2.majorUnit$","^display.visualizations.charting.axisLabelsY.majorUnit$","^display.visualizations.charting.axisTitleX.text$","^display.visualizations.charting.axisTitleX.visibility$","^display.visualizations.charting.axisTitleY2.text$","^display.visualizations.charting.axisTitleY2.visibility$","^display.visualizations.charting.axisTitleY.text$","^display.visualizations.charting.axisTitleY.visibility$","^display.visualizations.charting.axisX.maximumNumber$","^display.visualizations.charting.axisX.minimumNumber$","^display.visualizations.charting.axisX.scale$","^display.visualizations.charting.axisY2.enabled$","^display.visualizations.charting.axisY2.maximumNumber$","^display.visualizations.charting.axisY2.minimumNumber$","^display.visualizations.charting.axisY2.scale$","^display.visualizations.charting.axisY.maximumNumber$","^display.visualizations.charting.axisY.minimumNumber$","^display.visualizations.charting.axisY.scale$","^display.visualizations.charting.chart$","^display.visualizations.charting.chart.nullValueMode$","^display.visualizations.charting.chart.overlayFields$","^display.visualizations.charting.chart.rangeValues$","^display.visualizations.charting.chart.sliceCollapsingThreshold$","^display.visualizations.charting.chart.stackMode$","^display.visualizations.charting.chart.style$","^display.visualizations.charting.drilldown$","^display.visualizations.charting.gaugeColors$","^display.visualizations.charting.layout.splitSeries$","^display.visualizations.charting.legend.labelStyle.overflowMode$","^display.visualizations.charting.legend.placement$","^display.visualizations.mapHeight$","^display.visualizations.mapping.data.maxClusters$","^display.visualizations.mapping.drilldown$","^display.visualizations.mapping.map.center$","^display.visualizations.mapping.map.zoom$","^display.visualizations.mapping.markerLayer.markerMaxSize$","^display.visualizations.mapping.markerLayer.markerMinSize$","^display.visualizations.mapping.markerLayer.markerOpacity$","^display.visualizations.mapping.tileLayer.maxZoom$","^display.visualizations.mapping.tileLayer.minZoom$","^display.visualizations.mapping.tileLayer.url$","^display.visualizations.show$","^display.visualizations.singlevalue.afterLabel$","^display.visualizations.singlevalue.beforeLabel$","^display.visualizations.singlevalue.underLabel$","^display.visualizations.type$","^search$"]});return ReportModel});define("collections/search/Reports",["models/search/Report","collections/services/SavedSearches"],function(ReportModel,SavedSearchCollection){return SavedSearchCollection.extend({model:ReportModel,initialize:function(){SavedSearchCollection.prototype.initialize.apply(this,arguments)}},{ALERT_SEARCH_STRING:'(is_scheduled=1 AND (alert_type!=always OR alert.track=1 OR (dispatch.earliest_time="rt*" AND dispatch.latest_time="rt*" AND actions="*" )))'})});define("util/xml",["jquery","underscore"],function($,_){function $node(str){var document=$.parseXML(str);return $(document.childNodes[0])}function clone(node){return $node(serialize(node))}function cdata(str){var document=$.parseXML("<x></x>");return document.createCDATASection(str)}function stripEmptyTextNodes(n,exceptions){var i,child,TEXT_NODE=n.TEXT_NODE||3,childNodes=n.childNodes;for(i=childNodes.length-1;i>=0;i--){child=childNodes[i];void 0!==child&&child.nodeType===TEXT_NODE&&(/^\s*$/.test(child.nodeValue)?n.removeChild(child):child.nodeValue=$.trim(child.nodeValue))}childNodes=n.childNodes;for(i=childNodes.length-1;i>=0;i--){child=childNodes[i];(child.nodeType===n.ELEMENT_NODE||child.nodeType===n.DOCUMENT_NODE)&&(null!=exceptions&&exceptions[child.nodeName]||stripEmptyTextNodes(child,exceptions))}}function indentTxt(level){for(var txt=["\n"],x=level;x--;)txt.push(INDENT);return txt.join("")}function indent($xml,n,level){if(n&&n.childNodes){for(var TEXT_NODE=n.TEXT_NODE||3,i=0;i<=n.childNodes.length;i++){var child1=n.childNodes[i-1],child2=n.childNodes[i];!child2||child2.nodeType===TEXT_NODE||child1&&child1.nodeType===TEXT_NODE||n.insertBefore($xml.createTextNode(indentTxt(level)),child2);i===n.childNodes.length&&child1&&child1.nodeType!==TEXT_NODE&&n.appendChild($xml.createTextNode(indentTxt(level-1)))}_.chain(n.childNodes).filter(function(c){return c.nodeType===n.ELEMENT_NODE}).each(function(c){indent($xml,c,level+1)})}}function formatXMLDocument($xml,noStrip){stripEmptyTextNodes($xml[0],_.object(noStrip,noStrip));indent($xml[0],$xml[0].childNodes[0],1);return $xml}function serialize(xml){xml instanceof $&&(xml=xml[0]);return Object.prototype.hasOwnProperty.call(xml,"xml")?xml.xml:(new XMLSerializer).serializeToString(xml)}function inject(options){for(var node=options.node,where=options.where,container=options.container,selectors=options.selectors||[],fallback=options.fallback,$container=$(container),i=0;i<selectors.length;i++){var selector=selectors[i],target=$container.children(selector);if(target.length){target[where](node);return!0}}if(_.isString(fallback)){$container[fallback](node);return!0}if(_.isFunction(fallback)){fallback($container,node);return!0}return!1}function replaceOrAppend(options){replaceOrInject(options.node,options.selector,options.container,"append")}function replaceOrPrepend(options){replaceOrInject(options.node,options.selector,options.container,"prepend")}function replaceOrInject(node,selector,container,fallback){var $container=$(container),existing=$container.children(selector);if(existing.length){$(_.rest(existing)).remove();$(existing.first()).replaceWith(node)}else $container[fallback](node)}var INDENT="  ";return{$node:$node,cdata:cdata,stripEmptyTextNodes:stripEmptyTextNodes,formatXMLDocument:formatXMLDocument,serialize:serialize,clone:clone,inject:inject,replaceOrAppend:replaceOrAppend,replaceOrPrepend:replaceOrPrepend}});define("models/search/Dashboard",["jquery","underscore","splunk.util","models/services/data/ui/View","util/xml","models/Base"],function($,_,splunkutil,ViewModel,xmlUtils,BaseModel){var HTML_PANEL_TYPE="html",CHART_PANEL_TYPE="chart",EVENT_PANEL_TYPE="event",SINGLE_PANEL_TYPE="single",MAP_PANEL_TYPE="map",TABLE_PANEL_TYPE="table",NON_HTML_PANEL_TYPES=[CHART_PANEL_TYPE,EVENT_PANEL_TYPE,SINGLE_PANEL_TYPE,MAP_PANEL_TYPE,TABLE_PANEL_TYPE],DashboardMetadata=BaseModel.extend({constructor:function(dashboard){this._dash=dashboard;BaseModel.prototype.constructor.call(this)},apply:function(){this._dash._applyMetadata(this.toJSON())},save:function(){arguments.length&&this.set.apply(this,arguments);this._dash._applyMetadata(this.toJSON());return this._dash.save.apply(this._dash,arguments)},fetch:function(){var m=this._dash._extractMetadata();this.set(m);var dfd=$.Deferred();dfd.resolve(this);return dfd}}),Dashboard=ViewModel.extend({initialize:function(model,options){ViewModel.prototype.initialize.apply(this,arguments);this.indent=(options||{}).indent!==!1},initializeAssociated:function(){ViewModel.prototype.initializeAssociated.apply(this,arguments);var meta=this.meta=this.meta||new DashboardMetadata(this);this.entry.content.on("change:eai:data",function(){meta.fetch()},this);meta.fetch()},associatedOff:function(e,cb,ctx){ViewModel.prototype.associatedOff.apply(this,arguments);this.meta.off(e,cb,ctx)},set$XML:function($xml){var raw=xmlUtils.serialize(this.indent?this.formatXML($xml):$xml);this.setXML(raw)},formatXML:function($xml){return xmlUtils.formatXMLDocument($xml,["delimiter","html"])},setXML:function(raw){this.entry.content.set("eai:data",raw);this.entry.content.set("eai:type","views")},setHTML:function(raw){this.entry.content.set("eai:data",raw);this.entry.content.set("eai:type","html")},_extractMetadata:function(){var isXML=this.isXML(),$xml=isXML?this.get$XML():null;return{label:this.entry.content.get("label")||this.entry.get("name"),description:isXML&&$xml.find(":eq(0) > description").text()||""}},_applyMetadata:function(metadata){var $xml=this.get$XML(),$label=$xml.find(":eq(0) > label"),$description=$xml.find(":eq(0) > description"),label=metadata.label,description=metadata.description;if(void 0!==label&&null!==label){if(!$label.length){$label=xmlUtils.$node("<label/>");$xml.find(":eq(0)").prepend($label)}$label.text(label);this.entry.content.set("label",label)}if(void 0!==description&&null!==description){if(void 0!==description&&""!==description||!$description.length){if(!$description.length){$description=xmlUtils.$node("<description/>");$label.length?$description.insertAfter($label):$xml.find(":eq(0)").prepend($description)}}else $description.remove();$description.text(description)}this.set$XML($xml)},getLabel:function(){var result=this.meta.get("label");return void 0===result?"":result},setLabel:function(value){this.setLabelAndDescription(value,void 0)},getDescription:function(){return this.meta.get("description")},setDescription:function(value){this.setLabelAndDescription(void 0,value)},setLabelAndDescription:function(label,description){this._applyMetadata({label:label,description:description})},get$Rows:function(){var $xml=this.get$XML();return $xml.find(":eq(0) > row")},appendNewPanel:function(panelType,properties){var panel,$xml,isNonHTML=-1!=_.indexOf(NON_HTML_PANEL_TYPES,panelType),isHTML=panelType===HTML_PANEL_TYPE;if(isNonHTML||isHTML){panel=isNonHTML?_.template(this.nonHTMLPanelTemplate,{panelType:panelType,properties:properties}):_.template(this.HTMLPanelTemplate,{properties:properties});$xml=this.get$XML();var rowNode=xmlUtils.$node("<row/>"),panelNode=xmlUtils.$node("<panel/>").appendTo(rowNode);$(panelNode).append(xmlUtils.$node(panel));$xml.find(":eq(0)").append(rowNode);this.set$XML($xml)}},nonHTMLPanelTemplate:'                <<%- panelType %>>                    <% if (properties.title) { %>                        <title><%- properties.title %></title>                    <% } %>                    <% if (properties.searchString) { %>                        <searchString><%- properties.searchString %></searchString>                        <% if (properties.earliestTime !== undefined) { %>                            <earliestTime><%- properties.earliestTime %></earliestTime>                        <% } %>                        <% if (properties.latestTime !== undefined) { %>                            <latestTime><%- properties.latestTime %></latestTime>                        <% } %>                    <% } else if (properties.pivotSearch) { %>                        <pivotSearch>                            <model><%= properties.pivotSearch.model %></model>                            <object><%= properties.pivotSearch.object %></object>                            <filters><%= properties.pivotSearch.filters %></filters>                            <cells><%= properties.pivotSearch.cells %></cells>                            <rows><%= properties.pivotSearch.rows %></rows>                            <columns><%= properties.pivotSearch.columns %></columns>                        </pivotSearch>                    <% } else if (properties.searchName) { %>                        <searchName><%- properties.searchName %></searchName>                    <% } %>                    <% if (properties.fields) { %>                        <fields><%- properties.fields %></fields>                    <% } %>                    <% _.each(properties.options, function(value, key) { %>                        <option name="<%- key %>"><%- value %></option>                    <% }) %>                </<%- panelType %>>            ',HTMLPanelTemplate:"<html><%= properties.html %></html>"},{panelXMLToPanelTypeAndProperties:function(xml){var raw,properties={},$xml=$(xml);if(xml.nodeName===HTML_PANEL_TYPE){raw=xmlUtils.serialize(xml);return{panelType:xml.nodeName,properties:{html:$.trim(raw.replace(/^\s*<html>|<\/html>\s*$/g,""))}}}$xml.children().each(function(index,el){var $el=$(el);if("option"!==el.nodeName)properties[el.nodeName]=$el.text();else{properties.options=properties.options||{};properties.options[$el.attr("name")]=$el.text()}});return{panelType:xml.nodeName,properties:properties}},reportToPropertiesFromPanelType:function(panelType,reportModel,isInline){var earliestTime,latestTime,isNonHTML=-1!=_.indexOf(NON_HTML_PANEL_TYPES,panelType),properties={};if(!isNonHTML)throw"Unsupported panel type";if(reportModel.isNew()||isInline){properties.searchString=reportModel.entry.content.get("search");earliestTime=reportModel.entry.content.get("dispatch.earliest_time");void 0!==earliestTime&&(properties.earliestTime=earliestTime);latestTime=reportModel.entry.content.get("dispatch.latest_time");void 0!==latestTime&&(properties.latestTime=latestTime)}else properties.searchName=reportModel.entry.get("name");if(panelType===CHART_PANEL_TYPE)properties.options=reportModel.entry.content.filterByWildcards(["^display.visualizations.charting..*"],{strip:"display.visualizations."});else if(panelType===SINGLE_PANEL_TYPE)properties.options=reportModel.entry.content.filterByWildcards(["^display.visualizations.singlevalue..*"],{strip:"display.visualizations.singlevalue."});else if(panelType===MAP_PANEL_TYPE){properties.options=reportModel.entry.content.filterByWildcards(["^display.visualizations.mapping..*"],{strip:"display.visualizations."});delete properties.options["mapping.data.bounds"]}return properties}});Dashboard.Entry=Dashboard.Entry.extend({});var Content=Dashboard.Entry.Content;Dashboard.Entry.Content=Content.extend({initialize:function(){Content.prototype.initialize.apply(this,arguments)},validate:function(attributes){var xml,dashboard,eaiData=attributes["eai:data"];if(void 0!=eaiData){xml=$.parseXML(eaiData);dashboard=xml.firstChild;if("dashboard"!==dashboard.nodeName&&"form"!==dashboard.nodeName)return{"eai:data":"You must declare a dashboard node."}}}});return Dashboard});define("splunkjs/mvc/simplexml/dashboardmodel",["require","underscore","jquery","../../mvc","models/search/Dashboard","util/xml","util/general_utils","util/console"],function(require){var _=require("underscore"),$=require("jquery"),mvc=require("../../mvc"),BaseDashboardModel=require("models/search/Dashboard"),xmlUtils=require("util/xml"),GeneralUtils=require("util/general_utils"),console=require("util/console"),DashboardModel=BaseDashboardModel.extend({initialize:function(){BaseDashboardModel.prototype.initialize.apply(this,arguments)},getFlattenedXML:function(options){if(!this._structure)throw new Error("Cannot create flattened XML without the item order being captured first");var $n=xmlUtils.$node,that=this;options=options||{};var dashboard=$n("<dashboard/>");$n("<label/>").text(this.meta.get("label")).appendTo(dashboard);this.meta.has("description")&&$n("<description/>").text(this.meta.get("description")).appendTo(dashboard);_(this._structure.rows).each(function(panels){var row=$n("<row/>");if(_(panels).any(function(p){return p.elements.length>1})){var groups=_(panels).map(function(p){return p.elements.length}).join(",");row.attr("grouping",groups)}_(panels).chain().flatten().pluck("elements").flatten().each(function(id){var element=mvc.Components.get(id),settings=element.model.mapToXML(_.extend({tokens:!1,flatten:!0},options)),newNode=xmlUtils.$node("<"+settings.type+"/>");void 0!==settings.attributes&&newNode.attr(settings.attributes);if(settings.content)settings.cdata?newNode.append(xmlUtils.cdata(settings.content)):newNode.text(settings.content);else{that._applyTitle(newNode,settings);var manager=mvc.Components.get(element.model.entry.content.get("display.general.manager"));options.useLoadjob!==!1&&manager&&manager.job?that._applySearch(newNode,{search:{type:"inline",search:"| loadjob "+manager.job.sid+" ignore_running=t"}}):that._applySearch(newNode,settings);that._applyOptions(newNode,settings);that._applyTags(newNode,settings)}newNode.appendTo(row)});row.appendTo(dashboard)});options&&options.indent&&this.formatXML(dashboard);return xmlUtils.serialize(dashboard)},updateElement:function(id,settings,options){console.log("About to update item=%o with settings=%o",id,settings);var $xml=this.get$XML(),cur=this.getXMLNode(id,$xml);if(!cur)throw new Error("Unable to find dashboard element with ID "+id);var newNode=xmlUtils.$node("<"+settings.type+"/>");_(["id","depends","rejects"]).each(function(attr){var val=$(cur).attr(attr);val&&newNode.attr(attr,val)});newNode.append($(cur).children());if(options&&options.clearOptions){newNode.find("option").remove();delete settings.options}this._applyTitle(newNode,settings);settings.search&&"global"===settings.search.type?this._applyGlobalSearch($xml,settings):this._applySearch(newNode,settings);this._applyOptions(newNode,settings);this._applyTags(newNode,settings);$(cur).replaceWith(newNode);if(console.DEBUG_ENABLED){this.formatXML($xml);console.log(xmlUtils.serialize($xml))}this.set$XML($xml);return this.save()},deleteElement:function(id){var newStructure={fieldset:this._structure.fieldset,rows:_(this._structure.rows).map(function(row){return _(row).map(function(panel){return{inputs:panel.inputs,elements:_(panel.elements).without(id)}})})};return this.updateStructure(newStructure)},addElement:function(id,settings){var row=xmlUtils.$node("<row/>"),panel=xmlUtils.$node("<panel/>").appendTo(row),newNode=xmlUtils.$node("<"+settings.type+"/>").appendTo(panel);this._structure.rows.push([{inputs:[],elements:[settings.id]}]);this._applyTitle(newNode,settings);this._applySearch(newNode,settings);var $xml=this.get$XML();$xml.find(":eq(0)").append(row);if(console.DEBUG_ENABLED){this.formatXML($xml);console.log(xmlUtils.serialize($xml))}this.set$XML($xml);return this.save()},_migrateViewType:function($xml,tagName){var curRoot=$xml.find(":eq(0)");if(curRoot.prop("tagName")!==tagName){$xml=$($.parseXML("<"+tagName+"/>"));var newRoot=$xml.find(":eq(0)"),cur=curRoot[0];_(cur.attributes).each(function(attr){newRoot.attr(attr.nodeName,attr.nodeValue)});for(;cur.childNodes.length;)newRoot.append(cur.childNodes[0]);this.trigger("change:rootNodeName",this,tagName)}return $xml},_applyOptions:function(newNode,settings){settings.options&&_.each(settings.options,function(value,name){var curOption=newNode.find('option[name="'+name+'"]');""===value||null===value||void 0===value?curOption.remove():curOption.length?curOption.text(value):xmlUtils.$node("<option/>").attr("name",name).text(value).appendTo(newNode)});settings.removeOptions&&_(settings.removeOptions).each(function(name){newNode.find('option[name="'+name+'"]').remove()})},_applyTags:function(newNode,settings){settings.tags&&_.each(settings.tags,function(value,tag){newNode.find(tag).remove();(_.isArray(value)&&value.length||value)&&xmlUtils.$node("<"+tag+"/>").text(value).appendTo(newNode)})},_applyTitle:function(newNode,settings){var titleNode=newNode.find("title");if(settings.title){titleNode.length||(titleNode=xmlUtils.$node("<title/>").prependTo(newNode));titleNode.text(settings.title)}else titleNode.remove()},_applySearch:function(newNode,settings){if(settings.search){newNode.find("searchString,searchTemplate,searchName,searchPostProcess,pivotSearch,earliestTime,latestTime").remove();var titleNode=newNode.find("title");switch(settings.search.type){case"inline":case"global":var searchNode=xmlUtils.$node("<searchString/>").text(settings.search.search);titleNode.length?searchNode.insertAfter(titleNode):searchNode.prependTo(newNode);void 0!==settings.search.latest_time&&xmlUtils.$node("<latestTime/>").text(settings.search.latest_time).insertAfter(searchNode);void 0!==settings.search.earliest_time&&xmlUtils.$node("<earliestTime/>").text(settings.search.earliest_time).insertAfter(searchNode);break;case"postprocess":var postSearchNode=xmlUtils.$node("<searchPostProcess/>").text(settings.search.search);titleNode.length?postSearchNode.insertAfter(titleNode):postSearchNode.prependTo(newNode);break;case"saved":var savedNode=xmlUtils.$node("<searchName/>").text(settings.search.name);titleNode.length?savedNode.insertAfter(titleNode):savedNode.prependTo(newNode);break;case"pivot":throw new Error("Pivot search not implemented!");default:throw new Error("Unknown search type: "+settings.search.type)}}},_applyGlobalSearch:function($xml,settings){var root=$xml.find(":eq(0)");root.children("searchTemplate,earliestTime,latestTime").remove();var labelNode=root.children("label"),descNode=root.children("description"),searchNode=xmlUtils.$node("<searchTemplate/>").text(settings.search.search);descNode.length?searchNode.insertAfter(descNode):labelNode.length?searchNode.insertAfter(labelNode):searchNode.prependTo(root);settings.search.latest_time&&xmlUtils.$node("<latestTime/>").text(settings.search.latest_time).insertAfter(searchNode);settings.search.earliest_time&&xmlUtils.$node("<earliestTime/>").text(settings.search.earliest_time).insertAfter(searchNode)},captureDashboardStructure:function(structure){var $xml=this.get$XML();this.validateItemOrder(this._getItemOrderMap(structure.rows,$xml));this.validateInputOrder(this._getInputOrderMap(structure,$xml));this._structure=structure},getStructureMap:function(structure,$xml){return _.extend({},this._getItemOrderMap(structure.rows,$xml),this._getInputOrderMap(structure,$xml))},getXMLNode:function(id,$xml){id=String(id);var node=$xml.find(":eq(0)>fieldset>#"+id+",:eq(0)>row>#"+id+",:eq(0)>row>panel>#"+id);return node.length?node[0]:this.getStructureMap(this._structure,$xml)[id]},_getItemOrderMap:function(rowOrder,$xml){var elements=_($xml.find("row").children()).map(function(el){return $(el).is("panel")?$(el).children(":not(input)").toArray():el}),makeObject=function(keys,values){if(keys.length!==values.length)throw new Error("Item order did not match XML structure ("+keys.length+" keys, "+values.length+" nodes)");return _.object(keys,values)};return makeObject(_(rowOrder).chain().flatten().pluck("elements").flatten().value(),_.flatten(elements))},validateItemOrder:function(itemOrderMap){_(itemOrderMap).each(function(node,id){var nid=$(node).attr(id);if(void 0!==nid&&nid!==id)throw new Error("Invalid Item order. Expected node with ID "+id+". Instead saw "+nid)})},inputSettingsToXML:function(settingsModel,inputNode){var $input=inputNode?$(inputNode):xmlUtils.$node("<input/>"),settings=settingsModel.toJSON({tokens:!0});$input.attr("type",settings.type);$input.attr("token",settings.token||null);$input.attr("searchWhenChanged",null!=settings.searchWhenChanged?String(GeneralUtils.normalizeBoolean(settings.searchWhenChanged)):null);var label=$.trim(settings.label);void 0!==label&&label!==settings.token?xmlUtils.replaceOrPrepend({node:xmlUtils.$node("<label/>").text(label),selector:"label",container:$input}):$input.children("label").remove();if(settings.choices&&settings.choices.length){var newChoices=_(settings.choices).map(function(choice){return xmlUtils.$node("<choice/>").attr("value",choice.value).text(choice.label)});xmlUtils.replaceOrAppend({node:newChoices,container:$input,selector:"choice"})}else $input.children("choice").remove();this._applyPopulatingSearch(settings,$input);var defaultValue=settings["default"];if(defaultValue){var defaultNode=xmlUtils.$node("<default/>");if("time"==settings.type){xmlUtils.$node("<earliestTime></earliestTime>").text(null==defaultValue.earliest_time?"":defaultValue.earliest_time).appendTo(defaultNode);xmlUtils.$node("<latestTime></latestTime>").text(null==defaultValue.latest_time?"":defaultValue.latest_time).appendTo(defaultNode)}else defaultNode.text(defaultValue);xmlUtils.replaceOrAppend({node:defaultNode,selector:"default",container:$input})}else $input.children("default").remove();_(["prefix","suffix","seed","valuePrefix","valueSuffix","delimiter"]).each(function(option){var val=settings[option];if(val){var node=xmlUtils.$node("<"+option+"/>").text(val);xmlUtils.replaceOrAppend({node:node,container:$input,selector:option})}else $input.children(option).remove()});return $input},_applyPopulatingSearch:function(settings,$input){var $search;if("saved"===settings.searchType){if(!settings.searchName){$input.children("populatingSavedSearch,populatingSearch").remove();return}$search=xmlUtils.$node("<populatingSavedSearch/>");$search.text(settings.searchName)}else{if(!settings.search){$input.children("populatingSavedSearch,populatingSearch").remove();return}$search=xmlUtils.$node("<populatingSearch/>");$search.text(settings.search);$search.attr("earliest",settings["earliest_time"]);$search.attr("latest",settings["latest_time"])}settings.labelField&&$search.attr("fieldForLabel",settings.labelField);settings.valueField&&$search.attr("fieldForValue",settings.valueField);xmlUtils.replaceOrAppend({node:$search,container:$input,selector:"populatingSavedSearch,populatingSearch"})},updateInputXML:function(id,settings){console.log("About to update input=%o with settings=%o",id,settings.toJSON());var $xml=this.get$XML(),cur=this.getXMLNode(id,$xml);if(!cur)throw new Error("Unable to find input with ID=",id);cur=$(cur);var newNode=this.inputSettingsToXML(settings,cur);$(cur).replaceWith(newNode);if(console.DEBUG_ENABLED){this.formatXML($xml);console.log(xmlUtils.serialize($xml))}this.set$XML($xml);return this.save()},isFormAutoRun:function(){var $xml=this.get$XML(),fieldset=$xml.find("fieldset");return GeneralUtils.normalizeBoolean(fieldset.attr("autoRun"))},updateFormSettings:function(options){var $xml=this._migrateViewType(this.get$XML(),"form"),fieldset=$xml.find("fieldset");fieldset.length||(fieldset=this._createNewFieldset($xml));options.hasOwnProperty("submitButton")&&fieldset.attr("submitButton",String(options.submitButton));options.hasOwnProperty("autoRun")&&fieldset.attr("autoRun",String(options.autoRun));this.set$XML($xml);return this.save()},_createNewFieldset:function($xml){var $fieldset=xmlUtils.$node('<fieldset submitButton="false"></fieldset>');xmlUtils.inject({node:$fieldset,where:"after",container:$xml.find(":eq(0)"),selectors:["description","label"],fallback:"prepend"});return $fieldset},deleteInput:function(id){var newStructure={fieldset:_(this._structure.fieldset).without(id),rows:_(this._structure.rows).map(function(row){return _(row).map(function(panel){return{inputs:_(panel.inputs).without(id),elements:panel.elements}})})};return this.updateStructure(newStructure)},_getInputOrderMap:function(structure,$xml){var map={},makeObject=function(keys,values,hint){if(keys.length!==values.length)throw new Error("Input ("+hint+") order did not match XML structure ("+keys.length+" keys, "+values.length+" nodes)");return _.object(keys,values)};_.extend(map,makeObject(structure.fieldset,$xml.find(":eq(0)>fieldset>input,:eq(0)>fieldset>html"),"fieldset"));_.extend(map,makeObject(_(structure.rows).chain().flatten().pluck("inputs").flatten().value(),$xml.find(":eq(0)>row>panel>input"),"panels"));return map},validateInputOrder:function(inputOrderMap){_(inputOrderMap).each(function(node,id){var nid=$(node).attr(id);if(void 0!==nid&&nid!==id)throw new Error("Invalid Input order. Expected node with ID "+id+". Instead saw "+nid)})},updateInput:function(settingsModel){return this.updateInputXML(settingsModel.get("name"),settingsModel,{})},addInput:function(settingsModel){var $input=this.inputSettingsToXML(settingsModel),$xml=this._migrateViewType(this.get$XML(),"form"),$fieldset=$xml.find(":eq(0)>fieldset");$fieldset.length||($fieldset=this._createNewFieldset($xml));$fieldset.append($input);this._structure.fieldset.push(settingsModel.get("id"));this.set$XML($xml);return this.save()},updateStructure:function(structure){if(!this._structure){console.warn("No captured dashboard structure");this.captureDashboardStructure(structure)}if(_.isEqual(structure,this._structure)){console.log("no changes to input order");return $.Deferred().resolve()}structure.rows=_(structure.rows).map(function(row){return _(row).filter(function(panel){return panel.elements.length>0||panel.inputs.length>0})});structure.rows=_(structure.rows).filter(function(row){return row.length>0});var $node=xmlUtils.$node,$xml=this.get$XML(),rootNode=$xml.find(":eq(0)"),itemMap=this._getItemOrderMap(this._structure.rows,$xml),inputMap=this._getInputOrderMap(this._structure,$xml);rootNode.children("row").detach();_(structure.rows).each(function(rowOrder){var row=$node("<row/>");_(rowOrder).each(function(panelOrder){var panel=$node("<panel/>");_(panelOrder.elements).each(function(elementId){var item=itemMap[elementId];$(item).find("script").remove();panel.append(item)});row.append(panel)});rootNode.append(row)});var fieldset=rootNode.children("fieldset");fieldset.length||(fieldset=this._createNewFieldset($xml));fieldset.children().detach();_(structure.fieldset).each(function(inputId){var inputNode=inputMap[inputId];if(inputNode){$(inputNode).find("script").remove();fieldset.append(inputNode)}else console.warn("input not found",inputId)});0==fieldset.children().length&&fieldset.remove();var rows=rootNode.children("row");_(structure.rows).each(function(rowOrder,rowIndex){var row=rows[rowIndex],panels=$(row).children("panel");_(rowOrder).each(function(panelOrder,panelIndex){var panel=panels[panelIndex];_(panelOrder.inputs).chain().clone().reverse().each(function(inputId){var inputNode=inputMap[inputId];$(inputNode).find("script").remove();$(panel).prepend(inputNode)})})});console.log("Updated dashboard structure",JSON.stringify(structure),$xml.find(":eq(0)")[0]);this._structure=structure;rootNode.children("row>panel:empty").remove();rootNode.children("row:empty").remove();$xml=this.hasInputs()?this._migrateViewType($xml,"form"):this._migrateViewType($xml,"dashboard");
this.set$XML($xml);console.log("Saving XML changes");return this.save()},isEditable:function(){return this.isDashboard()||this.isForm()},getRootNodeName:function(){return(this.get$XML().find(":eq(0)").prop("nodeName")||"").toLowerCase()},hasInputs:function(){return this._structure.fieldset.length>0||_(this._structure.rows).any(function(row){return _(row).any(function(element){return element.inputs&&element.inputs.length>0})})}});return DashboardModel});define("models/shared/ClassicURL",["jquery","underscore","splunk.util","backbone","models/Base","util/router_utils","util/console"],function($,_,util,Backbone,BaseModel,routerUtils,console){var ClassicURLModel=BaseModel.extend({id:"classicURL",initialize:function(){BaseModel.prototype.initialize.apply(this,arguments)},sync:function(method,model,options){var resp,state,dfd=$.Deferred();options=options||{};var silentClear=options.silentClear,replaceState=options.replaceState;delete options.silentClear;delete options.replaceState;silentClear&&model.clear({silent:!0});if("read"===method)resp=model.currentQueryString();else if("create"===method||"update"===method){state=model.encode(options);replaceState?model.replaceState(state,options):model.pushState(state,options);resp=this.currentQueryString()}else{if("delete"!==method)throw new Error("invalid method: "+method);this.pushState("",options);resp=this.currentQueryString()}model.trigger("request",model,dfd,options);options.success(resp);return dfd.resolve().promise()},parse:function(response){var urlQueryParameters=this.decode(response),newAttributesWithBlanks=_.clone(this.attributes);_.each(newAttributesWithBlanks,function(value,key){newAttributesWithBlanks[key]=void 0});_.extend(newAttributesWithBlanks,urlQueryParameters);return newAttributesWithBlanks},encode:function(options){var encodedKey,queryArray=[];_.each(this.toJSON(),function(value,key){if(!(_.isUndefined(value)||""===value&&options&&options.preserveEmptyStrings===!1)){encodedKey=encodeURIComponent(key);if(_.isObject(value)){console.error("Non-primitive values are not allowed in the query string: ",value);throw new Error("Non-primitive values are not allowed in the query string")}queryArray.push(encodedKey+"="+encodeURIComponent(value))}});return queryArray.join("&")},decode:function(queryString){return util.queryStringToProp(queryString)},currentQueryString:function(){var fragment;if(Backbone.history._hasPushState)return window.location.href.split("?")[1]||"";fragment=Backbone.history.getFragment(window.location.href.split("#")[1]||"");return fragment.split("?")[1]||""},pushState:function(data,options){data&&(data="?"+data);Backbone.history.navigate(this.root()+data,$.extend(!0,{},options,{replace:!1}))},replaceState:function(data,options){data&&(data="?"+data);Backbone.history.navigate(this.root()+data,$.extend(!0,{},options,{replace:!0}))},root:function(){return Backbone.history._hasPushState?window.location.pathname:"#"+routerUtils.strip_route(window.location.pathname)}});return ClassicURLModel});define("splunkjs/mvc/simplexml/dashboardurl",["underscore","models/shared/ClassicURL","util/console"],function(_,ClassicURLModel,console){function _encodePrimitiveValue(value){if(_.isObject(value)){console.error("Encountered non-primitive value %o to be encoded as URL param.",value);throw new Error("Non-primitive values are not allowed in the query string")}return encodeURIComponent(value)}var DashboardURLModel=ClassicURLModel.extend({encode:function(options){var encodedKey,object=this.toJSON(),queryArray=[];options=_.extend({preserveEmptyStrings:!0,preserveNull:!0},options);_.each(object,function(value,key){if(!(_.isUndefined(value)||null===value&&!options.preserveNull||""===value&&!options.preserveEmptyStrings)){encodedKey=encodeURIComponent(key);null===value?queryArray.push(encodedKey):_.isArray(value)?_.each(value,function(v){queryArray.push(encodedKey+"="+_encodePrimitiveValue(v))}):queryArray.push(encodedKey+"="+_encodePrimitiveValue(value))}});return queryArray.join("&")},decode:function(queryString){queryString=(queryString||"").replace(/^[&\?#]|[&#]$/g,"");if(!queryString)return{};var output={};_(queryString.split("&")).each(function(param){var parts=param.split("=",2),key=decodeURIComponent(parts[0]),value=parts.length>1?decodeURIComponent(parts[1]):null;if(output.hasOwnProperty(key)){var cur=output[key];_.isArray(cur)||(cur=output[key]=[cur]);cur.push(value)}else output[key]=value});return output}});return new DashboardURLModel});define("splunkjs/mvc/simplexml/router",["require","underscore","backbone","./dashboardurl","util/console"],function(require){var _=require("underscore"),Backbone=require("backbone"),classicurl=require("./dashboardurl"),console=require("util/console"),DashboardRouter=Backbone.Router.extend({initialize:function(options){this.model=options.model;this.app=options.app},routes:{":locale/app/:app/:page?*qs":"view",":locale/app/:app/:page":"view",":locale/app/:app/:page/?*qs":"view",":locale/app/:app/:page/":"view",":locale/app/:app/:page/edit?*qs":"edit",":locale/app/:app/:page/edit":"edit","*root/:locale/app/:app/:page?*qs":"rootedView","*root/:locale/app/:app/:page":"rootedView","*root/:locale/app/:app/:page/?*qs":"rootedView","*root/:locale/app/:app/:page/":"rootedView","*root/:locale/app/:app/:page/edit?*qs":"rootedEdit","*root/:locale/app/:app/:page/edit":"rootedEdit",":locale/manager/:app/:page?*qs":"view",":locale/manager/:app/:page":"view",":locale/manager/:app/:page/?*qs":"view",":locale/manager/:app/:page/":"view","*root/:locale/manager/:app/:page?*qs":"rootedView","*root/:locale/manager/:app/:page":"rootedView","*root/:locale/manager/:app/:page/?*qs":"rootedView","*root/:locale/manager/:app/:page/":"rootedView","dj/:app/:page/":"splunkdj","dj/:app/:page/?*qs":"splunkdj","*root/dj/:app/:page/":"rootedSplunkdj","*root/dj/:app/:page/?*qs":"rootedSplunkdj"},view:function(){console.log("ROUTE: view");this.page.apply(this,arguments);this.model.set("edit",!1)},edit:function(){console.log("ROUTE: edit");this.page.apply(this,arguments);this.model.set("edit",!0)},rootedView:function(root){this.app.set("root",root);this.view.apply(this,_.rest(arguments))},rootedEdit:function(root){this.app.set("root",root);this.edit.apply(this,_.rest(arguments))},page:function(locale,app,page){console.log("ROUTE: page(locale=%o, app=%o, page=%o)",locale,app,page);this.app.set({locale:locale,app:app,page:page});classicurl.fetch();if("schedulePDF"===classicurl.get("dialog")){this.model.set("dialog",classicurl.get("dialog"));classicurl.unset("dialog");this.updateUrl({replace:!0})}},splunkdj:function(app,page){this.page("en-US",app,page)},rootedSplunkdj:function(root){this.app.set("root",root);this.splunkdj.apply(this,_.rest(arguments))},updateUrl:function(options){var parts=[this.app.get("root")||"",this.app.get("locale"),"app",this.app.get("app"),this.app.get("page")];this.model.get("edit")&&parts.push("edit");var url=[parts.join("/")],params=classicurl.encode();params.length&&url.push(params);this.navigate(url.join("?"),_.extend({replace:!1},options))}});return DashboardRouter});define("splunkjs/mvc/simplexml/controller",["require","util/router_utils","backbone","jquery","underscore","../utils","util/pdf_utils","util/console","uri/route","../sharedmodels","util/splunkd_utils","splunk.util","../protections","collections/search/Reports","./dashboardmodel","./router","util/ajax_no_cache"],function(require){var routerUtils=require("util/router_utils"),Backbone=require("backbone"),$=require("jquery"),_=require("underscore"),pdfUtils=(require("../utils"),require("util/pdf_utils")),console=require("util/console"),route=require("uri/route"),sharedModels=require("../sharedmodels"),SplunkUtil=(require("util/splunkd_utils"),require("splunk.util")),protections=require("../protections"),Reports=require("collections/search/Reports"),DashboardModel=require("./dashboardmodel"),DashboardRouter=require("./router");require("util/ajax_no_cache");protections.enableCSRFProtection($);protections.enableUnauthorizationRedirection($,SplunkUtil.make_url("account/login"),"/account/logout");var DashboardController=function(){this.readyDfd=$.Deferred();{var model=this.model=new Backbone.Model,app=(this.collection={},this.model.app=sharedModels.get("app"));this.model.appLocal=sharedModels.get("appLocal"),this.model.user=sharedModels.get("user"),this.collection.times=sharedModels.get("times")}this.router=new DashboardRouter({model:this.model,app:app});routerUtils.start_backbone_history();var view=this.model.view=new DashboardModel;this.model.view.fetch({url:route.splunkdNS(app.get("root"),app.get("locale"),app.get("owner"),app.get("app"),[view.url,app.get("page")].join("/"))}).done(this._onViewModelLoad.bind(this));pdfUtils.isPdfServiceAvailable().always(function(available){model.set("pdf_available",available)});this._onViewModelLoadDfd=$.Deferred();this.model.on("change:edit",this.router.updateUrl,this.router);this.on("addInput",this.model.view.addInput,this.model.view)};_.extend(DashboardController.prototype,Backbone.Events,{_onViewModelLoad:function(){var model=this.model;model.set("editable",model.view.isEditable()&&model.view.entry.acl.canWrite());if(model.view.isXML()){model.set("label",this.model.view.getLabel());model.set("description",this.model.view.getDescription());model.on("change:label change:description",function(){model.view.setLabelAndDescription(model.get("label"),model.get("description"));model.view.save()});model.set("rootNodeName",model.view.getRootNodeName());model.view.on("change:rootNodeName",function(m,rootTagName){model.set("rootNodeName",rootTagName)})}this._onViewModelLoadDfd.resolve(this.model.view)},onViewModelLoad:function(cb,scope){this._onViewModelLoadDfd.done(cb.bind(scope||null))},getStateModel:function(){return this.model},isEditMode:function(){return this.model.get("edit")===!0},onReady:function(callback){var dashboardReady=$.when(this.readyDfd,this._onViewModelLoadDfd);callback&&dashboardReady.then(callback);return dashboardReady},ready:function(){this.readyDfd.resolve()},isReady:function(){return"resolved"===this.readyDfd.state()},fetchCollection:function(){this.reportsCollection=new Reports;this.reportsCollection.REPORTS_LIMIT=150;var appModel=this.model.app,fetchParams={data:{count:this.reportsCollection.REPORTS_LIMIT,app:appModel.get("app"),owner:appModel.get("owner"),search:'is_visible="1"'}};this.reportsCollection.initialFetchDfd=this.reportsCollection.fetch(fetchParams)}});var instance=new DashboardController;console.DEBUG_ENABLED&&(window.Dashboard=instance);return instance});define("models/services/authorization/Role",["models/SplunkDBase"],function(SplunkDBaseModel){return SplunkDBaseModel.extend({url:"authorization/roles",initialize:function(){SplunkDBaseModel.prototype.initialize.apply(this,arguments)}})});define("collections/services/authorization/Roles",["models/services/authorization/Role","collections/SplunkDsBase","models/shared/fetchdata/EAIFetchData"],function(Model,BaseCollection,EAIFetchData){return BaseCollection.extend({FREE_PAYLOAD:{links:{create:"/services/authorization/roles/_new"},generator:{},entry:[{name:"admin",links:{alternate:"/services/authorization/roles/admin",list:"/services/authorization/roles/admin",edit:"/services/authorization/roles/admin",remove:"/services/authorization/roles/admin"},author:"system",acl:{app:"",can_list:!0,can_write:!0,modifiable:!1,owner:"system",perms:{read:["*"],write:["*"]},removable:!1,sharing:"system"},content:{capabilities:[],cumulativeRTSrchJobsQuota:400,cumulativeSrchJobsQuota:200,defaultApp:"","eai:acl":null,imported_capabilities:[],imported_roles:[],imported_rtSrchJobsQuota:20,imported_srchDiskQuota:500,imported_srchFilter:"",imported_srchIndexesAllowed:["*"],imported_srchIndexesDefault:["main"],imported_srchJobsQuota:10,imported_srchTimeWin:-1,rtSrchJobsQuota:100,srchDiskQuota:1e4,srchFilter:"*",srchIndexesAllowed:["*","_*"],srchIndexesDefault:["main","os"],srchJobsQuota:50,srchTimeWin:0}}],paging:{total:1,perPage:30,offset:0},messages:[]},initialize:function(models,options){options=options||{};options.fetchData=options.fetchData||new EAIFetchData({count:0});BaseCollection.prototype.initialize.call(this,models,options)},url:"authorization/roles",model:Model})});define("splunkjs/mvc/simplexml/mapper",["require","underscore","../mvc","backbone","util/console"],function(require){var _=require("underscore"),Backbone=(require("../mvc"),require("backbone")),console=require("util/console"),Mapper=function(){};_.extend(Mapper.prototype,{tagName:"#abstract",map:function(){},getSearch:function(report,options){var result;if(report.entry.get("name")){console.log("Mapping Saved Search");result={type:"saved",name:report.entry.get("name",options)}}else{console.log("Mapping Inline Search");result={type:report.entry.content.get("display.general.search.type")||"inline",search:report.entry.content.get("search",options),earliest_time:report.entry.content.get("dispatch.earliest_time",options),latest_time:report.entry.content.get("dispatch.latest_time",options)};if(options.flatten&&"postprocess"===result.type){result.type="inline";result.search=report.entry.content.get("fullSearch",options)}}return result},toXML:function(report,options){options=options||{tokens:!0};var result={type:this.tagName,title:report.entry.content.get("display.general.title",options),search:this.getSearch(report,options),options:{},tags:{}};this.map(report.entry.content,result,options);if(result.options.fields){result.tags.fields||(result.tags.fields=result.options.fields);result.options["fields"]=null}return result}});var MAPPERS={};Mapper.register=function(type,cls){MAPPERS[type]=cls};Mapper.get=function(type){var MapperClass=MAPPERS[type];if(!MapperClass)throw new Error("No mapper for type "+type);return new MapperClass};Mapper.extend=Backbone.Model.extend;return Mapper});define("models/dashboards/DashboardReport",["require","jquery","underscore","models/search/Report","splunkjs/mvc/simplexml/controller","splunkjs/mvc/simplexml/mapper","util/console","splunkjs/mvc/tokenawaremodel"],function(require){var $=require("jquery"),_=require("underscore"),Report=require("models/search/Report"),Dashboard=require("splunkjs/mvc/simplexml/controller"),Mapper=require("splunkjs/mvc/simplexml/mapper"),console=require("util/console"),TokenAwareModel=require("splunkjs/mvc/tokenawaremodel"),DashboardReport=Report.extend({initialize:function(){Report.prototype.initialize.apply(this,arguments)},saveXML:function(options){var id=this.entry.content.get("display.general.id");console.log("[%o] Saving Panel Element XML...",id);return Dashboard.model.view.updateElement(id,this.mapToXML(),options)},mapToXML:function(options){var type=this.entry.content.get("display.general.type"),sub=["display",type,"type"].join(".");this.entry.content.has(sub)&&(type=[type,this.entry.content.get(sub)].join(":"));console.log("Looking up mapper for type ",type);var mapper=Mapper.get(type);console.log("Found mapper",mapper);return mapper.toXML(this,options)},deleteXML:function(){return Dashboard.model.view.deleteElement(this.entry.content.get("display.general.id"))},fetch:function(options){var that=this;that.entry.content._applyTokensByDefault=!1;that._fetching=!0;var dfd=Report.prototype.fetch.call(this,options);dfd.always(function(){that.entry.content._applyTokensByDefault=!0;that._fetching=!1});return dfd},setFromSplunkD:function(payload,options){options||(options={});this._fetching&&void 0===options.tokens&&(options.tokens=!1);return Report.prototype.setFromSplunkD.call(this,payload,options)},parse:function(){this.entry.content._applyTokensByDefault=!1;var ret=Report.prototype.parse.apply(this,arguments);this.entry.content._applyTokensByDefault=!0;return ret},defaults:{"display.visualizations.charting.axisY.scale":"linear","display.visualizations.charting.axisX.scale":"linear","display.visualizations.charting.axisX.minimumNumber":"","display.visualizations.charting.axisX.maximumNumber":"","display.visualizations.charting.axisY.minimumNumber":"","display.visualizations.charting.axisY.maximumNumber":"","display.visualizations.charting.axisTitleX.text":"","display.visualizations.charting.axisTitleY.text":"","display.visualizations.charting.axisLabelsX.majorUnit":"","display.visualizations.charting.axisLabelsY.majorUnit":"","display.visualizations.charting.legend.placement":"right","display.visualizations.charting.legend.labelStyle.overflowMode":"ellipsisMiddle","display.visualizations.charting.chart.stackMode":"default","display.visualizations.charting.chart.nullValueMode":"zero","display.visualizations.charting.chart.rangeValues":'["0","30","70","100"]',"display.visualizations.charting.chart.style":"shiny","display.visualizations.charting.gaugeColors":[8710400,16771072,12529712],"display.prefs.events.count":"10","display.prefs.statistics.count":"10"},validation:{"display.visualizations.charting.axisX.minimumNumber":[{pattern:"number",msg:"Please enter a number",required:!1},{fn:"validateXAxisExtremes",required:!1}],"display.visualizations.charting.axisX.maximumNumber":[{pattern:"number",msg:"Please enter a number",required:!1},{fn:"validateXAxisExtremes",required:!1}],"display.visualizations.charting.axisY.minimumNumber":[{pattern:"number",msg:"Please enter a number",required:!1},{fn:"validateYAxisExtremes",required:!1}],"display.visualizations.charting.axisY.maximumNumber":[{pattern:"number",msg:"Please enter a number",required:!1},{fn:"validateYAxisExtremes",required:!1}],"display.visualizations.charting.axisY2.minimumNumber":[{pattern:"number",msg:"Please enter a number",required:!1},{fn:"validateYAxis2Extremes",required:!1}],"display.visualizations.charting.axisY2.maximumNumber":[{pattern:"number",msg:"Please enter a number",required:!1},{fn:"validateYAxis2Extremes",required:!1}],"display.visualizations.charting.axisLabelsX.majorUnit":{pattern:"number",min:Number.MIN_VALUE,msg:"Please enter a positive number",required:!1},"display.visualizations.charting.axisLabelsY.majorUnit":{pattern:"number",min:Number.MIN_VALUE,msg:"Please enter a positive number",required:!1},"display.visualizations.charting.axisLabelsY2.majorUnit":{pattern:"number",min:Number.MIN_VALUE,msg:"Please enter a positive number",required:!1},"display.visualizations.charting.axisY.scale":{fn:"validateYScaleAndStacking",required:!1},"display.visualizations.charting.chart.stackMode":{fn:"validateYScaleAndStacking",required:!1},"display.visualizations.charting.chart.rangeValues":{fn:"validateRangeValues",required:!1},"display.prefs.events.count":{pattern:"number",min:1,msg:_("Rows Per Page must be a positive number.").t(),required:!1},"display.prefs.statistics.count":{pattern:"number",min:1,msg:_("Rows Per Page must be a positive number.").t(),required:!1}},validateXAxisExtremes:function(value,attr,computedState){var min=parseFloat(computedState["display.visualizations.charting.axisX.minimumNumber"]),max=parseFloat(computedState["display.visualizations.charting.axisX.maximumNumber"]);return!_.isNaN(min)&&!_.isNaN(max)&&min>=max?"The minimum value must be less than maximum value":void 0},validateYAxisExtremes:function(value,attr,computedState){var min=parseFloat(computedState["display.visualizations.charting.axisY.minimumNumber"]),max=parseFloat(computedState["display.visualizations.charting.axisY.maximumNumber"]);return!_.isNaN(min)&&!_.isNaN(max)&&min>=max?"The minimum value must be less than maximum value":void 0},validateYAxis2Extremes:function(value,attr,computedState){var min=parseFloat(computedState["display.visualizations.charting.axisY2.minimumNumber"]),max=parseFloat(computedState["display.visualizations.charting.axisY2.maximumNumber"]);return!_.isNaN(min)&&!_.isNaN(max)&&min>=max?"The minimum value must be less than maximum value":void 0},validateYScaleAndStacking:function(value,attr,computedState){var yAxisScale=computedState["display.visualizations.charting.axisY.scale"],stackMode=computedState["display.visualizations.charting.chart.stackMode"];return"log"===yAxisScale&&"default"!==stackMode?"Log scale and stacking cannot be enabled at the same time":void 0},validateRangeValues:function(value){var ranges=_(value?JSON.parse(value):[]).map(parseFloat);if(_(ranges).any(_.isNaN)||!value)return"All color ranges must be valid numbers";var dedupedRanges=_.uniq(ranges),sortedRanges=$.extend([],ranges).sort(function(a,b){return a-b});return _.isEqual(ranges,dedupedRanges)&&_.isEqual(ranges,sortedRanges)?void 0:"Color ranges must be entered from lowest to highest"},attrToArray:function(attr){var value=this.get(attr);return value?_.values(JSON.parse(value)):[]},rangesValuesToArray:function(){return this.attrToArray("display.visualizations.charting.chart.rangeValues")},gaugeColorsToArray:function(){return this.attrToArray("display.visualizations.charting.gaugeColors")}},{Entry:Report.Entry.extend({},{Content:TokenAwareModel.extend({applyTokensByDefault:!0,clone:function(){return new Report.Entry.Content(this.toJSON())}})})});return DashboardReport});define("splunkjs/mvc/progressbarview",["require","exports","module","jquery","./mvc","backbone","./basesplunkview","underscore","views/shared/delegates/Popdown","splunk.util","splunk.config"],function(require,exports,module){var $=require("jquery"),Backbone=(require("./mvc"),require("backbone")),BaseSplunkView=require("./basesplunkview"),_=require("underscore"),PopdownView=require("views/shared/delegates/Popdown"),SplunkUtil=require("splunk.util"),splunkConfig=require("splunk.config"),IMAGE_NAME=window.devicePixelRatio>1?"progress@2x.gif":"progress.gif",IMAGE_URL=splunkConfig.INDEPENDENT_MODE?require.toUrl("")+"splunkjs/css/img/splunk/"+IMAGE_NAME:SplunkUtil.make_url("/static/img/splunk/"+IMAGE_NAME),ProgressBarView=BaseSplunkView.extend({moduleId:module.id,className:"splunk-progressbar",configure:function(){this.options.manager&&(this.options.managerid=this.options.manager);BaseSplunkView.prototype.configure.apply(this,arguments)},initialize:function(){this.configure();this.children||(this.children={});this.bindToComponentSetting("managerid",this.onManagerChange,this);this.model={jobState:new Backbone.Model,messages:new Backbone.Model};var debouncedRender=_.debounce(this.render);this.model.jobState.on("change",debouncedRender,this);this.model.messages.on("change",debouncedRender,this)},onManagerChange:function(ctxs,ctx){this.manager&&this.manager.off(null,null,this);this.manager=ctx;if(ctx){this.model.jobState.clear();this.model.messages.clear();this.manager.on("search:start",this.onSearchStart,this);this.manager.on("search:progress",this.onSearchProgress,this);this.manager.on("search:error",this.onSearchFail,this);this.manager.on("search:fail",this.onSearchFail,this);this.manager.on("search:cancelled",this.onSearchCancelled,this);this.manager.replayLastSearchEvent(this)}},onSearchStart:function(){this.model.messages.clear();this.model.jobState.set({text:"",progress:0,active:!0})},onSearchProgress:function(properties){var content=properties.content||{},dispatchState=content.dispatchState;this.model.jobState.set({realTime:content.isRealTimeSearch});if(content.messages){var errMsgs=_(content.messages).chain().where({type:"ERROR"}).pluck("text").value(),warnMsgs=_(content.messages).chain().where({type:"WARN"}).pluck("text").value();this.model.messages.set("errors",errMsgs,{unset:_.isEmpty(errMsgs)});this.model.messages.set("warnings",warnMsgs,{unset:_.isEmpty(warnMsgs)})}if(void 0===dispatchState)this.model.jobState.clear();else if("FAILED"===dispatchState)this.model.jobState.clear();else{var pct,msg,progress=content.doneProgress,active=!0;_.isNumber(progress)&&!_.isNaN(progress)&&(pct=String(Math.floor(100*progress)));var status=_("Loading").t();active=!0;msg=[status," - ",pct+"%"].join("");if("PAUSED"===content.dispatchState){msg=_("Paused").t();active=!1}else active=!0;"DONE"===content.dispatchState?this.model.jobState.clear():this.model.jobState.set({text:msg,progress:pct,active:active})}},onSearchFail:function(){this.model.jobState.clear()},onSearchCancelled:function(){this.model.jobState.clear()},render:function(){if(this.model.jobState.has("progress")&&this.model.jobState.get("realTime")!==!0){if(!this.$progress){this.$progress=$('<div class="progress-bar"><div class="progress-msg"></div><div class="progress"><div class="bar" style="width: 0%"></div></div></div>').appendTo(this.el);$("<img/>").attr("src",IMAGE_URL).appendTo(this.$progress.find(".bar"))}this.$(".progress-msg").text(this.model.jobState.get("text"));this.$(".progress").find(".bar").width((this.model.jobState.get("progress")||0)+"%")}else if(this.$progress){this.$progress.remove();this.$progress=null}if(this.model.messages.has("errors")||this.model.messages.has("warnings")){this.$error||(this.$error=$('<div class="error-details"><a href="#" class="dropdown-toggle error-indicator"><i class="icon-warning-sign"></i></a><div class="dropdown-menu"><div class="arrow"></div><ul class="first-group error-list"></ul></div></div>').appendTo(this.$el));this.$error.find(".error-list").html(this.errorStatusTemplate(_.extend({_:_,errors:null,warnings:null},this.model.messages.toJSON())));this.children.errorPopdown||(this.children.errorPopdown=new PopdownView({el:this.$error}));this.$error[this.model.messages.has("errors")?"addClass":"removeClass"]("severe")}else{if(this.$error){this.$error.remove();this.$error=null}if(this.children.errorPopdown){this.children.errorPopdown.remove();this.children.errorPopdown=null}}return this},remove:function(){_(this.children).invoke("remove");_(this.model).invoke("off");this.manager&&this.manager.off(null,null,this);return BaseSplunkView.prototype.remove.call(this)},errorStatusTemplate:_.template('<% _(errors).each(function(error){ %><li class="error"><i class="icon-warning-sign"></i> <%- error %></li><% }); %><% _(warnings).each(function(warn){ %><li class="warning"><i class="icon-warning-sign"></i> <%- warn %></li><% }); %>')});return ProgressBarView});define("util/moment/compactFromNow",["util/moment"],function(moment){function formatCompactRelativeTime(milliseconds,withoutSuffix,lang){var seconds=round(Math.abs(milliseconds)/1e3),minutes=round(seconds/60),hours=round(minutes/60),days=round(hours/24),years=round(days/365),args=45>seconds&&["s",seconds]||1===minutes&&["m"]||45>minutes&&["mm",minutes]||1===hours&&["h"]||22>hours&&["hh",hours]||1===days&&["d"]||25>=days&&["dd",days]||45>=days&&["M"]||345>days&&["MM",round(days/30)]||1===years&&["y"]||["yy",years],string=args[0],number=args[1]||1,isFuture=milliseconds>0,output=(lang._compactRelativeTime||{})[string];return void 0===output?lang.relativeTime(number,!!withoutSuffix,string,isFuture):"function"==typeof output?output(number,withoutSuffix,string,isFuture):output.replace(/%d/i,number)}var round=Math.round;moment.duration.fn.humanizeCompact=function(withSuffix){var diff=+this,out=formatCompactRelativeTime(diff,!withSuffix,this.lang());withSuffix&&(out=this.lang().pastFuture(diff,out));return this.lang().postformat(out)};moment.fn.compactFromNow=function(noSuffix){return moment.duration(this.diff(moment())).lang(this.lang()._abbr).humanizeCompact(!noSuffix)};return moment});define("splunkjs/mvc/refreshtimeindicatorview",["require","exports","module","./mvc","./basesplunkview","util/moment","util/moment/compactFromNow","underscore","splunk.util","util/general_utils"],function(require,exports,module){function _runCallbacks(){_(timerCallbacks).each(function(cb){cb()})}function removeTimerCallback(name){delete timerCallbacks[name];if(_.isEmpty(timerCallbacks)){clearInterval(globalRefreshTimer);globalRefreshTimer=null}}function registerTimerCallback(name,cb,scope){timerCallbacks[name]&&removeTimerCallback(name);timerCallbacks[name]=_.bind(cb,scope);globalRefreshTimer||(globalRefreshTimer=setInterval(_runCallbacks,1e3))}var BaseSplunkView=(require("./mvc"),require("./basesplunkview")),moment=require("util/moment");require("util/moment/compactFromNow");var globalRefreshTimer,_=require("underscore"),SplunkUtil=require("splunk.util"),GeneralUtils=require("util/general_utils"),timerCallbacks={},RefreshTimeIndicatorView=BaseSplunkView.extend({moduleId:module.id,className:"splunk-timeindicator",events:{"click a.refresh-btn":"refresh"},configure:function(){this.options.manager&&(this.options.managerid=this.options.manager);this.options["refresh.time.visible"]=GeneralUtils.normalizeBoolean(this.options["refresh.time.visible"],{"default":!0});this.options["refresh.auto.interval"]=SplunkUtil.isInt(this.options["refresh.auto.interval"])?parseInt(this.options["refresh.auto.interval"],10):0;BaseSplunkView.prototype.configure.apply(this,arguments)},initialize:function(){this.configure();this.bindToComponentSetting("managerid",this.onManagerChange,this);this.timer=_.uniqueId("timer_");this.listenTo(this.settings,"change",this.updateContent)},onManagerChange:function(managers,manager){this.manager&&this.manager.off(null,null,this);if(manager){this.manager=manager;this.manager.on("search:start",this.clear,this);this.manager.on("search:progress",this.onSearchProgress,this);this.manager.on("search:done",this.onSearchProgress,this);this.manager.on("search:fail",this.clear,this);this.manager.on("search:cancelled",this.clear,this);manager.replayLastSearchEvent(this)}},clear:function(){removeTimerCallback(this.timer);this.$el.html("&nbsp;")},updateRefreshTime:function(){if(this.refreshTime&&moment().diff(this.refreshTime)>=1e4){this.$(".time-freshness").text(this.refreshTime.compactFromNow()).show();this.$(".time-freshness").attr("title",_("Last refresh: ").t()+this.refreshTime.format("LLL"));this.$el.show()}},onSearchProgress:function(properties){this.lastContent=(properties||{}).content||{};this.updateContent()},updateContent:function(){var content=this.lastContent;if(this.autoRefresh){clearInterval(this.autoRefresh);this.autoRefresh=null}if("FAILED"===content.dispatchState)this.clear();else if("PARSING"===content.dispatchState||"QUEUED"===content.dispatchState)this.clear();else if("RUNNING"===content.dispatchState)if(content.isRealTimeSearch){removeTimerCallback(this.timer);this.$el.text(_("Real-time").t())}else this.clear();else if("DONE"===content.dispatchState){this.$el.hide();this.refreshTime=moment(this.manager.job.published());this.clear();if(this.refreshTime&&this.settings.get("refresh.time.visible")){this.$el.append($('<span class="time-freshness"/>'));this.updateRefreshTime();registerTimerCallback(this.timer,this.updateRefreshTime,this)}this.settings.get("refresh.auto.interval")&&(this.autoRefresh=setTimeout(_.bind(this.refresh,this),1e3*this.settings.get("refresh.auto.interval")))}},refresh:function(event){event&&event.preventDefault();this.manager.startSearch()},render:function(){this.$el.html("&nbsp;");return this},remove:function(){removeTimerCallback(this.timer);if(this.autoRefresh){clearInterval(this.autoRefresh);this.autoRefresh=null}this.onManagerChange(null,null);return BaseSplunkView.prototype.remove.call(this)}});return RefreshTimeIndicatorView});Splunk.window={open:function(uri,name,options){options=$.extend({resizable:!0,scrollbars:!0,toolbar:!0,location:!0,menubar:!0,width:$(window).width(),height:$(window).height()},options);options["top"]||(options["top"]=Math.max(0,screen.availHeight/2-options["height"]/2));options["left"]||(options["left"]=Math.max(0,screen.availWidth/2-options["width"]/2));options["screenX"]=options["left"];options["screenY"]=options["top"];var compiled_options=[];for(var key in options){options[key]===!0&&(options[key]="yes");options[key]===!1&&(options[key]="no");compiled_options.push(key+"="+options[key])}name="w"+name.replace(/[^a-zA-Z 0-9]+/g,"");var newWindow=window.open(uri,name,compiled_options.join(","));newWindow&&newWindow.focus&&newWindow.focus();return newWindow},openJobManager:function(getArgs){var app=Splunk.util.getCurrentApp();"UNKNOWN_APP"==app&&(app="search");var url=Splunk.util.make_url("app",app,"job_management");getArgs&&(url+="?"+Splunk.util.propToQueryString(getArgs));var spawnedWindow=this.open(url,"splunk_job_manager",{width:900,height:600,menubar:!1});
return spawnedWindow},openAerts:function(href){return this.open(href,"splunk_alerts",{width:900,height:600,menubar:!1})},openJobInspector:function(sid){var url=Splunk.util.make_url("search","inspector");if(!sid){alert(_("Cannot open job inspector; no search job ID provided!"));return!1}var getArgs={sid:sid,namespace:Splunk.util.getCurrentApp()};url+="?"+Splunk.util.propToQueryString(getArgs);var spawnedWindow=this.open(url,"splunk_job_inspector",{width:870,height:560,menubar:!1});return spawnedWindow}};define("splunk.window",["splunk","splunk.util","splunk.i18n"],function(global){return function(){var ret;return ret||global.Splunk.window}}(this));define("views/shared/controls/SyntheticRadioControl",["jquery","underscore","module","views/shared/controls/Control","util/general_utils","bootstrap.tooltip"],function($,_,module,Control,util){return Control.extend({className:"control btn-group",moduleId:module.id,initialize:function(){var defaults={buttonClassName:"btn",elastic:!1};_.defaults(this.options,defaults);var itemDefaults={iconSize:"icon-large"};_.each(this.options.items,function(el){_.defaults(el,itemDefaults)});this.options.modelAttribute&&this.$el.attr("data-name",this.options.modelAttribute);this.$el.addClass("btn-group-radio");Control.prototype.initialize.call(this,this.options)},events:{"click button":function(e){this.options.enabled&&this.setValue($(e.currentTarget).data("value"),!0);e.preventDefault()}},disable:function(){this.options.enabled=!1;this.$("button").addClass("disabled")},enable:function(){this.options.enabled=!0;this.$("button").removeClass("disabled")},render:function(){if(!this.el.innerHTML){var template=_.template(this.template,{items:this.options.items,buttonClassName:this.options.buttonClassName,help:this.options.help,elastic:this.options.elastic,enabled:this.options.enabled,modelAttribute:this.options.modelAttribute});this.$el.html(template);this.$('[rel="tooltip"]').tooltip({animation:!1,container:"body"});var items=this.options.items;this.$el.find("button").each(function(i,el){$(el).attr("data-value",items[i].value).data("value",items[i].value)})}var value=this._value;this.$el.find("button").each(function(i,el){var $el=$(el);$el[util.checkEquality($el.data("value"),value)?"addClass":"removeClass"]("active")});var additionalClassNames=this.options.additionalClassNames;additionalClassNames&&this.$el.addClass(additionalClassNames);return this},remove:function(){this.$('[rel="tooltip"]').tooltip("destroy");Control.prototype.remove.call(this)},template:'            <% _.each(items, function(item, index){ %>                <button name="<%- modelAttribute || "" %>"                         <% if (elastic) { %> style="width:<%- Math.round(100*(1/items.length)) %>%" <% } %>                         <% if (item.tooltip) { %> rel="tooltip" title="<%=item.tooltip%>" <% } %>                        class="<%=buttonClassName%> <%- item.className || "" %> <%- enabled ? "" : "disabled" %>">                    <% if (item.icon) { %> <i class="icon-<%-item.icon%> <%-item.iconSize%>"></i><% } %>                    <% if(item.label){ %> <%= item.label%> <%}%>                </button>            <% }) %>        '})});define("views/shared/controls/SyntheticCheckboxControl",["underscore","module","views/shared/controls/Control","splunk.util"],function(_,module,Control,splunk_util){var SyntheticCheckboxControl=Control.extend({className:"control",moduleId:module.id,initialize:function(){var defaults={checkboxClassName:"btn",defaultValue:!1,label:""};_.defaults(this.options,defaults);this.options.modelAttribute&&this.$el.attr("data-name",this.options.modelAttribute);Control.prototype.initialize.apply(this,arguments)},events:{"click label":function(e){!this.options.enabled||this.setValue(!this._value);e.preventDefault()},"click .btn":function(e){e.preventDefault()}},disable:function(){this.options.enabled=!1;this.$("label").addClass("disabled");this.$(".btn").addClass("disabled")},enable:function(){this.options.enabled=!0;this.$("label").removeClass("disabled");this.$(".btn").removeClass("disabled")},normalizeValue:function(value){return splunk_util.normalizeBoolean(value)?1:0},render:function(){var checked=this.options.invertValue?!this.getValue():this.getValue();if(this.el.innerHTML)this.$(".icon-check")[checked?"show":"hide"]();else{var template=_.template(this.template,{options:this.options,checked:checked});this.$el.html(template);this.options.enabled||this.disable()}var additionalClassNames=this.options.additionalClassNames;additionalClassNames&&this.$el.addClass(additionalClassNames);return this},template:'            <label class="checkbox">                  <a href="#" data-name="<%- options.modelAttribute || "" %>" class="<%- options.checkboxClassName %>"><i class="icon-check" <% if (!checked) {%>style="display:none"<% } %>></i></a>                  <%- options.label%>            </label>        '});return SyntheticCheckboxControl});define("util/dom_utils",[],function(){var setCaretPosition=function(el,caretPos){if(el){el.value=el.value;if(el.createTextRange){var range=el.createTextRange();range.move("character",caretPos);range.select();return!0}if(el.setSelectionRange&&(el.selectionStart||0===el.selectionStart)){el.focus();el.setSelectionRange(caretPos,caretPos);return!0}el.focus();return!1}return!1},getCaretPosition=function(el){var caretPos,selection;if(el)if(el.selectionStart||0===el.selectionStart)caretPos=el.selectionStart;else if(document.selection){el.focus();selection=document.selection.createRange();selection.moveStart("character",-el.value.length);caretPos=selection.text.length}return caretPos},supportsNativePlaceholder=function(){return"placeholder"in document.createElement("input")};return{setCaretPosition:setCaretPosition,getCaretPosition:getCaretPosition,supportsNativePlaceholder:supportsNativePlaceholder}});define("views/shared/controls/TextareaControl",["underscore","module","views/shared/controls/Control","util/dom_utils"],function(_,module,Control,dom_utils){var ENTER_KEY=13;return Control.extend({moduleId:module.id,initialize:function(){var defaults={textareaClassName:"",placeholder:"",useSyntheticPlaceholder:!1,trimLeadingSpace:!0,trimTrailingSpace:!0,spellcheck:!0};_.defaults(this.options,defaults);this.options.placeholder&&!dom_utils.supportsNativePlaceholder()&&(this.options.useSyntheticPlaceholder=!0);this.options.modelAttribute&&this.$el.attr("data-name",this.options.modelAttribute);Control.prototype.initialize.apply(this,arguments)},events:{"change textarea":function(){if(this.options.enabled){var textareaValue=this.$("textarea").val();this.options.trimLeadingSpace&&(textareaValue=textareaValue.replace(/^\s+/g,""));this.options.trimTrailingSpace&&(textareaValue=textareaValue.replace(/\s+$/g,""));this.setValue(textareaValue,!1);this.updatePlaceholder()}},"click .placeholder":function(){this.options.enabled&&this.$textarea.focus()},"keyup textarea":function(){this.updatePlaceholder()},"mouseup textarea":function(){this.updatePlaceholder()},"keypress textarea":function(e){e.which==ENTER_KEY&&e.stopPropagation()}},updatePlaceholder:function(){this.options.useSyntheticPlaceholder&&this.$placeholder[""===this.$textarea.val()?"show":"hide"]()},disable:function(){this.options.enabled=!1;this.$textarea.hide();this.$disabledTextarea.show()},enable:function(){this.options.enabled=!0;this.$textarea.show();this.$disabledTextarea.hide()},render:function(){if(this.el.innerHTML){this.$textarea.val(this._value);this.$disabledTextarea.text(this._value)}else{var template=_.template(this.template,{options:this.options,value:this._value||""});this.$el.html(template);this.$textarea=this.$("textarea");this.$disabledTextarea=this.$(".uneditable-input");this.options.useSyntheticPlaceholder&&(this.$placeholder=this.$(".placeholder"))}this.updatePlaceholder();var additionalClassNames=this.options.additionalClassNames;additionalClassNames&&this.$el.addClass(additionalClassNames);return this},template:'            <span class="uneditable-input uneditable-input-multiline                         <%= options.textareaClassName %>"                     <% if(options.enabled){ %>                        style="display:none"                    <%}%>>                <%- value %>            </span>            <textarea type="text"                         name="<%- options.modelAttribute || "" %>"                         class="<%= options.textareaClassName %>"                         <% if(options.placeholder && !options.useSyntheticPlaceholder){ %>                           placeholder="<%- options.placeholder %>"                        <%}%>                         <% if(!options.enabled){ %>                            style="display:none"                        <%}%>                        <% if(!options.spellcheck){ %>                            spellcheck="false"                        <%}%>            ><%- value %></textarea>            <% if (options.useSyntheticPlaceholder) { %>                 <span class="placeholder"><%- options.placeholder %></span>            <% } %>        '})});define("views/shared/controls/LabelControl",["underscore","module","views/shared/controls/Control","bootstrap.tooltip"],function(_,module,Control){return Control.extend({moduleId:module.id,initialize:function(){var defaults={inputClassName:"input-label",defaultValue:"label",iconSize:"icon-large"};_.defaults(this.options,defaults);Control.prototype.initialize.apply(this,arguments)},render:function(){var value=this._value||"";if(this.el.innerHTML)this.$span.text(value);else{var template=_.template(this.template,{options:this.options,value:value});this.$el.html(template);this.$span=this.$("span")}var additionalClassNames=this.options.additionalClassNames;additionalClassNames&&this.$el.addClass(additionalClassNames);this.options.modelAttribute&&this.$el.attr("data-name",this.options.modelAttribute);this.options.tooltip&&this.$(".tooltip-text").tooltip({animation:!1,title:this.options.tooltip});return this},template:'<span class="<%= options.inputClassName %><% if(options.tooltip) { %> tooltip-text<% } %>"><% if (options.icon) { %> <i class="icon-<%-options.icon%> <%-options.iconSize%>"></i> <% } %><%- value %></span>'})});define("views/shared/controls/ControlGroup",["jquery","underscore","module","backbone","views/Base","views/shared/controls/Control","views/shared/controls/SyntheticSelectControl","views/shared/controls/SyntheticRadioControl","views/shared/controls/SyntheticCheckboxControl","views/shared/controls/TextControl","views/shared/controls/TextareaControl","views/shared/controls/DateControl","views/shared/controls/LabelControl","bootstrap.tooltip"],function($,_,module,Backbone,Base,Control,SyntheticSelectControl,SyntheticRadioControl,SyntheticCheckboxControl,TextControl,TextareaControl,DateControl,LabelControl){return Base.extend({className:"control-group",moduleId:module.id,initialize:function(){var defaults={label:"",controls:[],error:!1,_errorMsg:"",controlClass:"",enabled:!0,required:!1};_.defaults(this.options,defaults);0==this.options.controls.length&&(this.options.controls=[{type:this.options.controlType,options:this.options.controlOptions}]);this.controlTypes={SyntheticSelect:SyntheticSelectControl,SyntheticRadio:SyntheticRadioControl,SyntheticCheckbox:SyntheticCheckboxControl,Text:TextControl,Textarea:TextareaControl,Date:DateControl,Label:LabelControl};$.extend(!0,this.controlTypes,this.options.controlTypes||{});Base.prototype.initialize.apply(this,arguments);this.options.enabled||this.$el.addClass("disabled");_(this.options.controls).isArray()||(this.options.controls=[this.options.controls]);this.childList=[];_.each(this.options.controls,function(control,index){if(control instanceof Backbone.View){this.children["child"+index]=control;this.childList.push(control)}else{var controlOptions=$.extend(!0,{validate:!!this.options.validate,forceUpdate:!!this.options.forceUpdate,enabled:!!this.options.enabled},control.options),controlView=this.children["child"+index]=new this.controlTypes[control.type](controlOptions);this.childList.push(controlView)}},this);this.activate()},startListening:function(){var perAttrValidation={};_.isArray(this.options.controls)&&_.each(this.options.controls,function(control){if(control.options&&control.options.model){perAttrValidation[control.options.modelAttribute]=!0;this.listenTo(control.options.model,"attributeValidated:"+control.options.modelAttribute,function(isValid,key){perAttrValidation[key]=isValid;this.error(_.any(perAttrValidation,function(value){return!value}))})}},this);if(this.options.controlOptions&&this.options.controlOptions.model instanceof Backbone.Model&&!_.isArray(this.options.controlOptions)){perAttrValidation[this.options.controlOptions.modelAttribute]=!0;this.listenTo(this.options.controlOptions.model,"attributeValidated:"+this.options.controlOptions.modelAttribute,function(isValid,key){perAttrValidation[key]=isValid;this.error(_.any(perAttrValidation,function(value){return!value}))})}},events:{"click a.tooltip-link":function(e){e.preventDefault()}},render:function(){if(!this.el.innerHTML){var template=_.template(this.template,{_:_,controlCid:this.children.child0.cid,label:this.options.label,help:this.options.help,controlClass:this.options.controlClass,helpClass:this.options.helpClass,tooltip:this.options.tooltip,required:this.options.required});this.$el.html(template);this.options.tooltip&&this.$(".tooltip-link").tooltip({animation:!1,title:this.options.tooltip});_.each(this.childList,function(child,i){this.$(".controls").append(child.render().$el);i||child.$el.attr("id","control-"+this.children.child0.cid)},this);this.options.help&&this.$(".controls").append(this.$(".help-block"))}this.error(this.options.error);return this},hide:function(){this.$el.hide()},show:function(){this.$el.show()},enable:function(){this.$el.removeClass("disabled");_(this.getAllControls()).invoke("enable")},disable:function(){this.$el.addClass("disabled");_(this.getAllControls()).invoke("disable")},getModelAttributes:function(){var attrs=[];_.each(this.childList,function(child){attrs.push(child.getModelAttribute())},this);return attrs},error:function(state,errorMsg){state?this.$el.addClass("error"):this.$el.removeClass("error");this._errorMsg=errorMsg;return this},getAllControls:function(){return _(this.children).filter(function(child){return child instanceof Control})},template:'                <label class="control-label" for="control-<%- controlCid %>">                <%- label %>                <% if (tooltip) { %>                    <a href="#" class="tooltip-link"><%- _("?").t() %></a>                <% } %>                <% if (required) { %>                    <span class="required">*</span>                <% } %>                </label>                <div class="controls <%- controlClass %>">                <% if (help) { %> <span class="help-block <%- helpClass %>"><%= help %></span><% } %>                </div>                        '})});define("views/shared/jobstatus/buttons/ExportResultsDialog",["underscore","models/Base","module","views/shared/Modal","views/shared/controls/ControlGroup","views/shared/FlashMessages","uri/route","util/pdf_utils","util/math_utils"],function(_,Base,module,Modal,ControlGroup,FlashMessagesV2,route,pdfUtils,mathUtils){return Modal.extend({moduleId:module.id,initialize:function(options){Modal.prototype.initialize.apply(this,arguments);var Inmem=Base.extend({defaults:{fileName:"",format:"csv",limitResults:"unlimited",maxResults:1e3},validation:{maxResults:{fn:"validateMaxResults"},format:{fn:"validateFormat"}},validateMaxResults:function(value,attr,computedState){return"pdf"!==computedState.format&&"limit"!==computedState.limitResults||mathUtils.isInteger(value)&&!(parseFloat(value)<=0)?void 0:_("Max results must be an integer greater than 0").t()},validateFormat:function(value,attr,computedState){return"pdf"!==computedState.format||options.model.report&&!options.model.report.isNew()?void 0:_("Invalid format").t()}});this.model={searchJob:this.model.searchJob,application:this.model.application,report:this.model.report,inmem:new Inmem};this.children.flashMessage=new FlashMessagesV2({model:this.model.inmem});this.deferredPdfAvailable=$.Deferred();this.deferredInitializeFormat=$.Deferred();this.usePanelType=options.usePanelType;this.resultTypeIsReport=this.usePanelType?"events"!==this.model.report.entry.content.get("display.general.type"):this.model.searchJob.isReportSearch();this.model.report&&!this.model.report.isNew()?this.deferredPdfAvailable=pdfUtils.isPdfServiceAvailable():this.deferredPdfAvailable.resolve(!1);$.when(this.deferredPdfAvailable).then(function(available){var items=[{label:_("CSV").t(),value:"csv"},{label:_("XML").t(),value:"xml"},{label:_("JSON").t(),value:"json"}];available&&items.unshift({label:_("PDF").t(),value:"pdf"});this.resultTypeIsReport||items.unshift({label:_("Raw Events").t(),value:"raw"});this.children.formatControl=new ControlGroup({controlType:"SyntheticSelect",controlOptions:{modelAttribute:"format",model:this.model.inmem,items:items,save:!1,toggleClassName:"btn",labelPosition:"outside",elastic:!0,popdownOptions:{attachDialogTo:".modal:visible",scrollContainer:".modal:visible .modal-body:visible"}},label:_("Format").t()});this.deferredInitializeFormat.resolve()}.bind(this));this.children.filenameControl=new ControlGroup({controlType:"Text",controlOptions:{modelAttribute:"fileName",model:this.model.inmem,placeholder:"optional"},label:_("File Name").t()});this.children.limitResultsControl=new ControlGroup({controlType:"SyntheticRadio",controlOptions:{modelAttribute:"limitResults",model:this.model.inmem,items:[{label:_("Unlimited").t(),value:"unlimited"},{label:_("Limited").t(),value:"limit"}],save:!1,toggleClassName:"btn",labelPosition:"outside",elastic:!0},label:_("Number of Results").t()});this.children.maxResultsControl=new ControlGroup({controlType:"Text",controlOptions:{modelAttribute:"maxResults",model:this.model.inmem},label:_("Max Results").t()});this.model.inmem.on("change:limitResults",this.toggleMaxResults,this);this.model.inmem.on("change:format",this.toggleByFormat,this);this.model.inmem.on("validated",function(isValid){if(isValid){var format=this.model.inmem.get("format"),maxResults=this.model.inmem.get("maxResults"),count="limit"===this.model.inmem.get("limitResults")?maxResults:0;if("pdf"===format){var orientationSuffix="",orientation=this.model.report.entry.content.get("action.email.reportPaperOrientation"),pageSize=this.model.report.entry.content.get("action.email.reportPaperSize")||"a2";"landscape"===orientation&&(orientationSuffix="-landscape");pdfUtils.getRenderURL(this.model.report.entry.get("name"),this.model.report.entry.acl.get("app"),{sid:this.model.searchJob.id,"paper-size":pageSize+orientationSuffix,"max-rows-per-table":maxResults},"report").done(function(url){this.hide();window.open(url)}.bind(this))}else{window.location.href=route.exportUrl(this.model.application.get("root"),this.model.application.get("locale"),this.model.searchJob.get("id"),this.model.inmem.get("fileName"),this.model.inmem.get("format"),this.model.inmem.get("limitResults"),maxResults,count,this.resultTypeIsReport);this.hide()}}},this)},events:$.extend({},Modal.prototype.events,{"click .btn-primary":function(e){this.model.inmem.validate();e.preventDefault()}}),toggleByFormat:function(){if("pdf"===this.model.inmem.get("format")){this.children.filenameControl.$el.hide();this.children.limitResultsControl.$el.hide();this.children.maxResultsControl.$el.show()}else{this.children.filenameControl.$el.show();this.children.limitResultsControl.$el.show();this.toggleMaxResults()}},toggleMaxResults:function(){"unlimited"===this.model.inmem.get("limitResults")?this.children.maxResultsControl.$el.hide():this.children.maxResultsControl.$el.show()},render:function(){$.when(this.deferredInitializeFormat).then(function(){this.$el.html(Modal.TEMPLATE);this.$(Modal.HEADER_TITLE_SELECTOR).html(_("Export Results").t());this.children.flashMessage.render().prependTo(this.$(Modal.BODY_SELECTOR));this.$(Modal.BODY_SELECTOR).append(Modal.FORM_HORIZONTAL_JUSTIFIED);this.children.formatControl.render().appendTo(this.$(Modal.BODY_FORM_SELECTOR));this.children.filenameControl.render().appendTo(this.$(Modal.BODY_FORM_SELECTOR));this.children.limitResultsControl.render().appendTo(this.$(Modal.BODY_FORM_SELECTOR));this.children.maxResultsControl.render().appendTo(this.$(Modal.BODY_FORM_SELECTOR));this.toggleByFormat();this.toggleMaxResults();this.$(Modal.FOOTER_SELECTOR).append(Modal.BUTTON_CANCEL);this.$(Modal.FOOTER_SELECTOR).append('<a href="#" class="btn btn-primary modal-btn-primary">'+_("Export").t()+"</a>");return this}.bind(this))}})});define("splunkjs/mvc/savedsearchmanager",["require","exports","module","./mvc","./searchmanager","underscore","util/console","splunkjs/splunk","./messages"],function(require,exports,module){var SearchManager=(require("./mvc"),require("./searchmanager")),_=require("underscore"),console=require("util/console"),sdk=require("splunkjs/splunk"),Messages=require("./messages"),DISPATCHABLE_PROPERTIES={status_buckets:!0,buckets:!0,earliest_time:!0,indexedRealtime:!0,latest_time:!0,enable_lookups:!0,lookups:!0,max_count:!0,max_time:!0,reduce_freq:!0,rt_backfill:!0,spawn_process:!0,time_format:!0,ttl:!0,auto_cancel:!0,auto_pause:!0},DISPATCH_MAPPINGS={status_buckets:"buckets",enable_lookups:"lookups"},SavedSearchManager=SearchManager.extend({moduleId:module.id,defaults:{autostart:!0,cache:!1,cancelOnUnload:!0,runWhenTimeIsUndefined:!0},handleAutostart:function(){this.get("autostart")?this.on("change:searchname",this._debouncedStartSearch,this):this.off("change:searchname",this._debouncedStartSearch,this);return SearchManager.prototype.handleAutostart.apply(this,arguments)},startSearch:function(){if(this.get("searchname")){var cache=this.get("cache")||!1;_.isBoolean(cache)&&(cache=cache?-1:0);var threshold=0>cache?new Date(0).valueOf():(new Date).valueOf()-1e3*cache,search=new sdk.Service.SavedSearch(this.service,this.get("searchname"),{owner:this.service.owner,app:this.service.app,sharing:this.service.sharing}),that=this;search.fetch(function(err,search){if(err)if(404===err.status){var message=_("Warning: saved search not found: ").t()+'"'+that.get("searchname")+'"';console.log(message);that.trigger("search:error",message)}else{console.log("Error fetching saved searches");that.trigger("search:error",_("Error fetching saved searches").t())}else{that.settings.set("search",search.properties().search,{silent:!0});0!==cache?search.history(function(err,list){for(var matches=[],i=0;i<list.length;++i){var potentialJob=list[i],properties=potentialJob.properties()||{},published=new Date(potentialJob.published()).valueOf(),isScheduled="scheduled"===cache&&properties.isScheduled;(isScheduled||published>threshold)&&matches.push(potentialJob)}matches.sort(function(a,b){var aValue=new Date(a.published()).valueOf(),bValue=new Date(b.published()).valueOf();return bValue-aValue});var job=matches[0];job?that._startSearchWithExistingJob(job):that._startSearchWithNewJob(search)}):that._startSearchWithNewJob(search)}});return this}this.trigger("search:error",_("No saved search provided.").t())},_startSearchWithExistingJob:function(job){this.createManager(job)},_startSearchWithNewJob:function(search){var that=this,timeRangeIsUnresolved=void 0===this.settings.get("earliest_time",{tokens:!1})&&this.settings.get("earliest_time",{tokens:!0})||void 0===this.settings.get("latest_time",{tokens:!1})&&this.settings.get("latest_time",{tokens:!0});!timeRangeIsUnresolved||this.settings.get("runWhenTimeIsUndefined")?search.dispatch(this._createOptionsForSearchJob(),function(err,job){if(err)that.trigger("search:error",_("Error dispatching saved search.").t(),err,job);else{job.enablePreview();that.createManager(job)}}):this.trigger("search:error",Messages.resolve("unresolved-search").message)},_createOptionsForSearchJob:function(){var options={};_.each(this.settings.toJSON(),function(val,key){if(void 0!==val&&_.has(DISPATCHABLE_PROPERTIES,key)){var prefixedKey="dispatch."+(DISPATCH_MAPPINGS[key]||key);options[prefixedKey]=val}});return options}});return SavedSearchManager});define("splunkjs/mvc/postprocessmanager",["require","exports","module","underscore","./mvc","./utils","./basemanager","./searchmodel","./splunkresultsmodel","./messages"],function(require,exports,module){function mergeSearch(base,sub){return sub?[base.replace(/[\|\s]$/g,""),sub.replace(/^[\|\s]/g,"")].join(" | "):base}var _=require("underscore"),mvc=require("./mvc"),BaseManager=(require("./utils"),require("./basemanager")),SearchModels=require("./searchmodel"),SplunkResultsModel=require("./splunkresultsmodel"),Messages=require("./messages"),PostProcessResultsModel=SplunkResultsModel.extend({_requestOptions:function(){var options=SplunkResultsModel.prototype._requestOptions.call(this),manager=this.get("manager"),postProcessSearch=manager.settings.postProcessResolve();postProcessSearch&&(options.search=mergeSearch(postProcessSearch,options.search));return options}}),PostProcessSearchSettingsModel=SearchModels.SearchQuery.extend({resolve:function(options){if(!this.isResolved())return void 0;var parentSearch=this._manager.parent.settings.resolve(options);if(void 0===parentSearch)return void 0;var thisSearch=SearchModels.SearchQuery.prototype.resolve.call(this,_.defaults({qualified:!1},options));return mergeSearch(parentSearch,thisSearch)},postProcessResolve:function(){return SearchModels.SearchQuery.prototype.resolve.apply(this,arguments)},isResolved:function(){var resolvedSearch=SearchModels.SearchQuery.prototype.resolve.apply(this,arguments),tokens=this.get("search",{tokens:!0});return void 0!==resolvedSearch||void 0===tokens}}),PostProcessSearchManager=BaseManager.extend({moduleId:module.id,defaults:{managerid:null,search:""},constructor:function(attributes,options){attributes=attributes||{};options=options||{};attributes.search=attributes.postProcess||attributes.search;this.settings=new PostProcessSearchSettingsModel({},options);this.settings._manager=this;this.query=this.settings;return BaseManager.prototype.constructor.apply(this,arguments)},initialize:function(attrs,options){attrs=attrs||{};options=options||{};this.set("data",{});this.settings.on("change",this._handleSettingsChange,this);this.settings.on("change:search",this.startSearch,this);this.on("all",function(evt){0===evt.indexOf("search:")&&(this._lastSearchEvent=[evt,Array.prototype.slice.call(arguments,1)])},this);var managerid=attrs.managerid||attrs.manager;mvc.Components.bind("change:"+managerid,this.onManagerChange,this);mvc.Components.has(managerid)&&this.onManagerChange(mvc.Components,mvc.Components.get(managerid))},set:function(key,value,options){var attrs;if(_.isObject(key)&&!_.isArray(key)||null===key){attrs=key;options=value}else{attrs={};attrs[key]=value}this.settings.set(attrs,options);BaseManager.prototype.set.call(this,attrs,options)},_handleSettingsChange:function(){var managerPropertiesChanged=_.omit(this.settings.changed,SearchModels.SearchSettingsModel.ALLOWED_ATTRIBUTES);BaseManager.prototype.set.call(this,managerPropertiesChanged)},startSearch:function(){if(this.parent&&this.parent.job){var job=this.parent.job,state=job.state();this._onSearchStart(job);this._onSearchTick("search:progress",state,job);state&&state.content&&state.content.isDone&&this._onSearchTick("search:done",state,job)}},onManagerChange:function(x,ctx){if(this.parent){this.parent.off(null,null,this);delete this.job}if(ctx){this.parent=ctx;this._countData=this.data("preview",{autofetch:!1,output_mode:"json",search:"stats count"});this._countData.on("error",_.partial(this.trigger,"search:error"),this);this.search=this.parent.search;ctx.on("search:start",this._onSearchStart,this);ctx.on("search:progress",_.partial(this._onSearchTick,"search:progress"),this);ctx.on("search:done",_.partial(this._onSearchTick,"search:done"),this);ctx.on("search:cancelled",_.partial(this.trigger,"search:cancelled"),this);ctx.on("search:fail",_.partial(this.trigger,"search:fail"),this);ctx.on("search:error",_.partial(this.trigger,"search:error"),this);ctx.replayLastSearchEvent(this)}},get:function(attr){return this.settings.has(attr)?this.settings.get.apply(this.settings,arguments):this.parent&&this.parent.has(attr)?this.parent.get.apply(this.parent,arguments):void 0},_onSearchStart:function(job){this.job=job;this.settings.isResolved()?this.trigger("search:start",job):this.trigger("search:error",Messages.resolve("unresolved-search").message)},_onSearchTick:function(eventName,properties,job){if(this.settings.isResolved()){properties=_.clone(properties||{});var content=properties.content=_.clone(properties.content||{}),that=(content.resultPreviewCount||0,this),trigger=function(){that.trigger(eventName,properties,job);if("search:progress"===eventName){that.unset("data",{silent:!0});that.set("data",properties.content)}};this._countData.fetch({success:function(){var count=0;if(that._countData.hasData()){var data=that._countData.data();count=parseInt(data.results[0].count,10)}content.resultPreviewCount=count;content.resultCount=count;trigger()}})}},data:function(source,args){if(!source)throw new Error("Cannot get a results model without specifying the source.");args=_.defaults({manager:this,source:source},args);return new PostProcessResultsModel(args)},replayLastSearchEvent:function(listener){var replayed=!1;if(this._lastSearchEvent){var lastSearchEvent=this._lastSearchEvent,evtName=lastSearchEvent[0],listenerObj=_(this._events[evtName]).find(function(attachedListener){return attachedListener.ctx===listener});if(listenerObj){var args=lastSearchEvent[1];replayed=!0;listenerObj.callback.apply(listener,args)}}return replayed}});return PostProcessSearchManager});define("splunkjs/mvc/resultslinkview",["require","exports","module","jquery","underscore","splunk.util","splunk.window","models/search/Job","uri/route","views/shared/jobstatus/buttons/ExportResultsDialog","./basesplunkview","./mvc","models/dashboards/DashboardReport","./savedsearchmanager","./utils","./sharedmodels","splunk.util","./postprocessmanager"],function(require,exports,module){var $=require("jquery"),_=require("underscore"),SplunkUtil=require("splunk.util"),SplunkWindow=require("splunk.window"),SearchJobModel=require("models/search/Job"),Route=require("uri/route"),ExportResultsDialog=require("views/shared/jobstatus/buttons/ExportResultsDialog"),BaseSplunkView=require("./basesplunkview"),ReportModel=(require("./mvc"),require("models/dashboards/DashboardReport")),SavedSearchManager=require("./savedsearchmanager"),Utils=require("./utils"),sharedModels=require("./sharedmodels"),util=require("splunk.util"),PostProcessSearchManager=require("./postprocessmanager"),ResultsLinkView=BaseSplunkView.extend({moduleId:module.id,events:{"click a.refresh-button":"refresh"},configure:function(){this.options.manager&&(this.options.managerid=this.options.manager);BaseSplunkView.prototype.configure.apply(this,arguments)},initialize:function(){this.configure();this.bindToComponentSetting("managerid",this.onManagerChange,this);this.searchJobModel=new SearchJobModel;this.applicationModel=sharedModels.get("app");this.model=this.model||new ReportModel;this.listenTo(this.model.entry.content,"change:search",_.bind(this.render,this))},onManagerChange:function(managers,manager){if(this.manager){this.manager.off(null,null,this);this.manager=null}if(manager){this.manager=manager;this.listenTo(manager,"search:start",this.onSearchStart);this.listenTo(manager,"search:done",this.onSearchDone);this.manager.job&&this.onSearchStart(this.manager.job);this.manager.replayLastSearchEvent(this)}},onSearchStart:function(jobInfo){this.searchJobModel.set("id",jobInfo.sid);this.$pivotButton&&this.$pivotButton.off("click").on("click",this.openPivot.bind(this)).show();this.$searchButton&&this.$searchButton.off("click").on("click",this.openSearch.bind(this)).show();this.$refreshButton&&this.$refreshButton.show();if(this.$exportButton)if(this.manager instanceof PostProcessSearchManager){this.$exportButton.tooltip("destroy");
this.$exportButton.attr("title",_("Export - You cannot export results for post-process jobs.").t());this.$exportButton.tooltip({animation:!1,container:"body"});this.$exportButton.addClass("disabled");this.$exportButton.off("click").on("click",function(e){e.preventDefault()}).show()}else{this.$exportButton.addClass("disabled");this.$exportButton.off("click").on("click",function(e){e.preventDefault()}).show()}this.$inspectButton&&this.$inspectButton.off("click").on("click",this.inspectSearch.bind(this)).show()},onSearchDone:function(){this.searchJobModel.setFromSplunkD({entry:[this.manager.job.state()]});if(this.$exportButton)if(this.manager instanceof PostProcessSearchManager){this.$exportButton.tooltip("destroy");this.$exportButton.attr("title",_("Export - You cannot export results for post-process jobs.").t());this.$exportButton.tooltip({animation:!1,container:"body"});this.$exportButton.addClass("disabled");this.$exportButton.off("click").on("click",function(e){e.preventDefault()}).show()}else{this.$exportButton.tooltip("destroy");this.$exportButton.attr("title",_("Export").t());this.$exportButton.tooltip({animation:!1,container:"body"});this.$exportButton.removeClass("disabled");this.$exportButton.off("click").on("click",this.exportResults.bind(this)).show()}},openSearch:function(e){e&&e.preventDefault();var params,earliest,latest,options=this.options,manager=this.manager;if(options["link.openSearch.search"]){params={q:options["link.openSearch.search"]};earliest=options["link.openSearch.searchEarliestTime"];earliest=!earliest&&manager.job.properties().earliestTime?util.getEpochTimeFromISO(manager.job.properties().earliestTime):manager.settings.get("earliest_time");null!=earliest&&(params.earliest=earliest);latest=options["link.openSearch.searchLatestTime"];latest=!latest&&manager.job.properties().latestTime?util.getEpochTimeFromISO(manager.job.properties().latestTime):manager.settings.get("latest_time");null!=latest&&(params.latest=latest)}else if(options["link.openSearch.viewTarget"])params={sid:this.searchJobModel.get("id")};else{params={sid:this.searchJobModel.get("id"),q:manager.settings.resolve()};manager instanceof SavedSearchManager&&(params["s"]=manager.get("searchname"));earliest=manager.settings.get("earliest_time");null!=earliest&&(params.earliest=earliest);latest=manager.settings.get("latest_time");null!=latest&&(params.latest=latest)}var pageInfo=Utils.getPageInfo(),url=Route.page(pageInfo.root,pageInfo.locale,pageInfo.app,options["link.openSearch.viewTarget"]||"search",{data:params});window.open(url,"_blank")},exportResults:function(e){e&&e.preventDefault();var exportDialog=new ExportResultsDialog({model:{searchJob:this.searchJobModel,application:this.applicationModel,report:this.model},usePanelType:!0});exportDialog.render().appendTo($("body"));exportDialog.show()},inspectSearch:function(e){e&&e.preventDefault();var pageInfo=Utils.getPageInfo(),url=Route.jobInspector(pageInfo.root,pageInfo.locale,pageInfo.app,this.searchJobModel.get("id"));SplunkWindow.open(url,"splunk_job_inspector",{width:870,height:560,menubar:!1})},openPivot:function(e){e&&e.preventDefault();var params,url,pageInfo=Utils.getPageInfo();if(this.model.has("id")){var id=this.model.get("id");params={s:id};if(this.model.entry.content.has("dispatch.earliest_time")){params.earliest=this.model.entry.content.get("dispatch.earliest_time");params.latedst=this.model.entry.content.get("dispatch.latest_time")}url=Route.pivot(pageInfo.root,pageInfo.locale,pageInfo.app,{data:params});Utils.redirect(url,!0)}else{var search=this.model.entry.content.get("search");params={q:search};if(this.model.entry.content.has("dispatch.earliest_time")){params.earliest=this.model.entry.content.get("dispatch.earliest_time");params.latest=this.model.entry.content.get("dispatch.latest_time")}url=Route.pivot(pageInfo.root,pageInfo.locale,pageInfo.app,{data:params});Utils.redirect(url,!0)}},render:function(){var template;template=_.template(this.model.isPivotReport()?this.pivotTemplate:this.template);this.$el.html(template({options:this.options}));this.resolveBooleanOptions("link.openPivot.visible","link.visible",!0)?this.$pivotButton=this.$(".pivot-button").hide():this.$(".pivot-button").remove();this.resolveBooleanOptions("link.openSearch.visible","link.visible",!0)?this.$searchButton=this.$(".search-button").hide():this.$(".search-button").remove();this.resolveBooleanOptions("link.exportResults.visible","link.visible",!0)?this.$exportButton=this.$(".export-button").hide():this.$(".export-button").remove();this.resolveBooleanOptions("link.inspectSearch.visible","link.visible",!0)?this.$inspectButton=this.$(".inspect-button").hide():this.$(".inspect-button").remove();this.resolveBooleanOptions("refresh.link.visible","link.visible",!0)?this.$refreshButton=this.$(".refresh-button").hide():this.$(".refresh-button").remove();this.$searchButton||this.$exportButton||this.$inspectButton||this.$refreshButton?this.$el.show():this.$el.hide();this.$("> a").tooltip({animation:!1,container:"body"});return this},resolveBooleanOptions:function(){for(var value,options=this.options,i=0,l=arguments.length-1;l>i;i++){value=options[arguments[i]];if(null!=value)return SplunkUtil.normalizeBoolean(value)}return SplunkUtil.normalizeBoolean(arguments[arguments.length-1])},refresh:function(event){event&&event.preventDefault();this.manager.startSearch("refresh")},template:'            <a href="#search" class="search-button btn-pill" title="<%- options[\'link.openSearch.text\'] || _(\'Open in Search\').t() %>">                <i class="icon-search"></i>                <span class="hide-text"><%- options[\'link.openSearch.text\'] || _("Open in Search").t() %></span>            </a><a href="#export" class="export-button btn-pill" title="<%- _(\'Export - You can only export results for completed jobs.\').t() %>">                <i class="icon-export"></i>                <span class="hide-text"><%- _("Export").t() %></span>            </a><a href="#inspect" class="inspect-button btn-pill" title="<%- _(\'Inspect\').t() %>">                <i class="icon-info"></i>                <span class="hide-text"><%- _("Inspect").t() %></span>            </a><a href="#refresh" class="refresh-button btn-pill" title="<%- _(\'Refresh\').t() %>">                <i class="icon-rotate-counter"></i>                <span class="hide-text"><%- _("Refresh").t() %></span>            </a>        ',pivotTemplate:'            <a href="#pivot" class="pivot-button btn-pill" title="<%- _(\'Open in Pivot\').t() %>">                <i class="icon-pivot"></i>                <span class="hide-text"><%- _("Open in Pivot").t() %></span>            </a><a href="#export" class="export-button btn-pill" title="<%- _(\'Export\').t() %>">                <i class="icon-export"></i>                <span class="hide-text"><%- _("Export").t() %></span>            </a><a href="#inspect" class="inspect-button btn-pill" title="<%- _(\'Inspect\').t() %>">                <i class="icon-info"></i>                <span class="hide-text"><%- _("Inspect").t() %></span>            </a><a href="#refresh" class="refresh-button btn-pill" title="<%- _(\'Refresh\').t() %>">                <i class="icon-rotate-counter"></i>                <span class="hide-text"><%- _("Refresh").t() %></span>            </a>        '});return ResultsLinkView});define("views/shared/PopTart",["underscore","module","views/Base","views/shared/delegates/PopdownDialog"],function(_,module,Base,PopdownDialogDelegate){return Base.extend({moduleId:module.id,className:"popdown-dialog",initialize:function(options){options=options||{};var defaults={direction:"auto",adjustPosition:!0};_.defaults(options,defaults);Base.prototype.initialize.apply(this,arguments);this.children.popdownDialogDelegate=new PopdownDialogDelegate({el:this.el,ignoreClasses:this.options.ignoreClasses,adjustPosition:this.options.adjustPosition,show:this.options.show,mode:this.options.mode,direction:this.options.direction,arrow:this.options.arrow,minMargin:this.options.minMargin,allowPopUp:this.options.allowPopUp,scrollContainer:this.options.scrollContainer});this.activate()},startListening:function(){this.listenTo(this.children.popdownDialogDelegate,"all",function(){this.trigger.apply(this,arguments)});this.listenTo(this,"shown",function(){this.shown=!0;this.children.popdownDialogDelegate.$el.find("a").first().focus()});this.listenTo(this,"hidden",function(){this.shown=!1;this.options.onHiddenRemove&&this.remove()});this.listenTo(this,"focus-on-activator",function(){this.$toggle&&this.$toggle.focus()})},toggle:function(){return this.children.popdownDialogDelegate.toggle()},show:function($toggle){this.children.popdownDialogDelegate.show($toggle);this.$toggle=$toggle},hide:function(){this.children.popdownDialogDelegate.hide()},render:function(){this.el.innerHTML=this.template;return this},remove:function(){this.shown&&this.hide();Base.prototype.remove.apply(this,arguments)},template:'                <div class="arrow"></div>                <div class="popdown-dialog-body popdown-dialog-padded"></div>            ',template_menu:'                <div class="arrow"></div>            '})});define("views/shared/vizcontrols/custom_controls/DrilldownRadio",["underscore","jquery","module","views/shared/controls/SyntheticRadioControl","splunk.util"],function(_,$,module,SyntheticRadioControl){return SyntheticRadioControl.extend({moduleId:module.id,initialize:function(){$.extend(this.options,{modelAttribute:"display.visualizations.charting.drilldown",items:[{label:_("Yes").t(),value:"all"},{label:_("No").t(),value:"none"}],save:!1,elastic:!0});SyntheticRadioControl.prototype.initialize.call(this,this.options)}})});define("views/shared/vizcontrols/custom_controls/DrilldownRadioGroup",["underscore","module","views/shared/controls/ControlGroup","./DrilldownRadio"],function(_,module,ControlGroup,DrilldownRadio){return ControlGroup.extend({moduleId:module.id,initialize:function(){var control=new DrilldownRadio({model:this.model});this.options.label=_("Drilldown").t();this.options.controls=[control];ControlGroup.prototype.initialize.call(this,this.options)}})});define("views/shared/vizcontrols/custom_controls/StackModeControlGroup",["underscore","module","views/shared/controls/ControlGroup"],function(_,module,ControlGroup){return ControlGroup.extend({moduleId:module.id,initialize:function(){var items=[{value:"default",icon:"bar-beside",tooltip:_("not stacked").t()},{value:"stacked",icon:"bar-stacked",tooltip:_("stacked").t()}];this.options.allowStacked100!==!1&&items.push({value:"stacked100",icon:"bar-stacked-100",tooltip:_("stacked 100%").t()});this.options.label=_("Stack Mode").t();this.options.controlType="SyntheticRadio";this.options.controlOptions={modelAttribute:"display.visualizations.charting.chart.stackMode",model:this.model,className:"btn-group",items:items};ControlGroup.prototype.initialize.call(this,this.options)}})});define("views/shared/vizcontrols/custom_controls/NullValueModeControlGroup",["underscore","module","views/shared/controls/ControlGroup"],function(_,module,ControlGroup){return ControlGroup.extend({moduleId:module.id,initialize:function(){this.options.label=_("Null Values").t();this.options.controlType="SyntheticRadio";this.options.controlOptions={modelAttribute:"display.visualizations.charting.chart.nullValueMode",model:this.model,className:"btn-group",items:[{value:"gaps",icon:"missing-value-skipped",tooltip:_("Gaps").t()},{value:"zero",icon:"missing-value-zero",tooltip:_("Zero").t()},{value:"connect",icon:"missing-value-join",tooltip:_("Connect").t()}]};ControlGroup.prototype.initialize.call(this,this.options)}})});define("views/shared/vizcontrols/custom_controls/GaugeStyleControlGroup",["underscore","module","views/shared/controls/ControlGroup"],function(_,module,ControlGroup){return ControlGroup.extend({moduleId:module.id,initialize:function(){this.options.label=_("Style").t();this.options.controlType="SyntheticRadio";this.options.controlOptions={modelAttribute:"display.visualizations.charting.chart.style",model:this.model,items:[{label:_("Minimal").t(),value:"minimal"},{label:_("Shiny").t(),value:"shiny"}]};ControlGroup.prototype.initialize.call(this,this.options)}})});define("views/shared/vizcontrols/custom_controls/SingleValueBeforeLabelControlGroup",["underscore","module","views/shared/controls/ControlGroup"],function(_,module,ControlGroup){return ControlGroup.extend({moduleId:module.id,initialize:function(){this.options.label=_("Before Label").t();this.options.controlType="Text";this.options.controlOptions={modelAttribute:"display.visualizations.singlevalue.beforeLabel",model:this.model,placeholder:_("optional").t(),inputClassName:"input-medium"};ControlGroup.prototype.initialize.call(this,this.options)}})});define("views/shared/vizcontrols/custom_controls/SingleValueAfterLabelControlGroup",["underscore","module","views/shared/controls/ControlGroup"],function(_,module,ControlGroup){return ControlGroup.extend({moduleId:module.id,initialize:function(){this.options.label=_("After Label").t();this.options.controlType="Text";this.options.controlOptions={modelAttribute:"display.visualizations.singlevalue.afterLabel",model:this.model,placeholder:_("optional").t(),inputClassName:"input-medium"};ControlGroup.prototype.initialize.call(this,this.options)}})});define("views/shared/vizcontrols/custom_controls/SingleValueUnderLabelControlGroup",["underscore","module","views/shared/controls/ControlGroup"],function(_,module,ControlGroup){return ControlGroup.extend({moduleId:module.id,initialize:function(){this.options.label=_("Under Label").t();this.options.controlType="Text";this.options.controlOptions={modelAttribute:"display.visualizations.singlevalue.underLabel",model:this.model,placeholder:_("optional").t(),inputClassName:"input-medium"};ControlGroup.prototype.initialize.call(this,this.options)}})});define("views/shared/vizcontrols/custom_controls/MultiSeriesRadio",["underscore","jquery","module","views/shared/controls/ControlGroup"],function(_,$,module,ControlGroup){return ControlGroup.extend({moduleId:module.id,initialize:function(){this.options.label=_("Multi-series Mode").t();this.options.controlType="SyntheticRadio";this.options.controlClass="controls-halfblock";this.options.controlOptions={modelAttribute:"display.visualizations.charting.layout.splitSeries",model:this.model,items:[{label:_("Yes").t(),value:"1"},{label:_("No").t(),value:"0"}],save:!1,elastic:!0};ControlGroup.prototype.initialize.call(this,this.options)}})});define("views/shared/vizcontrols/custom_controls/MapDrilldownControlGroup",["underscore","jquery","module","views/shared/controls/ControlGroup"],function(_,$,module,ControlGroup){return ControlGroup.extend({moduleId:module.id,initialize:function(){this.options.label=_("Drilldown").t();this.options.controlType="SyntheticRadio";this.options.controlClass="controls-halfblock";this.options.controlOptions={modelAttribute:"display.visualizations.mapping.drilldown",model:this.model,items:[{label:_("Yes").t(),value:"all"},{label:_("No").t(),value:"none"}],elastic:!0};ControlGroup.prototype.initialize.call(this,this.options)}})});define("views/shared/vizcontrols/components/General",["underscore","jquery","module","views/Base","views/shared/controls/ControlGroup","views/shared/vizcontrols/custom_controls/DrilldownRadioGroup","views/shared/vizcontrols/custom_controls/StackModeControlGroup","views/shared/vizcontrols/custom_controls/NullValueModeControlGroup","views/shared/vizcontrols/custom_controls/GaugeStyleControlGroup","views/shared/vizcontrols/custom_controls/SingleValueBeforeLabelControlGroup","views/shared/vizcontrols/custom_controls/SingleValueAfterLabelControlGroup","views/shared/vizcontrols/custom_controls/SingleValueUnderLabelControlGroup","views/shared/vizcontrols/custom_controls/MultiSeriesRadio","views/shared/vizcontrols/custom_controls/MapDrilldownControlGroup"],function(_,$,module,Base,ControlGroup,DrilldownRadioGroup,StackModeControlGroup,NullValueModeControlGroup,GaugeStyleControlGroup,SingleValueBeforeLabelControlGroup,SingleValueAfterLabelControlGroup,SingleValueUnderLabelControlGroup,MultiSeriesRadio,MapDrilldownControlGroup){return Base.extend({moduleId:module.id,className:"form form-horizontal",vizToGeneralComponents:{line:["nullValue","multiseries","drilldown"],area:["stack","nullValue","multiseries","drilldown"],column:["stack","multiseries","drilldown"],bar:["stack","multiseries","drilldown"],pie:["drilldown"],scatter:["drilldown"],radialGauge:["style"],fillerGauge:["style"],markerGauge:["style"],single:["before","after","under"],mapping:["mapDrilldown"]},initialize:function(){Base.prototype.initialize.apply(this,arguments);var controls=this.vizToGeneralComponents[this.model.get("viz_type")];_.indexOf(controls,"stack")>-1&&(this.children.stackMode=new StackModeControlGroup({model:this.model,controlClass:"controls-thirdblock"}));_.indexOf(controls,"nullValue")>-1&&(this.children.nullValueMode=new NullValueModeControlGroup({model:this.model,controlClass:"controls-thirdblock"}));_.indexOf(controls,"multiseries")>-1&&(this.children.multiSeries=new MultiSeriesRadio({model:this.model}));_.indexOf(controls,"drilldown")>-1&&(this.children.drilldown=new DrilldownRadioGroup({model:this.model,controlClass:"controls-halfblock"}));_.indexOf(controls,"style")>-1&&(this.children.gaugeStyle=new GaugeStyleControlGroup({model:this.model,controlClass:"controls-halfblock"}));_.indexOf(controls,"before")>-1&&(this.children.beforeLabel=new SingleValueBeforeLabelControlGroup({model:this.model,controlClass:"controls-block"}));_.indexOf(controls,"after")>-1&&(this.children.afterLabel=new SingleValueAfterLabelControlGroup({model:this.model,controlClass:"controls-block"}));_.indexOf(controls,"under")>-1&&(this.children.underLabel=new SingleValueUnderLabelControlGroup({model:this.model,controlClass:"controls-block"}));_.indexOf(controls,"mapDrilldown")>-1&&(this.children.mapDrilldown=new MapDrilldownControlGroup({model:this.model}))},render:function(){this.children.stackMode&&this.children.stackMode.render().appendTo(this.$el);this.children.nullValueMode&&this.children.nullValueMode.render().appendTo(this.$el);this.children.multiSeries&&this.children.multiSeries.render().appendTo(this.$el);this.children.drilldown&&this.children.drilldown.render().appendTo(this.$el);this.children.gaugeStyle&&this.children.gaugeStyle.render().appendTo(this.$el);this.children.beforeLabel&&this.children.beforeLabel.render().appendTo(this.$el);this.children.afterLabel&&this.children.afterLabel.render().appendTo(this.$el);this.children.underLabel&&this.children.underLabel.render().appendTo(this.$el);this.children.events&&this.children.events.render().appendTo(this.$el);this.children.statistics&&this.children.statistics.render().appendTo(this.$el);this.children.mapDrilldown&&this.children.mapDrilldown.render().appendTo(this.$el);return this}})});define("views/shared/vizcontrols/custom_controls/AxisTitleControlGroup",["underscore","module","models/Base","views/shared/controls/ControlGroup","views/shared/controls/Control"],function(_,module,BaseModel,ControlGroup,Control){return ControlGroup.extend({moduleId:module.id,initialize:function(){this.axisTitleVisibilityAttr="display.visualizations.charting."+this.options.axisType+".visibility";this.axisTitleTextAttr="display.visualizations.charting."+this.options.axisType+".text";this.titleStateModel=new BaseModel;this.setInitialTitleState();this.axisTitleText=this.model.get(this.axisTitleTextAttr);this.options.label=_("Title").t();this.options.controlClass="controls-block";this.options.controls=[{type:"SyntheticSelect",options:{className:Control.prototype.className+" input-prepend",model:this.titleStateModel,modelAttribute:"state",toggleClassName:"btn",menuWidth:"narrow",items:[{value:"default",label:_("Default").t()},{value:"custom",label:_("Custom").t()},{value:"none",label:_("None").t()}]}},{type:"Text",options:{className:Control.prototype.className+" input-prepend",model:this.model,modelAttribute:this.axisTitleTextAttr,inputClassName:this.options.inputClassName}}];ControlGroup.prototype.initialize.call(this,this.options);this.showHideControl=this.childList[0];this.labelControl=this.childList[1];this.titleStateModel.on("change:state",this.handleTitleState,this);this.model.on("change:"+this.axisTitleTextAttr,function(){"default"!==this.titleStateModel.get("state")&&(this.axisTitleText=this.model.get(this.axisTitleTextAttr))},this)},setInitialTitleState:function(){this.titleStateModel.set("collapsed"===this.model.get(this.axisTitleVisibilityAttr)?{state:"none"}:this.model.get(this.axisTitleTextAttr)?{state:"custom"}:{state:"default"})},render:function(){ControlGroup.prototype.render.apply(this,arguments);this.handleTitleState();return this},handleTitleState:function(){var state=this.titleStateModel.get("state"),setObject={};if("none"===state){setObject[this.axisTitleVisibilityAttr]="collapsed";this.hideTitleTextInput()}else if("custom"===state){setObject[this.axisTitleVisibilityAttr]="visible";setObject[this.axisTitleTextAttr]=this.axisTitleText;this.showTitleTextInput()}else{setObject[this.axisTitleVisibilityAttr]="visible";setObject[this.axisTitleTextAttr]="";this.hideTitleTextInput()}this.model.set(setObject)},showTitleTextInput:function(){this.labelControl.insertAfter(this.showHideControl.$el);this.showHideControl.$el.addClass("input-prepend")},hideTitleTextInput:function(){this.labelControl.detach();this.showHideControl.$el.removeClass("input-prepend")}},{X_AXIS:"axisTitleX",Y_AXIS:"axisTitleY",Y_AXIS_2:"axisTitleY2"})});define("views/shared/vizcontrols/custom_controls/AxisScaleControlGroup",["underscore","module","views/shared/controls/ControlGroup"],function(_,module,ControlGroup){return ControlGroup.extend({moduleId:module.id,initialize:function(){this.options.label=_("Scale").t();this.options.controlType="SyntheticRadio";var items=[{label:_("Linear").t(),value:"linear"},{label:_("Log").t(),value:"log"}];this.options.supportInherit&&items.unshift({label:_("Inherit").t(),value:"inherit"});this.options.controlOptions={modelAttribute:"display.visualizations.charting."+this.options.axisType+".scale",model:this.model,className:"btn-group",items:items};ControlGroup.prototype.initialize.call(this,this.options)}},{X_AXIS:"axisX",Y_AXIS:"axisY",Y_AXIS_2:"axisY2"})});define("views/shared/vizcontrols/custom_controls/AxisIntervalControlGroup",["underscore","module","views/shared/controls/ControlGroup"],function(_,module,ControlGroup){return ControlGroup.extend({moduleId:module.id,initialize:function(){this.options.label=_("Interval").t();this.options.controlType="Text";this.options.controlOptions={modelAttribute:"display.visualizations.charting."+this.options.axisType+".majorUnit",model:this.model,placeholder:_("optional").t(),inputClassName:"input-medium"};ControlGroup.prototype.initialize.call(this,this.options)}},{X_AXIS:"axisLabelsX",Y_AXIS:"axisLabelsY",Y_AXIS_2:"axisLabelsY2"})});define("views/shared/vizcontrols/custom_controls/AxisMinValueControlGroup",["underscore","module","views/shared/controls/ControlGroup"],function(_,module,ControlGroup){return ControlGroup.extend({moduleId:module.id,initialize:function(){this.options.label=_("Min Value").t();this.options.controlType="Text";this.options.controlOptions={modelAttribute:"display.visualizations.charting."+this.options.axisType+".minimumNumber",model:this.model,placeholder:_("optional").t(),inputClassName:"input-medium"};ControlGroup.prototype.initialize.call(this,this.options)}},{X_AXIS:"axisX",Y_AXIS:"axisY",Y_AXIS_2:"axisY2"})});define("views/shared/vizcontrols/custom_controls/AxisMaxValueControlGroup",["underscore","module","views/shared/controls/ControlGroup"],function(_,module,ControlGroup){return ControlGroup.extend({moduleId:module.id,initialize:function(){this.options.label=_("Max Value").t();this.options.controlType="Text";this.options.controlOptions={modelAttribute:"display.visualizations.charting."+this.options.axisType+".maximumNumber",model:this.model,placeholder:_("optional").t(),inputClassName:"input-medium"};ControlGroup.prototype.initialize.call(this,this.options)}},{X_AXIS:"axisX",Y_AXIS:"axisY",Y_AXIS_2:"axisY2"})});define("views/shared/vizcontrols/custom_controls/AxisLabelRotationControlGroup",["jquery","underscore","module","views/shared/controls/ControlGroup"],function($,_,module,ControlGroup){return ControlGroup.extend({moduleId:module.id,initialize:function(){this.options.label=_("Label Rotation").t();this.options.controlType="SyntheticRadio";this.options.controlOptions={modelAttribute:"display.visualizations.charting."+this.options.axisType+".majorLabelStyle.rotation",model:this.model,items:[{value:"-90",icon:"label-rotation--90",tooltip:"-90&deg;"},{value:"-45",icon:"label-rotation--45",tooltip:"-45&deg;"},{value:"0",icon:"label-rotation-0",tooltip:"0&deg;"},{value:"45",icon:"label-rotation-45",tooltip:"45&deg;"},{value:"90",icon:"label-rotation-90",tooltip:"90&deg;"}],className:"btn-group"};ControlGroup.prototype.initialize.call(this,this.options)}},{X_AXIS:"axisLabelsX",Y_AXIS:"axisLabelsY",Y_AXIS_2:"axisLabelsY2"})});define("views/shared/vizcontrols/custom_controls/AxisLabelElisionControlGroup",["underscore","module","views/shared/controls/ControlGroup"],function(_,module,ControlGroup){return ControlGroup.extend({moduleId:module.id,initialize:function(){this.options.label=_("Label Truncation").t();this.options.controlType="SyntheticRadio";this.options.controlOptions={modelAttribute:"display.visualizations.charting."+this.options.axisType+".majorLabelStyle.overflowMode",model:this.model,className:"btn-group",items:[{label:_("Yes").t(),value:"ellipsisMiddle"},{label:_("No").t(),value:"ellipsisNone"}]};ControlGroup.prototype.initialize.call(this,this.options)}},{X_AXIS:"axisLabelsX",Y_AXIS:"axisLabelsY",Y_AXIS_2:"axisLabelsY2"})});define("views/shared/vizcontrols/components/XAxis",["underscore","jquery","module","views/Base","views/shared/vizcontrols/custom_controls/AxisTitleControlGroup","views/shared/vizcontrols/custom_controls/AxisScaleControlGroup","views/shared/vizcontrols/custom_controls/AxisIntervalControlGroup","views/shared/vizcontrols/custom_controls/AxisMinValueControlGroup","views/shared/vizcontrols/custom_controls/AxisMaxValueControlGroup","views/shared/vizcontrols/custom_controls/AxisLabelRotationControlGroup","views/shared/vizcontrols/custom_controls/AxisLabelElisionControlGroup"],function(_,$,module,Base,AxisTitleControlGroup,AxisScaleControlGroup,AxisIntervalControlGroup,AxisMinValueControlGroup,AxisMaxValueControlGroup,AxisLabelRotationControlGroup,AxisLabelElisionControlGroup){return Base.extend({moduleId:module.id,className:"form form-horizontal",vizToGeneralComponents:{line:["title","elision","rotation"],area:["title","elision","rotation"],column:["title","elision","rotation"],bar:["title"],pie:[],scatter:["title","elision","rotation","scale","interval","min","max"],radialGauge:[],fillerGauge:[],markerGauge:[],single:[],events:[],statistics:[]},initialize:function(){Base.prototype.initialize.apply(this,arguments);var controls=this.vizToGeneralComponents[this.model.get("viz_type")];_.indexOf(controls,"title")>-1&&(this.children.title=new AxisTitleControlGroup({model:this.model,axisType:AxisTitleControlGroup.X_AXIS}));_.indexOf(controls,"elision")>-1&&(this.children.elision=new AxisLabelElisionControlGroup({model:this.model,axisType:AxisLabelElisionControlGroup.X_AXIS}));_.indexOf(controls,"rotation")>-1&&(this.children.rotation=new AxisLabelRotationControlGroup({model:this.model,axisType:AxisLabelRotationControlGroup.X_AXIS}));_.indexOf(controls,"scale")>-1&&(this.children.scale=new AxisScaleControlGroup({model:this.model,className:"scale control-group",controlClass:"controls-halfblock",axisType:AxisScaleControlGroup.X_AXIS}));_.indexOf(controls,"interval")>-1&&(this.children.interval=new AxisIntervalControlGroup({model:this.model,controlClass:"controls-block",axisType:AxisIntervalControlGroup.X_AXIS}));_.indexOf(controls,"min")>-1&&(this.children.min=new AxisMinValueControlGroup({model:this.model,controlClass:"controls-block",axisType:AxisMinValueControlGroup.X_AXIS}));_.indexOf(controls,"max")>-1&&(this.children.max=new AxisMaxValueControlGroup({model:this.model,controlClass:"controls-block",axisType:AxisMaxValueControlGroup.X_AXIS}));"log"==this.model.get("display.visualizations.charting.axisX.scale")&&this.children.interval&&this.children.interval.$el.hide();this.children.elision&&this.model.on("change:display.visualizations.charting.axisLabelsX.majorLabelStyle.rotation",this.handleRotation,this)},events:{"click .scale button":function(e){this.intervalVal=this.intervalVal||this.model.get("display.visualizations.charting.axisLabelsX.majorUnit");if("log"==$(e.currentTarget).data("value")){this.children.interval&&this.children.interval.$el.hide();this.model.set("display.visualizations.charting.axisLabelsX.majorUnit","")}else{this.children.interval&&this.children.interval.$el.show();this.model.set("display.visualizations.charting.axisLabelsX.majorUnit",this.intervalVal)}}},render:function(){this.children.title&&this.children.title.render().appendTo(this.$el);this.children.elision&&this.children.elision.render().appendTo(this.$el);this.children.rotation&&this.children.rotation.render().appendTo(this.$el);this.children.scale&&this.children.scale.render().appendTo(this.$el);this.children.interval&&this.children.interval.render().appendTo(this.$el);this.children.min&&this.children.min.render().appendTo(this.$el);this.children.max&&this.children.max.render().appendTo(this.$el);this.children.elision&&this.handleRotation();return this},handleRotation:function(){"0"===this.model.get("display.visualizations.charting.axisLabelsX.majorLabelStyle.rotation")?this.children.elision&&this.children.elision.disable():this.children.elision&&this.children.elision.enable()}})});define("views/shared/vizcontrols/components/YAxis",["underscore","jquery","module","views/Base","views/shared/vizcontrols/custom_controls/AxisTitleControlGroup","views/shared/vizcontrols/custom_controls/AxisScaleControlGroup","views/shared/vizcontrols/custom_controls/AxisIntervalControlGroup","views/shared/vizcontrols/custom_controls/AxisMinValueControlGroup","views/shared/vizcontrols/custom_controls/AxisMaxValueControlGroup"],function(_,$,module,Base,AxisTitleControlGroup,AxisScaleControlGroup,AxisIntervalControlGroup,AxisMinValueControlGroup,AxisMaxValueControlGroup){return Base.extend({moduleId:module.id,className:"form form-horizontal",vizToYAxisComponents:{line:["title","scale","interval","min","max"],bar:["title","scale","interval","min","max"],area:["title","scale","interval","min","max"],column:["title","scale","interval","min","max"],scatter:["title","scale","interval","min","max"],pie:[],radialGauge:[],fillerGauge:[],markerGauge:[],single:[],events:[],statistics:[]},initialize:function(){Base.prototype.initialize.apply(this,arguments);var controls=this.vizToYAxisComponents[this.model.get("viz_type")];_.indexOf(controls,"title")>-1&&(this.children.title=new AxisTitleControlGroup({className:"y-axis-title control-group",model:this.model,axisType:AxisTitleControlGroup.Y_AXIS}));_.indexOf(controls,"scale")>-1&&(this.children.scale=new AxisScaleControlGroup({model:this.model,className:"scale control-group",controlClass:"controls-halfblock",axisType:AxisScaleControlGroup.Y_AXIS}));_.indexOf(controls,"interval")>-1&&(this.children.interval=new AxisIntervalControlGroup({model:this.model,controlClass:"controls-block",axisType:AxisIntervalControlGroup.Y_AXIS}));_.indexOf(controls,"min")>-1&&(this.children.min=new AxisMinValueControlGroup({model:this.model,controlClass:"controls-block",axisType:AxisMinValueControlGroup.Y_AXIS}));_.indexOf(controls,"max")>-1&&(this.children.max=new AxisMaxValueControlGroup({model:this.model,controlClass:"controls-block",axisType:AxisMaxValueControlGroup.Y_AXIS}));"log"==this.model.get("display.visualizations.charting.axisY.scale")&&this.children.interval&&this.children.interval.$el.hide()
},events:{"click .scale button":function(e){this.intervalVal=this.intervalVal||this.model.get("display.visualizations.charting.axisLabelsY.majorUnit");if("log"==$(e.currentTarget).data("value")){this.children.interval&&this.children.interval.$el.hide();this.model.set("display.visualizations.charting.axisLabelsY.majorUnit","")}else{this.children.interval&&this.children.interval.$el.show();this.model.set("display.visualizations.charting.axisLabelsY.majorUnit",this.intervalVal)}}},render:function(){this.children.title&&this.children.title.render().appendTo(this.$el);this.children.scale&&this.children.scale.render().appendTo(this.$el);this.children.interval&&this.children.interval.render().appendTo(this.$el);this.children.min&&this.children.min.render().appendTo(this.$el);this.children.max&&this.children.max.render().appendTo(this.$el);return this}})});!function($){"undefined"==typeof $.fn.each2&&$.fn.extend({each2:function(c){for(var j=$([0]),i=-1,l=this.length;++i<l&&(j.context=j[0]=this[i])&&c.call(j[0],i,j)!==!1;);return this}})}(jQuery);!function($,undefined){function indexOf(value,array){for(var i=0,l=array.length;l>i;i+=1)if(equal(value,array[i]))return i;return-1}function equal(a,b){return a===b?!0:a===undefined||b===undefined?!1:null===a||null===b?!1:a.constructor===String?a===b+"":b.constructor===String?b===a+"":!1}function splitVal(string,separator){var val,i,l;if(null===string||string.length<1)return[];val=string.split(separator);for(i=0,l=val.length;l>i;i+=1)val[i]=$.trim(val[i]);return val}function getSideBorderPadding(element){return element.outerWidth(!1)-element.width()}function installKeyUpChangeEvent(element){var key="keyup-change-value";element.bind("keydown",function(){$.data(element,key)===undefined&&$.data(element,key,element.val())});element.bind("keyup",function(){var val=$.data(element,key);if(val!==undefined&&element.val()!==val){$.removeData(element,key);element.trigger("keyup-change")}})}function installFilteredMouseMove(element){element.bind("mousemove",function(e){var lastpos=lastMousePosition;(lastpos===undefined||lastpos.x!==e.pageX||lastpos.y!==e.pageY)&&$(e.target).trigger("mousemove-filtered",e)})}function debounce(quietMillis,fn,ctx){ctx=ctx||undefined;var timeout;return function(){var args=arguments;window.clearTimeout(timeout);timeout=window.setTimeout(function(){fn.apply(ctx,args)},quietMillis)}}function thunk(formula){var value,evaluated=!1;return function(){if(evaluated===!1){value=formula();evaluated=!0}return value}}function installDebouncedScroll(threshold,element){var notify=debounce(threshold,function(e){element.trigger("scroll-debounced",e)});element.bind("scroll",function(e){indexOf(e.target,element.get())>=0&&notify(e)})}function focus($el){$el[0]!==document.activeElement&&window.setTimeout(function(){var range,el=$el[0],pos=$el.val().length;$el.focus();if(el.setSelectionRange)el.setSelectionRange(pos,pos);else if(el.createTextRange){range=el.createTextRange();range.collapse(!0);range.moveEnd("character",pos);range.moveStart("character",pos);range.select()}},0)}function killEvent(event){event.preventDefault();event.stopPropagation()}function killEventImmediately(event){event.preventDefault();event.stopImmediatePropagation()}function measureTextWidth(e){if(!sizer){var style=e[0].currentStyle||window.getComputedStyle(e[0],null);sizer=$(document.createElement("div")).css({position:"absolute",left:"-10000px",top:"-10000px",display:"none",fontSize:style.fontSize,fontFamily:style.fontFamily,fontStyle:style.fontStyle,fontWeight:style.fontWeight,letterSpacing:style.letterSpacing,textTransform:style.textTransform,whiteSpace:"nowrap"});sizer.attr("class","select2-sizer");$("body").append(sizer)}sizer.text(e.val());return sizer.width()}function syncCssClasses(dest,src,adapter){var classes,adapted,replacements=[];classes=dest.attr("class");"string"==typeof classes&&$(classes.split(" ")).each2(function(){0===this.indexOf("select2-")&&replacements.push(this)});classes=src.attr("class");"string"==typeof classes&&$(classes.split(" ")).each2(function(){if(0!==this.indexOf("select2-")){adapted=adapter(this);"string"==typeof adapted&&adapted.length>0&&replacements.push(this)}});dest.attr("class",replacements.join(" "))}function markMatch(text,term,markup,escapeMarkup){var match=text.toUpperCase().indexOf(term.toUpperCase()),tl=term.length;if(0>match)markup.push(escapeMarkup(text));else{markup.push(escapeMarkup(text.substring(0,match)));markup.push("<span class='select2-match'>");markup.push(escapeMarkup(text.substring(match,match+tl)));markup.push("</span>");markup.push(escapeMarkup(text.substring(match+tl,text.length)))}}function ajax(options){var timeout,requestSequence=0,handler=null,quietMillis=options.quietMillis||100,ajaxUrl=options.url,self=this;return function(query){window.clearTimeout(timeout);timeout=window.setTimeout(function(){requestSequence+=1;var requestNumber=requestSequence,data=options.data,url=ajaxUrl,transport=options.transport||$.ajax,type=options.type||"GET",params={};data=data?data.call(self,query.term,query.page,query.context):null;url="function"==typeof url?url.call(self,query.term,query.page,query.context):url;null!==handler&&handler.abort();options.params&&($.isFunction(options.params)?$.extend(params,options.params.call(self)):$.extend(params,options.params));$.extend(params,{url:url,dataType:options.dataType,data:data,type:type,cache:!1,success:function(data){if(!(requestSequence>requestNumber)){var results=options.results(data,query.page);query.callback(results)}}});handler=transport.call(self,params)},quietMillis)}}function local(options){var dataText,tmp,data=options,text=function(item){return""+item.text};if($.isArray(data)){tmp=data;data={results:tmp}}if($.isFunction(data)===!1){tmp=data;data=function(){return tmp}}var dataItem=data();if(dataItem.text){text=dataItem.text;if(!$.isFunction(text)){dataText=data.text;text=function(item){return item[dataText]}}}return function(query){var process,t=query.term,filtered={results:[]};if(""!==t){process=function(datum,collection){var group,attr;datum=datum[0];if(datum.children){group={};for(attr in datum)datum.hasOwnProperty(attr)&&(group[attr]=datum[attr]);group.children=[];$(datum.children).each2(function(i,childDatum){process(childDatum,group.children)});(group.children.length||query.matcher(t,text(group),datum))&&collection.push(group)}else query.matcher(t,text(datum),datum)&&collection.push(datum)};$(data().results).each2(function(i,datum){process(datum,filtered.results)});query.callback(filtered)}else query.callback(data())}}function tags(data){var isFunc=$.isFunction(data);return function(query){var t=query.term,filtered={results:[]};$(isFunc?data():data).each(function(){var isObject=this.text!==undefined,text=isObject?this.text:this;(""===t||query.matcher(t,text))&&filtered.results.push(isObject?this:{id:this,text:this})});query.callback(filtered)}}function checkFormatter(formatter){if($.isFunction(formatter))return!0;if(!formatter)return!1;throw new Error("formatterName must be a function or a falsy value")}function evaluate(val){return $.isFunction(val)?val():val}function countResults(results){var count=0;$.each(results,function(i,item){item.children?count+=countResults(item.children):count++});return count}function defaultTokenizer(input,selection,selectCallback,opts){var token,index,i,l,separator,original=input,dupe=!1;if(!opts.createSearchChoice||!opts.tokenSeparators||opts.tokenSeparators.length<1)return undefined;for(;;){index=-1;for(i=0,l=opts.tokenSeparators.length;l>i;i++){separator=opts.tokenSeparators[i];index=input.indexOf(separator);if(index>=0)break}if(0>index)break;token=input.substring(0,index);input=input.substring(index+separator.length);if(token.length>0){token=opts.createSearchChoice(token,selection);if(token!==undefined&&null!==token&&opts.id(token)!==undefined&&null!==opts.id(token)){dupe=!1;for(i=0,l=selection.length;l>i;i++)if(equal(opts.id(token),opts.id(selection[i]))){dupe=!0;break}dupe||selectCallback(token)}}}return original!==input?input:void 0}function clazz(SuperClass,methods){var constructor=function(){};constructor.prototype=new SuperClass;constructor.prototype.constructor=constructor;constructor.prototype.parent=SuperClass.prototype;constructor.prototype=$.extend(constructor.prototype,methods);return constructor}if(window.Select2===undefined){var KEY,AbstractSelect2,SingleSelect2,MultiSelect2,nextUid,sizer,lastMousePosition,$document;KEY={TAB:9,ENTER:13,ESC:27,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,SHIFT:16,CTRL:17,ALT:18,PAGE_UP:33,PAGE_DOWN:34,HOME:36,END:35,BACKSPACE:8,DELETE:46,isArrow:function(k){k=k.which?k.which:k;switch(k){case KEY.LEFT:case KEY.RIGHT:case KEY.UP:case KEY.DOWN:return!0}return!1},isControl:function(e){var k=e.which;switch(k){case KEY.SHIFT:case KEY.CTRL:case KEY.ALT:return!0}return e.metaKey?!0:!1},isFunctionKey:function(k){k=k.which?k.which:k;return k>=112&&123>=k}};$document=$(document);nextUid=function(){var counter=1;return function(){return counter++}}();$document.bind("mousemove",function(e){lastMousePosition={x:e.pageX,y:e.pageY}});AbstractSelect2=clazz(Object,{bind:function(func){var self=this;return function(){func.apply(self,arguments)}},init:function(opts){var results,search,resultsSelector=".select2-results";this.opts=opts=this.prepareOpts(opts);this.id=opts.id;opts.element.data("select2")!==undefined&&null!==opts.element.data("select2")&&this.destroy();this.enabled=!0;this.container=this.createContainer();this.containerId="s2id_"+(opts.element.attr("id")||"autogen"+nextUid());this.containerSelector="#"+this.containerId.replace(/([;&,\.\+\*\~':"\!\^#$%@\[\]\(\)=>\|])/g,"\\$1");this.container.attr("id",this.containerId);this.body=thunk(function(){return opts.element.closest("body")});syncCssClasses(this.container,this.opts.element,this.opts.adaptContainerCssClass);this.container.css(evaluate(opts.containerCss));this.container.addClass(evaluate(opts.containerCssClass));this.elementTabIndex=this.opts.element.attr("tabIndex");this.opts.element.data("select2",this).addClass("select2-offscreen").bind("focus.select2",function(){$(this).select2("focus")}).attr("tabIndex","-1").before(this.container);this.container.data("select2",this);this.dropdown=this.container.find(".select2-drop");this.dropdown.addClass(evaluate(opts.dropdownCssClass));this.dropdown.data("select2",this);this.results=results=this.container.find(resultsSelector);this.search=search=this.container.find("input.select2-input");search.attr("tabIndex",this.elementTabIndex);this.resultsPage=0;this.context=null;this.initContainer();installFilteredMouseMove(this.results);this.dropdown.delegate(resultsSelector,"mousemove-filtered touchstart touchmove touchend",this.bind(this.highlightUnderEvent));installDebouncedScroll(80,this.results);this.dropdown.delegate(resultsSelector,"scroll-debounced",this.bind(this.loadMoreIfNeeded));$.fn.mousewheel&&results.mousewheel(function(e,delta,deltaX,deltaY){var top=results.scrollTop();if(deltaY>0&&0>=top-deltaY){results.scrollTop(0);killEvent(e)}else if(0>deltaY&&results.get(0).scrollHeight-results.scrollTop()+deltaY<=results.height()){results.scrollTop(results.get(0).scrollHeight-results.height());killEvent(e)}});installKeyUpChangeEvent(search);search.bind("keyup-change input paste",this.bind(this.updateResults));search.bind("focus",function(){search.addClass("select2-focused")});search.bind("blur",function(){search.removeClass("select2-focused")});this.dropdown.delegate(resultsSelector,"mouseup",this.bind(function(e){if($(e.target).closest(".select2-result-selectable").length>0){this.highlightUnderEvent(e);this.selectHighlighted(e)}}));this.dropdown.bind("click mouseup mousedown",function(e){e.stopPropagation()});if($.isFunction(this.opts.initSelection)){this.initSelection();this.monitorSource()}(opts.element.is(":disabled")||opts.element.is("[readonly='readonly']"))&&this.disable()},destroy:function(){var select2=this.opts.element.data("select2");if(this.propertyObserver){delete this.propertyObserver;this.propertyObserver=null}if(select2!==undefined){select2.container.remove();select2.dropdown.remove();select2.opts.element.removeClass("select2-offscreen").removeData("select2").unbind(".select2").attr({tabIndex:this.elementTabIndex}).show()}},prepareOpts:function(opts){var element,select,idKey,ajaxUrl;element=opts.element;"select"===element.get(0).tagName.toLowerCase()&&(this.select=select=opts.element);select&&$.each(["id","multiple","ajax","query","createSearchChoice","initSelection","data","tags"],function(){if(this in opts)throw new Error("Option '"+this+"' is not allowed for Select2 when attached to a <select> element.")});opts=$.extend({},{populateResults:function(container,results,query){var populate,id=this.opts.id,self=this;populate=function(results,container,depth){var i,l,result,selectable,disabled,compound,node,label,innerContainer,formatted;results=opts.sortResults(results,container,query);for(i=0,l=results.length;l>i;i+=1){result=results[i];disabled=result.disabled===!0;selectable=!disabled&&id(result)!==undefined;compound=result.children&&result.children.length>0;node=$("<li></li>");node.addClass("select2-results-dept-"+depth);node.addClass("select2-result");node.addClass(selectable?"select2-result-selectable":"select2-result-unselectable");disabled&&node.addClass("select2-disabled");compound&&node.addClass("select2-result-with-children");node.addClass(self.opts.formatResultCssClass(result));label=$(document.createElement("div"));label.addClass("select2-result-label");formatted=opts.formatResult(result,label,query,self.opts.escapeMarkup);formatted!==undefined&&label.html(formatted);node.append(label);if(compound){innerContainer=$("<ul></ul>");innerContainer.addClass("select2-result-sub");populate(result.children,innerContainer,depth+1);node.append(innerContainer)}node.data("select2-data",result);container.append(node)}};populate(results,container,0)}},$.fn.select2.defaults,opts);if("function"!=typeof opts.id){idKey=opts.id;opts.id=function(e){return e[idKey]}}if($.isArray(opts.element.data("select2Tags"))){if("tags"in opts)throw"tags specified as both an attribute 'data-select2-tags' and in options of Select2 "+opts.element.attr("id");opts.tags=opts.element.attr("data-select2-tags")}if(select){opts.query=this.bind(function(query){var children,firstChild,process,data={results:[],more:!1},term=query.term;process=function(element,collection){var group;if(element.is("option"))query.matcher(term,element.text(),element)&&collection.push({id:element.attr("value"),text:element.text(),element:element.get(),css:element.attr("class"),disabled:equal(element.attr("disabled"),"disabled")});else if(element.is("optgroup")){group={text:element.attr("label"),children:[],element:element.get(),css:element.attr("class")};element.children().each2(function(i,elm){process(elm,group.children)});group.children.length>0&&collection.push(group)}};children=element.children();if(this.getPlaceholder()!==undefined&&children.length>0){firstChild=children[0];""===$(firstChild).text()&&(children=children.not(firstChild))}children.each2(function(i,elm){process(elm,data.results)});query.callback(data)});opts.id=function(e){return e.id};opts.formatResultCssClass=function(data){return data.css}}else if(!("query"in opts))if("ajax"in opts){ajaxUrl=opts.element.data("ajax-url");ajaxUrl&&ajaxUrl.length>0&&(opts.ajax.url=ajaxUrl);opts.query=ajax.call(opts.element,opts.ajax)}else if("data"in opts)opts.query=local(opts.data);else if("tags"in opts){opts.query=tags(opts.tags);opts.createSearchChoice===undefined&&(opts.createSearchChoice=function(term){return{id:term,text:term}});opts.initSelection===undefined&&(opts.initSelection=function(element,callback){var data=[];$(splitVal(element.val(),opts.separator)).each(function(){var id=this,text=this,tags=opts.tags;$.isFunction(tags)&&(tags=tags());$(tags).each(function(){if(equal(this.id,id)){text=this.text;return!1}});data.push({id:id,text:text})});callback(data)})}if("function"!=typeof opts.query)throw"query function not defined for Select2 "+opts.element.attr("id");return opts},monitorSource:function(){var sync,el=this.opts.element;el.bind("change.select2",this.bind(function(){this.opts.element.data("select2-change-triggered")!==!0&&this.initSelection()}));sync=this.bind(function(){var enabled,readonly;enabled="disabled"!==this.opts.element.attr("disabled");readonly="readonly"===this.opts.element.attr("readonly");enabled=enabled&&!readonly;this.enabled!==enabled&&(enabled?this.enable():this.disable());syncCssClasses(this.container,this.opts.element,this.opts.adaptContainerCssClass);this.container.addClass(evaluate(this.opts.containerCssClass));syncCssClasses(this.dropdown,this.opts.element,this.opts.adaptDropdownCssClass);this.dropdown.addClass(evaluate(this.opts.dropdownCssClass))});el.bind("propertychange.select2 DOMAttrModified.select2",sync);if("undefined"!=typeof WebKitMutationObserver){if(this.propertyObserver){delete this.propertyObserver;this.propertyObserver=null}this.propertyObserver=new WebKitMutationObserver(function(mutations){mutations.forEach(sync)});this.propertyObserver.observe(el.get(0),{attributes:!0,subtree:!1})}},triggerChange:function(details){details=details||{};details=$.extend({},details,{type:"change",val:this.val()});this.opts.element.data("select2-change-triggered",!0);this.opts.element.trigger(details);this.opts.element.data("select2-change-triggered",!1);this.opts.element.click();this.opts.blurOnChange&&this.opts.element.blur()},enable:function(){if(!this.enabled){this.enabled=!0;this.container.removeClass("select2-container-disabled");this.opts.element.removeAttr("disabled")}},disable:function(){if(this.enabled){this.close();this.enabled=!1;this.container.addClass("select2-container-disabled");this.opts.element.attr("disabled","disabled")}},opened:function(){return this.container.hasClass("select2-dropdown-open")},positionDropdown:function(){var bodyOffset,above,css,offset=this.container.offset(),height=this.container.outerHeight(!1),width=this.container.outerWidth(!1),dropHeight=this.dropdown.outerHeight(!1),viewPortRight=$(window).scrollLeft()+$(window).width(),viewportBottom=$(window).scrollTop()+$(window).height(),dropTop=offset.top+height,dropLeft=offset.left,enoughRoomBelow=viewportBottom>=dropTop+dropHeight,enoughRoomAbove=offset.top-dropHeight>=this.body().scrollTop(),dropWidth=this.dropdown.outerWidth(!1),enoughRoomOnRight=viewPortRight>=dropLeft+dropWidth,aboveNow=this.dropdown.hasClass("select2-drop-above");if("static"!==this.body().css("position")){bodyOffset=this.body().offset();dropTop-=bodyOffset.top;dropLeft-=bodyOffset.left}if(aboveNow){above=!0;!enoughRoomAbove&&enoughRoomBelow&&(above=!1)}else{above=!1;!enoughRoomBelow&&enoughRoomAbove&&(above=!0)}enoughRoomOnRight||(dropLeft=offset.left+width-dropWidth);if(above){dropTop=offset.top-dropHeight;this.container.addClass("select2-drop-above");this.dropdown.addClass("select2-drop-above")}else{this.container.removeClass("select2-drop-above");this.dropdown.removeClass("select2-drop-above")}css=$.extend({top:dropTop,left:dropLeft,width:width},evaluate(this.opts.dropdownCss));this.dropdown.css(css)},shouldOpen:function(){var event;if(this.opened())return!1;event=$.Event("opening");this.opts.element.trigger(event);return!event.isDefaultPrevented()},clearDropdownAlignmentPreference:function(){this.container.removeClass("select2-drop-above");this.dropdown.removeClass("select2-drop-above")},open:function(){if(!this.shouldOpen())return!1;window.setTimeout(this.bind(this.opening),1);return!0},opening:function(){var mask,cid=this.containerId,scroll="scroll."+cid,resize="resize."+cid,orient="orientationchange."+cid;this.clearDropdownAlignmentPreference();this.container.addClass("select2-dropdown-open").addClass("select2-container-active");this.dropdown[0]!==this.body().children().last()[0]&&this.dropdown.detach().appendTo(this.body());this.updateResults(!0);mask=$("#select2-drop-mask");if(0==mask.length){mask=$(document.createElement("div"));mask.attr("id","select2-drop-mask").attr("class","select2-drop-mask");mask.hide();mask.appendTo(this.body());mask.bind("mousedown touchstart",function(){var self,dropdown=$("#select2-drop");if(dropdown.length>0){self=dropdown.data("select2");self.opts.selectOnBlur&&self.selectHighlighted({noFocus:!0});self.close()}})}this.dropdown.prev()[0]!==mask[0]&&this.dropdown.before(mask);$("#select2-drop").removeAttr("id");this.dropdown.attr("id","select2-drop");mask.css({width:document.documentElement.scrollWidth,height:document.documentElement.scrollHeight});mask.show();this.dropdown.show();this.positionDropdown();this.dropdown.addClass("select2-drop-active");this.ensureHighlightVisible();var that=this;this.container.parents().add(window).each(function(){$(this).bind(resize+" "+scroll+" "+orient,function(){$("#select2-drop-mask").css({width:document.documentElement.scrollWidth,height:document.documentElement.scrollHeight});that.positionDropdown()})});this.focusSearch()},close:function(){if(this.opened()){var cid=this.containerId,scroll="scroll."+cid,resize="resize."+cid,orient="orientationchange."+cid;this.container.parents().add(window).each(function(){$(this).unbind(scroll).unbind(resize).unbind(orient)});this.clearDropdownAlignmentPreference();$("#select2-drop-mask").hide();this.dropdown.removeAttr("id");this.dropdown.hide();this.container.removeClass("select2-dropdown-open");this.results.empty();this.clearSearch();this.opts.element.trigger($.Event("close"))}},clearSearch:function(){},getMaximumSelectionSize:function(){return evaluate(this.opts.maximumSelectionSize)},ensureHighlightVisible:function(){var children,index,child,hb,rb,y,more,results=this.results;index=this.highlight();if(!(0>index))if(0!=index){children=this.findHighlightableChoices();child=$(children[index]);hb=child.offset().top+child.outerHeight(!0);if(index===children.length-1){more=results.find("li.select2-more-results");more.length>0&&(hb=more.offset().top+more.outerHeight(!0))}rb=results.offset().top+results.outerHeight(!0);hb>rb&&results.scrollTop(results.scrollTop()+(hb-rb));y=child.offset().top-results.offset().top;0>y&&"none"!=child.css("display")&&results.scrollTop(results.scrollTop()+y)}else results.scrollTop(0)},findHighlightableChoices:function(){this.results.find(".select2-result-selectable:not(.select2-selected):not(.select2-disabled)");return this.results.find(".select2-result-selectable:not(.select2-selected):not(.select2-disabled)")},moveHighlight:function(delta){for(var choices=this.findHighlightableChoices(),index=this.highlight();index>-1&&index<choices.length;){index+=delta;var choice=$(choices[index]);if(choice.hasClass("select2-result-selectable")&&!choice.hasClass("select2-disabled")&&!choice.hasClass("select2-selected")){this.highlight(index);break}}},highlight:function(index){var choice,data,choices=this.findHighlightableChoices();if(0===arguments.length)return indexOf(choices.filter(".select2-highlighted")[0],choices.get());index>=choices.length&&(index=choices.length-1);0>index&&(index=0);this.results.find(".select2-highlighted").removeClass("select2-highlighted");choice=$(choices[index]);choice.addClass("select2-highlighted");this.ensureHighlightVisible();data=choice.data("select2-data");data&&this.opts.element.trigger({type:"highlight",val:this.id(data),choice:data})},countSelectableResults:function(){return this.findHighlightableChoices().length},highlightUnderEvent:function(event){var el=$(event.target).closest(".select2-result-selectable");if(el.length>0&&!el.is(".select2-highlighted")){var choices=this.findHighlightableChoices();this.highlight(choices.index(el))}else 0==el.length&&this.results.find(".select2-highlighted").removeClass("select2-highlighted")},loadMoreIfNeeded:function(){var below,results=this.results,more=results.find("li.select2-more-results"),page=this.resultsPage+1,self=this,term=this.search.val(),context=this.context;if(0!==more.length){below=more.offset().top-results.offset().top-results.height();if(below<=this.opts.loadMorePadding){more.addClass("select2-active");this.opts.query({element:this.opts.element,term:term,page:page,context:context,matcher:this.opts.matcher,callback:this.bind(function(data){if(self.opened()){self.opts.populateResults.call(this,results,data.results,{term:term,page:page,context:context});if(data.more===!0){more.detach().appendTo(results).text(self.opts.formatLoadMore(page+1));window.setTimeout(function(){self.loadMoreIfNeeded()},10)}else more.remove();self.positionDropdown();self.resultsPage=page;self.context=data.context}})})}}},tokenize:function(){},updateResults:function(initial){function postRender(){results.scrollTop(0);search.removeClass("select2-active");self.positionDropdown()}function render(html){results.html(html);postRender()}var data,input,search=this.search,results=this.results,opts=this.opts,self=this;if(initial===!0||this.showSearchInput!==!1&&this.opened()){search.addClass("select2-active");var maxSelSize=this.getMaximumSelectionSize();if(maxSelSize>=1){data=this.data();if($.isArray(data)&&data.length>=maxSelSize&&checkFormatter(opts.formatSelectionTooBig,"formatSelectionTooBig")){render("<li class='select2-selection-limit'>"+opts.formatSelectionTooBig(maxSelSize)+"</li>");return}}if(search.val().length<opts.minimumInputLength)render(checkFormatter(opts.formatInputTooShort,"formatInputTooShort")?"<li class='select2-no-results'>"+opts.formatInputTooShort(search.val(),opts.minimumInputLength)+"</li>":"");else{opts.formatSearching()&&initial===!0&&render("<li class='select2-searching'>"+opts.formatSearching()+"</li>");if(opts.maximumInputLength&&search.val().length>opts.maximumInputLength)render(checkFormatter(opts.formatInputTooLong,"formatInputTooLong")?"<li class='select2-no-results'>"+opts.formatInputTooLong(search.val(),opts.maximumInputLength)+"</li>":"");else{input=this.tokenize();input!=undefined&&null!=input&&search.val(input);this.resultsPage=1;opts.query({element:opts.element,term:search.val(),page:this.resultsPage,context:null,matcher:opts.matcher,callback:this.bind(function(data){var def;if(this.opened()){this.context=data.context===undefined?null:data.context;if(this.opts.createSearchChoice&&""!==search.val()){def=this.opts.createSearchChoice.call(null,search.val(),data.results);def!==undefined&&null!==def&&self.id(def)!==undefined&&null!==self.id(def)&&0===$(data.results).filter(function(){return equal(self.id(this),self.id(def))}).length&&data.results.unshift(def)}if(0===data.results.length&&checkFormatter(opts.formatNoMatches,"formatNoMatches"))render("<li class='select2-no-results'>"+opts.formatNoMatches(search.val())+"</li>");else{results.empty();self.opts.populateResults.call(this,results,data.results,{term:search.val(),page:this.resultsPage,context:null});if(data.more===!0&&checkFormatter(opts.formatLoadMore,"formatLoadMore")){results.append("<li class='select2-more-results'>"+self.opts.escapeMarkup(opts.formatLoadMore(this.resultsPage))+"</li>");window.setTimeout(function(){self.loadMoreIfNeeded()},10)}this.postprocessResults(data,initial);postRender()}}})})}}}},cancel:function(){this.close()},blur:function(){this.opts.selectOnBlur&&this.selectHighlighted({noFocus:!0});this.close();this.container.removeClass("select2-container-active");this.search[0]===document.activeElement&&this.search.blur();this.clearSearch();this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus")},focusSearch:function(){focus(this.search)},selectHighlighted:function(options){var index=this.highlight(),highlighted=this.results.find(".select2-highlighted"),data=highlighted.closest(".select2-result").data("select2-data");if(data){this.highlight(index);this.onSelect(data,options)}},getPlaceholder:function(){return this.opts.element.attr("placeholder")||this.opts.element.attr("data-placeholder")||this.opts.element.data("placeholder")||this.opts.placeholder},initContainerWidth:function(){function resolveContainerWidth(){var style,attrs,matches,i,l;if("off"===this.opts.width)return null;if("element"===this.opts.width)return 0===this.opts.element.outerWidth(!1)?"auto":this.opts.element.outerWidth(!1)+"px";if("copy"===this.opts.width||"resolve"===this.opts.width){style=this.opts.element.attr("style");if(style!==undefined){attrs=style.split(";");for(i=0,l=attrs.length;l>i;i+=1){matches=attrs[i].replace(/\s/g,"").match(/width:(([-+]?([0-9]*\.)?[0-9]+)(px|em|ex|%|in|cm|mm|pt|pc))/);if(null!==matches&&matches.length>=1)return matches[1]}}if("resolve"===this.opts.width){style=this.opts.element.css("width");return style.indexOf("%")>0?style:0===this.opts.element.outerWidth(!1)?"auto":this.opts.element.outerWidth(!1)+"px"}return null}return $.isFunction(this.opts.width)?this.opts.width():this.opts.width}var width=resolveContainerWidth.call(this);null!==width&&this.container.css("width",width)}});SingleSelect2=clazz(AbstractSelect2,{createContainer:function(){var container=$(document.createElement("div")).attr({"class":"select2-container"}).html(["<a href='javascript:void(0)' onclick='return false;' class='select2-choice' tabindex='-1'>","   <span></span><abbr class='select2-search-choice-close' style='display:none;'></abbr>","   <div><b></b></div>","</a>","<input class='select2-focusser select2-offscreen' type='text'/>","<div class='select2-drop' style='display:none'>","   <div class='select2-search'>","       <input type='text' autocomplete='off' class='select2-input'/>","   </div>","   <ul class='select2-results'>","   </ul>","</div>"].join(""));return container},disable:function(){if(this.enabled){this.parent.disable.apply(this,arguments);this.focusser.attr("disabled","disabled")}},enable:function(){if(!this.enabled){this.parent.enable.apply(this,arguments);this.focusser.removeAttr("disabled")}},opening:function(){this.parent.opening.apply(this,arguments);this.focusser.attr("disabled","disabled");this.opts.element.trigger($.Event("open"))},close:function(){if(this.opened()){this.parent.close.apply(this,arguments);this.focusser.removeAttr("disabled");focus(this.focusser)}},focus:function(){if(this.opened())this.close();else{this.focusser.removeAttr("disabled");this.focusser.focus()}},isFocused:function(){return this.container.hasClass("select2-container-active")},cancel:function(){this.parent.cancel.apply(this,arguments);this.focusser.removeAttr("disabled");this.focusser.focus()},initContainer:function(){var selection,container=this.container,dropdown=this.dropdown,clickingInside=!1;this.showSearch(this.opts.minimumResultsForSearch>=0);this.selection=selection=container.find(".select2-choice");this.focusser=container.find(".select2-focusser");this.search.bind("keydown",this.bind(function(e){if(this.enabled)if(e.which!==KEY.PAGE_UP&&e.which!==KEY.PAGE_DOWN)switch(e.which){case KEY.UP:case KEY.DOWN:this.moveHighlight(e.which===KEY.UP?-1:1);killEvent(e);return;case KEY.TAB:case KEY.ENTER:this.selectHighlighted();killEvent(e);return;case KEY.ESC:this.cancel(e);killEvent(e);return}else killEvent(e)}));this.focusser.bind("keydown",this.bind(function(e){if(this.enabled&&e.which!==KEY.TAB&&!KEY.isControl(e)&&!KEY.isFunctionKey(e)&&e.which!==KEY.ESC)if(this.opts.openOnEnter!==!1||e.which!==KEY.ENTER)if(e.which==KEY.DOWN||e.which==KEY.UP||e.which==KEY.ENTER&&this.opts.openOnEnter){this.open();killEvent(e)}else if(e.which!=KEY.DELETE&&e.which!=KEY.BACKSPACE);else{this.opts.allowClear&&this.clear();killEvent(e)}else killEvent(e)}));installKeyUpChangeEvent(this.focusser);this.focusser.bind("keyup-change input",this.bind(function(e){if(!this.opened()){this.open();this.showSearchInput!==!1&&this.search.val(this.focusser.val());this.focusser.val("");killEvent(e)}}));selection.delegate("abbr","mousedown",this.bind(function(e){if(this.enabled){this.clear();killEventImmediately(e);this.close();this.selection.focus()}}));selection.bind("mousedown",this.bind(function(e){clickingInside=!0;this.opened()?this.close():this.enabled&&this.open();killEvent(e);clickingInside=!1}));dropdown.bind("mousedown",this.bind(function(){this.search.focus()
}));selection.bind("focus",this.bind(function(e){killEvent(e)}));this.focusser.bind("focus",this.bind(function(){this.container.addClass("select2-container-active")})).bind("blur",this.bind(function(){this.opened()||this.container.removeClass("select2-container-active")}));this.search.bind("focus",this.bind(function(){this.container.addClass("select2-container-active")}));this.initContainerWidth();this.setPlaceholder()},clear:function(){var data=this.selection.data("select2-data");this.opts.element.val("");this.selection.find("span").empty();this.selection.removeData("select2-data");this.setPlaceholder();this.opts.element.trigger({type:"removed",val:this.id(data),choice:data});this.triggerChange({removed:data})},initSelection:function(){if(""===this.opts.element.val()&&""===this.opts.element.text()){this.close();this.setPlaceholder()}else{var self=this;this.opts.initSelection.call(null,this.opts.element,function(selected){if(selected!==undefined&&null!==selected){self.updateSelection(selected);self.close();self.setPlaceholder()}})}},prepareOpts:function(){var opts=this.parent.prepareOpts.apply(this,arguments);"select"===opts.element.get(0).tagName.toLowerCase()?opts.initSelection=function(element,callback){var selected=element.find(":selected");$.isFunction(callback)&&callback({id:selected.attr("value"),text:selected.text(),element:selected})}:"data"in opts&&(opts.initSelection=opts.initSelection||function(element,callback){var id=element.val();opts.query({matcher:function(term,text,el){return equal(id,opts.id(el))},callback:$.isFunction(callback)?function(filtered){callback(filtered.results.length?filtered.results[0]:null)}:$.noop})});return opts},getPlaceholder:function(){return this.select&&""!==this.select.find("option").first().text()?undefined:this.parent.getPlaceholder.apply(this,arguments)},setPlaceholder:function(){var placeholder=this.getPlaceholder();if(""===this.opts.element.val()&&placeholder!==undefined){if(this.select&&""!==this.select.find("option:first").text())return;this.selection.find("span").html(this.opts.escapeMarkup(placeholder));this.selection.addClass("select2-default");this.selection.find("abbr").hide()}},postprocessResults:function(data,initial){var selected=0,self=this,showSearchInput=!0;this.findHighlightableChoices().each2(function(i,elm){if(equal(self.id(elm.data("select2-data")),self.opts.element.val())){selected=i;return!1}});this.highlight(selected);if(initial===!0){var min=this.opts.minimumResultsForSearch;showSearchInput=0>min?!1:countResults(data.results)>=min;this.showSearch(showSearchInput)}},showSearch:function(showSearchInput){this.showSearchInput=showSearchInput;this.dropdown.find(".select2-search")[showSearchInput?"removeClass":"addClass"]("select2-search-hidden");$(this.dropdown,this.container)[showSearchInput?"addClass":"removeClass"]("select2-with-searchbox")},onSelect:function(data,options){var old=this.opts.element.val();this.opts.element.val(this.id(data));this.updateSelection(data);this.opts.element.trigger({type:"selected",val:this.id(data),choice:data});this.close();options&&options.noFocus||this.selection.focus();equal(old,this.id(data))||this.triggerChange()},updateSelection:function(data){var formatted,container=this.selection.find("span");this.selection.data("select2-data",data);container.empty();formatted=this.opts.formatSelection(data,container);formatted!==undefined&&container.append(this.opts.escapeMarkup(formatted));this.selection.removeClass("select2-default");this.opts.allowClear&&this.getPlaceholder()!==undefined&&this.selection.find("abbr").show()},val:function(){var val,triggerChange=!1,data=null,self=this;if(0===arguments.length)return this.opts.element.val();val=arguments[0];arguments.length>1&&(triggerChange=arguments[1]);if(this.select){this.select.val(val).find(":selected").each2(function(i,elm){data={id:elm.attr("value"),text:elm.text()};return!1});this.updateSelection(data);this.setPlaceholder();triggerChange&&this.triggerChange()}else{if(this.opts.initSelection===undefined)throw new Error("cannot call val() if initSelection() is not defined");if(!val&&0!==val){this.clear();triggerChange&&this.triggerChange();return}this.opts.element.val(val);this.opts.initSelection(this.opts.element,function(data){self.opts.element.val(data?self.id(data):"");self.updateSelection(data);self.setPlaceholder();triggerChange&&self.triggerChange()})}},clearSearch:function(){this.search.val("");this.focusser.val("")},data:function(value){var data;if(0===arguments.length){data=this.selection.data("select2-data");data==undefined&&(data=null);return data}if(value&&""!==value){this.opts.element.val(value?this.id(value):"");this.updateSelection(value)}else this.clear()}});MultiSelect2=clazz(AbstractSelect2,{createContainer:function(){var container=$(document.createElement("div")).attr({"class":"select2-container select2-container-multi"}).html(["    <ul class='select2-choices'>","  <li class='select2-search-field'>","    <input type='text' autocomplete='off' class='select2-input'>","  </li>","</ul>","<div class='select2-drop select2-drop-multi' style='display:none;'>","   <ul class='select2-results'>","   </ul>","</div>"].join(""));return container},prepareOpts:function(){var opts=this.parent.prepareOpts.apply(this,arguments);"select"===opts.element.get(0).tagName.toLowerCase()?opts.initSelection=function(element,callback){var data=[];element.find(":selected").each2(function(i,elm){data.push({id:elm.attr("value"),text:elm.text(),element:elm[0]})});callback(data)}:"data"in opts&&(opts.initSelection=opts.initSelection||function(element,callback){var ids=splitVal(element.val(),opts.separator);opts.query({matcher:function(term,text,el){return $.grep(ids,function(id){return equal(id,opts.id(el))}).length},callback:$.isFunction(callback)?function(filtered){callback(filtered.results)}:$.noop})});return opts},initContainer:function(){var selection,selector=".select2-choices";this.searchContainer=this.container.find(".select2-search-field");this.selection=selection=this.container.find(selector);this.search.bind("input paste",this.bind(function(){this.enabled&&(this.opened()||this.open())}));this.search.bind("keydown",this.bind(function(e){if(this.enabled){if(e.which===KEY.BACKSPACE&&""===this.search.val()){this.close();var choices,selected=selection.find(".select2-search-choice-focus");if(selected.length>0){this.unselect(selected.first());this.search.width(10);killEvent(e);return}choices=selection.find(".select2-search-choice:not(.select2-locked)");choices.length>0&&choices.last().addClass("select2-search-choice-focus")}else selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus");if(this.opened())switch(e.which){case KEY.UP:case KEY.DOWN:this.moveHighlight(e.which===KEY.UP?-1:1);killEvent(e);return;case KEY.ENTER:case KEY.TAB:this.selectHighlighted();killEvent(e);return;case KEY.ESC:this.cancel(e);killEvent(e);return}if(e.which!==KEY.TAB&&!KEY.isControl(e)&&!KEY.isFunctionKey(e)&&e.which!==KEY.BACKSPACE&&e.which!==KEY.ESC){if(e.which===KEY.ENTER){if(this.opts.openOnEnter===!1)return;if(e.altKey||e.ctrlKey||e.shiftKey||e.metaKey)return}this.open();(e.which===KEY.PAGE_UP||e.which===KEY.PAGE_DOWN)&&killEvent(e)}}}));this.search.bind("keyup",this.bind(this.resizeSearch));this.search.bind("blur",this.bind(function(e){this.container.removeClass("select2-container-active");this.search.removeClass("select2-focused");this.opened()||this.clearSearch();e.stopImmediatePropagation()}));this.container.delegate(selector,"mousedown",this.bind(function(e){if(this.enabled&&!($(e.target).closest(".select2-search-choice").length>0)){this.clearPlaceholder();this.open();this.focusSearch();e.preventDefault()}}));this.container.delegate(selector,"focus",this.bind(function(){if(this.enabled){this.container.addClass("select2-container-active");this.dropdown.addClass("select2-drop-active");this.clearPlaceholder()}}));this.initContainerWidth();this.clearSearch()},enable:function(){if(!this.enabled){this.parent.enable.apply(this,arguments);this.search.removeAttr("disabled")}},disable:function(){if(this.enabled){this.parent.disable.apply(this,arguments);this.search.attr("disabled",!0)}},initSelection:function(){if(""===this.opts.element.val()&&""===this.opts.element.text()){this.updateSelection([]);this.close();this.clearSearch()}if(this.select||""!==this.opts.element.val()){var self=this;this.opts.initSelection.call(null,this.opts.element,function(data){if(data!==undefined&&null!==data){self.updateSelection(data);self.close();self.clearSearch()}})}},clearSearch:function(){var placeholder=this.getPlaceholder();if(placeholder!==undefined&&0===this.getVal().length&&this.search.hasClass("select2-focused")===!1){this.search.val(placeholder).addClass("select2-default");this.resizeSearch()}else this.search.val("").width(10)},clearPlaceholder:function(){this.search.hasClass("select2-default")&&this.search.val("").removeClass("select2-default")},opening:function(){this.parent.opening.apply(this,arguments);this.clearPlaceholder();this.resizeSearch();this.focusSearch();this.opts.element.trigger($.Event("open"))},close:function(){this.opened()&&this.parent.close.apply(this,arguments)},focus:function(){this.close();this.search.focus();this.opts.element.triggerHandler("focus")},isFocused:function(){return this.search.hasClass("select2-focused")},updateSelection:function(data){var ids=[],filtered=[],self=this;$(data).each(function(){if(indexOf(self.id(this),ids)<0){ids.push(self.id(this));filtered.push(this)}});data=filtered;this.selection.find(".select2-search-choice").remove();$(data).each(function(){self.addSelectedChoice(this)});self.postprocessResults()},tokenize:function(){var input=this.search.val();input=this.opts.tokenizer(input,this.data(),this.bind(this.onSelect),this.opts);if(null!=input&&input!=undefined){this.search.val(input);input.length>0&&this.open()}},onSelect:function(data,options){this.addSelectedChoice(data);this.opts.element.trigger({type:"selected",val:this.id(data),choice:data});(this.select||!this.opts.closeOnSelect)&&this.postprocessResults();if(this.opts.closeOnSelect){this.close();this.search.width(10)}else if(this.countSelectableResults()>0){this.search.width(10);this.resizeSearch();this.val().length>=this.getMaximumSelectionSize()&&this.updateResults(!0);this.positionDropdown()}else{this.close();this.search.width(10)}this.triggerChange({added:data});options&&options.noFocus||this.focusSearch()},cancel:function(){this.close();this.focusSearch()},addSelectedChoice:function(data){var formatted,enableChoice=!data.locked,enabledItem=$("<li class='select2-search-choice'>    <div></div>    <a href='#' onclick='return false;' class='select2-search-choice-close' tabindex='-1'></a></li>"),disabledItem=$("<li class='select2-search-choice select2-locked'><div></div></li>"),choice=enableChoice?enabledItem:disabledItem,id=this.id(data),val=this.getVal();formatted=this.opts.formatSelection(data,choice.find("div"));formatted!=undefined&&choice.find("div").replaceWith("<div>"+this.opts.escapeMarkup(formatted)+"</div>");enableChoice&&choice.find(".select2-search-choice-close").bind("mousedown",killEvent).bind("click dblclick",this.bind(function(e){if(this.enabled){$(e.target).closest(".select2-search-choice").fadeOut("fast",this.bind(function(){this.unselect($(e.target));this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus");this.close();this.focusSearch()})).dequeue();killEvent(e)}})).bind("focus",this.bind(function(){if(this.enabled){this.container.addClass("select2-container-active");this.dropdown.addClass("select2-drop-active")}}));choice.data("select2-data",data);choice.insertBefore(this.searchContainer);val.push(id);this.setVal(val)},unselect:function(selected){var data,index,val=this.getVal();selected=selected.closest(".select2-search-choice");if(0===selected.length)throw"Invalid argument: "+selected+". Must be .select2-search-choice";data=selected.data("select2-data");if(data){index=indexOf(this.id(data),val);if(index>=0){val.splice(index,1);this.setVal(val);this.select&&this.postprocessResults()}selected.remove();this.opts.element.trigger({type:"removed",val:this.id(data),choice:data});this.triggerChange({removed:data})}},postprocessResults:function(){var val=this.getVal(),choices=this.results.find(".select2-result"),compound=this.results.find(".select2-result-with-children"),self=this;choices.each2(function(i,choice){var id=self.id(choice.data("select2-data"));if(indexOf(id,val)>=0){choice.addClass("select2-selected");choice.find(".select2-result-selectable").addClass("select2-selected")}});compound.each2(function(i,choice){choice.is(".select2-result-selectable")||0!==choice.find(".select2-result-selectable:not(.select2-selected)").length||choice.addClass("select2-selected")});-1==this.highlight()&&self.highlight(0)},resizeSearch:function(){var minimumWidth,left,maxWidth,containerLeft,searchWidth,sideBorderPadding=getSideBorderPadding(this.search);minimumWidth=measureTextWidth(this.search)+10;left=this.search.offset().left;maxWidth=this.selection.width();containerLeft=this.selection.offset().left;searchWidth=maxWidth-(left-containerLeft)-sideBorderPadding;minimumWidth>searchWidth&&(searchWidth=maxWidth-sideBorderPadding);40>searchWidth&&(searchWidth=maxWidth-sideBorderPadding);0>=searchWidth&&(searchWidth=minimumWidth);this.search.width(searchWidth)},getVal:function(){var val;if(this.select){val=this.select.val();return null===val?[]:val}val=this.opts.element.val();return splitVal(val,this.opts.separator)},setVal:function(val){var unique;if(this.select)this.select.val(val);else{unique=[];$(val).each(function(){indexOf(this,unique)<0&&unique.push(this)});this.opts.element.val(0===unique.length?"":unique.join(this.opts.separator))}},val:function(){var val,triggerChange=!1,self=this;if(0===arguments.length)return this.getVal();val=arguments[0];arguments.length>1&&(triggerChange=arguments[1]);if(val||0===val){this.setVal(val);if(this.select){this.opts.initSelection(this.select,this.bind(this.updateSelection));triggerChange&&this.triggerChange()}else{if(this.opts.initSelection===undefined)throw new Error("val() cannot be called if initSelection() is not defined");this.opts.initSelection(this.opts.element,function(data){var ids=$(data).map(self.id);self.setVal(ids);self.updateSelection(data);self.clearSearch();triggerChange&&self.triggerChange()})}this.clearSearch()}else{this.opts.element.val("");this.updateSelection([]);this.clearSearch();triggerChange&&this.triggerChange()}},onSortStart:function(){if(this.select)throw new Error("Sorting of elements is not supported when attached to <select>. Attach to <input type='hidden'/> instead.");this.search.width(0);this.searchContainer.hide()},onSortEnd:function(){var val=[],self=this;this.searchContainer.show();this.searchContainer.appendTo(this.searchContainer.parent());this.resizeSearch();this.selection.find(".select2-search-choice").each(function(){val.push(self.opts.id($(this).data("select2-data")))});this.setVal(val);this.triggerChange()},data:function(values){var ids,self=this;if(0===arguments.length)return this.selection.find(".select2-search-choice").map(function(){return $(this).data("select2-data")}).get();values||(values=[]);ids=$.map(values,function(e){return self.opts.id(e)});this.setVal(ids);this.updateSelection(values);this.clearSearch()}});$.fn.select2=function(){var opts,select2,value,multiple,args=Array.prototype.slice.call(arguments,0),allowedMethods=["val","destroy","opened","open","close","focus","isFocused","container","onSortStart","onSortEnd","enable","disable","positionDropdown","data"];this.each(function(){if(0===args.length||"object"==typeof args[0]){opts=0===args.length?{}:$.extend({},args[0]);opts.element=$(this);if("select"===opts.element.get(0).tagName.toLowerCase())multiple=opts.element.attr("multiple");else{multiple=opts.multiple||!1;"tags"in opts&&(opts.multiple=multiple=!0)}select2=multiple?new MultiSelect2:new SingleSelect2;select2.init(opts)}else{if("string"!=typeof args[0])throw"Invalid arguments to select2 plugin: "+args;if(indexOf(args[0],allowedMethods)<0)throw"Unknown method: "+args[0];value=undefined;select2=$(this).data("select2");if(select2===undefined)return;value="container"===args[0]?select2.container:select2[args[0]].apply(select2,args.slice(1));if(value!==undefined)return!1}});return value===undefined?this:value};$.fn.select2.defaults={width:"copy",loadMorePadding:0,closeOnSelect:!0,openOnEnter:!0,containerCss:{},dropdownCss:{},containerCssClass:"",dropdownCssClass:"",formatResult:function(result,container,query,escapeMarkup){var markup=[];markMatch(result.text,query.term,markup,escapeMarkup);return markup.join("")},formatSelection:function(data){return data?data.text:undefined},sortResults:function(results){return results},formatResultCssClass:function(){return undefined},formatNoMatches:function(){return"No matches found"},formatInputTooShort:function(input,min){var n=min-input.length;return"Please enter "+n+" more character"+(1==n?"":"s")},formatInputTooLong:function(input,max){var n=input.length-max;return"Please enter "+n+" less character"+(1==n?"":"s")},formatSelectionTooBig:function(limit){return"You can only select "+limit+" item"+(1==limit?"":"s")},formatLoadMore:function(){return"Loading more results..."},formatSearching:function(){return"Searching..."},minimumResultsForSearch:0,minimumInputLength:0,maximumInputLength:null,maximumSelectionSize:0,id:function(e){return e.id},matcher:function(term,text){return text.toUpperCase().indexOf(term.toUpperCase())>=0},separator:",",tokenSeparators:[],tokenizer:defaultTokenizer,escapeMarkup:function(markup){var replace_map={"\\":"&#92;","&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&apos;","/":"&#47;"};return String(markup).replace(/[&<>"'/\\]/g,function(match){return replace_map[match[0]]})},blurOnChange:!1,selectOnBlur:!1,adaptContainerCssClass:function(c){return c},adaptDropdownCssClass:function(){return null}};window.Select2={query:{ajax:ajax,local:local,tags:tags},util:{debounce:debounce,markMatch:markMatch},"class":{"abstract":AbstractSelect2,single:SingleSelect2,multi:MultiSelect2}}}}(jQuery);define("select2/select2",["jquery"],function(global){return function(){var ret;return ret||global.Select2}}(this));define("views/shared/controls/MultiInputControl",["underscore","module","views/shared/controls/Control","splunk.util","select2/select2"],function(_,module,Control,splunkUtils){var DELIMITER="::::";return Control.extend({moduleId:module.id,events:{"change input":function(e){var values=e.val||[];this.setValue(splunkUtils.fieldListToString(values),!1)}},render:function(){if(!this.el.innerHTML){this.$el.html(this.compiledTemplate({options:this.options}));var $input=this.$("input");$input.select2({placeholder:this.options.placeholder,tags:this.options.autoCompleteFields||[],formatNoMatches:function(){return"&nbsp;"},dropdownCssClass:"empty-results-allowed",separator:DELIMITER,openOnEnter:!1,initSelection:function($element,callback){var val=$element.val();if(val){var data=_(val.split(DELIMITER)).map(function(str){return{id:str,text:str}});callback(data)}else callback([])}}).select2("val",splunkUtils.stringToFieldList(this._value||"")).on("removed",function(e){var removedChoice=e.val.toString(),val=$input.val();val=_(val).isString()?val.split(DELIMITER):val;var updatedVal=_(val).without(removedChoice);$input.select2("val",updatedVal)}).on("open",function(){var val=$input.val(),$results=$input.data("select2").results;val=_(val).isString()?val.split(DELIMITER):val;$results.find(".select2-result").each(function(){var $choice=$(this),id=$choice.data("select2-data").id.toString();_(val).contains(id)&&$choice.addClass("select2-selected")})});return this}},remove:function(){this.$("input").select2("close").select2("destroy");return Control.prototype.remove.apply(this,arguments)},template:'            <input class="<%= options.inputClassName %>" />        '})});define("views/shared/vizcontrols/custom_controls/OverlayFieldsControlGroup",["underscore","module","views/shared/controls/ControlGroup","views/shared/controls/MultiInputControl"],function(_,module,ControlGroup,MultiInputControl){return ControlGroup.extend({moduleId:module.id,initialize:function(){this.options.label=_("Overlay").t();this.options.controlType="Text";var control=new MultiInputControl({modelAttribute:"display.visualizations.charting.chart.overlayFields",model:this.model.visualization,autoCompleteFields:this.model.report.entry.content.get("currentChartFields")||[],placeholder:_("type in field name(s)").t()});this.options.controls=[control];ControlGroup.prototype.initialize.call(this,this.options)}})});define("views/shared/vizcontrols/custom_controls/AxisEnabledControlGroup",["underscore","module","views/shared/controls/ControlGroup"],function(_,module,ControlGroup){return ControlGroup.extend({moduleId:module.id,initialize:function(){this.options.label=this.options.label||_("Enabled").t();this.options.controlType="SyntheticRadio";this.options.controlOptions={modelAttribute:"display.visualizations.charting."+this.options.axisType+".enabled",model:this.model,className:"btn-group",items:[{label:_("Off").t(),value:"0"},{label:_("On").t(),value:"1"}]};ControlGroup.prototype.initialize.call(this,this.options)}},{X_AXIS:"axisX",Y_AXIS:"axisY",Y_AXIS_2:"axisY2"})});define("views/shared/vizcontrols/components/ChartOverlay",["underscore","jquery","module","views/Base","views/shared/vizcontrols/custom_controls/OverlayFieldsControlGroup","views/shared/vizcontrols/custom_controls/AxisEnabledControlGroup","views/shared/vizcontrols/custom_controls/AxisTitleControlGroup","views/shared/vizcontrols/custom_controls/AxisScaleControlGroup","views/shared/vizcontrols/custom_controls/AxisIntervalControlGroup","views/shared/vizcontrols/custom_controls/AxisMinValueControlGroup","views/shared/vizcontrols/custom_controls/AxisMaxValueControlGroup","splunk.util"],function(_,$,module,Base,OverlayFieldsControlGroup,AxisEnabledControlGroup,AxisTitleControlGroup,AxisScaleControlGroup,AxisIntervalControlGroup,AxisMinValueControlGroup,AxisMaxValueControlGroup,splunkUtils){return Base.extend({moduleId:module.id,className:"form form-horizontal",vizToYAxisComponents:{line:["overlayFields","enabled","title","scale","interval","min","max"],bar:["overlayFields","enabled","title","scale","interval","min","max"],area:["overlayFields","enabled","title","scale","interval","min","max"],column:["overlayFields","enabled","title","scale","interval","min","max"],scatter:[],pie:[],radialGauge:[],fillerGauge:[],markerGauge:[],single:[],events:[],statistics:[]},initialize:function(){Base.prototype.initialize.apply(this,arguments);var controls=this.vizToYAxisComponents[this.model.visualization.get("viz_type")];_.indexOf(controls,"overlayFields")>-1&&(this.children.overlayFields=new OverlayFieldsControlGroup({model:{visualization:this.model.visualization,report:this.model.report},controlClass:"controls-block"}));_.indexOf(controls,"enabled")>-1&&(this.children.enabled=new AxisEnabledControlGroup({label:_("View as Axis").t(),model:this.model.visualization,controlClass:"controls-halfblock",axisType:AxisEnabledControlGroup.Y_AXIS_2}));_.indexOf(controls,"title")>-1&&(this.children.title=new AxisTitleControlGroup({className:"y-axis-title control-group",model:this.model.visualization,axisType:AxisTitleControlGroup.Y_AXIS_2}));_.indexOf(controls,"scale")>-1&&(this.children.scale=new AxisScaleControlGroup({model:this.model.visualization,className:"scale control-group",controlClass:"controls-thirdblock",supportInherit:!0,axisType:AxisScaleControlGroup.Y_AXIS_2}));_.indexOf(controls,"interval")>-1&&(this.children.interval=new AxisIntervalControlGroup({model:this.model.visualization,controlClass:"controls-block",axisType:AxisIntervalControlGroup.Y_AXIS_2}));_.indexOf(controls,"min")>-1&&(this.children.min=new AxisMinValueControlGroup({model:this.model.visualization,controlClass:"controls-block",axisType:AxisMinValueControlGroup.Y_AXIS_2}));_.indexOf(controls,"max")>-1&&(this.children.max=new AxisMaxValueControlGroup({model:this.model.visualization,controlClass:"controls-block",axisType:AxisMaxValueControlGroup.Y_AXIS_2}));"log"==this.model.visualization.get("display.visualizations.charting.axisY2.scale")&&this.children.interval.$el.hide();this.model.visualization.on("change:display.visualizations.charting.axisY2.enabled",this.handleSecondAxisEnabled,this);this.model.visualization.on("change:display.visualizations.charting.chart.overlayFields",this.handleOverlayFields,this)},events:{"click .scale button":function(e){this.intervalVal=this.intervalVal||this.model.visualization.get("display.visualizations.charting.axisLabelsY2.majorUnit");if("log"==$(e.currentTarget).data("value")){this.children.interval.$el.hide();this.model.visualization.set("display.visualizations.charting.axisLabelsY2.majorUnit","")}else{this.children.interval.$el.show();this.model.visualization.set("display.visualizations.charting.axisLabelsY2.majorUnit",this.intervalVal)}}},render:function(){this.children.overlayFields&&this.children.overlayFields.render().appendTo(this.$el);this.children.enabled&&this.children.enabled.render().appendTo(this.$el);this.children.title&&this.children.title.render().appendTo(this.$el);this.children.scale&&this.children.scale.render().appendTo(this.$el);this.children.interval&&this.children.interval.render().appendTo(this.$el);this.children.min&&this.children.min.render().appendTo(this.$el);this.children.max&&this.children.max.render().appendTo(this.$el);this.handleSecondAxisEnabled();this.handleOverlayFields();return this},handleSecondAxisEnabled:function(){var enabled=splunkUtils.normalizeBoolean(this.model.visualization.get("display.visualizations.charting.axisY2.enabled"));if(enabled){this.children.title.enable();this.children.scale.enable();this.children.interval.enable();this.children.min.enable();this.children.max.enable()}else{this.children.title.disable();this.children.scale.disable();this.children.interval.disable();this.children.min.disable();this.children.max.disable()}},handleOverlayFields:function(){this.model.visualization.get("display.visualizations.charting.chart.overlayFields")?this.children.enabled.enable():this.children.enabled.disable()}})});define("views/shared/vizcontrols/custom_controls/LegendPlacementControlGroup",["jquery","underscore","module","views/shared/controls/ControlGroup"],function($,_,module,ControlGroup){return ControlGroup.extend({moduleId:module.id,initialize:function(){this.options.label=this.options.label||_("Position").t();this.options.controlType="SyntheticSelect";this.options.controlOptions={modelAttribute:"display.visualizations.charting.legend.placement",model:this.model,popdownOptions:this.options.popdownOptions,items:[{label:_("Right").t(),value:"right"},{label:_("Bottom").t(),value:"bottom"},{label:_("Left").t(),value:"left"},{label:_("Top").t(),value:"top"},{label:_("None").t(),value:"none"}],toggleClassName:"btn"};ControlGroup.prototype.initialize.call(this,this.options)}})});define("views/shared/vizcontrols/custom_controls/LegendTruncationControlGroup",["underscore","module","views/shared/controls/ControlGroup"],function(_,module,ControlGroup){return ControlGroup.extend({moduleId:module.id,initialize:function(){this.options.label=this.options.label||_("Truncation").t();this.options.controlType="SyntheticRadio";this.options.controlOptions={modelAttribute:"display.visualizations.charting.legend.labelStyle.overflowMode",model:this.model,className:"btn-group",items:[{label:_("A...").t(),value:"ellipsisEnd",tooltip:_("Truncate End").t()},{label:_("A...Z").t(),value:"ellipsisMiddle",tooltip:_("Truncate Middle").t()},{label:_("...Z").t(),value:"ellipsisStart",tooltip:_("Truncate Start").t()}]};ControlGroup.prototype.initialize.call(this,this.options)}})});define("views/shared/vizcontrols/components/Legend",["underscore","jquery","module","views/Base","views/shared/vizcontrols/custom_controls/LegendPlacementControlGroup","views/shared/vizcontrols/custom_controls/LegendTruncationControlGroup"],function(_,$,module,Base,LegendPlacementControlGroup,LegendTruncationControlGroup){return Base.extend({moduleId:module.id,className:"form form-horizontal",vizToLegendComponents:{line:["placement","truncation"],bar:["placement","truncation"],area:["placement","truncation"],column:["placement","truncation"],scatter:["placement","truncation"],pie:[],radialGauge:[],fillerGauge:[],markerGauge:[],single:[],events:[],statistics:[]},initialize:function(){Base.prototype.initialize.apply(this,arguments);var controls=this.vizToLegendComponents[this.model.get("viz_type")];_.indexOf(controls,"placement")>-1&&(this.children.placement=new LegendPlacementControlGroup({model:this.model,controlClass:"controls-block"}));_.indexOf(controls,"truncation")>-1&&(this.children.truncation=new LegendTruncationControlGroup({model:this.model,controlClass:"controls-thirdblock"}))},render:function(){this.children.placement&&this.children.placement.render().appendTo(this.$el);this.children.truncation&&this.children.truncation.render().appendTo(this.$el);return this}})});define("views/shared/vizcontrols/custom_controls/GaugeAutoRangesControlGroup",["underscore","module","models/Base","views/shared/controls/ControlGroup","views/shared/controls/SyntheticRadioControl"],function(_,module,BaseModel,ControlGroup,SyntheticRadioControl){var AutoRangesControl=SyntheticRadioControl.extend({initialize:function(){this.vizModel=this.options.vizModel;this.model.set({autoMode:this.vizModel.gaugeIsInAutoMode()?"1":"0"});this.options.modelAttribute="autoMode";this.options.items=[{label:_("Automatic").t(),value:"1",tooltip:_("Uses base search to set color ranges.").t()},{label:_("Manual").t(),value:"0",tooltip:_("Manually set color ranges. Overrides search settings.").t()}];this._ranges='["0", "30", "70", "100"]';this._colors="[0x84E900, 0xFFE800, 0xBF3030]";this.model.on("change:autoMode",this.handleModeChange,this);SyntheticRadioControl.prototype.initialize.call(this,this.options)},handleModeChange:function(){var goingToAutoMode="1"===this.model.get("autoMode");if(goingToAutoMode){this._ranges=this.vizModel.get("display.visualizations.charting.chart.rangeValues");this._colors=this.vizModel.get("display.visualizations.charting.gaugeColors");this.vizModel.set({"display.visualizations.charting.chart.rangeValues":"","display.visualizations.charting.gaugeColors":""})}else this.vizModel.set({"display.visualizations.charting.chart.rangeValues":this._ranges,"display.visualizations.charting.gaugeColors":this._colors})}});return ControlGroup.extend({moduleId:module.id,initialize:function(){var rangesControl=new AutoRangesControl({model:this.model,vizModel:this.options.vizModel});this.options.controlClass="controls-halfblock";this.options.controls=[rangesControl];ControlGroup.prototype.initialize.call(this,this.options)}})});define("views/shared/vizcontrols/components/color/ColorPicker",["underscore","jquery","module","views/shared/PopTart"],function(_,$,module,PopTart){var COLORS=["#7e9f44","#ebe42d","#d13b3b","#6cb8ca","#f7912c","#956e96","#c2da8a","#fac61d","#ebb7d0","#324969","#d85e3d","#a04558"];return PopTart.extend({moduleId:module.id,className:"popdown-dialog color-picker-container",initialize:function(){PopTart.prototype.initialize.apply(this,arguments);this.clone=this.model.clone();this.on("shown",function(){this.$(".swatch").first().focus()})},events:{"click .swatch":function(e){var hashPrefixedColor=$(e.currentTarget).data().color,hexColor="0x"+hashPrefixedColor.substring(1);this.clone.set({color:hexColor});this.$(".swatch-hex input").val(hashPrefixedColor.substring(1));this.$(".big-swatch").css("background-color",hashPrefixedColor);e.preventDefault()},"click .color-picker-apply":function(e){this.model.set({color:this.clone.get("color"),shadedcolor:this.options.shadeColor(this.clone.get("color").substring(2),-40)});this.model.trigger("color-picker-apply",this.options.index);
this.hide();e.stopPropagation()},"click .color-picker-cancel":function(e){this.hide();e.stopPropagation()},"keyup .hex-input":function(e){var colorStr=$(e.currentTarget).val();this.clone.set("color","0x"+colorStr);this.$(".big-swatch").css("background-color","#"+colorStr);e.preventDefault()}},render:function(){this.$el.html(PopTart.prototype.template);this.$el.append(this._buttonTemplate);this.$(".popdown-dialog-body").addClass("color-picker-content");var $rangePickerContent=$('<div class="clearfix"></div>').appendTo(this.$(".popdown-dialog-body"));$rangePickerContent.append(this.compiledTemplate({model:this.clone,colors:COLORS}))},template:'                <div class="swatches">                    <ul class="swatch-holder unstyled">                        <% _(colors).each(function(color) { %>                            <li>                                <a href="#" class="swatch" data-color="<%= color %>" style="background-color: <%= color %>"></a>                            </li>                        <% }) %>                    </ul>                </div>                <div class="big-swatch" data-color="<%- model.get("color").substring(2) %>" style="background-color: #<%- model.get("color").substring(2) %>;"></div>                <div class="swatch-hex">                    <div class="input-prepend views-shared-controls-textcontrol">                        <span class="add-on">#</span>                        <input type="text" class="hex-input" value="<%-model.get("color").substring(2) %>">                    </div>                </div>            ',_buttonTemplate:'                <div class="popdown-dialog-footer color-picker-buttons clearfix">                    <a href="#" class="color-picker-cancel btn pull-left">'+_("Cancel").t()+'</a>                    <a href="#" class="color-picker-apply btn btn-primary pull-right"> '+_("Apply").t()+"</a>                </div>            "})});define("views/shared/vizcontrols/components/color/Ranges",["underscore","jquery","module","views/Base","views/shared/vizcontrols/components/color/ColorPicker","collections/Base"],function(_,$,module,Base,ColorPicker,BaseCollection){return Base.extend({className:"tab-pane clearfix",moduleId:module.id,palette:["0x7e9f44","0xebe42d","0xd13b3b","0x6cb8ca","0xf7912c","0x956e96","0xc2da8a","0xfac61d","0xebb7d0","0x324969","0xd85e3d","0xa04558"],initialize:function(){Base.prototype.initialize.apply(this,arguments);this.collection={};this.collection.rows=new BaseCollection;this.initRowsFromModel();this.collection.rows.on("add remove color-picker-apply",function(){this.syncModel();this.render()},this);this.collection.rows.on("change",this.syncModel,this)},initRowsFromModel:function(){var modelRanges=this.model.rangesValuesToArray(),ranges=modelRanges.length>0?modelRanges:["0","30","70","100"],modelColors=this.model.deserializeGaugeColorArray(),colors=modelColors.length>0?modelColors:["0x84E900","0xFFE800","0xBF3030"];_(ranges).each(function(range,i){var color=colors[i-1]||colors[colors.length-1];this.collection.rows.push({value:range,nextValue:ranges[i+1],color:0!=i?color:void 0,shadedcolor:0!=i?this.shadeColor(color,-40):void 0})},this)},syncModel:function(){this.model.set({"display.visualizations.charting.chart.rangeValues":JSON.stringify(this.collection.rows.pluck("value")),"display.visualizations.charting.gaugeColors":"["+_(this.collection.rows.pluck("color")).filter(function(color){return!_.isUndefined(color)}).join(",")+"]"})},events:{"click .add-color-range":function(e){var color=this.palette[Math.floor(12*Math.random())];this.collection.rows.push({value:this.options.prepopulateNewRanges?2*parseInt(this.collection.rows.last().get("value"),10):"",nextValue:"",color:color,shadedcolor:this.shadeColor(color,-40)});e.preventDefault();e.stopPropagation()},"keyup .range-value":_.debounce(function(e){var $target=$(e.currentTarget),index=$target.data().index;this.collection.rows.at(index).set("value",$.trim($target.val()));var $next=this.$el.find('[data-prev="'+index+'"]').children().eq(0);$next&&$next.text((parseInt($target.val(),10)||"")+" ");e.preventDefault()},300),"click .color-square":function(e){{var $target=$(e.currentTarget);$target.css("background-color")}this.children.colorPicker=new ColorPicker({model:this.collection.rows.at($target.parent().siblings("input").data().index),shadeColor:this.shadeColor,onHiddenRemove:!0});this.children.colorPicker.render().appendTo($("body"));this.children.colorPicker.show($target);e.preventDefault()},"click .remove-range":function(e){var index=$(e.currentTarget).siblings("input").data().index;this.collection.rows.remove(this.collection.rows.at(index));e.stopPropagation()}},shadeColor:function(color,shade){var colorInt=parseInt(color,16),R=(16711680&colorInt)>>16,G=(65280&colorInt)>>8,B=(255&colorInt)>>0;R+=Math.floor(shade/255*R);G+=Math.floor(shade/255*G);B+=Math.floor(shade/255*B);return((R<<16)+(G<<8)+B).toString(16)},render:function(){this.model.gaugeIsInAutoMode()||this.syncModel();this.$el.html(this.compiledTemplate({_:_,collection:this.collection.rows}));return this},template:'                <div class="color-rows form-horizontal">                    <div class="from-color-group">                        <div class="control-group">                            <label class="lower-range-label control-label"><%- _("from").t() %></label>                            <div class="controls">                                <input class="first-row-lower range-value" value="<%- collection.at(0).get("value") %>" data-index=0 type="text">                            </div>                        </div>                    </div>                    <div class="to-color-group">                        <div class="control-group">                            <label class="control-label upper-range-label to-label"><%- _("to").t() %></label>                            <div class="controls right-input">                                <div class="input-append">                                    <input  class="first-row-upper range-value" value="<%- collection.at(1).get("value") %>" data-index=1 type="text">                                    <div class="add-on color-picker-add-on">                                        <a href="#" class="color-square" style="border-color: #<%- collection.at(1).get("shadedcolor")%>; background-color: #<%- collection.at(1).get("color").substring(2) %>;"></a>                                    </div>                                </div>                            </div>                        </div>                    </div>                    <% collection.each(function(model, i) { %>                        <% if(!(i==0 || i==1)) {%>                            <div class="extra-color-group">                                <div class="control-group">                                    <label class="upper-range-label control-label" data-prev="<%- i-1 %>">                                        <span class "value"><%- (parseInt(collection.at(i-1).get("value"))) || "" %> </span>                                        <span class="label-to"><%- _("to").t() %></span>                                    </label>                                    <div class="controls input-append">                                        <input  class="range-value" value="<%- model.get("value") %>" data-index=<%-i%> type="text">                                        <div class="add-on color-picker-add-on">                                            <a href="#" class="color-square" style="border-color: #<%- model.get("shadedcolor")%>; background-color: #<%- model.get("color").substring(2) %>;"></a>                                        </div>                                        <a class="remove-range btn-link" href="#"><i class="icon-x-circle"></i></a>                                    </div>                                </div>                            </div>                        <% } %>                    <% }); %>                </div>                <a href="#" class="add-color-range btn pull-right"> + <%- _("Add Range").t() %></a>            '})});define("views/shared/vizcontrols/components/color/Master",["underscore","jquery","module","splunk.util","models/Base","views/Base","views/shared/controls/ControlGroup","views/shared/vizcontrols/custom_controls/GaugeAutoRangesControlGroup","views/shared/vizcontrols/components/color/Ranges"],function(_,$,module,util,BaseModel,BaseView,ControlGroup,GaugeAutoRangesControlGroup,Ranges){return BaseView.extend({moduleId:module.id,className:" form form-horizontal",controlClass:"controls-halfblock",vizToColorRangeComponents:{line:[],area:[],column:[],bar:[],pie:[],scatter:[],radialGauge:["range"],fillerGauge:["range"],markerGauge:["range"],single:[],events:[],statistics:[]},initialize:function(){BaseView.prototype.initialize.apply(this,arguments);var controls=this.vizToColorRangeComponents[this.model.get("viz_type")];if(_.indexOf(controls,"range")>-1){this.autoModeModel=new BaseModel;this.children.toggle=new GaugeAutoRangesControlGroup({model:this.autoModeModel,vizModel:this.model});this.autoModeModel.on("change:autoMode",this.updateRangesVisibility,this)}this.children.colorRanges=new Ranges({model:this.model})},render:function(){this.children.toggle&&this.children.toggle.render().appendTo(this.$el);this.children.colorRanges.render().appendTo(this.$el);this.updateRangesVisibility();return this},remove:function(){this.autoModeModel.off(null,null,this)},updateRangesVisibility:function(){"1"===this.autoModeModel.get("autoMode")?this.children.colorRanges.$el.hide():this.children.colorRanges.$el.show()}})});define("views/shared/vizcontrols/components/Statistics",["underscore","module","views/Base","views/shared/controls/ControlGroup","views/shared/controls/SyntheticSelectControl"],function(_,module,Base,ControlGroup){return Base.extend({moduleId:module.id,className:"form form-horizontal",initialize:function(){Base.prototype.initialize.apply(this,arguments);this.children.drillDown=new ControlGroup({label:_("Drilldown").t(),controlType:"SyntheticRadio",controlClass:"controls-thirdblock",controlOptions:{className:"btn-group",items:[{value:"row",label:_("Row").t()},{value:"cell",label:_("Cell").t()},{value:"none",label:_("None").t()}],model:this.model,modelAttribute:"display.statistics.drilldown"}});this.children.rowNumbers=new ControlGroup({label:_("Row Numbers").t(),controlType:"SyntheticRadio",controlClass:"controls-halfblock",controlOptions:{className:"btn-group",items:[{value:"1",label:_("Yes").t()},{value:"0",label:_("No").t()}],model:this.model,modelAttribute:"display.statistics.rowNumbers"}});this.children.wrapResults=new ControlGroup({label:_("Wrap Results").t(),controlType:"SyntheticRadio",controlClass:"controls-halfblock",controlOptions:{className:"btn-group",items:[{value:"1",label:_("Yes").t()},{value:"0",label:_("No").t()}],model:this.model,modelAttribute:"display.statistics.wrap"}});this.children.dataOverlay=new ControlGroup({label:_("Data Overlay").t(),controlType:"SyntheticSelect",controlClass:"controls-block",controlOptions:{model:this.model,menuWidth:"narrow",items:[{value:"none",label:_("None").t()},{value:"heatmap",label:_("Heat map").t()},{value:"highlow",label:_("High and low values").t()}],modelAttribute:"display.statistics.overlay",toggleClassName:"btn"}});this.model.get("dashboard")&&(this.children.count=new ControlGroup({label:_("Rows Per Page").t(),controlType:"Text",controlClass:"controls-block",controlOptions:{model:this.model,menuWidth:"narrow",modelAttribute:"display.prefs.statistics.count"}}))},render:function(){this.$el.html("");this.children.wrapResults.render().appendTo(this.$el);this.children.rowNumbers.render().appendTo(this.$el);this.children.drillDown.render().appendTo(this.$el);this.children.dataOverlay.render().appendTo(this.$el);this.children.count&&this.children.count.render().appendTo(this.$el);return this}})});define("views/shared/vizcontrols/components/Events",["underscore","module","views/Base","views/shared/controls/ControlGroup"],function(_,module,Base,ControlGroup){return Base.extend({moduleId:module.id,className:"form form-horizontal",initialize:function(){Base.prototype.initialize.apply(this,arguments);this.showEventType=this.options.showEventType===!1?!1:!0;this.showDrilldown=this.options.showDrilldown===!1?!1:!0;this.showEventType&&(this.children.eventType=new ControlGroup({label:_("Display").t(),controlType:"SyntheticRadio",controlClass:"controls-thirdblock",controlOptions:{className:"btn-group",items:[{label:_("Raw").t(),value:"raw"},{label:_("List").t(),value:"list"},{label:_("Table").t(),value:"table"}],model:this.model,modelAttribute:"display.events.type"}}));this.children.rowNumbers=new ControlGroup({label:_("Row Numbers").t(),controlType:"SyntheticRadio",controlClass:"controls-halfblock",controlOptions:{className:"btn-group",items:[{value:"1",label:_("Yes").t()},{value:"0",label:_("No").t()}],model:this.model,modelAttribute:"display.events.rowNumbers"}});this.children.wrapResultsList=new ControlGroup({label:_("Wrap Results").t(),controlType:"SyntheticRadio",controlClass:"controls-halfblock",controlOptions:{className:"btn-group",items:[{value:"1",label:_("Yes").t()},{value:"0",label:_("No").t()}],model:this.model,modelAttribute:"display.events.list.wrap"}});this.children.wrapResultsTable=new ControlGroup({label:_("Wrap Results").t(),controlType:"SyntheticRadio",controlClass:"controls-halfblock",controlOptions:{className:"btn-group",items:[{value:"1",label:_("Yes").t()},{value:"0",label:_("No").t()}],model:this.model,modelAttribute:"display.events.table.wrap"}});this.children.maxlines=new ControlGroup({label:_("Max Lines").t(),controlType:"SyntheticSelect",controlClass:"controls-block",controlOptions:{model:this.model,menuWidth:"narrow",items:[{value:"5",label:_("5 lines").t()},{value:"10",label:_("10 lines").t()},{value:"20",label:_("20 lines").t()},{value:"50",label:_("50 lines").t()},{value:"100",label:_("100 lines").t()},{value:"200",label:_("200 lines").t()},{value:"0",label:_("All lines").t()}],modelAttribute:"display.events.maxLines",toggleClassName:"btn",nearestValue:!0}});if(this.showDrilldown){this.children.drilldownRaw=new ControlGroup({label:_("Drilldown").t(),controlType:"SyntheticSelect",controlClass:"controls-block",controlOptions:{menuWidth:"narrow",toggleClassName:"btn",items:[{value:"none",label:_("None").t()},{value:"inner",label:_("Inner").t()},{value:"outer",label:_("Outer").t()},{value:"full",label:_("Full").t()}],model:this.model,modelAttribute:"display.events.raw.drilldown"}});this.children.drilldownList=new ControlGroup({label:_("Drilldown").t(),controlType:"SyntheticSelect",controlClass:"controls-block",controlOptions:{menuWidth:"narrow",toggleClassName:"btn",items:[{value:"none",label:_("None").t()},{value:"inner",label:_("Inner").t()},{value:"outer",label:_("Outer").t()},{value:"full",label:_("Full").t()}],model:this.model,modelAttribute:"display.events.list.drilldown"}});this.children.drilldownTable=new ControlGroup({label:_("Drilldown").t(),controlType:"SyntheticRadio",controlClass:"controls-halfblock",controlOptions:{className:"btn-group",items:[{value:"1",label:_("On").t()},{value:"0",label:_("Off").t()}],model:this.model,modelAttribute:"display.events.table.drilldown"}})}this.model.get("dashboard")&&(this.children.count=new ControlGroup({label:_("Rows Per Page").t(),controlType:"Text",controlClass:"controls-block",controlOptions:{model:this.model,menuWidth:"narrow",modelAttribute:"display.prefs.events.count"}}));this.activate()},startListening:function(){this.listenTo(this.model,"change:display.events.type",this.visibility);this.showDrilldown&&this.listenTo(this.model,"change:display.events.list.drilldown change:display.events.raw.drilldown",this.mediateDrilldown);this.listenTo(this.model,"change:display.events.list.wrap change:display.events.table.wrap",this.mediateWrap)},mediateDrilldown:function(){"list"===this.model.get("display.events.type")?this.model.set("display.events.raw.drilldown",this.model.get("display.events.list.drilldown")):this.model.set("display.events.list.drilldown",this.model.get("display.events.raw.drilldown"))},mediateWrap:function(){"list"===this.model.get("display.events.type")?this.model.set("display.events.table.wrap",this.model.get("display.events.list.wrap")):this.model.set("display.events.list.wrap",this.model.get("display.events.table.wrap"))},visibility:function(){switch(this.model.get("display.events.type")){case"list":this.children.wrapResultsList.$el.show();this.children.wrapResultsTable.$el.hide();this.children.rowNumbers.$el.show();if(this.showDrilldown){this.children.drilldownList.$el.show();this.children.drilldownRaw.$el.hide();this.children.drilldownTable.$el.hide()}break;case"raw":this.children.wrapResultsList.$el.hide();this.children.wrapResultsTable.$el.hide();this.children.rowNumbers.$el.hide();if(this.showDrilldown){this.children.drilldownList.$el.hide();this.children.drilldownRaw.$el.show();this.children.drilldownTable.$el.hide()}break;case"table":this.children.wrapResultsList.$el.hide();this.children.wrapResultsTable.$el.show();this.children.rowNumbers.$el.show();if(this.showDrilldown){this.children.drilldownList.$el.hide();this.children.drilldownRaw.$el.hide();this.children.drilldownTable.$el.show()}}},render:function(){this.showEventType&&this.children.eventType.render().appendTo(this.$el);this.children.rowNumbers.render().appendTo(this.$el);this.children.wrapResultsList.render().appendTo(this.$el);this.children.wrapResultsTable.render().appendTo(this.$el);this.children.maxlines.render().appendTo(this.$el);if(this.showDrilldown){this.children.drilldownList.render().appendTo(this.$el);this.children.drilldownRaw.render().appendTo(this.$el);this.children.drilldownTable.render().appendTo(this.$el)}this.children.count&&this.children.count.render().appendTo(this.$el);this.visibility();return this}})});define("views/shared/vizcontrols/custom_controls/MapCenterControlGroup",["underscore","module","views/shared/controls/ControlGroup","views/shared/controls/TextControl"],function(_,module,ControlGroup,TextControl){var LAT_LON_REGEX=/^\(([^,\s]*)\s*,\s*([^,\s]*)\)$/,MapCenterControl=TextControl.extend({setValueFromModel:function(render){var latLon=this.readLatLon();this._setValue(this.options.mode===MapCenterControlGroup.LATITUDE?latLon.lat:latLon.lon,render);return this},getUpdatedModelAttributes:function(){var latLon=this.readLatLon(),updateAttrs={};this.options.mode===MapCenterControlGroup.LATITUDE?latLon.lat=this._value:latLon.lon=this._value;updateAttrs[this.getModelAttribute()]="("+latLon.lat+","+latLon.lon+")";return updateAttrs},readLatLon:function(){var matches=LAT_LON_REGEX.exec(this.model.get(this.getModelAttribute()));return!matches||matches.length<3?{lat:0,lon:0}:{lat:matches[1],lon:matches[2]}}}),MapCenterControlGroup=ControlGroup.extend({moduleId:module.id,initialize:function(){this.options.label=this.options.mode===MapCenterControlGroup.LATITUDE?_("Latitude").t():_("Longitude").t();this.options.controls=[new MapCenterControl({model:this.model,modelAttribute:"display.visualizations.mapping.map.center",mode:this.options.mode,inputClassName:"input-medium"})];ControlGroup.prototype.initialize.call(this,this.options)}},{LATITUDE:"latitude",LONGITUDE:"longitude"});return MapCenterControlGroup});define("views/shared/vizcontrols/custom_controls/MapZoomControlGroup",["underscore","module","views/shared/controls/ControlGroup"],function(_,module,ControlGroup){return ControlGroup.extend({moduleId:module.id,initialize:function(){this.options.label=_("Zoom").t();this.options.controlType="Text";this.options.controlOptions={modelAttribute:"display.visualizations.mapping.map.zoom",model:this.model,inputClassName:"input-medium"};ControlGroup.prototype.initialize.call(this,this.options)}})});define("views/shared/vizcontrols/components/Map",["underscore","module","views/Base","views/shared/vizcontrols/custom_controls/MapCenterControlGroup","views/shared/vizcontrols/custom_controls/MapZoomControlGroup","util/console"],function(_,module,Base,MapCenterControlGroup,MapZoomControlGroup,console){return Base.extend({moduleId:module.id,className:"form form-horizontal",events:{"click .populate-button":function(e){e.preventDefault();var roundToHundredths=function(num){return Math.round(100*num)/100},reportContent=this.model.report.entry.content,center=reportContent.get("currentMapCenter"),centerString="("+roundToHundredths(center.lat)+","+roundToHundredths(center.lon)+")";this.model.visualization.set({"display.visualizations.mapping.map.zoom":reportContent.get("currentMapZoom"),"display.visualizations.mapping.map.center":centerString})}},vizToGeneralComponents:{line:[],area:[],column:[],bar:[],pie:[],scatter:[],radialGauge:[],fillerGauge:[],markerGauge:[],single:[],mapping:["centerLat","centerLon","zoom"]},initialize:function(){Base.prototype.initialize.apply(this,arguments);var controls=this.vizToGeneralComponents[this.model.visualization.get("viz_type")];_.contains(controls,"centerLat")&&(this.children.centerLat=new MapCenterControlGroup({model:this.model.visualization,mode:MapCenterControlGroup.LATITUDE}));_.contains(controls,"centerLon")&&(this.children.centerLon=new MapCenterControlGroup({model:this.model.visualization,mode:MapCenterControlGroup.LONGITUDE}));_.contains(controls,"zoom")&&(this.children.zoom=new MapZoomControlGroup({model:this.model.visualization}))},render:function(){this.children.centerLat&&this.children.centerLat.render().appendTo(this.$el);this.children.centerLon&&this.children.centerLon.render().appendTo(this.$el);this.children.zoom&&this.children.zoom.render().appendTo(this.$el);var reportContent=this.model.report.entry.content;reportContent.has("currentMapZoom")&&reportContent.has("currentMapCenter")?this.$el.append(this.compiledTemplate()):console.warn("report content does not have current map zoom and center, disabling populate button");return this},template:'            <div class="populate-button-container">                <a href="#" class="populate-button"><%- _("Populate with current map settings").t() %></a>            </div>        '})});define("views/shared/controls/PercentTextControl",["jquery","underscore","module","views/shared/controls/TextControl","util/math_utils"],function($,_,module,TextControl,mathUtils){return TextControl.extend({initialize:function(){this.options=$.extend({append:_('<span class="add-on"><%- _("%").t() %></span>').template({}),inputClassName:"input-mini"},this.options);TextControl.prototype.initialize.call(this,this.options)},setValueFromModel:function(render){var rawValue=this.model.get(this.getModelAttribute()),normalizedValue=mathUtils.strictParseFloat((100*mathUtils.strictParseFloat(rawValue)).toPrecision(12));this._setValue(_.isNaN(normalizedValue)?rawValue:normalizedValue,render);return this},getUpdatedModelAttributes:function(){var updateAttrs=TextControl.prototype.getUpdatedModelAttributes.apply(this,arguments),rawValue=updateAttrs[this.getModelAttribute()],normalizedValue=mathUtils.strictParseFloat(updateAttrs[this.getModelAttribute()])/100;updateAttrs[this.getModelAttribute()]=_.isNaN(normalizedValue)?rawValue:normalizedValue;return updateAttrs}})});define("views/shared/vizcontrols/custom_controls/MapMarkerOpacityControlGroup",["jquery","underscore","module","views/shared/controls/PercentTextControl","views/shared/controls/ControlGroup"],function($,_,module,PercentTextControl,ControlGroup){return ControlGroup.extend({moduleId:module.id,initialize:function(){this.options.label=_("Opacity").t();this.options.controls=[new PercentTextControl({model:this.model,modelAttribute:"display.visualizations.mapping.markerLayer.markerOpacity"})];ControlGroup.prototype.initialize.call(this,this.options)}})});define("views/shared/vizcontrols/custom_controls/MapMarkerMinSizeControlGroup",["underscore","module","views/shared/controls/ControlGroup"],function(_,module,ControlGroup){return ControlGroup.extend({moduleId:module.id,initialize:function(){this.options.label=_("Min Size").t();this.options.controlType="Text";this.options.controlOptions={modelAttribute:"display.visualizations.mapping.markerLayer.markerMinSize",model:this.model,inputClassName:"input-medium"};ControlGroup.prototype.initialize.call(this,this.options)}})});define("views/shared/vizcontrols/custom_controls/MapMarkerMaxSizeControlGroup",["underscore","module","views/shared/controls/ControlGroup"],function(_,module,ControlGroup){return ControlGroup.extend({moduleId:module.id,initialize:function(){this.options.label=_("Max Size").t();this.options.controlType="Text";this.options.controlOptions={modelAttribute:"display.visualizations.mapping.markerLayer.markerMaxSize",model:this.model,inputClassName:"input-medium"};ControlGroup.prototype.initialize.call(this,this.options)}})});define("views/shared/vizcontrols/custom_controls/MapMarkerMaxClustersControlGroup",["underscore","module","views/shared/controls/ControlGroup"],function(_,module,ControlGroup){return ControlGroup.extend({moduleId:module.id,initialize:function(){this.options.label=_("Max Clusters").t();this.options.controlType="Text";this.options.controlOptions={modelAttribute:"display.visualizations.mapping.data.maxClusters",model:this.model,inputClassName:"input-medium"};ControlGroup.prototype.initialize.call(this,this.options)}})});define("views/shared/vizcontrols/components/Markers",["underscore","module","views/Base","views/shared/vizcontrols/custom_controls/MapMarkerOpacityControlGroup","views/shared/vizcontrols/custom_controls/MapMarkerMinSizeControlGroup","views/shared/vizcontrols/custom_controls/MapMarkerMaxSizeControlGroup","views/shared/vizcontrols/custom_controls/MapMarkerMaxClustersControlGroup"],function(_,module,Base,MapMarkerOpacityControlGroup,MapMarkerMinSizeControlGroup,MapMarkerMaxSizeControlGroup,MapMarkerMaxClustersControlGroup){return Base.extend({moduleId:module.id,className:"form form-horizontal",vizToGeneralComponents:{line:[],area:[],column:[],bar:[],pie:[],scatter:[],radialGauge:[],fillerGauge:[],markerGauge:[],single:[],mapping:["opacity","minSize","maxSize","maxClusters"]},initialize:function(){Base.prototype.initialize.apply(this,arguments);var controls=this.vizToGeneralComponents[this.model.get("viz_type")];_.contains(controls,"opacity")&&(this.children.opacity=new MapMarkerOpacityControlGroup({model:this.model}));_.contains(controls,"minSize")&&(this.children.minSize=new MapMarkerMinSizeControlGroup({model:this.model}));_.contains(controls,"maxSize")&&(this.children.maxSize=new MapMarkerMaxSizeControlGroup({model:this.model}));_.contains(controls,"maxClusters")&&(this.children.maxClusters=new MapMarkerMaxClustersControlGroup({model:this.model}))},render:function(){this.children.opacity&&this.children.opacity.render().appendTo(this.$el);this.children.minSize&&this.children.minSize.render().appendTo(this.$el);this.children.maxSize&&this.children.maxSize.render().appendTo(this.$el);this.children.maxClusters&&this.children.maxClusters.render().appendTo(this.$el);return this}})});define("util/keyboard",[],function(){var keyboard={};keyboard.KEYS={ENTER:13,UP_ARROW:38,DOWN_ARROW:40,LEFT_ARROW:37,RIGHT_ARROW:39,PAGE_DOWN:34,PAGE_UP:33,SPACE_BAR:32,TAB:9,ESCAPE:27};return keyboard});define("views/shared/DropDownMenu",["jquery","underscore","views/Base","views/shared/delegates/Popdown","util/keyboard","module"],function($,_,BaseView,Popdown,keyboardUtils,module){return BaseView.extend({moduleId:module.id,DEFAULT_CLASS_NAME:"btn-group pull-right",DEFAULT_ANCHOR_CLASS_NAME:"btn",initialize:function(options){BaseView.prototype.initialize.call(this,options);options=options||{};this.$el.addClass(options.hasOwnProperty("className")?options.className:this.DEFAULT_CLASS_NAME);this.anchorClassName=options.hasOwnProperty("anchorClassName")?options.anchorClassName:this.DEFAULT_ANCHOR_CLASS_NAME;this.options.popdownOptions=$.extend(!0,{el:this.el,attachDialogTo:"body"},this.options.popdownOptions)},setItems:function(items){this.options.items=items;this.debouncedRender()},render:function(){this.children.popdown&&this.children.popdown.remove();var html=_(this.template).template({options:this.options,useNestedArrays:this.isArrayofArrays(this.options.items)});this.$el.html(html);this.$(".dropdown-toggle").addClass(this.anchorClassName);this.$drowdownMenu=this.$(".dropdown-menu");this.$drowdownMenu.on("click","ul > li > a:not(.disabled)",_(this.handleItemClick).bind(this));this.$drowdownMenu.on("keydown",_(function(e){if(e.which===keyboardUtils.KEYS.ESCAPE){this.children.popdown.hide();e.stopPropagation()}}).bind(this));this.children.popdown=new Popdown(this.options.popdownOptions);this.children.popdown.on("shown",function(){this.$drowdownMenu.find("a[data-value]:not(.disabled)").first().focus()},this);this.children.popdown.on("hidden",function(){this.$(".dropdown-toggle").focus()},this);return this},isArrayofArrays:function(items){return _(items).isArray()&&items.length>0&&_(items[0]).isArray()?!0:!1},handleItemClick:function(e){e.preventDefault();var $target=$(e.currentTarget),itemValue=$target.attr("data-value"),itemIndex=parseInt($target.attr("data-item-index"),10);if(this.isArrayofArrays(this.options.items)){var itemsArrayIndex=parseInt($target.attr("data-items-array-index"),10);this.trigger("itemClicked",itemValue,this.options.items[itemsArrayIndex][itemIndex])}else this.trigger("itemClicked",itemValue,this.options.items[itemIndex])},template:'            <a class="dropdown-toggle" href="#">                <% if (options.labelIcon) { %><i class="icon-<%- options.labelIcon %> icon-large"></i><% } %><span class="link-label"><%- options.label %></span><span class="caret"></span>            </a>            <div class="dropdown-menu <%- options.dropdownClassName || \'\' %>">                <div class="arrow"></div>                <% if (useNestedArrays) { %>                    <% _(options.items).each(function(itemsChild, i) { %>                    <ul>                        <% _(itemsChild).each(function(object, j) { %>                            <li>                                <a href="#" data-value="<%- object.value %>" data-items-array-index="<%- i %>" data-item-index="<%- j %>"                                     <% if(object.enabled === false) {%>                                        class="disabled"                                    <% } %>                                >                                    <% if (object.icon) { %>                                         <i class="icon-<%- object.icon %> icon-large"></i>                                    <% } %>                                    <%- object.label %>                                </a>                            </li>                        <% }) %>                    </ul>                    <% }) %>                <% } else { %>                    <ul>                        <% _(options.items).each(function(object, k) { %>                            <li>                                <a href="#" data-value="<%- object.value %>" data-item-index="<%- k %>"                                     <% if(object.enabled === false) {%>                                        class="disabled"                                    <% } %>                                    >                                    <% if (object.icon) { %>                                         <i class="icon-<%- object.icon %> icon-large"></i>                                    <% } %>                                    <%- object.label %>                                </a>                            </li>                        <% }) %>                    </ul>               <% } %>            </div>        '})});define("views/shared/vizcontrols/custom_controls/MapTileUrlControlGroup",["underscore","module","views/shared/controls/ControlGroup"],function(_,module,ControlGroup){return ControlGroup.extend({moduleId:module.id,initialize:function(){this.options.label=_("Url").t();this.options.controlType="Textarea";
this.options.help=_("The URL to use for requesting tiles, ex: <br /> http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").t();this.options.controlOptions={modelAttribute:"display.visualizations.mapping.tileLayer.url",model:this.model,className:"control controls-block"};ControlGroup.prototype.initialize.call(this,this.options)}})});define("views/shared/vizcontrols/custom_controls/MapTileMinZoomControlGroup",["underscore","module","views/shared/controls/ControlGroup"],function(_,module,ControlGroup){return ControlGroup.extend({moduleId:module.id,initialize:function(){this.options.label=_("Min Zoom").t();this.options.controlType="Text";this.options.controlOptions={modelAttribute:"display.visualizations.mapping.tileLayer.minZoom",model:this.model,inputClassName:"input-medium"};ControlGroup.prototype.initialize.call(this,this.options)}})});define("views/shared/vizcontrols/custom_controls/MapTileMaxZoomControlGroup",["underscore","module","views/shared/controls/ControlGroup"],function(_,module,ControlGroup){return ControlGroup.extend({moduleId:module.id,initialize:function(){this.options.label=_("Max Zoom").t();this.options.controlType="Text";this.options.controlOptions={modelAttribute:"display.visualizations.mapping.tileLayer.maxZoom",model:this.model,inputClassName:"input-medium"};ControlGroup.prototype.initialize.call(this,this.options)}})});define("views/shared/vizcontrols/components/Tiles",["underscore","module","views/Base","views/shared/DropDownMenu","views/shared/vizcontrols/custom_controls/MapTileUrlControlGroup","views/shared/vizcontrols/custom_controls/MapTileMinZoomControlGroup","views/shared/vizcontrols/custom_controls/MapTileMaxZoomControlGroup"],function(_,module,Base,DropDownMenu,MapTileUrlControlGroup,MapTileMinZoomControlGroup,MapTileMaxZoomControlGroup){return Base.extend({moduleId:module.id,className:"form form-horizontal",vizToGeneralComponents:{line:[],area:[],column:[],bar:[],pie:[],scatter:[],radialGauge:[],fillerGauge:[],markerGauge:[],single:[],mapping:["url","minZoom","maxZoom"]},initialize:function(){Base.prototype.initialize.apply(this,arguments);var controls=this.vizToGeneralComponents[this.model.get("viz_type")];_.contains(controls,"url")&&(this.children.url=new MapTileUrlControlGroup({model:this.model}));_.contains(controls,"minZoom")&&(this.children.minZoom=new MapTileMinZoomControlGroup({model:this.model}));_.contains(controls,"maxZoom")&&(this.children.maxZoom=new MapTileMaxZoomControlGroup({model:this.model}));this.children.tilePresetsMenu=new DropDownMenu({label:_("Populate from preset configuration").t(),className:"",dropdownClassName:"dropdown-menu-narrow",anchorClassName:"btn-pill",popdownOptions:{attachDialogTo:"body"},items:[{label:_("Splunk Tiles").t(),value:"splunk",url:"",minZoom:"0",maxZoom:"7"},{label:_("Open Street Map").t(),value:"osm",url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",minZoom:"0",maxZoom:"19"}]});this.listenTo(this.children.tilePresetsMenu,"itemClicked",function(type,itemData){this.model.set({"display.visualizations.mapping.tileLayer.url":itemData.url,"display.visualizations.mapping.tileLayer.minZoom":itemData.minZoom,"display.visualizations.mapping.tileLayer.maxZoom":itemData.maxZoom})})},render:function(){this.children.url&&this.children.url.render().appendTo(this.$el);this.children.minZoom&&this.children.minZoom.render().appendTo(this.$el);this.children.maxZoom&&this.children.maxZoom.render().appendTo(this.$el);this.$el.append(this.compiledTemplate());this.children.tilePresetsMenu.render().appendTo(this.$(".populate-button-container"));return this},template:'            <div class="populate-button-container"></div>        '})});define("views/shared/vizcontrols/components/Master",["underscore","jquery","module","views/Base","views/shared/FlashMessages","views/shared/vizcontrols/components/General","views/shared/vizcontrols/components/XAxis","views/shared/vizcontrols/components/YAxis","views/shared/vizcontrols/components/ChartOverlay","views/shared/vizcontrols/components/Legend","views/shared/vizcontrols/components/color/Master","views/shared/vizcontrols/components/Statistics","views/shared/vizcontrols/components/Events","views/shared/vizcontrols/components/Map","views/shared/vizcontrols/components/Markers","views/shared/vizcontrols/components/Tiles"],function(_,$,module,Base,FlashMessages,General,XAxis,YAxis,ChartOverlay,Legend,Ranges,Statistics,Events,Map,Markers,Tiles){return Base.extend({moduleId:module.id,className:"tabbable ",events:{"click a[data-toggle]":function(e){var $target=$(e.currentTarget),type=$target.data().type;_(this.children).each(function(child){child.$el.hide()},this);this.children[type].$el.show();this.$el.find(".nav > li").removeClass("active");$target.parent().addClass("active");e.preventDefault()}},initialize:function(){Base.prototype.initialize.apply(this,arguments);this.children.flashMessages=new FlashMessages({model:this.model.visualization});this.vizType=this.model.visualization.get("viz_type");this.hasTabType("gen")?this.children.general=new General({model:this.model.visualization}):this.hasTabType("statistics")?this.children.general=new Statistics({model:this.model.visualization}):this.hasTabType("events")&&(this.children.general=new Events({model:this.model.visualization}));this.hasTabType("x")&&(this.children.xaxis=new XAxis({model:this.model.visualization}));this.hasTabType("y")&&(this.children.yaxis=new YAxis({model:this.model.visualization}));this.hasTabType("overlay")&&(this.children.overlay=new ChartOverlay({model:{visualization:this.model.visualization,report:this.model.report}}));this.hasTabType("leg")&&(this.children.legend=new Legend({model:this.model.visualization}));this.hasTabType("ranges")&&(this.children.ranges=new Ranges({model:this.model.visualization}));this.hasTabType("map")&&(this.children.map=new Map({model:{visualization:this.model.visualization,report:this.model.report}}));this.hasTabType("markers")&&(this.children.markers=new Markers({model:this.model.visualization}));this.hasTabType("tiles")&&(this.children.tiles=new Tiles({model:this.model.visualization}))},render:function(){this.$el.html(_(this.template).template({hasTabType:_(this.hasTabType).bind(this)}));this.children.flashMessages.render().prependTo(this.$(".tab-content"));_(this.children).each(function(child){this.$(".tab-content").append(child.render().el);child.$el.hide()},this);this.children.general.$el.show();return this},hasTabType:function(tabType){return _.contains(this.model.visualization.components[this.vizType],tabType)},template:'                <ul class="nav nav-tabs-left">                    <% if(hasTabType("gen") || hasTabType("statistics") || hasTabType("events")) { %>                        <li class="active">                            <a href="#" data-toggle="tab" data-type="general"><%- _("General").t() %></a>                        </li>                    <% } %>                    <% if(hasTabType("x")) { %>                        <li>                            <a href="#" data-toggle="tab" data-type="xaxis"><%- _("X-Axis").t() %></a>                        </li>                    <% } %>                    <% if(hasTabType("y")) { %>                        <li>                            <a href="#" data-toggle="tab" data-type="yaxis"><%- _("Y-Axis").t() %></a>                        </li>                    <% } %>                    <% if(hasTabType("overlay")) { %>                        <li>                            <a href="#" data-toggle="tab" data-type="overlay"><%- _("Chart Overlay").t() %></a>                        </li>                    <% } %>                    <% if(hasTabType("leg")) { %>                        <li>                            <a href="#" data-toggle="tab" data-type="legend"><%- _("Legend").t() %></a>                        </li>                    <% } %>                    <% if(hasTabType("ranges")) { %>                        <li>                            <a href="#" data-toggle="tab" data-type="ranges"><%- _("Color Ranges").t() %></a>                        </li>                    <% } %>                    <% if(hasTabType("map")) { %>                        <li>                            <a href="#" data-toggle="tab" data-type="map"><%- _("Map").t() %></a>                        </li>                    <% } %>                    <% if(hasTabType("markers")) { %>                        <li>                            <a href="#" data-toggle="tab" data-type="markers"><%- _("Markers").t() %></a>                        </li>                    <% } %>                    <% if(hasTabType("tiles")) { %>                        <li>                            <a href="#" data-toggle="tab" data-type="tiles"><%- _("Tiles").t() %></a>                        </li>                    <% } %>                </ul>                <div class="tab-content"></div>            '})});define("views/shared/vizcontrols/Format",["underscore","jquery","module","views/shared/PopTart","views/shared/vizcontrols/components/Master"],function(_,$,module,PopTart,Component){return PopTart.extend({moduleId:module.id,options:{saveOnApply:!1},initialize:function(){PopTart.prototype.initialize.apply(this,arguments);this.children.visualizationControls&&this.children.visualizationControls.remove();this.children.visualizationControls=new Component({model:{visualization:this.model.visualization,report:this.model.report}})},events:{"click .viz-editor-apply":function(e){e.preventDefault();this.applyChanges()},"click .viz-editor-cancel":function(e){this.hide();e.preventDefault()},"keypress .viz-editor-apply":function(e){e.preventDefault();this.applyChanges()},"keypress .viz-editor-cancel":function(e){this.hide();e.preventDefault()},"keypress input:text":function(e){var enterKeyCode=13,$target=$(e.target);if(e.keyCode==enterKeyCode){$target.blur();e.preventDefault();this.applyChanges()}}},applyChanges:function(){this.model.visualization.validate();if(this.model.visualization.isValid()){this.model.report.entry.content.set($.extend({},this.model.visualization.toJSON()));this.options.saveOnApply&&this.model.report.save();this.hide()}},render:function(){this.$el.html(PopTart.prototype.template);this.$el.append(this.template);this.children.visualizationControls.render().appendTo(this.$(".popdown-dialog-body"));this.$(".popdown-dialog-body").removeClass("popdown-dialog-padded");return this},template:'                    <div class="popdown-dialog-footer">                        <a class="viz-editor-cancel btn pull-left" tabindex="0">'+_("Cancel").t()+'</a>                        <a class="viz-editor-apply btn btn-primary pull-right" tabindex="0"> '+_("Apply").t()+"</a>                    </div>            "})});define("models/services/search/IntentionsParser",["jquery","underscore","backbone","models/Base","util/splunkd_utils","splunk.util"],function($,_,Backbone,Base,splunkDUtils,splunkUtils){var DELIMITER=":!:";return Base.extend({url:"search/intentionsparser",sync:function(method,model,options){if("read"!==method)throw new Error("Sync operation not supported: "+method);options=$.extend(!0,{},options);options.type="POST";var data=options.data;if(_.isArray(data.field)){data.field=data.field.join(DELIMITER);data.value=data.value.join(DELIMITER)}var url=options.data&&options.data.action?model.url:"search/parser",syncOptions=splunkDUtils.prepareSyncOptions(options,url);syncOptions.data&&syncOptions.data.q&&(syncOptions.data.q=splunkUtils.addLeadingSearchCommand(syncOptions.data.q,!0));return Base.prototype.sync.call(this,"read",model,syncOptions)},fullSearch:function(){var fullSearch=this.get("fullSearch");if(fullSearch)return splunkUtils.stripLeadingSearchCommand(fullSearch);var reportsSearch=this.get("reportsSearch")||"",eventsSearch=splunkUtils.stripLeadingSearchCommand(this.get("eventsSearch")||"");reportsSearch&&(reportsSearch=" | "+reportsSearch);return eventsSearch+reportsSearch},isReportsSearch:function(){var reportsSearch=this.get("reportsSearch");return reportsSearch?!0:!1}})});define("models/shared/Visualization",["jquery","underscore","util/math_utils","models/Base","util/general_utils","splunk.util"],function($,_,math_utils,BaseModel,general_utils,splunk_util){var parseFloat=math_utils.strictParseFloat,Visualization=BaseModel.extend({initialize:function(){BaseModel.prototype.initialize.apply(this,arguments);this.on("change:display.visualizations.charting.axisY.scale",function(){"line"===this.get("display.visualizations.charting.chart")&&"log"===this.get("display.visualizations.charting.axisY.scale")&&this.set({"display.visualizations.charting.chart.stackMode":"default"})},this);this.on("change:display.visualizations.charting.chart.overlayFields",function(){this.get("display.visualizations.charting.chart.overlayFields")||this.set({"display.visualizations.charting.axisY2.enabled":"0"})})},components:{single:["gen"],line:["gen","x","y","overlay","leg"],area:["gen","x","y","overlay","leg"],column:["gen","x","y","overlay","leg"],bar:["gen","x","y","overlay","leg"],pie:["gen"],scatter:["gen","x","y","leg"],radialGauge:["gen","ranges"],fillerGauge:["gen","ranges"],markerGauge:["gen","ranges"],statistics:["statistics"],events:["events"],mapping:["gen","map","markers","tiles"]},defaults:{"display.visualizations.charting.axisY.scale":"linear","display.visualizations.charting.axisY2.scale":"inherit","display.visualizations.charting.axisX.scale":"linear","display.visualizations.charting.axisX.minimumNumber":"","display.visualizations.charting.axisX.maximumNumber":"","display.visualizations.charting.axisY.minimumNumber":"","display.visualizations.charting.axisY.maximumNumber":"","display.visualizations.charting.axisTitleX.text":"","display.visualizations.charting.axisTitleY.text":"","display.visualizations.charting.axisLabelsX.majorUnit":"","display.visualizations.charting.axisLabelsY.majorUnit":"","display.visualizations.charting.axisLabelsX.majorLabelStyle.overflowMode":"ellipsisNone","display.visualizations.charting.axisLabelsX.majorLabelStyle.rotation":"0","display.visualizations.charting.legend.placement":"right","display.visualizations.charting.legend.labelStyle.overflowMode":"ellipsisMiddle","display.visualizations.charting.chart.stackMode":"default","display.visualizations.charting.layout.splitSeries":"0","display.visualizations.charting.drilldown":"all","display.visualizations.charting.chart.nullValueMode":"gaps","display.visualizations.charting.chart.sliceCollapsingThreshold":.01,"display.visualizations.charting.chart.rangeValues":'["0","30","70","100"]',"display.visualizations.charting.chart.style":"shiny","display.visualizations.charting.gaugeColors":[8710400,16771072,12529712],"display.visualizations.mapping.drilldown":"all","display.visualizations.mapping.map.center":"(0,0)","display.visualizations.mapping.map.zoom":"2","display.visualizations.mapping.markerLayer.markerOpacity":"0.8","display.visualizations.mapping.markerLayer.markerMinSize":"10","display.visualizations.mapping.markerLayer.markerMaxSize":"50","display.visualizations.mapping.data.maxClusters":"100","display.visualizations.mapping.tileLayer.minZoom":"0","display.visualizations.mapping.tileLayer.maxZoom":"7","display.prefs.events.count":"10","display.prefs.statistics.count":"10","display.events.type":"list","display.events.rowNumbers":"0","display.events.maxLines":"5","display.events.raw.drilldown":"full","display.events.list.drilldown":"full","display.events.list.wrap":"1","display.events.table.drilldown":"1","display.events.table.wrap":"1","display.statistics.drilldown":"cell","display.statistics.rowNumbers":"0","display.statistics.wrap":"1","display.statistics.overlay":"none"},validation:{"display.visualizations.charting.chart.stackMode":[{oneOf:["default","stacked","stacked100"],required:!0,msg:_("Stack Mode must be default, stacked, or stacked100").t()},{fn:"validateYScaleAndStacking"}],"display.visualizations.charting.layout.splitSeries":{fn:"validateBoolean",required:!0},"display.visualizations.charting.drilldown":{oneOf:["all","none"],required:!0,msg:_("Chart Drilldown must be all or none").t()},"display.visualizations.charting.chart.nullValueMode":{oneOf:["zero","connect","gaps"],required:!0,msg:_("Null Value Mode must be zero, connect, or gaps").t()},"display.visualizations.charting.legend.placement":{oneOf:["right","left","top","bottom","none"],required:!0,msg:_("Legend Placement must be right, left, top, bottom, or none").t()},"display.visualizations.charting.legend.labelStyle.overflowMode":{oneOf:["ellipsisMiddle","ellipsisStart","ellipsisEnd"],required:!0,msg:_("Legend Truncation must be ellipsisMiddle, ellipsisStart, or ellipsisEnd").t()},"display.visualizations.charting.axisX.minimumNumber":[{fn:"validateNumberOrAuto",required:!1},{fn:"validateXAxisExtremes",required:!1}],"display.visualizations.charting.axisX.maximumNumber":[{fn:"validateNumberOrAuto",required:!1},{fn:"validateXAxisExtremes",required:!1}],"display.visualizations.charting.axisY.minimumNumber":[{fn:"validateNumberOrAuto",required:!1},{fn:"validateYAxisExtremes",required:!1}],"display.visualizations.charting.axisY.maximumNumber":[{fn:"validateNumberOrAuto",required:!1},{fn:"validateYAxisExtremes",required:!1}],"display.visualizations.charting.axisY2.minimumNumber":[{fn:"validateNumberOrAuto",required:!1},{fn:"validateYAxis2Extremes",required:!1}],"display.visualizations.charting.axisY2.maximumNumber":[{fn:"validateNumberOrAuto",required:!1},{fn:"validateYAxis2Extremes",required:!1}],"display.visualizations.charting.axisLabelsX.majorUnit":[{fn:"validatePositiveNumberOrAuto",required:!1}],"display.visualizations.charting.axisLabelsY.majorUnit":[{fn:"validatePositiveNumberOrAuto",required:!1}],"display.visualizations.charting.axisLabelsY2.majorUnit":[{fn:"validatePositiveNumberOrAuto",required:!1}],"display.visualizations.charting.axisLabelsX.majorLabelStyle.rotation":{oneOf:["-90","-45","0","45","90"],required:!0,msg:_("Axis Label Rotation must be -90, -45, 0, 45, or 90").t()},"display.visualizations.charting.axisLabelsX.majorLabelStyle.overflowMode":{oneOf:["ellipsisNone","ellipsisMiddle"],required:!0,msg:_("Axis Label overflow mode must be ellipsisNone or ellipsisMiddle").t()},"display.visualizations.charting.axisY.scale":[{oneOf:["linear","log"],required:!0,msg:_("Y-Axis Scale must be linear or log").t()},{fn:"validateYScaleAndStacking"}],"display.visualizations.charting.axisX.scale":{oneOf:["linear","log"],required:!0,msg:_("X-Axis Scale must be linear or log").t()},"display.visualizations.charting.axisY2.scale":{oneOf:["linear","log","inherit"],required:!0,msg:_("X-Axis Scale must be linear, log, or inherit").t()},"display.visualizations.charting.chart.sliceCollapsingThreshold":{pattern:"number",min:0,msg:_("Minimum Size must be a non-negative number.").t(),required:!0},"display.visualizations.charting.chart.rangeValues":{fn:"validateRangeValues",required:!1},"display.visualizations.charting.chart.style":{oneOf:["shiny","minimal"],required:!0,msg:_("Gauge Style must be shiny or minimal").t()},"display.visualizations.mapping.drilldown":{oneOf:["all","none"],required:!0,msg:_("Drilldown must be all or none").t()},"display.visualizations.mapping.map.center":{pattern:/^\s*\(([-+.0-9]+)\s*,\s*([-+.0-9]+)\)\s*$/,required:!0,msg:_("Latitude and Longitude must be valid numbers").t()},"display.visualizations.mapping.map.zoom":{pattern:"digits",required:!0,min:0,msg:_("Zoom must be a non-negative integer").t()},"display.visualizations.mapping.markerLayer.markerOpacity":{pattern:"number",required:!0,min:0,max:1,msg:_("Marker Opacity must be between 0 and 100%").t()},"display.visualizations.mapping.markerLayer.markerMinSize":[{pattern:"digits",required:!0,min:1,msg:_("Minimum Size must be a positive integer").t()},{fn:"validateMapMarkerSize"}],"display.visualizations.mapping.markerLayer.markerMaxSize":[{pattern:"digits",required:!0,min:1,msg:_("Maximum Size must be a positive integer").t()},{fn:"validateMapMarkerSize"}],"display.visualizations.mapping.data.maxClusters":{pattern:"digits",required:!0,min:0,msg:_("Max Clusters must be a non-negative integer").t()},"display.visualizations.mapping.tileLayer.minZoom":[{pattern:"digits",required:!0,min:0,msg:_("Minimum Zoom must be a non-negative integer").t()},{fn:"validateMapTileLayerZoom"}],"display.visualizations.mapping.tileLayer.maxZoom":[{pattern:"digits",required:!0,min:0,msg:_("Maximum Zoom must be a non-negative integer").t()},{fn:"validateMapTileLayerZoom"}],"display.prefs.events.count":{pattern:"digits",min:1,max:100,msg:_("Rows Per Page must be a positive number no larger than 100.").t(),required:!0},"display.events.type":{oneOf:["list","raw","table"],required:!0,msg:_("Event Display Type must be list, raw, or table").t()},"display.events.raw.drilldown":{oneOf:["full","none","inner","outer"],required:!0,msg:_("Event Drilldown must be full, none, inner, or outer").t()},"display.events.list.drilldown":{oneOf:["full","none","inner","outer"],required:!0,msg:_("Event Drilldown must be full, none, inner, or outer").t()},"display.events.table.drilldown":{fn:"validateBoolean",required:!0},"display.events.rowNumbers":{fn:"validateBoolean",required:!0},"display.events.list.wrap":{fn:"validateBoolean",required:!0},"display.events.table.wrap":{fn:"validateBoolean",required:!0},"display.events.maxLines":{oneOf:["0","5","10","20","50","100","200"],required:!0,msg:_("Max Lines must 0, 5, 10, 20, 50, 100, or 200").t()},"display.prefs.statistics.count":{pattern:"digits",min:1,max:100,msg:_("Rows Per Page must be a positive number no larger than 100.").t(),required:!0},"display.statistics.drilldown":{oneOf:["row","cell","none"],required:!0,msg:_("Statistics Drilldown must be row, cell, or none").t()},"display.statistics.overlay":{oneOf:["none","heatmap","highlow"],required:!0,msg:_("Data Overlay must be none, heatmap, or highlow").t()},"display.statistics.rowNumbers":{fn:"validateBoolean",required:!0},"display.statistics.wrap":{fn:"validateBoolean",required:!0}},validateXAxisExtremes:function(value,attr,computedState){var min=parseFloat("display.visualizations.charting.axisX.minimumNumber"===attr?value:computedState["display.visualizations.charting.axisX.minimumNumber"]),max=parseFloat("display.visualizations.charting.axisX.maximumNumber"===attr?value:computedState["display.visualizations.charting.axisX.maximumNumber"]);return!_.isNaN(min)&&!_.isNaN(max)&&min>=max?_("The X-Axis Min Value must be less than the Max Value.").t():void 0},validateYAxisExtremes:function(value,attr,computedState){var min=parseFloat("display.visualizations.charting.axisY.minimumNumber"===attr?value:computedState["display.visualizations.charting.axisY.minimumNumber"]),max=parseFloat("display.visualizations.charting.axisY.maximumNumber"===attr?value:computedState["display.visualizations.charting.axisY.maximumNumber"]);return!_.isNaN(min)&&!_.isNaN(max)&&min>=max?_("The Y-Axis Min Value must be less than the Max Value.").t():void 0},validateYAxis2Extremes:function(value,attr,computedState){var min=parseFloat("display.visualizations.charting.axisY2.minimumNumber"===attr?value:computedState["display.visualizations.charting.axisY2.minimumNumber"]),max=parseFloat("display.visualizations.charting.axisY2.maximumNumber"===attr?value:computedState["display.visualizations.charting.axisY2.maximumNumber"]);return!_.isNaN(min)&&!_.isNaN(max)&&min>=max?_("The Y-Axis Min Value must be less than the Max Value.").t():void 0},validateYScaleAndStacking:function(value,attr,computedState){if("line"===computedState["display.visualizations.charting.chart"])return!1;var yAxisScale="display.visualizations.charting.axisY.scale"===attr?value:computedState["display.visualizations.charting.axisY.scale"],stackMode="display.visualizations.charting.chart.stackMode"===attr?value:computedState["display.visualizations.charting.chart.stackMode"];return"log"===yAxisScale&&"default"!==stackMode?_("Log scale and stacking cannot be enabled at the same time.").t():void 0},validateRangeValues:function(value){var ranges;try{ranges=_(value?JSON.parse(value):[]).map(parseFloat)}catch(e){return _('Ranges must be of the form: ["0","30","70","100"]').t()}if(_(ranges).any(_.isNaN))return _("All color ranges must be valid numbers.").t();var filteredRanges=Visualization.filterToValidRangeValues(ranges);return _.isEqual(ranges,filteredRanges)?void 0:_("Color ranges must be entered from lowest to highest.").t()},validateMapMarkerSize:function(value,attr,computedState){var min=parseFloat("display.visualizations.mapping.markerLayer.markerMinSize"===attr?value:computedState["display.visualizations.mapping.markerLayer.markerMinSize"]),max=parseFloat("display.visualizations.mapping.markerLayer.markerMaxSize"===attr?value:computedState["display.visualizations.mapping.markerLayer.markerMaxSize"]);return!_.isNaN(min)&&!_.isNaN(max)&&min>=max?_("The Min Size must be less than the Max Size.").t():void 0},validateMapTileLayerZoom:function(value,attr,computedState){var min=parseFloat("display.visualizations.mapping.tileLayer.minZoom"===attr?value:computedState["display.visualizations.mapping.tileLayer.minZoom"]),max=parseFloat("display.visualizations.mapping.tileLayer.maxZoom"===attr?value:computedState["display.visualizations.mapping.tileLayer.maxZoom"]);return!_.isNaN(min)&&!_.isNaN(max)&&min>=max?_("The Min Zoom must be less than the Max Zoom.").t():void 0},validateNumberOrAuto:function(value,attr){var num=parseFloat(value);return value&&_.isNaN(num)&&!value.match(/^(auto)$/)?splunk_util.sprintf(_('%s must be a number or "auto".').t(),this.humanizeAttr(attr)):void 0},validatePositiveNumberOrAuto:function(value,attr,computedState){var numberOrAutoValidation=this.validateNumberOrAuto(value,attr,computedState);if(numberOrAutoValidation)return numberOrAutoValidation;var num=parseFloat(value);return!_.isNaN(num)&&0>=num?splunk_util.sprintf(_('%s must be a positive number or "auto".').t(),this.humanizeAttr(attr)):void 0},validateBoolean:function(value,attr){return general_utils.isBooleanEquivalent(value)?void 0:splunk_util.sprintf(_("%s must be a valid boolean value").t(),this.humanizeAttr(attr))},humanizeAttr:function(attr){switch(attr){case"display.visualizations.charting.axisLabelsX.majorUnit":return _("X-Axis Interval").t();case"display.visualizations.charting.axisLabelsY.majorUnit":case"display.visualizations.charting.axisLabelsY2.majorUnit":return _("Y-Axis Interval").t();case"display.visualizations.charting.axisX.minimumNumber":return _("X-Axis Min Value").t();case"display.visualizations.charting.axisY.minimumNumber":case"display.visualizations.charting.axisY2.minimumNumber":return _("Y-Axis Min Value").t();case"display.visualizations.charting.axisX.maximumNumber":return _("X-Axis Max Value").t();case"display.visualizations.charting.axisY.maximumNumber":case"display.visualizations.charting.axisY2.maximumNumber":return _("Y-Axis Max Value").t();case"display.visualizations.charting.layout.splitSeries":return _("Split Series Mode").t();case"display.events.table.drilldown":return _("Event Drilldown").t();case"display.statistics.wrap":case"display.events.list.wrap":case"display.events.table.wrap":return _("Wrap Results").t();case"display.statistics.rowNumber":case"display.events.rowNumbers":return _("Row Numbers").t();default:return attr}},attrToArray:function(attr){return Visualization.parseStringifiedArray(this.get(attr))},rangesValuesToArray:function(){return this.attrToArray("display.visualizations.charting.chart.rangeValues")},deserializeGaugeColorArray:function(){return Visualization.parseStringifiedColorArray(this.get("display.visualizations.charting.gaugeColors"))},gaugeIsInAutoMode:function(){return!this.get("display.visualizations.charting.chart.rangeValues")&&!this.get("display.visualizations.charting.gaugeColors")}},{CHARTING_ATTRS_FILTER:["^display.visualizations.charting...*"],SINGLE_VALUE_ATTRS_FILTER:["^singlevalue..*"],filterToValidRangeValues:function(rangeValues){_(rangeValues).isString()&&(rangeValues=Visualization.parseStringifiedArray(rangeValues));rangeValues=_(rangeValues).chain().map(parseFloat).filter(function(val){return!_(val).isNaN()}).uniq().value();var runningMax=-1/0;rangeValues=_(rangeValues).filter(function(val){if(runningMax>val)return!1;runningMax=val;return!0});return rangeValues},parseStringifiedArray:function(value){if(!value)return[];var parsedValues=[];try{parsedValues=_.values(JSON.parse(value))}catch(e){}return parsedValues},parseStringifiedColorArray:function(value){return _(value).isArray()?value:value&&"["===value.charAt(0)&&"]"===value.charAt(value.length-1)?splunk_util.stringToFieldList(value.substring(1,value.length-1)):!1}});return Visualization});define("views/shared/vizcontrols/Master",["jquery","underscore","backbone","module","views/Base","views/shared/controls/SyntheticSelectControl","views/shared/vizcontrols/Format","models/services/search/IntentionsParser","models/shared/Visualization"],function($,_,Backbone,module,BaseView,SyntheticSelectControl,Format,IntentionsParser,VisualizationModel){return BaseView.extend({moduleId:module.id,vizToAttrs:{line:{"display.visualizations.charting.chart":"line","display.visualizations.type":"charting","display.general.type":"visualizations"},area:{"display.visualizations.charting.chart":"area","display.visualizations.type":"charting","display.general.type":"visualizations"},column:{"display.visualizations.charting.chart":"column","display.visualizations.type":"charting","display.general.type":"visualizations"},bar:{"display.visualizations.charting.chart":"bar","display.visualizations.type":"charting","display.general.type":"visualizations"},pie:{"display.visualizations.charting.chart":"pie","display.visualizations.type":"charting","display.general.type":"visualizations"},scatter:{"display.visualizations.charting.chart":"scatter","display.visualizations.type":"charting","display.general.type":"visualizations"},radialGauge:{"display.visualizations.charting.chart":"radialGauge","display.visualizations.type":"charting","display.general.type":"visualizations"},fillerGauge:{"display.visualizations.charting.chart":"fillerGauge","display.visualizations.type":"charting","display.general.type":"visualizations"},markerGauge:{"display.visualizations.charting.chart":"markerGauge","display.visualizations.type":"charting","display.general.type":"visualizations"},single:{"display.visualizations.type":"singlevalue","display.general.type":"visualizations"},events:{"display.general.type":"events"},statistics:{"display.general.type":"statistics"},mapping:{"display.visualizations.type":"mapping","display.general.type":"visualizations"}},visualizationGroupings:{events:{label:"g1",items:[{value:"events",label:_("Events").t(),icon:"list"}]},statistics:{label:"g2",items:[{value:"statistics",label:_("Statistics Table").t(),icon:"table"}]},visualizations:{label:"g3",items:[{value:"line",label:_("Line").t(),icon:"chart-line"},{value:"area",label:_("Area").t(),icon:"chart-area"},{value:"column",label:_("Column").t(),icon:"chart-column"},{value:"bar",label:_("Bar").t(),icon:"chart-bar"},{value:"pie",label:_("Pie").t(),icon:"chart-pie"},{value:"scatter",label:_("Scatter").t(),icon:"chart-scatter"},{value:"single",label:_("Single Value").t(),icon:"single-value"},{value:"radialGauge",label:_("Radial Gauge").t(),icon:"gauge-radial"},{value:"fillerGauge",label:_("Filler Gauge").t(),icon:"gauge-filler"},{value:"markerGauge",label:_("Marker Gauge").t(),icon:"gauge-marker"},{value:"mapping",label:_("Map").t(),icon:"location"}]}},reportTree:{match:{"display.general.type":{visualizations:{match:{"display.visualizations.type":{singlevalue:{view:"single"},charting:{match:{"display.visualizations.charting.chart":{line:{view:"line"},area:{view:"area"},column:{view:"column"},bar:{view:"bar"},pie:{view:"pie"},scatter:{view:"scatter"},radialGauge:{view:"radialGauge"},fillerGauge:{view:"fillerGauge"},markerGauge:{view:"markerGauge"}}}},mapping:{view:"mapping"}}}},statistics:{view:"statistics"},events:{view:"events"}}}},commandToChartType:{timechart:["line","area","column","statistics"],top:["column","bar","pie","statistics"],rare:["column","bar","pie","statistics"],predict:["line","statistics"],geostats:["mapping"]},allowedVizTypes:["events","statistics","visualizations"],events:{"click .format":function(e){e.preventDefault();
var $target=$(e.currentTarget);this.setVisualizationFromReport();this.children.format=new Format({model:{report:this.model.report,visualization:this.model.visualization},onHiddenRemove:!0,saveOnApply:this.options.saveOnApply,ignoreClasses:["color-picker-container","select2-drop","select2-drop-mask","dropdown-menu"]});this.children.format.render().activate().appendTo($("body"));this.children.format.show($target);$target.addClass("active");this.listenTo(this.children.format,"hidden",function(){$target.removeClass("active")})}},initialize:function(){BaseView.prototype.initialize.apply(this,arguments);var defaults={bindToChangeOfSearch:!0,saveOnApply:!1};this.options=$.extend(!0,defaults,this.options);this.recommendations=[];if(!_.isArray(this.options.vizTypes)||0===this.options.vizTypes.length)throw new Error("Vizcontrols Master must be instantiated with at least one viz type");_(this.options.vizTypes).each(function(type){if(!_(this.allowedVizTypes).contains(type))throw new Error(type+" is not an allowed viz type")},this);this.model.intentionsParser=new IntentionsParser;this.model.visualization=new VisualizationModel;this.activate()},startListening:function(){this.listenTo(this.model.intentionsParser,"change",this.handleIntentionsParserUpdate);this.listenTo(this.model.report.entry.content,"change:display.general.type",function(model,value){_.indexOf(this.options.vizTypes,value)>-1&&this.updateVizTypeChildView({activate:!0})});this.listenTo(this.model.visualization,"change:viz_type",function(){var viz=this.model.visualization.get("viz_type");this.model.report.entry.content.set("viz_type",viz);this.model.report.entry.content.set(this.vizToAttrs[viz]);this.model.visualization.set(this.vizToAttrs[viz]);this.options.saveOnApply&&this.model.report.save()});this.listenTo(this.model.report.entry.content,"change:search change:id",this.updateVizTypeVisibility);this.options.bindToChangeOfSearch&&this.listenTo(this.model.report.entry.content,"change:search",this.intentionsFetch)},activate:function(){if(this.active)return BaseView.prototype.activate.apply(this,arguments);this.model.visualization.set({dashboard:this.options.dashboard});this.updateVizTypeChildView({activate:!1});this.intentionsFetch();return BaseView.prototype.activate.apply(this,arguments)},deactivate:function(){if(!this.active)return BaseView.prototype.deactivate.apply(this,arguments);BaseView.prototype.deactivate.apply(this,arguments);this.model.intentionsParser.fetchAbort();this.model.intentionsParser.clear({setDefaults:!0});this.model.visualization.clear({setDefaults:!0});return this},intentionsFetch:function(){this.model.intentionsParser.fetch({data:{q:this.model.report.entry.content.get("search"),app:this.model.application.get("app"),owner:this.model.application.get("owner"),parse_only:!0}})},handleIntentionsParserUpdate:function(){var newRecommendations=this.getRecommendations();if(!_.isEqual(newRecommendations,this.recommendations)){this.recommendations=newRecommendations;this.updateVizTypeChildView({activate:!0})}},updateVizTypeVisibility:function(){if(this.children.visualizationType&&this.model.visualization.get("dashboard"))if(this.model.report.isPivotReport()&&!this.model.report.isNew()){this.children.visualizationType.disable();this.children.visualizationType.tooltip({animation:!1,title:_("Edit visualization with the pivot tool.").t(),container:"body"})}else{this.children.visualizationType.enable();this.children.visualizationType.tooltip("disable")}},getRecommendations:function(){var reportsSearch=this.model.intentionsParser.get("reportsSearch");if(!reportsSearch)return["events"];var reportingCommand=reportsSearch.replace(/\s{2,}/g,":::").split(":::")[0];if(this.model.intentionsParser.has("commands")){var commands=_(this.model.intentionsParser.get("commands")).pluck("command");_(commands).contains("predict")?reportingCommand="predict":_(commands).contains("geostats")&&(reportingCommand="geostats")}return this.commandToChartType[reportingCommand]||[]},setVisualizationFromReport:function(){this.model.report.entry.content.unset("viz_type");var toSetOnViz=$.extend({},this.model.report.entry.content.toJSON()),validRanges=VisualizationModel.filterToValidRangeValues(toSetOnViz["display.visualizations.charting.chart.rangeValues"]);toSetOnViz["display.visualizations.charting.chart.rangeValues"]=validRanges.length>0?JSON.stringify(validRanges):"";var validColors=VisualizationModel.parseStringifiedColorArray(toSetOnViz["display.visualizations.charting.gaugeColors"]);toSetOnViz["display.visualizations.charting.gaugeColors"]=validColors&&validColors.length>0?validColors:"";_(toSetOnViz).each(function(value,key){this.model.visualization.preValidate(key,value)&&delete toSetOnViz[key]},this);this.model.visualization.set(toSetOnViz);var view,viewObj=this.setVizType(this.reportTree);view=viewObj&&viewObj.view?viewObj.view:"column";this.model.visualization.set("viz_type",view)},updateVizTypeChildView:function(options){this.children.visualizationType&&this.children.visualizationType.remove();this.setVisualizationFromReport();var vizDropdown=[];_(this.options.vizTypes).each(function(value){var groupConfig=$.extend(!0,{},this.visualizationGroupings[value]);_(groupConfig.items).each(function(item){_(this.recommendations).contains(item.value)&&(item.description=_("Recommended").t())},this);vizDropdown.push(groupConfig)},this);if(0===vizDropdown.length)throw new Error("Vizcontrols Master updateVizTypeChildView(), no compatible groups");this.children.visualizationType=new SyntheticSelectControl({model:this.model.visualization,groupedItems:vizDropdown,className:"dropdown pull-left",toggleClassName:"btn-pill",modelAttribute:"viz_type",menuClassName:"viz-dropdown",popdownOptions:{attachDialogTo:"body"}});this.children.visualizationType.render().prependTo(this.el);options&&options.activate&&this.children.visualizationType.activate();this.updateVizTypeVisibility()},setVizType:function(reportTree){if(reportTree&&reportTree.view)return reportTree;if(reportTree&&reportTree.match){var match;_(reportTree.match).each(function(v,k){match=v[this.model.report.entry.content.get(k)]},this);if(match)return this.setVizType(match)}},render:function(){this.children.visualizationType&&this.children.visualizationType.detach();this.$el.empty();this.children.visualizationType&&this.children.visualizationType.prependTo(this.el);this.$el.append(this.compiledTemplate());return this},template:'                <div class="btn-group pull-left">                    <a class="btn-pill popdown-toggle format" href="#">                        <i class="icon-paintbrush"/><span class="link-label"><%- _("Format").t() %></span><span class="caret"></span>                    </a>                </div>            '})});define("views/shared/reportcontrols/details/History",["module","views/Base"],function(module,Base){return Base.extend({moduleId:module.id,tagName:"span",initialize:function(){Base.prototype.initialize.apply(this,arguments);this.model.entry.on("change:updated",this.render,this)},render:function(){this.$el.html(this.compiledTemplate({model:this.model}));return this},template:'                Created June 18, 2010. Modified <%- model.entry.get("updated") %>.            '})});define("views/shared/reportcontrols/details/Creator",["underscore","module","views/Base","uri/route","splunk.util"],function(_,module,Base,route,splunkUtil){return Base.extend({moduleId:module.id,tagName:"span",initialize:function(){Base.prototype.initialize.apply(this,arguments);this.model.report.entry.content.on("change:display.page.pivot.dataModel",this.render,this)},render:function(){var createdByRoute,createdByAnchor,root=this.model.application.get("root"),locale=this.model.application.get("locale"),app=this.model.application.get("app");if("pivot"===this.model.report.openInView()){createdByRoute=route.pivot(root,locale,app,{data:{s:this.model.report.id}});createdByAnchor='<a href="'+createdByRoute+'" >'+_("Pivot").t()+"</a>"}else{createdByRoute=route.search(root,locale,app,{data:{s:this.model.report.id}});createdByAnchor='<a href="'+createdByRoute+'" >'+_("Search").t()+"</a>"}this.$el.html(this.compiledTemplate({_:_,splunkUtil:splunkUtil,createdByAnchor:createdByAnchor}));return this},template:'                <%= splunkUtil.sprintf(_("Created by %s.").t(), createdByAnchor) %>            '})});define("views/shared/documentcontrols/details/App",["module","views/Base"],function(module,Base){return Base.extend({moduleId:module.id,tagName:"span",initialize:function(){Base.prototype.initialize.apply(this,arguments);this.model.entry.acl.on("change:app",this.render,this)},render:function(){this.$el.html(this.compiledTemplate({model:this.model}));return this},template:'                <%- model.entry.acl.get("app") %>            '})});define("models/shared/Cron",["jquery","underscore","models/Base","splunk.util"],function($,_,BaseModel,splunkUtil){var Cron=BaseModel.extend({initialize:function(){BaseModel.prototype.initialize.apply(this,arguments)},defaults:{minute:"0",hour:"6",dayOfMonth:"*",month:"*",dayOfWeek:"1",cronType:"weekly",cron_schedule:"0 6 * * 1"},validation:{cron_schedule:function(value,attr,computedState){var type=computedState["ui.type"]||"scheduled";if("scheduled"===type&&"custom"===computedState["cronType"]){if(_.isUndefined(value)||0===$.trim(value).length)return _("Custom cron is required").t();if(!splunkUtil.validateCronString(value))return _("Invalid cron").t()}}},setCronType:function(options){var minute=this.get("minute"),hour=this.get("hour"),dayOfMonth=this.get("dayOfMonth"),month=this.get("month"),dayOfWeek=this.get("dayOfWeek");if("*"===month){if(/^[0-6]$/.test(dayOfWeek)){if("0"===minute&&/^([0-9]|1[0-9]|2[0-3])$/.test(hour)&&"*"===dayOfMonth){this.set("cronType",Cron.CRON_TYPES.WEEKLY,options);return}}else if("*"===dayOfWeek)if(/^([0-9]|[1-2][0-9]|3[0-1])$/.test(dayOfMonth)){if(/^([0-9]|1[0-9]|2[0-3])$/.test(hour)&&"0"===minute){this.set("cronType",Cron.CRON_TYPES.MONTHLY,options);return}}else if("*"===dayOfMonth){if(/^([0-9]|1[0-9]|2[0-3])$/.test(hour)&&"0"===minute){this.set("cronType",Cron.CRON_TYPES.DAILY,options);return}if("*"===hour&&/^(0|15|30|45)$/.test(minute)){this.set("cronType",Cron.CRON_TYPES.HOURLY,options);return}}this.set("cronType",Cron.CRON_TYPES.CUSTOM,options)}else this.set("cronType",Cron.CRON_TYPES.CUSTOM,options)},setDefaults:function(){switch(this.get("cronType")){case Cron.CRON_TYPES.HOURLY:this.set("minute","0");break;case Cron.CRON_TYPES.DAILY:this.set("hour","0");break;case Cron.CRON_TYPES.WEEKLY:this.set({dayOfWeek:"1",hour:"0"});break;case Cron.CRON_TYPES.MONTHLY:this.set({dayOfMonth:"1",hour:"0"})}},getCronString:function(){var minute=this.get("minute"),hour=this.get("hour"),dayOfMonth=this.get("dayOfMonth"),dayOfWeek=(this.get("month"),this.get("dayOfWeek")),cron_schedule=this.get("cron_schedule"),cronType=this.get("cronType");switch(cronType){case Cron.CRON_TYPES.HOURLY:return minute+" * * * *";case Cron.CRON_TYPES.DAILY:return"0 "+hour+" * * *";case Cron.CRON_TYPES.WEEKLY:return"0 "+hour+" * * "+dayOfWeek;case Cron.CRON_TYPES.MONTHLY:return"0 "+hour+" "+dayOfMonth+" * *";case Cron.CRON_TYPES.CUSTOM:return cron_schedule}},getDayOfWeekName:function(){return Cron.getDayOfWeekNameFromNum(parseInt(this.get("dayOfWeek"),10))},getScheduleString:function(){switch(this.get("cronType")){case"hourly":return splunkUtil.sprintf(_("Hourly, at %s minutes past the hour.").t(),this.get("minute"));case"daily":return splunkUtil.sprintf(_("Daily, at %s:00.").t(),this.get("hour"));case"weekly":return splunkUtil.sprintf(_("Weekly, %(dayOfWeek)s at %(hour)s:00.").t(),{dayOfWeek:this.getDayOfWeekName(),hour:this.get("hour")});case"monthly":return splunkUtil.sprintf(_("Monthly, on day %(dayOfMonth)s at %(hour)s:00.").t(),{dayOfMonth:this.get("dayOfMonth"),hour:this.get("hour")});case"custom":return _("Cron Schedule.").t()}}},{createFromCronString:function(cronString){var pieces=cronString.trim().split(/\s+/);if(!pieces||5!==pieces.length)throw splunkUtil.sprintf(_("Invalid cron string: %s").t(),cronString);var cronModel=new Cron({minute:pieces[0],hour:pieces[1],dayOfMonth:pieces[2],month:pieces[3],dayOfWeek:pieces[4],cron_schedule:pieces.join(" ")});cronModel.setCronType();return cronModel},getDayOfWeekNameFromNum:function(dayOfWeekNum){switch(dayOfWeekNum){case 0:return _("Sunday").t();case 1:return _("Monday").t();case 2:return _("Tuesday").t();case 3:return _("Wednesday").t();case 4:return _("Thursday").t();case 5:return _("Friday").t();case 6:return _("Saturday").t();case 7:return _("Sunday").t()}},CRON_TYPES:{HOURLY:"hourly",DAILY:"daily",WEEKLY:"weekly",MONTHLY:"monthly",CUSTOM:"custom"}});return Cron});define("views/shared/reportcontrols/details/Schedule",["underscore","module","views/Base","models/shared/Cron","util/time","splunk.util"],function(_,module,Base,Cron,time_utils,splunkUtil){return Base.extend({moduleId:module.id,tagName:"span",initialize:function(){Base.prototype.initialize.apply(this,arguments);var render=_.debounce(this.render,0);this.model.entry.content.on("change:is_scheduled change:cron_schedule change:action.email change:action.script",render,this)},render:function(){var text=_("Not Applicable for Real-time Reports.").t();if(!this.model.isRealTime())if(this.model.entry.content.get("is_scheduled")){this.cronModel=Cron.createFromCronString(this.model.entry.content.get("cron_schedule"));text=this.cronModel.getScheduleString();text+=this.model.entry.content.get("action.email")||this.model.entry.content.get("action.script")?splunkUtil.sprintf(_(" Actions: %s.").t(),this.model.getStringOfActions()):_(" No actions.").t()}else text=_("Not scheduled.").t();this.$el.html(text)}})});define("views/shared/delegates/ModalTimerangePicker",["jquery","underscore","views/shared/delegates/Base","views/shared/delegates/PopdownDialog","views/shared/Modal"],function($,_,DelegateBase,PopdownDialog,Modal){return DelegateBase.extend({initialize:function(){var defaults={SLIDE_ANIMATION_DURATION:500};_.defaults(this.options,defaults);this.$visArea=this.options.$visArea;this.$slideArea=this.options.$slideArea;this.$contentWrapper=this.options.$contentWrapper;this.$timeRangePickerWrapper=this.options.$timeRangePickerWrapper;this.$modalParent=this.options.$modalParent;this.$timeRangePicker=this.options.$timeRangePicker;this.title=this.$(Modal.HEADER_TITLE_SELECTOR).html();this.events={};this.events["click "+this.options.backButtonSelector]="closeTimeRangePicker";this.events["click "+this.options.activateSelector]="showTimeRangePicker";this.delegateEvents(this.events);this.$timeRangePicker.hide()},showTimeRangePicker:function(e){var $from=this.$contentWrapper,$to=this.$timeRangePickerWrapper,anamateDistance=$from.width();this.onBeforePaneAnimation($from,$to);var toWidth=$to.width(),toHeight=$to.height();this.$modalParent.animate({width:toWidth,marginLeft:-(2*anamateDistance/3)},{duration:this.options.SLIDE_ANIMATION_DURATION});this.$visArea.animate({height:toHeight},{duration:this.options.SLIDE_ANIMATION_DURATION,complete:function(){this.onAfterPaneAnimation($from,$to)}.bind(this)},this);this.$slideArea.animate({marginLeft:-anamateDistance},{duration:this.options.SLIDE_ANIMATION_DURATION});this.$el.animate({width:toWidth},{duration:this.options.SLIDE_ANIMATION_DURATION});this.$(Modal.HEADER_TITLE_SELECTOR).html(_("Select Time Range").t());this.$(".btn.back").show();this.$(".btn-primary").hide();this.$(".btn.cancel").hide();e&&e.preventDefault()},closeTimeRangePicker:function(e){var $from=this.$timeRangePickerWrapper,$to=this.$contentWrapper,anamateDistance=$to.width();this.onBeforePaneAnimation($from,$to);this.$modalParent.animate({width:anamateDistance,marginLeft:-(anamateDistance/2)},{duration:this.options.SLIDE_ANIMATION_DURATION,complete:function(){this.$modalParent.css({width:""});this.$modalParent.css({marginLeft:""})}.bind(this)});this.$visArea.animate({height:$to.height()},{duration:this.options.SLIDE_ANIMATION_DURATION,complete:function(){this.onAfterPaneAnimation($from,$to)}.bind(this)},this);this.$slideArea.animate({marginLeft:0},{duration:this.options.SLIDE_ANIMATION_DURATION});this.$el.animate({width:anamateDistance},{duration:this.options.SLIDE_ANIMATION_DURATION});this.$(Modal.HEADER_TITLE_SELECTOR).html(this.title);this.$(".btn.back").hide();this.$(".btn-primary").show();this.$(".btn.cancel").show();e&&e.preventDefault()},onBeforePaneAnimation:function($from,$to){this.$visArea.css("overflow","hidden");this.$visArea.css({height:$from.height()+"px"});$to===this.$timeRangePickerWrapper&&this.$timeRangePicker.show();$to.css({height:"",visibility:""})},onAfterPaneAnimation:function($from){$from===this.$timeRangePickerWrapper&&this.$timeRangePicker.hide();this.$visArea.css("overflow","");this.$visArea.css({height:""});$from.css({height:"2px",visibility:"hidden"})}})});define("views/shared/ScheduleSentence",["jquery","module","underscore","views/Base","views/shared/controls/ControlGroup","views/shared/controls/SyntheticSelectControl","uri/route","splunk.util"],function($,module,_,BaseView,ControlGroup,SyntheticSelectControl,route,splunkUtil){return BaseView.extend({moduleId:module.id,initialize:function(){BaseView.prototype.initialize.apply(this,arguments);var defaults={lineOneLabel:"",lineTwoLabel:""};_.defaults(this.options,defaults);var makeItems=function(num){var stringNum=num.toString();return{label:stringNum,value:stringNum}},hourly=_.map(_.range(0,46,15),makeItems),daily=_.map(_.range(24),function(num){return{label:num+":00",value:num.toString()}}),monthly=_.map(_.range(1,32),makeItems);this.children.timeRange=new ControlGroup({className:"control-group",controlType:"SyntheticSelect",controlClass:"controls-block",controlOptions:{modelAttribute:"cronType",model:this.model.cron,items:[{label:_("Run every hour").t(),value:"hourly"},{label:_("Run every day").t(),value:"daily"},{label:_("Run every week").t(),value:"weekly"},{label:_("Run every month").t(),value:"monthly"},{label:_("Run on Cron Schedule").t(),value:"custom"}],save:!1,toggleClassName:"btn",labelPosition:"outside",elastic:!0,popdownOptions:$.extend(!0,{},this.options.popdownOptions)},label:this.options.lineOneLabel});this.children.hourly=new SyntheticSelectControl({additionalClassNames:"schedule_hourly",modelAttribute:"minute",model:this.model.cron,items:hourly,save:!1,toggleClassName:"btn",labelPosition:"outside",elastic:!0,popdownOptions:$.extend(!0,{},this.options.popdownOptions)});this.children.weekly=new SyntheticSelectControl({additionalClassNames:"schedule_weekly",modelAttribute:"dayOfWeek",model:this.model.cron,items:[{label:_("Monday").t(),value:"1"},{label:_("Tuesday").t(),value:"2"},{label:_("Wednesday").t(),value:"3"},{label:_("Thursday").t(),value:"4"},{label:_("Friday").t(),value:"5"},{label:_("Saturday").t(),value:"6"},{label:_("Sunday").t(),value:"0"}],save:!1,toggleClassName:"btn",labelPosition:"outside",popdownOptions:$.extend(!0,{},this.options.popdownOptions)});this.children.monthly=new SyntheticSelectControl({menuClassName:"dropdown-menu-short",additionalClassNames:"schedule_monthly",modelAttribute:"dayOfMonth",model:this.model.cron,items:monthly,save:!1,toggleClassName:"btn",labelPosition:"outside",popdownOptions:$.extend(!0,{},this.options.popdownOptions)});this.children.daily=new SyntheticSelectControl({menuClassName:"dropdown-menu-short",additionalClassNames:"schedule_daily",modelAttribute:"hour",model:this.model.cron,items:daily,save:!1,toggleClassName:"btn",labelPosition:"outside",popdownOptions:$.extend(!0,{},this.options.popdownOptions)});this.children.scheduleOptions=new ControlGroup({controls:[this.children.hourly,this.children.weekly,this.children.monthly,this.children.daily],label:this.options.lineTwoLabel});var docRoute=route.docHelp(this.model.application.get("root"),this.model.application.get("locale"),"learnmore.alert.scheduled");this.children.cronSchedule=new ControlGroup({controlType:"Text",controlClass:"controls-block",controlOptions:{modelAttribute:"cron_schedule",model:this.model.cron},label:_("Cron Expression").t(),help:splunkUtil.sprintf(_("e.g. 00 18 *** (every day at 6PM). %s").t(),'<a href="'+docRoute+'" class="help" target="_blank" title="'+_("Splunk help").t()+'">'+_("Learn More").t()+"</a>")});this.activate()},timeRangeToggle:function(){var $preLabel=this.children.scheduleOptions.$el.find(".pre_label"),$hourPostLabel=this.children.scheduleOptions.$el.find(".hour_post_label"),$weeklyPreLabel=this.children.scheduleOptions.$el.find(".weekly_pre_label"),$monthlyPreLabel=this.children.scheduleOptions.$el.find(".monthly_pre_label"),$dailyPreLabel=this.children.scheduleOptions.$el.find(".daily_pre_label"),$customControls=this.$el.find(".custom_time");this.children.hourly.$el.hide();this.children.daily.$el.hide();this.children.weekly.$el.hide();this.children.monthly.$el.hide();$preLabel.hide();$hourPostLabel.hide();$weeklyPreLabel.hide();$monthlyPreLabel.hide();$dailyPreLabel.hide();$customControls.css("display","none");switch(this.model.cron.get("cronType")){case"hourly":this.children.scheduleOptions.$el.show();this.children.hourly.$el.css("display","");$preLabel.css("display","");$hourPostLabel.css("display","");break;case"daily":this.children.scheduleOptions.$el.show();this.children.daily.$el.css("display","");$preLabel.css("display","");break;case"weekly":this.children.scheduleOptions.$el.show();this.children.weekly.$el.css("display","");this.children.daily.$el.css("display","");$weeklyPreLabel.css("display","");$dailyPreLabel.css("display","");break;case"monthly":this.children.scheduleOptions.$el.show();this.children.monthly.$el.css("display","");this.children.daily.$el.css("display","");$monthlyPreLabel.css("display","");$dailyPreLabel.css("display","");break;case"custom":$customControls.css("display","");this.children.scheduleOptions.$el.hide()}},startListening:function(){this.listenTo(this.model.cron,"change:cronType",function(){this.timeRangeToggle();this.model.cron.setDefaults()})},render:function(){this.$el.append(this.children.timeRange.render().el);this.$el.append(this.children.scheduleOptions.render().el);this.children.scheduleOptions.$el.find(".schedule_hourly").before('<span class="pre_label">'+_("At ").t()+"</span>");this.children.scheduleOptions.$el.find(".schedule_hourly").after('<span class="hour_post_label">'+_(" minutes past the hour").t()+"</span>");this.children.scheduleOptions.$el.find(".schedule_weekly").before('<span class="weekly_pre_label">'+_("On ").t()+"</span>");this.children.scheduleOptions.$el.find(".schedule_weekly .btn").width("75px");this.children.scheduleOptions.$el.find(".schedule_monthly").before('<span class="monthly_pre_label">'+_("On day ").t()+"</span>");this.children.scheduleOptions.$el.find(".schedule_monthly .btn").width("55px");this.children.scheduleOptions.$el.find(".schedule_daily").before('<span class="daily_pre_label">'+_(" at ").t()+"</span>");this.children.scheduleOptions.$el.find(".schedule_daily .btn").width("50px");this.$el.append('<div class="custom_time"></div>');this.$el.find(".custom_time").append(this.children.cronSchedule.render().el);this.timeRangeToggle();return this}})});define("views/shared/reportcontrols/dialogs/schedule_dialog/step1/Schedule",["underscore","module","views/Base","views/shared/Modal","views/shared/ScheduleSentence","views/shared/controls/ControlGroup"],function(_,module,Base,Modal,ScheduleSentence,ControlGroup){return Base.extend({moduleId:module.id,className:"form form-horizontal",initialize:function(){Base.prototype.initialize.apply(this,arguments);var checkBoxLabel=this.model.inmem.entry.content.get("disabled")?_("Enable and Schedule Report").t():_("Schedule Report").t();this.children.name=new ControlGroup({controlType:"Label",controlOptions:{modelAttribute:"name",model:this.model.inmem.entry},label:_("Report").t()});this.children.scheduleCheck=new ControlGroup({controlType:"SyntheticCheckbox",controlOptions:{modelAttribute:"scheduled_and_enabled",model:this.model.inmem},label:checkBoxLabel});this.children.scheduleSentence=new ScheduleSentence({model:{cron:this.model.cron,application:this.model.application},lineOneLabel:_("Schedule").t(),popdownOptions:{attachDialogTo:".modal:visible",scrollContainer:".modal:visible .modal-body:visible"}});this.model.inmem.on("change:scheduled_and_enabled",this.isScheduledToggle,this);this.model.timeRange.on("applied",function(){this.model.inmem.entry.content.set({"dispatch.earliest_time":this.model.timeRange.get("earliest"),"dispatch.latest_time":this.model.timeRange.get("latest")});this.setLabel()},this);this.model.timeRange.on("change:earliest_epoch change:latest_epoch change:earliest change:latest",_.debounce(this.setLabel,0),this)},isScheduledToggle:function(){if(this.model.inmem.get("scheduled_and_enabled")){this.$(".modal-btn-primary").html(_("Next").t());this.children.scheduleSentence.$el.show();this.$("div.timerange").show()}else{this.children.scheduleSentence.$el.hide();this.$("div.timerange").hide();this.$(".modal-btn-primary").html(_("Save").t())}this.model.inmem.trigger("togglePrimaryButton")},setLabel:function(){var timeLabel=this.model.timeRange.generateLabel(this.collection);this.$el.find("span.time-label").text(timeLabel)},render:function(){this.children.name.render().appendTo(this.$el);this.model.inmem.entry.content.get("disabled")&&this.$el.append("<div>"+_("This report is currently disabled.").t()+"</div>");this.children.scheduleCheck.render().appendTo(this.$el);this.children.scheduleSentence.render().appendTo(this.$el);this.$el.append('<div class="timerange" style="display: block;"><label class="control-label">'+_("Time Range").t()+"</label></div>");this.$("div.timerange").append('<div class="controls"><a href="#" class="btn timerange-control"><span class="time-label"></span><span class="icon-triangle-right-small"></span></a></div>');this.setLabel();this.isScheduledToggle();return this}})});define("views/shared/reportcontrols/dialogs/schedule_dialog/step1/Master",["underscore","module","views/Base","views/shared/Modal","views/shared/delegates/ModalTimerangePicker","views/shared/reportcontrols/dialogs/schedule_dialog/step1/Schedule","views/shared/timerangepicker/dialog/Master","views/shared/FlashMessages"],function(_,module,Base,Modal,TimeRangeDelegate,ScheduleView,TimeRangePickerDialog,FlashMessage){return Base.extend({moduleId:module.id,initialize:function(){Base.prototype.initialize.apply(this,arguments);this.children.flashMessage=new FlashMessage({model:this.model.cron});this.children.scheduleView=new ScheduleView({model:{application:this.model.application,inmem:this.model.inmem,cron:this.model.cron,timeRange:this.model.timeRange,user:this.model.user,appLocal:this.model.appLocal},collection:this.collection});this.children.timeRangePickerView=new TimeRangePickerDialog({model:{timeRange:this.model.timeRange,user:this.model.user,appLocal:this.model.appLocal,application:this.model.application},collection:this.collection,showPresetsRealTime:!1,showCustomRealTime:!1,showCustomDate:!1,showCustomDateTime:!1,showPresetsAllTime:!0,enableCustomAdvancedRealTime:!1,appendSelectDropdownsTo:".modal:visible"});this.model.timeRange.on("applied",function(){this.timeRangeDelegate.closeTimeRangePicker()},this);this.model.inmem.on("togglePrimaryButton",this.togglePrimaryButton,this)},events:{"click .modal-btn-primary":function(e){if(this.model.inmem.get("scheduled_and_enabled"))this.model.inmem.trigger("next");else{this.model.inmem.entry.content.set("is_scheduled",0);this.model.inmem.save({},{success:function(){this.model.inmem.trigger("saveSuccessNotScheduled")}.bind(this)})}e.preventDefault()}},togglePrimaryButton:function(){this.$(".modal-btn-primary").html(this.model.inmem.get("scheduled_and_enabled")?_("Next").t():_("Save").t())},render:function(){this.$el.html(Modal.TEMPLATE);this.$(Modal.HEADER_TITLE_SELECTOR).html(_("Edit Schedule").t());this.$(Modal.BODY_SELECTOR).remove();this.$(Modal.FOOTER_SELECTOR).before('<div class="vis-area"><div class="slide-area"><div class="content-wrapper schedule-wrapper"><div class="'+Modal.BODY_CLASS+'" ></div></div><div class="timerange-picker-wrapper"></div></div></div>');this.$visArea=this.$(".vis-area").eq(0);this.$slideArea=this.$(".slide-area").eq(0);this.$scheduleWrapper=this.$(".schedule-wrapper").eq(0);this.$timeRangePickerWrapper=this.$(".timerange-picker-wrapper").eq(0);this.$modalParent=$(".schedule-modal").eq(0);this.children.flashMessage.render().prependTo(this.$(Modal.BODY_SELECTOR));this.children.scheduleView.render().appendTo(this.$(Modal.BODY_SELECTOR));this.children.timeRangePickerView.render().appendTo(this.$timeRangePickerWrapper);this.timeRangeDelegate=new TimeRangeDelegate({el:this.el,$visArea:this.$visArea,$slideArea:this.$slideArea,$contentWrapper:this.$scheduleWrapper,$timeRangePickerWrapper:this.$timeRangePickerWrapper,$modalParent:this.$modalParent,$timeRangePicker:this.children.timeRangePickerView.$el,activateSelector:"a.timerange-control",backButtonSelector:"a.btn.back"});this.$(Modal.FOOTER_SELECTOR).append(Modal.BUTTON_CANCEL);this.$(Modal.FOOTER_SELECTOR).append('<a href="#" class="btn btn-primary modal-btn-primary">'+_("Save").t()+"</a>");this.$(Modal.FOOTER_SELECTOR).append('<a href="#" class="btn back modal-btn-back pull-left">'+_("Back").t()+"</a>");this.$(".btn.back").hide();this.togglePrimaryButton();return this}})});define("views/shared/EmailOptions",["underscore","backbone","module","views/Base","views/shared/controls/ControlGroup","views/shared/controls/SyntheticSelectControl","splunk.util","uri/route"],function(_,Backbone,module,Base,ControlGroup,SyntheticSelectControl,splunkUtil,route){return Base.extend({moduleId:module.id,className:"enable-actions-view",initialize:function(){Base.prototype.initialize.apply(this,arguments);var defaults={suffix:"report",toLabel:_("To").t(),inculedSubjectDefaultPlaceholder:!1};_.defaults(this.options,defaults);this.children.toEmailAddresses=new ControlGroup({className:"control-group",controlType:"Textarea",controlClass:"controls-block",controlOptions:{modelAttribute:"action.email.to",model:this.model.state},label:this.options.toLabel,help:splunkUtil.sprintf(_("Comma separated list of email addresses. %s").t(),' <a href="#" class="show-cc-bcc">'+_("Show CC and BCC").t()+"</a>")});this.children.ccEmailAddresses=new ControlGroup({className:"control-group",controlType:"Textarea",controlClass:"controls-block",controlOptions:{modelAttribute:"action.email.cc",model:this.model.state,placeholder:_("optional").t()},label:_("CC").t()});this.children.bccEmailAddresses=new ControlGroup({className:"control-group",controlType:"Textarea",controlClass:"controls-block",controlOptions:{modelAttribute:"action.email.bcc",model:this.model.state,placeholder:_("optional").t()},label:_("BCC").t()});this.children.emailPriority=new ControlGroup({className:"control-group",controlType:"SyntheticSelect",controlClass:"controls-block",controlOptions:{modelAttribute:"action.email.priority",model:this.model.state,items:[{label:_("Lowest").t(),value:"5"},{label:_("Low").t(),value:"4"},{label:_("Normal").t(),value:"3"},{label:_("High").t(),value:"2"},{label:_("Highest").t(),value:"1"}],toggleClassName:"btn",popdownOptions:{attachDialogTo:".modal:visible",scrollContainer:".modal:visible .modal-body:visible"}},label:_("Priority").t()});var configTokenHelpLink=route.docHelp(this.model.application.get("root"),this.model.application.get("locale"),"learnmore.alert.email.tokens"),subjectModelAttribute="action.email.subject";splunkUtil.normalizeBoolean(this.model.state.get("action.email.useNSSubject"))&&(subjectModelAttribute+="."+this.options.suffix);this.children.emailSubject=new ControlGroup({className:"control-group",controlType:"Text",controlClass:"controls-block",controlOptions:{modelAttribute:subjectModelAttribute,model:this.model.state,placeholder:this.options.inculedSubjectDefaultPlaceholder?_("Default").t():""},label:_("Subject").t(),help:splunkUtil.sprintf(_("The email subject and message can include tokens that insert text based on the results of the search. %s").t(),' <a href="'+configTokenHelpLink+'" target="_blank" title="'+_("Splunk help").t()+'">'+_("Learn More").t()+' <i class="icon-external"></i></a>')});
this.children.emailMessage=new ControlGroup({className:"control-group",controlType:"Textarea",controlClass:"controls-block",controlOptions:{modelAttribute:"action.email.message."+this.options.suffix,model:this.model.state,placeholder:_("Default").t(),textareaClassName:"messagearea"},label:_("Message").t()})},events:{"click a.show-cc-bcc":function(e){var force=!0;this.showAdditionalEmailAddresses(force);e.preventDefault()}},showAdditionalEmailAddresses:function(force){if(force||this.model.state.get("action.email.cc")||this.model.state.get("action.email.bcc")){this.children.ccEmailAddresses.$el.show();this.children.bccEmailAddresses.$el.show();this.children.toEmailAddresses.$("a.show-cc-bcc").css("display","none")}else this.children.toEmailAddresses.$("a.show-cc-bcc").css("display","block")},render:function(){this.children.toEmailAddresses.render().appendTo(this.$el);this.children.ccEmailAddresses.render().appendTo(this.$el).$el.hide();this.children.bccEmailAddresses.render().appendTo(this.$el).$el.hide();this.children.emailPriority.render().appendTo(this.$el);this.children.emailSubject.render().appendTo(this.$el);this.children.emailMessage.render().appendTo(this.$el);this.showAdditionalEmailAddresses();return this}})});define("views/shared/reportcontrols/dialogs/schedule_dialog/Step2",["underscore","module","views/Base","views/shared/Modal","views/shared/EmailOptions","views/shared/controls/ControlGroup","views/shared/controls/SyntheticCheckboxControl","views/shared/controls/SyntheticSelectControl","views/shared/FlashMessages","splunk.util","uri/route","util/console","util/pdf_utils"],function(_,module,Base,Modal,EmailOptions,ControlGroup,SyntheticCheckboxControl,SyntheticSelectControl,FlashMessage,splunkUtil,route,console,pdfUtils){return Base.extend({moduleId:module.id,initialize:function(){Base.prototype.initialize.apply(this,arguments);this.deferredPdfAvailable=pdfUtils.isPdfServiceAvailable();this.children.flashMessage=new FlashMessage({model:this.model.inmem});var configEmailHelpLink="http://docs.splunk.com/";this.model.appLocal&&this.model.application?configEmailHelpLink=route.docHelp(this.model.application.get("root"),this.model.application.get("locale"),"learnmore.alert.email"):console.warn("The schedule dialog step 2 view needs the AppLocal and Application model passed to it");this.children.sendEmailBox=new ControlGroup({controlType:"SyntheticCheckbox",controlOptions:{modelAttribute:"action.email",model:this.model.inmem.entry.content},label:_("Send Email").t(),help:splunkUtil.sprintf(_("Email must be configured in System&nbsp;Settings > Alert&nbsp;Email&nbsp;Settings. %s").t(),' <a href="'+configEmailHelpLink+'" target="_blank">'+_("Learn More").t()+' <i class="icon-external"></i></a>')});this.children.emailOptions=new EmailOptions({model:{state:this.model.inmem.entry.content,application:this.model.application},suffix:"report",inculedSubjectDefaultPlaceholder:!0});this.children.includeResultsLink=new SyntheticCheckboxControl({modelAttribute:"action.email.include.results_link",model:this.model.inmem.entry.content,label:_("Link to Results").t()});this.children.includeInline=new SyntheticCheckboxControl({additionalClassNames:"include-inline",modelAttribute:"action.email.inline",model:this.model.inmem.entry.content,label:_("Inline").t()});this.children.includeInlineFormat=new SyntheticSelectControl({additionalClassNames:"include-inline-format",modelAttribute:"action.email.format",menuWidth:"narrow",model:this.model.inmem.entry.content,items:[{label:_("Table").t(),value:"table"},{label:_("Raw").t(),value:"raw"},{label:_("CSV").t(),value:"csv"}],labelPosition:"outside",popdownOptions:{attachDialogTo:".modal:visible",scrollContainer:".modal:visible .modal-body:visible"}});this.children.includeCSV=new SyntheticCheckboxControl({modelAttribute:"action.email.sendcsv",model:this.model.inmem.entry.content,label:_("Attach CSV").t()});this.children.includePDF=new SyntheticCheckboxControl({modelAttribute:"action.email.sendpdf",model:this.model.inmem.entry.content,label:_("Attach PDF").t()});this.children.includeSearchString=new SyntheticCheckboxControl({modelAttribute:"action.email.include.search",model:this.model.inmem.entry.content,label:_("Search String").t()});this.children.includeViewLink=new SyntheticCheckboxControl({modelAttribute:"action.email.include.view_link",model:this.model.inmem.entry.content,label:_("Link to Report").t()});var includeCheckboxes=[this.children.includeViewLink,this.children.includeResultsLink,this.children.includeSearchString,this.children.includeInline,this.children.includeInlineFormat,this.children.includeCSV];$.when(this.deferredPdfAvailable).then(function(pdfAvailable){pdfAvailable&&includeCheckboxes.push(this.children.includePDF);this.children.emailInclude=new ControlGroup({controlClass:"email-include",controls:includeCheckboxes,label:_("Include").t()})}.bind(this));this.children.runScriptBox=new ControlGroup({controlType:"SyntheticCheckbox",controlOptions:{modelAttribute:"action.script",model:this.model.inmem.entry.content},label:_("Run a Script").t()});this.children.scriptFilename=new ControlGroup({controlType:"Text",controlOptions:{modelAttribute:"action.script.filename",model:this.model.inmem.entry.content},label:_("Filename").t(),help:_("Located in $SPLUNK_HOME/bin/scripts").t()});this.model.inmem.entry.content.on("change:action.email",this.toggleEmail,this);this.model.inmem.entry.content.on("change:action.script",this.toggleScript,this);this.model.inmem.entry.content.on("change:action.email.format",function(){this.model.inmem.entry.content.set("action.email.inline",1)},this)},events:{"click .btn-primary":function(e){var actions=[];this.model.inmem.entry.content.get("action.email")&&actions.push("email");this.model.inmem.entry.content.get("action.script")&&actions.push("script");this.model.inmem.entry.content.set("actions",actions.join(", "));this.model.inmem.trigger("saveSchedule");e.preventDefault()},"click .back":function(e){this.model.inmem.entry.content.trigger("back");e.preventDefault()}},toggleEmail:function(){if(this.model.inmem.entry.content.get("action.email")){this.children.emailOptions.$el.show();this.children.emailInclude.$el.show()}else{this.children.emailOptions.$el.hide();this.children.emailInclude.$el.hide()}},toggleScript:function(){this.model.inmem.entry.content.get("action.script")?this.children.scriptFilename.$el.show():this.children.scriptFilename.$el.hide()},render:function(){$.when(this.deferredPdfAvailable).then(function(){this.$el.html(Modal.TEMPLATE);this.$(Modal.HEADER_TITLE_SELECTOR).html(_("Edit Schedule").t());this.children.flashMessage.render().prependTo(this.$(Modal.BODY_SELECTOR));this.$(Modal.BODY_SELECTOR).append(Modal.FORM_HORIZONTAL_COMPLEX);if(this.model.user.isFree()){var freeHelpLink=route.docHelp(this.model.application.get("root"),this.model.application.get("locale"),"learnmore.license.features");this.children.sendEmailBox.disable();this.children.runScriptBox.disable();this.$(Modal.BODY_FORM_SELECTOR).append(this.compiledTemplate({_:_,splunkUtil:splunkUtil,link:' <a href="'+freeHelpLink+'" target="_blank">'+_("Learn More").t()+' <i class="icon-external"></i></a>'}))}this.$(Modal.BODY_FORM_SELECTOR).append('<p class="control-heading">'+_("Enable Actions").t()+"</p>");this.children.sendEmailBox.render().appendTo(this.$(Modal.BODY_FORM_SELECTOR));this.children.emailOptions.render().appendTo(this.$(Modal.BODY_FORM_SELECTOR));this.children.emailInclude.render().appendTo(this.$(Modal.BODY_FORM_SELECTOR));this.children.runScriptBox.render().appendTo(this.$(Modal.BODY_FORM_SELECTOR));this.children.scriptFilename.render().appendTo(this.$(Modal.BODY_FORM_SELECTOR));this.$(Modal.FOOTER_SELECTOR).append('<a href="#" class="btn back pull-left">'+_("Back").t()+"</a>");this.$(Modal.FOOTER_SELECTOR).append(Modal.BUTTON_SAVE);this.toggleEmail();this.toggleScript();return this}.bind(this))},template:'                <div class="alert alert-info">                    <i class="icon-alert"></i>                    <%= splunkUtil.sprintf(_("Scheduling Actions is an Enterprise-level feature. It is not available with Splunk Free. %s").t(), link) %>                </div>            '})});define("views/shared/reportcontrols/dialogs/schedule_dialog/Master",["underscore","backbone","models/shared/Cron","models/shared/TimeRange","collections/services/data/ui/Times","views/shared/Modal","module","views/shared/reportcontrols/dialogs/schedule_dialog/step1/Master","views/shared/reportcontrols/dialogs/schedule_dialog/Step2","splunk.util"],function(_,Backbone,Cron,TimeRangeModel,TimesCollection,Modal,module,Step1,Step2,splunkUtil){return Modal.extend({moduleId:module.id,initialize:function(){Modal.prototype.initialize.apply(this,arguments);this.model={application:this.model.application,report:this.model.report,user:this.model.user,appLocal:this.model.appLocal,timeRange:new TimeRangeModel({enableRealTime:!1}),inmem:this.model.report.clone(),cron:Cron.createFromCronString(this.model.report.entry.content.get("cron_schedule")||"0 6 * * 1")};this.collection=new TimesCollection;this.collectionDeferred=this.collection.fetch({data:{app:this.model.application.get("app"),owner:this.model.application.get("owner")}});this.model.inmem.set({scheduled_and_enabled:!this.model.inmem.entry.content.get("disabled")&&this.model.inmem.entry.content.get("is_scheduled")});this.children.step1=new Step1({model:{state:this.model.inmem.entry.content,application:this.model.application,inmem:this.model.inmem,cron:this.model.cron,timeRange:this.model.timeRange,user:this.model.user,appLocal:this.model.appLocal},collection:this.collection});this.children.step2=new Step2({model:{inmem:this.model.inmem,application:this.model.application,user:this.model.user,appLocal:this.model.appLocal}});this.model.inmem.on("next",function(){this.model.cron.validate()},this);this.model.inmem.entry.content.on("back",function(){this.children.step2.$el.hide();this.$el.removeClass(Modal.CLASS_MODAL_WIDE);this.children.step1.$el.show()},this);this.model.cron.on("validated",function(isValid){if(isValid){this.children.step1.$el.hide();this.$el.addClass(Modal.CLASS_MODAL_WIDE);this.children.step2.$el.show()}},this);this.model.inmem.on("saveSuccessNotScheduled",function(){this.model.report.entry.content.set("is_scheduled",0);this.hide()},this);this.model.inmem.on("saveSchedule",function(){this.trasposeFromUI();this.model.inmem.entry.content.set("cron_schedule",this.model.cron.getCronString());this.model.inmem.save({},{success:function(){this.model.report.fetch();this.hide()}.bind(this)})},this)},trasposeFromUI:function(){var sendResults=splunkUtil.normalizeBoolean(this.model.inmem.entry.content.get("action.email.sendpdf"))||splunkUtil.normalizeBoolean(this.model.inmem.entry.content.get("action.email.sendcsv"))||splunkUtil.normalizeBoolean(this.model.inmem.entry.content.get("action.email.inline"));this.model.inmem.entry.content.set("action.email.sendresults",+sendResults);this.model.inmem.get("scheduled_and_enabled")&&this.model.inmem.entry.content.set({is_scheduled:1,disabled:0})},render:function(){this.$el.addClass("schedule-modal");var timeRangeDeferred=this.model.timeRange.save({earliest:this.model.inmem.entry.content.get("dispatch.earliest_time"),latest:this.model.inmem.entry.content.get("dispatch.latest_time")});$.when(timeRangeDeferred,this.collectionDeferred).then(function(){this.children.step1.render().appendTo(this.$el);this.children.step2.render().appendTo(this.$el);this.children.step2.$el.hide()}.bind(this))}})});define("views/shared/reportcontrols/details/EditSchedule",["underscore","backbone","module","views/Base","views/shared/reportcontrols/dialogs/schedule_dialog/Master"],function(_,Backbone,module,Base,ScheduleDialog){return Base.extend({moduleId:module.id,tagName:"span",initialize:function(){Base.prototype.initialize.apply(this,arguments)},events:{"click a.edit-schedule":function(e){this.children.scheduleDialog=new ScheduleDialog({model:{report:this.model.report,application:this.model.application,user:this.model.user,appLocal:this.model.appLocal},onHiddenRemove:!0});this.children.scheduleDialog.render().appendTo($("body"));this.children.scheduleDialog.show();e.preventDefault()}},render:function(){this.$el.html(this.compiledTemplate({_:_}));return this},template:'                <a class="edit-schedule" href="#"><%- _("Edit").t() %></a>            '})});define("views/shared/reportcontrols/details/Acceleration",["underscore","module","views/Base","splunk.util"],function(_,module,Base,splunkUtil){return Base.extend({moduleId:module.id,tagName:"span",initialize:function(){Base.prototype.initialize.apply(this,arguments);var render=_.debounce(this.render,0);this.model.entry.content.on("change:auto_summarize change:auto_summarize.dispatch.earliest_time",render,this)},render:function(){this.$el.html(this.compiledTemplate({model:this.model,_:_,splunkUtil:splunkUtil}));return this},convertSummarizeTime:function(relTime){switch(relTime){case"-1d@h":return _("1 Day").t();case"-7d@d":return _("1 Week").t();case"-1mon@d":return _("1 Month").t();case"-3mon@d":return _("3 Months").t();case"-1y@d":return _("1 Year").t();case"0":return _("All Time").t();default:return _("Custom").t()}},template:'                <% if (model.entry.content.get("auto_summarize")) { %>                    <%- splunkUtil.sprintf(_("Enabled. Summary Range: %s.").t(), this.convertSummarizeTime(model.entry.content.get("auto_summarize.dispatch.earliest_time"))) %>                <% } else { %>                    <%- _("Disabled.").t() %>                <% } %>            '})});define("views/shared/reportcontrols/dialogs/AccelerationDialog",["underscore","backbone","module","models/services/search/IntentionsParser","views/shared/Modal","views/shared/controls/ControlGroup","views/shared/FlashMessages","splunk.util"],function(_,Backbone,module,IntentionsParserModel,Modal,ControlGroup,FlashMessage,splunkUtil){return Modal.extend({moduleId:module.id,initialize:function(){Modal.prototype.initialize.apply(this,arguments);this.model={searchJob:this.model.searchJob,report:this.model.report,inmem:this.model.report.clone(),application:this.model.application};if(!this.model.searchJob){this.model.intentionsParser=new IntentionsParserModel;this.intentionsParserDeferred=this.model.intentionsParser.fetch({data:{q:this.model.report.entry.content.get("search"),timeline:!1,app:this.model.application.get("app"),owner:this.model.application.get("owner")}})}this.children.flashMessage=new FlashMessage({model:this.model.inmem});this.children.name=new ControlGroup({controlType:"Label",controlOptions:{modelAttribute:"name",model:this.model.inmem.entry},label:_("Report").t()});this.children.acceleration=new ControlGroup({controlType:"SyntheticCheckbox",controlOptions:{modelAttribute:"auto_summarize",model:this.model.inmem.entry.content},label:splunkUtil.sprintf(_("Accelerate %s").t(),this.model.report.isAlert()?_("Alert").t():_("Report").t()),help:_("Acceleration may increase storage and processing costs.").t()});this.children.summary_range=new ControlGroup({controlType:"SyntheticSelect",controlOptions:{modelAttribute:"auto_summarize.dispatch.earliest_time",model:this.model.inmem.entry.content,items:[{label:_("1 Day").t(),value:"-1d@h"},{label:_("7 Days").t(),value:"-7d@d"},{label:_("1 Month").t(),value:"-1mon@d"},{label:_("3 Months").t(),value:"-3mon@d"},{label:_("1 Year").t(),value:"-1y@d"},{label:_("All Time").t(),value:"0"}],save:!1,toggleClassName:"btn",labelPosition:"outside",elastic:!0,popdownOptions:{attachDialogTo:".modal:visible",scrollContainer:".modal:visible .modal-body:visible"}},label:_("Summary Range").t(),tooltip:_("Sets the range of time (relative to now) for which data is accelerated. Example: 1 Month accelerates the last 30 days of data in your reports.").t()});this.model.inmem.entry.content.on("change:auto_summarize",function(){if(this.model.inmem.entry.content.get("auto_summarize")){this.children.summary_range.$el.show();""===this.model.inmem.entry.content.get("auto_summarize.dispatch.earliest_time")&&this.model.inmem.entry.content.set("auto_summarize.dispatch.earliest_time","-1d@h")}else this.children.summary_range.$el.hide()},this);this.on("hidden",function(){this.model.inmem.get("updated")>this.model.report.get("updated")&&this.model.report.entry.content.set({auto_summarize:this.model.inmem.entry.content.get("auto_summarize"),"auto_summarize.dispatch.earliest_time":this.model.inmem.entry.content.get("auto_summarize.dispatch.earliest_time")})},this)},events:$.extend({},Modal.prototype.events,{"click .save.modal-btn-primary":function(e){this.model.inmem.save({},{success:function(){this.model.report.fetch();this.remove()}.bind(this)});e.preventDefault()}}),render:function(){this.$el.html(Modal.TEMPLATE);this.$(Modal.HEADER_TITLE_SELECTOR).html(_("Edit Acceleration").t());this.children.flashMessage.render().prependTo(this.$(Modal.BODY_SELECTOR));this.$(Modal.BODY_SELECTOR).append(Modal.FORM_HORIZONTAL);$.when(this.intentionsParserDeferred).then(function(){var canSummarize=this.model.searchJob&&this.model.searchJob.canSummarize()||this.model.intentionsParser&&this.model.intentionsParser.get("canSummarize");if(canSummarize){this.model.inmem.setAccelerationWarning(canSummarize);this.children.name.render().appendTo(this.$(Modal.BODY_FORM_SELECTOR));this.children.acceleration.render().appendTo(this.$(Modal.BODY_FORM_SELECTOR));this.children.summary_range.render().appendTo(this.$(Modal.BODY_FORM_SELECTOR));this.model.inmem.entry.content.get("auto_summarize")?this.children.summary_range.$el.show():this.children.summary_range.$el.hide();this.$(Modal.FOOTER_SELECTOR).append(Modal.BUTTON_CANCEL);this.$(Modal.FOOTER_SELECTOR).append('<a href="#" class="save btn btn-primary modal-btn-primary pull-right">'+_("Save").t()+"</a>")}else{this.$(Modal.BODY_FORM_SELECTOR).append("<div>"+_("This report cannot be accelerated.").t()+"</div>");this.$(Modal.FOOTER_SELECTOR).append(Modal.BUTTON_DONE)}}.bind(this));return this}})});define("views/shared/reportcontrols/details/EditAcceleration",["underscore","backbone","module","views/Base","views/shared/reportcontrols/dialogs/AccelerationDialog"],function(_,Backbone,module,Base,AccelerationDialog){return Base.extend({moduleId:module.id,tagName:"span",initialize:function(){Base.prototype.initialize.apply(this,arguments)},events:{"click a.edit-acceleration":function(e){this.children.accelerationDialog=new AccelerationDialog({model:{report:this.model.report,searchJob:this.model.searchJob,application:this.model.application},onHiddenRemove:!0});this.children.accelerationDialog.render().appendTo($("body"));this.children.accelerationDialog.show();e.preventDefault()}},render:function(){this.$el.html(this.compiledTemplate({_:_}));return this},template:'                <a class="edit-acceleration" href="#"><%- _("Edit").t() %></a>            '})});define("views/shared/documentcontrols/details/Permissions",["underscore","module","views/Base","util/splunkd_utils","splunk.util"],function(_,module,Base,splunkDUtils){return Base.extend({moduleId:module.id,tagName:"span",initialize:function(){Base.prototype.initialize.apply(this,arguments);var render=_.debounce(this.render,0);this.model.entry.acl.on("change:sharing change:owner",render,this)},render:function(){var sharing=this.model.entry.acl.get("sharing"),owner=this.model.entry.acl.get("owner"),permissionString=splunkDUtils.getPermissionLabel(sharing,owner);this.$el.html(this.compiledTemplate({permissionString:permissionString}));return this},template:"               <%- permissionString %>            "})});define("views/shared/documentcontrols/dialogs/permissions_dialog/ACL",["underscore","jquery","backbone","module","views/Base","views/shared/controls/SyntheticCheckboxControl"],function(_,$,Backbone,module,BaseView,SyntheticCheckboxControl){return BaseView.extend({moduleId:module.id,className:"push-margins",initialize:function(){BaseView.prototype.initialize.apply(this,arguments);this.children.read=new BaseView;this.children.write=new BaseView;this.model.perms.on("change:Everyone.read",function(){this.toggleEveryone("read")},this);this.model.perms.on("change:Everyone.write",function(){this.toggleEveryone("write")},this)},appendRow:function(role){var className="Everyone"!==role?"role":"";this.$("tbody").append('<tr class="'+role+'">                    <td class="role-name">'+_.escape(this.model.perms.get(role+".name"))+'</td>                    <td class="perms-read '+role+'-checkbox"></td>                    <td class="perms-write '+role+'-checkbox"></td>                </tr>');this.children.readCheckbox=new SyntheticCheckboxControl({modelAttribute:role+".read",model:this.model.perms,checkboxClassName:className+" read btn"});this.children.writeCheckbox=new SyntheticCheckboxControl({modelAttribute:role+".write",model:this.model.perms,checkboxClassName:className+" write btn"});this.children.readCheckbox.render().appendTo(this.$("td.perms-read."+role+"-checkbox"));this.children.writeCheckbox.render().appendTo(this.$("td.perms-write."+role+"-checkbox"));this.children.read.children[role]=this.children.readCheckbox;this.children.write.children[role]=this.children.writeCheckbox},toggleEveryone:function(col){var everyoneChecked=this.model.perms.get("Everyone."+col),checkboxes=this.children[col];_.each(checkboxes.children,function(checkbox,role){"Everyone"!==role&&(everyoneChecked?checkbox.disable():checkbox.enable())})},render:function(){this.$el.html(this.compiledTemplate({_:_}));_(this.model.perms.toJSON()).each(function(value,key){var splitKey=key.split("."),role=splitKey[0],type=splitKey[1];"name"===type&&this.appendRow(role)}.bind(this));this.toggleEveryone("read");this.toggleEveryone("write");return this},template:'            <table class="table table-striped table-condensed table-scroll table-border-row">                <thead>                    <tr>                        <td></td>                        <th class="perms-read"><%- _("Read").t() %></th>                        <th class="perms-write"><%- _("Write").t() %></th>                    </tr>                </thead>                <tbody>                </tbody>            </table>        '})});define("views/shared/documentcontrols/dialogs/permissions_dialog/Master",["jquery","underscore","backbone","module","models/Base","models/ACLReadOnly","views/shared/Modal","views/shared/controls/ControlGroup","views/shared/documentcontrols/dialogs/permissions_dialog/ACL","views/shared/FlashMessages","util/splunkd_utils"],function($,_,Backbone,module,BaseModel,ACLReadOnlyModel,Modal,ControlGroup,ACL,FlashMessage,splunkd_utils){return Modal.extend({moduleId:module.id,initialize:function(){Modal.prototype.initialize.apply(this,arguments);this.model.perms=new BaseModel;this.model.inmem=new ACLReadOnlyModel($.extend(!0,{},this.model.document.entry.acl.toJSON()));var defaults={nameLabel:_("Name").t(),nameKey:"name"};_.defaults(this.options,defaults);this.translateToPermsModel();this.children.flashMessage=new FlashMessage({model:{inmem:this.model.inmem,report:this.model.document,reportAcl:this.model.document.acl}});this.children.name=new ControlGroup({controlType:"Label",controlOptions:{modelAttribute:this.options.nameKey,model:this.model.nameModel},label:this.options.nameLabel});this.children.owner=new ControlGroup({controlType:"Label",controlOptions:{modelAttribute:"owner",model:this.model.inmem},label:_("Owner").t()});this.children.app=new ControlGroup({controlType:"Label",controlOptions:{modelAttribute:"app",model:this.model.inmem},label:_("App").t()});this.children.display_for=new ControlGroup({controlType:"SyntheticRadio",controlClass:"controls-thirdblock",controlOptions:{modelAttribute:"sharing",model:this.model.inmem,items:[{label:_("Owner").t(),value:splunkd_utils.USER,className:"user"},{label:_("App").t(),value:splunkd_utils.APP,className:"app"},{label:_("All Apps").t(),value:splunkd_utils.GLOBAL,className:"global"}],save:!1},label:_("Display For").t()});this.children.acl=new ACL({model:{perms:this.model.perms},collection:this.collection});this.model.inmem.on("change:sharing",function(){this.model.inmem.get("sharing")===splunkd_utils.USER?this.children.acl.$el.hide():this.children.acl.$el.show()},this)},events:$.extend({},Modal.prototype.events,{"click .btn-primary":function(e){this.translateFromPermsModel();var data=this.model.inmem.toDataPayload();this.model.document.acl.save({},{data:data,success:function(){this.hide();this.model.document.fetch({url:splunkd_utils.fullpath(this.model.document.url+"/"+encodeURIComponent(this.model.document.entry.get("name")),{sharing:data.sharing,app:this.model.inmem.get("app"),owner:data.owner}),success:function(){this.model.document.trigger("updateCollection")}.bind(this)})}.bind(this)});e.preventDefault()}}),translateToPermsModel:function(){var perms=this.model.inmem.permsToObj();this.model.perms.set("Everyone.name",_("Everyone").t());this.model.perms.set("Everyone.read",-1!=_.indexOf(perms.read,"*"));this.model.perms.set("Everyone.write",-1!=_.indexOf(perms.write,"*"));this.collection.each(function(roleModel,i){var roleName=roleModel.entry.get("name"),j=i+1;this.model.perms.set("role_"+j+".name",roleName);this.model.perms.set("role_"+j+".read",-1!=_.indexOf(perms.read,roleName));this.model.perms.set("role_"+j+".write",-1!=_.indexOf(perms.write,roleName))},this)},translateFromPermsModel:function(){var perms={read:[],write:[]};_(this.model.perms.toJSON()).each(function(value,key){var splitKey=key.split("."),role=splitKey[0],type=splitKey[1];("read"===type||"write"===type)&&value&&perms[type].push("Everyone"===role?"*":this.model.perms.get(role+".name"))}.bind(this));this.model.inmem.set("perms",perms)},setView:function(){this.model.inmem.get("can_share_user")||this.children.display_for.$(".user").attr("disabled",!0);this.model.inmem.get("can_share_app")||this.children.display_for.$(".app").attr("disabled",!0);this.model.inmem.get("can_share_global")||this.children.display_for.$(".global").attr("disabled",!0);this.model.inmem.get("modifiable")||this.children.display_for.$(".btn").attr("disabled",!0);"user"===this.model.inmem.get("sharing")?this.children.acl.$el.hide():this.children.acl.$el.show()},render:function(){this.$el.html(Modal.TEMPLATE);this.$(Modal.HEADER_TITLE_SELECTOR).html(_("Edit Permissions").t());this.$(Modal.BODY_SELECTOR).addClass("modal-body-scrolling");this.children.flashMessage.render().prependTo(this.$(Modal.BODY_SELECTOR));this.$(Modal.BODY_SELECTOR).append(Modal.FORM_HORIZONTAL);this.children.name.render().appendTo(this.$(Modal.BODY_FORM_SELECTOR));this.children.owner.render().appendTo(this.$(Modal.BODY_FORM_SELECTOR));this.children.app.render().appendTo(this.$(Modal.BODY_FORM_SELECTOR));this.children.display_for.render().appendTo(this.$(Modal.BODY_FORM_SELECTOR));this.model.user.isFree()||this.children.acl.render().appendTo(this.$(Modal.BODY_FORM_SELECTOR));this.$(Modal.FOOTER_SELECTOR).append(Modal.BUTTON_CANCEL);this.$(Modal.FOOTER_SELECTOR).append(Modal.BUTTON_SAVE);this.setView();return this}})});define("views/shared/reportcontrols/details/EditPermissions",["underscore","backbone","module","views/Base","views/shared/documentcontrols/dialogs/permissions_dialog/Master"],function(_,Backbone,module,Base,PermissionsDialog){return Base.extend({moduleId:module.id,tagName:"span",initialize:function(){Base.prototype.initialize.apply(this,arguments)},events:{"click a.edit-permissions":function(e){this.children.permissionsDialog=new PermissionsDialog({model:{document:this.model.report,nameModel:this.model.report.entry,user:this.model.user},collection:this.collection,onHiddenRemove:!0,nameLabel:_("Report").t()});this.children.permissionsDialog.render().appendTo($("body"));this.children.permissionsDialog.show();e.preventDefault()}},render:function(){this.$el.html(this.compiledTemplate({_:_}));return this},template:'                <a class="edit-permissions" href="#"><%- _("Edit").t() %></a>            '})});define("views/shared/reportcontrols/details/Embed",["underscore","module","views/Base","util/general_utils"],function(_,module,Base,Util){return Base.extend({moduleId:module.id,tagName:"span",initialize:function(){Base.prototype.initialize.apply(this,arguments)},render:function(){var embed=Util.normalizeBoolean(this.model.entry.content.get("embed.enabled"));this.$el.html(this.compiledTemplate({_:_,embed:embed}));return this},template:'                <% if (embed) { %>                    <%- _("Enabled.").t() %>                <% } else { %>                    <%- _("Disabled.").t() %>                <% } %>            '})});define("views/shared/reportcontrols/dialogs/embed_dialog/NotScheduled",["underscore","module","views/Base","views/shared/Modal","views/shared/reportcontrols/dialogs/schedule_dialog/Master"],function(_,module,BaseView,ModalView,ScheduleDialog){return BaseView.extend({moduleId:module.id,events:{"click a.scheduleReport":function(e){this.trigger("hide");var scheduleDialog=new ScheduleDialog({model:{report:this.model.report,application:this.model.application,user:this.model.user,appLocal:this.model.appLocal},onHiddenRemove:!0});scheduleDialog.render().appendTo($("body"));scheduleDialog.show();e.preventDefault()}},render:function(){this.$el.html(ModalView.TEMPLATE);this.$(ModalView.HEADER_TITLE_SELECTOR).html(_("Report Must Be Scheduled").t());this.$(ModalView.BODY_SELECTOR).append("<p>"+_("You cannot enable embedding for this report until it is scheduled. Embedded reports always display the results of their last scheduled run.").t()+"</p>");this.$(ModalView.FOOTER_SELECTOR).append(ModalView.BUTTON_CANCEL);this.$(ModalView.FOOTER_SELECTOR).append('<a href="#" class="btn btn-primary modal-btn-primary pull-right scheduleReport">'+_("Schedule Report").t()+"</a>");return this}})});define("views/shared/reportcontrols/dialogs/embed_dialog/Confirmation",["underscore","module","views/Base","views/shared/Modal"],function(_,module,BaseView,ModalView){return BaseView.extend({moduleId:module.id,events:{"click a.enableEmbedding":function(){this.model.embed.save()}},render:function(){this.$el.html(ModalView.TEMPLATE);this.$(ModalView.HEADER_TITLE_SELECTOR).html(_("Enable Report Embedding").t());this.$(ModalView.BODY_SELECTOR).append("<p>"+_("Are you sure you want to enable embedding for this report? An embedded report can be viewed by anyone with access to the web page(s) in which it is inserted.").t()+"</p>");this.$(ModalView.FOOTER_SELECTOR).append(ModalView.BUTTON_CANCEL);this.$(ModalView.FOOTER_SELECTOR).append('<a href="#" class="btn btn-primary modal-btn-primary pull-right enableEmbedding">'+_("Enable Embedding").t()+"</a>");return this}})});define("models/services/saved/searches/History",["models/SplunkDBase"],function(BaseModel){return BaseModel.extend({initialize:function(){BaseModel.prototype.initialize.apply(this,arguments)},sync:function(method){throw new Error("invalid method: "+method)}})});define("collections/services/saved/searches/Histories",["models/services/saved/searches/History","collections/SplunkDsBase"],function(Model,Collection){return Collection.extend({initialize:function(){Collection.prototype.initialize.apply(this,arguments)},model:Model})});define("views/shared/FlashMessagesLegacy",["underscore","views/Base","module"],function(_,Base,module){return Base.extend({moduleId:module.id,className:"alerts",initialize:function(){Base.prototype.initialize.apply(this,arguments);this.activate()},startListening:function(){this.listenTo(this.collection,"add push reset",this.render)},render:function(){var template=_.template(this.template,{flashMessages:this.collection});this.$el.html(template);0===this.collection.length?this.$el.hide():this.$el.show();return this},template:'            <% flashMessages.each(function(flashMessage){ %>                 <div class="alert alert-<%- flashMessage.get("type") %>">                    <i class="icon-alert"></i>                    <%- flashMessage.get("html") %>                </div>            <% }); %>         '},{update:function(errors,parentView,flashMessagesCollection){var flashMessageModels=[],uniquifier=0;
_(parentView.children).each(function(child){child.error(!1)});_(errors).each(function(error){parentView.children[error.name].error(!0);flashMessageModels.push({key:parentView.cid+uniquifier++,type:"error",html:error.msg})},parentView);flashMessagesCollection.reset(flashMessageModels)}})});define("views/shared/reportcontrols/dialogs/embed_dialog/Embed",["underscore","module","uri/route","models/Base","views/Base","views/shared/Modal","views/shared/controls/TextareaControl","collections/services/saved/searches/Histories","views/shared/FlashMessagesLegacy","collections/shared/FlashMessages"],function(_,module,route,BaseModel,BaseView,ModalView,TextareaControl,Histories,FlashMessagesLegacyView,FlashMessagesCollection){return BaseView.extend({moduleId:module.id,initialize:function(){BaseView.prototype.initialize.apply(this,arguments);this.model.state=new BaseModel;this.collection={histories:new Histories,messages:new FlashMessagesCollection};this.children.flashMessages=new FlashMessagesLegacyView({collection:this.collection.messages});this.collection.histories.url=this.model.report.entry.links.get("history");this.children.snippet=new TextareaControl({spellcheck:!1,modelAttribute:"text",model:this.model.state});this.model.report.entry.content.on("change:embed.token",this.setText,this);this.collection.histories.on("sync",this.maybeWarn,this);this.setText()},setText:function(){var height,text,src=route.embed(this.model.application.get("root"),this.model.application.get("locale"),this.model.report.entry.content.get("embed.token"),this.model.report.get("id")),displayGeneralType=this.model.report.entry.content.get("display.general.type"),displayVisualizationsType=this.model.report.entry.content.get("display.visualizations.type"),baseHeight=300,offsetHeight=36;"visualizations"===displayGeneralType&&"charting"===displayVisualizationsType?baseHeight=parseInt(this.model.report.entry.content.get("display.visualizations.chartHeight"),10):"events"===displayGeneralType||"statistics"===displayGeneralType?baseHeight=600:"visualizations"===displayGeneralType&&"mapping"===displayVisualizationsType?baseHeight=parseInt(this.model.report.entry.content.get("display.visualizations.mapHeight"),0):"visualizations"===displayGeneralType&&"singlevalue"===displayVisualizationsType&&(baseHeight=60);height=baseHeight+offsetHeight;text=_.template('<iframe height="<%- height %>" width="480" frameborder="0" src="<%= src %>"></iframe>',{src:src,height:height});this.model.state.set("text",text)},show:function(){this.$el.show();this.$("textarea").focus();this.collection.histories.fetch({data:{count:1}})},maybeWarn:function(){this.collection.messages.reset(this.collection.histories.length?[]:[{type:"warning",html:_("Embedded Report will not have data until the scheduled search runs.").t()}])},events:{"focus textarea":function(){setTimeout(function(){this.$("textarea").select()}.bind(this),0)},"click a.disableEmbedding":function(e){e.preventDefault();window.confirm(_("Are you sure you no longer want to share this report outside of Splunk?").t())&&this.model.report.unembed.save()}},render:function(){this.$el.html(ModalView.TEMPLATE);this.$(ModalView.HEADER_TITLE_SELECTOR).html(_("Embed").t());this.$(ModalView.BODY_SELECTOR).append(this.children.flashMessages.render().el);this.$(ModalView.BODY_SELECTOR).append("<p>"+_("Copy and paste this code into your HTML-based web page.").t()+"</p>");this.children.snippet.render().appendTo(this.$(ModalView.BODY_SELECTOR));this.$(ModalView.BODY_SELECTOR).append("<p>"+_("Disable embedding if you no longer want to share this report outside of Splunk.").t()+"</p>");this.$(ModalView.FOOTER_SELECTOR).append('<a href="#" class="btn pull-left disableEmbedding">'+_("Disable Embedding").t()+"</a>");this.$(ModalView.FOOTER_SELECTOR).append(ModalView.BUTTON_DONE);return this}})});define("views/shared/reportcontrols/dialogs/embed_dialog/Master",["underscore","module","views/shared/Modal","views/shared/reportcontrols/dialogs/embed_dialog/NotScheduled","views/shared/reportcontrols/dialogs/embed_dialog/Confirmation","views/shared/reportcontrols/dialogs/embed_dialog/Embed","util/general_utils"],function(_,module,ModalView,NotScheduledView,ConfirmationView,EmbedView,util){return ModalView.extend({moduleId:module.id,initialize:function(){ModalView.prototype.initialize.apply(this,arguments);this.children.notScheduled=new NotScheduledView({model:{report:this.model.report,application:this.model.application,user:this.model.user,appLocal:this.model.appLocal}});this.children.notScheduled.on("hide",this.hide,this);this.children.confirmation=new ConfirmationView({model:this.model.report});this.children.embed=new EmbedView({model:{report:this.model.report,application:this.model.application}});this.children.embed.on("hide",this.hide,this);this.model.report.entry.content.on("change:embed.enabled",function(){if(util.normalizeBoolean(this.model.report.entry.content.get("embed.enabled"))){this.children.notScheduled.$el.hide();this.children.confirmation.$el.hide();this.children.embed.show()}else this.hide()},this)},visibility:function(){if(this.model.report.entry.content.get("is_scheduled"))if(util.normalizeBoolean(this.model.report.entry.content.get("embed.enabled"))){this.children.notScheduled.$el.hide();this.children.confirmation.$el.hide();this.children.embed.show()}else{this.children.notScheduled.$el.hide();this.children.confirmation.$el.show();this.children.embed.$el.hide()}else{this.children.notScheduled.$el.show();this.children.confirmation.$el.hide();this.children.embed.$el.hide()}},render:function(){this.$el.append(this.children.notScheduled.render().el);this.$el.append(this.children.confirmation.render().el);this.$el.append(this.children.embed.render().el);this.visibility()}})});define("views/shared/reportcontrols/details/EditEmbed",["underscore","backbone","module","views/Base","views/shared/reportcontrols/dialogs/embed_dialog/Master"],function(_,Backbone,module,Base,EmbedDialog){return Base.extend({moduleId:module.id,tagName:"span",initialize:function(){Base.prototype.initialize.apply(this,arguments)},events:{"click a.edit-embed":function(e){this.children.embedDialog=new EmbedDialog({model:this.model,onHiddenRemove:!0});this.children.embedDialog.render().appendTo($("body"));this.children.embedDialog.show();e.preventDefault()}},render:function(){this.$el.html(this.compiledTemplate({_:_}));return this},template:'                <a class="edit-embed" href="#"><%- _("Edit").t() %></a>            '})});define("views/shared/reportcontrols/details/Master",["underscore","jquery","views/Base","module","views/shared/reportcontrols/details/History","views/shared/reportcontrols/details/Creator","views/shared/documentcontrols/details/App","views/shared/reportcontrols/details/Schedule","views/shared/reportcontrols/details/EditSchedule","views/shared/reportcontrols/details/Acceleration","views/shared/reportcontrols/details/EditAcceleration","views/shared/documentcontrols/details/Permissions","views/shared/reportcontrols/details/EditPermissions","views/shared/reportcontrols/details/Embed","views/shared/reportcontrols/details/EditEmbed","util/general_utils","bootstrap.modal"],function(_,$,BaseView,module,HistoryView,CreatorView,AppView,ScheduleView,EditScheduleView,AccelerationView,EditAccelerationView,PermissionsView,EditPermissionsView,EmbedView,EditEmbedView,util){return BaseView.extend({moduleId:module.id,initialize:function(){BaseView.prototype.initialize.apply(this,arguments);this.children.creatorView=new CreatorView({model:{report:this.model.report,application:this.model.application}});this.children.appView=new AppView({model:this.model.report});this.children.scheduleView=new ScheduleView({model:this.model.report});this.children.editScheduleView=new EditScheduleView({model:{report:this.model.report,application:this.model.application,user:this.model.user,appLocal:this.model.appLocal}});this.children.accelerationView=new AccelerationView({model:this.model.report});this.children.editAccelerationView=new EditAccelerationView({model:{report:this.model.report,searchJob:this.model.searchJob,application:this.model.application}});this.children.permissionsView=new PermissionsView({model:this.model.report});this.children.editPermissionsView=new EditPermissionsView({model:{report:this.model.report,user:this.model.user},collection:this.collection});this.children.embedView=new EmbedView({model:this.model.report});this.children.editEmbedView=new EditEmbedView({model:this.model});this.model.searchJob&&this.model.searchJob.on("prepared",function(){this.$("a.edit-acceleration").css("display","")},this);this.model.report.entry.content.on("change:embed.enabled",this.render,this)},render:function(){var canWrite=this.model.report.entry.acl.get("can_write")&&!(this.model.report.entry.content.get("is_scheduled")&&!this.model.user.canScheduleSearch()),canEmbed=this.model.report.canEmbed(this.model.user.canScheduleSearch(),this.model.user.canEmbed()),isEmbedded=util.normalizeBoolean(this.model.report.entry.content.get("embed.enabled"));this.el.innerHTML=this.compiledTemplate({_:_});this.children.creatorView.render().appendTo(this.$("dd.creator"));this.children.appView.render().appendTo(this.$("dd.app"));this.children.scheduleView.render().appendTo(this.$("dd.schedule"));this.children.accelerationView.render().appendTo(this.$("dd.acceleration"));this.children.permissionsView.render().appendTo(this.$("dd.permissions"));this.children.embedView.render().appendTo(this.$("dd.embed"));if(canWrite&&!isEmbedded){this.model.user.canScheduleSearch()&&!this.model.report.isRealTime()&&this.children.editScheduleView.render().appendTo(this.$("dd.schedule"));this.model.user.canAccelerateReport()&&this.children.editAccelerationView.render().appendTo(this.$("dd.acceleration"));this.model.report.entry.acl.get("can_change_perms")&&this.children.editPermissionsView.render().appendTo(this.$("dd.permissions"))}canEmbed&&this.children.editEmbedView.render().appendTo(this.$("dd.embed"));this.model.searchJob&&this.model.searchJob.isPreparing()&&this.$("a.edit-acceleration").css("display","none");if(this.model.report.isPivotReport()){this.$("dt.acceleration").remove();this.$("dd.acceleration").remove()}return this},template:'            <dl class="list-dotted">                <!--TODO when these attributes exist-->                <!--<dt class="history"><%- _("History").t() %></dt>                    <dd class="history"></dd>-->                <dt class="creator"><%- _("Creator").t() %></dt>                    <dd class="creator"></dd>                <dt class="app"><%- _("App").t() %></dt>                    <dd class="app"></dd>                <dt class="schedule"><%- _("Schedule").t() %></dt>                    <dd class="schedule"></dd>                <dt class="acceleration"><%- _("Acceleration").t() %></dt>                    <dd class="acceleration"></dd>                <dt class="permissions"><%- _("Permissions").t() %></dt>                    <dd class="permissions"></dd>                <dt class="embed"><%- _("Embedding").t() %></dt>                    <dd class="embed"></dd>            </dl>        '})});define("views/dashboards/panelcontrols/titledialog/Modal",["underscore","jquery","backbone","module","views/shared/controls/ControlGroup","views/shared/Modal","views/shared/FlashMessages"],function(_,$,backbone,module,ControlGroup,Modal,FlashMessagesView){return Modal.extend({moduleId:module.id,initialize:function(){Modal.prototype.initialize.apply(this,arguments);var titleProperty="display.general.title";this.model.workingReport=new backbone.Model;this.model.workingReport.set(titleProperty,this.model.report.entry.content.get(titleProperty,{tokens:!0}));this.children.flashMessages=new FlashMessagesView({model:this.model.dashboard});this.on("hide",this.model.dashboard.error.clear,this.model.dashboard.error);this.children.panelTitleControlGroup=new ControlGroup({label:_("Title").t(),controlType:"Text",controlClass:"controls-block",controlOptions:{model:this.model.workingReport,modelAttribute:titleProperty,placeholder:_("optional").t()}});this.listenTo(this.model.report,"successfulSave",this.hide,this)},events:$.extend({},Modal.prototype.events,{"click .modal-btn-primary":"onSave"}),onSave:function(e){var newTitle=this.model.workingReport.get("display.general.title");e.preventDefault();this.model.report.trigger("saveTitle",newTitle)},render:function(){this.$el.html(Modal.TEMPLATE);this.$(Modal.HEADER_TITLE_SELECTOR).html(_("Edit Title").t());this.$(Modal.BODY_SELECTOR).prepend(this.children.flashMessages.render().el);this.$(Modal.BODY_SELECTOR).append(Modal.FORM_HORIZONTAL);this.$(Modal.BODY_FORM_SELECTOR).append(this.children.panelTitleControlGroup.render().el);this.$(Modal.FOOTER_SELECTOR).append(Modal.BUTTON_CANCEL);this.$(Modal.FOOTER_SELECTOR).append(Modal.BUTTON_SAVE)}})});define("splunkjs/mvc/simpleform/formutils",["require","exports","module","underscore","jquery","splunkjs/mvc","splunkjs/mvc/simplexml/controller"],function(require){var _=require("underscore"),$=require("jquery"),mvc=require("splunkjs/mvc"),Dashboard=require("splunkjs/mvc/simplexml/controller"),registeredInputTypes={},FormUtils={submitForm:_.debounce(function(options){if(FormUtils.isFormReady()){options||(options={});var defaultTokenModel=mvc.Components.getInstance("default",{create:!0}),submittedTokenModel=mvc.Components.getInstance("submitted");submittedTokenModel&&submittedTokenModel.set(defaultTokenModel.toJSON());var urlTokenModel=mvc.Components.getInstance("url");urlTokenModel&&urlTokenModel.saveOnlyWithPrefix("form\\.",defaultTokenModel.toJSON(),{replaceState:options.replaceState})}else FormUtils.onFormReady().then(_.bind(FormUtils.submitForm,FormUtils,options))}),handleValueChange:function(input){var settings=input.vizSettings,inputType=settings.get("type"),defaultTokenModel=mvc.Components.getInstance("default",{create:!0}),inputTypeSettings=FormUtils.getInputTypeSettings(inputType),token=settings.get("token");if("time"===inputType){if(!settings.get("value")){var defaultValue=settings.get("default"),presetValue=settings.get("preset");defaultValue?input.val(defaultValue):presetValue?input.visualization._onTimePresetUpdate():settings.set("value",{earliest_time:"",latest_time:""});return}if(token){var value=input.val(),tokens={};tokens[token+".earliest"]=value["earliest_time"]||"";tokens[token+".latest"]=value["latest_time"]||"";defaultTokenModel.set(tokens)}}else{if(!input.hasValue()){input.defaultUpdate=!0;input.val(settings.get("default"));return}var newValue=input.val();if(void 0===newValue){defaultTokenModel.set(token,newValue);input.defaultUpdate=!1;FormUtils._handleAutoSubmit(input);return}if(inputTypeSettings.multiValue){if(null===newValue||0===newValue.length){defaultTokenModel.set(token,void 0);input.defaultUpdate=!1;FormUtils._handleAutoSubmit(input);return}var valuePrefix=settings.has("valuePrefix")?settings.get("valuePrefix"):"",valueSuffix=settings.has("valueSuffix")?settings.get("valueSuffix"):"",delimiter=settings.has("delimiter")?settings.get("delimiter"):" ";newValue=_(newValue).map(function(v){return valuePrefix+v+valueSuffix}).join(delimiter)}var newComputedValue="";if(newValue){var prefixValue=settings.get("prefix");prefixValue&&(newComputedValue+=prefixValue);newComputedValue+=newValue;var suffixValue=settings.get("suffix");suffixValue&&(newComputedValue+=suffixValue)}defaultTokenModel.set(token,newComputedValue)}FormUtils._handleAutoSubmit(input)},_handleAutoSubmit:function(input){var settings=input.vizSettings,autoSubmitEnabled=settings.get("searchWhenChanged")===!0||null==settings.get("searchWhenChanged")&&!mvc.Components.get("submit");autoSubmitEnabled&&(!FormUtils.isFormReady()&&input.defaultUpdate?input.defaultUpdate=!1:FormUtils.submitForm())},getInputType:function(type){var obj=registeredInputTypes[type];if(!obj)throw new Error("Unkonwn input type: "+type);return obj.clazz},getInputTypeSettings:function(type){var obj=registeredInputTypes[type];if(!obj)throw new Error("Unkonwn input type: "+type);return obj.settings},registerInputType:function(name,clazz,settings){registeredInputTypes[name]={clazz:clazz,settings:settings}},onFormReady:_.once(function(){var dfd=$.Deferred();Dashboard.onReady(function(){var inputs=FormUtils.getFormInputs();if(inputs.length>0){var promises=_(inputs).invoke("_onReady");$.when.apply($,promises).always(dfd.resolve)}else dfd.resolve()});return dfd.promise()}),isFormReady:function(){return"resolved"===FormUtils.onFormReady().state()},isFormInput:function(component){return component&&component._isDashboardInput},getFormInputs:function(){return _(mvc.Components.toJSON()).filter(FormUtils.isFormInput)}};return FormUtils});define("views/dashboards/PanelTimeRangePicker",["require","exports","module","underscore","jquery","views/Base","views/shared/controls/ControlGroup","util/console","uri/route","splunkjs/mvc","splunkjs/mvc/simpleform/formutils","splunkjs/mvc/tokenutils","splunk.util","bootstrap.tooltip"],function(require,module){var _=require("underscore"),BaseView=(require("jquery"),require("views/Base")),ControlGroup=require("views/shared/controls/ControlGroup"),mvc=(require("util/console"),require("uri/route"),require("splunkjs/mvc")),FormUtils=require("splunkjs/mvc/simpleform/formutils"),token_utils=require("splunkjs/mvc/tokenutils"),SplunkUtil=require("splunk.util");require("bootstrap.tooltip");return BaseView.extend({moduleId:module.id,initialize:function(){BaseView.prototype.initialize.apply(this,arguments);this.model.timeRange.on("applied",function(){this.updateReportTime();this.updateTime()},this);var items=_(mvc.Components.toJSON()).chain().values().filter(function(value){return FormUtils.isFormInput(value)&&value.settings?"time"==value.settings.get("type"):!1}).map(function(timePicker){var token=timePicker.settings.get("token")||"global",label=SplunkUtil.sprintf(_("Shared Time Picker (%s)").t(),token);return{value:token,label:label}}).value(),useTimeFrom="search",hasTokens=token_utils.hasToken(this.model.report.get("dispatch.earliest_time"))&&token_utils.hasToken(this.model.report.get("dispatch.latest_time"));if(hasTokens){var earliestTokenName=token_utils.getTokenName(this.model.report.get("dispatch.earliest_time")),earliestTokenPrefix=earliestTokenName.replace(/\.?earliest$/g,"");earliestTokenPrefix=""===earliestTokenPrefix?"global":earliestTokenPrefix;var latestTokenName=token_utils.getTokenName(this.model.report.get("dispatch.latest_time")),latestTokenPrefix=latestTokenName.replace(/\.?latest$/g,"");latestTokenPrefix=""===latestTokenPrefix?"global":latestTokenPrefix;this.model.timeRange.set({earliest_token:earliestTokenName,latest_token:latestTokenName});useTimeFrom=earliestTokenPrefix===latestTokenPrefix&&_(items).find(function(item){return item.value===earliestTokenPrefix})?earliestTokenPrefix:"tokens"}this.model.timeRange.set({useTimeFrom:useTimeFrom});items.length>0?this.children.timeScope=new ControlGroup({label:_("Time Range Scope").t(),controlType:"SyntheticSelect",controlOptions:{className:"btn-group time-range-scope-select",toggleClassName:"btn",groupedItems:[{items:items},{items:[{label:_("Explicit Selection").t(),value:"search"}]},{items:[{label:_("Tokens").t(),value:"tokens"}]}],model:this.model.timeRange,popdownOptions:{attachDialogTo:".modal:visible",scrollContainer:".modal:visible .modal-body:visible"},modelAttribute:"useTimeFrom",elastic:!0}}):this.model.timeRange.set("useTimeFrom","search");this.children.advancedEarliest=new ControlGroup({label:_("Earliest Token").t(),controlType:"Text",controlOptions:{model:this.model.timeRange,modelAttribute:"earliest_token"}});this.children.advancedLatest=new ControlGroup({label:_("Latest Token").t(),controlType:"Text",controlOptions:{model:this.model.timeRange,modelAttribute:"latest_token"}});this.listenTo(this.model.timeRange,"change:useTimeFrom",this.updateTokens,this)},updateReportTime:function(){this.model.report.set({"dispatch.earliest_time":this.model.timeRange.get("earliest"),"dispatch.latest_time":this.model.timeRange.get("latest")},{tokens:!0})},updateTokens:function(){this.toggleTimeRangePicker();this.toggleAdvancedTokens()},toggleAdvancedTokens:function(){if("tokens"===this.model.timeRange.get("useTimeFrom")){this.children.advancedEarliest.$el.show();this.children.advancedLatest.$el.show()}else{this.children.advancedEarliest.$el.hide();this.children.advancedLatest.$el.hide()}},toggleTimeRangePicker:function(){"search"===this.model.timeRange.get("useTimeFrom")?this.$(".timerange").show():this.$(".timerange").hide()},updateTime:function(){var timeLabel=this.model.timeRange.generateLabel(this.collection);this.$el.find("span.time-label").text(timeLabel)},render:function(){this.children.timeScope&&this.children.timeScope.render().appendTo(this.el);this.children.advancedEarliest.render().$el.appendTo(this.$el);this.children.advancedLatest.render().$el.appendTo(this.$el);this.$el.append('<div class="timerange" style="display: block;"><label class="control-label">'+_("Time Range").t()+"</label></div>");this.$("div.timerange").append('<div class="controls"><a href="#" class="btn timerange-control"><span class="time-label"></span><span class="icon-triangle-right-small"></span></a></div>');this.toggleTimeRangePicker();this.toggleAdvancedTokens();this.updateTime();return this}})});define("views/dashboards/panelcontrols/querydialog/Modal",["underscore","jquery","module","views/shared/controls/ControlGroup","views/shared/delegates/ModalTimerangePicker","views/shared/timerangepicker/dialog/Master","views/shared/Modal","models/shared/TimeRange","collections/services/data/ui/Times","splunk.util","splunkjs/mvc/utils","views/Base","uri/route","util/time","bootstrap.tooltip","util/console","splunkjs/mvc","views/shared/FlashMessages","views/dashboards/PanelTimeRangePicker","splunkjs/mvc/tokenawaremodel"],function(_,$,module,ControlGroup,TimeRangeDelegate,TimeRangePickerView,Modal,TimeRangeModel,TimeRangeCollection,splunkUtils,utils,BaseView,route,time_utils,_bootstrapTooltip,console,mvc,FlashMessagesView,PanelTimeRangePicker,TokenAwareModel){function mergeSearch(base,sub){return sub?[base.replace(/[\|\s]$/g,""),sub.replace(/^[\|\s]/g,"")].join(" | "):base}var PanelTimeRangeModel=TimeRangeModel.extend({validation:_.extend({earliest_token:function(value,attr,computedState){return"tokens"!==computedState.useTimeFrom||value?void 0:"No value specified for earliest token."},latest_token:function(value,attr,computedState){return"tokens"!==computedState.useTimeFrom||value?void 0:"No value specified for latest token."}},TimeRangeModel.prototype.validation)});return Modal.extend({moduleId:module.id,className:"modal edit-search-string",initialize:function(){Modal.prototype.initialize.apply(this,arguments);this.model.workingReport=new TokenAwareModel(_.pick(this.model.report.entry.content.toJSON({tokens:!0}),["search","dispatch.earliest_time","dispatch.latest_time"]),{applyTokensByDefault:!0,retrieveTokensByDefault:!0});this.children.title=new ControlGroup({label:_("Title").t(),controlType:"Label",controlClass:"controls-block",controlOptions:{model:this.model.report.entry.content,modelAttribute:"display.general.title"}});this.children.searchStringInput=new ControlGroup({label:_("Search String").t(),controlType:"Textarea",controlClass:"controls-block",controlOptions:{model:this.model.workingReport,modelAttribute:"search"}});this.children.searchStringInput.options.help=this.model.report.isPivotReport()?'<a href="#" class="run-pivot">'+_("Run Pivot").t()+' <i class="icon-external"></i></a>':'<a href="#" class="run-search">'+_("Run Search").t()+' <i class="icon-external"></i></a>';this.collection=this.collection||{};this.collection.times=new TimeRangeCollection;this.collection.times.fetch({data:{app:this.model.application.get("app"),owner:this.model.application.get("owner")}});this.model.timeRange=new PanelTimeRangeModel;this.children.timeRangePickerView=new TimeRangePickerView({model:{state:this.model.workingReport,timeRange:this.model.timeRange,application:this.model.application,user:this.model.user,appLocal:this.model.appLocal},collection:this.collection.times,appendSelectDropdownsTo:".modal:visible"});this.model.timeRange.on("applied",function(){this.timeRangeDelegate.closeTimeRangePicker()},this);this.children.panelTimeRangePicker=new PanelTimeRangePicker({model:{timeRange:this.model.timeRange,report:this.model.workingReport,state:this.model.state},collection:this.collection.times});this.children.flashMessages=new FlashMessagesView({model:this.model.dashboard});this.on("hide",this.model.dashboard.error.clear,this.model.dashboard.error);this.listenTo(this.model.report,"successfulSave",this.hide,this)},events:$.extend({},Modal.prototype.events,{"click .modal-btn-primary":function(e){e.preventDefault();var useTimeFrom=this.model.timeRange.get("useTimeFrom"),timeTokenPrefix="global"==useTimeFrom?"":useTimeFrom+".";this.children.flashMessages.flashMsgCollection.reset();if("tokens"===useTimeFrom){var ret=this.model.timeRange.validate();if(ret){_.each(ret,function(val){this.children.flashMessages.flashMsgCollection.add({key:"token-"+val,type:"error",html:_.escape(_(val).t())})},this);return}var earliestToken=this.model.timeRange.get("earliest_token"),latestToken=this.model.timeRange.get("latest_token");this.model.workingReport.set({"dispatch.earliest_time":"$"+earliestToken+"$","dispatch.latest_time":"$"+latestToken+"$"},{tokens:!0})}else"search"!==useTimeFrom?this.model.workingReport.set({"dispatch.earliest_time":"$"+timeTokenPrefix+"earliest$","dispatch.latest_time":"$"+timeTokenPrefix+"latest$"},{tokens:!0}):this.model.workingReport.set({"dispatch.earliest_time":this.model.timeRange.get("earliest")||"0","dispatch.latest_time":this.model.timeRange.get("latest")||""});var newAttributes=this.model.workingReport.toJSON();console.log("Applying attributes to report model: %o",newAttributes);this.model.report.trigger("updateSearchString",newAttributes)},"click a.run-search":function(e){e.preventDefault();var search=this.model.workingReport.get("search",{tokens:!1}),reportContent=this.model.report.entry.content;if("postprocess"===reportContent.get("display.general.search.type")){var baseSearch=mvc.Components.get(reportContent.get("display.general.managerid")).parent.settings.resolve();search=mergeSearch(baseSearch,search)}if(search){var params={q:search};if(this.model.workingReport.has("dispatch.earliest_time")){params.earliest=this.model.workingReport.get("dispatch.earliest_time",{tokens:!1}||"0");params.latest=this.model.workingReport.get("dispatch.latest_time",{tokens:!1})||""}var pageInfo=utils.getPageInfo(),url=route.search(pageInfo.root,pageInfo.locale,pageInfo.app,{data:params});utils.redirect(url,!0)}},"click a.run-pivot":function(e){e.preventDefault();var search=this.model.workingReport.get("search",{tokens:!1}),params={q:search};if(search){if(this.model.workingReport.has("dispatch.earliest_time")){params.earliest=this.model.workingReport.get("dispatch.earliest_time",{tokens:!1});params.latest=this.model.workingReport.get("dispatch.latest_time",{tokens:!1})}var pageInfo=utils.getPageInfo(),url=route.pivot(pageInfo.root,pageInfo.locale,pageInfo.app,{data:params});utils.redirect(url,!0)}}}),handleSubmitButtonState:function(model){this.$(Modal.FOOTER_SELECTOR).find(".btn-primary")["pivot"===model.get("elementCreateType")?"addClass":"removeClass"]("disabled")},render:function(){this.$el.html(Modal.TEMPLATE);this.$(Modal.HEADER_TITLE_SELECTOR).html(_("Edit Search").t());this.$(Modal.BODY_SELECTOR).remove();this.$(Modal.FOOTER_SELECTOR).before('<div class="vis-area"><div class="slide-area"><div class="content-wrapper query-dialog-wrapper"><div class="'+Modal.BODY_CLASS+'" ></div></div><div class="timerange-picker-wrapper"></div></div></div>');this.$visArea=this.$(".vis-area").eq(0);this.$slideArea=this.$(".slide-area").eq(0);this.$editSearchContent=this.$(".query-dialog-wrapper").eq(0);this.$timeRangePickerWrapper=this.$(".timerange-picker-wrapper").eq(0);this.$modalParent=this.$el;this.$(Modal.BODY_SELECTOR).prepend(this.children.flashMessages.render().el);this.$(Modal.BODY_SELECTOR).append(Modal.FORM_HORIZONTAL_JUSTIFIED);this.children.title.render().appendTo(this.$(Modal.BODY_FORM_SELECTOR));this.children.searchStringInput.render().appendTo(this.$(Modal.BODY_FORM_SELECTOR));var dfd=this.model.timeRange.save({earliest:this.model.workingReport.get("dispatch.earliest_time",{tokens:!1}||"0"),latest:this.model.workingReport.get("dispatch.latest_time",{tokens:!1}||"now")});dfd.done(_.bind(function(){this.$(Modal.BODY_FORM_SELECTOR).append(this.children.panelTimeRangePicker.render().el)},this));this.$timeRangePickerWrapper.append(this.children.timeRangePickerView.render().el);this.timeRangeDelegate=new TimeRangeDelegate({el:this.el,$visArea:this.$visArea,$slideArea:this.$slideArea,$contentWrapper:this.$editSearchContent,$timeRangePickerWrapper:this.$timeRangePickerWrapper,$modalParent:this.$modalParent,$timeRangePicker:this.children.timeRangePickerView.$el,activateSelector:"a.timerange-control",backButtonSelector:"a.btn.back"});this.$(Modal.FOOTER_SELECTOR).append(Modal.BUTTON_CANCEL);this.$(Modal.FOOTER_SELECTOR).append(Modal.BUTTON_SAVE);this.$(Modal.FOOTER_SELECTOR).append('<a href="#" class="btn back modal-btn-back pull-left">'+_("Back").t()+"</a>");this.$(".btn.back").hide();return this}})});define("views/dashboards/panelcontrols/ReportDialog",["jquery","underscore","backbone","module","views/shared/controls/ControlGroup","views/shared/Modal","views/shared/FlashMessages","splunk.util","uri/route","collections/search/Reports","splunkjs/mvc/utils","splunk.config"],function($,_,backbone,module,ControlGroup,Modal,FlashMessage,splunkUtil,route){return Modal.extend({moduleId:module.id,initialize:function(){Modal.prototype.initialize.apply(this,arguments);this.model.workingReport=new backbone.Model;this.model.workingReport.set({title:""});this.model.workingReport.set("id",this.model.report.get("id"));this.children.flashMessage=new FlashMessage({model:this.model.dashboard});this.on("hide",this.model.dashboard.error.clear,this.model.dashboard.error);this.listenTo(this.model.report,"successfulManagerChange",this.hide,this);this.controller=this.options.controller;this.controller.reportsCollection||this.controller.fetchCollection();this.controller.reportsCollection.initialFetchDfd.done(_.bind(function(){this.ready=!0;var items=this.controller.reportsCollection.map(function(report){return{label:report.entry.get("name"),value:report.id}}),reportsLink=route.reports(this.model.application.get("root"),this.model.application.get("locale"),this.model.application.get("app"));this.children.reportsControlGroup=new ControlGroup(this.controller.reportsCollection.length===this.controller.reportsCollection.REPORTS_LIMIT?{label:_("Select Report").t(),controlType:"SyntheticSelect",controlClass:"controls-block",controlOptions:{model:this.model.workingReport,modelAttribute:"id",items:items,toggleClassName:"btn",popdownOptions:{attachDialogTo:".modal:visible",scrollContainer:".modal:visible .modal-body:visible"}},help:_("This does not contain all reports. Add a report that is not listed from ").t()+splunkUtil.sprintf("<a href=%s>%s</a>.",reportsLink,_("Reports").t())}:{label:_("Select Report").t(),controlType:"SyntheticSelect",controlClass:"controls-block",controlOptions:{model:this.model.workingReport,modelAttribute:"id",items:items,toggleClassName:"btn",popdownOptions:{attachDialogTo:".modal:visible",scrollContainer:".modal:visible .modal-body:visible"}}})},this));this.children.panelTitleControlGroup=new ControlGroup({label:_("Panel Title").t(),controlType:"Text",controlClass:"controls-block",controlOptions:{model:this.model.workingReport,modelAttribute:"title",placeholder:_("optional").t()}})},events:$.extend({},Modal.prototype.events,{"click .modal-btn-primary":"onSave"}),onSave:function(e){e.preventDefault();this.model.report.trigger("updateReportID",this.model.workingReport.get("id"),this.model.workingReport.get("title"))
},render:function(){this.$el.html(Modal.TEMPLATE);this.$(Modal.HEADER_TITLE_SELECTOR).html(_("Select a New Report").t());this.$(Modal.BODY_SELECTOR).prepend(this.children.flashMessage.render().el);this.$(Modal.BODY_SELECTOR).append(Modal.FORM_HORIZONTAL);this.$(Modal.BODY_FORM_SELECTOR).append(Modal.LOADING_HORIZONTAL);this.$(Modal.LOADING_SELECTOR).html(_("Loading...").t());this.controller.reportsCollection.initialFetchDfd.done(_.bind(function(){this.$(Modal.LOADING_SELECTOR).remove();this.$(Modal.BODY_FORM_SELECTOR).append(this.children.reportsControlGroup.render().el);this.$(Modal.BODY_FORM_SELECTOR).append(this.children.panelTitleControlGroup.render().el)},this));this.$(Modal.FOOTER_SELECTOR).append(Modal.BUTTON_CANCEL);this.$(Modal.FOOTER_SELECTOR).append(Modal.BUTTON_SAVE)}})});define("views/dashboards/panelcontrols/CreateReportDialog",["jquery","underscore","backbone","module","views/shared/controls/ControlGroup","views/shared/Modal","views/shared/FlashMessages"],function($,_,backbone,module,ControlGroup,Modal,FlashMessagesView){return Modal.extend({moduleId:module.id,initialize:function(){Modal.prototype.initialize.apply(this,arguments);this.model.workingReport=new backbone.Model({name:this.model.report.entry.content.get("display.general.title")});this.children.flashMessagesReport=new FlashMessagesView({model:this.model.report});this.children.flashMessagesDashboard=new FlashMessagesView({model:this.model.dashboard});this.on("hide",this.model.report.error.clear,this.model.report.error);this.on("hide",this.model.dashboard.error.clear,this.model.dashboard.error);this.children.reportNameControlGroup=new ControlGroup({label:_("Report Title").t(),controlType:"Text",controlClass:"controls-block",controlOptions:{model:this.model.workingReport,modelAttribute:"name"}});this.children.reportDescriptionControlGroup=new ControlGroup({label:_("Description").t(),controlType:"Textarea",controlClass:"controls-block",controlOptions:{model:this.model.workingReport,modelAttribute:"description",placeholder:_("optional").t()}});this.listenTo(this.model.report,"successfulReportSave",this.hide,this)},events:$.extend({},Modal.prototype.events,{"click .modal-btn-primary":"onSave"}),onSave:function(e){e.preventDefault();this.model.report.trigger("saveAsReport",this.model.workingReport.get("name"),this.model.workingReport.get("description"))},render:function(){this.$el.html(Modal.TEMPLATE);this.$(Modal.HEADER_TITLE_SELECTOR).html(_("Convert to Report").t());this.$(Modal.BODY_SELECTOR).prepend(this.children.flashMessagesDashboard.render().el);this.$(Modal.BODY_SELECTOR).prepend(this.children.flashMessagesReport.render().el);this.$(Modal.BODY_SELECTOR).append(Modal.FORM_HORIZONTAL);this.$(Modal.BODY_FORM_SELECTOR).append(this.children.reportNameControlGroup.render().el);this.$(Modal.BODY_FORM_SELECTOR).append(this.children.reportDescriptionControlGroup.render().el);this.$(Modal.FOOTER_SELECTOR).append(Modal.BUTTON_CANCEL);this.$(Modal.FOOTER_SELECTOR).append(Modal.BUTTON_SAVE)}})});define("views/ValidatingView",["jquery","backbone","underscore","views/Base","util/general_utils"],function($,Backbone,_,BaseView,general_utils){return BaseView.extend({modelToControlGroupMap:{},stopListening:function(){this.tearDownValidation();BaseView.prototype.stopListening.apply(this,arguments)},setupValidation:function(modelOrCollection,flashMessagesHelper){if(_.isUndefined(modelOrCollection))throw"The model or collection you passed into views/Base.setupValidation is undefined";if(modelOrCollection instanceof Backbone.Model)this._setupModelValidationListener(modelOrCollection);else if(modelOrCollection instanceof Backbone.Collection){modelOrCollection.each(function(model){this._setupModelValidationListener(model)});modelOrCollection.on("add",function(model){this._setupModelValidationListener(model)},this);modelOrCollection.on("remove",function(model){model.off("validated",this._modelValidatedHandler,this)},this)}this.__flashMessagesHelper__=flashMessagesHelper;this.__flashMessagesHelper__.register(this)},tearDownValidation:function(){this.__flashMessagesHelper__&&this.__flashMessagesHelper__.unregister(this)},_setupModelValidationListener:function(model){model.on("validated",this._modelValidatedHandler,this)},_modelValidatedHandler:function(isValid,model,invalidAttrs){if(this.modelToControlGroupMap){var controlGroupToErrorMap=general_utils.invert(this.modelToControlGroupMap);controlGroupToErrorMap=_.reduce(_.keys(controlGroupToErrorMap||{}),function(memo,key){memo[key]=void 0;return memo},{});_(invalidAttrs).each(function(error,invalidAttr){invalidAttrs[invalidAttr]={message:error,label:""}});_(invalidAttrs).each(function(error,invalidAttr){var decoratedMessage,controlGroupName=this.modelToControlGroupMap[invalidAttr],message=error.message,controlGroupLabel="";if(_.isUndefined(controlGroupName))decoratedMessage=message.replace(/\{(label)\}/g,invalidAttr);else{this.children[controlGroupName].options.label&&(controlGroupLabel=this.children[controlGroupName].options.label);decoratedMessage=message.replace(/\{(label)\}/g,controlGroupLabel||invalidAttr);controlGroupToErrorMap[controlGroupName]=decoratedMessage}error.message=decoratedMessage;error.label=controlGroupLabel},this);_(controlGroupToErrorMap).each(function(error,controlGroup){_.isUndefined(error)?this.children[controlGroup].error(!1,""):this.children[controlGroup].error(!0,error)},this)}else _(invalidAttrs).each(function(error,invalidAttr){error.message=error.message.replace(/\{(label)\}/g,invalidAttr)});this.trigger("validated",isValid,model,invalidAttrs,this)}})});define("views/shared/dialogs/DialogBase",["jquery","underscore","backbone","views/ValidatingView","module","util/console","bootstrap.transition","bootstrap.modal"],function($,_,Backbone,ValidatingView,module){var ENTER_KEY=13,TEXT_INPUT_SELECTOR='input[type="text"], input[type="password"], textarea';return ValidatingView.extend({moduleId:module.id,className:"modal fade",attributes:{tabIndex:-1},settings:void 0,bodyClassName:"modal-body-scrolling",initialize:function(options){ValidatingView.prototype.initialize.call(this,options);options=options||{};this.$el.modal({show:!1,keyboard:!0});_.isUndefined(options.bodyClassName)||(this.bodyClassName=options.bodyClassName);this.settings=new Backbone.Model;this.settings.set("footerTemplate",this._footerTemplate);this.settings.set("headerTemplate",this._headerTemplate);this.settings.on("change:primaryButtonLabel change:cancelButtonLabel change:titleLabel",this.debouncedRender,this);this.$el.on("click.dialog",".btn-dialog-primary",_.bind(function(event){event.preventDefault();this.primaryButtonClicked()},this));this.$el.on("click.dialog",".btn-dialog-cancel",_.bind(function(event){event.preventDefault();this.cancelButtonClicked()},this));this.$el.on("click.dialog",".btn-dialog-close",_.bind(function(event){event.preventDefault();this.closeButtonClicked()},this));this.$el.on("keypress",_.bind(function(event){event.which===ENTER_KEY&&this.submitKeyPressed(event)},this));this.$el.on("shown",_.bind(function(e){e.target===e.currentTarget&&this.dialogShown()},this));this.$el.on("hide",_.bind(function(e){e.target===e.currentTarget&&this.cleanup()},this));this.$el.on("hidden",_.bind(function(e){e.target===e.currentTarget&&this.trigger("hidden")},this))},render:function(){this.$(".modal-header").detach();this.$(".modal-body").detach();this.$(".modal-footer").detach();var html=this.compiledTemplate({bodyClassName:this.bodyClassName,showFooter:this.shouldRenderFooter()});this.$el.html(html);this.renderHeader(this.$(".modal-header"));this.renderBody(this.$(".modal-body"));this.shouldRenderFooter()&&this.renderFooter(this.$(".modal-footer"));return this},hide:function(){this.$el.modal("hide")},show:function(){this.$el.modal("show")},primaryButtonClicked:function(){this.trigger("click:primaryButton",this)},cancelButtonClicked:function(){this.trigger("click:cancelButton",this)},closeButtonClicked:function(){this.trigger("click:closeButton",this)},submitKeyPressed:function(event){var $target=$(event.target);if($target.is(TEXT_INPUT_SELECTOR)){$target.blur();this.primaryButtonClicked()}},dialogShown:function(){this.trigger("show");_.debounce(function(){this.setFocus()}.bind(this),0)()},setFocus:function(){this.$("input:text:enabled:visible:first").focus()},cleanup:function(){this.trigger("hide")},shouldRenderFooter:function(){return this.settings.has("primaryButtonLabel")||this.settings.has("cancelButtonLabel")},renderBody:function(){},renderHeader:function($el){$el.html(this.settings.get("headerTemplate"));$el.find(".text-dialog-title").html(this.settings.get("titleLabel"))},renderFooter:function($el){$el.html(this.settings.get("footerTemplate"));var primaryButton=$el.find(".btn-dialog-primary.label_from_data");if(this.settings.has("primaryButtonLabel")){primaryButton.html(this.settings.get("primaryButtonLabel"));primaryButton.show()}else{primaryButton.html("");primaryButton.hide()}var cancelButton=$el.find(".btn-dialog-cancel.label_from_data");if(this.settings.has("cancelButtonLabel")){cancelButton.html(this.settings.get("cancelButtonLabel"));cancelButton.show()}else{cancelButton.html("");cancelButton.hide()}},template:'                <div class="modal-header"></div>                <div class="modal-body <%- bodyClassName %>"></div>                <% if (showFooter) { %>                    <div class="modal-footer"></div>                <% } %>            ',_footerTemplate:'                <a href="#" class="btn btn-dialog-cancel label_from_data pull-left" data-dismiss="modal"></a>                <a href="#" class="btn btn-primary btn-dialog-primary label_from_data pull-right"></a>            ',_headerTemplate:'                <button type="button" class="close btn-dialog-close" data-dismiss="modal">x</button>                <h3 class="text-dialog-title"></h3>            '})});define("views/shared/dialogs/TextDialog",["jquery","underscore","views/shared/dialogs/DialogBase","module","views/shared/FlashMessages"],function($,_,DialogBase,module,FlashMessagesView){return DialogBase.extend({moduleId:module.id,_text:"",initialize:function(options){DialogBase.prototype.initialize.call(this,options);this.settings.set("primaryButtonLabel",_("Ok").t());this.settings.set("cancelButtonLabel",_("Cancel").t());if(this.options.flashModel){this.children.flashMessages=new FlashMessagesView({model:this.options.flashModel});this.on("hide",this.options.flashModel.error.clear,this.options.flashModel.error)}this.on("hidden",this.remove,this);this.doDefault=!0},primaryButtonClicked:function(){DialogBase.prototype.primaryButtonClicked.call(this);this.doDefault&&this.hide()},setText:function(value){this._text=value;this.debouncedRender()},closeDialog:function(){this.hide();this.remove()},preventDefault:function(){this.doDefault=!1},renderBody:function($el){$el.html(this.bodyTemplate);$el.find(".text-dialog-placeholder").html(this._text);this.children.flashMessages&&$el.find(".text-dialog-placeholder").prepend(this.children.flashMessages.render().el)},bodyTemplate:'                <span class="text-dialog-placeholder"></span>            '})});define("views/dashboards/panelcontrols/Master",["underscore","views/Base","models/Base","jquery","module","views/shared/controls/SyntheticSelectControl","views/shared/delegates/Popdown","views/shared/reportcontrols/details/Master","collections/services/authorization/Roles","models/shared/Application","views/dashboards/panelcontrols/titledialog/Modal","views/dashboards/panelcontrols/querydialog/Modal","views/dashboards/panelcontrols/ReportDialog","views/dashboards/panelcontrols/CreateReportDialog","uri/route","util/console","splunk.util","views/shared/dialogs/TextDialog","bootstrap.tooltip"],function(_,BaseView,BaseModel,$,module,SyntheticSelectControl,Popdown,ReportDetailsView,RolesCollection,ApplicationModel,TitleDialogModal,QueryDialogModal,ReportDialog,CreateReportDialog,route,console,splunkUtils,TextDialog){var PanelControls=BaseView.extend({moduleId:module.id,initialize:function(){BaseView.prototype.initialize.apply(this,arguments);this.model.report.on("change:id",this.updateReportView,this);this.model.report.entry.content.on("change",this.updateReportView,this);this.collection=this.collection||{};this.collection.roles=new RolesCollection({});this.collection.roles.fetch()},onChangeElementTitle:function(e){e.preventDefault();this.children.titleDialogModal=new TitleDialogModal({model:{report:this.model.working,dashboard:this.model.dashboard},onHiddenRemove:!0});$("body").append(this.children.titleDialogModal.render().el);this.children.titleDialogModal.show();this.children.popdown.hide()},onChangeSearchString:function(e){e.preventDefault();if(!$(e.currentTarget).is(".disabled")){this.children.queryDialogModal=new QueryDialogModal({model:{report:this.model.report,appLocal:this.model.appLocal,application:this.model.application,user:this.model.user,dashboard:this.model.dashboard,state:this.model.state},onHiddenRemove:!0});$("body").append(this.children.queryDialogModal.render().el);this.children.queryDialogModal.show();this.children.popdown.hide()}},updateReportView:function(){this.debouncedRender()},render:function(){var panelClass,templateArgs={};panelClass=this.model.report.get("id")?this.model.report.isPivotReport()?"icon-report-pivot":"icon-report-search":this.model.report.isPivotReport()?"icon-pivot":"icon-search-thin";templateArgs["panelClass"]=panelClass;this.$el.html(this.compiledTemplate(templateArgs));this.children.popdown=new Popdown({el:this.el,mode:"dialog"});this._renderPanelControls();return this},_renderPanelControls:function(){this.$(".dropdown-menu").html(_.template(this._panelControlsTemplate,{_:_}));var panelType;panelType=this.model.report.get("id")?this.model.report.isPivotReport()?_("PIVOT REPORT").t():_("SEARCH REPORT").t():this.model.report.isPivotReport()?_("INLINE PIVOT").t():_("INLINE SEARCH").t();var panelTypeLI=_.template('<li class="panelType"><%- panelType %></li>',{panelType:panelType});if(this.model.report.get("id")){var reportList=_.template('<ul class="report_actions"><%= panelTypeLI %><li><a class="viewPanelReport" href="#"><%- reportName %><span class="icon-triangle-right-small"></span></a></li></ul>',{panelTypeLI:panelTypeLI,reportName:this.model.report.entry.get("name")});this.$(".panel_actions").before(reportList);this.$(".panel_actions").prepend('<li><a href="#" class="changeElementTitle">'+_("Edit Title").t()+"</a></li>")}else{var convertToReportItem=$('<li><a class="convertToReport" href="#">'+_("Convert to Report").t()+"</a></li>"),editSearchItem=$('<li><a href="#" class="changeSearchString">'+_("Edit Search String").t()+"</a></li>");if("global"===this.model.report.entry.content.get("display.general.search.type")){convertToReportItem.find("a").addClass("disabled").tooltip({animation:!1,title:_("Cannot convert global search to report.").t()});editSearchItem.find("a").addClass("disabled").tooltip({animation:!1,title:_("Cannot edit global search.").t()})}this.$(".panel_actions").prepend(convertToReportItem);this.$(".panel_actions").prepend(editSearchItem);this.$(".panel_actions").prepend('<li><a href="#" class="changeElementTitle">'+_("Edit Title").t()+"</a></li>");this.$(".panel_actions").prepend(panelTypeLI)}},_panelControlsTemplate:'                <div class="arrow"></div>                <ul class="panel_actions">                    <li><a class="deletePanel" href="#"><%- _("Delete").t() %></a></li>                </ul>        ',template:'            <a class="dropdown-toggle btn-pill" href="#">                    <span class="<%- panelClass %>"></span><span class="caret"></span>            </a>            <div class="dropdown-menu">            </div>        ',onDelete:function(e){e.preventDefault();this.children.dialog=new TextDialog({id:"modal_delete",flashModel:this.model.dashboard});this.model.report.on("successfulDelete",this.children.dialog.closeDialog,this.children.dialog);this.children.dialog.settings.set("primaryButtonLabel",_("Delete").t());this.children.dialog.settings.set("cancelButtonLabel",_("Cancel").t());this.children.dialog.on("click:primaryButton",this._dialogDeleteHandler,this);this.children.dialog.settings.set("titleLabel",_("Delete").t());this.children.dialog.setText(splunkUtils.sprintf(_("Are you sure you want to delete %s?").t(),"<em>"+_.escape(this.model.report.entry.content.get("display.general.title"))+"</em>"));$("body").append(this.children.dialog.render().el);this.children.dialog.show();this.children.popdown.hide()},_dialogDeleteHandler:function(e){e.preventDefault();this.model.report.trigger("deleteReport");console.log("deleteReport event triggered")},onViewPanelReport:function(e){e.preventDefault();e.stopPropagation();var viewReportLink,editReportLink,template="",root=this.model.application.get("root"),locale=this.model.application.get("locale"),app=this.model.application.get("app");viewReportLink=route.report(root,locale,app,{data:{s:this.model.report.get("id")}});if(this.model.report.isPivotReport()){template=this.pivotReportDetailsTemplate;editReportLink=route.pivot(root,locale,app,{data:{s:this.model.report.get("id")}})}else{template=this.searchReportDetailsTemplate;editReportLink=route.search(root,locale,app,{data:{s:this.model.report.get("id")}})}this.$(".dropdown-menu").html(_.template(template,{viewReportLink:viewReportLink,editReportLink:editReportLink,_:_}));this.children.reportDetails&&this.children.reportDetails.remove();this.children.reportDetails=new ReportDetailsView({model:{report:this.model.report,application:this.model.application,appLocal:this.model.appLocal,user:this.model.user},collection:this.collection.roles});this.$(".reportDetails").prepend($("<li/>").addClass("reportDetailsView").append(this.children.reportDetails.render().el));var desc=this.model.report.entry.content.get("description");desc&&this.$(".reportDetails").prepend($("<li/>").addClass("report-description").text(desc));this.$(".reportDetails").prepend($("<li/>").addClass("report-name").text(this.model.report.entry.get("name")));this.$(".dropdown-menu").addClass("show-details");$(window).trigger("resize")},searchReportDetailsTemplate:'            <div class="arrow"></div>            <a class="dialogBack btn" href="#"><span class="icon-chevron-left"/> <%- _("Back").t() %></a>            <ul class="reportDetails">                <li><a href="<%- viewReportLink %>" class="viewSearchReport"><%- _("View").t() %></a></li>                <li><a href="<%- editReportLink %>" class="openSearchReport"><%- _("Open in Search").t() %></a></li>                <li><a href="#" class="cloneSearchReport"><%- _("Clone to an Inline Search").t() %></a></li>            </ul>            <ul class="reportActions">                <li><a href="#" class="selectNewReport"><%- _("Select New Report").t() %></a></li>                <li><a href="#" class="useReportFormatting"><%- _("Use Report\'s Formatting for this Content").t() %></a></li>            </ul>        ',pivotReportDetailsTemplate:'            <div class="arrow"></div>            <a class="dialogBack btn" href="#"><span class="icon-chevron-left"/> <%- _("Back").t() %></a>            <ul class="reportDetails">                <li><a href="<%- viewReportLink %>" class="viewPivotReport"><%- _("View").t() %></a></li>                <li><a href="<%- editReportLink %>" class="openPivotReport"><%- _("Open in Pivot").t() %></a></li>                <li><a href="#" class="clonePivotReport"><%- _("Clone to an Inline Pivot").t() %></a></li>            </ul>            <ul class="reportActions">                <li><a class="selectNewReport"><%- _("Select New Report").t() %></a></li>                <li><a class="useReportFormatting"><%- _("Use Report\'s Formatting for this Content").t() %></a></li>            </ul>        ',onDialogBack:function(e){e.preventDefault();e.stopPropagation();this._renderPanelControls();this.$(".dropdown-menu").removeClass("show-details");$(window).trigger("resize")},tbd:function(e){e.preventDefault();alert("Coming soon to a Splunk near you!")},convertToInlineSearch:function(e){e.preventDefault();this.children.dialog=new TextDialog({id:"modal_inline",flashModel:this.model.dashboard});this.children.dialog.settings.set("primaryButtonLabel",_("Clone to Inline Search").t());this.children.dialog.settings.set("cancelButtonLabel",_("Cancel").t());this.children.dialog.on("click:primaryButton",this._convertToInlineSearch,this);this.model.report.on("successfulManagerChange",this.children.dialog.closeDialog,this.children.dialog);this.children.dialog.settings.set("titleLabel",_("Clone to Inline Search").t());this.children.dialog.setText("<div>                <p>"+_("The report will be cloned to an inline search.").t()+"</p>                <p>"+_("The inline search:").t()+"                </p><ul>                <li>"+_("Cannot be scheduled.").t()+"</li>                <li>"+_("Will run every time the dashboard is loaded.").t()+"</li>                <li>"+_("Will use the permissions of the dashboard.").t()+"</li>                </ul>                </div>");$("body").append(this.children.dialog.render().el);this.children.dialog.show();this.children.popdown.hide()},convertToInlinePivot:function(e){e.preventDefault();this.children.dialog=new TextDialog({id:"modal_inline",flashModel:this.model.dashboard});this.children.dialog.settings.set("primaryButtonLabel",_("Clone to Inline Pivot").t());this.children.dialog.settings.set("cancelButtonLabel",_("Cancel").t());this.children.dialog.on("click:primaryButton",this._convertToInlineSearch,this);this.model.report.on("successfulManagerChange",this.children.dialog.closeDialog,this.children.dialog);this.children.dialog.settings.set("titleLabel",_("Clone to Inline Pivot").t());this.children.dialog.setText("<div>                <p>"+_("The report will be cloned to an inline pivot.").t()+"</p>                <p>"+_("The inline pivot:").t()+"                </p><ul>                <li>"+_("Cannot be scheduled.").t()+"</li>                <li>"+_("Will run every time the dashboard is loaded.").t()+"</li>                <li>"+_("Will use the permissions of the dashboard.").t()+"</li>                </ul>                </div>");$("body").append(this.children.dialog.render().el);this.children.dialog.show();this.children.popdown.hide()},_convertToInlineSearch:function(e){e.preventDefault();this.model.report.trigger("makeInline");console.log("makeInline event triggered")},useReportFormatting:function(e){e.preventDefault();this.children.dialog=new TextDialog({id:"modal_use_report_formatting",flashModel:this.model.dashboard});this.children.dialog.settings.set("primaryButtonLabel",_("Use Report's Formatting").t());this.children.dialog.settings.set("cancelButtonLabel",_("Cancel").t());this.children.dialog.on("click:primaryButton",this._useReportFormatting,this);this.model.report.on("successfulReportFormatting",this.children.dialog.closeDialog,this.children.dialog);this.children.dialog.settings.set("titleLabel",_("Use Report's Formatting").t());this.children.dialog.setText(_("This will change the content's formatting to the report's formatting. Are you sure you want use the report's formatting?").t());$("body").append(this.children.dialog.render().el);this.children.dialog.show();this.children.popdown.hide()},_useReportFormatting:function(e){e.preventDefault();this.model.report.trigger("useReportFormatting");console.log("useReportFormatting event triggered")},selectNewReport:function(e){e.preventDefault();this.children.newReportDialog=new ReportDialog({model:{report:this.model.report,dashboard:this.model.dashboard,application:this.model.application},controller:this.options.controller,onHiddenRemove:!0});$("body").append(this.children.newReportDialog.render().el);this.children.newReportDialog.show();this.children.popdown.hide()},convertToReport:function(e){e.preventDefault();if(!$(e.currentTarget).is(".disabled")){this.children.createReportDialog=new CreateReportDialog({model:{report:this.model.report,dashboard:this.model.dashboard},onHiddenRemove:!0});$("body").append(this.children.createReportDialog.render().el);this.children.createReportDialog.show();this.children.popdown.hide()}},events:{"click a.deletePanel":"onDelete","click a.viewPanelReport":"onViewPanelReport","click a.changeElementTitle":"onChangeElementTitle","click a.changeSearchString":"onChangeSearchString","click a.dialogBack":"onDialogBack","click a.cloneSearchReport":"convertToInlineSearch","click a.clonePivotReport":"convertToInlinePivot","click a.selectNewReport":"selectNewReport","click a.convertToReport":"convertToReport","click a.useReportFormatting":"useReportFormatting","click a":function(e){var link=$(e.currentTarget).attr("href");if(link&&"#"!==link[link.length-1]){e.preventDefault();window.open(link)}},"click li.reportDetailsView a":function(){this.children.popdown.hide()}}});return PanelControls});define("splunkjs/mvc/simplexml/paneleditor",["require","exports","module","../mvc","../basesplunkview","views/shared/vizcontrols/Master","views/dashboards/panelcontrols/Master","../savedsearchmanager","../searchmanager","splunkjs/mvc/utils","underscore","splunk.config","models/Base","util/console","./controller","../tokenawaremodel","models/dashboards/DashboardReport"],function(require){var mvc=require("../mvc"),BaseSplunkView=require("../basesplunkview"),FormatControls=require("views/shared/vizcontrols/Master"),PanelControls=require("views/dashboards/panelcontrols/Master"),SavedSearchManager=require("../savedsearchmanager"),SearchManager=require("../searchmanager"),utils=require("splunkjs/mvc/utils"),_=require("underscore"),splunkConfig=require("splunk.config"),controller=(require("models/Base"),require("util/console"),require("./controller")),TokenAwareModel=require("../tokenawaremodel"),DashboardReport=require("models/dashboards/DashboardReport"),WorkingModel=DashboardReport.extend({initialize:function(attrs,options){DashboardReport.prototype.initialize.apply(this,arguments);this._report=options.report;this.entry.content=new TokenAwareModel({},{applyTokensByDefault:!0,retrieveTokensByDefault:!0});this.setFromSplunkD(this._report.toSplunkD());this.contentSyncer=utils.syncModels({source:this._report.entry.content,dest:this.entry.content,auto:"push"});this.entrySyncer=utils.syncModels({source:this._report.entry,dest:this.entry,auto:"push"})},save:function(attrs,options){attrs&&this.set(attrs,options);this._report.entry.set(this.entry.toJSON());this._report.entry.content.set(this.entry.content.toJSON({tokens:!0}));return this._report.saveXML(options)},syncOff:function(){this.contentSyncer.destroy();this.entrySyncer.destroy();this.off()}}),EditPanel=BaseSplunkView.extend({className:"panel-editor",initialize:function(){this.children=this.children||{};BaseSplunkView.prototype.initialize.call(this);this.model=this.model||{};this.model.report=this.model.report||new DashboardReport;this.model.working=new WorkingModel({},{report:this.model.report});this.model.application=controller.model.app;this.manager=this.options.manager;this._instantiateChildren();this.bindToComponent(this.manager,this.onManagerChange,this);this.listenTo(this.model.report,"makeInline",this._makePanelInline,this);this.listenTo(this.model.report,"useReportFormatting",this._useReportFormatting,this);this.listenTo(this.model.report,"updateReportID",this._updateReportID,this);this.listenTo(this.model.report,"saveAsReport",this._saveAsReport,this);this.listenTo(this.model.report,"updateSearchString",this._updateSearchManager,this);this.listenTo(this.model.report,"deleteReport",this._deleteReport,this);this.listenTo(this.model.working,"saveTitle",this._saveTitle,this);this.model.user=controller.model.user;this.model.appLocal=controller.model.appLocal},_instantiateChildren:function(){this.children.vizControl=new FormatControls({model:{report:this.model.working,application:this.model.application},vizTypes:["events","statistics","visualizations"],saveOnApply:!0,dashboard:!0});this.children.panelControl=new PanelControls({model:{report:this.model.report,working:this.model.working,application:this.model.application,appLocal:this.model.appLocal,user:this.model.user,dashboard:controller.model.view,state:controller.getStateModel()},controller:controller})},remove:function(){this.model.working.syncOff();this._removeChildren();BaseSplunkView.prototype.remove.apply(this,arguments)},_removeChildren:function(){this.children.vizControl.remove();this.children.panelControl.remove()},_updateSearchManager:function(newAttributes){var oldState=this.model.report.toSplunkD();this.model.report.entry.content.set(newAttributes);var dfd=this.model.report.saveXML();dfd.done(_.bind(function(){this.model.report.trigger("successfulSave");var manager=mvc.Components.get(this.manager);if(manager.settings){manager.settings.set("search",this.model.report.entry.content.get("search",{tokens:!0}),{tokens:!0,silent:!1});manager.settings.set({earliest_time:this.model.report.entry.content.get("dispatch.earliest_time",{tokens:!0}),latest_time:this.model.report.entry.content.get("dispatch.latest_time",{tokens:!0})},{tokens:!0})}},this));dfd.fail(_.bind(function(){this.model.report.setFromSplunkD(oldState,{silent:!1})},this))},onManagerChange:function(){this._removeChildren();this._instantiateChildren();this.render()},render:function(){this.$el.append(this.children.panelControl.render().el);this.$el.append(this.children.vizControl.render().el);return this},_makePanelInline:function(){var oldState=this.model.report.toSplunkD(),oldName=this.model.report.entry.get("name"),oldId=this.model.report.get("id");delete this.model.report.id;this.model.report.unset("id",{silent:!0});this.model.report.entry.unset("name",{silent:!0});var dfd=this.model.report.saveXML();dfd.fail(_.bind(function(){this.model.report.setFromSplunkD(oldState,{silent:!1})},this));dfd.done(_.bind(function(){this.model.report.trigger("successfulManagerChange");new SearchManager({id:this.manager,latest_time:this.model.report.entry.content.get("dispatch.latest_time"),earliest_time:this.model.report.entry.content.get("dispatch.earliest_time"),search:this.model.report.entry.content.get("search"),app:utils.getCurrentApp(),auto_cancel:90,status_buckets:0,preview:!0,timeFormat:"%s.%Q",wait:0},{replace:!0});this.model.report.set({id:oldId},{silent:!0});this.model.report.unset("id",{silent:!1});this.model.report.entry.set({name:oldName},{silent:!0});this.model.report.entry.unset("name",{silent:!1})},this))},_useReportFormatting:function(){var oldState=this.model.report.toSplunkD(),dfd=this.model.report.fetch({},{silent:!0});dfd.done(_.bind(function(){var newState=this.model.report.toSplunkD(),dfd=this.model.report.saveXML({clearOptions:!0});dfd.fail(_.bind(function(){this.model.report.setFromSplunkD(oldState,{silent:!1})},this));dfd.done(_.bind(function(){this.model.report.setFromSplunkD(oldState,{silent:!0});this.model.report.setFromSplunkD(newState,{silent:!1});this.model.report.trigger("successfulReportFormatting")},this))},this))},_updateReportID:function(id,title){var oldState=this.model.report.toSplunkD();if(id){this.model.report.set({id:id},{silent:!0});this.model.report.entry.set({id:id},{silent:!0});this.model.report.id=id}title&&this.model.report.entry.content.set({"display.general.title":title});var dfd=this.model.report.fetch({},{silent:!0});dfd.done(_.bind(function(){var dfd=this.model.report.saveXML();dfd.fail(_.bind(function(){this.model.report.setFromSplunkD(oldState,{silent:!1})},this));dfd.done(_.bind(function(){this.model.report.trigger("successfulManagerChange");new SavedSearchManager({id:this.manager,searchname:this.model.report.entry.get("name"),app:utils.getCurrentApp(),auto_cancel:90,status_buckets:0,preview:!0,timeFormat:"%s.%Q",wait:0},{replace:!0})},this))},this))},_saveAsReport:function(name,description){var oldState=this.model.report.toSplunkD();this.model.report.entry.content.set({name:name,description:description,"display.general.title":name});this.model.report.entry.set({name:name},{silent:!0});
"postprocess"===this.model.report.entry.content.get("display.general.search.type")&&this.model.report.entry.content.set("search",mvc.Components.get(this.manager).settings.resolve());var dfd=this.model.report.save({},{data:{app:utils.getCurrentApp(),owner:splunkConfig.USERNAME}});dfd.done(_.bind(function(){var dfd=this.model.report.saveXML();dfd.fail(_.bind(function(){this.model.report.destroy();this.model.report.unset("id",{silent:!0});this.model.report.setFromSplunkD(oldState,{silent:!1})},this));dfd.done(_.bind(function(){this.model.report.trigger("successfulReportSave");new SavedSearchManager({id:this.manager,searchname:name,app:utils.getCurrentApp(),auto_cancel:90,status_buckets:0,preview:!0,timeFormat:"%s.%Q",wait:0},{replace:!0})},this))},this))},_saveTitle:function(newTitle){var oldState=this.model.report.toSplunkD();this.model.working.entry.content.set({"display.general.title":newTitle});var dfd=this.model.working.save();dfd.fail(_.bind(function(){this.model.report.setFromSplunkD(oldState,{silent:!1})},this));dfd.done(_.bind(function(){this.model.working.trigger("successfulSave");this.model.report.entry.content.set({"display.general.title":""},{silent:!1});this.model.report.entry.content.set({"display.general.title":newTitle},{silent:!1})},this))},_deleteReport:function(){var dfd=this.model.report.deleteXML();dfd.done(_.bind(function(){this.model.report.trigger("successfulDelete");this.model.report.trigger("removedPanel")},this))}});return EditPanel});define("splunkjs/mvc/simplexml/element/base",["require","underscore","jquery","backbone","../../basesplunkview","../../../mvc","../../utils","../controller","models/dashboards/DashboardReport","util/console","../../progressbarview","../../refreshtimeindicatorview","../../resultslinkview","../paneleditor","../../savedsearchmanager","../../postprocessmanager","../../messages","../../tokenutils","util/general_utils"],function(require){var _=require("underscore"),$=require("jquery"),Backbone=require("backbone"),BaseSplunkView=require("../../basesplunkview"),mvc=require("../../../mvc"),utils=require("../../utils"),Dashboard=require("../controller"),ReportModel=require("models/dashboards/DashboardReport"),console=require("util/console"),ProgressBarView=require("../../progressbarview"),RefreshTimeView=require("../../refreshtimeindicatorview"),ResultsLinkView=require("../../resultslinkview"),PanelElementEditor=require("../paneleditor"),SavedSearchManager=require("../../savedsearchmanager"),PostProcessSearchManager=require("../../postprocessmanager"),Messages=require("../../messages"),TokenUtils=require("../../tokenutils"),GeneralUtils=require("util/general_utils"),WARN_ON_MISSING_TOKENS_TRUE=!1,ELEMENT_TYPES={},REPORT_DEFAULTS_LOADED=(new ReportModel).fetch(),DashboardElement=BaseSplunkView.extend({initialVisualization:"#abstract",configure:function(){this.options.settingsOptions=_.extend({retainUnmatchedTokens:!0},this.options.settingsOptions||{});this.options=_.extend(this.options,{id:this.id,manager:this.options.managerid,title:this.$("h3").text()});WARN_ON_MISSING_TOKENS_TRUE&&this.options.settingsOptions.tokens!==!0&&console.warn("element created without tokens=true: "+this.id);BaseSplunkView.prototype.configure.apply(this,arguments)},initialize:function(){this.configure();this.visualization=null;this.model=new ReportModel;this.managerid=this.options.managerid;this.settings._sync=utils.syncModels(this.settings,this.model.entry.content,{auto:!0,prefix:"display.general.",include:["id","title","manager","managerid"]});this.bindToComponent(this.managerid,this.onManagerChange,this);var typeModel=this.typeModel=new Backbone.Model({type:this.initialVisualization});this.reportReady=$.Deferred();this.listenTo(this.typeModel,"change",this.createVisualization,this);this.listenTo(Dashboard.getStateModel(),"change:edit",this.onEditModeChange,this);this.reportReady.done(_.bind(function(){this.listenTo(this.model.entry.content,"change:display.general.type change:display.visualizations.type change:display.events.type",function(m){var general=m.get("display.general.type"),subName=["display",general,"type"].join("."),sub=m.get(subName),qualifiedType=sub?[general,sub].join(":"):general;typeModel.set("type",ELEMENT_TYPES.hasOwnProperty(qualifiedType)?qualifiedType:general)},this);this.listenTo(this.settings,"change:title",this.updateTitle,this);this.listenTo(this.model,"removedPanel",this.remove,this)},this));this._setupTokenDependencies()},remove:function(){this._removeVisualization();_([this.refreshTime,this.panelEditor]).chain().filter(_.identity).invoke("remove");this.settings&&this.settings._sync&&this.settings._sync.destroy();mvc.Components.get("dashboard").removeElement(this.id);BaseSplunkView.prototype.remove.call(this)},onManagerChange:function(managers,manager){var that=this;if(manager instanceof SavedSearchManager){var name=manager.get("searchname"),appModel=Dashboard.getStateModel().app,initial=!this.model.entry.content.has("display.general.type");this.model.id=["","servicesNS",encodeURIComponent(appModel.get("owner")),encodeURIComponent(appModel.get("app")),"saved","searches",encodeURIComponent(name)].join("/");this.model.fetch({tokens:!1}).done(function(){initial&&that.model.entry.content.set(that._initialVisualizationToAttributes());that.reportReady.resolve(that.model)}).fail(function(xhr){console.error("Failed to load saved search",arguments);404===xhr.status&&that.showErrorMessage(_("Warning: saved search not found: ").t()+JSON.stringify(name))})}else REPORT_DEFAULTS_LOADED.done(manager?function(response){if(!that.model.entry.content.has("display.general.type")){that.model.entry.content.set(response.entry[0].content,{tokens:!1});"#abstract"!==that.initialVisualization&&that.model.entry.content.set(that._initialVisualizationToAttributes())}var searchType="inline";if(manager instanceof PostProcessSearchManager){searchType="postprocess";that.model.entry.content.set("fullSearch",manager.settings.resolve())}else manager.has("metadata")&&manager.get("metadata").global&&(searchType="global");that.model.entry.content.set("display.general.search.type",searchType);that.model.entry.content.set({search:manager.get("search",{tokens:!0}),"dispatch.earliest_time":manager.get("earliest_time",{tokens:!0}),"dispatch.latest_time":manager.get("latest_time",{tokens:!0})},{tokens:!0});that.reportReady.resolve(that.model)}:function(response){if(!that.model.entry.content.has("display.general.type")){that.model.entry.content.set(response.entry[0].content,{tokens:!1});"#abstract"!==that.initialVisualization&&that.model.entry.content.set(that._initialVisualizationToAttributes())}that.reportReady.resolve(that.model)})},showErrorMessage:function(message){this._removeInitialPlaceholder();var el=this.$(".panel-body>.msg");el.length||(el=$('<div class="msg"></div>').appendTo(this.$(".panel-body")));Messages.render({level:"error",icon:"warning-sign",message:message},el)},_initialVisualizationToAttributes:function(){var type=this.initialVisualization.split(":"),attr={"display.general.type":type[0]};type.length>1&&(attr[["display",type[0],"type"].join(".")]=type[1]);return attr},onEditModeChange:function(model){var handler=this._debouncedOnEditModeChange;handler||(handler=this._debouncedOnEditModeChange=_.debounce(_.bind(this._onEditModeChange,this),0));this.reportReady.done(function(){handler(model)})},_onEditModeChange:function(model){if(model.get("edit")){if(this.refreshTime){this.refreshTime.remove();this.refreshTime=null}this.updateTitle();this.createPanelElementEditor();this.$el.is(".hidden")&&this.$el.show().parents(".dashboard-panel").trigger("elementVisibilityChanged")}else{if(this.panelEditor){this.panelEditor.remove();this.panelEditor=null}this.createRefreshTimeIndicator();this.updateTitle();this.$el.is(".hidden")&&this.$el.hide().parents(".dashboard-panel").trigger("elementVisibilityChanged")}},_setupTokenDependencies:function(){function isTokenDefined(token){return registry.get(token.namespace).has(token.name)}function handleTokenChange(){_(requiredTokens).all(isTokenDefined)&&!_(rejectedTokens).any(isTokenDefined)?element.show():element.hide()}var deps=this.settings.get("tokenDependencies",{tokens:!0});if(deps){var element=this,registry=mvc.Components,requiredTokens=deps.depends?TokenUtils.getTokens(deps.depends,{tokenNamespace:"submitted"}):[],rejectedTokens=deps.rejects?TokenUtils.getTokens(deps.rejects,{tokenNamespace:"submitted"}):[],allTokens=requiredTokens.concat(rejectedTokens);_(allTokens).each(function(token){var ns=registry.get(token.namespace);element.listenTo(ns,"change:"+token.name,handleTokenChange,element)});handleTokenChange()}},hide:function(){if(!this.$el.is(".hidden")){Dashboard.getStateModel().get("edit")||this.$el.hide();this.$el.addClass("hidden").parents(".dashboard-panel").trigger("elementVisibilityChanged")}},show:function(){if(this.$el.is(".hidden")){this.$el.show().removeClass("hidden").parents(".dashboard-panel").trigger("elementVisibilityChanged");this.visualization&&this.visualization.render()}},createPanelElementEditor:function(){if(this.panelEditor){this.panelEditor.remove();this.panelEditor=null}this.panelEditor=new PanelElementEditor({manager:this.managerid,model:{report:this.model}});this.$el.prepend(this.panelEditor.render().el)},createRefreshTimeIndicator:function(){var refreshTimeVisible=this.settings.get("refresh.time.visible"),showRefreshTime=void 0===refreshTimeVisible||GeneralUtils.normalizeBoolean(refreshTimeVisible,{"default":!1}),refreshTimeInterval=this.settings.get("refresh.auto.interval");this.refreshTime||!showRefreshTime&&!refreshTimeInterval||(this.refreshTime=new RefreshTimeView({id:_.uniqueId(this.id+"-refreshtime"),el:$('<div class="refresh-time-indicator pull-right"></div>').prependTo(this.$(".panel-head")),manager:this.managerid,"refresh.auto.interval":this.settings.get("refresh.auto.interval"),"refresh.time.visible":this.settings.get("refresh.time.visible")}).render())},createVisualization:function(applyOptions){var createFn=this._debouncedCreateViz;createFn||(createFn=this._debouncedCreateViz=_.debounce(_.bind(this._createVisualization,this),0));$.when(this.reportReady).then(function(){createFn(applyOptions===!0)})},_removeVisualization:function(){if(this.visualization){this.visualization.panelClassName&&this.$el.removeClass(this.visualization.panelClassName);this.visualization.off();this.visualization.remove();this.visualization=null}if(this.resultsLink){this.resultsLink.off();this.resultsLink.remove();this.resultsLink=null}},_removeInitialPlaceholder:function(){this.$(".panel-body > .msg, .panel-body > .initial-placeholder").remove()},_createVisualization:function(applyOptions){var initial=!this.visualization;this._removeInitialPlaceholder();this._removeVisualization();var type=this.typeModel.get("type"),Element=ELEMENT_TYPES[type];if(Element){var options={el:$("<div></div>").appendTo(this.$(".panel-body")),reportModel:this.model.entry.content,managerid:this.settings.get("manager"),id:_.uniqueId(this.id+"-viz-")};(initial||applyOptions)&&(options=_.extend({},this.options,options));options.settingsOptions&&(options.settingsOptions.retainUnmatchedTokens=!1);WARN_ON_MISSING_TOKENS_TRUE&&(options.settingsOptions||{}).tokens!==!0&&console.warn("viz created without tokens=true: "+options.id);this.visualization=new Element(options).render();this.visualization.panelClassName&&this.$el.addClass(this.visualization.panelClassName);if(0===type.indexOf("events")){var manager=mvc.Components.getInstance(this.settings.get("manager"));manager.settings.set("status_buckets",300)}this.trigger("create:visualization",this.visualization);initial&&this.model.entry.content.set(_.defaults(this.model.entry.content.toJSON({tokens:!0}),this.visualization.reportDefaults));if("function"==typeof this.visualization.getResultsLinkOptions){var resultsLinkOptions=this.visualization.getResultsLinkOptions(this.options)||{};this.resultsLink=new ResultsLinkView(_.extend({},resultsLinkOptions,this.options,{id:_.uniqueId(this.id+"-resultslink"),el:$('<div class="view-results pull-left"></div>').appendTo(this.$(".panel-footer")),manager:this.managerid,model:this.model})).render()}this.visualization.on("all",this.trigger,this)}else this.showErrorMessage(_("Unsupported visualization type: ").t()+JSON.stringify(type))},getVisualization:function(callback){var dfd=$.Deferred();callback&&dfd.done(callback);this.visualization?dfd.resolve(this.visualization):this.once("create:visualization",dfd.resolve,dfd);return dfd.promise()},render:function(){this.createPanelStructure();this.progressBar||(this.progressBar=new ProgressBarView({id:_.uniqueId(this.id+"-progressbar"),manager:this.managerid,el:$('<div class="progress-container pull-right"></div>').prependTo(this.$(".panel-footer"))}).render());this.createRefreshTimeIndicator();this.createVisualization();this.onEditModeChange(Dashboard.getStateModel());return this},createPanelStructure:function(){this.$(".panel-head").length||$('<div class="panel-head"></div>').prependTo(this.$el);var $title=this.$(".panel-head>h3");$title.length||$("<h3></h3>").prependTo(this.$(".panel-head"));this.updateTitle();this.$(".panel-body").length||$('<div class="panel-body"></div>').appendTo(this.$el);var el=$('<div class="initial-placeholder"></div>').addClass("placeholder-"+this.initialVisualization.replace(/\W+/,"-"));el.appendTo(this.$(".panel-body"));this.$("panel-footer").length||$('<div class="panel-footer"></div>').appendTo(this.$el)},updateTitle:function(){var title=this.settings.get("title")||"";Dashboard.getStateModel().get("edit")&&!title?this.$(".panel-head>h3").empty().append($('<span class="untitled">'+_("Untitled Panel").t()+"</span>")):this.$(".panel-head>h3").text(title)},getExportParams:function(prefix){var manager=mvc.Components.get(this.managerid),result={};manager&&!(manager instanceof PostProcessSearchManager)&&manager.job&&manager.job.sid&&(result[prefix]=manager.job.sid);return result}},{registerVisualization:function(name,clazz){ELEMENT_TYPES[name]=clazz},getVisualization:function(name){var viz=ELEMENT_TYPES[name];viz||(viz=ELEMENT_TYPES[name.split(":")[0]]);return viz}});return DashboardElement});define("splunkjs/mvc/simplexml/dialog/addpanel/inline",["require","underscore","jquery","views/Base","views/shared/controls/ControlGroup","util/console","../../../utils","uri/route","util/time","views/dashboards/PanelTimeRangePicker","bootstrap.tooltip"],function(require){var _=require("underscore"),BaseView=(require("jquery"),require("views/Base")),ControlGroup=require("views/shared/controls/ControlGroup"),utils=(require("util/console"),require("../../../utils")),route=require("uri/route"),PanelTimeRangePicker=(require("util/time"),require("views/dashboards/PanelTimeRangePicker"));require("bootstrap.tooltip");return BaseView.extend({initialize:function(){BaseView.prototype.initialize.apply(this,arguments);this.children.searchField=new ControlGroup({controlType:"Textarea",controlOptions:{modelAttribute:"search",model:this.model.report},label:_("Search String").t(),help:'<a href="#" class="run-search">'+_("Run Search").t()+' <i class="icon-external"></i></a>'});this.listenTo(this.model.report,"change:elementCreateType",this.onModeChange,this);this.children.panelTimeRangePicker=new PanelTimeRangePicker({model:{timeRange:this.model.timeRange,report:this.model.report,state:this.model.state},collection:this.collection});this.model.report.set({"dispatch.earliest_time":this.model.timeRange.get("earliest"),"dispatch.latest_time":this.model.timeRange.get("latest")},{tokens:!0})},events:{"click a.run-search":function(e){e.preventDefault();var search=this.model.report.get("search"),params={q:search},pageInfo=utils.getPageInfo();if(search){if(this.model.report.has("dispatch.earliest_time")){params.earliest=this.model.report.get("dispatch.earliest_time");params.latest=this.model.report.get("dispatch.latest_time")}utils.redirect(route.search(pageInfo.root,pageInfo.locale,pageInfo.app,{data:params}),!0)}}},onModeChange:function(){var fn="inline"===this.model.report.get("elementCreateType")?"show":"hide";this.$el[fn]()},render:function(){this.children.searchField.render().appendTo(this.el);this.children.panelTimeRangePicker.render().appendTo(this.el);this.onModeChange();return this}})});define("splunkjs/mvc/simplexml/dialog/addpanel/report",["require","underscore","jquery","views/Base","views/shared/controls/ControlGroup","../../../utils","util/time","models/shared/Cron","splunk.util","uri/route","collections/services/SavedSearches","views/shared/Modal"],function(require){var _=require("underscore"),Base=(require("jquery"),require("views/Base")),ControlGroup=require("views/shared/controls/ControlGroup"),utils=require("../../../utils"),timeUtils=require("util/time"),Cron=require("models/shared/Cron"),splunkUtil=require("splunk.util"),route=require("uri/route"),Modal=(require("collections/services/SavedSearches"),require("views/shared/Modal"));return Base.extend({initialize:function(){Base.prototype.initialize.apply(this,arguments);this.children.reportPlaceholder=new Base;this.controller=this.options.controller;this.controller.reportsCollection||this.controller.fetchCollection();this.controller.reportsCollection.initialFetchDfd.done(_.bind(function(){var items=this.controller.reportsCollection.map(function(report){return{label:report.entry.get("name"),value:report.entry.get("name")}}),pageInfo=utils.getPageInfo(),reportsLink=route.reports(pageInfo.root,pageInfo.locale,pageInfo.app);this.children.report=new ControlGroup(this.controller.reportsCollection.length===this.controller.reportsCollection.REPORTS_LIMIT?{label:"",controlType:"SyntheticSelect",controlOptions:{className:"btn-group add-panel-report",toggleClassName:"btn",model:this.model,modelAttribute:"savedSearchName",items:items,popdownOptions:this.options.popdownOptions||{attachDialogTo:".modal:visible",scrollContainer:".modal:visible .modal-body:visible"}},help:_("This does not contain all reports. Add a report that is not listed from ").t()+splunkUtil.sprintf("<a href=%s>%s</a>.",reportsLink,_("Reports").t())}:{label:"",controlType:"SyntheticSelect",controlOptions:{className:"btn-group add-panel-report",toggleClassName:"btn",model:this.model,modelAttribute:"savedSearchName",items:items,popdownOptions:this.options.popdownOptions||{attachDialogTo:".modal:visible",scrollContainer:".modal:visible .modal-body:visible"}}});this.model.get("savedSearchName")||this.model.set("savedSearchName",items[0].value)},this));this.children.searchField=new ControlGroup({controlType:"Textarea",controlOptions:{modelAttribute:"savedSearchString",model:this.model},label:_("Search String").t(),help:'<a href="#" class="run-search">'+_("Run Search").t()+' <i class="icon-external"></i></a>'});this.children.timerangeField=new ControlGroup({controlType:"Label",controlOptions:{modelAttribute:"savedSearchTimerange",model:this.model},label:_("Time Range").t()});this.children.schedule=new ControlGroup({controlType:"Label",controlOptions:{modelAttribute:"savedSearchSchedule",model:this.model},label:_("Schedule").t()});this.children.permissions=new ControlGroup({controlType:"Label",controlOptions:{modelAttribute:"savedSearchPermissions",model:this.model},label:_("Permissions").t()});this.model.set("savedSearchString","...");this.listenTo(this.model,"change:elementCreateType",this.onModeChange,this);this.listenTo(this.model,"change:savedSearchName",this.searchSelected,this)},events:{"click a.run-search":function(e){e.preventDefault();var savedSearchName=this.model.get("savedSearchName");if(savedSearchName){var pageInfo=utils.getPageInfo(),url=route.search(pageInfo.root,pageInfo.locale,pageInfo.app,{data:{s:savedSearchName}});utils.redirect(url,!0)}}},searchSelected:function(){var savedSearchName=this.model.get("savedSearchName"),report=this.controller.reportsCollection.find(function(model){return model.entry.get("name")===savedSearchName});if(report){this.model.set("savedSearch",report.get("id"));this.model.set("savedSearchString",report.entry.content.get("search"));var sub,et=report.entry.content.get("dispatch.earliest_time"),lt=report.entry.content.get("dispatch.latest_time"),vizType="statistics";if(report.entry.content.has("display.general.type")){vizType=report.entry.content.get("display.general.type");sub=["display",vizType,"type"].join(".");report.entry.content.has(sub)&&(vizType=[vizType,report.entry.content.get(sub)].join(":"))}this.model.set("savedSearchVisualization",vizType);this.model.set("savedSearchTimerange",timeUtils.generateLabel(this.collection.timeRanges,et,null,lt,null));var schedule=_("Never").t();if(report.entry.content.get("is_scheduled")){var cronModel=Cron.createFromCronString(report.entry.content.get("cron_schedule"));schedule=cronModel.getScheduleString()}this.model.set("savedSearchSchedule",schedule);this.model.set("savedSearchPermissions",splunkUtil.sprintf(_("%s. Owned by %s.").t(),report.entry.acl.get("perms")?_("Shared").t():_("Not Shared").t(),report.entry.acl.get("owner")))}},onModeChange:function(){this.$el["saved"===this.model.get("elementCreateType")?"show":"hide"]();if("saved"===this.model.get("elementCreateType")&&4!==this.controller.reportsCollection.initialFetchDfd.readyState&&0===this.$(Modal.LOADING_SELECTOR).length){this.$el.append(Modal.LOADING_HORIZONTAL);this.$(Modal.LOADING_SELECTOR).html(_("Loading...").t())}},render:function(){this.children.reportPlaceholder.render().appendTo(this.el);this.controller.reportsCollection.initialFetchDfd.done(_.bind(function(){this.$(Modal.LOADING_SELECTOR).length>0&&this.$(Modal.LOADING_SELECTOR).remove();this.children.report.render().appendTo(this.children.reportPlaceholder.el);this.searchSelected();this.children.searchField.render().appendTo(this.el);this.children.searchField.$("textarea").attr("readonly","readonly");this.children.timerangeField.render().appendTo(this.el);this.children.schedule.render().appendTo(this.el);this.children.permissions.render().appendTo(this.el);this.onModeChange()},this));return this}})});define("splunkjs/mvc/simplexml/dialog/addpanel/pivot",["require","underscore","views/Base","../../../utils","uri/route"],function(require){var _=require("underscore"),Base=require("views/Base"),utils=require("../../../utils"),route=require("uri/route");return Base.extend({initialize:function(){Base.prototype.initialize.apply(this,arguments);this.listenTo(this.model,"change:elementCreateType",this.onModeChange,this)},render:function(){if(!this.el.innerHTML){var pageInfo=utils.getPageInfo();this.$el.html(_.template(this.template,{pivotLink:route.pivot(pageInfo.root,pageInfo.locale,pageInfo.app)}))}this.onModeChange();return this},onModeChange:function(){var fn="pivot"===this.model.get("elementCreateType")?"show":"hide";this.$el[fn]()},template:'<label class="control-label"></label><div class="controls">'+_("Use the Pivot tool to summarize Data Model information and add it as a dashboard panel. You'll need to know the name of this dashboard when you save from the Pivot tool.").t()+"</div>"})});define("splunkjs/mvc/simplexml/dialog/addpanel/master",["require","exports","module","underscore","jquery","splunkjs/mvc","views/Base","views/shared/controls/ControlGroup","../../controller","./inline","./report","./pivot","util/console"],function(require,module){{var _=require("underscore"),BaseView=(require("jquery"),require("splunkjs/mvc"),require("views/Base")),ControlGroup=require("views/shared/controls/ControlGroup"),Dashboard=require("../../controller"),InlineForm=require("./inline"),ReportForm=require("./report"),PivotForm=require("./pivot");require("util/console")}return BaseView.extend({moduleId:module.id,className:"add-panel",initialize:function(){BaseView.prototype.initialize.apply(this,arguments);this.children.panelTitleControlGroup=new ControlGroup({label:_("Content Title").t(),controlType:"Text",controlClass:"controls-block",controlOptions:{model:this.model.report,modelAttribute:"title",placeholder:_("optional").t()}});this.children.elementCreateType=new ControlGroup({label:_("Content Type").t(),controlType:"SyntheticRadio",controlClass:"controls-thirdblock",controlOptions:{className:"btn-group btn-group-3 add-panel-select",items:[{value:"inline",label:'<i class="icon-search-thin"></i>',tooltip:_("Inline Search").t()},{value:"pivot",label:'<i class="icon-pivot"></i>',tooltip:_("Inline Pivot").t()},{value:"saved",label:'<i class="icon-report"></i>',tooltip:_("Report").t()}],model:this.model.report,modelAttribute:"elementCreateType"}});var timesCollection=Dashboard.collection.times;this.children.inline=new InlineForm({model:this.model,collection:{timeRanges:timesCollection}});this.children.report=new ReportForm({model:this.model.report,collection:{timeRanges:timesCollection},controller:this.options.controller});this.children.pivot=new PivotForm({model:this.model.report})},render:function(){this.$el.append(this.children.panelTitleControlGroup.render().el);this.$el.append(this.children.elementCreateType.render().el);this.$el.append(this.children.inline.render().el);this.$el.append(this.children.pivot.render().el);this.$el.append(this.children.report.render().el);return this}})});define("splunkjs/mvc/simplexml/dialog/addpanel",["require","exports","module","underscore","jquery","splunkjs/mvc","views/shared/Modal","models/Base","../../utils","../controller","../element/base","../mapper","./addpanel/master","../../searchmanager","../../savedsearchmanager","util/console","views/shared/timerangepicker/dialog/Master","models/shared/TimeRange","views/shared/delegates/ModalTimerangePicker","../controller","uri/route","views/shared/FlashMessages"],function(require,module){var _=require("underscore"),$=require("jquery"),mvc=require("splunkjs/mvc"),Modal=require("views/shared/Modal"),BaseModel=require("models/Base"),utils=require("../../utils"),Dashboard=require("../controller"),DashboardElement=require("../element/base"),Mapper=require("../mapper"),AddPanelView=require("./addpanel/master"),SearchManager=require("../../searchmanager"),SavedSearchManager=require("../../savedsearchmanager"),console=require("util/console"),TimeRangePickerView=require("views/shared/timerangepicker/dialog/Master"),TimeRangeModel=require("models/shared/TimeRange"),TimeRangeDelegate=require("views/shared/delegates/ModalTimerangePicker"),controller=require("../controller"),route=require("uri/route"),FlashMessages=require("views/shared/FlashMessages"),NewPanelModel=BaseModel.extend({defaults:{elementCreateType:"inline","dispatch.earliest_time":"0","dispatch.latest_time":""},validation:{search:{fn:"validateSearchQuery"}},validateSearchQuery:function(value,attr,computedState){return"inline"!==computedState["elementCreateType"]||value?void 0:"Search string is required."},sync:function(method,model,options){console.log("NewPanelModel.sync(%o, %o, %o)",method,model,options);if("create"!==method)throw new Error("Unsupported sync method: "+method);if(!model.isValid())return!1;var elementId,dfd=$.Deferred(),searchType=this.get("elementCreateType"),i=1;do elementId="element"+i++;while(mvc.Components.has(elementId));var vizType="saved"===searchType?this.get("savedSearchVisualization")||"visualizations:charting":"visualizations:charting",mapper=Mapper.get(vizType);Dashboard.getStateModel().view.addElement(elementId,{type:mapper.tagName,title:this.get("title"),search:{type:searchType,search:this.get("search"),earliest_time:this.get("dispatch.earliest_time"),latest_time:this.get("dispatch.latest_time"),name:this.get("savedSearchName")}}).done(_.bind(function(){var newItemElement=mvc.Components.get("dashboard").createNewElement({title:this.get("title"),id:elementId}),newSearchId=_.uniqueId("new-search");switch(searchType){case"inline":new SearchManager({id:newSearchId,search:this.get("search"),earliest_time:this.get("dispatch.earliest_time")||"0",latest_time:this.get("dispatch.latest_time")||"",app:utils.getCurrentApp(),auto_cancel:90,status_buckets:0,preview:!0,timeFormat:"%s.%Q",wait:0,runOnSubmit:!0},{tokens:!0});break;case"saved":new SavedSearchManager({id:newSearchId,searchname:this.get("savedSearchName"),app:utils.getCurrentApp(),auto_cancel:90,status_buckets:0,preview:!0,timeFormat:"%s.%Q",wait:0})}var ElementType=DashboardElement.extend({initialVisualization:vizType}),component=new ElementType({id:elementId,managerid:newSearchId,el:newItemElement},{tokens:!0});component.render();dfd.resolve()},this));return dfd.promise()}}),PanelTimeRangeModel=TimeRangeModel.extend({validation:_.extend({earliest_token:function(value,attr,computedState){return"tokens"!==computedState.useTimeFrom||value?void 0:"No value specified for earliest token."},latest_token:function(value,attr,computedState){return"tokens"!==computedState.useTimeFrom||value?void 0:"No value specified for latest token."}})});return Modal.extend({moduleId:module.id,className:"modal add-panel",initialize:function(){Modal.prototype.initialize.apply(this,arguments);this.model=this.model||{};this.model.report=new NewPanelModel;this.model.timeRange=new PanelTimeRangeModel({earliest:"0",latest:""});var appModel=Dashboard.model.app,userModel=Dashboard.model.user,appLocalModel=Dashboard.model.appLocal,timesCollection=Dashboard.collection.times;this.children.addPanel=new AddPanelView({model:{report:this.model.report,timeRange:this.model.timeRange,state:controller.getStateModel()},collection:{times:timesCollection},controller:this.options.controller});this.children.timeRangePickerView=new TimeRangePickerView({model:{timeRange:this.model.timeRange,user:userModel,appLocal:appLocalModel,application:appModel},collection:timesCollection,appendSelectDropdownsTo:".modal:visible"});this.children.flashMessages=new FlashMessages({model:this.model});this.model.timeRange.on("applied",function(){this.timeRangeDelegate.closeTimeRangePicker()},this);this.listenTo(this.model.report,"change:elementCreateType",this.handleSubmitButtonState,this)},events:{"click a.modal-btn-primary":function(e){if("pivot"!==this.model.report.get("elementCreateType")){e.preventDefault();Dashboard.getStateModel().set("edit",!1);var modal=this,useTimeFrom=this.model.timeRange.get("useTimeFrom"),timeTokenPrefix="global"==useTimeFrom?"":useTimeFrom+".",errors=this.model.report.validate();if("tokens"===useTimeFrom){var timeRangeErrors=this.model.timeRange.validate();timeRangeErrors&&(errors=errors?_.extend(errors,timeRangeErrors):timeRangeErrors)}if(errors){this.children.flashMessages.flashMsgCollection.reset();_.each(errors,function(val){this.children.flashMessages.flashMsgCollection.add({key:"addpanel-"+val,type:"error",html:_.escape(_(val).t())})},this)}else{"tokens"===useTimeFrom?this.model.report.set({"dispatch.earliest_time":"$"+this.model.timeRange.get("earliest_token")+"$","dispatch.latest_time":"$"+this.model.timeRange.get("latest_token")+"$",useTimeFrom:"tokens"},{tokens:!0}):"search"!==useTimeFrom&&this.model.report.set({"dispatch.earliest_time":"$"+timeTokenPrefix+"earliest$","dispatch.latest_time":"$"+timeTokenPrefix+"latest$"},{tokens:!0});var dfd=this.model.report.save();dfd?dfd.done(function(){setTimeout(function(){Dashboard.getStateModel().set("edit",!0)},250);modal.hide()}):Dashboard.getStateModel().set("edit",!0)}}},hide:function(e){e.target===this.el&&this.remove()}},handleSubmitButtonState:function(){if("pivot"===this.model.report.get("elementCreateType")){var pageInfo=utils.getPageInfo();this.$(Modal.FOOTER_SELECTOR).find(".btn-primary").replaceWith('<a href="'+route.pivot(pageInfo.root,pageInfo.locale,pageInfo.app)+'" class="btn btn-primary modal-btn-primary">'+_("Go to Pivot").t()+"</a>")}else this.$(Modal.FOOTER_SELECTOR).find(".btn-primary").replaceWith('<a href="#" class="btn btn-primary modal-btn-primary">'+_("Add Panel").t()+"</a>")},setLabel:function(){var timeLabel=this.model.timeRange.generateLabel(this.collection);this.$el.find("span.time-label").text(timeLabel)},render:function(){this.$el.html(Modal.TEMPLATE);this.$(Modal.HEADER_TITLE_SELECTOR).html(_("Add Panel").t());this.$(Modal.BODY_SELECTOR).remove();this.$(Modal.FOOTER_SELECTOR).before('<div class="vis-area"><div class="slide-area"><div class="content-wrapper add-panel-wrapper"><div class="'+Modal.BODY_CLASS+'" ></div></div><div class="timerange-picker-wrapper"></div></div></div>');
this.$(Modal.BODY_SELECTOR).prepend(this.children.flashMessages.render().el);this.$(Modal.BODY_SELECTOR).append(Modal.FORM_HORIZONTAL_JUSTIFIED);this.$visArea=this.$(".vis-area").eq(0);this.$slideArea=this.$(".slide-area").eq(0);this.$addpanelContent=this.$(".add-panel-wrapper").eq(0);this.$timeRangePickerWrapper=this.$(".timerange-picker-wrapper").eq(0);this.$(Modal.BODY_FORM_SELECTOR).append(this.children.addPanel.render().el);this.$timeRangePickerWrapper.append(this.children.timeRangePickerView.render().el);this.$modalParent=this.$el;this.timeRangeDelegate=new TimeRangeDelegate({el:this.el,$visArea:this.$visArea,$slideArea:this.$slideArea,$contentWrapper:this.$addpanelContent,$timeRangePickerWrapper:this.$timeRangePickerWrapper,$modalParent:this.$modalParent,$timeRangePicker:this.children.timeRangePickerView.$el,activateSelector:"a.timerange-control",backButtonSelector:"a.btn.back"});this.$(Modal.FOOTER_SELECTOR).append(Modal.BUTTON_CANCEL);this.$(Modal.FOOTER_SELECTOR).append('<a href="#" class="btn btn-primary modal-btn-primary">'+_("Add Panel").t()+"</a>");this.$(Modal.FOOTER_SELECTOR).append('<a href="#" class="btn back modal-btn-back pull-left">'+_("Back").t()+"</a>");this.$(".btn.back").hide();return this}})});define("views/shared/documentcontrols/dialogs/TitleDescriptionDialog",["underscore","backbone","module","views/shared/Modal","views/shared/controls/ControlGroup","views/shared/FlashMessages"],function(_,Backbone,module,Modal,ControlGroup,FlashMessage){return Modal.extend({moduleId:module.id,initialize:function(){Modal.prototype.initialize.apply(this,arguments);this.model={inmem:this.model.clone(),report:this.model};this.children.flashMessage=new FlashMessage({model:this.model.inmem});this.children.titleField=new ControlGroup({controlType:"Label",controlOptions:{modelAttribute:"name",model:this.model.inmem.entry},label:_("Title").t()});this.children.descriptionField=new ControlGroup({controlType:"Textarea",controlOptions:{modelAttribute:"description",model:this.model.inmem.entry.content,placeholder:_("optional").t()},label:_("Description").t()});this.on("hidden",function(){this.model.inmem.get("updated")>this.model.report.get("updated")&&this.model.report.entry.content.set("description",this.model.inmem.entry.content.get("description"))},this)},events:$.extend({},Modal.prototype.events,{"click .btn-primary":function(e){this.model.inmem.save({},{success:function(){this.hide()}.bind(this)});e.preventDefault()}}),render:function(){this.$el.html(Modal.TEMPLATE);this.$(Modal.HEADER_TITLE_SELECTOR).html(_("Edit Description").t());this.children.flashMessage.render().prependTo(this.$(Modal.BODY_SELECTOR));this.$(Modal.BODY_SELECTOR).append(Modal.FORM_HORIZONTAL);this.children.titleField.render().appendTo(this.$(Modal.BODY_FORM_SELECTOR));this.children.descriptionField.render().appendTo(this.$(Modal.BODY_FORM_SELECTOR));this.$(Modal.FOOTER_SELECTOR).append(Modal.BUTTON_CANCEL);this.$(Modal.FOOTER_SELECTOR).append(Modal.BUTTON_SAVE);return this}})});define("views/shared/documentcontrols/dialogs/DeleteDialog",["underscore","backbone","module","models/search/Report","views/shared/Modal","views/shared/FlashMessages","uri/route","splunk.util"],function(_,Backbone,module,ReportModel,Modal,FlashMessage,route,splunkUtil){return Modal.extend({moduleId:module.id,initialize:function(){Modal.prototype.initialize.apply(this,arguments);this.children.flashMessage=new FlashMessage({model:this.model.report})},events:$.extend({},Modal.prototype.events,{"click .btn-primary":function(e){var deleteDeferred=this.model.report.destroy({wait:!0});$.when(deleteDeferred).then(function(){this.hide();this.options.deleteRedirect&&(window.location=this.model.report.isAlert()?route.alerts(this.model.application.get("root"),this.model.application.get("locale"),this.model.application.get("app")):route.reports(this.model.application.get("root"),this.model.application.get("locale"),this.model.application.get("app")))}.bind(this));e.preventDefault()}}),render:function(){this.$el.html(Modal.TEMPLATE);this.children.flashMessage.render().prependTo(this.$(Modal.BODY_SELECTOR));this.$(Modal.HEADER_TITLE_SELECTOR).html(this.model.report.isAlert()?_("Delete Alert").t():_("Delete Report").t());this.$(Modal.BODY_SELECTOR).append("<span>"+splunkUtil.sprintf(_("Are you sure you want to delete %s?").t(),"<em>"+_.escape(this.model.report.entry.get("name"))+"</em>")+"</span>");this.$(Modal.FOOTER_SELECTOR).append(Modal.BUTTON_CANCEL);this.$(Modal.FOOTER_SELECTOR).append(this.compiledTemplate({_:_}));return this},template:'            <a href="#" class="btn btn-primary"><%- _("Delete").t() %></a>        '})});define("views/dashboards/table/controls/ConvertSuccess",["jquery","underscore","module","views/shared/Modal","uri/route","views/shared/documentcontrols/dialogs/permissions_dialog/Master"],function($,_,module,Modal,route,PermissionsDialog){return Modal.extend({moduleId:module.id,options:{refreshOnDismiss:!1},initialize:function(){Modal.prototype.initialize.apply(this,arguments);this.options.refreshOnDismiss&&this.on("hide hidden",function(){window.location.reload()})},events:$.extend({},Modal.prototype.events,{"click .edit-perms":function(e){e.preventDefault();var that=this,model=that.model,roles=that.collection.roles;_.defer(function(){var permissionsDialog=new PermissionsDialog({model:{document:model.dashboard,nameModel:model.dashboard.entry.content,user:model.user},collection:roles,nameLabel:"Dashboard",nameKey:"label",onHiddenRemove:!0});that.options.refreshOnDismiss&&permissionsDialog.on("hide hidden",function(){window.location.reload()});$("body").append(permissionsDialog.render().el);permissionsDialog.show()});that.options.refreshOnDismiss&&that.off("hide hidden");that.hide();that.remove()}}),render:function(){this.$el.html(Modal.TEMPLATE);this.$(Modal.HEADER_TITLE_SELECTOR).html(_("Dashboard has been converted.").t());this.$(Modal.BODY_SELECTOR).append(Modal.FORM_HORIZONTAL);var app=this.model.dashboard.entry.acl.get("app"),name=this.model.dashboard.entry.get("name"),link=route.page(this.model.application.get("root"),this.model.application.get("locale"),app,name),newDashboardLink=route.page(this.model.application.get("root"),this.model.application.get("locale"),this.model.application.get("app"),this.model.dashboard.entry.get("name")),editLink="/manager/"+app+"/data/ui/views/"+name+"?action=edit&ns="+app+"&redirect_override="+encodeURIComponent(newDashboardLink);this.$(Modal.BODY_FORM_SELECTOR).append(_.template(this.messageTemplate,{dashboardLink:link,_:_}));this.$(Modal.FOOTER_SELECTOR).append(_.template(this.buttonTemplate,{dashboardLink:link,editLink:editLink,_:_}));this.$(Modal.FOOTER_SELECTOR).append("");return this},buttonTemplate:'<a href="<%= editLink %>" class="btn edit-panels"><%- _("Edit HTML").t() %></a><a href="<%= dashboardLink %>" class="btn btn-primary modal-btn-primary"><%- _("View").t() %></a>',messageTemplate:'<p><%- _("You may now view your dashboard, change additional settings, or edit the HTML.").t() %></p><p><%- _("Additional Settings").t() %>:<ul><li><a href="#" class="edit-perms"><%- _("Permissions").t() %></a></li></ul></p>'})});define("views/shared/delegates/PairedTextControls",["jquery","underscore","backbone","views/shared/controls/TextControl","views/shared/delegates/Base"],function($,_,Backbone,TextControl,DelegateBase){return DelegateBase.extend({transformFunction:void 0,initialize:function(options){options=options||{};this.sourceDelegate=options.sourceDelegate;this.destDelegate=options.destDelegate;this.transformFunction=options.transformFunction;if(!(this.sourceDelegate instanceof TextControl&&this.destDelegate instanceof TextControl))throw new Error("SourceDelegate and destDelegate must be TextControls");this.enablePairing()},enablePairing:function(){this.sourceDelegate.on("keyup",this.sourceChangeHandler,this);this.destDelegate.on("keyup",this.destChangeHandler,this)},disablePairing:function(){this.sourceDelegate.off("keyup",this.sourceChangeHandler,this)},sourceChangeHandler:function(e,value){var destValue=value;this.transformFunction&&(destValue=this.transformFunction(value));this.destDelegate.setValue(destValue)},destChangeHandler:function(e){if(9!=e.keyCode&&16!=e.keyCode){this.disablePairing();this.destDelegate.off("keyup",this.destChangeHandler)}}})});define("views/dashboards/table/controls/ConvertDashboard",["underscore","jquery","module","views/shared/Modal","views/shared/controls/ControlGroup","models/Base","models/search/Dashboard","views/shared/FlashMessages","views/dashboards/table/controls/ConvertSuccess","views/shared/delegates/PairedTextControls","views/shared/controls/TextControl","util/splunkd_utils","uri/route","util/xml"],function(_,$,module,Modal,ControlGroup,BaseModel,DashboardModel,FlashMessagesView,ConvertSuccessView,PairedTextControls,TextControl,splunkDUtils,route){var ConvertMode={NEW:0,REPLACE:1};return Modal.extend({moduleId:module.id,initialize:function(){var that=this;Modal.prototype.initialize.apply(this,arguments);this.model.perms=new BaseModel({perms:"private"});this.model.convertMode=new BaseModel({mode:ConvertMode.NEW});this.children.flashMessages=new FlashMessagesView({model:{dashboard:this.model.dashboard,dashboardMeta:this.model.dashboard.meta}});this.model.dashboard.meta.set({label:this.model.dashboard.meta.get("label")+_(" HTML").t()});this.children.titleTextControl=new TextControl({modelAttribute:"label",model:this.model.dashboard.meta,placeholder:_("optional").t(),save:!1});this.children.filenameTextControl=new TextControl({modelAttribute:"name",model:this.model.dashboard.entry.content,save:!1});this.children.filenameTextControl.setValue(splunkDUtils.nameFromString(this.model.dashboard.meta.get("label")));this.pairedTextControls=new PairedTextControls({sourceDelegate:this.children.titleTextControl,destDelegate:this.children.filenameTextControl,transformFunction:splunkDUtils.nameFromString});this.children.mode=new ControlGroup({controlType:"SyntheticRadio",controlClass:"controls-halfblock",controlOptions:{className:"btn-group btn-group-2",modelAttribute:"mode",model:this.model.convertMode,items:[{label:_("Create New").t(),value:ConvertMode.NEW},{label:_("Replace Current").t(),value:ConvertMode.REPLACE}],save:!1},label:_("Dashboard").t(),help:_("Recommended").t()});this.children.title=new ControlGroup({controls:this.children.titleTextControl,label:_("Title").t()});this.children.filename=new ControlGroup({controls:this.children.filenameTextControl,label:_("ID").t(),help:_("Can only contain letters, numbers and underscores.").t(),tooltip:_("The ID is used as the filename on disk. Cannot be changed later.").t()});this.children.description=new ControlGroup({controlType:"Textarea",controlOptions:{modelAttribute:"description",model:this.model.dashboard.meta,placeholder:_("optional").t(),save:!1},label:_("Description").t()});this.children.permissions=new ControlGroup({controlType:"SyntheticRadio",controlClass:"controls-halfblock",controlOptions:{className:"btn-group btn-group-2",modelAttribute:"perms",model:this.model.perms,items:[{label:_("Private").t(),value:"private"},{label:_("Shared").t(),value:"shared"}],save:!1},label:_("Permissions").t()});this.model.convertMode.on("change:mode",function(){that.children.flashMessages.flashMsgCollection.reset();if(that.model.convertMode.get("mode")===ConvertMode.NEW){that.children.title.show();that.children.filename.show();that.children.description.show();that.children.permissions.show()}else{that.children.flashMessages.flashMsgCollection.add({type:"warning",html:_("This change cannot be undone.").t()});that.children.title.hide();that.children.filename.hide();that.children.description.hide();that.children.permissions.hide()}})},events:$.extend({},Modal.prototype.events,{"click a.modal-btn-primary":function(e){e.preventDefault();this.submit()}}),submit:function(){var that=this,dashboard=that.model.dashboard,currentDashboard=that.model.currentDashboard,app=that.model.application,user=that.model.user,sourceLink=route.page(app.get("root"),app.get("locale"),currentDashboard.entry.acl.get("app"),currentDashboard.entry.get("name"))+"/converttohtml",updateCollection=that.collection&&that.collection.dashboards;if(this.model.convertMode.get("mode")===ConvertMode.NEW){dashboard.meta.validate();if(dashboard.meta.isValid()){var meta=dashboard.meta.toJSON();dashboard.entry.content.set("eai:data",currentDashboard.entry.content.get("eai:data"));dashboard.entry.content.set("eai:type","views");dashboard.meta.set(meta);dashboard.meta.apply();$.post(sourceLink,{xmlString:dashboard.entry.content.get("eai:data"),newViewID:dashboard.entry.content.get("name")}).done(function(htmlSource){dashboard.entry.content.set("eai:type","html");dashboard.entry.content.set("eai:data",htmlSource);dashboard.save({},{data:app.getPermissions(that.model.perms.get("perms"))}).done(function(){updateCollection&&that.collection.dashboards.add(that.model.dashboard);_.defer(function(){var successDialog=new ConvertSuccessView({model:{dashboard:dashboard,application:app,user:user},collection:that.collection});successDialog.render().show()});that.hide();that.remove()})})}}else $.post(sourceLink,{xmlString:currentDashboard.entry.content.get("eai:data")}).done(function(htmlSource){currentDashboard.entry.content.set("eai:type","html");currentDashboard.entry.content.set("eai:data",htmlSource);currentDashboard.save().done(function(){updateCollection&&currentDashboard.trigger("updateCollection");_.defer(function(){var successDialog=new ConvertSuccessView({model:{dashboard:currentDashboard,application:app},collection:that.collection,refreshOnDismiss:!updateCollection});successDialog.render().show()});that.hide();that.remove()})})},render:function(){var helpLink=route.docHelp(this.model.application.get("root"),this.model.application.get("locale"),"learnmore.html.dashboard");this.$el.html(Modal.TEMPLATE);this.$(Modal.HEADER_TITLE_SELECTOR).html(_("Convert Dashboard to HTML").t());this.$(Modal.BODY_SELECTOR).prepend(this.children.flashMessages.render().el);this.$(Modal.BODY_SELECTOR).append("<p>"+_("HTML dashboards cannot be edited using Splunk's visual editors.").t()+"<br />"+_("Integrated PDF generation is not available for HTML dashboards.").t()+"<br /><a href="+helpLink+">"+_("Learn More").t()+' <i class="icon-external"></i></a></p>');this.$(Modal.BODY_SELECTOR).append(Modal.FORM_HORIZONTAL);this.$(Modal.BODY_FORM_SELECTOR).append(this.children.mode.render().el);this.$(Modal.BODY_FORM_SELECTOR).append(this.children.title.render().el);this.$(Modal.BODY_FORM_SELECTOR).append(this.children.filename.render().el);this.$(Modal.BODY_FORM_SELECTOR).append(this.children.description.render().el);this.$(Modal.BODY_FORM_SELECTOR).append(this.children.permissions.render().el);this.$(Modal.FOOTER_SELECTOR).append(Modal.BUTTON_CANCEL);this.$(Modal.FOOTER_SELECTOR).append('<a href="#" class="btn btn-primary modal-btn-primary">'+_("Convert Dashboard").t()+"</a>");return this}})});define("models/services/ScheduledView",["jquery","underscore","backbone","models/SplunkDBase","models/Base","splunk.util","backbone_validation"],function($,_,Backbone,SplunkDBase,BaseModel,splunkUtil,Val){var ScheduledView=SplunkDBase.extend({defaults:{is_scheduled:!1,"action.email.subject.view":"Splunk Dashboard: '$name$'","action.email.message.view":"A PDF was generated for $name$","action.email.useNSSubject":"1","action.email.papersize":"letter","action.email.paperorientation":"portrait","action.email.priority":"3",cron_schedule:"0 6 * * 1"},initialize:function(){SplunkDBase.prototype.initialize.apply(this,arguments)},url:function(){return"scheduled/views/"+this.viewName},findByName:function(viewName,app,owner){this.viewName=viewName;this.id="scheduled/views/"+viewName;var dfd=this.fetch({data:{app:app,owner:owner}});dfd.done(_.bind(this.applyDefaultsIfNotScheduled,this));return dfd},applyDefaultsIfNotScheduled:function(){this.entry.content.get("is_scheduled")||this.entry.content.set(this.defaults)}});ScheduledView.Entry=ScheduledView.Entry.extend({});ScheduledView.Entry.Content=ScheduledView.Entry.Content.extend({validation:{"action.email.to":{fn:"validateEmailList"},"action.email.subject.view":{fn:"validateNSSubject"},"action.email.subject":{fn:"validateSubject"}},validateSubject:function(value,attr,computedState){return!splunkUtil.normalizeBoolean(computedState["is_scheduled"])||splunkUtil.normalizeBoolean(computedState["action.email.useNSSubject"])||!_.isUndefined(value)&&0!==$.trim(value).length?void 0:_("Subject is empty").t()},validateNSSubject:function(value,attr,computedState){return splunkUtil.normalizeBoolean(computedState["is_scheduled"])&&splunkUtil.normalizeBoolean(computedState["action.email.useNSSubject"])&&(_.isUndefined(value)||0===$.trim(value).length)?_("Subject is empty").t():void 0},validateEmailList:function(value,attr,model){if(model.is_scheduled){if(!value)return _("Email Address list is empty").t();if(_(value.split(/\s*,\s*/)).any(function(v){return!Val.patterns.email.test(v)}))return _("Email Address list is invalid").t()}}});return ScheduledView});define("views/dashboards/table/controls/SchedulePDF",["module","jquery","underscore","backbone","util/console","util/pdf_utils","models/services/ScheduledView","models/shared/Cron","views/Base","views/shared/Modal","views/shared/controls/ControlGroup","views/shared/EmailOptions","views/shared/ScheduleSentence","views/shared/FlashMessages","uri/route"],function(module,$,_,Backbone,console,pdfUtils,ScheduledViewModel,Cron,BaseView,Modal,ControlGroup,EmailOptions,ScheduleSentence,FlashMessagesView,route){var ControlWrapper=BaseView.extend({render:function(){this.el.innerHTML||this.$el.html(_.template(this.template,{label:this.options.label||"",controlClass:this.options.controlClass||"",body:_.template(this.options.body||"")(this.model?this.model.toJSON?this.model.toJSON():this.model:{})}));var target=this.$(".controls");_.each(this.options.children,function(child){child.render().appendTo(target)});return this},template:'<label class="control-label"><%- label %></label><div class="controls <%- controlClass %>"><%= body %></div>'});return Modal.extend({moduleId:module.id,className:"modal schedule-pdf modal-wide",initialize:function(){Modal.prototype.initialize.apply(this,arguments);this.model.inmem=new ScheduledViewModel.Entry.Content(this.model.scheduledView.entry.content.toJSON());this.model.inmem.get("action.email.papersize")||pdfUtils.getEmailAlertSettings().done(_.bind(function(emailSettings){this.model.inmem.get("action.email.papersize")||this.model.inmem.set("action.email.papersize",emailSettings.entry.content.get("reportPaperSize"))},this));this.model.inmem.get("action.email.paperorientation")||pdfUtils.getEmailAlertSettings().done(_.bind(function(emailSettings){this.model.inmem.get("action.email.paperorientation")||this.model.inmem.set("action.email.paperorientation",emailSettings.entry.content.get("reportPaperOrientation"))},this));var cronModel=this.model.cron=Cron.createFromCronString(this.model.inmem.get("cron_schedule")||"0 6 * * 1");this.listenTo(cronModel,"change",function(){this.model.inmem.set("cron_schedule",cronModel.getCronString())},this);route.docHelp(this.model.application.get("root"),this.model.application.get("locale"),"learnmore.alert.email");this.children.flashMessages=new FlashMessagesView({model:{scheduledView:this.model.scheduledView,content:this.model.inmem}});this.children.name=new ControlGroup({controlType:"Label",controlOptions:{modelAttribute:"label",model:this.model.dashboard.entry.content},label:_("Dashboard").t()});this.children.schedule=new ControlGroup({controlType:"SyntheticCheckbox",controlOptions:{modelAttribute:"is_scheduled",model:this.model.inmem,save:!1},label:_("Schedule PDF").t()});this.children.scheduleSentence=new ScheduleSentence({model:{cron:this.model.cron,application:this.model.application},lineOneLabel:_("Schedule").t(),popdownOptions:{attachDialogTo:".modal:visible",scrollContainer:".modal:visible .modal-body:visible"}});this.children.emailOptions=new EmailOptions({model:{state:this.model.inmem,application:this.model.application},toLabel:_("Email To").t(),suffix:"view"});this.children.paperSize=new ControlGroup({className:"control-group",controlType:"SyntheticSelect",controlOptions:{modelAttribute:"action.email.papersize",model:this.model.inmem,items:[{label:_("A2").t(),value:"a2"},{label:_("A3").t(),value:"a3"},{label:_("A4").t(),value:"a4"},{label:_("A5").t(),value:"a5"},{label:_("Letter").t(),value:"letter"},{label:_("Legal").t(),value:"legal"}],save:!1,toggleClassName:"btn",popdownOptions:{attachDialogTo:".modal:visible",scrollContainer:".modal:visible .modal-body:visible"}},label:_("Paper Size").t()});this.children.paperLayout=new ControlGroup({controlType:"SyntheticRadio",controlOptions:{modelAttribute:"action.email.paperorientation",model:this.model.inmem,items:[{label:_("Portrait").t(),value:"portrait"},{label:_("Landscape").t(),value:"landscape"}],save:!1},label:_("Paper Layout").t()});this.children.previewLinks=new ControlWrapper({body:'<div class="preview-actions"><div class="test-email"><a href="#" class="action-send-test">'+_("Send Test Email").t()+'</a></div> <a href="#" class="action-preview">'+_("Preview PDF").t()+"</a></div>"});this.model.inmem.on("change:is_scheduled",this._toggle,this)},events:$.extend({},Modal.prototype.events,{"click .action-send-test":function(e){e.preventDefault();this.model.inmem.validate();if(this.model.inmem.isValid()){var $status=this.$(".test-email"),flashMessages=this.children.flashMessages.flashMsgCollection;$status.html(_("Sending...").t());pdfUtils.sendTestEmail(this.model.dashboard.entry.get("name"),this.model.dashboard.entry.acl.get("app"),this.model.inmem.get("action.email.to"),{paperSize:this.model.inmem.get("action.email.papersize"),paperOrientation:this.model.inmem.get("action.email.paperorientation")}).done(function(){$status.html('<i class="icon-check"></i> '+_("Email sent.").t())}).fail(function(error){$status.html('<span class="error"><i class="icon-warning-sign"></i> '+_("Failed!").t()+"</span>");error&&flashMessages.add({type:"warning",html:_("Sending the test email failed: ").t()+_.escape(error)})}).always(function(){setTimeout(function(){$status.html('<a href="#" class="action-send-test">'+_("Send Test Email").t()+"</a>")},5e3)})}},"click .action-preview":function(e){e.preventDefault();var orientationSuffix="",orientation=this.model.inmem.get("action.email.paperorientation"),pageSize=this.model.inmem.get("action.email.papersize")||"a2";"landscape"===orientation&&(orientationSuffix="-landscape");pdfUtils.getRenderURL(this.model.dashboard.entry.get("name"),this.model.dashboard.entry.acl.get("app"),{"paper-size":pageSize+orientationSuffix}).done(function(url){window.open(url)})},"click .modal-btn-primary":function(e){e.preventDefault();this.model.inmem.validate();if(this.model.inmem.isValid())if(0==this.model.inmem.get("is_scheduled")&&this.model.scheduledView.entry.content.get("is_scheduled")===!1)this.hide();else{this.model.scheduledView.entry.content.set(this.model.inmem.toJSON());var modal=this;this.model.scheduledView.save({},{success:function(){modal.hide()}})}}}),_toggle:function(){var action=this.model.inmem.get("is_scheduled")?"show":"hide";this.children.scheduleSentence.$el[action]();this.$emailOptions[action]();this.children.paperSize.$el[action]();this.children.paperLayout.$el[action]();this.children.previewLinks.$el[action]()},render:function(){this.$el.html(Modal.TEMPLATE);this.$(Modal.HEADER_TITLE_SELECTOR).html(_("Edit PDF Schedule").t());this.children.flashMessages.render().prependTo(this.$(Modal.BODY_SELECTOR));this.$(Modal.BODY_SELECTOR).append(Modal.FORM_HORIZONTAL_COMPLEX);this.children.name.render().appendTo(this.$(Modal.BODY_FORM_SELECTOR));this.children.schedule.render().appendTo(this.$(Modal.BODY_FORM_SELECTOR));this.children.scheduleSentence.render().appendTo(this.$(Modal.BODY_FORM_SELECTOR));this.$(Modal.BODY_FORM_SELECTOR).append('<fieldset class="email-options outline"></fieldset>');this.$emailOptions=this.$el.find(".email-options");this.children.emailOptions.render().appendTo(this.$emailOptions);this.children.paperSize.render().appendTo(this.$(Modal.BODY_FORM_SELECTOR));this.children.paperLayout.render().appendTo(this.$(Modal.BODY_FORM_SELECTOR));this.children.previewLinks.render().appendTo(this.$(Modal.BODY_FORM_SELECTOR));this.$(Modal.FOOTER_SELECTOR).append(Modal.BUTTON_CANCEL);this.$(Modal.FOOTER_SELECTOR).append(Modal.BUTTON_SAVE);this._toggle();return this}})});define("views/dashboards/table/controls/CloneSuccess",["underscore","module","views/shared/Modal","uri/route","views/shared/documentcontrols/dialogs/permissions_dialog/Master","views/dashboards/table/controls/SchedulePDF","models/services/ScheduledView"],function(_,module,Modal,route,PermissionsDialog,SchedulePDF,ScheduledViewModel){return Modal.extend({moduleId:module.id,events:$.extend({},Modal.prototype.events,{"click .edit-perms":function(e){e.preventDefault();var model=this.model,roles=this.collection.roles;_.defer(function(){var permissionsDialog=new PermissionsDialog({model:{document:model.dashboard,nameModel:model.dashboard.entry.content,user:model.user},collection:roles,nameLabel:"Dashboard",nameKey:"label",onHiddenRemove:!0});$("body").append(permissionsDialog.render().el);permissionsDialog.show()});this.hide();this.remove()},"click .schedule-pdf":function(e){e.preventDefault();var model=this.model,createDialog=function(){var schedulePDF=new SchedulePDF({model:{scheduledView:model.scheduledView,dashboard:model.dashboard,application:model.application,appLocal:model.appLocal},onHiddenRemove:!0});$("body").append(schedulePDF.render().el);schedulePDF.show()};if(this.model.scheduledView)_.defer(createDialog);else{var scheduledView=model.scheduledView=new ScheduledViewModel,dfd=scheduledView.findByName(this.model.dashboard.entry.get("name"),this.model.application.get("app"),this.model.application.get("owner"));dfd.done(createDialog)}this.hide();this.remove()}}),render:function(){this.$el.html(Modal.TEMPLATE);this.$(Modal.HEADER_TITLE_SELECTOR).html(_("Dashboard has been cloned.").t());this.$(Modal.BODY_SELECTOR).append(Modal.FORM_HORIZONTAL);var link=route.page(this.model.application.get("root"),this.model.application.get("locale"),this.model.dashboard.entry.acl.get("app"),this.model.dashboard.entry.get("name")),canChangePerms=this.model.dashboard.entry.acl.get("can_change_perms"),canSchedule=this.model.user.canScheduleSearch()&&!this.model.user.isFree()&&(this.model.dashboard.isSimpleXML()||this.model.dashboard.isAdvanced()&&"deprecated"===this.model.state.get("pdfgen_type"));this.$(Modal.BODY_FORM_SELECTOR).append(_.template(this.messageTemplate,{dashboardLink:link,canChangePerms:canChangePerms,canSchedule:canSchedule}));this.$(Modal.FOOTER_SELECTOR).append(_.template(this.buttonTemplate,{dashboardLink:link,_:_}));this.$(Modal.FOOTER_SELECTOR).append("");return this},buttonTemplate:'<a href="<%= dashboardLink %>/edit" class="btn edit-panels"><%- _("Edit Panels").t() %></a><a href="<%= dashboardLink %>" class="btn btn-primary modal-btn-primary"><%- _("View").t() %></a>',messageTemplate:'<p><%- _("You may now view your dashboard, change additional settings, or edit the panels.").t() %></p><p><% if(canChangePerms || canSchedule){ %><%- _("Additional Settings").t() %>:<ul><% if(canChangePerms) { %><li><a href="#" class="edit-perms"><%- _("Permissions").t() %><% } %></a></li><% if(canSchedule) { %><li><a href="#" class="schedule-pdf"><%- _("Schedule PDF Delivery").t() %><% } %></a></li></ul><% } %></p>'})});define("views/dashboards/table/controls/CloneDashboard",["underscore","module","views/shared/Modal","views/shared/controls/ControlGroup","models/Base","models/search/Dashboard","views/shared/FlashMessages","util/splunkd_utils","views/dashboards/table/controls/CloneSuccess","views/shared/delegates/PairedTextControls","views/shared/controls/TextControl"],function(_,module,Modal,ControlGroup,BaseModel,DashboardModel,FlashMessagesView,splunkDUtils,CloneSuccessView,PairedTextControls,TextControl){return Modal.extend({moduleId:module.id,initialize:function(){Modal.prototype.initialize.apply(this,arguments);this.model.perms=new BaseModel({clonePermissions:!1});this.children.flashMessages=new FlashMessagesView({model:{dashboard:this.model.dashboard,dashboardMeta:this.model.dashboard.meta}});this.model.dashboard.meta.set({label:this.model.dashboard.meta.get("label")+_(" Clone").t()});this.children.titleTextControl=new TextControl({modelAttribute:"label",model:this.model.dashboard.meta,placeholder:_("optional").t(),save:!1});this.children.filenameTextControl=new TextControl({modelAttribute:"name",model:this.model.dashboard.entry.content,save:!1});this.children.filenameTextControl.setValue(splunkDUtils.nameFromString(this.model.dashboard.meta.get("label")));this.pairedTextControls=new PairedTextControls({sourceDelegate:this.children.titleTextControl,destDelegate:this.children.filenameTextControl,transformFunction:splunkDUtils.nameFromString});this.children.title=new ControlGroup({controls:this.children.titleTextControl,label:_("Title").t()});this.children.filename=new ControlGroup({controls:this.children.filenameTextControl,label:_("ID").t(),help:_("Can only contain letters, numbers and underscores.").t(),tooltip:_("The ID is used as the filename on disk. Cannot be changed later.").t()});this.children.description=new ControlGroup({controlType:"Textarea",controlOptions:{modelAttribute:"description",model:this.model.dashboard.meta,placeholder:_("optional").t(),save:!1},label:_("New Description").t()});this.children.permissions=new ControlGroup({controlType:"SyntheticRadio",controlClass:"controls-halfblock",controlOptions:{className:"btn-group btn-group-2",modelAttribute:"clonePermissions",model:this.model.perms,items:[{label:_("Private").t(),value:!1},{label:_("Clone").t(),value:!0}],save:!1},label:_("Permissions").t()})},events:$.extend({},Modal.prototype.events,{"click a.modal-btn-primary":function(e){e.preventDefault();this.submit()}}),createSuccess:function(){this.collection&&this.collection.dashboards&&this.collection.dashboards.add(this.model.dashboard);_.defer(function(){var successDialog=new CloneSuccessView({model:{dashboard:this.model.dashboard,application:this.model.application,scheduledView:this.model.scheduledView,appLocal:this.model.appLocal,state:this.model.state,user:this.model.user},collection:this.collection});successDialog.render().show()}.bind(this));this.hide();this.remove()},submit:function(){var dashboard=this.model.dashboard;dashboard.meta.validate();if(dashboard.meta.isValid()){"views"===dashboard.entry.content.get("eai:type")&&dashboard.meta.apply();var clonePermissions=this.model.perms.get("clonePermissions"),data={app:this.model.application.get("app")};data.owner=clonePermissions&&this.model.acl.get("sharing")!==splunkDUtils.USER?splunkDUtils.NOBODY:this.model.application.get("owner");dashboard.save({},{data:data,success:function(){if(clonePermissions){var data=this.model.acl.toDataPayload();data.owner=this.model.application.get("owner");dashboard.acl.save({},{data:data,success:function(){this.createSuccess()}.bind(this)})}else this.createSuccess()}.bind(this)})}},render:function(){this.$el.html(Modal.TEMPLATE);this.$(Modal.HEADER_TITLE_SELECTOR).html(_("Clone").t());this.$(Modal.BODY_SELECTOR).prepend(this.children.flashMessages.render().el);this.$(Modal.BODY_SELECTOR).append(Modal.FORM_HORIZONTAL);this.$(Modal.BODY_FORM_SELECTOR).append(this.children.title.render().el);this.$(Modal.BODY_FORM_SELECTOR).append(this.children.filename.render().el);this.$(Modal.BODY_FORM_SELECTOR).append(this.children.description.render().el);var sharing=this.model.acl.get("sharing");(sharing===splunkDUtils.APP&&this.model.dashboard.entry.acl.get("can_share_app")||sharing===splunkDUtils.GLOBAL&&this.model.dashboard.entry.acl.get("can_share_global"))&&this.$(Modal.BODY_FORM_SELECTOR).append(this.children.permissions.render().el);
this.$(Modal.FOOTER_SELECTOR).append(Modal.BUTTON_CANCEL);this.$(Modal.FOOTER_SELECTOR).append('<a href="#" class="btn btn-primary modal-btn-primary">'+_("Clone Dashboard").t()+"</a>");return this}})});define("splunkjs/mvc/simplexml/dialog/dashboardtitle",["underscore","backbone","module","views/shared/Modal","views/shared/controls/ControlGroup","views/shared/FlashMessages"],function(_,Backbone,module,Modal,ControlGroup,FlashMessage){return Modal.extend({moduleId:module.id,initialize:function(){Modal.prototype.initialize.apply(this,arguments);this.workingModel=this.model.clone();this.children.flashMessage=new FlashMessage({model:this.model});this.children.titleField=new ControlGroup({controlType:"Text",controlOptions:{modelAttribute:"label",model:this.workingModel,placeholder:_("optional").t()},label:_("Title").t()});this.children.descriptionField=new ControlGroup({controlType:"Textarea",controlOptions:{modelAttribute:"description",model:this.workingModel,placeholder:_("optional").t()},label:_("Description").t()})},events:$.extend({},Modal.prototype.events,{"click .btn-primary":function(e){this.model.set("label",this.workingModel.get("label"));this.model.set("description",this.workingModel.get("description"));this.hide();e.preventDefault()}}),render:function(){this.$el.html(Modal.TEMPLATE);this.$(Modal.HEADER_TITLE_SELECTOR).html(_("Edit Title or Description").t());this.$(Modal.BODY_SELECTOR).prepend(this.children.flashMessage.render().el);this.$(Modal.BODY_SELECTOR).append(Modal.FORM_HORIZONTAL);this.$(Modal.BODY_FORM_SELECTOR).append(this.children.titleField.render().el);this.$(Modal.BODY_FORM_SELECTOR).append(this.children.descriptionField.render().el);this.$(Modal.FOOTER_SELECTOR).append(Modal.BUTTON_CANCEL);this.$(Modal.FOOTER_SELECTOR).append(Modal.BUTTON_SAVE);return this}})});define("splunkjs/mvc/simplexml/editdashboard/editmenu",["module","jquery","underscore","../dashboardurl","views/shared/PopTart","views/shared/documentcontrols/dialogs/TitleDescriptionDialog","views/shared/documentcontrols/dialogs/permissions_dialog/Master","views/shared/documentcontrols/dialogs/DeleteDialog","uri/route","bootstrap.modal","models/search/Dashboard","views/dashboards/table/controls/ConvertDashboard","views/dashboards/table/controls/CloneDashboard","views/dashboards/table/controls/SchedulePDF","views/shared/dialogs/TextDialog","splunk.util","../dialog/dashboardtitle","models/services/ScheduledView","../../utils","models/ACLReadOnly"],function(module,$,_,classicUrlModel,PopTartView,TitleDescriptionDialog,PermissionsDialog,DeleteDialog,route,undefined,DashboardModel,ConvertDialog,CloneDialog,SchedulePDFDialog,TextDialog,splunkUtils,TitleDialog,ScheduledViewModel,utils,ACLReadOnlyModel){return PopTartView.extend({moduleId:module.id,className:"dropdown-menu",initialize:function(){PopTartView.prototype.initialize.apply(this,arguments);var defaults={button:!0,showOpenActions:!0,deleteRedirect:!1};_.defaults(this.options,defaults)},events:{"click a.edit-panels":function(e){e.preventDefault();this.hide();this.remove();this.model.state.set("edit",!0)},"click a.schedule-pdf":function(e){e.preventDefault();if(!$(e.currentTarget).is(".disabled")){this.hide();this.remove();var dialog=new SchedulePDFDialog({model:{scheduledView:this.model.scheduledView,dashboard:this.model.dashboard,application:this.model.application,appLocal:this.model.state.appLocal},onHiddenRemove:!0});dialog.render().appendTo($("body"));dialog.show()}},"click a.delete":function(e){e.preventDefault();this.hide();this.remove();var dialog=new TextDialog({id:"modal-delete-dashboard"});dialog.dialogShown=function(){this.trigger("show");_.debounce(function(){this.$(".btn-primary:first").focus()}.bind(this),0)()};dialog.settings.set("primaryButtonLabel",_("Delete").t());dialog.settings.set("cancelButtonLabel",_("Cancel").t());dialog.settings.set("titleLabel",_("Delete").t());dialog.setText(splunkUtils.sprintf(_("Are you sure you want to delete %s?").t(),"<em>"+_.escape(""!==this.model.state.get("label")?this.model.state.get("label"):this.model.dashboard.entry.get("name"))+"</em>"));dialog.render().appendTo(document.body);dialog.once("click:primaryButton",function(){this.model.dashboard.destroy().done(function(){var cur=utils.getPageInfo();utils.redirect(route.page(cur.root,cur.locale,cur.app,"dashboards"))})},this);dialog.on("hidden",function(){dialog.remove()},this);dialog.show()},"click a.edit-title-desc":function(e){e.preventDefault();this.hide();this.remove();this.children.titleDialog=new TitleDialog({model:this.model.state,onHiddenRemove:!0});$("body").append(this.children.titleDialog.render().el);this.children.titleDialog.show()},"click a.edit-perms":function(e){e.preventDefault();this.hide();this.remove();this.children.permissionsDialog=new PermissionsDialog({model:{document:this.model.dashboard,nameModel:this.model.dashboard.entry.content,user:this.model.state.user},collection:this.collection,nameLabel:"Dashboard",nameKey:"label",onHiddenRemove:!0});$("body").append(this.children.permissionsDialog.render().el);this.children.permissionsDialog.show()},"click a.convert-to-html":function(e){e.preventDefault();this.hide();this.remove();var dashboard=new DashboardModel;dashboard.meta.set(this.model.dashboard.meta.toJSON());var convertDialog=this.children.convertDialog=new ConvertDialog({model:{dashboard:dashboard,currentDashboard:this.model.dashboard,application:this.model.application,user:this.model.state.user},collection:{roles:this.collection},onHiddenRemove:!0});$("body").append(convertDialog.render().el);convertDialog.show()},"click a.clone":function(e){e.preventDefault();this.hide();this.remove();var clone=new DashboardModel;clone.fetch({success:function(){"html"===this.model.dashboard.entry.content.get("eai:type")?clone.setHTML(this.model.dashboard.entry.content.get("eai:data")):clone.setXML(this.model.dashboard.entry.content.get("eai:data"));clone.meta.set(this.model.dashboard.meta.toJSON());var cloneDialog=this.children.cloneDialog=new CloneDialog({model:{dashboard:clone,acl:new ACLReadOnlyModel($.extend(!0,{},this.model.dashboard.entry.acl.toJSON())),application:this.model.application,appLocal:this.model.state.appLocal,state:this.model.state,user:this.model.state.user},collection:{roles:this.collection},onHiddenRemove:!0});$("body").append(cloneDialog.render().el);cloneDialog.show()}.bind(this)})}},render:function(){var app=this.model.application.toJSON(),renderModel={dashboard:this.model.dashboard.isDashboard(),editLinkViewMode:route.manager(app.root,app.locale,app.app,["data","ui","views",app.page],{data:{action:"edit",ns:app.app,redirect_override:route.page(app.root,app.locale,app.app,app.page)}}),editLinkEditMode:route.manager(app.root,app.locale,app.app,["data","ui","views",app.page],{data:{action:"edit",ns:app.app,redirect_override:route.page(app.root,app.locale,app.app,app.page)+"/edit"}}),dashboardType:this.model.dashboard.getViewType(),editable:this.model.state.get("editable"),canWrite:this.model.dashboard.entry.acl.canWrite(),canCangePerms:this.model.dashboard.entry.acl.get("can_change_perms"),canEditHtml:this.model.state.user.canEditViewHtml(),removable:this.model.dashboard.entry.acl.get("removable"),isXML:this.model.dashboard.isXML(),isForm:this.model.dashboard.isForm(),isSimpleXML:this.model.dashboard.isSimpleXML(),isHTML:this.model.dashboard.isHTML(),canSchedulePDF:this.model.state.user.canScheduleSearch()&&!this.model.state.user.isFree()&&(this.model.dashboard.isSimpleXML()||this.model.dashboard.isAdvanced()&&"deprecated"===this.model.state.get("pdfgen_type")),isPdfServiceAvailable:this.model.state.get("pdf_available"),showAddTRP:!this.model.state.get("default_timerange"),_:_},html=this.compiledTemplate(renderModel);this.$el.html(PopTartView.prototype.template_menu);this.$el.append(html);return this},template:'                <% if (canWrite && (editable || (!isHTML || canEditHtml) || (isSimpleXML && canEditHtml))) { %>                    <ul class="first-group">                        <% if(editable) { %>                        <li><a href="#" class="edit-panels"><%- _("Edit Panels").t() %></a></li>                        <% } %>                        <% if (!isHTML || canEditHtml) { %>                        <li><a href="<%- editLinkViewMode %>" class="edit-source"><%- _("Edit Source").t() %> <span class="dashboard-source-type"><%= dashboardType %></span></a></li>                        <% } %>                        <% if (isSimpleXML && canEditHtml) { %>                        <li><a href="#" class="convert-to-html"><%- _("Convert to HTML").t() %></a></li>                        <% } %>                    </ul>                    <% } %>                    <% if(canCangePerms || (canWrite && isXML) || canSchedulePDF) { %>                    <ul class="second-group">                        <% if(isXML && canWrite) { %>                        <li><a href="#" class="edit-title-desc"><%- _("Edit Title or Description").t() %></a></li>                        <% } %>                        <% if(canCangePerms) { %>                            <li><a href="#" class="edit-perms"><%- _("Edit Permissions").t() %></a></li>                        <% } %>                        <% if(canSchedulePDF) { %>                        <li>                        <% if(isForm) {%>                            <a class="schedule-pdf disabled" href="#" title="<%- _("You cannot schedule PDF delivery for a dashboard with form elements.").t() %>">                        <% } else { %>                            <a class="schedule-pdf" href="#">                        <% } %>                                <%- _("Schedule PDF Delivery").t() %>                            </a>                        </li>                        <% } %>                    </ul>                    <% } %>                    <% if ((!isHTML || canEditHtml) || (canWrite && removable)) { %>                    <ul class="third-group">                        <% if (!isHTML || canEditHtml) { %>                        <li><a href="#" class="clone"><%- _("Clone").t() %></a></li>                        <% } %>                        <% if(canWrite && removable) { %>                        <li><a href="#" class="delete"><%- _("Delete").t() %></a></li>                        <% } %>                    </ul>                <% } %>            '})});define("splunkjs/mvc/simplexml/editdashboard/moreinfomenu",["module","jquery","underscore","../dashboardurl","views/shared/PopTart","views/shared/documentcontrols/dialogs/TitleDescriptionDialog","views/shared/documentcontrols/dialogs/permissions_dialog/Master","views/shared/documentcontrols/dialogs/DeleteDialog","uri/route","bootstrap.modal","util/splunkd_utils","views/dashboards/table/controls/SchedulePDF","models/services/ScheduledView","models/shared/Cron"],function(module,$,_,classicUrlModel,PopTartView,TitleDescriptionDialog,PermissionsDialog,DeleteDialog,route,undefined,splunkDUtils,SchedulePDF,ScheduledViewModel,Cron){return PopTartView.extend({moduleId:module.id,className:"dropdown-menu more-info popdown-dialog",initialize:function(){PopTartView.prototype.initialize.apply(this,arguments);var defaults={button:!0,showOpenActions:!0,deleteRedirect:!1};_.defaults(this.options,defaults)},events:{"click .edit-schedule":function(e){e.preventDefault();this.hide();this.remove();this.children.schedulePDF=new SchedulePDF({model:{scheduledView:this.model.scheduledView,dashboard:this.model.dashboard,application:this.model.application,appLocal:this.model.state.appLocal},onHiddenRemove:!0});$("body").append(this.children.schedulePDF.render().el);this.children.schedulePDF.show()},"click a.edit-permissions":function(e){e.preventDefault();this.hide();this.remove();this.children.permissionsDialog=new PermissionsDialog({model:{document:this.model.dashboard,nameModel:this.model.dashboard.entry.content,user:this.model.state.user},collection:this.collection,nameLabel:"Dashboard",nameKey:"label",onHiddenRemove:!0});$("body").append(this.children.permissionsDialog.render().el);this.children.permissionsDialog.show()}},render:function(){var isScheduled=this.model.scheduledView.entry.content.get("is_scheduled"),schedule="-",recipients=[],sharing=this.model.dashboard.entry.acl.get("sharing"),owner=this.model.dashboard.entry.acl.get("owner"),permissionString=splunkDUtils.getPermissionLabel(sharing,owner),appString=this.model.dashboard.entry.acl.get("app");if(isScheduled){var expr=this.model.scheduledView.entry.content.get("cron_schedule"),cron=expr?Cron.createFromCronString(expr):null;if(cron)switch(cron.get("cronType")){case"hourly":schedule=_("Sent Hourly").t();break;case"daily":schedule=_("Sent Daily").t();break;case"weekly":schedule=_("Sent Weekly").t();break;case"monthly":schedule=_("Sent Monthly").t();break;case"custom":schedule=_("Sent on a custom schedule").t()}recipients=(this.model.scheduledView.entry.content.get("action.email.to")||"").split(/\s*,\s*/)}var renderModel={_:_,isScheduled:isScheduled,schedule:schedule,recipients:_(recipients).chain().filter(_.identity).map(function(recipient){return['<a href="mailto:',encodeURIComponent(recipient),'">',_.escape(recipient),"</a>"].join("")}).value(),shared:this.model.dashboard.entry.acl.get("perms"),owner:owner,permissionString:permissionString,canChangePerms:this.model.dashboard.entry.acl.get("can_change_perms"),canScheduleXML:this.model.dashboard.isSimpleXML()&&!this.model.dashboard.isForm()||this.model.dashboard.isAdvanced()&&"deprecated"===this.model.state.get("pdfgen_type"),canScheduleUser:this.model.state.user.canScheduleSearch()&&!this.model.state.user.isFree(),isPdfServiceAvailable:this.model.state.get("pdf_available"),appString:appString},html=this.compiledTemplate(renderModel);this.$el.html(PopTartView.prototype.template_menu);this.$el.append(html);return this},template:'                <div class="popdown-dialog-body">                    <div>                        <dl class="list-dotted">                            <dt class="app"><%- _("App").t() %></dt>                            <dd>                                <%= appString %>                            </dd>                            <% if(canScheduleXML) { %>                                <dt class="schedule"><%- _("Schedule").t() %></dt>                                <dd>                                    <% if(isScheduled) { %>                                        <%= schedule %> <%- _("to").t() %>                                         <%= recipients.join(", ") %>.                                    <% } else { %>                                        <%- _("Not scheduled").t() %>.                                    <% } %>                                     <% if(canScheduleUser && isPdfServiceAvailable) { %>                                        <a href="#" class="edit-schedule"><%- _("Edit").t() %></a>                                    <% } %>                                 </dd>                            <% } %>                             <dt class="permissions"><%- _("Permissions").t() %></dt>                            <dd class="edit-permissions">                                <%- _(permissionString).t() %>                                <% if(canChangePerms) { %>                                    <a href="#" class="edit-permissions"><%- _("Edit").t() %></a>                                <% } %>                         </dl>                    </div>                </div>            '})});define("splunkjs/mvc/simpleform/inputsettings",["require","underscore","jquery","../settings","../simplexml/controller"],function(require){var _=require("underscore"),$=require("jquery"),Settings=require("../settings"),DashboardController=require("../simplexml/controller"),InputSettings=Settings.extend({validation:{token:{fn:"validateToken"},labelField:{fn:"validateLabelAndValueFields"},valueField:{fn:"validateLabelAndValueFields"},choices:{fn:"validateChoices"}},validateToken:function(val){return val||"time"===this.get("type")?void 0:_("Token is required").t()},validateLabelAndValueFields:function(val,attr,options){var isEmpty,type="time"!==this.get("type")&&"text"!==this.get("type");isEmpty="inline"==options.searchType?!options.search:!1;return!type||val||isEmpty?void 0:_("Field For Label and Value are required for search").t()},validateChoices:function(val,attr,options){var type="time"!==this.get("type")&&"text"!==this.get("type");if(type&&options.choices.length>0){var isMissingName=!1,hasDupes=!1,dupesMap={};_.each(options.choices,function(choice){if(choice.value){choice.label||(isMissingName=!0);_.has(dupesMap,choice.value)&&(hasDupes=!0);dupesMap[choice.value]=!0}});if(isMissingName)return _("Static option values must have a name attributed to them").t();if(hasDupes)return _("Static option values must be unique").t()}},save:function(key,val,options){{var attrs;this.attributes}if(null==key||"object"==typeof key){attrs=key;options=val}else(attrs={})[key]=val;options=_.extend({validate:!0},options);if(attrs&&!options.wait){if(!this.set(attrs,options))return!1}else if(!this._validate(attrs,options))return!1;return DashboardController.model.view.updateInput(this)},destroy:function(){var dfd=$.Deferred(),that=this;DashboardController.model.view.deleteInput(that.get("id")).done(function(){dfd.resolve();that.trigger("removeInput")}).fail(function(err){dfd.reject(err)});return dfd.promise()}});return InputSettings});define("views/shared/delegates/Concertina",["jquery","underscore","views/shared/delegates/Base"],function($,_,DelegateBase){return DelegateBase.extend({initialize:function(){var defaults={body:".concertina-body",group:".concertina-group",heading:".concertina-heading",toggle:".concertina-toggle",groupBody:".concertina-group-body",dockTop:".concertina-dock-top",dockBottom:".concertina-dock-bottom",icon:".icon-concertina-toggle",activeClass:"active",speedMin:100,speedMax:300,speedMinDistance:200,speedMaxDistance:800,easing:"swing"};_.defaults(this.options,defaults);this.events={};this.events["click "+this.options.body+" "+this.options.toggle]="clickToggle";this.events["click "+this.options.dockTop+" "+this.options.toggle]="clickToggleTop";this.events["click "+this.options.dockBottom+" "+this.options.toggle]="clickToggleBottom";_.defer(this.delegateEvents.bind(this),this.events);this.measurements={};this.elements={};this.reset();$(window).on("resize."+this.cid,this.reset.bind(this))},clickToggleTop:function(e){e.preventDefault();var $el=$(e.currentTarget),$original=$el.parent().data("original"),topMargin=$el.parent().position().top,scrollFrom=this.elements.$body.scrollTop(),scrollTo=$original.position().top-topMargin+scrollFrom;this.elements.$body.animate({scrollTop:scrollTo},this.adjustSpeed(scrollFrom,scrollTo),this.options.easing)},clickToggle:function(e){e.preventDefault();this.scrollUp($(e.currentTarget).closest(this.options.group),this.elements.$bottomDock.outerHeight())},clickToggleBottom:function(e){e.preventDefault();var $el=$(e.currentTarget),$group=$(e.currentTarget).parent().data("original").closest(this.options.group);this.scrollUp($group,$group.nextAll().length*$el.outerHeight())},scrollUp:function($group,bottomMargin){var concertinaHeight=this.elements.$body.height(),scrollFrom=this.elements.$body.scrollTop(),scrollTo=$group.height()+($group.position().top+scrollFrom)-concertinaHeight+bottomMargin,topMargin=$group.prevAll().length*($group.find(this.options.toggle).outerHeight()-1),groupTop=$group.position().top;if(!(scrollFrom>scrollTo)){scrollTo+topMargin>groupTop+scrollFrom&&(scrollTo=scrollFrom+groupTop-topMargin);this.elements.$body.animate({scrollTop:scrollTo},this.adjustSpeed(scrollFrom,scrollTo),this.options.easing)}},adjustSpeed:function(from,to){var distance=Math.abs(from-to),speed=(distance-this.options.speedMinDistance)/(this.options.speedMaxDistance-this.options.speedMinDistance)*(this.options.speedMax-this.options.speedMin)+this.options.speedMin;return Math.min(Math.max(speed,this.options.speedMin),this.options.speedMax)},reset:function(){this.elements.$body=this.$(this.options.body);this.elements.$body.off("scroll."+this.cid);this.elements.$body.on("scroll."+this.cid,this.updateDocking.bind(this));this.elements.$headings=this.elements.$body.find(this.options.heading);this.measurements.scrollBarWidth=this.elements.$body.parent().width()-this.elements.$headings.first().width();this.elements.$topDock=this.$(this.options.dockTop).css("right",this.measurements.scrollBarWidth+"px").html("");this.elements.$bottomDock=this.$(this.options.dockBottom).css("right",this.measurements.scrollBarWidth+"px").html("");this.measurements.containerHeight=this.$el.height();this.updateDocking()},updateDocking:function(){this.elements.$topDock.html("");this.elements.$bottomDock.html("");this.elements.$headings.each(function(index,element){var $el=$(element);$el.position().top<this.elements.$topDock.height()&&$el.clone().appendTo(this.elements.$topDock).data("original",$el)}.bind(this));$(this.elements.$headings.get().reverse()).each(function(index,element){var $el=$(element);$el.position().top+$el.height()>this.measurements.containerHeight-this.elements.$bottomDock.height()&&$el.clone().prependTo(this.elements.$bottomDock).data("original",$el)}.bind(this))},remove:function(){DelegateBase.prototype.remove.apply(this);$(window).off("resize."+this.cid);this.elements.$body&&this.elements.$body.off("scroll."+this.cid);return this}})});define("splunkjs/mvc/simpleform/edit/concertinasettingseditor",["require","exports","module","underscore","jquery","util/console","../../../mvc","views/Base","views/shared/delegates/Concertina","views/shared/controls/ControlGroup"],function(require,exports,module){var _=require("underscore"),$=require("jquery"),Base=(require("util/console"),require("../../../mvc"),require("views/Base")),Concertina=require("views/shared/delegates/Concertina"),ControlGroup=require("views/shared/controls/ControlGroup");return Base.extend({moduleId:module.id,className:"concertina",initialize:function(){Base.prototype.initialize.apply(this,arguments)},render:function(){if(!this.children.concertina){this.$el.html(this.template);this.children.concertina=new Concertina({el:this.el});_(this.options.panels||[]).each(function(panelOptions){this.renderPanel(panelOptions)},this)}return this},renderPanel:function(panelOptions){var $panel=$(_.template(this.templatePanel,panelOptions)),$panelBody=$panel.find(".concertina-group-body");_(panelOptions.controls||[]).each(function(controlOptions){controlOptions.controlOptions.model=this.model;var controlTypeClass=controlOptions.controlTypeClass||ControlGroup,control=this.children[_.unique("control_")]=new controlTypeClass(controlOptions);$panelBody.append(control.render().$el)},this);this.$(".concertina-body").append($panel)},activate:function(){this.children.concertina&&this.children.concertina.reset()},template:'            <div class="concertina-dock-top"></div>            <div class="concertina-body"></div>            <div class="concertina-dock-bottom"></div>        ',templatePanel:'            <div class="concertina-group">            <div class="concertina-heading <%- headingClassName || \'\' %>">                <a href="#" class="concertina-toggle">                    <%- title %>                </a>            </div>            <div class="concertina-group-body panel-body <%- headingClassName ? (headingClassName + \'-body\') : \'\' %>">            </div>            </div>        '})});!function($){var mouseHandled=!1;$(document).mouseup(function(){mouseHandled=!1});$.widget("ui.mouse",{version:"1.10.3",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var that=this;this.element.bind("mousedown."+this.widgetName,function(event){return that._mouseDown(event)}).bind("click."+this.widgetName,function(event){if(!0===$.data(event.target,that.widgetName+".preventClickEvent")){$.removeData(event.target,that.widgetName+".preventClickEvent");event.stopImmediatePropagation();return!1}});this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName);this._mouseMoveDelegate&&$(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(event){if(!mouseHandled){this._mouseStarted&&this._mouseUp(event);this._mouseDownEvent=event;var that=this,btnIsLeft=1===event.which,elIsCancel="string"==typeof this.options.cancel&&event.target.nodeName?$(event.target).closest(this.options.cancel).length:!1;if(!btnIsLeft||elIsCancel||!this._mouseCapture(event))return!0;this.mouseDelayMet=!this.options.delay;this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){that.mouseDelayMet=!0},this.options.delay));if(this._mouseDistanceMet(event)&&this._mouseDelayMet(event)){this._mouseStarted=this._mouseStart(event)!==!1;if(!this._mouseStarted){event.preventDefault();return!0}}!0===$.data(event.target,this.widgetName+".preventClickEvent")&&$.removeData(event.target,this.widgetName+".preventClickEvent");this._mouseMoveDelegate=function(event){return that._mouseMove(event)};this._mouseUpDelegate=function(event){return that._mouseUp(event)};$(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate);event.preventDefault();mouseHandled=!0;return!0}},_mouseMove:function(event){if($.ui.ie&&(!document.documentMode||document.documentMode<9)&&!event.button)return this._mouseUp(event);if(this._mouseStarted){this._mouseDrag(event);return event.preventDefault()}if(this._mouseDistanceMet(event)&&this._mouseDelayMet(event)){this._mouseStarted=this._mouseStart(this._mouseDownEvent,event)!==!1;this._mouseStarted?this._mouseDrag(event):this._mouseUp(event)}return!this._mouseStarted},_mouseUp:function(event){$(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate);if(this._mouseStarted){this._mouseStarted=!1;event.target===this._mouseDownEvent.target&&$.data(event.target,this.widgetName+".preventClickEvent",!0);this._mouseStop(event)}return!1},_mouseDistanceMet:function(event){return Math.max(Math.abs(this._mouseDownEvent.pageX-event.pageX),Math.abs(this._mouseDownEvent.pageY-event.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(jQuery);define("jquery.ui.mouse",["jquery.ui.widget"],function(){});!function($){$.widget("ui.draggable",$.ui.mouse,{version:"1.10.3",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"!==this.options.helper||/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative");this.options.addClasses&&this.element.addClass("ui-draggable");this.options.disabled&&this.element.addClass("ui-draggable-disabled");this._mouseInit()},_destroy:function(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled");this._mouseDestroy()},_mouseCapture:function(event){var o=this.options;if(this.helper||o.disabled||$(event.target).closest(".ui-resizable-handle").length>0)return!1;this.handle=this._getHandle(event);if(!this.handle)return!1;$(o.iframeFix===!0?"iframe":o.iframeFix).each(function(){$("<div class='ui-draggable-iframeFix' style='background: #fff;'></div>").css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css($(this).offset()).appendTo("body")});return!0},_mouseStart:function(event){var o=this.options;this.helper=this._createHelper(event);this.helper.addClass("ui-draggable-dragging");this._cacheHelperProportions();$.ui.ddmanager&&($.ui.ddmanager.current=this);this._cacheMargins();this.cssPosition=this.helper.css("position");this.scrollParent=this.helper.scrollParent();this.offsetParent=this.helper.offsetParent();this.offsetParentCssPosition=this.offsetParent.css("position");this.offset=this.positionAbs=this.element.offset();this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left};this.offset.scroll=!1;$.extend(this.offset,{click:{left:event.pageX-this.offset.left,top:event.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()});this.originalPosition=this.position=this._generatePosition(event);this.originalPageX=event.pageX;this.originalPageY=event.pageY;o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt);this._setContainment();if(this._trigger("start",event)===!1){this._clear();return!1}this._cacheHelperProportions();$.ui.ddmanager&&!o.dropBehaviour&&$.ui.ddmanager.prepareOffsets(this,event);this._mouseDrag(event,!0);$.ui.ddmanager&&$.ui.ddmanager.dragStart(this,event);return!0},_mouseDrag:function(event,noPropagation){"fixed"===this.offsetParentCssPosition&&(this.offset.parent=this._getParentOffset());this.position=this._generatePosition(event);this.positionAbs=this._convertPositionTo("absolute");if(!noPropagation){var ui=this._uiHash();if(this._trigger("drag",event,ui)===!1){this._mouseUp({});return!1}this.position=ui.position}this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px");this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px");$.ui.ddmanager&&$.ui.ddmanager.drag(this,event);return!1},_mouseStop:function(event){var that=this,dropped=!1;$.ui.ddmanager&&!this.options.dropBehaviour&&(dropped=$.ui.ddmanager.drop(this,event));if(this.dropped){dropped=this.dropped;this.dropped=!1}if("original"===this.options.helper&&!$.contains(this.element[0].ownerDocument,this.element[0]))return!1;"invalid"===this.options.revert&&!dropped||"valid"===this.options.revert&&dropped||this.options.revert===!0||$.isFunction(this.options.revert)&&this.options.revert.call(this.element,dropped)?$(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){that._trigger("stop",event)!==!1&&that._clear()}):this._trigger("stop",event)!==!1&&this._clear();return!1},_mouseUp:function(event){$("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)});$.ui.ddmanager&&$.ui.ddmanager.dragStop(this,event);return $.ui.mouse.prototype._mouseUp.call(this,event)},cancel:function(){this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear();return this},_getHandle:function(event){return this.options.handle?!!$(event.target).closest(this.element.find(this.options.handle)).length:!0},_createHelper:function(event){var o=this.options,helper=$.isFunction(o.helper)?$(o.helper.apply(this.element[0],[event])):"clone"===o.helper?this.element.clone().removeAttr("id"):this.element;helper.parents("body").length||helper.appendTo("parent"===o.appendTo?this.element[0].parentNode:o.appendTo);helper[0]===this.element[0]||/(fixed|absolute)/.test(helper.css("position"))||helper.css("position","absolute");return helper},_adjustOffsetFromHelper:function(obj){"string"==typeof obj&&(obj=obj.split(" "));$.isArray(obj)&&(obj={left:+obj[0],top:+obj[1]||0});"left"in obj&&(this.offset.click.left=obj.left+this.margins.left);"right"in obj&&(this.offset.click.left=this.helperProportions.width-obj.right+this.margins.left);"top"in obj&&(this.offset.click.top=obj.top+this.margins.top);"bottom"in obj&&(this.offset.click.top=this.helperProportions.height-obj.bottom+this.margins.top)},_getParentOffset:function(){var po=this.offsetParent.offset();if("absolute"===this.cssPosition&&this.scrollParent[0]!==document&&$.contains(this.scrollParent[0],this.offsetParent[0])){po.left+=this.scrollParent.scrollLeft();po.top+=this.scrollParent.scrollTop()
}(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&$.ui.ie)&&(po={top:0,left:0});return{top:po.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:po.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var p=this.element.position();return{top:p.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:p.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var over,c,ce,o=this.options;if(o.containment)if("window"!==o.containment)if("document"!==o.containment)if(o.containment.constructor!==Array){"parent"===o.containment&&(o.containment=this.helper[0].parentNode);c=$(o.containment);ce=c[0];if(ce){over="hidden"!==c.css("overflow");this.containment=[(parseInt(c.css("borderLeftWidth"),10)||0)+(parseInt(c.css("paddingLeft"),10)||0),(parseInt(c.css("borderTopWidth"),10)||0)+(parseInt(c.css("paddingTop"),10)||0),(over?Math.max(ce.scrollWidth,ce.offsetWidth):ce.offsetWidth)-(parseInt(c.css("borderRightWidth"),10)||0)-(parseInt(c.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(over?Math.max(ce.scrollHeight,ce.offsetHeight):ce.offsetHeight)-(parseInt(c.css("borderBottomWidth"),10)||0)-(parseInt(c.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom];this.relative_container=c}}else this.containment=o.containment;else this.containment=[0,0,$(document).width()-this.helperProportions.width-this.margins.left,($(document).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];else this.containment=[$(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,$(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,$(window).scrollLeft()+$(window).width()-this.helperProportions.width-this.margins.left,$(window).scrollTop()+($(window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];else this.containment=null},_convertPositionTo:function(d,pos){pos||(pos=this.position);var mod="absolute"===d?1:-1,scroll="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&$.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent;this.offset.scroll||(this.offset.scroll={top:scroll.scrollTop(),left:scroll.scrollLeft()});return{top:pos.top+this.offset.relative.top*mod+this.offset.parent.top*mod-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top)*mod,left:pos.left+this.offset.relative.left*mod+this.offset.parent.left*mod-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)*mod}},_generatePosition:function(event){var containment,co,top,left,o=this.options,scroll="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&$.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,pageX=event.pageX,pageY=event.pageY;this.offset.scroll||(this.offset.scroll={top:scroll.scrollTop(),left:scroll.scrollLeft()});if(this.originalPosition){if(this.containment){if(this.relative_container){co=this.relative_container.offset();containment=[this.containment[0]+co.left,this.containment[1]+co.top,this.containment[2]+co.left,this.containment[3]+co.top]}else containment=this.containment;event.pageX-this.offset.click.left<containment[0]&&(pageX=containment[0]+this.offset.click.left);event.pageY-this.offset.click.top<containment[1]&&(pageY=containment[1]+this.offset.click.top);event.pageX-this.offset.click.left>containment[2]&&(pageX=containment[2]+this.offset.click.left);event.pageY-this.offset.click.top>containment[3]&&(pageY=containment[3]+this.offset.click.top)}if(o.grid){top=o.grid[1]?this.originalPageY+Math.round((pageY-this.originalPageY)/o.grid[1])*o.grid[1]:this.originalPageY;pageY=containment?top-this.offset.click.top>=containment[1]||top-this.offset.click.top>containment[3]?top:top-this.offset.click.top>=containment[1]?top-o.grid[1]:top+o.grid[1]:top;left=o.grid[0]?this.originalPageX+Math.round((pageX-this.originalPageX)/o.grid[0])*o.grid[0]:this.originalPageX;pageX=containment?left-this.offset.click.left>=containment[0]||left-this.offset.click.left>containment[2]?left:left-this.offset.click.left>=containment[0]?left-o.grid[0]:left+o.grid[0]:left}}return{top:pageY-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top),left:pageX-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)}},_clear:function(){this.helper.removeClass("ui-draggable-dragging");this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove();this.helper=null;this.cancelHelperRemoval=!1},_trigger:function(type,event,ui){ui=ui||this._uiHash();$.ui.plugin.call(this,type,[event,ui]);"drag"===type&&(this.positionAbs=this._convertPositionTo("absolute"));return $.Widget.prototype._trigger.call(this,type,event,ui)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}});$.ui.plugin.add("draggable","connectToSortable",{start:function(event,ui){var inst=$(this).data("ui-draggable"),o=inst.options,uiSortable=$.extend({},ui,{item:inst.element});inst.sortables=[];$(o.connectToSortable).each(function(){var sortable=$.data(this,"ui-sortable");if(sortable&&!sortable.options.disabled){inst.sortables.push({instance:sortable,shouldRevert:sortable.options.revert});sortable.refreshPositions();sortable._trigger("activate",event,uiSortable)}})},stop:function(event,ui){var inst=$(this).data("ui-draggable"),uiSortable=$.extend({},ui,{item:inst.element});$.each(inst.sortables,function(){if(this.instance.isOver){this.instance.isOver=0;inst.cancelHelperRemoval=!0;this.instance.cancelHelperRemoval=!1;this.shouldRevert&&(this.instance.options.revert=this.shouldRevert);this.instance._mouseStop(event);this.instance.options.helper=this.instance.options._helper;"original"===inst.options.helper&&this.instance.currentItem.css({top:"auto",left:"auto"})}else{this.instance.cancelHelperRemoval=!1;this.instance._trigger("deactivate",event,uiSortable)}})},drag:function(event,ui){var inst=$(this).data("ui-draggable"),that=this;$.each(inst.sortables,function(){var innermostIntersecting=!1,thisSortable=this;this.instance.positionAbs=inst.positionAbs;this.instance.helperProportions=inst.helperProportions;this.instance.offset.click=inst.offset.click;if(this.instance._intersectsWith(this.instance.containerCache)){innermostIntersecting=!0;$.each(inst.sortables,function(){this.instance.positionAbs=inst.positionAbs;this.instance.helperProportions=inst.helperProportions;this.instance.offset.click=inst.offset.click;this!==thisSortable&&this.instance._intersectsWith(this.instance.containerCache)&&$.contains(thisSortable.instance.element[0],this.instance.element[0])&&(innermostIntersecting=!1);return innermostIntersecting})}if(innermostIntersecting){if(!this.instance.isOver){this.instance.isOver=1;this.instance.currentItem=$(that).clone().removeAttr("id").appendTo(this.instance.element).data("ui-sortable-item",!0);this.instance.options._helper=this.instance.options.helper;this.instance.options.helper=function(){return ui.helper[0]};event.target=this.instance.currentItem[0];this.instance._mouseCapture(event,!0);this.instance._mouseStart(event,!0,!0);this.instance.offset.click.top=inst.offset.click.top;this.instance.offset.click.left=inst.offset.click.left;this.instance.offset.parent.left-=inst.offset.parent.left-this.instance.offset.parent.left;this.instance.offset.parent.top-=inst.offset.parent.top-this.instance.offset.parent.top;inst._trigger("toSortable",event);inst.dropped=this.instance.element;inst.currentItem=inst.element;this.instance.fromOutside=inst}this.instance.currentItem&&this.instance._mouseDrag(event)}else if(this.instance.isOver){this.instance.isOver=0;this.instance.cancelHelperRemoval=!0;this.instance.options.revert=!1;this.instance._trigger("out",event,this.instance._uiHash(this.instance));this.instance._mouseStop(event,!0);this.instance.options.helper=this.instance.options._helper;this.instance.currentItem.remove();this.instance.placeholder&&this.instance.placeholder.remove();inst._trigger("fromSortable",event);inst.dropped=!1}})}});$.ui.plugin.add("draggable","cursor",{start:function(){var t=$("body"),o=$(this).data("ui-draggable").options;t.css("cursor")&&(o._cursor=t.css("cursor"));t.css("cursor",o.cursor)},stop:function(){var o=$(this).data("ui-draggable").options;o._cursor&&$("body").css("cursor",o._cursor)}});$.ui.plugin.add("draggable","opacity",{start:function(event,ui){var t=$(ui.helper),o=$(this).data("ui-draggable").options;t.css("opacity")&&(o._opacity=t.css("opacity"));t.css("opacity",o.opacity)},stop:function(event,ui){var o=$(this).data("ui-draggable").options;o._opacity&&$(ui.helper).css("opacity",o._opacity)}});$.ui.plugin.add("draggable","scroll",{start:function(){var i=$(this).data("ui-draggable");i.scrollParent[0]!==document&&"HTML"!==i.scrollParent[0].tagName&&(i.overflowOffset=i.scrollParent.offset())},drag:function(event){var i=$(this).data("ui-draggable"),o=i.options,scrolled=!1;if(i.scrollParent[0]!==document&&"HTML"!==i.scrollParent[0].tagName){o.axis&&"x"===o.axis||(i.overflowOffset.top+i.scrollParent[0].offsetHeight-event.pageY<o.scrollSensitivity?i.scrollParent[0].scrollTop=scrolled=i.scrollParent[0].scrollTop+o.scrollSpeed:event.pageY-i.overflowOffset.top<o.scrollSensitivity&&(i.scrollParent[0].scrollTop=scrolled=i.scrollParent[0].scrollTop-o.scrollSpeed));o.axis&&"y"===o.axis||(i.overflowOffset.left+i.scrollParent[0].offsetWidth-event.pageX<o.scrollSensitivity?i.scrollParent[0].scrollLeft=scrolled=i.scrollParent[0].scrollLeft+o.scrollSpeed:event.pageX-i.overflowOffset.left<o.scrollSensitivity&&(i.scrollParent[0].scrollLeft=scrolled=i.scrollParent[0].scrollLeft-o.scrollSpeed))}else{o.axis&&"x"===o.axis||(event.pageY-$(document).scrollTop()<o.scrollSensitivity?scrolled=$(document).scrollTop($(document).scrollTop()-o.scrollSpeed):$(window).height()-(event.pageY-$(document).scrollTop())<o.scrollSensitivity&&(scrolled=$(document).scrollTop($(document).scrollTop()+o.scrollSpeed)));o.axis&&"y"===o.axis||(event.pageX-$(document).scrollLeft()<o.scrollSensitivity?scrolled=$(document).scrollLeft($(document).scrollLeft()-o.scrollSpeed):$(window).width()-(event.pageX-$(document).scrollLeft())<o.scrollSensitivity&&(scrolled=$(document).scrollLeft($(document).scrollLeft()+o.scrollSpeed)))}scrolled!==!1&&$.ui.ddmanager&&!o.dropBehaviour&&$.ui.ddmanager.prepareOffsets(i,event)}});$.ui.plugin.add("draggable","snap",{start:function(){var i=$(this).data("ui-draggable"),o=i.options;i.snapElements=[];$(o.snap.constructor!==String?o.snap.items||":data(ui-draggable)":o.snap).each(function(){var $t=$(this),$o=$t.offset();this!==i.element[0]&&i.snapElements.push({item:this,width:$t.outerWidth(),height:$t.outerHeight(),top:$o.top,left:$o.left})})},drag:function(event,ui){var ts,bs,ls,rs,l,r,t,b,i,first,inst=$(this).data("ui-draggable"),o=inst.options,d=o.snapTolerance,x1=ui.offset.left,x2=x1+inst.helperProportions.width,y1=ui.offset.top,y2=y1+inst.helperProportions.height;for(i=inst.snapElements.length-1;i>=0;i--){l=inst.snapElements[i].left;r=l+inst.snapElements[i].width;t=inst.snapElements[i].top;b=t+inst.snapElements[i].height;if(l-d>x2||x1>r+d||t-d>y2||y1>b+d||!$.contains(inst.snapElements[i].item.ownerDocument,inst.snapElements[i].item)){inst.snapElements[i].snapping&&inst.options.snap.release&&inst.options.snap.release.call(inst.element,event,$.extend(inst._uiHash(),{snapItem:inst.snapElements[i].item}));inst.snapElements[i].snapping=!1}else{if("inner"!==o.snapMode){ts=Math.abs(t-y2)<=d;bs=Math.abs(b-y1)<=d;ls=Math.abs(l-x2)<=d;rs=Math.abs(r-x1)<=d;ts&&(ui.position.top=inst._convertPositionTo("relative",{top:t-inst.helperProportions.height,left:0}).top-inst.margins.top);bs&&(ui.position.top=inst._convertPositionTo("relative",{top:b,left:0}).top-inst.margins.top);ls&&(ui.position.left=inst._convertPositionTo("relative",{top:0,left:l-inst.helperProportions.width}).left-inst.margins.left);rs&&(ui.position.left=inst._convertPositionTo("relative",{top:0,left:r}).left-inst.margins.left)}first=ts||bs||ls||rs;if("outer"!==o.snapMode){ts=Math.abs(t-y1)<=d;bs=Math.abs(b-y2)<=d;ls=Math.abs(l-x1)<=d;rs=Math.abs(r-x2)<=d;ts&&(ui.position.top=inst._convertPositionTo("relative",{top:t,left:0}).top-inst.margins.top);bs&&(ui.position.top=inst._convertPositionTo("relative",{top:b-inst.helperProportions.height,left:0}).top-inst.margins.top);ls&&(ui.position.left=inst._convertPositionTo("relative",{top:0,left:l}).left-inst.margins.left);rs&&(ui.position.left=inst._convertPositionTo("relative",{top:0,left:r-inst.helperProportions.width}).left-inst.margins.left)}!inst.snapElements[i].snapping&&(ts||bs||ls||rs||first)&&inst.options.snap.snap&&inst.options.snap.snap.call(inst.element,event,$.extend(inst._uiHash(),{snapItem:inst.snapElements[i].item}));inst.snapElements[i].snapping=ts||bs||ls||rs||first}}}});$.ui.plugin.add("draggable","stack",{start:function(){var min,o=this.data("ui-draggable").options,group=$.makeArray($(o.stack)).sort(function(a,b){return(parseInt($(a).css("zIndex"),10)||0)-(parseInt($(b).css("zIndex"),10)||0)});if(group.length){min=parseInt($(group[0]).css("zIndex"),10)||0;$(group).each(function(i){$(this).css("zIndex",min+i)});this.css("zIndex",min+group.length)}}});$.ui.plugin.add("draggable","zIndex",{start:function(event,ui){var t=$(ui.helper),o=$(this).data("ui-draggable").options;t.css("zIndex")&&(o._zIndex=t.css("zIndex"));t.css("zIndex",o.zIndex)},stop:function(event,ui){var o=$(this).data("ui-draggable").options;o._zIndex&&$(ui.helper).css("zIndex",o._zIndex)}})}(jQuery);define("jquery.ui.draggable",["jquery.ui.widget","jquery.ui.mouse"],function(){});!function($){function isOverAxis(x,reference,size){return x>reference&&reference+size>x}$.widget("ui.droppable",{version:"1.10.3",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var o=this.options,accept=o.accept;this.isover=!1;this.isout=!0;this.accept=$.isFunction(accept)?accept:function(d){return d.is(accept)};this.proportions={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight};$.ui.ddmanager.droppables[o.scope]=$.ui.ddmanager.droppables[o.scope]||[];$.ui.ddmanager.droppables[o.scope].push(this);o.addClasses&&this.element.addClass("ui-droppable")},_destroy:function(){for(var i=0,drop=$.ui.ddmanager.droppables[this.options.scope];i<drop.length;i++)drop[i]===this&&drop.splice(i,1);this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(key,value){"accept"===key&&(this.accept=$.isFunction(value)?value:function(d){return d.is(value)});$.Widget.prototype._setOption.apply(this,arguments)},_activate:function(event){var draggable=$.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass);draggable&&this._trigger("activate",event,this.ui(draggable))},_deactivate:function(event){var draggable=$.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass);draggable&&this._trigger("deactivate",event,this.ui(draggable))},_over:function(event){var draggable=$.ui.ddmanager.current;if(draggable&&(draggable.currentItem||draggable.element)[0]!==this.element[0]&&this.accept.call(this.element[0],draggable.currentItem||draggable.element)){this.options.hoverClass&&this.element.addClass(this.options.hoverClass);this._trigger("over",event,this.ui(draggable))}},_out:function(event){var draggable=$.ui.ddmanager.current;if(draggable&&(draggable.currentItem||draggable.element)[0]!==this.element[0]&&this.accept.call(this.element[0],draggable.currentItem||draggable.element)){this.options.hoverClass&&this.element.removeClass(this.options.hoverClass);this._trigger("out",event,this.ui(draggable))}},_drop:function(event,custom){var draggable=custom||$.ui.ddmanager.current,childrenIntersection=!1;if(!draggable||(draggable.currentItem||draggable.element)[0]===this.element[0])return!1;this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var inst=$.data(this,"ui-droppable");if(inst.options.greedy&&!inst.options.disabled&&inst.options.scope===draggable.options.scope&&inst.accept.call(inst.element[0],draggable.currentItem||draggable.element)&&$.ui.intersect(draggable,$.extend(inst,{offset:inst.element.offset()}),inst.options.tolerance)){childrenIntersection=!0;return!1}});if(childrenIntersection)return!1;if(this.accept.call(this.element[0],draggable.currentItem||draggable.element)){this.options.activeClass&&this.element.removeClass(this.options.activeClass);this.options.hoverClass&&this.element.removeClass(this.options.hoverClass);this._trigger("drop",event,this.ui(draggable));return this.element}return!1},ui:function(c){return{draggable:c.currentItem||c.element,helper:c.helper,position:c.position,offset:c.positionAbs}}});$.ui.intersect=function(draggable,droppable,toleranceMode){if(!droppable.offset)return!1;var draggableLeft,draggableTop,x1=(draggable.positionAbs||draggable.position.absolute).left,x2=x1+draggable.helperProportions.width,y1=(draggable.positionAbs||draggable.position.absolute).top,y2=y1+draggable.helperProportions.height,l=droppable.offset.left,r=l+droppable.proportions.width,t=droppable.offset.top,b=t+droppable.proportions.height;switch(toleranceMode){case"fit":return x1>=l&&r>=x2&&y1>=t&&b>=y2;case"intersect":return l<x1+draggable.helperProportions.width/2&&x2-draggable.helperProportions.width/2<r&&t<y1+draggable.helperProportions.height/2&&y2-draggable.helperProportions.height/2<b;case"pointer":draggableLeft=(draggable.positionAbs||draggable.position.absolute).left+(draggable.clickOffset||draggable.offset.click).left;draggableTop=(draggable.positionAbs||draggable.position.absolute).top+(draggable.clickOffset||draggable.offset.click).top;return isOverAxis(draggableTop,t,droppable.proportions.height)&&isOverAxis(draggableLeft,l,droppable.proportions.width);case"touch":return(y1>=t&&b>=y1||y2>=t&&b>=y2||t>y1&&y2>b)&&(x1>=l&&r>=x1||x2>=l&&r>=x2||l>x1&&x2>r);default:return!1}};$.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(t,event){var i,j,m=$.ui.ddmanager.droppables[t.options.scope]||[],type=event?event.type:null,list=(t.currentItem||t.element).find(":data(ui-droppable)").addBack();droppablesLoop:for(i=0;i<m.length;i++)if(!(m[i].options.disabled||t&&!m[i].accept.call(m[i].element[0],t.currentItem||t.element))){for(j=0;j<list.length;j++)if(list[j]===m[i].element[0]){m[i].proportions.height=0;continue droppablesLoop}m[i].visible="none"!==m[i].element.css("display");if(m[i].visible){"mousedown"===type&&m[i]._activate.call(m[i],event);m[i].offset=m[i].element.offset();m[i].proportions={width:m[i].element[0].offsetWidth,height:m[i].element[0].offsetHeight}}}},drop:function(draggable,event){var dropped=!1;$.each(($.ui.ddmanager.droppables[draggable.options.scope]||[]).slice(),function(){if(this.options){!this.options.disabled&&this.visible&&$.ui.intersect(draggable,this,this.options.tolerance)&&(dropped=this._drop.call(this,event)||dropped);if(!this.options.disabled&&this.visible&&this.accept.call(this.element[0],draggable.currentItem||draggable.element)){this.isout=!0;this.isover=!1;this._deactivate.call(this,event)}}});return dropped},dragStart:function(draggable,event){draggable.element.parentsUntil("body").bind("scroll.droppable",function(){draggable.options.refreshPositions||$.ui.ddmanager.prepareOffsets(draggable,event)})},drag:function(draggable,event){draggable.options.refreshPositions&&$.ui.ddmanager.prepareOffsets(draggable,event);$.each($.ui.ddmanager.droppables[draggable.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var parentInstance,scope,parent,intersects=$.ui.intersect(draggable,this,this.options.tolerance),c=!intersects&&this.isover?"isout":intersects&&!this.isover?"isover":null;if(c){if(this.options.greedy){scope=this.options.scope;parent=this.element.parents(":data(ui-droppable)").filter(function(){return $.data(this,"ui-droppable").options.scope===scope});if(parent.length){parentInstance=$.data(parent[0],"ui-droppable");parentInstance.greedyChild="isover"===c}}if(parentInstance&&"isover"===c){parentInstance.isover=!1;parentInstance.isout=!0;parentInstance._out.call(parentInstance,event)}this[c]=!0;this["isout"===c?"isover":"isout"]=!1;this["isover"===c?"_over":"_out"].call(this,event);if(parentInstance&&"isout"===c){parentInstance.isout=!1;parentInstance.isover=!0;parentInstance._over.call(parentInstance,event)}}}})},dragStop:function(draggable,event){draggable.element.parentsUntil("body").unbind("scroll.droppable");draggable.options.refreshPositions||$.ui.ddmanager.prepareOffsets(draggable,event)}}}(jQuery);define("jquery.ui.droppable",["jquery.ui.widget","jquery.ui.mouse"],function(){});!function($){function isOverAxis(x,reference,size){return x>reference&&reference+size>x}function isFloating(item){return/left|right/.test(item.css("float"))||/inline|table-cell/.test(item.css("display"))}$.widget("ui.sortable",$.ui.mouse,{version:"1.10.3",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_create:function(){var o=this.options;this.containerCache={};this.element.addClass("ui-sortable");this.refresh();this.floating=this.items.length?"x"===o.axis||isFloating(this.items[0].item):!1;this.offset=this.element.offset();this._mouseInit();this.ready=!0},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled");this._mouseDestroy();for(var i=this.items.length-1;i>=0;i--)this.items[i].item.removeData(this.widgetName+"-item");return this},_setOption:function(key,value){if("disabled"===key){this.options[key]=value;this.widget().toggleClass("ui-sortable-disabled",!!value)}else $.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(event,overrideHandle){var currentItem=null,validHandle=!1,that=this;if(this.reverting)return!1;if(this.options.disabled||"static"===this.options.type)return!1;this._refreshItems(event);$(event.target).parents().each(function(){if($.data(this,that.widgetName+"-item")===that){currentItem=$(this);return!1}});$.data(event.target,that.widgetName+"-item")===that&&(currentItem=$(event.target));if(!currentItem)return!1;if(this.options.handle&&!overrideHandle){$(this.options.handle,currentItem).find("*").addBack().each(function(){this===event.target&&(validHandle=!0)});if(!validHandle)return!1}this.currentItem=currentItem;this._removeCurrentsFromItems();return!0},_mouseStart:function(event,overrideHandle,noActivation){var i,body,o=this.options;this.currentContainer=this;this.refreshPositions();this.helper=this._createHelper(event);this._cacheHelperProportions();this._cacheMargins();this.scrollParent=this.helper.scrollParent();this.offset=this.currentItem.offset();this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left};$.extend(this.offset,{click:{left:event.pageX-this.offset.left,top:event.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()});this.helper.css("position","absolute");this.cssPosition=this.helper.css("position");this.originalPosition=this._generatePosition(event);this.originalPageX=event.pageX;this.originalPageY=event.pageY;o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt);this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]};this.helper[0]!==this.currentItem[0]&&this.currentItem.hide();this._createPlaceholder();o.containment&&this._setContainment();if(o.cursor&&"auto"!==o.cursor){body=this.document.find("body");this.storedCursor=body.css("cursor");body.css("cursor",o.cursor);this.storedStylesheet=$("<style>*{ cursor: "+o.cursor+" !important; }</style>").appendTo(body)}if(o.opacity){this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity"));this.helper.css("opacity",o.opacity)}if(o.zIndex){this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex"));this.helper.css("zIndex",o.zIndex)}this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset());this._trigger("start",event,this._uiHash());this._preserveHelperProportions||this._cacheHelperProportions();if(!noActivation)for(i=this.containers.length-1;i>=0;i--)this.containers[i]._trigger("activate",event,this._uiHash(this));$.ui.ddmanager&&($.ui.ddmanager.current=this);$.ui.ddmanager&&!o.dropBehaviour&&$.ui.ddmanager.prepareOffsets(this,event);this.dragging=!0;this.helper.addClass("ui-sortable-helper");this._mouseDrag(event);return!0},_mouseDrag:function(event){var i,item,itemElement,intersection,o=this.options,scrolled=!1;this.position=this._generatePosition(event);this.positionAbs=this._convertPositionTo("absolute");this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs);if(this.options.scroll){if(this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName){this.overflowOffset.top+this.scrollParent[0].offsetHeight-event.pageY<o.scrollSensitivity?this.scrollParent[0].scrollTop=scrolled=this.scrollParent[0].scrollTop+o.scrollSpeed:event.pageY-this.overflowOffset.top<o.scrollSensitivity&&(this.scrollParent[0].scrollTop=scrolled=this.scrollParent[0].scrollTop-o.scrollSpeed);this.overflowOffset.left+this.scrollParent[0].offsetWidth-event.pageX<o.scrollSensitivity?this.scrollParent[0].scrollLeft=scrolled=this.scrollParent[0].scrollLeft+o.scrollSpeed:event.pageX-this.overflowOffset.left<o.scrollSensitivity&&(this.scrollParent[0].scrollLeft=scrolled=this.scrollParent[0].scrollLeft-o.scrollSpeed)}else{event.pageY-$(document).scrollTop()<o.scrollSensitivity?scrolled=$(document).scrollTop($(document).scrollTop()-o.scrollSpeed):$(window).height()-(event.pageY-$(document).scrollTop())<o.scrollSensitivity&&(scrolled=$(document).scrollTop($(document).scrollTop()+o.scrollSpeed));event.pageX-$(document).scrollLeft()<o.scrollSensitivity?scrolled=$(document).scrollLeft($(document).scrollLeft()-o.scrollSpeed):$(window).width()-(event.pageX-$(document).scrollLeft())<o.scrollSensitivity&&(scrolled=$(document).scrollLeft($(document).scrollLeft()+o.scrollSpeed))}scrolled!==!1&&$.ui.ddmanager&&!o.dropBehaviour&&$.ui.ddmanager.prepareOffsets(this,event)}this.positionAbs=this._convertPositionTo("absolute");this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px");this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px");for(i=this.items.length-1;i>=0;i--){item=this.items[i];itemElement=item.item[0];intersection=this._intersectsWithPointer(item);if(intersection&&item.instance===this.currentContainer&&itemElement!==this.currentItem[0]&&this.placeholder[1===intersection?"next":"prev"]()[0]!==itemElement&&!$.contains(this.placeholder[0],itemElement)&&("semi-dynamic"===this.options.type?!$.contains(this.element[0],itemElement):!0)){this.direction=1===intersection?"down":"up";if("pointer"!==this.options.tolerance&&!this._intersectsWithSides(item))break;this._rearrange(event,item);this._trigger("change",event,this._uiHash());break}}this._contactContainers(event);$.ui.ddmanager&&$.ui.ddmanager.drag(this,event);this._trigger("sort",event,this._uiHash());this.lastPositionAbs=this.positionAbs;return!1},_mouseStop:function(event,noPropagation){if(event){$.ui.ddmanager&&!this.options.dropBehaviour&&$.ui.ddmanager.drop(this,event);if(this.options.revert){var that=this,cur=this.placeholder.offset(),axis=this.options.axis,animation={};axis&&"x"!==axis||(animation.left=cur.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollLeft));axis&&"y"!==axis||(animation.top=cur.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollTop));this.reverting=!0;$(this.helper).animate(animation,parseInt(this.options.revert,10)||500,function(){that._clear(event)})}else this._clear(event,noPropagation);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null});"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var i=this.containers.length-1;i>=0;i--){this.containers[i]._trigger("deactivate",null,this._uiHash(this));if(this.containers[i].containerCache.over){this.containers[i]._trigger("out",null,this._uiHash(this));this.containers[i].containerCache.over=0}}}if(this.placeholder){this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]);"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove();$.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null});this.domPosition.prev?$(this.domPosition.prev).after(this.currentItem):$(this.domPosition.parent).prepend(this.currentItem)}return this},serialize:function(o){var items=this._getItemsAsjQuery(o&&o.connected),str=[];o=o||{};$(items).each(function(){var res=($(o.item||this).attr(o.attribute||"id")||"").match(o.expression||/(.+)[\-=_](.+)/);res&&str.push((o.key||res[1]+"[]")+"="+(o.key&&o.expression?res[1]:res[2]))});!str.length&&o.key&&str.push(o.key+"=");return str.join("&")},toArray:function(o){var items=this._getItemsAsjQuery(o&&o.connected),ret=[];o=o||{};items.each(function(){ret.push($(o.item||this).attr(o.attribute||"id")||"")});return ret},_intersectsWith:function(item){var x1=this.positionAbs.left,x2=x1+this.helperProportions.width,y1=this.positionAbs.top,y2=y1+this.helperProportions.height,l=item.left,r=l+item.width,t=item.top,b=t+item.height,dyClick=this.offset.click.top,dxClick=this.offset.click.left,isOverElementHeight="x"===this.options.axis||y1+dyClick>t&&b>y1+dyClick,isOverElementWidth="y"===this.options.axis||x1+dxClick>l&&r>x1+dxClick,isOverElement=isOverElementHeight&&isOverElementWidth;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>item[this.floating?"width":"height"]?isOverElement:l<x1+this.helperProportions.width/2&&x2-this.helperProportions.width/2<r&&t<y1+this.helperProportions.height/2&&y2-this.helperProportions.height/2<b},_intersectsWithPointer:function(item){var isOverElementHeight="x"===this.options.axis||isOverAxis(this.positionAbs.top+this.offset.click.top,item.top,item.height),isOverElementWidth="y"===this.options.axis||isOverAxis(this.positionAbs.left+this.offset.click.left,item.left,item.width),isOverElement=isOverElementHeight&&isOverElementWidth,verticalDirection=this._getDragVerticalDirection(),horizontalDirection=this._getDragHorizontalDirection();return isOverElement?this.floating?horizontalDirection&&"right"===horizontalDirection||"down"===verticalDirection?2:1:verticalDirection&&("down"===verticalDirection?2:1):!1
},_intersectsWithSides:function(item){var isOverBottomHalf=isOverAxis(this.positionAbs.top+this.offset.click.top,item.top+item.height/2,item.height),isOverRightHalf=isOverAxis(this.positionAbs.left+this.offset.click.left,item.left+item.width/2,item.width),verticalDirection=this._getDragVerticalDirection(),horizontalDirection=this._getDragHorizontalDirection();return this.floating&&horizontalDirection?"right"===horizontalDirection&&isOverRightHalf||"left"===horizontalDirection&&!isOverRightHalf:verticalDirection&&("down"===verticalDirection&&isOverBottomHalf||"up"===verticalDirection&&!isOverBottomHalf)},_getDragVerticalDirection:function(){var delta=this.positionAbs.top-this.lastPositionAbs.top;return 0!==delta&&(delta>0?"down":"up")},_getDragHorizontalDirection:function(){var delta=this.positionAbs.left-this.lastPositionAbs.left;return 0!==delta&&(delta>0?"right":"left")},refresh:function(event){this._refreshItems(event);this.refreshPositions();return this},_connectWith:function(){var options=this.options;return options.connectWith.constructor===String?[options.connectWith]:options.connectWith},_getItemsAsjQuery:function(connected){var i,j,cur,inst,items=[],queries=[],connectWith=this._connectWith();if(connectWith&&connected)for(i=connectWith.length-1;i>=0;i--){cur=$(connectWith[i]);for(j=cur.length-1;j>=0;j--){inst=$.data(cur[j],this.widgetFullName);inst&&inst!==this&&!inst.options.disabled&&queries.push([$.isFunction(inst.options.items)?inst.options.items.call(inst.element):$(inst.options.items,inst.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),inst])}}queries.push([$.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):$(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]);for(i=queries.length-1;i>=0;i--)queries[i][0].each(function(){items.push(this)});return $(items)},_removeCurrentsFromItems:function(){var list=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=$.grep(this.items,function(item){for(var j=0;j<list.length;j++)if(list[j]===item.item[0])return!1;return!0})},_refreshItems:function(event){this.items=[];this.containers=[this];var i,j,cur,inst,targetData,_queries,item,queriesLength,items=this.items,queries=[[$.isFunction(this.options.items)?this.options.items.call(this.element[0],event,{item:this.currentItem}):$(this.options.items,this.element),this]],connectWith=this._connectWith();if(connectWith&&this.ready)for(i=connectWith.length-1;i>=0;i--){cur=$(connectWith[i]);for(j=cur.length-1;j>=0;j--){inst=$.data(cur[j],this.widgetFullName);if(inst&&inst!==this&&!inst.options.disabled){queries.push([$.isFunction(inst.options.items)?inst.options.items.call(inst.element[0],event,{item:this.currentItem}):$(inst.options.items,inst.element),inst]);this.containers.push(inst)}}}for(i=queries.length-1;i>=0;i--){targetData=queries[i][1];_queries=queries[i][0];for(j=0,queriesLength=_queries.length;queriesLength>j;j++){item=$(_queries[j]);item.data(this.widgetName+"-item",targetData);items.push({item:item,instance:targetData,width:0,height:0,left:0,top:0})}}},refreshPositions:function(fast){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var i,item,t,p;for(i=this.items.length-1;i>=0;i--){item=this.items[i];if(item.instance===this.currentContainer||!this.currentContainer||item.item[0]===this.currentItem[0]){t=this.options.toleranceElement?$(this.options.toleranceElement,item.item):item.item;if(!fast){item.width=t.outerWidth();item.height=t.outerHeight()}p=t.offset();item.left=p.left;item.top=p.top}}if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(i=this.containers.length-1;i>=0;i--){p=this.containers[i].element.offset();this.containers[i].containerCache.left=p.left;this.containers[i].containerCache.top=p.top;this.containers[i].containerCache.width=this.containers[i].element.outerWidth();this.containers[i].containerCache.height=this.containers[i].element.outerHeight()}return this},_createPlaceholder:function(that){that=that||this;var className,o=that.options;if(!o.placeholder||o.placeholder.constructor===String){className=o.placeholder;o.placeholder={element:function(){var nodeName=that.currentItem[0].nodeName.toLowerCase(),element=$("<"+nodeName+">",that.document[0]).addClass(className||that.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");"tr"===nodeName?that.currentItem.children().each(function(){$("<td>&#160;</td>",that.document[0]).attr("colspan",$(this).attr("colspan")||1).appendTo(element)}):"img"===nodeName&&element.attr("src",that.currentItem.attr("src"));className||element.css("visibility","hidden");return element},update:function(container,p){if(!className||o.forcePlaceholderSize){p.height()||p.height(that.currentItem.innerHeight()-parseInt(that.currentItem.css("paddingTop")||0,10)-parseInt(that.currentItem.css("paddingBottom")||0,10));p.width()||p.width(that.currentItem.innerWidth()-parseInt(that.currentItem.css("paddingLeft")||0,10)-parseInt(that.currentItem.css("paddingRight")||0,10))}}}}that.placeholder=$(o.placeholder.element.call(that.element,that.currentItem));that.currentItem.after(that.placeholder);o.placeholder.update(that,that.placeholder)},_contactContainers:function(event){var i,j,dist,itemWithLeastDistance,posProperty,sizeProperty,base,cur,nearBottom,floating,innermostContainer=null,innermostIndex=null;for(i=this.containers.length-1;i>=0;i--)if(!$.contains(this.currentItem[0],this.containers[i].element[0]))if(this._intersectsWith(this.containers[i].containerCache)){if(innermostContainer&&$.contains(this.containers[i].element[0],innermostContainer.element[0]))continue;innermostContainer=this.containers[i];innermostIndex=i}else if(this.containers[i].containerCache.over){this.containers[i]._trigger("out",event,this._uiHash(this));this.containers[i].containerCache.over=0}if(innermostContainer)if(1===this.containers.length){if(!this.containers[innermostIndex].containerCache.over){this.containers[innermostIndex]._trigger("over",event,this._uiHash(this));this.containers[innermostIndex].containerCache.over=1}}else{dist=1e4;itemWithLeastDistance=null;floating=innermostContainer.floating||isFloating(this.currentItem);posProperty=floating?"left":"top";sizeProperty=floating?"width":"height";base=this.positionAbs[posProperty]+this.offset.click[posProperty];for(j=this.items.length-1;j>=0;j--)if($.contains(this.containers[innermostIndex].element[0],this.items[j].item[0])&&this.items[j].item[0]!==this.currentItem[0]&&(!floating||isOverAxis(this.positionAbs.top+this.offset.click.top,this.items[j].top,this.items[j].height))){cur=this.items[j].item.offset()[posProperty];nearBottom=!1;if(Math.abs(cur-base)>Math.abs(cur+this.items[j][sizeProperty]-base)){nearBottom=!0;cur+=this.items[j][sizeProperty]}if(Math.abs(cur-base)<dist){dist=Math.abs(cur-base);itemWithLeastDistance=this.items[j];this.direction=nearBottom?"up":"down"}}if(!itemWithLeastDistance&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[innermostIndex])return;itemWithLeastDistance?this._rearrange(event,itemWithLeastDistance,null,!0):this._rearrange(event,null,this.containers[innermostIndex].element,!0);this._trigger("change",event,this._uiHash());this.containers[innermostIndex]._trigger("change",event,this._uiHash(this));this.currentContainer=this.containers[innermostIndex];this.options.placeholder.update(this.currentContainer,this.placeholder);this.containers[innermostIndex]._trigger("over",event,this._uiHash(this));this.containers[innermostIndex].containerCache.over=1}},_createHelper:function(event){var o=this.options,helper=$.isFunction(o.helper)?$(o.helper.apply(this.element[0],[event,this.currentItem])):"clone"===o.helper?this.currentItem.clone():this.currentItem;helper.parents("body").length||$("parent"!==o.appendTo?o.appendTo:this.currentItem[0].parentNode)[0].appendChild(helper[0]);helper[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")});(!helper[0].style.width||o.forceHelperSize)&&helper.width(this.currentItem.width());(!helper[0].style.height||o.forceHelperSize)&&helper.height(this.currentItem.height());return helper},_adjustOffsetFromHelper:function(obj){"string"==typeof obj&&(obj=obj.split(" "));$.isArray(obj)&&(obj={left:+obj[0],top:+obj[1]||0});"left"in obj&&(this.offset.click.left=obj.left+this.margins.left);"right"in obj&&(this.offset.click.left=this.helperProportions.width-obj.right+this.margins.left);"top"in obj&&(this.offset.click.top=obj.top+this.margins.top);"bottom"in obj&&(this.offset.click.top=this.helperProportions.height-obj.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var po=this.offsetParent.offset();if("absolute"===this.cssPosition&&this.scrollParent[0]!==document&&$.contains(this.scrollParent[0],this.offsetParent[0])){po.left+=this.scrollParent.scrollLeft();po.top+=this.scrollParent.scrollTop()}(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&$.ui.ie)&&(po={top:0,left:0});return{top:po.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:po.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var p=this.currentItem.position();return{top:p.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:p.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var ce,co,over,o=this.options;"parent"===o.containment&&(o.containment=this.helper[0].parentNode);("document"===o.containment||"window"===o.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,$("document"===o.containment?document:window).width()-this.helperProportions.width-this.margins.left,($("document"===o.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]);if(!/^(document|window|parent)$/.test(o.containment)){ce=$(o.containment)[0];co=$(o.containment).offset();over="hidden"!==$(ce).css("overflow");this.containment=[co.left+(parseInt($(ce).css("borderLeftWidth"),10)||0)+(parseInt($(ce).css("paddingLeft"),10)||0)-this.margins.left,co.top+(parseInt($(ce).css("borderTopWidth"),10)||0)+(parseInt($(ce).css("paddingTop"),10)||0)-this.margins.top,co.left+(over?Math.max(ce.scrollWidth,ce.offsetWidth):ce.offsetWidth)-(parseInt($(ce).css("borderLeftWidth"),10)||0)-(parseInt($(ce).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,co.top+(over?Math.max(ce.scrollHeight,ce.offsetHeight):ce.offsetHeight)-(parseInt($(ce).css("borderTopWidth"),10)||0)-(parseInt($(ce).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top]}},_convertPositionTo:function(d,pos){pos||(pos=this.position);var mod="absolute"===d?1:-1,scroll="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&$.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,scrollIsRootNode=/(html|body)/i.test(scroll[0].tagName);return{top:pos.top+this.offset.relative.top*mod+this.offset.parent.top*mod-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():scrollIsRootNode?0:scroll.scrollTop())*mod,left:pos.left+this.offset.relative.left*mod+this.offset.parent.left*mod-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():scrollIsRootNode?0:scroll.scrollLeft())*mod}},_generatePosition:function(event){var top,left,o=this.options,pageX=event.pageX,pageY=event.pageY,scroll="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&$.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,scrollIsRootNode=/(html|body)/i.test(scroll[0].tagName);"relative"!==this.cssPosition||this.scrollParent[0]!==document&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset());if(this.originalPosition){if(this.containment){event.pageX-this.offset.click.left<this.containment[0]&&(pageX=this.containment[0]+this.offset.click.left);event.pageY-this.offset.click.top<this.containment[1]&&(pageY=this.containment[1]+this.offset.click.top);event.pageX-this.offset.click.left>this.containment[2]&&(pageX=this.containment[2]+this.offset.click.left);event.pageY-this.offset.click.top>this.containment[3]&&(pageY=this.containment[3]+this.offset.click.top)}if(o.grid){top=this.originalPageY+Math.round((pageY-this.originalPageY)/o.grid[1])*o.grid[1];pageY=this.containment?top-this.offset.click.top>=this.containment[1]&&top-this.offset.click.top<=this.containment[3]?top:top-this.offset.click.top>=this.containment[1]?top-o.grid[1]:top+o.grid[1]:top;left=this.originalPageX+Math.round((pageX-this.originalPageX)/o.grid[0])*o.grid[0];pageX=this.containment?left-this.offset.click.left>=this.containment[0]&&left-this.offset.click.left<=this.containment[2]?left:left-this.offset.click.left>=this.containment[0]?left-o.grid[0]:left+o.grid[0]:left}}return{top:pageY-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():scrollIsRootNode?0:scroll.scrollTop()),left:pageX-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():scrollIsRootNode?0:scroll.scrollLeft())}},_rearrange:function(event,i,a,hardRefresh){a?a[0].appendChild(this.placeholder[0]):i.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?i.item[0]:i.item[0].nextSibling);this.counter=this.counter?++this.counter:1;var counter=this.counter;this._delay(function(){counter===this.counter&&this.refreshPositions(!hardRefresh)})},_clear:function(event,noPropagation){this.reverting=!1;var i,delayedTriggers=[];!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem);this._noFinalSort=null;if(this.helper[0]===this.currentItem[0]){for(i in this._storedCSS)("auto"===this._storedCSS[i]||"static"===this._storedCSS[i])&&(this._storedCSS[i]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();this.fromOutside&&!noPropagation&&delayedTriggers.push(function(event){this._trigger("receive",event,this._uiHash(this.fromOutside))});!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||noPropagation||delayedTriggers.push(function(event){this._trigger("update",event,this._uiHash())});if(this!==this.currentContainer&&!noPropagation){delayedTriggers.push(function(event){this._trigger("remove",event,this._uiHash())});delayedTriggers.push(function(c){return function(event){c._trigger("receive",event,this._uiHash(this))}}.call(this,this.currentContainer));delayedTriggers.push(function(c){return function(event){c._trigger("update",event,this._uiHash(this))}}.call(this,this.currentContainer))}for(i=this.containers.length-1;i>=0;i--){noPropagation||delayedTriggers.push(function(c){return function(event){c._trigger("deactivate",event,this._uiHash(this))}}.call(this,this.containers[i]));if(this.containers[i].containerCache.over){delayedTriggers.push(function(c){return function(event){c._trigger("out",event,this._uiHash(this))}}.call(this,this.containers[i]));this.containers[i].containerCache.over=0}}if(this.storedCursor){this.document.find("body").css("cursor",this.storedCursor);this.storedStylesheet.remove()}this._storedOpacity&&this.helper.css("opacity",this._storedOpacity);this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex);this.dragging=!1;if(this.cancelHelperRemoval){if(!noPropagation){this._trigger("beforeStop",event,this._uiHash());for(i=0;i<delayedTriggers.length;i++)delayedTriggers[i].call(this,event);this._trigger("stop",event,this._uiHash())}this.fromOutside=!1;return!1}noPropagation||this._trigger("beforeStop",event,this._uiHash());this.placeholder[0].parentNode.removeChild(this.placeholder[0]);this.helper[0]!==this.currentItem[0]&&this.helper.remove();this.helper=null;if(!noPropagation){for(i=0;i<delayedTriggers.length;i++)delayedTriggers[i].call(this,event);this._trigger("stop",event,this._uiHash())}this.fromOutside=!1;return!0},_trigger:function(){$.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(_inst){var inst=_inst||this;return{helper:inst.helper,placeholder:inst.placeholder||$([]),position:inst.position,originalPosition:inst.originalPosition,offset:inst.positionAbs,item:inst.currentItem,sender:_inst?_inst.element:null}}})}(jQuery);define("jquery.ui.sortable",["jquery.ui.widget","jquery.ui.mouse","jquery.ui.draggable","jquery.ui.droppable"],function(){});define("splunkjs/mvc/simpleform/edit/staticoptionscontrol",["require","exports","module","underscore","jquery","util/console","../../../mvc","views/Base","views/shared/controls/TextControl","jquery.ui.sortable"],function(require,exports,module){var _=require("underscore"),$=require("jquery"),Base=(require("util/console"),require("../../../mvc"),require("views/Base")),TextControl=require("views/shared/controls/TextControl"),StaticOptionsControl=(require("jquery.ui.sortable"),Base.extend({moduleId:module.id,initialize:function(){Base.prototype.initialize.apply(this,arguments);this._optionsModel=this.options.controlOptions&&this.options.controlOptions.model;this._optionsAttribute=this.options.controlOptions&&this.options.controlOptions.modelAttribute;this._optionPairMap={}},events:{"click a.static-options-add":function(e){e.preventDefault();this._addOptionPair()}},render:function(){this.$el.html(this.compiledTemplate({_:_}));var optionList=this._optionsModel&&this._optionsAttribute?this._optionsModel.get(this._optionsAttribute):null;if(optionList&&optionList.length)for(var i=0,l=optionList.length;l>i;i++)this._addOptionPair(optionList[i]);else this._addOptionPair();this._updateValue();{var self=this;this.$(".static-options-body").sortable({handle:".drag-handle",tolerance:"pointer"}).on("sortupdate",function(){self._updateValue()}).on("stop",function(){self._updateValue()})}return this},_addOptionPair:function(options){var pair=new OptionPair(options||{});pair.on("change",this._updateValue,this);pair.on("click:remove",function(){this._removeOptionPair(pair)},this);this.$(".static-options-body").append(pair.render().$el);this._optionPairMap[pair.cid]=pair},_removeOptionPair:function(pair){delete this._optionPairMap[pair.cid];pair.remove();this._updateValue();0===this.$(".static-option-pair").length&&this._addOptionPair()},_updateValue:function(){for(var optionPairCid,optionPair,optionLabel,optionValue,value=[],optionPairList=this.$(".static-option-pair").removeClass("error"),optionPairMap=this._optionPairMap,optionDupesMap={},i=0,l=optionPairList.length;l>i;i++){optionPairCid=$(optionPairList[i]).data("cid");if(optionPairCid){optionPair=optionPairMap[optionPairCid];if(optionPair){optionLabel=optionPair.getLabel();optionValue=optionPair.getValue();(optionLabel||optionValue)&&value.push({label:optionLabel,value:optionValue});if(optionValue){(!optionLabel||_.has(optionDupesMap,optionValue))&&optionPair.$el.addClass("error");optionDupesMap[optionValue]=!0}}}}this._optionsModel&&this._optionsAttribute&&this._optionsModel.set(this._optionsAttribute,value)},template:'            <div class="static-options-heading">                <div class="static-options-heading-name"><%- _("Name").t() %></div>                <div class="static-options-heading-value"><%- _("Value").t() %></div>            </div>            <div class="static-options-body">            </div>            <a class="static-options-add btn-link pull-right" href="#"><%- _("Add Option").t() %></a>        '})),OptionPair=Base.extend({className:"static-option-pair control-group",initialize:function(){Base.prototype.initialize.apply(this,arguments);this._labelControl=new TextControl({defaultValue:this.options.label||""});this._labelControl.on("change",this._notifyChange,this);this._valueControl=new TextControl({defaultValue:this.options.value||""});this._valueControl.on("change",this._notifyChange,this)},events:{"click a.static-option-remove":function(e){e.preventDefault();this.trigger("click:remove")}},getLabel:function(){return this._labelControl.getValue()},setLabel:function(value){this._labelControl.setValue(value)},getValue:function(){return this._valueControl.getValue()},setValue:function(value){this._valueControl.setValue(value)},render:function(){this.$el.append($(this.template));this.$(".static-option-label").append(this._labelControl.render().$el);this.$(".static-option-value").append(this._valueControl.render().$el);return this},_notifyChange:function(){this.trigger("change")},template:'            <div class="drag-handle"></div>            <div class="static-option-label"></div>            <div class="static-option-value"></div>            <a class="static-option-remove btn-link" href="#"><i class="icon-x-circle"></i></a>        '});return StaticOptionsControl});define("views/shared/timerangepicker/Master",["jquery","underscore","module","views/Base","views/shared/timerangepicker/dialog/Master","views/shared/delegates/Popdown","collections/SplunkDsBase","splunk.util","util/console"],function($,_,module,Base,Dialog,Popdown,SplunkDsBaseCollection,splunk_util,console){return Base.extend({moduleId:module.id,className:"btn-group",initialize:function(options){var defaults={timerangeClassName:"btn"};_.defaults(this.options,defaults);Base.prototype.initialize.call(this,options);this.children.dialog=new Dialog($.extend({model:{timeRange:this.model.timeRange,user:this.model.user,appLocal:this.model.appLocal,application:this.model.application},collection:this.collection},this.options.dialogOptions||{}));this.activate({skipSetLabel:!0})},startListening:function(){this.collection&&this.listenTo(this.collection,"reset",function(){console.warn("timerangepicker setting label because of collection reset");this.setLabel()});this.listenToModels()},listenToModels:function(){this.listenTo(this.model.timeRange,"change:earliest change:latest",_.debounce(function(){this.active&&this.timeRangeChange()},0));this.listenTo(this.model.timeRange,"applied",this.timeRangeApplied);this.listenTo(this.model.timeRange,"change:earliest_epoch change:latest_epoch change:earliest change:latest",_.debounce(function(){this.active&&this.setLabel()},0));this.listenTo(this.model.state,"change:dispatch.earliest_time change:dispatch.latest_time",_.debounce(function(){this.active&&this.stateChange()},0))},stopListeningToModels:function(){this.stopListening(this.model.timeRange);this.stopListening(this.model.state)},activate:function(options){options=options||{};if(this.active)return Base.prototype.activate.apply(this,arguments);options.skipSetLabel||this.setLabel();Base.prototype.activate.apply(this,arguments);this.model.timeRange.trigger("prepopulate");return this},stateChange:function(){this.stopListeningToModels();this.model.timeRange.clear({silent:!0,setDefaults:!0});this.model.timeRange.save({earliest:this.model.state.get("dispatch.earliest_time"),latest:this.model.state.get("dispatch.latest_time")},{wait:!0,success:function(){this.listenToModels();this.setLabel()}.bind(this),error:function(){this.listenToModels();this.setLabel()}.bind(this)})},timeRangeChange:function(){this.stopListeningToModels();this.model.state.set({"dispatch.earliest_time":this.model.timeRange.get("earliest"),"dispatch.latest_time":this.model.timeRange.get("latest")});this.listenToModels()},timeRangeApplied:function(){this.children.popdown.hide();this.model.state.trigger("applied",{silent:splunk_util.normalizeBoolean(this.model.state.get("disable_timerange_trigger"))})},setLabel:function(){if(this.$el.html()){var timeLabel=this.model.timeRange.generateLabel(this.collection||new SplunkDsBaseCollection);this.$el.children("a").find(".time-label").text(_(timeLabel).t()).attr("title",_(timeLabel).t())}},render:function(){if(this.$el.html())return this;this.$el.html(this.compiledTemplate({options:this.options}));this.children.dialog.render().appendTo(this.$(".popdown-dialog"));this.children.popdown=new Popdown(_.extend({el:this.el,toggle:"> a",mode:"dialog",attachDialogTo:"body",ignoreClasses:["ui-datepicker","ui-datepicker-header","dropdown-menu"]},this.options.popdownOptions||{}));this.children.popdown.on("shown",function(){if(this.children.dialog.$(".accordion-group.active").length)this.children.dialog.onShown();else{var timePanel="presets";this.children.dialog.children[timePanel].$el.closest(".accordion-group").find(".accordion-toggle").first().click();this.children.dialog.onShown()}},this);this.setLabel();return this},template:'                <a class=" splBorder splBorder-nsew splBackground-primary <%- options.timerangeClassName %>" href="#"><span class="time-label"></span><span class="caret"></span></a>                <div class="popdown-dialog">                    <div class="arrow"></div>                </div>                '})});define("collections/shared/Times",["collections/services/data/ui/Times","underscore"],function(TimesCollection,_){var SharedTimesCollection=TimesCollection.extend({},{createFromPresets:function(presets){var entries=[];_.each(presets,function(preset){var id=_.uniqueId("time_");entries.push({name:id,id:id,links:{},author:"nobody",acl:{},content:preset})});var collection=new TimesCollection;collection.setFromSplunkD({links:{create:"/services/data/ui/times/_new",_reload:"/services/data/ui/times/_reload"},origin:"",updated:"",generator:{},entry:entries});return collection}});return SharedTimesCollection});requirejs.s.contexts._.nextTick=function(f){f()};require(["css"],function(css){css.addBuffer("splunkjs/css/timerange-picker.css")});requirejs.s.contexts._.nextTick=requirejs.nextTick;define("splunkjs/mvc/timerangeview",["require","exports","module","underscore","./mvc","backbone","./basesplunkview","util/console","views/shared/timerangepicker/Master","collections/shared/Times","models/shared/TimeRange","./tokenutils","./utils","./sharedmodels","css!../css/timerange-picker"],function(require,exports,module){var _=require("underscore"),mvc=require("./mvc"),Backbone=require("backbone"),BaseSplunkView=require("./basesplunkview"),console=require("util/console"),InternalTimeRangePicker=require("views/shared/timerangepicker/Master"),SharedTimesCollection=require("collections/shared/Times"),TimeRangeModel=require("models/shared/TimeRange"),TokenUtils=require("./tokenutils"),sharedModels=(require("./utils"),require("./sharedmodels"));require("css!../css/timerange-picker");var TimeRangeView=BaseSplunkView.extend({moduleId:module.id,className:"splunk-timerange",options:{"default":void 0,managerid:null,earliest_time:void 0,latest_time:void 0,preset:void 0,presets:void 0,value:void 0,dialogOptions:{},popdownOptions:{}},initialize:function(){var that=this;this.configure();this.settings.enablePush("value");this.settings.enablePush("earliest_time");this.settings.enablePush("latest_time");this._initializeValue();var initialValue=this.settings.get("value");this._state=new Backbone.Model({"dispatch.earliest_time":void 0!==initialValue?initialValue["earliest_time"]:"","dispatch.latest_time":void 0!==initialValue?initialValue["latest_time"]:""});var appModel=sharedModels.get("app"),userModel=sharedModels.get("user"),appLocalModel=sharedModels.get("appLocal"),timesCollection=void 0!==this.settings.get("presets")?SharedTimesCollection.createFromPresets(this.settings.get("presets")):sharedModels.get("times");this._timesCollection=timesCollection;this._pickerDfd=$.when(timesCollection.dfd,userModel.dfd,appLocalModel.dfd).done(function(){var timeRangeModel=new TimeRangeModel;timeRangeModel.save({earliest:that._state.get("dispatch.earliest_time"),latest:that._state.get("dispatch.latest_time")});that.timepicker=new InternalTimeRangePicker({className:"controls",model:{state:that._state,timeRange:timeRangeModel,user:userModel,appLocal:appLocalModel,application:appModel},collection:timesCollection,dialogOptions:that.settings.get("dialogOptions"),popdownOptions:that.settings.get("popdownOptions")});that._state.on("change:dispatch.earliest_time change:dispatch.latest_time",_.debounce(that._onTimeRangeChange),that)});this._timesCollection.on("change reset",this._onTimePresetUpdate,this);this.settings.on("change:preset",this._onTimePresetUpdate,this);this.settings.on("change:value",function(model,value){that.val(value||{earliest_time:"",latest_time:""})});this.on("change",function(){that.settings.set("value",that._getTimeRange())});this.settings.on("change:default",this._onDefaultChange,this);this.bindToComponentSetting("managerid",this._onManagerChange,this);void 0===this.settings.get("value")&&that._onTimePresetUpdate();this._onReady(_.bind(this.trigger,this,"ready"))},_onReady:function(cb){var dfd=$.Deferred().resolve();if(this.settings.get("preset")&&!this.settings.get("value")){this._presetDfd=$.Deferred();dfd=this._presetDfd.promise()}cb&&dfd.always(cb);return dfd},_initializeValue:function(){var that=this,initialValue=this.settings.get("value");void 0!==initialValue?this.settings.set({earliest_time:initialValue["earliest_time"],latest_time:initialValue["latest_time"]}):void 0!==this.settings.get("earliest_time")||void 0!==this.settings.get("latest_time")?this.settings.set("value",{earliest_time:this.settings.get("earliest_time"),latest_time:this.settings.get("latest_time")}):this.settings.set({value:void 0,earliest_time:void 0,latest_time:void 0});this.settings.on("change:value",function(model,value){value&&that.settings.set({earliest_time:value.earliest_time,latest_time:value.latest_time})});this.settings.on("change:earliest_time change:latest_time",_.debounce(function(){var newValue=_.clone(that.settings.get("value"))||{};newValue.earliest_time=that.settings.get("earliest_time");newValue.latest_time=that.settings.get("latest_time");that.settings.set("value",newValue)}),this);if(TokenUtils.isToken(this.settings.get("value",{tokens:!0}))){var token=TokenUtils.getTokens(this.settings.get("value",{tokens:!0}))[0],settingIsLiteralOrUndefined=function(settingName){return that.settings.get(settingName,{tokens:!0})===that.settings.get(settingName,{tokens:!1})};settingIsLiteralOrUndefined("earliest_time")&&this.settings.set("earliest_time","$"+token.namespace+":"+token.name+".earliest_time$",{tokens:!0});settingIsLiteralOrUndefined("latest_time")&&this.settings.set("latest_time","$"+token.namespace+":"+token.name+".latest_time$",{tokens:!0})}void 0===this.settings.get("value")&&this.settings.set("value",this.settings.get("default"))},_onDefaultChange:function(){var oldDefaultValue=this.settings.previous("default"),defaultValue=this.settings.get("default"),currentValue=this.settings.get("value");void 0===defaultValue||!_.isEqual(currentValue,oldDefaultValue)&&void 0!==currentValue||this.settings.set("value",defaultValue)},_onTimePresetUpdate:function(){var preset=this.settings.get("preset");if(preset){this._presetInFlightCancelled=!1;var that=this;$.when(this._pickerDfd).done(function(){var timeModel=that._timesCollection.find(function(model){return model.entry.content.get("label")===preset});if(timeModel)that._presetInFlightCancelled||that.val({earliest_time:timeModel.entry.content.get("earliest_time"),latest_time:timeModel.entry.content.get("latest_time")});
else{console.warn('Could not find matching preset "'+preset+'" for time range view.');that.val({earliest_time:"0",latest_time:""})}this._presetDfd&&this._presetDfd.resolve()})}},_onManagerChange:function(managers,manager){if(this.manager){this.manager.off(null,null,this);this.manager=null}this.manager=manager;if(manager.search){this.listenTo(manager.search,"change:earliest_time change:latest_time",_.debounce(this._onManagerTimeRangeChange));this._onManagerTimeRangeChange()}},_onManagerTimeRangeChange:function(){var timeRange=this.val();timeRange.earliest_time=this.manager.settings.get("earliest_time")||timeRange.earliest_time;timeRange.latest_time=this.manager.settings.get("latest_time")||timeRange.latest_time;this.val(timeRange)},_onTimeRangeChange:function(model,value,options){(!options||options&&!options._self)&&this.trigger("change",this._getTimeRange(),this)},render:function(){var that=this;$.when(this._pickerDfd).done(function(){that.timepicker.render();that.$el.append(that.timepicker.el)});return this},val:function(newValue){if(0===arguments.length)return this._getTimeRange();newValue=newValue||{earliest_time:void 0,latest_time:void 0};var oldValue=this.val();this._setTimeRange(newValue);var realNewValue=this.val();_.isEqual(realNewValue,oldValue)||this.trigger("change",realNewValue,this);this._presetInFlightCancelled=!0;return this._getTimeRange()},_hasValueForDashboards:function(){var value=this.settings.get("value"),defaultValue=this.settings.get("default"),valueIsDefined=void 0!==value&&null!==value;return valueIsDefined||void 0===defaultValue||value===defaultValue},_setTimeRange:function(value){this._state.set({"dispatch.earliest_time":value.earliest_time,"dispatch.latest_time":value.latest_time},{_self:!0})},_getTimeRange:function(){return{earliest_time:this._state.get("dispatch.earliest_time"),latest_time:this._state.get("dispatch.latest_time")}},remove:function(){var that=this;$.when(this._pickerDfd).done(function(){that.timepicker.remove()});mvc.Components.revokeInstance(this.id);BaseSplunkView.prototype.remove.apply(this,arguments)}});return TimeRangeView});define("splunkjs/mvc/simpleform/edit/dynamicoptionscontrol",["require","exports","module","underscore","jquery","backbone","util/console","../../../mvc","views/Base","views/shared/controls/ControlGroup","../../simplexml/controller","../../simplexml/dialog/addpanel/report","../../timerangeview","../../utils","uri/route","util/time","bootstrap.tooltip"],function(require,exports,module){{var _=require("underscore"),Backbone=(require("jquery"),require("backbone")),Base=(require("util/console"),require("../../../mvc"),require("views/Base")),ControlGroup=require("views/shared/controls/ControlGroup"),Dashboard=require("../../simplexml/controller"),ReportForm=require("../../simplexml/dialog/addpanel/report"),TimeRangeView=require("../../timerangeview"),utils=require("../../utils"),route=require("uri/route");require("util/time")}require("bootstrap.tooltip");var DynamicOptionsControl=Base.extend({moduleId:module.id,initialize:function(){Base.prototype.initialize.apply(this,arguments);this._optionsModel=this.options.controlOptions&&this.options.controlOptions.model||new Backbone.Model;this._optionsModelProxy=new Backbone.Model;this.listenTo(this._optionsModel,"change",this.onOptionsModelChange,this);this.listenTo(this._optionsModelProxy,"change",this.onProxyModelChange,this);this.onOptionsModelChange();this.children.elementCreateType=new ControlGroup({label:_("Content Type").t(),controlType:"SyntheticRadio",controlClass:"controls-thirdblock",controlOptions:{className:"btn-group btn-group-3 add-panel-select",items:[{value:"inline",label:'<i class="icon-search-thin"></i>',tooltip:_("Inline Search").t()},{value:"saved",label:'<i class="icon-report"></i>',tooltip:_("Report").t()}],model:this._optionsModelProxy,modelAttribute:"elementCreateType"}});this.children.inline=new InlineForm({model:this._optionsModelProxy,collection:{timeRanges:Dashboard.collection.times}});this.children.report=new ReportForm({model:this._optionsModelProxy,collection:{timeRanges:Dashboard.collection.times},controller:Dashboard,popdownOptions:{attachDialogTo:".popdown-dialog.open",scrollContainer:".popdown-dialog.open .concertina-body"}})},onOptionsModelChange:function(){if(!this._isProxySyncing)try{this._isProxySyncing=!0;this._optionsModelProxy.set({elementCreateType:this._optionsModel.get("searchType")||"inline",savedSearchName:this._optionsModel.get("searchName"),search:this._optionsModel.get("search"),earliest_time:this._optionsModel.get("earliest_time"),latest_time:this._optionsModel.get("latest_time")})}finally{this._isProxySyncing=!1}},onProxyModelChange:function(){if(!this._isProxySyncing)try{this._isProxySyncing=!0;this._optionsModel.set({searchType:this._optionsModelProxy.get("elementCreateType"),searchName:this._optionsModelProxy.get("savedSearchName"),search:this._optionsModelProxy.get("search"),earliest_time:this._optionsModelProxy.get("earliest_time"),latest_time:this._optionsModelProxy.get("latest_time")})}finally{this._isProxySyncing=!1}},render:function(){this.$el.append(this.children.elementCreateType.render().el);this.$el.append(this.children.inline.render().el);this.$el.append(this.children.report.render().el);return this}}),InlineForm=Base.extend({initialize:function(){Base.prototype.initialize.apply(this,arguments);this.children.searchField=new ControlGroup({controlType:"Textarea",controlOptions:{modelAttribute:"search",model:this.model},label:_("Search String").t(),help:'<a href="#" class="run-search">'+_("Run Search").t()+' <i class="icon-external"></i></a>'});this.children.timeRangeView=new TimeRangeView({popdownOptions:{attachDialogTo:".popdown-dialog.open",scrollContainer:".popdown-dialog.open .concertina-body"}});this.children.timeRangeView.val({earliest_time:this.model.get("earliest_time"),latest_time:this.model.get("latest_time")});this.listenTo(this.model,"change:elementCreateType",this.onModeChange,this);this.listenTo(this.children.timeRangeView,"change",this.onTimeRangeChange,this)},events:{"click a.run-search":function(e){e.preventDefault();var search=this.model.get("search"),params={q:search},pageInfo=utils.getPageInfo();if(search){if(this.model.has("dispatch.earliest_time")){params.earliest=this.model.get("dispatch.earliest_time");params.latest=this.model.get("dispatch.latest_time")}utils.redirect(route.search(pageInfo.root,pageInfo.locale,pageInfo.app,{data:params}),!0)}}},onModeChange:function(){var fn="inline"===this.model.get("elementCreateType")?"show":"hide";this.$el[fn]()},onTimeRangeChange:function(){this.model.set(this.children.timeRangeView.val())},render:function(){this.children.searchField.render().appendTo(this.el);this.children.timeRangeView.render().$el.appendTo(this.el);this.onModeChange();return this}});return DynamicOptionsControl});define("splunkjs/mvc/simpleform/edit/defaultcontrol",["require","exports","module","underscore","jquery","util/console","../../../mvc","../inputsettings","views/shared/controls/ControlGroup"],function(require,exports,module){var _=require("underscore"),$=require("jquery"),Settings=(require("util/console"),require("../../../mvc"),require("../inputsettings")),ControlGroup=require("views/shared/controls/ControlGroup"),DefaultControl=ControlGroup.extend({moduleId:module.id,initialize:function(){this._optionsModel=this.options.controlOptions&&this.options.controlOptions.model;this._optionsAttribute=this.options.controlOptions&&this.options.controlOptions.modelAttribute;this._optionsModelProxy=new Settings($.extend(!0,{},this._optionsModel?this._optionsModel.toJSON():{}));this.options.controlOptions&&this._optionsModelProxy.set(this.options.controlOptions);if(this._optionsModel&&this._optionsAttribute){this._optionsModelProxy.set("value",this._optionsModel.get(this._optionsAttribute));this.listenTo(this._optionsModel,"change",this.onOptionsModelChange,this);this.listenTo(this._optionsModelProxy,"change:value",this.onProxyValueChange,this)}var inputTypeClass=this.options.inputTypeClass;inputTypeClass&&(this.options.controls=[new inputTypeClass({settings:this._optionsModelProxy})]);ControlGroup.prototype.initialize.apply(this,arguments)},events:{"click a.default-clear-selection":function(e){e.preventDefault();this._optionsModelProxy.set("value",null)}},render:function(){ControlGroup.prototype.render.apply(this,arguments);if(this.options.enableClearSelection){this._clearSelectionButton||(this._clearSelectionButton=$(_.template(this.clearSelectionTemplate,{_:_})));this.$(".controls").append(this._clearSelectionButton)}return this},onOptionsModelChange:function(){if(!this._isProxySyncing)try{this._isProxySyncing=!0;var changed=$.extend(!0,{},this._optionsModel.changed);delete changed["value"];this._optionsModelProxy.set(changed)}finally{this._isProxySyncing=!1}},onProxyValueChange:function(){if(!this._isProxySyncing)try{this._isProxySyncing=!0;this._optionsModel.set(this._optionsAttribute,this._optionsModelProxy.get("value"))}finally{this._isProxySyncing=!1}},clearSelectionTemplate:'            <a class="default-clear-selection btn-link" href="#"><%- _("Clear Selection").t() %></a>        '});return DefaultControl});define("splunkjs/mvc/simpleform/edit/tokenpreviewcontrol",["require","exports","module","underscore","jquery","util/console","../../../mvc","views/shared/controls/ControlGroup"],function(require,exports,module){var _=require("underscore"),ControlGroup=(require("jquery"),require("util/console"),require("../../../mvc"),require("views/shared/controls/ControlGroup")),TokenPreviewControl=ControlGroup.extend({moduleId:module.id,initialize:function(){this.options=_.extend({controlType:"Label"},this.options);ControlGroup.prototype.initialize.apply(this,arguments);this._optionsModel=this.options.controlOptions&&this.options.controlOptions.model;if(this._optionsModel){this.listenTo(this._optionsModel,"change",this.onOptionsModelChange,this);this.onOptionsModelChange()}},onOptionsModelChange:function(){var prefix=this._optionsModel.get("prefix")||"",suffix=this._optionsModel.get("suffix")||"",valuePrefix=this._optionsModel.get("valuePrefix")||"",valueSuffix=this._optionsModel.get("valueSuffix")||"",delimiter=this._optionsModel.get("delimiter")||"",previewString="";previewString+=prefix;previewString+=valuePrefix+"value1"+valueSuffix;previewString+=delimiter;previewString+=valuePrefix+"value2"+valueSuffix;previewString+=delimiter+"...";previewString+=suffix;this.getAllControls()[0].setValue(previewString)}});return TokenPreviewControl});define("splunkjs/mvc/simplesplunkview",["require","exports","module","underscore","./mvc","./basesplunkview","./messages"],function(require,exports,module){var _=require("underscore"),mvc=require("./mvc"),BaseSplunkView=require("./basesplunkview"),Messages=require("./messages"),SimpleSplunkView=BaseSplunkView.extend({moduleId:module.id,className:null,outputMode:"json_rows",returnCount:0,offset:0,resultOptions:{},data_types:{json_rows:"rows",json_cols:"columns",json:"results"},options:{data:"preview"},initialize:function(){this.configure();this._viz=null;this._data=null;this.bindToComponentSetting("managerid",this._onManagerChange,this);this.manager||this._onManagerChange(mvc.Components,null)},createView:function(){throw new Error("Not implemented error.")},onDataChanged:function(){return this.formatResults.apply(this,arguments)},formatResults:function(resultsModel){if(!resultsModel)return[];var outputMode=this.output_mode||this.outputMode,data_type=this.data_types[outputMode],data=resultsModel.data();return this.formatData(data[data_type])},formatData:function(data){return data},updateView:function(){throw new Error("Not implemented error.")},clearView:function(){this.$el.empty();this._viz=!1},displayMessage:function(info){this._viz=null;Messages.render(info,this.$el);return this},_checkManagerState:function(){var manager=this.manager;if(manager)if(manager.job||!manager.lastError){if(manager.job){var state=manager.job.state();state&&state.content&&(state.content.isDone||state.content.isFailed)&&this._onSearchProgress(state)}}else this._onSearchError(manager.lastError)},_onManagerChange:function(managers,manager){if(this.manager){this.manager.off(null,null,this);this.manager=null}if(this.resultsModel){this.resultsModel.off(null,null,this);this.resultsModel.destroy();this.resultsModel=null}this.manager=manager;if(manager){this._displayMessage("empty");var outputMode=this.output_mode||this.outputMode;this.resultsModel=this.manager.data(this.settings.get("data")||"preview",_.extend({output_mode:outputMode,count:this.returnCount,offset:this.offset},this.resultOptions));manager.on("search:start",this._onSearchStart,this);manager.on("search:progress",this._onSearchProgress,this);manager.on("search:cancelled",this._onSearchCancelled,this);manager.on("search:error",this._onSearchError,this);manager.on("search:fail",this._onSearchFailed,this);this.resultsModel.on("data",this._onDataChanged,this);this.resultsModel.on("error",this._onSearchError,this);this._checkManagerState();manager.replayLastSearchEvent(this)}else this._displayMessage("no-search")},_displayMessage:function(info){return this.displayMessage(info)},render:function(){this._createView(this._data);this.resultsModel&&this._onDataChanged();return this},_createView:function(data){data&&(this._viz||(this._viz=this.createView()))},_updateView:function(){if(this._data&&!_.isEmpty(this._data)){var data=this._data;this._viz||this._createView(data);this._viz&&this.updateView(this._viz,this._data)}},_onDataChanged:function(){if(this.resultsModel.hasData()){this._data=this.onDataChanged(this.resultsModel);this._updateView()}else this._isJobDone&&this._displayMessage("no-results")},_onSearchProgress:function(properties){properties=properties||{};var content=properties.content||{},previewCount=content.resultPreviewCount||0,isJobDone=this._isJobDone=content.isDone||!1;0!==previewCount||this._displayMessage(isJobDone?"no-results":"waiting")},_onSearchStart:function(){this._isJobDone=!1;this._displayMessage("waiting")},_onSearchCancelled:function(){this._isJobDone=!1;this._displayMessage("cancelled")},_onSearchError:function(message,err){this._isJobDone=!1;var msg=Messages.getSearchErrorMessage(err)||message;this._displayMessage({level:"error",icon:"warning-sign",message:msg})},_onSearchFailed:function(state){var msg=Messages.getSearchFailureMessage(state);this._displayMessage({level:"error",icon:"warning-sign",message:msg})}});return SimpleSplunkView});define("splunkjs/mvc/baseinputview",["require","exports","module","underscore","jquery","./simplesplunkview"],function(require){var _=require("underscore"),$=require("jquery"),SimpleSplunkView=require("./simplesplunkview"),BaseInputView=SimpleSplunkView.extend({output_mode:"json",options:{disabled:!1,managerid:null,data:"preview"},initialize:function(){SimpleSplunkView.prototype.initialize.apply(this,arguments);this.settings.enablePush("value");this._onDefaultChange();this.settings.on("change:disabled",this._onDisable,this);this.settings.on("change:default",this._onDefaultChange,this);this._onReady(_.bind(this.trigger,this,"ready"))},_onReady:function(cb){var dfd;if(this.settings.get("managerid")){this._readyDfd=$.Deferred();dfd=this._readyDfd.promise()}else dfd=$.Deferred().resolve();cb&&dfd.always(cb);return dfd},onDataChanged:function(){var ret=SimpleSplunkView.prototype.onDataChanged.apply(this,arguments);this._readyDfd&&this._readyDfd.resolve();return ret},_onSearchProgress:function(properties){SimpleSplunkView.prototype._onSearchProgress.apply(this,arguments);if(this._readyDfd){var content=properties.content||{},previewCount=content.resultPreviewCount||0;content.isDone&&0===previewCount&&this._readyDfd.resolve()}},_onSearchError:function(){this._readyDfd&&this._readyDfd.reject();SimpleSplunkView.prototype._onSearchError.apply(this,arguments)},_onSearchFailed:function(){this._readyDfd&&this._readyDfd.reject();SimpleSplunkView.prototype._onSearchFailed.apply(this,arguments)},_onDefaultChange:function(model){var oldDefaultValue=this.settings.previous("default"),defaultValue=this.settings.get("default"),calledFromConstructor=!model;if(void 0===defaultValue&&calledFromConstructor){var supportsSeedSetting=_.contains(_.keys(this.constructor.prototype.options),"seed");supportsSeedSetting&&(defaultValue=this.settings.get("seed"))}var currentValue=this.settings.get("value");void 0===defaultValue||!_.isEqual(currentValue,oldDefaultValue)&&void 0!==currentValue||this.val(defaultValue)},_onChange:function(){this.trigger("change",this.val(),this)},_onDisable:function(){var state=this.settings.get("disabled");this._disable(state)},_disable:function(state){this.$("input").prop("disabled",state)},render:function(){this._updateView(this._viz,this._data||[]);return this},_updateView:function(){var data=this._data||[];this._viz||this._createView(data);if(this._viz){this.updateView(this._viz,data);this._onDisable()}},createView:function(){return!0},val:function(value,selector){selector=selector||"input";var input=$(selector,this.$el);return value?input.val(value):input.val()},_hasValueForDashboards:function(){var value=this.settings.get("value"),defaultValue=this.settings.get("default"),valueIsDefined=void 0!==value&&null!==value;return valueIsDefined||void 0===defaultValue||value===defaultValue}});return BaseInputView});requirejs.s.contexts._.nextTick=function(f){f()};require(["css"],function(css){css.addBuffer("splunkjs/css/choice.css")});requirejs.s.contexts._.nextTick=requirejs.nextTick;define("splunkjs/mvc/basechoiceview",["require","exports","module","underscore","util/console","./baseinputview","./messages","bootstrap.tooltip","css!../css/choice.css"],function(require){{var _=require("underscore"),console=require("util/console"),BaseInputView=require("./baseinputview"),Messages=require("./messages");require("bootstrap.tooltip")}require("css!../css/choice.css");var BaseChoiceView=BaseInputView.extend({options:{choices:[],selectFirstChoice:!1},initialize:function(){this._baseChoiceViewInitialized=!1;this._$messageEl=this.$(".splunk-choice-input-message span");this.options=_.extend({},BaseInputView.prototype.options,this.options);BaseInputView.prototype.initialize.apply(this,arguments);this.manager=null;this.resultsModel=null;this.settings.on("change:value",this._onValueChange,this);this.settings.on("change:choices change:valueField change:labelField change:default",_.debounce(this.render,0),this);this.settings.enablePush("selectedLabel");this.settings.on("change:value change:choices",this.updateSelectedLabel,this);this._displayedChoices=[];this._baseChoiceViewInitialized=!0;this.updateSelectedLabel()},updateDomVal:function(){throw new Error("Abstract method.  Must override")},updateSelectedLabel:function(){if(this._baseChoiceViewInitialized){var choice=this._findDisplayedChoice(this.val());choice?this.settings.set("selectedLabel",choice.label):this.settings.unset("selectedLabel")}},_onValueChange:function(ctx,value){this.updateDomVal(value);this.updateSelectedLabel(value);this.trigger("change",this.val(),this)},_displayMessage:function(messageName){var info=messageName;_.isString(messageName)&&(info=Messages.resolve(messageName));var message="",originalMessage="";switch(messageName){case"no-events":case"no-results":case"no-stats":message=_("Search produced no results.").t();originalMessage="";this._updateView(this._viz,[]);break;case"waiting":case"waiting-queued":case"waiting-preparing":message=_("Populating...").t();originalMessage="";break;default:if("error"===info.level){message=_("Could not create search.").t();originalMessage=info.message||""}else{message="";originalMessage=""}this._updateView(this._viz,[])}this._$messageEl.text(message);this._$messageEl.attr("title",originalMessage);try{this._$messageEl.tooltip("destroy");this._$messageEl.tooltip({animation:!1})}catch(e){var tooltipIsNotReady=e&&e.message&&e.message.indexOf("cannot call methods on tooltip prior to initialization")>=0;if(!tooltipIsNotReady)throw e}},convertDataToChoices:function(data){data=data||this._data;var valueField=this.settings.get("valueField")||"value",labelField=this.settings.get("labelField")||valueField,choices=Array.prototype.slice.call(this.settings.get("choices")||[]);choices=choices.concat(_.map(data||[],function(row){return{label:row[labelField],value:row[valueField]}}));var originalChoicesLength=choices.length;choices=_.uniq(choices,!1,function(i){return i.value});originalChoicesLength!=choices.length&&console.log("Choice control received search result with duplicate values. Recommend dedupe of data source.");return choices},_updateView:function(viz,data){this._displayedChoices=this.convertDataToChoices(data);if(!this._viz){this._createView(this._displayedChoices);if(!this._viz)return}this.updateView(this._viz,this._displayedChoices);this.updateSelectedLabel();!this._isMultiChoiceView&&this.settings.get("selectFirstChoice")&&void 0===this.val()&&this._displayedChoices.length>=1&&this.val(this._displayedChoices[0].value);if(!this._$messageEl.length){var $messageContainer=$("<div class='splunk-choice-input-message'></div>").appendTo(this.el);this._$messageEl=$("<span></span>").appendTo($messageContainer)}this._$messageEl.text("");this._displayedChoices&&0!==this._displayedChoices.length?this._onDisable():this._disable(!0)},_findDisplayedChoice:function(value){return _.find(this._displayedChoices,function(ch){return ch.value===value})},val:function(newValue){if(0===arguments.length)return this.settings.get("value");newValue!==this.settings.get("value")&&this.settings.set("value",newValue);return this.settings.get("value")},getDisplayedChoices:function(){return this._displayedChoices||[]}});return BaseChoiceView});requirejs.s.contexts._.nextTick=function(f){f()};require(["css"],function(css){css.addBuffer("splunkjs/css/radio.css")});requirejs.s.contexts._.nextTick=requirejs.nextTick;define("splunkjs/mvc/radiogroupview",["require","exports","module","underscore","jquery","./basechoiceview","css!../css/radio.css"],function(require,exports,module){var _=require("underscore"),$=require("jquery"),BaseChoiceView=require("./basechoiceview");require("css!../css/radio.css");var RadioGroupView=BaseChoiceView.extend({moduleId:module.id,className:"splunk-radiogroup splunk-choice-input",options:{valueField:"",labelField:"","default":void 0,choices:[],selectFirstChoice:!1,disabled:!1,value:void 0},events:{"change input:radio":"onDomChange"},initialize:function(){this.options=_.extend({},BaseChoiceView.prototype.options,this.options);BaseChoiceView.prototype.initialize.apply(this,arguments)},_domVal:function(){return this.$("input:radio:checked").val()},onDomChange:function(){this.val(this._domVal())},updateDomVal:function(value){this.$("input:radio").prop("checked",!1);this.$('input:radio[value="'+value+'"]').prop("checked","checked")},createView:function(){this.$el.empty();return $("<fieldset class='splunk-radiogroup-choices'/>").appendTo(this.el)},updateView:function(viz,data){viz.empty();data&&0!==data.length||(data=[{value:"",label:" "}]);var controlValue=this.settings.get("value"),id=this.id;_.each(data||[],function(entry,idx){var itemId=id+String(idx),input=$('<input type="radio" />').attr({name:id,value:entry.value,id:itemId});entry.value==controlValue&&input.prop({checked:"checked"});var choice=$('<div class="choice" />').append(input).append($("<label />").attr("for",itemId).text($.trim(entry.label)||entry.value));viz.append(choice)});return this}});return RadioGroupView});requirejs.s.contexts._.nextTick=function(f){f()};require(["css"],function(css){css.addBuffer("contrib/select2-3.3.1/select2.css")});requirejs.s.contexts._.nextTick=requirejs.nextTick;requirejs.s.contexts._.nextTick=function(f){f()};require(["css"],function(css){css.addBuffer("splunkjs/css/select2.css")});requirejs.s.contexts._.nextTick=requirejs.nextTick;define("splunkjs/mvc/basedropdownviewmixin",["require","exports","module","underscore","jquery","select2/select2","css!contrib/select2-3.3.1/select2.css","css!../css/select2.css"],function(require){{var _=require("underscore"),$=require("jquery");require("select2/select2")}require("css!contrib/select2-3.3.1/select2.css");require("css!../css/select2.css");var BaseDropdownViewMixin={options:{managerid:null,valueField:"",labelField:"",choices:[],selectFirstChoice:!1,"default":void 0,width:200,minimumResultsForSearch:8,showClearButton:!0,disabled:!1,value:void 0},events:{"change select":"onDomChange","selected select":"onDomChange"},_setSelect2Value:function(value){var valueAsArray=this.valueIsList?value:[value],selectedObject={};_.each(this._vizData,function(row){_.contains(valueAsArray,row.value)&&(selectedObject[row.value]=$.trim(row.label)||row.value)});var selectedValues=_(valueAsArray).map(function(val){return{id:val,text:selectedObject[val]}});this.valueIsList?this._viz.select2("data",selectedValues):!this.valueIsList&&selectedValues.length>0?this._viz.select2("data",selectedValues[0]):this._viz.select2("val",void 0)},updateDomVal:function(){if(0==this.$(".select2-container.placeholder").length){var value=this.val();this.$("option:selected").prop("selected",!1);this._viz.data(value);this._setSelect2Value(value)}},_domVal:function(){var value=void 0,valueObject=this._viz.select2("data");value=this.valueIsList?_.pluck(valueObject,"id"):null===valueObject?void 0:valueObject.id;return value},onDomChange:function(e){var value=this._domVal();this.valueIsList&&"selected"===e.type||(this.valueIsList||"change"!==e.type||void 0===value)&&this.val(value)},_onDisable:function(){this._viz&&this._disable(this.settings.get("disabled"))},_disable:function(state){$(this._viz).select2(state?"disable":"enable",!0)},_select2:function(item,options){var selectOptions=_.extend({minimumResultsForSearch:parseInt(this.settings.get("minimumResultsForSearch"),10),allowClear:this.settings.get("showClearButton"),placeholder:"",formatResult:function(item,el){if(item){el.attr("title",item.text);return _.escape(item.text)}return item},formatSelection:function(item,el){if(item){el.attr("title",item.text);return item.text}return item}},options||{});item.select2("close");item.select2(selectOptions)},createView:function(){var select=$(this.selectRoot);this.$el.html(select);select.width(this.settings.get("width"));this._select2(select);return select},updateView:function(viz,data){viz.empty();this._vizData=data;if(0===data.length){this._select2(viz,{placeholder:""});return this}var hasEmptyValueOption=_.any(data,function(d){return""===d.value});viz.append($("<option/>").attr("value",hasEmptyValueOption?"__placeholder":void 0));var controlValue=this.valueIsList?this.settings.get("value"):[this.settings.get("value")];_.each(data,function(row){var option=$("<option/>").text($.trim(row.label)||row.value).attr("value",row.value);_.contains(controlValue,row.value)&&option.attr("selected","selected");viz.append(option)});this.updateDomVal();return this}};return BaseDropdownViewMixin});define("splunkjs/mvc/dropdownview",["require","exports","module","underscore","./basechoiceview","./basedropdownviewmixin"],function(require,exports,module){var _=require("underscore"),BaseChoiceView=require("./basechoiceview"),BaseDropdownViewMixin=require("./basedropdownviewmixin"),DropdownView=BaseChoiceView.extend(_.extend({},BaseDropdownViewMixin,{moduleId:module.id,className:"splunk-dropdown splunk-choice-input",selectRoot:"<select />",valueIsList:!1,initialize:function(){this.options=_.extend({},BaseChoiceView.prototype.options,this.options);BaseChoiceView.prototype.initialize.apply(this,arguments);this.settings.on("change:width",_.debounce(this.render,0),this)}}));return DropdownView});define("splunkjs/mvc/basemultichoiceview",["require","exports","module","underscore","./basechoiceview"],function(require){var _=require("underscore"),BaseChoiceView=require("./basechoiceview"),asArray=function(obj){return void 0===obj||null===obj?[]:_.isArray(obj)?obj:[obj]},BaseMultiChoiceView=BaseChoiceView.extend({_isMultiChoiceView:!0,updateSelectedLabel:function(){var oldSelectedLabels=asArray(this.settings.get("selectedLabel")),selectedLabels=_.map(this.val(),function(value){var choice=this._findDisplayedChoice(value);return choice?choice.label:void 0},this);_.isEqual(oldSelectedLabels,selectedLabels)||(selectedLabels.length>0?this.settings.set("selectedLabel",selectedLabels):this.settings.unset("selectedLabel"))},val:function(newValue){var oldValue=this.settings.get("value"),oldValueAsArray=asArray(oldValue),newValueAsArray=asArray(newValue);if(0===arguments.length)return oldValueAsArray;var sortedOldValue=_.clone(oldValueAsArray).sort(),sortedNewValue=_.clone(newValueAsArray).sort();if(_.isEqual(sortedOldValue,sortedNewValue)&&sortedOldValue.length>0)return oldValue;this.settings.set("value",newValueAsArray);return newValueAsArray}});return BaseMultiChoiceView});requirejs.s.contexts._.nextTick=function(f){f()};require(["css"],function(css){css.addBuffer("splunkjs/css/checkbox.css")});requirejs.s.contexts._.nextTick=requirejs.nextTick;define("splunkjs/mvc/checkboxgroupview",["require","exports","module","underscore","jquery","backbone","./basemultichoiceview","views/shared/controls/SyntheticCheckboxControl","css!../css/checkbox.css"],function(require,exports,module){var _=require("underscore"),$=require("jquery"),Backbone=require("backbone"),BaseMultiChoiceView=require("./basemultichoiceview"),SyntheticCheckboxControl=require("views/shared/controls/SyntheticCheckboxControl");require("css!../css/checkbox.css");var CheckboxGroupView=BaseMultiChoiceView.extend({moduleId:module.id,className:"splunk-checkboxgroup splunk-choice-input",options:{valueField:"",labelField:"","default":void 0,choices:[],value:void 0,disabled:!1},initialize:function(){this.options=_.extend({},BaseMultiChoiceView.prototype.options,this.options);BaseMultiChoiceView.prototype.initialize.apply(this,arguments);this._selections=new Backbone.Model;this.listenTo(this._selections,"change",this._updateValue,this);this.updateDomVal()},_updateValue:function(model){var val=this.val().slice(0);_(model.changed).each(function(v,k){v?val.indexOf(k)<0&&val.push(k):val=_(val).without(k)});this.val(val)},_disable:function(state){_.each(this._checkboxes,function(checkbox){state?checkbox.disable():checkbox.enable()})},_domVal:function(){var newValue=[];_.each(this._selections.toJSON(),function(v,k){v&&newValue.unshift(k)});return newValue},updateDomVal:function(){var oldSelections=this._selections.toJSON(),newSelections={};_(oldSelections).each(function(value,key){newSelections[key]=0});_.each(this.val(),function(val){newSelections[val]=1},this);this._selections.set(newSelections)},createView:function(){this.$el.empty();return $("<div class='splunk-checkboxgroup-choices'/>").appendTo(this.el)},updateView:function(viz,data){viz.empty();this._checkboxes&&_.each(this._checkboxes,function(checkbox){checkbox.remove()});this._checkboxes=[];data&&0!==data.length||(data=[{value:"",label:" "}]);var $choices=this.$(".splunk-checkboxgroup-choices");_.each(data,function(value){var syntheticCheckboxControl=new SyntheticCheckboxControl({model:this._selections,modelAttribute:value.value,label:$.trim(value.label)||value.value});syntheticCheckboxControl.render().appendTo($choices);this._checkboxes.unshift(syntheticCheckboxControl)},this);return this}});return CheckboxGroupView});define("splunkjs/mvc/multidropdownview",["require","exports","module","underscore","./basemultichoiceview","./basedropdownviewmixin"],function(require,exports,module){var _=require("underscore"),BaseMultiChoiceView=require("./basemultichoiceview"),BaseDropdownViewMixin=require("./basedropdownviewmixin"),MultiDropdownView=BaseMultiChoiceView.extend(_.extend({},BaseDropdownViewMixin,{moduleId:module.id,className:"splunk-multidropdown splunk-choice-input",selectRoot:'<select multiple="multiple"/>',valueIsList:!0,initialize:function(){this.options=_.extend({},BaseMultiChoiceView.prototype.options,this.options);BaseMultiChoiceView.prototype.initialize.apply(this,arguments);
this.settings.on("change:width",_.debounce(this.render,0),this)}}));return MultiDropdownView});define("splunkjs/mvc/multiselectview",["require","util/console","./multidropdownview"],function(require){var console=require("util/console");console.warn("%s is deprecated. Please require %s instead.","splunkjs/mvc/simpleform/multiselectview","splunkjs/mvc/simpleform/multidropdownview");return require("./multidropdownview")});define("splunkjs/mvc/simpleform/edit/editinputmenu",["require","exports","module","underscore","jquery","util/console","../../../mvc","views/shared/PopTart","../inputsettings","./concertinasettingseditor","../../savedsearchmanager","../../searchmanager","../../utils","./staticoptionscontrol","./dynamicoptionscontrol","./defaultcontrol","./tokenpreviewcontrol","../../radiogroupview","../../dropdownview","../../checkboxgroupview","../../multiselectview","../../timerangeview","views/shared/FlashMessages"],function(require,exports,module){var _=require("underscore"),$=require("jquery"),PopTartView=(require("util/console"),require("../../../mvc"),require("views/shared/PopTart")),Settings=require("../inputsettings"),ConcertinaSettingsEditor=require("./concertinasettingseditor"),SavedSearchManager=require("../../savedsearchmanager"),SearchManager=require("../../searchmanager"),utils=require("../../utils"),StaticOptionsControl=require("./staticoptionscontrol"),DynamicOptionsControl=require("./dynamicoptionscontrol"),DefaultControl=require("./defaultcontrol"),TokenPreviewControl=require("./tokenpreviewcontrol"),RadioInput=require("../../radiogroupview"),DropdownInput=require("../../dropdownview"),CheckboxInput=require("../../checkboxgroupview"),MultiselectInput=require("../../multiselectview"),TimeInput=require("../../timerangeview"),FlashMessages=require("views/shared/FlashMessages"),EditInputMenuView=PopTartView.extend({moduleId:module.id,initialize:function(){this.options.ignoreClasses=["select2-drop-mask","dropdown-menu","ui-datepicker"];PopTartView.prototype.initialize.apply(this,arguments);this.workingSettings=new Settings(this.model.toJSON({tokens:!0}),{applyTokensByDefault:!0,retrieveTokensByDefault:!0});this.on("shown",this.onShown,this);this.children.flashMessage=new FlashMessages({model:this.workingSettings})},events:{"click a.input-editor-toggle":function(e){e.preventDefault();var label=$(e.currentTarget).data("label");label&&this.toggleEditType(label)},"click .input-editor-apply":function(e){e.preventDefault();this.applyChanges()},"click .input-editor-cancel":function(e){e.preventDefault();this.hide()},"keypress .input-editor-apply":function(e){e.preventDefault();this.applyChanges()},"keypress .input-editor-cancel":function(e){e.preventDefault();this.hide()}},toggleEditType:function(type){this._currentToggle&&this._currentToggle.removeClass("selected");if(this._currentEditor){this._currentEditor.remove();this._currentEditor=null}this.workingSettings.set("type",type);this._currentToggle=this.$("[data-label='"+type+"']");this._currentToggle.addClass("selected");var inputOptions=_INPUT_OPTIONS_MAP[type];if(inputOptions){this._currentEditor=new ConcertinaSettingsEditor({model:this.workingSettings,panels:inputOptions});this.$(".input-editor-format").append(this._currentEditor.render().$el);this._currentEditor.activate()}},onShown:function(){_.defer(_.bind(this._currentToggle.focus,this._currentToggle));this._currentEditor&&this._currentEditor.activate()},applyChanges:function(){this.workingSettings.validate();if(this.workingSettings.isValid()){var previousSearch=this.model.get("search"),previousEarliest=this.model.get("earliest_time"),previousLatest=this.model.get("latest_time"),previousSearchName=this.model.get("searchName");this.model.set(this.workingSettings.toJSON({tokens:!0}),{tokens:!0});this.model.save().done(_.bind(function(){var type=this.model.get("searchType");this.model.set("managerid",this.model.get("managerid")||_.uniqueId());type&&"inline"!==type||!this.model.get("search")?"saved"===type&&this.model.get("searchName")&&previousSearchName!=this.model.get("searchName")&&new SavedSearchManager({id:this.model.get("managerid"),searchname:this.model.get("searchName"),app:utils.getCurrentApp(),auto_cancel:90,status_buckets:0,preview:!0,timeFormat:"%s.%Q",wait:0},{replace:!0}):(previousSearch!=this.model.get("search")||previousEarliest!=this.model.get("earliest_time")||previousLatest!=this.model.get("latest_time"))&&new SearchManager({id:this.model.get("managerid"),latest_time:this.model.get("latest_time"),earliest_time:this.model.get("earliest_time"),search:this.model.get("search"),app:utils.getCurrentApp(),auto_cancel:90,status_buckets:0,preview:!0,timeFormat:"%s.%Q",wait:0},{replace:!0});this.hide()},this))}},render:function(){var renderModel={_:_};this.$el.html(PopTartView.prototype.template);this.$(".popdown-dialog-body").append($(this.compiledTemplate(renderModel)));this.$(".popdown-dialog-body").removeClass("popdown-dialog-padded");$(".flash-messages-placeholder",this.$el).append(this.children.flashMessage.render().el);this.toggleEditType(this.workingSettings.get("type"));return this},template:'            <div class="input-editor-body">                <ul class="input-editor-type">                    <li><a class="edit-text input-editor-toggle" href="#" data-label="text"><i class="icon-text"></i> <%- _("Text").t() %></a></li>                    <li><a class="edit-radio input-editor-toggle" href="#" data-label="radio"><i class="icon-boolean"></i> <%- _("Radio").t() %></a></li>                    <li><a class="edit-dropdown input-editor-toggle" href="#" data-label="dropdown"><i class="icon-triangle-down-small"></i> <%- _("Dropdown").t() %></a></li>                    <li><a class="edit-checkbox input-editor-toggle" href="#" data-label="checkbox"><i class="icon-box-checked"></i> <%- _("Checkbox").t() %></a></li>                    <li><a class="edit-multiselect input-editor-toggle" href="#" data-label="multiselect"><i class="icon-triangle-down-small"></i> <%- _("Multiselect").t() %></a></li>                    <li><a class="edit-trp input-editor-toggle" href="#" data-label="time"><i class="icon-clock"></i> <%- _("Time").t() %></a></li>                </ul>                <div class="input-editor-format"></div>                <div class="flash-messages-placeholder"></div>            </div>            <a class="input-editor-cancel btn pull-left" tabindex="0">'+_("Cancel").t()+'</a>            <a class="input-editor-apply btn btn-primary pull-right" tabindex="0"> '+_("Apply").t()+"</a>        "}),_LABEL_CONTROL={label:_("Label").t(),controlType:"Text",controlOptions:{modelAttribute:"label"}},_SEARCH_ON_CHANGE_CONTROL={label:_("Search on Change").t(),controlType:"SyntheticCheckbox",controlOptions:{modelAttribute:"searchWhenChanged"},className:"editcheckbox"},_TOKEN_CONTROL={label:_("Token").t(),controlType:"Text",controlOptions:{modelAttribute:"token"},tooltip:_("ID to reference the selected value in search (reference as $token$)").t()},_DEFAULT_CONTROL_TEXT={label:_("Default").t(),controlType:"Text",controlOptions:{modelAttribute:"default"},tooltip:_("The default value of the input.").t()},_DEFAULT_CONTROL_RADIO={label:_("Default").t(),controlTypeClass:DefaultControl,inputTypeClass:RadioInput,enableClearSelection:!0,controlOptions:{modelAttribute:"default"},tooltip:_("The default value of the input.").t()},_DEFAULT_CONTROL_DROPDOWN={label:_("Default").t(),controlTypeClass:DefaultControl,inputTypeClass:DropdownInput,enableClearSelection:!0,controlOptions:{modelAttribute:"default"},tooltip:_("The default value of the input.").t()},_DEFAULT_CONTROL_CHECKBOX={label:_("Default").t(),controlTypeClass:DefaultControl,inputTypeClass:CheckboxInput,controlOptions:{modelAttribute:"default"},tooltip:_("The default value of the input.").t(),className:"editcheckbox"},_DEFAULT_CONTROL_MULTISELECT={label:_("Default").t(),controlTypeClass:DefaultControl,inputTypeClass:MultiselectInput,controlOptions:{modelAttribute:"default"},tooltip:_("The default value of the input.").t()},_DEFAULT_CONTROL_TIME={label:_("Default").t(),controlTypeClass:DefaultControl,inputTypeClass:TimeInput,controlOptions:{modelAttribute:"default",popdownOptions:{attachDialogTo:".popdown-dialog.open",scrollContainer:".popdown-dialog.open .concertina-body"}},tooltip:_("The default value of the input.").t()},_SEED_CONTROL={label:_("Seed").t(),controlType:"Text",controlOptions:{modelAttribute:"seed"},tooltip:_("Initial value on page load. Ignored when Default is specified.").t()},_TOKEN_PREFIX_CONTROL={label:_("Token Prefix").t(),controlType:"Text",controlOptions:{modelAttribute:"prefix",updateOnKeyUp:!0},tooltip:_("String prefixed to the value retrieved by the token").t()},_TOKEN_SUFFIX_CONTROL={label:_("Token Suffix").t(),controlType:"Text",controlOptions:{modelAttribute:"suffix",updateOnKeyUp:!0},tooltip:_("String appended to the value retrieved by the token").t()},_TOKEN_VALUE_PREFIX_CONTROL={label:_("Token Value Prefix").t(),controlType:"Text",controlOptions:{modelAttribute:"valuePrefix",updateOnKeyUp:!0},tooltip:_("String prefixed to each specified value of a multiple selection input").t()},_TOKEN_VALUE_SUFFIX_CONTROL={label:_("Token Value Suffix").t(),controlType:"Text",controlOptions:{modelAttribute:"valueSuffix",updateOnKeyUp:!0},tooltip:_("String appended to each specified value of a multiple selection input").t()},_DELIMITER_CONTROL={label:_("Delimiter").t(),controlType:"Text",controlOptions:{modelAttribute:"delimiter",trimLeadingSpace:!1,trimTrailingSpace:!1,updateOnKeyUp:!0},tooltip:_("String inserted between each value (typical values: AND,OR). Specify a leading and trailing space in the string.").t()},_PREVIEW_CONTROL={label:_("Preview").t(),controlTypeClass:TokenPreviewControl,controlOptions:{modelAttribute:"TEMP"}},_STATIC_CONTROL={controlTypeClass:StaticOptionsControl,controlOptions:{modelAttribute:"choices"}},_DYNAMIC_CONTROL={controlTypeClass:DynamicOptionsControl,controlOptions:{modelAttribute:"TEMP"}},_FIELD_FOR_LABEL_CONTROL={label:_("Field For Label").t(),controlType:"Text",controlOptions:{modelAttribute:"labelField"},tooltip:_("Field returned from the search to use as the option label").t()},_FIELD_FOR_VALUE_CONTROL={label:_("Field For Value").t(),controlType:"Text",controlOptions:{modelAttribute:"valueField"},tooltip:_("Field returned from the search to use as the option value").t()},_GENERAL_OPTIONS={headingClassName:"general-input-settings",title:_("General").t(),controls:[_LABEL_CONTROL,_SEARCH_ON_CHANGE_CONTROL]},_TOKEN_OPTIONS_TEXT={headingClassName:"token-input-settings",title:_("Token Options").t(),controls:[_TOKEN_CONTROL,_DEFAULT_CONTROL_TEXT,_SEED_CONTROL,_TOKEN_PREFIX_CONTROL,_TOKEN_SUFFIX_CONTROL]},_TOKEN_OPTIONS_RADIO={headingClassName:"token-input-settings",title:_("Token Options").t(),controls:[_TOKEN_CONTROL,_DEFAULT_CONTROL_RADIO,_TOKEN_PREFIX_CONTROL,_TOKEN_SUFFIX_CONTROL]},_TOKEN_OPTIONS_DROPDOWN={headingClassName:"token-input-settings",title:_("Token Options").t(),controls:[_TOKEN_CONTROL,_DEFAULT_CONTROL_DROPDOWN,_TOKEN_PREFIX_CONTROL,_TOKEN_SUFFIX_CONTROL]},_TOKEN_OPTIONS_CHECKBOX={headingClassName:"token-input-settings",title:_("Token Options").t(),controls:[_TOKEN_CONTROL,_DEFAULT_CONTROL_CHECKBOX,_TOKEN_PREFIX_CONTROL,_TOKEN_SUFFIX_CONTROL,_TOKEN_VALUE_PREFIX_CONTROL,_TOKEN_VALUE_SUFFIX_CONTROL,_DELIMITER_CONTROL,_PREVIEW_CONTROL]},_TOKEN_OPTIONS_MULTISELECT={headingClassName:"token-input-settings",title:_("Token Options").t(),controls:[_TOKEN_CONTROL,_DEFAULT_CONTROL_MULTISELECT,_TOKEN_PREFIX_CONTROL,_TOKEN_SUFFIX_CONTROL,_TOKEN_VALUE_PREFIX_CONTROL,_TOKEN_VALUE_SUFFIX_CONTROL,_DELIMITER_CONTROL,_PREVIEW_CONTROL]},_TOKEN_OPTIONS_TIME={headingClassName:"token-input-settings",title:_("Token Options").t(),controls:[_TOKEN_CONTROL,_DEFAULT_CONTROL_TIME]},_STATIC_OPTIONS={headingClassName:"static-input-settings",title:_("Static Options").t(),controls:[_STATIC_CONTROL]},_DYNAMIC_OPTIONS={headingClassName:"dynamic-input-settings",title:_("Dynamic Options").t(),controls:[_DYNAMIC_CONTROL,_FIELD_FOR_LABEL_CONTROL,_FIELD_FOR_VALUE_CONTROL]},_INPUT_OPTIONS_MAP={text:[_GENERAL_OPTIONS,_TOKEN_OPTIONS_TEXT],radio:[_GENERAL_OPTIONS,_TOKEN_OPTIONS_RADIO,_STATIC_OPTIONS,_DYNAMIC_OPTIONS],dropdown:[_GENERAL_OPTIONS,_TOKEN_OPTIONS_DROPDOWN,_STATIC_OPTIONS,_DYNAMIC_OPTIONS],checkbox:[_GENERAL_OPTIONS,_TOKEN_OPTIONS_CHECKBOX,_STATIC_OPTIONS,_DYNAMIC_OPTIONS],multiselect:[_GENERAL_OPTIONS,_TOKEN_OPTIONS_MULTISELECT,_STATIC_OPTIONS,_DYNAMIC_OPTIONS],time:[_GENERAL_OPTIONS,_TOKEN_OPTIONS_TIME]};return EditInputMenuView});define("splunkjs/mvc/simpleform/edit/menu",["require","exports","module","underscore","jquery","views/shared/dialogs/TextDialog","views/Base","../../simplexml/controller","splunk.util","./editinputmenu"],function(require){var _=require("underscore"),$=require("jquery"),TextDialog=require("views/shared/dialogs/TextDialog"),BaseView=require("views/Base"),Dashboard=require("../../simplexml/controller"),SplunkUtil=require("splunk.util"),EditInputMenu=require("./editinputmenu"),MenuView=BaseView.extend({events:{"click a.edit-input":function(e){e.preventDefault();var $target=$(e.currentTarget);if(this.editInputMenu&&this.editInputMenu.shown)this.editInputMenu.hide();else{$target.addClass("active");this.editInputMenu=new EditInputMenu({model:this.model,onHiddenRemove:!0});$("body").append(this.editInputMenu.render().el);this.editInputMenu.show($target);this.editInputMenu.on("hide",function(){$target.removeClass("active")},this)}},"click a.delete-input":function(e){e.preventDefault();var dialog=new TextDialog({id:"modal_delete",flashModel:Dashboard.model.view}),model=this.model;dialog.on("click:primaryButton",function(){dialog.preventDefault();model.destroy().then(function(){dialog.closeDialog()})});dialog.settings.set("primaryButtonLabel",_("Delete").t());dialog.settings.set("cancelButtonLabel",_("Cancel").t());dialog.settings.set("titleLabel",_("Delete").t());var label=$.trim(this.model.get("label"))||SplunkUtil.sprintf(_("the %s input").t(),_(this.model.get("type")).t());dialog.setText(SplunkUtil.sprintf(_("Are you sure you want to delete %s?").t(),"<em>"+_.escape(label)+"</em>"));$("body").append(dialog.render().el);dialog.show()}},render:function(){this.$el.html(this.template);return this},template:'<div class="edit-dropdown"><a href="#" class="edit-input" title="'+_("Edit Input").t()+'"><i class="icon-pencil"></i></a><a href="#" class="delete-input" title="'+_("Delete Input").t()+'"><i class="icon-x"></i></a></div>'});return MenuView});define("splunkjs/mvc/simpleform/input/base",["require","underscore","jquery","../../basesplunkview","../inputsettings","../../utils","../../simplexml/controller","../edit/menu","splunkjs/mvc","util/console","splunkjs/mvc/tokenutils","../../savedsearchmanager","../formutils"],function(require){var _=require("underscore"),$=require("jquery"),BaseSplunkView=require("../../basesplunkview"),Settings=require("../inputsettings"),utils=require("../../utils"),Dashboard=require("../../simplexml/controller"),EditMenu=require("../edit/menu"),console=(require("splunkjs/mvc"),require("util/console")),TokenUtils=require("splunkjs/mvc/tokenutils"),SavedSearchManager=require("../../savedsearchmanager"),FormUtils=require("../formutils"),BaseInput=BaseSplunkView.extend({_isDashboardInput:!0,options:{submitOnChange:!1},omitted:["id","name","model","collection","el","attributes","className","tagName","events","settingsOptions"],initialize:function(options){this.configure();this.initialVisualization&&this.settings.set("type",this.initialVisualization);options=options||{};this.inputId=options.inputId||_.uniqueId((this.id||"input")+"_");this.settings.set("id",this.id);this._extractTokenName();this.listenTo(this.settings,"change:label",this.renderLabel);this.listenTo(this.settings,"change:token change:type",this._applyTokenName);this.listenTo(this.settings,"change:type",this._updateType);this.listenToOnce(this.settings,"removeInput",this.remove);this.listenTo(Dashboard.getStateModel(),"change:edit",this.onEditModeChange);this.bindToComponent(this.settings.get("managerid"),this.onManagerChange,this)},configure:function(){BaseSplunkView.prototype.configure.apply(this,arguments);var filteredSettings=this.settings.toJSON({tokens:!0});this.settings=new Settings(filteredSettings,this.options.settingsOptions);return this},onManagerChange:function(managers,manager){manager instanceof SavedSearchManager?this.settings.set({searchName:manager.get("searchname"),searchType:"saved"},{tokens:!0}):manager&&this.settings.set({searchType:"inline",search:manager.get("search",{tokens:!0}),earliest_time:manager.get("earliest_time",{tokens:!0}),latest_time:manager.get("latest_time",{tokens:!0})},{tokens:!0})},_updateType:function(){this._removeVisualization();var type=this.settings.get("type")||this.initialVisualization,Input=FormUtils.getInputType(type);console.log("Creating input of type=%o class=%o",type,Input);if(Input){this._bindVizSettings();var options=this.vizSettings.toJSON({tokens:!0});options["settings"]=this.vizSettings;options["id"]=this.inputId;var viz=this.visualization=new Input(options);viz.render().$el.appendTo(this.$el);this.listenTo(viz,"all",this.trigger,this);this.trigger("create:visualization",viz);_.defer(_.bind(function(){this.trigger("change",this.visualization.val(),this.visualization)},this))}else this.trigger("typenotfound",type)},_onReady:function(){var dfd=$.Deferred(),onVizReady=function(viz){viz._onReady(function(){dfd.resolve()})};this.visualization?onVizReady(this.visualization):this.listenToOnce("create:visualization",onVizReady);return dfd.promise()},_bindVizSettings:function(){this.vizSettings=new Settings(_.omit(this.options,this.omitted),this.options.settingsOptions);this.vizSettings.id=this.inputId;this.settings._sync=utils.syncModels(this.settings,this.vizSettings,{auto:!0,exclude:this.omitted.concat(["value","earliest_time","latest_time"])})},_unbindVizSettings:function(){if(this.settings._sync){this.settings._sync.destroy();this.settings._sync=null}if(this.vizSettings){this.vizSettings.dispose();this.vizSettings=null}},_extractTokenName:function(){var type=this.settings.get("type"),getTokenPart=function(str,prefix,suffix){return 0===str.indexOf(prefix)?suffix&&str.slice(-suffix.length)===suffix?str.substring(prefix.length,str.length-suffix.length):str.substring(prefix.length):null};if("time"!==type){var value=this.settings.get("value",{tokens:!0});if(TokenUtils.isToken(value)){var token=getTokenPart(TokenUtils.getTokenName(value),"form.");token&&this.settings.set("token",token)}}else{var et=this.settings.get("earliest_time",{tokens:!0}),lt=this.settings.get("latest_time",{tokens:!0});if(TokenUtils.isToken(et)&&TokenUtils.isToken(lt)){et=getTokenPart(TokenUtils.getTokenName(et),"form.",".earliest");lt=getTokenPart(TokenUtils.getTokenName(lt),"form.",".latest");et&&lt&&et===lt&&this.settings.set("token",et)}}},_applyTokenName:function(){var type=this.settings.get("type"),tokenName=this.settings.get("token");if("time"===type){this.settings.unset("value",{tokens:!0});var newSettings={};newSettings["earliest_time"]=tokenName?"$form."+tokenName+".earliest$":"$earliest$";newSettings["latest_time"]=tokenName?"$form."+tokenName+".latest$":"$latest$";this.settings.set(newSettings,{tokens:!0})}else{this.settings.set({earliest_time:null,latest_time:null},{unset:!0,tokens:!0});this.settings.set("value","$form."+tokenName+"$",{tokens:!0})}},remove:function(){this._removeEditMenu();this._removeVisualization();var parent=this.$el.parent();BaseSplunkView.prototype.remove.call(this);parent.trigger("itemRemoved")},_removeVisualization:function(){this._unbindVizSettings();if(this.visualization){this.stopListening(this.visualization);this.visualization.off();this.visualization.remove();this.visualization=null}},_createEditMenu:function(){return new EditMenu({model:this.settings})},_removeEditMenu:function(){if(this.editMenu){this.editMenu.remove();this.editMenu=null}},onEditModeChange:function(){this.$(".drag-handle").remove();if(Dashboard.getStateModel().get("edit")){$('<div class="drag-handle"></div>').prependTo(this.$el);this.editMenu||(this.editMenu=this._createEditMenu().render().prependTo(this.$el))}else this._removeEditMenu()},renderLabel:function(){var label=this.$el.children("label");label.length||(label=$("<label></label>").appendTo(this.el));label.attr("for",this.inputId);if(this.settings.has("label"))label.html(_.escape(this.settings.get("label"))||"&nbsp;");else{var v=label.text();v&&this.settings.set("label",v)}},hasValue:function(){return this.visualization?this.visualization._hasValueForDashboards():!1},val:function(){return this.visualization?this.visualization.val.apply(this.visualization,arguments):void 0},render:function(){this.renderLabel();this._updateType();this.onEditModeChange();return this}});return BaseInput});define("splunkjs/mvc/simpleform/input/submit",["require","underscore","jquery","../../basesplunkview","../../simplexml/controller","../formutils"],function(require){var _=require("underscore"),$=require("jquery"),BaseSplunkView=require("../../basesplunkview"),Dashboard=require("../../simplexml/controller"),FormUtils=require("../formutils"),SubmitButton=BaseSplunkView.extend({className:"splunk-submit-button form-submit",options:{text:_("Submit").t(),useIcon:!1},events:{"click button":function(e){e.preventDefault();this.$("button").is(".disabled")||this.trigger("submit",this)},"click .delete-input":function(e){e.preventDefault();Dashboard.model.view.updateFormSettings({submitButton:!1}).done(_.bind(this.remove,this))}},initialize:function(){this.configure();this.listenTo(this.settings,"change",this.render);this.listenTo(Dashboard.getStateModel(),"change:edit",this.onEditModeChange);var settings=this.settings;settings.set("formReady",FormUtils.isFormReady());_.defer(function(){FormUtils.onFormReady().then(function(){settings.set("formReady",!0)})});this.listenTo(settings,"change",this.render)},onEditModeChange:function(){this.$(".edit-dropdown").remove();if(Dashboard.isEditMode()){var el=$('<div class="edit-dropdown"><a href="#" class="delete-input"><i class="icon-x"/></a></div>');el.find(".delete-input").attr("title",_("Delete submit button").t());el.prependTo(this.el)}},render:function(){var button=this.$("button");button.length||(button=$('<button class="btn btn-primary"></button>').appendTo(this.el));this.settings.get("useIcon")?button.html('<i class="icon-search"></i>'):this.settings.has("text")?button.text(this.settings.get("text")):this.settings.set("text",button.text());button[this.settings.get("formReady")?"removeClass":"addClass"]("disabled");this.onEditModeChange();return this}});return SubmitButton});define("splunkjs/mvc/simpleform/input/timerange",["require","./base","../../timerangeview","../formutils"],function(require){var BaseInput=require("./base"),TimeRangeView=require("../../timerangeview"),FormUtils=require("../formutils");FormUtils.registerInputType("time",TimeRangeView);var TimeRangeInput=BaseInput.extend({initialVisualization:"time"});return TimeRangeInput});define("splunkjs/mvc/simplexml/editdashboard/addformmenu",["require","exports","module","underscore","jquery","util/console","../../../mvc","../controller","../../simpleform/input/base","../../simpleform/input/submit","../../simpleform/input/timerange","views/shared/PopTart","../../simpleform/formutils"],function(require,exports,module){var _=require("underscore"),$=require("jquery"),mvc=(require("util/console"),require("../../../mvc")),Dashboard=require("../controller"),DashboardInput=require("../../simpleform/input/base"),SubmitButton=require("../../simpleform/input/submit"),TimeRangePickerInput=require("../../simpleform/input/timerange"),PopTartView=require("views/shared/PopTart"),FormUtils=require("../../simpleform/formutils"),AddFormMenuView=PopTartView.extend({moduleId:module.id,className:"dropdown-menu",initialize:function(){PopTartView.prototype.initialize.apply(this,arguments);this.listenTo(mvc.Components,"change:submit",this.render)},events:{"click a.add-text":function(e){e.preventDefault();this.hide();this.remove();addInput("text")},"click a.add-radio":function(e){e.preventDefault();this.hide();this.remove();addInput("radio")},"click a.add-dropdown":function(e){e.preventDefault();this.hide();this.remove();addInput("dropdown")},"click a.add-checkbox":function(e){e.preventDefault();this.hide();this.remove();addInput("checkbox")},"click a.add-multiselect":function(e){e.preventDefault();this.hide();this.remove();addInput("multiselect")},"click a.add-trp":function(e){e.preventDefault();this.hide();this.remove();addInput("timerangepicker")},"click a.add-submit":function(e){e.preventDefault();if(!$(e.currentTarget).is(".disabled")){this.hide();this.remove();addInput("submit")}}},render:function(){var fieldset=$("body>.dashboard-body>.fieldset"),submitButton=fieldset.find(".form-submit"),renderModel={showAddSubmit:!submitButton.length,_:_},html=this.compiledTemplate(renderModel);this.$el.html(PopTartView.prototype.template_menu);this.$el.append(html);return this},template:'            <ul>                <li><a class="add-text" href="#"><i class="icon-text"></i> <%- _("Text").t() %></a></li>                <li><a class="add-radio" href="#"><i class="icon-boolean"></i> <%- _("Radio").t() %></a></li>                <li><a class="add-dropdown" href="#"><i class="icon-triangle-down-small"></i> <%- _("Dropdown").t() %></a></li>                <li><a class="add-checkbox" href="#"><i class="icon-box-checked"></i> <%- _("Checkbox").t() %></a></li>                <li><a class="add-multiselect" href="#"><i class="icon-triangle-down-small"></i> <%- _("Multiselect").t() %></a></li>                <li><a class="add-trp" href="#"><i class="icon-clock"></i> <%- _("Time").t() %></a></li>                <li>                    <% if (showAddSubmit) { %>                        <a class="add-submit" href="#">                    <% } else {%>                        <a class="add-submit disabled" href="#" title="<%- _("You cannot add more than one Submit Button.").t() %>">                    <% } %>                    <i class="icon-search"></i> <%- _("Submit").t() %></a>                </li>            </ul>        '}),getNextFieldId=function(){return _(mvc.Components.toJSON()).chain().filter(FormUtils.isFormInput).map(function(component){return[component.id,component.settings.get("token")]}).flatten().filter(function(id){return id&&/^field\d+$/.test(id)}).map(function(id){return parseInt(id.slice("field".length),10)}).push(0).max().value()},addInput=function(type){var $inputEl,fieldset=$("body>.dashboard-body>.fieldset");if("submit"===type){$inputEl=$("<div></div>");$inputEl.appendTo(fieldset)}else{$inputEl=$(_.template('<div class="input input-<%- type %>"><label>&nbsp;</label></div>',{type:type}));var submitButton=fieldset.find(".form-submit");submitButton.length?$inputEl.insertBefore(submitButton):$inputEl.appendTo(fieldset)}var id,seq=(getNextFieldId()||0)+1;do id="field"+seq++;while(mvc.Components.has(id));"submit"===type?addInputSubmit(id,$inputEl):"timerangepicker"===type?addInputTime(id,$inputEl):addInputByType(type,id,$inputEl);Dashboard.trigger("formupdate")},addInputSubmit=function(id,$inputEl){var input=new SubmitButton({id:"search_btn",el:$inputEl},{tokens:!0}).render();input.on("submit",function(){FormUtils.submitForm()});Dashboard.model.view.updateFormSettings({submitButton:!0}).fail(function(){input.remove()})},addInputTime=function(id,$inputEl){var input=new TimeRangePickerInput({id:id,el:$inputEl,earliest_time:"$form."+id+".earliest$",latest_time:"$form."+id+".latest$","default":{earliest_time:"0",latest_time:""}},{tokens:!0}).render();input.on("change",function(){FormUtils.handleValueChange(input)});Dashboard.trigger("addInput",input.settings)},addInputByType=function(type,id,$inputEl){var vizSpecificOptions,vizSettings=FormUtils.getInputType(type);vizSettings.multiValue&&(vizSpecificOptions={valuePrefix:"",valueSuffix:"",delimiter:" "});var input=new DashboardInput(_.extend({type:type,id:id,el:$inputEl,label:id,value:"$form."+id+"$"},vizSpecificOptions),{tokens:!0}).render();input.on("change",function(){FormUtils.handleValueChange(input)});Dashboard.trigger("addInput",input.settings)};return AddFormMenuView});Splunk.namespace("Splunk.Print");var agentString=window.navigator.userAgent,isIE=/msie/i.test(agentString),isIE7=/msie 7\.0/i.test(agentString),isIE8=/msie 8\.0/i.test(agentString);Splunk.Print=$.klass({START_EVENT:"PrintStart",END_EVENT:"PrintEnd",PAGE_EVENT:"PrintPage",PAGE_WIDTH:isIE7||isIE8?"700px":"800px",WINDOW_PRINT_END_EVENT_DELAY:1e3,initialize:function(){this.logger=Splunk.Logger.getLogger("Splunk.Print");$(document).bind(this.START_EVENT,this.onPrintStart.bind(this));$(document).bind(this.END_EVENT,this.onPrintEnd.bind(this));$(document).bind(this.PAGE_EVENT,this.onPrintPage.bind(this));void 0!==window.onbeforeprint&&this.bindIEPrintEvents()},onPrintEnd:function(){this.logger.info("Splunk.Print.END_EVENT fired")},onPrintPage:function(){var bodyStyle=$("body")[0].style,currentX=window.pageXOffset,currentY=window.pageYOffset,printPrepare=function(){$("body").addClass("print").css({width:this.PAGE_WIDTH,"min-width":0});window.scrollTo(0,document.body.offsetHeight)}.bind(this),printCleanup=function(){$("body").removeClass("print");bodyStyle.width="";bodyStyle["min-width"]="";window.scrollTo(currentX,currentY)};this.logger.info("Splunk.Print.PAGE_EVENT fired");if(isIE){printPrepare();$(document).trigger(this.START_EVENT);window.print();printCleanup();$(document).trigger(this.END_EVENT)}else if(this.isChromeThirteenPlus()){var printPreviewMode=!1;$(window).bind("blur.splunkPrint",function(){printPreviewMode=!0;$(window).bind("focus.splunkPrint",function(){printCleanup();$(document).trigger(this.END_EVENT);$(window).unbind(".splunkPrint")}.bind(this))}.bind(this));printPrepare();setTimeout(function(){$(document).trigger(this.START_EVENT)}.bind(this),0);setTimeout(function(){window.print();setTimeout(function(){if(!printPreviewMode){printCleanup();$(window).unbind(".splunkPrint");$(document).trigger(this.END_EVENT)}}.bind(this),this.WINDOW_PRINT_END_EVENT_DELAY)}.bind(this),0)}else{printPrepare();setTimeout(function(){$(document).trigger(this.START_EVENT)}.bind(this),0);setTimeout(function(){window.print();setTimeout(function(){printCleanup();$(document).trigger(this.END_EVENT)}.bind(this),this.WINDOW_PRINT_END_EVENT_DELAY)}.bind(this),0)}},onPrintStart:function(){this.logger.info("Splunk.Print.START_EVENT fired")},bindIEPrintEvents:function(){if(window.attachEvent){window.attachEvent("onbeforeprint",function(){$("body").css("width",this.PAGE_WIDTH);$(document).trigger(this.START_EVENT)}.bind(this));window.attachEvent("onafterprint",function(){$("body").css("width","");$(document).trigger(this.START_EVENT)}.bind(this))}},isChromeThirteenPlus:function(){var chromeRegex=/chrome\/(\d+)/i,chromeInfo=chromeRegex.exec(navigator.userAgent);return!!(chromeInfo&&parseInt(chromeInfo[1],10)>=13)}});Splunk.Print.instance=null;Splunk.Print.getInstance=function(){Splunk.Print.instance||(Splunk.Print.instance=new Splunk.Print);return Splunk.Print.instance};define("splunk.print",["jquery","lowpro","splunk","splunk.logger"],function(global){return function(){var ret;return ret||global.Splunk.Print}}(this));define("helpers/Printer",["jquery","backbone","splunk.print"],function($,Backbone,SplunkPrint){var Printer=$.extend({},Backbone.Events,{PRINT_START:SplunkPrint.prototype.START_EVENT,PRINT_END:SplunkPrint.prototype.END_EVENT,printPage:function(){$(document).trigger(SplunkPrint.prototype.PAGE_EVENT)},onDomReady:function(){SplunkPrint.getInstance();$(document).on(SplunkPrint.prototype.START_EVENT,function(){Printer.trigger(Printer.PRINT_START)});$(document).on(SplunkPrint.prototype.END_EVENT,function(){Printer.trigger(Printer.PRINT_END)})}});$(function(){Printer.onDomReady()});return Printer});define("splunkjs/mvc/simplexml/editdashboard/menuview",["require","exports","module","underscore","jquery","views/Base","../dialog/addpanel","util/pdf_utils","../controller","util/console","../../../mvc","../../utils","uri/route","./editmenu","./moreinfomenu","./addformmenu","helpers/Printer"],function(require,exports,module){var _=require("underscore"),$=require("jquery"),BaseView=require("views/Base"),AddPanelDialog=require("../dialog/addpanel"),pdfUtils=require("util/pdf_utils"),Dashboard=require("../controller"),console=require("util/console"),mvc=require("../../../mvc"),route=(require("../../utils"),require("uri/route")),EditMenu=require("./editmenu"),MoreInfoMenu=require("./moreinfomenu"),AddFormMenu=require("./addformmenu"),Printer=require("helpers/Printer"),MenuView=BaseView.extend({moduleId:module.id,className:"edit-menu",initialize:function(){BaseView.prototype.initialize.apply(this,arguments);
this.model.state.on("change:edit",this.onEditModeChange,this);this.model.state.on("change:editable change:pdf_available",this.render,this);this.model.state.user.on("change",this.render,this)},events:{"click a.edit-btn":function(e){e.preventDefault();var $target=$(e.currentTarget);if(this.children.editMenu&&this.children.editMenu.shown)this.children.editMenu.hide();else{this.children.moreInfoMenu&&this.children.moreInfoMenu.shown&&this.children.moreInfoMenu.hide();$target.addClass("active");this.children.editMenu=new EditMenu({model:{application:this.model.application,dashboard:this.model.dashboard,state:this.model.state,scheduledView:this.model.scheduledView},collection:this.collection,showOpenActions:this.options.showOpenActions,deleteRedirect:this.options.deleteRedirect,onHiddenRemove:!0});$("body").append(this.children.editMenu.render().el);this.children.editMenu.show($target);this.children.editMenu.on("hide",function(){$target.removeClass("active")},this)}},"click a.more-info-btn":function(e){e.preventDefault();var $target=$(e.currentTarget);if(this.children.moreInfoMenu&&this.children.moreInfoMenu.shown)this.children.moreInfoMenu.hide();else{this.children.editMenu&&this.children.editMenu.shown&&this.children.editMenu.hide();$target.addClass("active");this.children.moreInfoMenu=new MoreInfoMenu({model:{application:this.model.application,dashboard:this.model.dashboard,state:this.model.state,scheduledView:this.model.scheduledView},collection:this.collection,onHiddenRemove:!0});$("body").append(this.children.moreInfoMenu.render().el);this.children.moreInfoMenu.show($target);this.children.moreInfoMenu.on("hide",function(){$target.removeClass("active")},this)}},"click a.edit-done":function(e){e.preventDefault();this.model.state.set("edit",!1)},"click a.add-form":function(e){e.preventDefault();var $target=$(e.currentTarget);if(!$target.hasClass("disabled"))if(this.children.addFormMenu&&this.children.addFormMenu.shown)this.children.addFormMenu.hide();else{$target.addClass("active");this.children.addFormMenu=new AddFormMenu({model:{application:this.model.application,dashboard:this.model.dashboard,state:this.model.state,scheduledView:this.model.scheduledView},collection:this.collection,onHiddenRemove:!0});$("body").append(this.children.addFormMenu.render().el);this.children.addFormMenu.show($target);this.children.addFormMenu.on("hide",function(){$target.removeClass("active")},this)}},"click a.add-panel":function(e){e.preventDefault();this.children.addPanelDialog=new AddPanelDialog({controller:this.options.controller});this.children.addPanelDialog.render().appendTo($("body")).show()},"click a.print-dashboard":function(e){e.preventDefault();Printer.printPage()},"click a.generate-pdf":function(e){e.preventDefault();var view=this.model.dashboard.entry.get("name"),app=this.model.dashboard.entry.acl.get("app"),params={},idx=0;_.map(mvc.Components.get("dashboard").getElementIds(),function(id){var element=mvc.Components.get(id);element&&element.getExportParams&&_.extend(params,element.getExportParams("sid_"+idx));idx++});pdfUtils.isPdfServiceAvailable().done(function(available,type){if("pdfgen"===type){var xml=Dashboard.model.view.getFlattenedXML({useLoadjob:!1,indent:!1,pdf:!0});console.DEBUG_ENABLED&&console.log(xml);pdfUtils.downloadReportFromXML(xml,app,params)}else"deprecated"===type&&pdfUtils.getRenderURL(view,app,params).done(function(url){window.open(url)})})}},onEditModeChange:function(){var edit=this.model.state.get("edit");this.$(".dashboard-view-controls")[edit?"hide":"show"]();this.$(".dashboard-edit-controls")[edit?"show":"hide"]();this.setAddInputState()},setAddInputState:function(){var isScheduled=this.model.scheduledView.entry.content.get("is_scheduled");isScheduled?this.$(".add-form").addClass("disabled").tooltip({animation:!1,placement:"bottom",title:_('You must unschedule this dashboard to add form fields. To do this, use the "Schedule PDF Delivery" link in the edit menu.').t()}):this.$(".add-form").removeClass("disabled").tooltip("destroy")},render:function(){var app=this.model.application.toJSON(),renderModel={dashboard:this.model.dashboard.isDashboard(),editLinkViewMode:route.manager(app.root,app.locale,app.app,["data","ui","views",app.page],{data:{action:"edit",ns:app.app,redirect_override:route.page(app.root,app.locale,app.app,app.page)}}),editLinkEditMode:route.manager(app.root,app.locale,app.app,["data","ui","views",app.page],{data:{action:"edit",ns:app.app,redirect_override:route.page(app.root,app.locale,app.app,app.page)+"/edit"}}),dashboardType:this.model.dashboard.getViewType(),editable:this.model.state.get("editable"),canWrite:this.model.dashboard.entry.acl.canWrite(),removable:this.model.dashboard.entry.links.get("remove")?!0:!1,isSimpleXML:this.model.dashboard.isSimpleXML(),isHTML:this.model.dashboard.isHTML(),isPdfServiceAvailable:this.model.state.get("pdf_available"),showAddTRP:!this.model.state.get("default_timerange"),isScheduled:this.model.scheduledView.entry.content.get("is_scheduled"),_:_};this.$el.html(this.compiledTemplate(renderModel));this.setAddInputState();this.$(".generate-pdf").tooltip({animation:!1,title:_("Export PDF").t()});this.$(".print-dashboard").tooltip({animation:!1,title:_("Print").t()});this.onEditModeChange();return this},template:'            <span class="dashboard-view-controls">                <% if(canWrite) { %>                    <div class="btn-group">                        <a class="btn edit-btn" href="#"><%- _("Edit").t() %> <span class="caret"></span></a>                        <a class="btn more-info-btn" href="#"><%- _("More Info").t() %> <span class="caret"></span></a>                    </div>                <% }else{ %>                    <div class="btn-group">                        <a class="btn edit-btn" href="#"><%- _("Edit").t() %> <span class="caret"></span></a>                    </div>                <% } %>                <div class="btn-group">                    <% if(isSimpleXML && isPdfServiceAvailable) { %>                        <a class="btn generate-pdf" href="#"><i class="icon-export icon-large"></i></a>                    <% } %>                    <a class="btn print-dashboard" href="#"><i class="icon-print icon-large"></i></a>                </div>            </span>            <span class="dashboard-edit-controls" style="display:none;">                <div class="btn-group">                    <a class="btn add-form" href="#"><i class="icon-plus"></i> <%- _("Add Input").t() %> <span class="caret"></span></a>                    <a class="btn add-panel" href="#"><i class="icon-plus"></i> <%- _("Add Panel").t() %></a>                    <a class="btn edit-source" href="<%- editLinkEditMode %>"><i class="icon-code"></i> <%- _("Edit Source").t() %></a>                </div>                <a class="btn btn-primary edit-done" href="#"><%- _("Done").t() %></a>            </span>        '});return MenuView});define("splunkjs/mvc/simplexml/editdashboard/master",["require","exports","module","underscore","jquery","views/Base","collections/services/authorization/Roles","./menuview"],function(require){var BaseView=(require("underscore"),require("jquery"),require("views/Base")),Roles=require("collections/services/authorization/Roles"),MenuView=require("./menuview");return BaseView.extend({className:"splunk-dashboard-controls",initialize:function(){BaseView.prototype.initialize.apply(this,arguments);this.rolesCollection=new Roles;this.rolesCollection.fetch();this.children.menuView=new MenuView({model:{state:this.model.state,dashboard:this.model.dashboard,application:this.model.application,scheduledView:this.model.scheduledView},collection:this.rolesCollection,controller:this.options.controller})},render:function(){this.$el.append(this.children.menuView.render().el);return this}})});define("splunkjs/mvc/simplexml/dragndrop",["require","backbone","underscore","jquery","util/console","./controller"],function(require){var Backbone=require("backbone"),_=require("underscore"),$=require("jquery"),console=require("util/console"),Dashboard=require("./controller"),libraryLoaded=$.Deferred(),useHTML5=(document.createElement("div"),!1),SORTABLE=useHTML5?"sortable5":"sortable";if(useHTML5){console.log("loading html5 sortable");require(["splunkjs/contrib/jquery.sortable.html5"],libraryLoaded.resolve)}else{console.log("loading jquery ui sortable");require(["jquery.ui.sortable"],libraryLoaded.resolve)}return Backbone.View.extend({render:function(){libraryLoaded.done(this.startDragAndDrop.bind(this));return this},events:{"mouseover .drag-handle":function(e){$(e.target).parents(".dashboard-panel").addClass("drag-hover")},"mouseout .drag-handle":function(e){$(e.target).parents(".dashboard-panel").removeClass("drag-hover")}},startDragAndDrop:function(){this.$el.addClass("dragndrop-enabled");_.defer(_.bind(function(){this.enablePanelDragAndDrop();this.enableInputDragAndDrop()},this))},enablePanelDragAndDrop:function(){var sortable,that=this,updateDims=_.debounce(that.updateDimensions.bind(this),0),enableDragAndDrop=_(this.enablePanelDragAndDrop).bind(this),onEnd=_.once(function(){console.log("sort STOP");if(sortable){try{sortable[SORTABLE]("destroy")}catch(e){}_.defer(enableDragAndDrop);that.cleanupEmptyRows();that.trigger("sortupdate");sortable=null;$(window).trigger("resize");that.$(".dashboard-row").trigger("panelVisibilityChanged")}});this.createNewDropRow();sortable=this.$(".dashboard-row")[SORTABLE]({handle:".drag-handle",connectWith:this.$(".dashboard-row"),placeholder:{element:function(){return $('<div class="sortable-placeholder"><div class="dashboard-panel"></div></div>')},update:function(ct,p){that.updateRow(p.parents(".dashboard-row"))}},tolerance:"pointer"}).on("sort",function(){updateDims()}).on("sortupdate",function(){onEnd()}).on("stop",function(){onEnd()});updateDims();$(window).trigger("resize")},enableInputDragAndDrop:function(){var sortable,that=this,onEnd=_.once(function(){if(sortable){try{sortable[SORTABLE]("destroy")}catch(e){}_.defer(function(){that.enableInputDragAndDrop()});that.trigger("sortupdate");sortable=null}});sortable=this.$(".fieldset")[SORTABLE]({handle:".drag-handle",connectWith:this.$(".fieldset"),items:">.input",tolerance:"pointer",placeholder:{element:function(cur){var el=$('<div class="input ui-sortable-placeholder"><div class="placeholder-inner"></div></div>'),height=cur.height();el.height(height-5);el.children().height(height-15);return el[0]},update:function(){}},start:function(){$(".dashboard-body").addClass("form-drag");$("#search_btn").hide()},stop:function(){$(".dashboard-body").removeClass("form-drag");var submitButton=$("#search_btn");submitButton.length&&submitButton.appendTo(submitButton.parent()).show();Dashboard.trigger("formupdate")}}).on("sortupdate",onEnd).on("stop",onEnd)},destroy:function(){this.$el.removeClass("dragndrop-enabled");this.cleanupEmptyRows();try{this.$(".dashboard-row")[SORTABLE]("destroy");this.$(".fieldset")[SORTABLE]("destroy")}catch(e){}this.updateDimensions()},updateRow:function(r){var els=$(r).children().not(".ui-sortable-helper"),w=String(Math.floor(1e4/els.not(".sortable-dragging").length)/100)+"%";els.css({width:w});var items=$(r).find(".dashboard-panel");items.css({"min-height":100}).css({"min-height":_.max(_.map(items,function(i){return $(i).height()}))})},updateDimensions:function(){_(this.$(".dashboard-row")).each(this.updateRow)},createNewDropRow:function(){this.cleanupEmptyRows();this.$(".dashboard-row").after($('<div class="dashboard-row empty"></div>'));this.$(".dashboard-row").first().before($('<div class="dashboard-row empty"></div>'))},cleanupEmptyRows:function(){this.$(".dashboard-row").each(function(){var r=$(this);(r.is(":empty")||r.html().match(/^\s+$/))&&r.remove()});this.$(".dashboard-row.empty").removeClass("empty")},getItemOrder:function(){return _(this.$(".dashboard-row")).map(function(row){return _($(row).find(".dashboard-panel")).map(function(panel){return _($(panel).find(".dashboard-element")).map(function(element){return $(element).attr("id")})})})}})});define("splunkjs/mvc/simpleform/fieldsetview",["require","exports","module","underscore","jquery","views/Base","../simplexml/controller"],function(require,module){var _=require("underscore"),$=require("jquery"),BaseView=require("views/Base"),Dashboard=require("../simplexml/controller");return BaseView.extend({moduleId:module.id,className:"fieldset",initialize:function(){this.listenTo(Dashboard,"formupdate",this.render);this.listenTo(Dashboard.model,"change:edit change:rootNodeName",this.render);BaseView.prototype.initialize.apply(this,arguments)},isEmpty:function(){return!$.trim(this.$el.html())},render:function(){Dashboard.isEditMode()||!_.all(this.$el.find(".input>label"),function(label){return!$.trim($(label).text())})?this.$el.removeClass("hide-label"):this.$el.addClass("hide-label");var rootNodeName=Dashboard.model.get("rootNodeName");null!=rootNodeName&&"form"!==rootNodeName?this.$el.hide():this.$el.show();return this}})});define("splunkjs/mvc/simplexml/dashboard/title",["require","underscore","jquery","backbone"],function(require){var _=require("underscore"),$=require("jquery"),Backbone=require("backbone"),DashboardTitle=Backbone.View.extend({initialize:function(){this.model.on("change:edit change:label",this.render,this)},render:function(){this.model.has("label")||this.model.set({label:this.$el.text()},{silent:!0});this.$(".edit-label").remove();this.$el.text(_(this.model.get("label")).t());this.model.get("edit")&&$('<span class="edit-label">'+_("Edit").t()+": </span>").prependTo(this.$el);return this}});return DashboardTitle});define("splunkjs/mvc/simplexml/dashboard/description",["require","underscore","backbone"],function(require){var _=require("underscore"),Backbone=require("backbone");return Backbone.View.extend({initialize:function(){this.listenTo(this.model,"change:description",this.render,this);this.listenTo(this.model,"change:edit",this.render,this)},render:function(){if(this.model.has("description")){var txt=_(this.model.get("description")||"").t(),edit=this.model.get("edit");this.$el.text(txt)[txt&&!edit?"show":"hide"]()}return this}})});define("splunkjs/mvc/simplexml/dashboard/row",["require","underscore","jquery","backbone"],function(require){var _=require("underscore"),$=require("jquery"),Backbone=require("backbone"),DashboardRowView=Backbone.View.extend({initialize:function(){this.listenTo(this.model,"change:edit",this.onEditStateChange,this)},onEditStateChange:function(){this.$el.off("DOMSubtreeModified");if(!this.model.get("edit")&&this.$(".dashboard-panel").length>1){var fn=_.debounce(this.alignItemHeights.bind(this),1e3);this.$el.bind("DOMSubtreeModified",fn);fn()}},onContentChange:function(){this.$el.off("DOMSubtreeModified");var cells=this.$(".dashboard-cell");if(0===cells.length)return this.remove();cells.removeClass("last-visible");if(!this.model.get("edit")){cells=_(cells).filter(function(el){return $(el).find(".dashboard-element:not(.hidden)").length>0||!!$.trim($(el).find(".fieldset").html())});cells.length>0&&$(cells).last().addClass("last-visible")}$(cells).css({width:String(100/cells.length)+"%"}).find(".panel-element-row").each(function(){var elements=$(this).find(".dashboard-element");elements.css({width:String(100/elements.length)+"%"})});cells.length>1&&this.alignItemHeights();this.onEditStateChange()},onPanelVisibilityChange:function(){this.onContentChange();$(window).trigger("resize")},alignItemHeights:function(){var row=this.$el,items=row.find(".dashboard-panel");items.css({"min-height":0}).css({"min-height":_.max(_.map(items,function(i){return $(i).height()}))})},render:function(){this.onContentChange();this.$el.off("cellRemoved");this.$el.off("panelVisibilityChanged");this.$el.on("cellRemoved",_.bind(this.onContentChange,this));this.$el.on("panelVisibilityChanged",_.bind(this.onPanelVisibilityChange,this));return this}});return DashboardRowView});define("splunkjs/mvc/simplexml/dashboard/panel",["require","underscore","jquery","backbone","../../simpleform/fieldsetview"],function(require){var _=require("underscore"),$=require("jquery"),Backbone=require("backbone"),FieldsetView=require("../../simpleform/fieldsetview"),DashboardPanelView=Backbone.View.extend({initialize:function(){this.listenTo(this.model,"change:edit",this.onEditStateChange,this)},onElementVisibilityChange:function(){0!==this.$(".dashboard-element:not(.hidden)").length||null!=this.fieldset&&!this.fieldset.isEmpty()?this.show():this.hide();var isEditMode=this.model.get("edit");_(this.$el.children(".panel-element-row.grouped")).each(function(panelRow){var selector=".dashboard-element"+(isEditMode?"":":not(.hidden)"),elements=$(panelRow).children(selector);elements.length>0&&elements.css({width:String(100/elements.length)+"%"})})},hide:function(){if(!this.$el.is(".hidden")){this.model.get("edit")||this.$el.hide();this.$el.addClass("hidden").trigger("panelVisibilityChanged")}},show:function(){this.$el.is(".hidden")&&this.$el.show().removeClass("hidden").trigger("panelVisibilityChanged")},onEditStateChange:function(model){if(model.get("edit")){this._dragHandle||(this._dragHandle=$('<div class="drag-handle"><div class="handle-inner"></div></div>'));this._dragHandle.prependTo(this.el);this.$el.is(".hidden")&&this.$el.show().trigger("panelVisibilityChanged");this.fieldset||(this.fieldset=new FieldsetView({el:$('<div class="fieldset"></div>').insertAfter(this._dragHandle)}).render())}else{this._dragHandle&&this._dragHandle.detach();this.$el.is(".hidden")&&this.$el.hide().trigger("panelVisibilityChanged");if(this.fieldset&&this.fieldset.isEmpty()){this.fieldset.remove();this.fieldset=null}}this.onElementVisibilityChange()},markGroupedElementRows:function(){_(this.$el.children(".panel-element-row")).chain().map($).invoke("removeClass","grouped").filter(function($el){return $el.children(".dashboard-element").length>1}).invoke("addClass","grouped")},render:function(){if(!this.fieldset){var fieldsetEl=this.$el.children(".fieldset");fieldsetEl.length&&(this.fieldset=new FieldsetView({el:fieldsetEl}).render())}this.onEditStateChange(this.model);this.$el.off("elementVisibilityChanged");this.markGroupedElementRows();this.$el.on("elementVisibilityChanged",_.bind(this.onElementVisibilityChange,this));return this},isEmpty:function(){var panelElementRows=this.$el.children(".panel-element-row"),inputs=this.$el.children(".fieldset").children(".input");return 0===panelElementRows.length&&0===inputs.length},events:{itemRemoved:function(){this.isEmpty()&&this.remove()}},remove:function(){this.fieldset&&this.fieldset.remove();this.$el.off("elementVisibilityChanged");var parent=this.$el.parent();Backbone.View.prototype.remove.call(this);parent.trigger("panelRemoved")}});return DashboardPanelView});define("splunkjs/mvc/simplexml/dashboard/empty",["require","exports","module","underscore","jquery","backbone","splunk.util","uri/route"],function(require){var _=require("underscore"),$=require("jquery"),Backbone=require("backbone"),SplunkUtil=require("splunk.util"),DashboardEmptyState=(require("uri/route"),Backbone.View.extend({initialize:function(){Backbone.View.prototype.initialize.apply(this,arguments);this.listenTo(this.model.state,"change:editable change:edit",this.render,this)},events:{"click a.start-edit":function(e){e.preventDefault();this.model.state.set("edit",!0)}},render:function(){this.$el.empty().removeClass("empty-dashboard");this.$el.addClass("empty-dashboard");var alert=$('<div class="alert alert-error"><i class="icon-alert"></i></div>');if(this.model.state.get("editable")){var msg;if(this.model.state.get("edit"))msg=_("Click Add Panel to start.").t();else{msg=_("This dashboard has no panels. %s to add panels.").t();var startEditLink=SplunkUtil.sprintf('<a class="start-edit" href="#edit">%s</a>',_("Start editing").t());msg=SplunkUtil.sprintf(msg,startEditLink)}$("<span></span>").html(msg).appendTo(alert)}else $("<span></span>").text(_("This dashboard has no panels.").t()).appendTo(alert);alert.appendTo(this.$el);return this}}));return DashboardEmptyState});define("splunkjs/mvc/simpleform/edit/formsettings",["require","exports","module","underscore","jquery","backbone","views/Base","../../simplexml/controller"],function(require){var _=require("underscore"),Backbone=(require("jquery"),require("backbone")),BaseView=require("views/Base"),Dashboard=require("../../simplexml/controller");return BaseView.extend({className:"form-settings",initialize:function(){BaseView.prototype.initialize.apply(this,arguments);this.model=new Backbone.Model({value:!!Dashboard.model.view.isFormAutoRun()});this.listenTo(this.model,"change",this.update);this.listenTo(this.model,"change:value",function(model,value){Dashboard.model.view.updateFormSettings({autoRun:value}).fail(function(){model.set("value",!value)})});this.listenTo(Dashboard.model,"change:rootNodeName",this.render)},events:{"click label":function(e){e.preventDefault();this.model.get("disabled")||this.model.set("value",!this.model.get("value"))},"click .btn":function(e){e.preventDefault()}},update:function(){this.$("i.icon-check")[this.model.get("value")?"show":"hide"]();this.$("label,.btn")[this.model.get("disabled")?"addClass":"removeClass"]("disabled")},render:function(){"form"===Dashboard.model.get("rootNodeName")?this.$el.html(this.compiledTemplate({label:_("Autorun dashboard").t(),checked:this.model.get("value")})):this.$el.empty();return this},template:'            <label class="checkbox">                  <a href="#" class="btn"><i class="icon-check" <% if (!checked) {%>style="display:none"<% } %>></i></a>                  <%= label%>            </label>        '})});define("splunkjs/mvc/simplexml/dashboardview",["require","../basesplunkview","../mvc","underscore","jquery","./controller","./editdashboard/master","./dragndrop","util/console","../simpleform/fieldsetview","./dashboard/title","./dashboard/description","./dashboard/row","./dashboard/panel","models/services/ScheduledView","./dashboard/empty","../simpleform/edit/formsettings","views/dashboards/table/controls/SchedulePDF"],function(require){var BaseSplunkView=require("../basesplunkview"),_=(require("../mvc"),require("underscore")),$=require("jquery"),controller=require("./controller"),EditControls=require("./editdashboard/master"),DragnDropView=require("./dragndrop"),console=require("util/console"),FieldsetView=require("../simpleform/fieldsetview"),DashboardTitleView=require("./dashboard/title"),DashboardDescriptionView=require("./dashboard/description"),DashboardRowView=require("./dashboard/row"),DashboardPanel=require("./dashboard/panel"),ScheduledView=require("models/services/ScheduledView"),EmptyStateView=require("./dashboard/empty"),FormSettingsView=require("../simpleform/edit/formsettings"),SchedulePDF=require("views/dashboards/table/controls/SchedulePDF"),DashboardView=BaseSplunkView.extend({initialize:function(){this.model=controller.getStateModel();this.model.scheduledView=new ScheduledView;this.scheduledViewDfd=$.Deferred();controller.onViewModelLoad(function(){var dfd=this.model.scheduledView.findByName(this.model.view.entry.get("name"),this.model.app.get("app"),this.model.app.get("owner"));dfd.done(_.bind(this.scheduledViewDfd.resolve,this.scheduledViewDfd));dfd.fail(_.bind(this.scheduledViewDfd.reject,this.scheduledViewDfd))},this);this.editControls=new EditControls({model:{state:this.model,dashboard:this.model.view,application:this.model.app,scheduledView:this.model.scheduledView},controller:controller});this.model.on("change:edit",this.onEditStateChange,this);this.listenTo(this.model,"change:dialog",this.handleDialog);this.model.has("dialog")&&this.handleDialog(this.model)},render:function(){var model=this.model;this.rows=_.map(this.$(".dashboard-row"),function(row){return new DashboardRowView({el:row,model:model}).render()});this.titleView=new DashboardTitleView({model:this.model,el:this.$(".dashboard-header h2")}).render();var descEl=this.$("p.description");descEl.length||(descEl=$('<p class="description"></p>').appendTo(this.$(".dashboard-header")).hide());this.descriptionView=new DashboardDescriptionView({el:descEl,model:model}).render();var fieldsetEl=this.$el.children(".fieldset");fieldsetEl.length||(fieldsetEl=$('<div class="fieldset"></div>').insertAfter(this.$(".dashboard-header")));this.fieldsetView=new FieldsetView({el:fieldsetEl}).render();var editEl=$('<div class="edit-dashboard-menu pull-right"></div>').prependTo(this.$(".dashboard-header"));$.when(this.scheduledViewDfd).then(function(){this.editControls.render().appendTo(editEl)}.bind(this));this.panels=_(this.$(".dashboard-panel")).map(function(el){return new DashboardPanel({el:el,model:model}).render()});this.onEditStateChange();_.defer(function(){$("body").removeClass("preload")});this.$el.addClass(this.model.get("edit")?"edit-mode":"view-mode");controller.onViewModelLoad(function(){if(this.model.view.isSimpleXML())try{this.model.view.captureDashboardStructure(this.getDashboardStructure())}catch(e){console.error("Error capturing dashboard structure - disabling edit mode!",e);this.model.set("editable",!1);this.model.set("edit",!1)}},this);this.updateEmptyState();return this},getController:function(){return controller},getStateModel:function(){return this.model},getDashboardStructure:function(){return{fieldset:_(this.$el.children(".fieldset").children(":not(.form-submit)")).map(function(input){return $(input).attr("id")}),rows:_(this.$(".dashboard-row:not(.empty)")).map(function(row){return _($(row).find(".dashboard-panel")).map(function(panel){var elements=_($(panel).find(".dashboard-element")).map(function(element){return $(element).attr("id")}),inputs=_($(panel).find(".input")).map(function(input){return $(input).attr("id")});return{inputs:inputs,elements:elements}})})}},isEmptyDashboard:function(){return!_(this.getDashboardStructure().rows).any(function(row){return _(row).any(function(p){return p.elements.length||p.inputs.length})})},getElementIds:function(){return _(this.getDashboardStructure().rows).chain().flatten().pluck("elements").flatten().value()},updateEmptyState:function(forceNotEmpty){if(this.isEmptyDashboard()&&forceNotEmpty!==!0){this.emptyStateView||(this.emptyStateView=new EmptyStateView({model:{app:this.model.app,state:this.model}}));this.emptyStateView.render().$el.appendTo(this.$el)}else if(this.emptyStateView){this.emptyStateView.remove();this.emptyStateView=null}},enterEditMode:function(){this.leaveEditMode();if(this.model.get("editable")){console.log("Entering edit mode");this.dragnDrop=new DragnDropView({el:this.el});try{this.model.view.captureDashboardStructure(this.getDashboardStructure())}catch(e){console.error("Error capturing dashboard structure - disabling edit mode!",e);this.model.set("editable",!1);this.model.set("edit",!1);return}this.dragnDrop.on("sortupdate",_.debounce(this.updatePanelOrder,0),this);this.dragnDrop.render();this.$el.is(".view-mode")&&this.$el.addClass("edit-mode").removeClass("view-mode");this.formSettings=(new FormSettingsView).render().insertBefore(this.$el.children(".fieldset"))}else{console.log("Aborting edit mode: Dashboard is not editable");this.model.set("edit",!1)}},updatePanelOrder:function(){this.model.get("editable")&&this.model.view.updateStructure(this.getDashboardStructure())},leaveEditMode:function(){if(this.formSettings){this.formSettings.remove();this.formSettings=null}if(this.dragnDrop){this.dragnDrop.off();this.dragnDrop.destroy();this.updatePanelOrder();this.dragnDrop=null}this.$el.is(".edit-mode")&&this.$el.removeClass("edit-mode").addClass("view-mode");this.updateEmptyState()},onEditStateChange:function(){this.model.get("edit")?controller.onViewModelLoad(this.enterEditMode,this):this.leaveEditMode()},removeElement:function(id){var cur=this.$("#"+id),parent=cur.parent();if(cur.siblings(".dashboard-element").length)cur.remove();else{var elRow=cur.parents(".panel-element-row");if(elRow.siblings(".panel-element-row").length||elRow.siblings(".fieldset").children(".input").length){parent=elRow.parent();elRow.remove()}else{var cell=cur.parents(".dashboard-cell");parent=cell.parent();cell.remove()}}parent.trigger("cellRemoved");this.updateEmptyState()},events:{panelRemoved:function(e){this.onPanelRemoved($(e.target))}},onPanelRemoved:function(cell){var parent=cell.parent();cell.remove();parent.trigger("cellRemoved");this.updateEmptyState()},createNewElement:function(options){var row=$(_.template(this.rowTemplate,options));row.appendTo(this.$el);this.rows.push(new DashboardRowView({el:row,model:this.model}).render());this.panels.push(new DashboardPanel({el:row.find(".dashboard-panel"),model:this.model}).render());this.updateEmptyState(!0);return row.find(".dashboard-element")},handleDialog:function(model){model.get("dialog")&&controller.onViewModelLoad(function(){if("schedulePDF"===model.get("dialog")){model.unset("dialog");model.view.isForm()||this.openSchedulePDFDialog()}},this)},openSchedulePDFDialog:function(){var model=this.model;this.scheduledViewDfd.done(function(){var schedulePDF=new SchedulePDF({model:{scheduledView:model.scheduledView,dashboard:model.view,application:model.app,appLocal:model.appLocal},onHiddenRemove:!0});$("body").append(schedulePDF.render().el);schedulePDF.show()})},rowTemplate:'  <div class="dashboard-row">                            <div class="dashboard-cell" style="width: 100%;">                                <div class="dashboard-panel clearfix">                                    <div class="panel-element-row">                                        <div class="dashboard-element" id="<%= id %>" style="width: 100%">                                            <div class="panel-head"><h3><%- title %></h3></div>                                            <div class="panel-body"></div>                                        </div>                                    </div>                                </div>                            </div>                        </div>'});return DashboardView});define("splunkjs/mvc/simplexml/dashboard",["require","util/console","./dashboardview"],function(require){var console=require("util/console");console.warn("%s is deprecated. Please require %s instead.","splunkjs/mvc/simplexml/dashboard","splunkjs/mvc/simplexml/dashboardview");return require("./dashboardview")});define("views/shared/results_table/ResultsTableHeader",["jquery","underscore","module","views/Base"],function($,_,module,Base){return Base.extend({moduleId:module.id,tagName:"thead",initialize:function(){Base.prototype.initialize.apply(this,arguments);_.defaults(this.options,{sortableFields:!0})},render:function(){var columnClasses={};_(this.options.columnTypes).each(function(columnType,field){columnClasses[field]=this.columnTypeToClassName(columnType)},this);var html=this.compiledTemplate({rowExpansion:this.options.rowExpansion,rowNumbers:this.options.rowNumbers,fields:this.options.fields,sortKeyAttribute:this.options.sortKeyAttribute,sortableFields:this.options.sortableFields,columnClasses:columnClasses});this.$el.html(html);return this},highlightColumn:function(index){this.options.rowExpansion&&index++;this.options.rowNumbers&&index++;this.$("th").eq(index).addClass("highlighted")},unHighlightColumn:function(index){this.options.rowExpansion&&index++;this.options.rowNumbers&&index++;this.$("th").eq(index).removeClass("highlighted")},columnTypeToClassName:function(columnType){return"number"===columnType?"numeric":"timestamp"===columnType?"timestamp":""},template:'            <tr class="">                <% if(rowExpansion) { %>                    <th class="col-info" style="width: 15px;"><i class="icon-info"></i></th>                <% } %>                <% if(rowNumbers) { %>                    <th class="row-number"></th>                <% } %>                <% _(fields).each(function(field) { %>                    <th class="<%- sortableFields ? "sorts": "none" %> <%- columnClasses[field] %>" <%- sortKeyAttribute %>="<%- field %>">                    <a href="#"><%- field %><i class="icon-sorts "></i></a>                    </th>                <% }) %>            </tr>        '})
});define("views/shared/results_table/renderers/BaseCellRenderer",["require","exports","module","underscore","backbone"],function(require){var _=require("underscore"),Backbone=require("backbone"),BaseCellRenderer=function(){this.initialize.apply(this,arguments)};_.extend(BaseCellRenderer.prototype,Backbone.Events,{initialize:function(){},canRender:function(){throw new Error("Must implement method canRender.")},setup:function(){},teardown:function(){},render:function(){}});BaseCellRenderer.prototype.constructor=BaseCellRenderer;BaseCellRenderer.extend=Backbone.Model.extend;return BaseCellRenderer});define("views/shared/results_table/renderers/BaseRowExpansionRenderer",["require","exports","module","jquery","underscore","backbone"],function(require){var $=require("jquery"),_=require("underscore"),Backbone=require("backbone"),BaseRowExpansionRenderer=function(){this.initialize.apply(this,arguments)};_.extend(BaseRowExpansionRenderer.prototype,Backbone.Events,{initialize:function(){},canRender:function(){throw new Error("Must implement method canRender.")},createContainer:function(rowData){return $('<td colspan="'+rowData.colspan+'"></td>')},setup:function(){},teardown:function(){},render:function(){}});BaseRowExpansionRenderer.prototype.constructor=BaseRowExpansionRenderer;BaseRowExpansionRenderer.extend=Backbone.Model.extend;return BaseRowExpansionRenderer});define("views/shared/results_table/ResultsTableRow",["jquery","underscore","module","views/Base","./renderers/BaseCellRenderer","./renderers/BaseRowExpansionRenderer"],function($,_,module,Base,BaseCellRenderer,BaseRowExpansionRenderer){var ResultsTableRow=Base.extend({moduleId:module.id,tagName:"tr",render:function(){this.$el.attr(ResultsTableRow.ROW_INDEX_ATTR,this.options.rowIndex);this.$el.addClass(this.options.rowIndex%2?"even":"odd");this.options.rowExpansion&&(this._rowExpansionToggle=$('<td rowspan="1" class="expands"><a href="#"><i class="icon-triangle-right-small"></i></a></td>').addClass(ResultsTableRow.ROW_EXPANSION_CLASSNAME).appendTo(this.$el));this.options.hasOwnProperty("rowNumber")&&this.$el.append($('<td class="row-number"></td>').text(this.options.rowNumber));this.generateCells();return this},remove:function(){this.collapseRow();this.disposeCells();return Base.prototype.remove.call(this)},generateCells:function(){this.disposeCells();var renderedCell,cellRenderer,renderedCells=this._renderedCells=[],cellRenderers=this.getCellRenderers();_(this.options.cells).each(function(cellData){var $td=$("<td></td>");$td.attr(ResultsTableRow.CELL_INDEX_ATTR,cellData.index);renderedCell={$td:$td};for(var i=0,l=cellRenderers.length;l>i;i++){cellRenderer=cellRenderers[i];if(cellRenderer instanceof BaseCellRenderer){if(cellRenderer.canRender(cellData)){cellRenderer.setup($td,cellData);cellRenderer.render($td,cellData);renderedCell.cellData=cellData;renderedCell.cellRenderer=cellRenderer;break}}else if("function"==typeof cellRenderer&&cellRenderer($td,cellData))break}this.$el.append($td);renderedCells.push(renderedCell)},this)},disposeCells:function(){if(this._renderedCells){_(this._renderedCells).each(function(renderedCell){renderedCell.cellRenderer&&renderedCell.cellRenderer.teardown(renderedCell.$td,renderedCell.cellData);renderedCell.$td.remove()},this);this._renderedCells=null}},getCellRenderers:function(){return this.options.table?this.options.table.getCellRenderers():[]},expandRow:function(rowExpansionRenderer,rowData){if(!(rowExpansionRenderer instanceof BaseRowExpansionRenderer))throw new Error("Parameter rowExpansionRenderer must be an instance of views/shared/results_table/renderers/BaseRowExpansionRenderer.");this.collapseRow();this.$el.addClass("expanded-row");if(this._rowExpansionToggle){$("i",this._rowExpansionToggle).removeClass("icon-triangle-right-small").addClass("icon-triangle-down-small");this._rowExpansionToggle.attr("rowspan",2)}this._rowExpansionData=rowData;this._rowExpansionContainerTD=$(rowExpansionRenderer.createContainer(this._rowExpansionData));this._rowExpansionContainerTR=$("<tr></tr>").addClass("expanded-content-row").addClass(this.options.rowIndex%2?"even":"odd").append(this._rowExpansionContainerTD);this.$el.after(this._rowExpansionContainerTR);this._rowExpansionRenderer=rowExpansionRenderer;this._rowExpansionRenderer.setup(this._rowExpansionContainerTD,this._rowExpansionData);this._rowExpansionRenderer.render(this._rowExpansionContainerTD,this._rowExpansionData)},collapseRow:function(){if(this._rowExpansionRenderer){this._rowExpansionRenderer.teardown(this._rowExpansionContainerTD,this._rowExpansionData);this._rowExpansionRenderer=null;this._rowExpansionContainerTR.remove();this._rowExpansionContainerTR=null;this._rowExpansionContainerTD=null;this._rowExpansionData=null;if(this._rowExpansionToggle){this._rowExpansionToggle.attr("rowspan",1);$("i",this._rowExpansionToggle).removeClass("icon-triangle-down-small").addClass("icon-triangle-right-small")}this.$el.removeClass("expanded-row")}},getRowData:function(){var colspan=$("td",this.$el).length-(this._rowExpansionToggle?1:0);return _.extend({},this.options,{colspan:colspan})},highlightRow:function(){this.$el.addClass("highlighted")},unHighlightRow:function(){this.$el.removeClass("highlighted")},highlightCell:function($target){var rowNumbersEnabled=this.options.hasOwnProperty("rowNumber"),rowExpansionEnabled=!!this.options.rowExpansion,$tds=this.$("td"),numRowSplits=this.options.numRowSplits,numRowSplitsOffset=(rowNumbersEnabled?1:0)+(rowExpansionEnabled?1:0),$rowSplitCells=$tds.slice(0,numRowSplits+numRowSplitsOffset);$rowSplitCells.addClass("highlighted");$target.addClass("highlighted")},unHighlightCell:function($target){var rowNumbersEnabled=this.options.hasOwnProperty("rowNumber"),rowExpansionEnabled=!!this.options.rowExpansion,$tds=this.$("td"),numRowSplits=this.options.numRowSplits,numRowSplitsOffset=(rowNumbersEnabled?1:0)+(rowExpansionEnabled?1:0),$rowSplitCells=$tds.slice(0,numRowSplits+numRowSplitsOffset);$rowSplitCells.removeClass("highlighted");$target.removeClass("highlighted")}},{ROW_INDEX_ATTR:"data-row-index",CELL_INDEX_ATTR:"data-cell-index",ROW_EXPANSION_CLASSNAME:"row-expansion-toggle",MV_SUBCELL_CLASSNAME:"multivalue-subcell",MV_INDEX_ATTR:"data-mv-index"});return ResultsTableRow});define("views/shared/delegates/ColumnSort",["jquery","underscore","backbone","views/shared/delegates/Base"],function($,_,Backbone,DelegateBase){var CONSTS={SORTABLE_ROW:"sorts",NOT_SORTABLE_CLASS:"not-sortable",SORT_DISABLED_CLASS:"sort-disabled",SORTED_CLASS:"active",ASCENDING:"asc",DESCENDING:"desc",SORT_KEY_ATTR:"data-sort-key",SORT:"sort"},SORTABLE_CELL_SELECTOR="th."+CONSTS.SORTABLE_ROW,SORTABLE_ICON_SELECTOR="i.icon-sorts";return DelegateBase.extend({events:function(){var events={};events["click "+SORTABLE_CELL_SELECTOR]="onColumnHeaderClick";return events}(),initialize:function(){this.model||(this.model=new Backbone.Model);var defaults={sortKeyAttr:"sortKey",sortDirAttr:"sortDirection"};this.options=$.extend(!0,defaults,this.options);this.autoUpdate=!!this.options.autoUpdate;this.activate()},startListening:function(){this.autoUpdate&&this.listenTo(this.model,"change:"+this.options.sortKeyAttr+" change:"+this.options.sortDirAttr,_.debounce(function(){this.update()},0))},update:function($rootEl){$rootEl=$rootEl||this.$el;var $thList=$rootEl.find(SORTABLE_CELL_SELECTOR),sortKey=this.model.get(this.options.sortKeyAttr),$activeTh=$thList.filter("["+CONSTS.SORT_KEY_ATTR+'="'+sortKey+'"]'),sortDirection=this.model.get(this.options.sortDirAttr);$thList.removeClass(CONSTS.SORTED_CLASS).find(SORTABLE_ICON_SELECTOR).removeClass(CONSTS.ASCENDING+" "+CONSTS.DESCENDING);$activeTh.addClass(CONSTS.SORTED_CLASS).find(SORTABLE_ICON_SELECTOR).addClass("asc"===sortDirection?CONSTS.ASCENDING:CONSTS.DESCENDING)},onColumnHeaderClick:function(e){e.preventDefault();var $th=$(e.currentTarget);if(!$th.hasClass(CONSTS.NOT_SORTABLE_CLASS)&&!$th.hasClass(CONSTS.SORT_DISABLED_CLASS)){var sortKey=$th.attr(CONSTS.SORT_KEY_ATTR),sortDirection=$th.find(SORTABLE_ICON_SELECTOR).hasClass(CONSTS.DESCENDING)?"asc":"desc",data={};data[this.options.sortKeyAttr]=sortKey;data[this.options.sortDirAttr]=sortDirection;this.model.set(data);this.trigger(CONSTS.SORT,sortKey,sortDirection)}}},CONSTS)});define("views/shared/delegates/DetachedTableHeader",["jquery","underscore","views/shared/delegates/Base"],function($,_,Base){return Base.extend({syncColumnWidths:function(){if(this.$table){var $baseRow=this.$table.find("thead > tr"),$baseRowCells=$baseRow.find("th"),$headerRow=this.$headerTable.find("thead > tr"),$headerCells=$headerRow.find("th"),$skipCell=!1,widths=[];this.$table.css("table-layout",this.options.defaultLayout);this.options.flexWidthColumn!==!1&&($skipCell=$baseRowCells.eq(this.options.flexWidthColumn));$baseRowCells.not($skipCell[0]).css("width","");_($baseRowCells).each(function(cell,i){if(!$skipCell||cell!==$skipCell[0]){var $cell=$(cell),cellWidth={width:$cell[0].clientWidth-parseFloat($cell.css("padding-right"))-parseFloat($cell.css("padding-left")),index:i};widths.push(cellWidth)}},this);this.$headerTable.width(this.$table.outerWidth());_.each(widths,function(cell){var $cell=$baseRowCells.eq(cell.index),$headerCell=$headerCells.eq(cell.index);$cell.width(cell.width);$headerCell.width(cell.width)});this.$table.css("table-layout","fixed")}}})});define("views/shared/delegates/TableDock",["jquery","underscore","views/shared/delegates/DetachedTableHeader"],function($,_,DetachedTableHeader){return DetachedTableHeader.extend({awake:!0,touch:!1,initialize:function(options){var defaults={table:"> table",offset:0,dockScrollBar:!0,flexWidthColumn:-1,defaultLayout:"auto"};_.defaults(this.options,defaults);DetachedTableHeader.prototype.initialize.call(this,options);this.disabled=!1;this.dockedScrollHidden=!0;this.left=0;this.scrollLeft=!1;this.eventNS="table-dock-"+this.cid;this.activate()},activate:function(options){options||(options={});if(this.active)return DetachedTableHeader.prototype.activate.call(this,options);var debouncedResizeHandler=_.debounce(this.handleWindowResize,50);$(window).on("resize."+this.eventNS,_(debouncedResizeHandler).bind(this));$(window).on("scroll."+this.eventNS,_(this.handleWindowScroll).bind(this));_.defer(this.update.bind(this));this.options.dockScrollBar&&this.$el.on("scroll."+this.eventNS,_(this.handleContainerScroll).bind(this));return DetachedTableHeader.prototype.activate.call(this,options)},deactivate:function(options){options||(options={});if(!this.active)return DetachedTableHeader.prototype.deactivate.call(this,options);DetachedTableHeader.prototype.deactivate.call(this,options);this.$el.html()&&this.$el.scrollLeft(0);this.left=0;this.scrollLeft=!1;$(window).off("resize."+this.eventNS);$(window).off("scroll."+this.eventNS);this.$el.off("."+this.eventNS);this.$headerTable&&this.$headerTable.off("."+this.eventNS);this.$dockedScroll&&this.$dockedScroll.off("."+this.eventNS);return this},update:function(){this._updateDebounced||(this._updateDebounced=_.debounce(this._update));this._updateDebounced()},_update:function(){this.$table=this.$(this.options.table).first();this.updateHeaders();this.options.dockScrollBar&&this.updateScroll();this.$table.is(":visible")?this.syncMeasurements():_.defer(this.syncMeasurements.bind(this))},syncMeasurements:function(){this.scrollLeft=!1;this.syncColumnWidths();this.options.dockScrollBar&&this.syncScrollWidths();this.handleWindowScroll();this.options.dockScrollBar&&this.handleContainerScroll();this.trigger("updated",this.$headerTable)},disable:function(){this.disabled=!0;this.$disable&&this.$disable.show()},enable:function(){this.disabled=!1;this.$disable&&this.$disable.hide()},updateHeaders:function(){this.$header&&this.$header.remove();this.$header=$('<div class="header-table-docked" style="display:none"><table></table><div class="disable"></div></div>').css({top:this.options.offset,left:this.left,right:0});this.$disable=this.$header.find("> .disable")[this.disabled?"show":"hide"]();this.$headerTable=this.$header.find("> table");this.$headerTable.attr("class",this.$table.attr("class"));this.$table.find("> thead").clone().appendTo(this.$headerTable);this.$header.prependTo(this.el);this.$headerTable.on("click."+this.eventNS,"th",function(e){e.preventDefault();e.stopPropagation();var colIndex=$(e.currentTarget).prevAll().length+1;this.$table.find("> thead > tr > th:nth-child("+colIndex+")").click()}.bind(this));this.$headerTable.on("click."+this.eventNS,"th a",function(e){e.preventDefault()})},updateScroll:function(){this.$dockedScroll&&this.$dockedScroll.remove();this.$dockedScroll=$("<div />").addClass("table-scroll-bar-docked").hide().appendTo(this.$el).css("left",this.$el.position().left);this.$dockedScroll.on("scroll."+this.eventNS,_(this.handleDockedScrollChange).bind(this))},handleWindowResize:function(){if(this.$table&&this.$table.is(":visible")){this.syncColumnWidths();if(this.options.dockScrollBar){this.updateDockedScrollBar();this.syncScrollWidths()}}},handleWindowScroll:function(){if(this.$table&&this.$table.is(":visible")){var scrollTop=$(window).scrollTop(),tableOffsetTop=this.$table.offset().top;if(scrollTop>=tableOffsetTop-this.options.offset)this.$header.is(":visible")||this.$header.css("top",this.options.offset).show();else{this.$header.css("top","-1000px").width();this.$header.hide()}this.options.dockScrollBar&&this.updateDockedScrollBar()}},handleContainerScroll:function(){if(this.$table){var scrollLeft=this.$el.scrollLeft();if(this.scrollLeft!==scrollLeft){this.$headerTable.css("marginLeft",-scrollLeft+"px");this.$dockedScroll.scrollLeft(scrollLeft);this.scrollLeft=scrollLeft}}},handleDockedScrollChange:function(){var scrollLeft=this.$el.scrollLeft(),dockScrollLeft=this.$dockedScroll.scrollLeft();if(scrollLeft!==dockScrollLeft){this.$headerTable.css("marginLeft",-dockScrollLeft+"px");this.$el.scrollLeft(dockScrollLeft)}},syncColumnWidths:function(){DetachedTableHeader.prototype.syncColumnWidths.apply(this,arguments);this.left=this.$el.position().left;this.$header.css({left:this.left})},syncScrollWidths:function(){if(this.$table&&this.$table[0]){var tableWidth=parseFloat(this.$table[0].scrollWidth),$fullWidthDiv=$("<div />").width(tableWidth).height(1);this.$dockedScroll.html($fullWidthDiv)}},updateDockedScrollBar:function(){var scrollTop=$(window).scrollTop(),tableOffsetTop=this.$table.offset().top,windowHeight=$(window).height(),tableHeight=this.$el.outerHeight();if(tableOffsetTop+tableHeight>scrollTop+windowHeight){if(!this.dockedScrollHidden)return;this.$dockedScroll.show();this.dockedScrollHidden=!1;this.handleContainerScroll()}else if(!this.dockedScrollHidden){this.$dockedScroll.hide();this.dockedScrollHidden=!0}},remove:function(){DetachedTableHeader.prototype.remove.apply(this);$(window).off("resize."+this.eventNS);$(window).off("scroll."+this.eventNS);this.$el.off("."+this.eventNS);this.$headerTable&&this.$headerTable.off("."+this.eventNS);this.$dockedScroll&&this.$dockedScroll.off("."+this.eventNS);return this}})});define("views/shared/delegates/TableHeadStatic",["jquery","underscore","views/shared/delegates/DetachedTableHeader"],function($,_,DetachedTableHeader){return DetachedTableHeader.extend({active:!1,initialize:function(options){var defaults={headerContainer:"> .header-table-static",scrollContainer:"> .scroll-table-wrapper",offset:0,flexWidthColumn:-1,defaultLayout:"auto"};_.defaults(this.options,defaults);this.options.table||(this.options.table=this.options.scrollContainer+" > table");this.$scrollContainer=this.$el.is(this.options.scrollContainer)?this.$el:this.$(this.options.scrollContainer);DetachedTableHeader.prototype.initialize.call(this,options);this.activate({noUpdate:!0})},wake:function(){return this.activate()},activate:function(options){options||(options={});if(this.active)return DetachedTableHeader.prototype.activate.call(this,options);var debouncedResizeHandler=_.debounce(this.handleWindowResize,50);$(window).on("resize."+this.cid,_(debouncedResizeHandler).bind(this));this.$scrollContainer.on("scroll."+this.cid,_(this.handleContainerScroll).bind(this));options.noUpdate||_.defer(this.update.bind(this));return DetachedTableHeader.prototype.activate.call(this,options)},sleep:function(){return this.deactivate()},deactivate:function(options){options||(options={});if(!this.active)return DetachedTableHeader.prototype.deactivate.call(this,options);DetachedTableHeader.prototype.deactivate.call(this,options);$(window).off("resize."+this.cid);this.$scrollContainer.off("scroll."+this.cid);this.$headerTable&&this.$headerTable.off("."+this.cid);return this},remove:function(){DetachedTableHeader.prototype.remove.apply(this);$(window).off("resize."+this.cid);this.$scrollContainer.off("scroll."+this.cid);this.$headerTable&&this.$headerTable.off("."+this.cid);return this},update:function(){if(this.active){this.$scrollContainer=this.$el.is(this.options.scrollContainer)?this.$el:this.$(this.options.scrollContainer);this.$table=this.$(this.options.table).first();this.$headerContainer=this.$(this.options.headerContainer);this.$headerContainer.empty();var $headerWrapper=$('<div class="header-table-wrapper"></div>').appendTo(this.$headerContainer);$headerWrapper.css({"margin-right":this.$scrollContainer[0].offsetWidth-this.$scrollContainer[0].clientWidth});this.$headerTable=$("<table>");this.$headerTable.attr("class",this.$table.attr("class")).width(this.$table.outerWidth()).css("table-layout","fixed");this.$table.find("> thead").clone().css("visibility","visible").appendTo(this.$headerTable);$headerWrapper.prepend(this.$headerTable);this.$table.find("thead").css("visibility","hidden");this.$headerTable.on("click."+this.cid,"th",function(e){e.preventDefault();e.stopPropagation();var colIndex=$(e.currentTarget).prevAll().length+1;this.$table.find("> thead > tr > th:nth-child("+colIndex+")").click()}.bind(this));this.$headerTable.on("click."+this.cid,"th a",function(e){e.preventDefault()});this.scrollLeft=0;var updateDom=_(function(){this.syncColumnWidths();this.handleContainerScroll();this.trigger("updated",this.$headerTable)}).bind(this);this.$table.is(":visible")?updateDom():_.defer(updateDom)}},handleContainerScroll:function(){if(this.$table){var scrollLeft=this.$scrollContainer.scrollLeft();if(scrollLeft!==this.scrollLeft){this.$headerTable.css("marginLeft",-scrollLeft+"px");this.scrollLeft=scrollLeft}}},handleWindowResize:function(){this.$table&&this.syncColumnWidths()}})});define("helpers/grid/RowIterator",["underscore","backbone"],function(_,Backbone){var RETURN_FALSE=function(){return!1},RowIterator=function(options){options=options||{};this.offset=parseInt(options.offset,10)||0;this.expandedTest=options.expandedTest||RETURN_FALSE;this.eachRow=_(this.eachRow).bind(this)};RowIterator.prototype={eachRow:function(items,callback,context){context=context||null;var iteratorFn=function(item,i){var rowNumber=i+this.offset+1,isExpanded=this.expandedTest(item,i,rowNumber);callback.apply(context,[item,i,rowNumber,isExpanded])};items instanceof Backbone.Collection?items.each(iteratorFn,this):_(items).each(iteratorFn,this)}};return RowIterator});!function(document,Math,undefined){!function(factory){"function"==typeof define&&define.amd?define("jquery.sparkline",["jquery"],factory):jQuery&&!jQuery.fn.sparkline&&factory(jQuery)}(function($){var getDefaults,createClass,SPFormat,clipval,quartile,normalizeValue,normalizeValues,remove,isNumber,all,sum,addCSS,ensureArray,formatNumber,RangeMap,MouseHandler,Tooltip,barHighlightMixin,line,bar,tristate,discrete,bullet,pie,box,defaultStyles,initStyles,VShape,VCanvas_base,VCanvas_canvas,VCanvas_vml,pending,UNSET_OPTION={},shapeCount=0;getDefaults=function(){return{common:{type:"line",lineColor:"#00f",fillColor:"#cdf",defaultPixelsPerValue:3,width:"auto",height:"auto",composite:!1,tagValuesAttribute:"values",tagOptionsPrefix:"spark",enableTagOptions:!1,enableHighlight:!0,highlightLighten:1.4,tooltipSkipNull:!0,tooltipPrefix:"",tooltipSuffix:"",disableHiddenCheck:!1,numberFormatter:!1,numberDigitGroupCount:3,numberDigitGroupSep:",",numberDecimalMark:".",disableTooltips:!1,disableInteraction:!1},line:{spotColor:"#f80",highlightSpotColor:"#5f5",highlightLineColor:"#f22",spotRadius:1.5,minSpotColor:"#f80",maxSpotColor:"#f80",lineWidth:1,normalRangeMin:undefined,normalRangeMax:undefined,normalRangeColor:"#ccc",drawNormalOnTop:!1,chartRangeMin:undefined,chartRangeMax:undefined,chartRangeMinX:undefined,chartRangeMaxX:undefined,tooltipFormat:new SPFormat('<span style="color: {{color}}">&#9679;</span> {{prefix}}{{y}}{{suffix}}')},bar:{barColor:"#3366cc",negBarColor:"#f44",stackedBarColor:["#3366cc","#dc3912","#ff9900","#109618","#66aa00","#dd4477","#0099c6","#990099"],zeroColor:undefined,nullColor:undefined,zeroAxis:!0,barWidth:4,barSpacing:1,chartRangeMax:undefined,chartRangeMin:undefined,chartRangeClip:!1,colorMap:undefined,tooltipFormat:new SPFormat('<span style="color: {{color}}">&#9679;</span> {{prefix}}{{value}}{{suffix}}')},tristate:{barWidth:4,barSpacing:1,posBarColor:"#6f6",negBarColor:"#f44",zeroBarColor:"#999",colorMap:{},tooltipFormat:new SPFormat('<span style="color: {{color}}">&#9679;</span> {{value:map}}'),tooltipValueLookups:{map:{"-1":"Loss",0:"Draw",1:"Win"}}},discrete:{lineHeight:"auto",thresholdColor:undefined,thresholdValue:0,chartRangeMax:undefined,chartRangeMin:undefined,chartRangeClip:!1,tooltipFormat:new SPFormat("{{prefix}}{{value}}{{suffix}}")},bullet:{targetColor:"#f33",targetWidth:3,performanceColor:"#33f",rangeColors:["#d3dafe","#a8b6ff","#7f94ff"],base:undefined,tooltipFormat:new SPFormat("{{fieldkey:fields}} - {{value}}"),tooltipValueLookups:{fields:{r:"Range",p:"Performance",t:"Target"}}},pie:{offset:0,sliceColors:["#3366cc","#dc3912","#ff9900","#109618","#66aa00","#dd4477","#0099c6","#990099"],borderWidth:0,borderColor:"#000",tooltipFormat:new SPFormat('<span style="color: {{color}}">&#9679;</span> {{value}} ({{percent.1}}%)')},box:{raw:!1,boxLineColor:"#000",boxFillColor:"#cdf",whiskerColor:"#000",outlierLineColor:"#333",outlierFillColor:"#fff",medianColor:"#f00",showOutliers:!0,outlierIQR:1.5,spotRadius:1.5,target:undefined,targetColor:"#4a2",chartRangeMax:undefined,chartRangeMin:undefined,tooltipFormat:new SPFormat("{{field:fields}}: {{value}}"),tooltipFormatFieldlistKey:"field",tooltipValueLookups:{fields:{lq:"Lower Quartile",med:"Median",uq:"Upper Quartile",lo:"Left Outlier",ro:"Right Outlier",lw:"Left Whisker",rw:"Right Whisker"}}}}};defaultStyles='.jqstooltip { position: absolute;left: 0px;top: 0px;visibility: hidden;background: rgb(0, 0, 0) transparent;background-color: rgba(0,0,0,0.6);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr=#99000000, endColorstr=#99000000);-ms-filter: "progid:DXImageTransform.Microsoft.gradient(startColorstr=#99000000, endColorstr=#99000000)";color: white;font: 10px arial, san serif;text-align: left;white-space: nowrap;padding: 5px;border: 1px solid white;z-index: 10000;}.jqsfield { color: white;font: 10px arial, san serif;text-align: left;}';createClass=function(){var Class,args;Class=function(){this.init.apply(this,arguments)};if(arguments.length>1){if(arguments[0]){Class.prototype=$.extend(new arguments[0],arguments[arguments.length-1]);Class._super=arguments[0].prototype}else Class.prototype=arguments[arguments.length-1];if(arguments.length>2){args=Array.prototype.slice.call(arguments,1,-1);args.unshift(Class.prototype);$.extend.apply($,args)}}else Class.prototype=arguments[0];Class.prototype.cls=Class;return Class};$.SPFormatClass=SPFormat=createClass({fre:/\{\{([\w.]+?)(:(.+?))?\}\}/g,precre:/(\w+)\.(\d+)/,init:function(format,fclass){this.format=format;this.fclass=fclass},render:function(fieldset,lookups,options){var match,token,lookupkey,fieldvalue,prec,self=this,fields=fieldset;return this.format.replace(this.fre,function(){var lookup;token=arguments[1];lookupkey=arguments[3];match=self.precre.exec(token);if(match){prec=match[2];token=match[1]}else prec=!1;fieldvalue=fields[token];if(fieldvalue===undefined)return"";if(lookupkey&&lookups&&lookups[lookupkey]){lookup=lookups[lookupkey];return lookup.get?lookups[lookupkey].get(fieldvalue)||fieldvalue:lookups[lookupkey][fieldvalue]||fieldvalue}isNumber(fieldvalue)&&(fieldvalue=options.get("numberFormatter")?options.get("numberFormatter")(fieldvalue):formatNumber(fieldvalue,prec,options.get("numberDigitGroupCount"),options.get("numberDigitGroupSep"),options.get("numberDecimalMark")));return fieldvalue})}});$.spformat=function(format,fclass){return new SPFormat(format,fclass)};clipval=function(val,min,max){return min>val?min:val>max?max:val};quartile=function(values,q){var vl;if(2===q){vl=Math.floor(values.length/2);return values.length%2?values[vl]:(values[vl-1]+values[vl])/2}if(values.length%2){vl=(values.length*q+q)/4;return vl%1?(values[Math.floor(vl)]+values[Math.floor(vl)-1])/2:values[vl-1]}vl=(values.length*q+2)/4;return vl%1?(values[Math.floor(vl)]+values[Math.floor(vl)-1])/2:values[vl-1]};normalizeValue=function(val){var nf;switch(val){case"undefined":val=undefined;break;case"null":val=null;break;case"true":val=!0;break;case"false":val=!1;break;default:nf=parseFloat(val);val==nf&&(val=nf)}return val};normalizeValues=function(vals){var i,result=[];for(i=vals.length;i--;)result[i]=normalizeValue(vals[i]);return result};remove=function(vals,filter){var i,vl,result=[];for(i=0,vl=vals.length;vl>i;i++)vals[i]!==filter&&result.push(vals[i]);return result};isNumber=function(num){return!isNaN(parseFloat(num))&&isFinite(num)};formatNumber=function(num,prec,groupsize,groupsep,decsep){var p,i;num=(prec===!1?parseFloat(num).toString():num.toFixed(prec)).split("");p=(p=$.inArray(".",num))<0?num.length:p;p<num.length&&(num[p]=decsep);for(i=p-groupsize;i>0;i-=groupsize)num.splice(i,0,groupsep);return num.join("")};all=function(val,arr,ignoreNull){var i;for(i=arr.length;i--;)if((!ignoreNull||null!==arr[i])&&arr[i]!==val)return!1;return!0};sum=function(vals){var i,total=0;for(i=vals.length;i--;)total+="number"==typeof vals[i]?vals[i]:0;return total};ensureArray=function(val){return $.isArray(val)?val:[val]};addCSS=function(css){var tag,iefail;if(document.createStyleSheet)try{document.createStyleSheet().cssText=css;return}catch(e){iefail=!0}tag=document.createElement("style");tag.type="text/css";document.getElementsByTagName("head")[0].appendChild(tag);iefail?document.styleSheets[document.styleSheets.length-1].cssText=css:tag["string"==typeof document.body.style.WebkitAppearance?"innerText":"innerHTML"]=css};$.fn.simpledraw=function(width,height,useExisting,interact){var target,mhandler;if(useExisting&&(target=this.data("_jqs_vcanvas")))return target;if($.fn.sparkline.canvas===!1)return!1;if($.fn.sparkline.canvas===undefined){var el=document.createElement("canvas");if(el.getContext&&el.getContext("2d"))$.fn.sparkline.canvas=function(width,height,target,interact){return new VCanvas_canvas(width,height,target,interact)};else{if(!document.namespaces||document.namespaces.v){$.fn.sparkline.canvas=!1;return!1}document.namespaces.add("v","urn:schemas-microsoft-com:vml","#default#VML");$.fn.sparkline.canvas=function(width,height,target){return new VCanvas_vml(width,height,target)}}}width===undefined&&(width=$(this).innerWidth());height===undefined&&(height=$(this).innerHeight());target=$.fn.sparkline.canvas(width,height,this,interact);mhandler=$(this).data("_jqs_mhandler");mhandler&&mhandler.registerCanvas(target);return target};$.fn.cleardraw=function(){var target=this.data("_jqs_vcanvas");target&&target.reset()};$.RangeMapClass=RangeMap=createClass({init:function(map){var key,range,rangelist=[];for(key in map)if(map.hasOwnProperty(key)&&"string"==typeof key&&key.indexOf(":")>-1){range=key.split(":");range[0]=0===range[0].length?-1/0:parseFloat(range[0]);range[1]=0===range[1].length?1/0:parseFloat(range[1]);range[2]=map[key];rangelist.push(range)}this.map=map;this.rangelist=rangelist||!1},get:function(value){var i,range,result,rangelist=this.rangelist;if((result=this.map[value])!==undefined)return result;if(rangelist)for(i=rangelist.length;i--;){range=rangelist[i];if(range[0]<=value&&range[1]>=value)return range[2]}return undefined}});$.range_map=function(map){return new RangeMap(map)};MouseHandler=createClass({init:function(el,options){var $el=$(el);this.$el=$el;this.options=options;this.currentPageX=0;this.currentPageY=0;this.el=el;this.splist=[];this.tooltip=null;this.over=!1;this.displayTooltips=!options.get("disableTooltips");this.highlightEnabled=!options.get("disableHighlight")},registerSparkline:function(sp){this.splist.push(sp);this.over&&this.updateDisplay()},registerCanvas:function(canvas){var $canvas=$(canvas.canvas);this.canvas=canvas;this.$canvas=$canvas;$canvas.mouseenter($.proxy(this.mouseenter,this));$canvas.mouseleave($.proxy(this.mouseleave,this));$canvas.click($.proxy(this.mouseclick,this))},reset:function(removeTooltip){this.splist=[];if(this.tooltip&&removeTooltip){this.tooltip.remove();this.tooltip=undefined}},mouseclick:function(e){var clickEvent=$.Event("sparklineClick");clickEvent.originalEvent=e;clickEvent.sparklines=this.splist;this.$el.trigger(clickEvent)},mouseenter:function(e){$(document.body).unbind("mousemove.jqs");$(document.body).bind("mousemove.jqs",$.proxy(this.mousemove,this));this.over=!0;this.currentPageX=e.pageX;this.currentPageY=e.pageY;this.currentEl=e.target;if(!this.tooltip&&this.displayTooltips){this.tooltip=new Tooltip(this.options);this.tooltip.updatePosition(e.pageX,e.pageY)}this.updateDisplay()},mouseleave:function(){$(document.body).unbind("mousemove.jqs");var sp,i,splist=this.splist,spcount=splist.length,needsRefresh=!1;this.over=!1;this.currentEl=null;if(this.tooltip){this.tooltip.remove();this.tooltip=null}for(i=0;spcount>i;i++){sp=splist[i];sp.clearRegionHighlight()&&(needsRefresh=!0)}needsRefresh&&this.canvas.render()},mousemove:function(e){this.currentPageX=e.pageX;this.currentPageY=e.pageY;this.currentEl=e.target;this.tooltip&&this.tooltip.updatePosition(e.pageX,e.pageY);this.updateDisplay()},updateDisplay:function(){var tooltiphtml,sp,i,result,changeEvent,splist=this.splist,spcount=splist.length,needsRefresh=!1,offset=this.$canvas.offset(),localX=this.currentPageX-offset.left,localY=this.currentPageY-offset.top;if(this.over){for(i=0;spcount>i;i++){sp=splist[i];result=sp.setRegionHighlight(this.currentEl,localX,localY);result&&(needsRefresh=!0)}if(needsRefresh){changeEvent=$.Event("sparklineRegionChange");changeEvent.sparklines=this.splist;this.$el.trigger(changeEvent);if(this.tooltip){tooltiphtml="";for(i=0;spcount>i;i++){sp=splist[i];tooltiphtml+=sp.getCurrentRegionTooltip()}this.tooltip.setContent(tooltiphtml)}this.disableHighlight||this.canvas.render()}null===result&&this.mouseleave()}}});Tooltip=createClass({sizeStyle:"position: static !important;display: block !important;visibility: hidden !important;float: left !important;",init:function(options){var offset,tooltipClassname=options.get("tooltipClassname","jqstooltip"),sizetipStyle=this.sizeStyle;this.container=options.get("tooltipContainer")||document.body;this.tooltipOffsetX=options.get("tooltipOffsetX",10);this.tooltipOffsetY=options.get("tooltipOffsetY",12);$("#jqssizetip").remove();$("#jqstooltip").remove();this.sizetip=$("<div/>",{id:"jqssizetip",style:sizetipStyle,"class":tooltipClassname});this.tooltip=$("<div/>",{id:"jqstooltip","class":tooltipClassname}).appendTo(this.container);offset=this.tooltip.offset();this.offsetLeft=offset.left;this.offsetTop=offset.top;this.hidden=!0;$(window).unbind("resize.jqs scroll.jqs");$(window).bind("resize.jqs scroll.jqs",$.proxy(this.updateWindowDims,this));this.updateWindowDims()},updateWindowDims:function(){this.scrollTop=$(window).scrollTop();this.scrollLeft=$(window).scrollLeft();this.scrollRight=this.scrollLeft+$(window).width();this.updatePosition()},getSize:function(content){this.sizetip.html(content).appendTo(this.container);this.width=this.sizetip.width()+1;this.height=this.sizetip.height();this.sizetip.remove()},setContent:function(content){if(content){this.getSize(content);this.tooltip.html(content).css({width:this.width,height:this.height,visibility:"visible"});
if(this.hidden){this.hidden=!1;this.updatePosition()}}else{this.tooltip.css("visibility","hidden");this.hidden=!0}},updatePosition:function(x,y){if(x===undefined){if(this.mousex===undefined)return;x=this.mousex-this.offsetLeft;y=this.mousey-this.offsetTop}else{this.mousex=x-=this.offsetLeft;this.mousey=y-=this.offsetTop}if(this.height&&this.width&&!this.hidden){y-=this.height+this.tooltipOffsetY;x+=this.tooltipOffsetX;y<this.scrollTop&&(y=this.scrollTop);x<this.scrollLeft?x=this.scrollLeft:x+this.width>this.scrollRight&&(x=this.scrollRight-this.width);this.tooltip.css({left:x,top:y})}},remove:function(){this.tooltip.remove();this.sizetip.remove();this.sizetip=this.tooltip=undefined;$(window).unbind("resize.jqs scroll.jqs")}});initStyles=function(){addCSS(defaultStyles)};$(initStyles);pending=[];$.fn.sparkline=function(userValues,userOptions){return this.each(function(){var render,i,options=new $.fn.sparkline.options(this,userOptions),$this=$(this);render=function(){var values,width,height,tmp,mhandler,sp,vals;if("html"===userValues||userValues===undefined){vals=this.getAttribute(options.get("tagValuesAttribute"));(vals===undefined||null===vals)&&(vals=$this.html());values=vals.replace(/(^\s*<!--)|(-->\s*$)|\s+/g,"").split(",")}else values=userValues;width="auto"===options.get("width")?values.length*options.get("defaultPixelsPerValue"):options.get("width");if("auto"===options.get("height")){if(!options.get("composite")||!$.data(this,"_jqs_vcanvas")){tmp=document.createElement("span");tmp.innerHTML="a";$this.html(tmp);height=$(tmp).innerHeight()||$(tmp).height();$(tmp).remove();tmp=null}}else height=options.get("height");if(options.get("disableInteraction"))mhandler=!1;else{mhandler=$.data(this,"_jqs_mhandler");if(mhandler)options.get("composite")||mhandler.reset();else{mhandler=new MouseHandler(this,options);$.data(this,"_jqs_mhandler",mhandler)}}if(!options.get("composite")||$.data(this,"_jqs_vcanvas")){sp=new($.fn.sparkline[options.get("type")])(this,values,options,width,height);sp.render();mhandler&&mhandler.registerSparkline(sp)}else if(!$.data(this,"_jqs_errnotify")){alert("Attempted to attach a composite sparkline to an element with no existing sparkline");$.data(this,"_jqs_errnotify",!0)}};if($(this).html()&&!options.get("disableHiddenCheck")&&$(this).is(":hidden")||!$(this).parents("body").length){if(!options.get("composite")&&$.data(this,"_jqs_pending"))for(i=pending.length;i;i--)pending[i-1][0]==this&&pending.splice(i-1,1);pending.push([this,render]);$.data(this,"_jqs_pending",!0)}else render.call(this)})};$.fn.sparkline.defaults=getDefaults();$.sparkline_display_visible=function(){var el,i,pl,done=[];for(i=0,pl=pending.length;pl>i;i++){el=pending[i][0];if($(el).is(":visible")&&!$(el).parents().is(":hidden")){pending[i][1].call(el);$.data(pending[i][0],"_jqs_pending",!1);done.push(i)}else if(!$(el).closest("html").length&&!$.data(el,"_jqs_pending")){$.data(pending[i][0],"_jqs_pending",!1);done.push(i)}}for(i=done.length;i;i--)pending.splice(done[i-1],1)};$.fn.sparkline.options=createClass({init:function(tag,userOptions){var extendedOptions,defaults,base,tagOptionType;this.userOptions=userOptions=userOptions||{};this.tag=tag;this.tagValCache={};defaults=$.fn.sparkline.defaults;base=defaults.common;this.tagOptionsPrefix=userOptions.enableTagOptions&&(userOptions.tagOptionsPrefix||base.tagOptionsPrefix);tagOptionType=this.getTagSetting("type");extendedOptions=tagOptionType===UNSET_OPTION?defaults[userOptions.type||base.type]:defaults[tagOptionType];this.mergedOptions=$.extend({},base,extendedOptions,userOptions)},getTagSetting:function(key){var val,i,pairs,keyval,prefix=this.tagOptionsPrefix;if(prefix===!1||prefix===undefined)return UNSET_OPTION;if(this.tagValCache.hasOwnProperty(key))val=this.tagValCache.key;else{val=this.tag.getAttribute(prefix+key);if(val===undefined||null===val)val=UNSET_OPTION;else if("["===val.substr(0,1)){val=val.substr(1,val.length-2).split(",");for(i=val.length;i--;)val[i]=normalizeValue(val[i].replace(/(^\s*)|(\s*$)/g,""))}else if("{"===val.substr(0,1)){pairs=val.substr(1,val.length-2).split(",");val={};for(i=pairs.length;i--;){keyval=pairs[i].split(":",2);val[keyval[0].replace(/(^\s*)|(\s*$)/g,"")]=normalizeValue(keyval[1].replace(/(^\s*)|(\s*$)/g,""))}}else val=normalizeValue(val);this.tagValCache.key=val}return val},get:function(key,defaultval){var result,tagOption=this.getTagSetting(key);return tagOption!==UNSET_OPTION?tagOption:(result=this.mergedOptions[key])===undefined?defaultval:result}});$.fn.sparkline._base=createClass({disabled:!1,init:function(el,values,options,width,height){this.el=el;this.$el=$(el);this.values=values;this.options=options;this.width=width;this.height=height;this.currentRegion=undefined},initTarget:function(){var interactive=!this.options.get("disableInteraction");if(this.target=this.$el.simpledraw(this.width,this.height,this.options.get("composite"),interactive)){this.canvasWidth=this.target.pixelWidth;this.canvasHeight=this.target.pixelHeight}else this.disabled=!0},render:function(){if(this.disabled){this.el.innerHTML="";return!1}return!0},getRegion:function(){},setRegionHighlight:function(el,x,y){var newRegion,currentRegion=this.currentRegion,highlightEnabled=!this.options.get("disableHighlight");if(x>this.canvasWidth||y>this.canvasHeight||0>x||0>y)return null;newRegion=this.getRegion(el,x,y);if(currentRegion!==newRegion){currentRegion!==undefined&&highlightEnabled&&this.removeHighlight();this.currentRegion=newRegion;newRegion!==undefined&&highlightEnabled&&this.renderHighlight();return!0}return!1},clearRegionHighlight:function(){if(this.currentRegion!==undefined){this.removeHighlight();this.currentRegion=undefined;return!0}return!1},renderHighlight:function(){this.changeHighlight(!0)},removeHighlight:function(){this.changeHighlight(!1)},changeHighlight:function(){},getCurrentRegionTooltip:function(){var fields,formats,formatlen,fclass,text,i,showFields,showFieldsKey,newFields,fv,formatter,format,fieldlen,j,options=this.options,header="",entries=[];if(this.currentRegion===undefined)return"";fields=this.getCurrentRegionFields();formatter=options.get("tooltipFormatter");if(formatter)return formatter(this,options,fields);options.get("tooltipChartTitle")&&(header+='<div class="jqs jqstitle">'+options.get("tooltipChartTitle")+"</div>\n");formats=this.options.get("tooltipFormat");if(!formats)return"";$.isArray(formats)||(formats=[formats]);$.isArray(fields)||(fields=[fields]);showFields=this.options.get("tooltipFormatFieldlist");showFieldsKey=this.options.get("tooltipFormatFieldlistKey");if(showFields&&showFieldsKey){newFields=[];for(i=fields.length;i--;){fv=fields[i][showFieldsKey];-1!=(j=$.inArray(fv,showFields))&&(newFields[j]=fields[i])}fields=newFields}formatlen=formats.length;fieldlen=fields.length;for(i=0;formatlen>i;i++){format=formats[i];"string"==typeof format&&(format=new SPFormat(format));fclass=format.fclass||"jqsfield";for(j=0;fieldlen>j;j++)if(!fields[j].isNull||!options.get("tooltipSkipNull")){$.extend(fields[j],{prefix:options.get("tooltipPrefix"),suffix:options.get("tooltipSuffix")});text=format.render(fields[j],options.get("tooltipValueLookups"),options);entries.push('<div class="'+fclass+'">'+text+"</div>")}}return entries.length?header+entries.join("\n"):""},getCurrentRegionFields:function(){},calcHighlightColor:function(color,options){var parse,mult,rgbnew,i,highlightColor=options.get("highlightColor"),lighten=options.get("highlightLighten");if(highlightColor)return highlightColor;if(lighten){parse=/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(color)||/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i.exec(color);if(parse){rgbnew=[];mult=4===color.length?16:1;for(i=0;3>i;i++)rgbnew[i]=clipval(Math.round(parseInt(parse[i+1],16)*mult*lighten),0,255);return"rgb("+rgbnew.join(",")+")"}}return color}});barHighlightMixin={changeHighlight:function(highlight){var newShapes,currentRegion=this.currentRegion,target=this.target,shapeids=this.regionShapes[currentRegion];if(shapeids){newShapes=this.renderRegion(currentRegion,highlight);if($.isArray(newShapes)||$.isArray(shapeids)){target.replaceWithShapes(shapeids,newShapes);this.regionShapes[currentRegion]=$.map(newShapes,function(newShape){return newShape.id})}else{target.replaceWithShape(shapeids,newShapes);this.regionShapes[currentRegion]=newShapes.id}}},render:function(){var shapes,ids,i,j,values=this.values,target=this.target,regionShapes=this.regionShapes;if(this.cls._super.render.call(this)){for(i=values.length;i--;){shapes=this.renderRegion(i);if(shapes)if($.isArray(shapes)){ids=[];for(j=shapes.length;j--;){shapes[j].append();ids.push(shapes[j].id)}regionShapes[i]=ids}else{shapes.append();regionShapes[i]=shapes.id}else regionShapes[i]=null}target.render()}}};$.fn.sparkline.line=line=createClass($.fn.sparkline._base,{type:"line",init:function(el,values,options,width,height){line._super.init.call(this,el,values,options,width,height);this.vertices=[];this.regionMap=[];this.xvalues=[];this.yvalues=[];this.yminmax=[];this.hightlightSpotId=null;this.lastShapeId=null;this.initTarget()},getRegion:function(el,x){var i,regionMap=this.regionMap;for(i=regionMap.length;i--;)if(null!==regionMap[i]&&x>=regionMap[i][0]&&x<=regionMap[i][1])return regionMap[i][2];return undefined},getCurrentRegionFields:function(){var currentRegion=this.currentRegion;return{isNull:null===this.yvalues[currentRegion],x:this.xvalues[currentRegion],y:this.yvalues[currentRegion],color:this.options.get("lineColor"),fillColor:this.options.get("fillColor"),offset:currentRegion}},renderHighlight:function(){var highlightSpot,highlightLine,currentRegion=this.currentRegion,target=this.target,vertex=this.vertices[currentRegion],options=this.options,spotRadius=options.get("spotRadius"),highlightSpotColor=options.get("highlightSpotColor"),highlightLineColor=options.get("highlightLineColor");if(vertex){if(spotRadius&&highlightSpotColor){highlightSpot=target.drawCircle(vertex[0],vertex[1],spotRadius,undefined,highlightSpotColor);this.highlightSpotId=highlightSpot.id;target.insertAfterShape(this.lastShapeId,highlightSpot)}if(highlightLineColor){highlightLine=target.drawLine(vertex[0],this.canvasTop,vertex[0],this.canvasTop+this.canvasHeight,highlightLineColor);this.highlightLineId=highlightLine.id;target.insertAfterShape(this.lastShapeId,highlightLine)}}},removeHighlight:function(){var target=this.target;if(this.highlightSpotId){target.removeShapeId(this.highlightSpotId);this.highlightSpotId=null}if(this.highlightLineId){target.removeShapeId(this.highlightLineId);this.highlightLineId=null}},scanValues:function(){var i,val,isStr,isArray,sp,values=this.values,valcount=values.length,xvalues=this.xvalues,yvalues=this.yvalues,yminmax=this.yminmax;for(i=0;valcount>i;i++){val=values[i];isStr="string"==typeof values[i];isArray="object"==typeof values[i]&&values[i]instanceof Array;sp=isStr&&values[i].split(":");if(isStr&&2===sp.length){xvalues.push(Number(sp[0]));yvalues.push(Number(sp[1]));yminmax.push(Number(sp[1]))}else if(isArray){xvalues.push(val[0]);yvalues.push(val[1]);yminmax.push(val[1])}else{xvalues.push(i);if(null===values[i]||"null"===values[i])yvalues.push(null);else{yvalues.push(Number(val));yminmax.push(Number(val))}}}this.options.get("xvalues")&&(xvalues=this.options.get("xvalues"));this.maxy=this.maxyorg=Math.max.apply(Math,yminmax);this.miny=this.minyorg=Math.min.apply(Math,yminmax);this.maxx=Math.max.apply(Math,xvalues);this.minx=Math.min.apply(Math,xvalues);this.xvalues=xvalues;this.yvalues=yvalues;this.yminmax=yminmax},processRangeOptions:function(){var options=this.options,normalRangeMin=options.get("normalRangeMin"),normalRangeMax=options.get("normalRangeMax");if(normalRangeMin!==undefined){normalRangeMin<this.miny&&(this.miny=normalRangeMin);normalRangeMax>this.maxy&&(this.maxy=normalRangeMax)}options.get("chartRangeMin")!==undefined&&(options.get("chartRangeClip")||options.get("chartRangeMin")<this.miny)&&(this.miny=options.get("chartRangeMin"));options.get("chartRangeMax")!==undefined&&(options.get("chartRangeClip")||options.get("chartRangeMax")>this.maxy)&&(this.maxy=options.get("chartRangeMax"));options.get("chartRangeMinX")!==undefined&&(options.get("chartRangeClipX")||options.get("chartRangeMinX")<this.minx)&&(this.minx=options.get("chartRangeMinX"));options.get("chartRangeMaxX")!==undefined&&(options.get("chartRangeClipX")||options.get("chartRangeMaxX")>this.maxx)&&(this.maxx=options.get("chartRangeMaxX"))},drawNormalRange:function(canvasLeft,canvasTop,canvasHeight,canvasWidth,rangey){var normalRangeMin=this.options.get("normalRangeMin"),normalRangeMax=this.options.get("normalRangeMax"),ytop=canvasTop+Math.round(canvasHeight-canvasHeight*((normalRangeMax-this.miny)/rangey)),height=Math.round(canvasHeight*(normalRangeMax-normalRangeMin)/rangey);this.target.drawRect(canvasLeft,ytop,canvasWidth,height,undefined,this.options.get("normalRangeColor")).append()},render:function(){var rangex,rangey,yvallast,canvasTop,canvasLeft,vertex,path,paths,x,y,xnext,xpos,xposnext,last,next,yvalcount,lineShapes,fillShapes,plen,valueSpots,hlSpotsEnabled,color,xvalues,yvalues,i,options=this.options,target=this.target,canvasWidth=this.canvasWidth,canvasHeight=this.canvasHeight,vertices=this.vertices,spotRadius=options.get("spotRadius"),regionMap=this.regionMap;if(line._super.render.call(this)){this.scanValues();this.processRangeOptions();xvalues=this.xvalues;yvalues=this.yvalues;if(this.yminmax.length&&!(this.yvalues.length<2)){canvasTop=canvasLeft=0;rangex=this.maxx-this.minx===0?1:this.maxx-this.minx;rangey=this.maxy-this.miny===0?1:this.maxy-this.miny;yvallast=this.yvalues.length-1;spotRadius&&(4*spotRadius>canvasWidth||4*spotRadius>canvasHeight)&&(spotRadius=0);if(spotRadius){hlSpotsEnabled=options.get("highlightSpotColor")&&!options.get("disableInteraction");(hlSpotsEnabled||options.get("minSpotColor")||options.get("spotColor")&&yvalues[yvallast]===this.miny)&&(canvasHeight-=Math.ceil(spotRadius));if(hlSpotsEnabled||options.get("maxSpotColor")||options.get("spotColor")&&yvalues[yvallast]===this.maxy){canvasHeight-=Math.ceil(spotRadius);canvasTop+=Math.ceil(spotRadius)}if(hlSpotsEnabled||(options.get("minSpotColor")||options.get("maxSpotColor"))&&(yvalues[0]===this.miny||yvalues[0]===this.maxy)){canvasLeft+=Math.ceil(spotRadius);canvasWidth-=Math.ceil(spotRadius)}(hlSpotsEnabled||options.get("spotColor")||options.get("minSpotColor")||options.get("maxSpotColor")&&(yvalues[yvallast]===this.miny||yvalues[yvallast]===this.maxy))&&(canvasWidth-=Math.ceil(spotRadius))}canvasHeight--;options.get("normalRangeMin")===undefined||options.get("drawNormalOnTop")||this.drawNormalRange(canvasLeft,canvasTop,canvasHeight,canvasWidth,rangey);path=[];paths=[path];last=next=null;yvalcount=yvalues.length;for(i=0;yvalcount>i;i++){x=xvalues[i];xnext=xvalues[i+1];y=yvalues[i];xpos=canvasLeft+Math.round((x-this.minx)*(canvasWidth/rangex));xposnext=yvalcount-1>i?canvasLeft+Math.round((xnext-this.minx)*(canvasWidth/rangex)):canvasWidth;next=xpos+(xposnext-xpos)/2;regionMap[i]=[last||0,next,i];last=next;if(null===y){if(i){if(null!==yvalues[i-1]){path=[];paths.push(path)}vertices.push(null)}}else{y<this.miny&&(y=this.miny);y>this.maxy&&(y=this.maxy);path.length||path.push([xpos,canvasTop+canvasHeight]);vertex=[xpos,canvasTop+Math.round(canvasHeight-canvasHeight*((y-this.miny)/rangey))];path.push(vertex);vertices.push(vertex)}}lineShapes=[];fillShapes=[];plen=paths.length;for(i=0;plen>i;i++){path=paths[i];if(path.length){if(options.get("fillColor")){path.push([path[path.length-1][0],canvasTop+canvasHeight]);fillShapes.push(path.slice(0));path.pop()}path.length>2&&(path[0]=[path[0][0],path[1][1]]);lineShapes.push(path)}}plen=fillShapes.length;for(i=0;plen>i;i++)target.drawShape(fillShapes[i],options.get("fillColor"),options.get("fillColor")).append();options.get("normalRangeMin")!==undefined&&options.get("drawNormalOnTop")&&this.drawNormalRange(canvasLeft,canvasTop,canvasHeight,canvasWidth,rangey);plen=lineShapes.length;for(i=0;plen>i;i++)target.drawShape(lineShapes[i],options.get("lineColor"),undefined,options.get("lineWidth")).append();if(spotRadius&&options.get("valueSpots")){valueSpots=options.get("valueSpots");valueSpots.get===undefined&&(valueSpots=new RangeMap(valueSpots));for(i=0;yvalcount>i;i++){color=valueSpots.get(yvalues[i]);color&&target.drawCircle(canvasLeft+Math.round((xvalues[i]-this.minx)*(canvasWidth/rangex)),canvasTop+Math.round(canvasHeight-canvasHeight*((yvalues[i]-this.miny)/rangey)),spotRadius,undefined,color).append()}}spotRadius&&options.get("spotColor")&&null!==yvalues[yvallast]&&target.drawCircle(canvasLeft+Math.round((xvalues[xvalues.length-1]-this.minx)*(canvasWidth/rangex)),canvasTop+Math.round(canvasHeight-canvasHeight*((yvalues[yvallast]-this.miny)/rangey)),spotRadius,undefined,options.get("spotColor")).append();if(this.maxy!==this.minyorg){if(spotRadius&&options.get("minSpotColor")){x=xvalues[$.inArray(this.minyorg,yvalues)];target.drawCircle(canvasLeft+Math.round((x-this.minx)*(canvasWidth/rangex)),canvasTop+Math.round(canvasHeight-canvasHeight*((this.minyorg-this.miny)/rangey)),spotRadius,undefined,options.get("minSpotColor")).append()}if(spotRadius&&options.get("maxSpotColor")){x=xvalues[$.inArray(this.maxyorg,yvalues)];target.drawCircle(canvasLeft+Math.round((x-this.minx)*(canvasWidth/rangex)),canvasTop+Math.round(canvasHeight-canvasHeight*((this.maxyorg-this.miny)/rangey)),spotRadius,undefined,options.get("maxSpotColor")).append()}}this.lastShapeId=target.getLastShapeId();this.canvasTop=canvasTop;target.render()}}}});$.fn.sparkline.bar=bar=createClass($.fn.sparkline._base,barHighlightMixin,{type:"bar",init:function(el,values,options,width,height){var isStackString,groupMin,groupMax,stackRanges,numValues,i,vlen,range,zeroAxis,xaxisOffset,min,max,clipMin,clipMax,stacked,vlist,j,slen,svals,val,yoffset,yMaxCalc,barWidth=parseInt(options.get("barWidth"),10),barSpacing=parseInt(options.get("barSpacing"),10),chartRangeMin=options.get("chartRangeMin"),chartRangeMax=options.get("chartRangeMax"),chartRangeClip=options.get("chartRangeClip"),stackMin=1/0,stackMax=-1/0;bar._super.init.call(this,el,values,options,width,height);for(i=0,vlen=values.length;vlen>i;i++){val=values[i];isStackString="string"==typeof val&&val.indexOf(":")>-1;if(isStackString||$.isArray(val)){stacked=!0;isStackString&&(val=values[i]=normalizeValues(val.split(":")));val=remove(val,null);groupMin=Math.min.apply(Math,val);groupMax=Math.max.apply(Math,val);stackMin>groupMin&&(stackMin=groupMin);groupMax>stackMax&&(stackMax=groupMax)}}this.stacked=stacked;this.regionShapes={};this.barWidth=barWidth;this.barSpacing=barSpacing;this.totalBarWidth=barWidth+barSpacing;this.width=width=values.length*barWidth+(values.length-1)*barSpacing;this.initTarget();if(chartRangeClip){clipMin=chartRangeMin===undefined?-1/0:chartRangeMin;clipMax=chartRangeMax===undefined?1/0:chartRangeMax}numValues=[];stackRanges=stacked?[]:numValues;var stackTotals=[],stackRangesNeg=[];for(i=0,vlen=values.length;vlen>i;i++)if(stacked){vlist=values[i];values[i]=svals=[];stackTotals[i]=0;stackRanges[i]=stackRangesNeg[i]=0;for(j=0,slen=vlist.length;slen>j;j++){val=svals[j]=chartRangeClip?clipval(vlist[j],clipMin,clipMax):vlist[j];if(null!==val){val>0&&(stackTotals[i]+=val);0>stackMin&&stackMax>0?0>val?stackRangesNeg[i]+=Math.abs(val):stackRanges[i]+=val:stackRanges[i]+=Math.abs(val-(0>val?stackMax:stackMin));numValues.push(val)}}}else{val=chartRangeClip?clipval(values[i],clipMin,clipMax):values[i];val=values[i]=normalizeValue(val);null!==val&&numValues.push(val)}this.max=max=Math.max.apply(Math,numValues);this.min=min=Math.min.apply(Math,numValues);this.stackMax=stackMax=stacked?Math.max.apply(Math,stackTotals):max;this.stackMin=stackMin=stacked?Math.min.apply(Math,numValues):min;options.get("chartRangeMin")!==undefined&&(options.get("chartRangeClip")||options.get("chartRangeMin")<min)&&(min=options.get("chartRangeMin"));options.get("chartRangeMax")!==undefined&&(options.get("chartRangeClip")||options.get("chartRangeMax")>max)&&(max=options.get("chartRangeMax"));this.zeroAxis=zeroAxis=options.get("zeroAxis",!0);xaxisOffset=0>=min&&max>=0&&zeroAxis?0:0==zeroAxis?min:min>0?min:max;this.xaxisOffset=xaxisOffset;range=stacked?Math.max.apply(Math,stackRanges)+Math.max.apply(Math,stackRangesNeg):max-min;this.canvasHeightEf=zeroAxis&&0>min?this.canvasHeight-2:this.canvasHeight-1;if(xaxisOffset>min){yMaxCalc=stacked&&max>=0?stackMax:max;yoffset=(yMaxCalc-xaxisOffset)/range*this.canvasHeight;if(yoffset!==Math.ceil(yoffset)){this.canvasHeightEf-=2;yoffset=Math.ceil(yoffset)}}else yoffset=this.canvasHeight;this.yoffset=yoffset;if($.isArray(options.get("colorMap"))){this.colorMapByIndex=options.get("colorMap");this.colorMapByValue=null}else{this.colorMapByIndex=null;this.colorMapByValue=options.get("colorMap");this.colorMapByValue&&this.colorMapByValue.get===undefined&&(this.colorMapByValue=new RangeMap(this.colorMapByValue))}this.range=range},getRegion:function(el,x){var result=Math.floor(x/this.totalBarWidth);return 0>result||result>=this.values.length?undefined:result},getCurrentRegionFields:function(){var value,i,currentRegion=this.currentRegion,values=ensureArray(this.values[currentRegion]),result=[];for(i=values.length;i--;){value=values[i];result.push({isNull:null===value,value:value,color:this.calcColor(i,value,currentRegion),offset:currentRegion})}return result},calcColor:function(stacknum,value,valuenum){var color,newColor,colorMapByIndex=this.colorMapByIndex,colorMapByValue=this.colorMapByValue,options=this.options;color=options.get(this.stacked?"stackedBarColor":0>value?"negBarColor":"barColor");0===value&&options.get("zeroColor")!==undefined&&(color=options.get("zeroColor"));colorMapByValue&&(newColor=colorMapByValue.get(value))?color=newColor:colorMapByIndex&&colorMapByIndex.length>valuenum&&(color=colorMapByIndex[valuenum]);return $.isArray(color)?color[stacknum%color.length]:color},renderRegion:function(valuenum,highlight){var y,height,color,isNull,yoffsetNeg,i,valcount,val,minPlotted,allMin,vals=this.values[valuenum],options=this.options,xaxisOffset=this.xaxisOffset,result=[],range=this.range,stacked=this.stacked,target=this.target,x=valuenum*this.totalBarWidth,canvasHeightEf=this.canvasHeightEf,yoffset=this.yoffset;vals=$.isArray(vals)?vals:[vals];valcount=vals.length;val=vals[0];isNull=all(null,vals);allMin=all(xaxisOffset,vals,!0);if(isNull){if(options.get("nullColor")){color=highlight?options.get("nullColor"):this.calcHighlightColor(options.get("nullColor"),options);y=yoffset>0?yoffset-1:yoffset;return target.drawRect(x,y,this.barWidth-1,0,color,color)}return undefined}yoffsetNeg=yoffset;for(i=0;valcount>i;i++){val=vals[i];if(stacked&&val===xaxisOffset){if(!allMin||minPlotted)continue;minPlotted=!0}height=range>0?Math.floor(canvasHeightEf*(Math.abs(val-xaxisOffset)/range))+1:1;if(xaxisOffset>val||val===xaxisOffset&&0===yoffset){y=yoffsetNeg;yoffsetNeg+=height}else{y=yoffset-height;yoffset-=height}color=this.calcColor(i,val,valuenum);highlight&&(color=this.calcHighlightColor(color,options));result.push(target.drawRect(x,y,this.barWidth-1,height-1,color,color))}return 1===result.length?result[0]:result}});$.fn.sparkline.tristate=tristate=createClass($.fn.sparkline._base,barHighlightMixin,{type:"tristate",init:function(el,values,options,width,height){var barWidth=parseInt(options.get("barWidth"),10),barSpacing=parseInt(options.get("barSpacing"),10);tristate._super.init.call(this,el,values,options,width,height);this.regionShapes={};this.barWidth=barWidth;this.barSpacing=barSpacing;this.totalBarWidth=barWidth+barSpacing;this.values=$.map(values,Number);this.width=width=values.length*barWidth+(values.length-1)*barSpacing;if($.isArray(options.get("colorMap"))){this.colorMapByIndex=options.get("colorMap");this.colorMapByValue=null}else{this.colorMapByIndex=null;this.colorMapByValue=options.get("colorMap");this.colorMapByValue&&this.colorMapByValue.get===undefined&&(this.colorMapByValue=new RangeMap(this.colorMapByValue))}this.initTarget()},getRegion:function(el,x){return Math.floor(x/this.totalBarWidth)},getCurrentRegionFields:function(){var currentRegion=this.currentRegion;return{isNull:this.values[currentRegion]===undefined,value:this.values[currentRegion],color:this.calcColor(this.values[currentRegion],currentRegion),offset:currentRegion}},calcColor:function(value,valuenum){var color,newColor,values=this.values,options=this.options,colorMapByIndex=this.colorMapByIndex,colorMapByValue=this.colorMapByValue;color=colorMapByValue&&(newColor=colorMapByValue.get(value))?newColor:colorMapByIndex&&colorMapByIndex.length>valuenum?colorMapByIndex[valuenum]:options.get(values[valuenum]<0?"negBarColor":values[valuenum]>0?"posBarColor":"zeroBarColor");return color},renderRegion:function(valuenum,highlight){var canvasHeight,height,halfHeight,x,y,color,values=this.values,options=this.options,target=this.target;canvasHeight=target.pixelHeight;halfHeight=Math.round(canvasHeight/2);x=valuenum*this.totalBarWidth;if(values[valuenum]<0){y=halfHeight;height=halfHeight-1}else if(values[valuenum]>0){y=0;height=halfHeight-1}else{y=halfHeight-1;height=2}color=this.calcColor(values[valuenum],valuenum);if(null!==color){highlight&&(color=this.calcHighlightColor(color,options));return target.drawRect(x,y,this.barWidth-1,height-1,color,color)}}});$.fn.sparkline.discrete=discrete=createClass($.fn.sparkline._base,barHighlightMixin,{type:"discrete",init:function(el,values,options,width,height){discrete._super.init.call(this,el,values,options,width,height);this.regionShapes={};this.values=values=$.map(values,Number);this.min=Math.min.apply(Math,values);this.max=Math.max.apply(Math,values);this.range=this.max-this.min;this.width=width="auto"===options.get("width")?2*values.length:this.width;this.interval=Math.floor(width/values.length);this.itemWidth=width/values.length;options.get("chartRangeMin")!==undefined&&(options.get("chartRangeClip")||options.get("chartRangeMin")<this.min)&&(this.min=options.get("chartRangeMin"));options.get("chartRangeMax")!==undefined&&(options.get("chartRangeClip")||options.get("chartRangeMax")>this.max)&&(this.max=options.get("chartRangeMax"));this.initTarget();this.target&&(this.lineHeight="auto"===options.get("lineHeight")?Math.round(.3*this.canvasHeight):options.get("lineHeight"))},getRegion:function(el,x){return Math.floor(x/this.itemWidth)},getCurrentRegionFields:function(){var currentRegion=this.currentRegion;return{isNull:this.values[currentRegion]===undefined,value:this.values[currentRegion],offset:currentRegion}},renderRegion:function(valuenum,highlight){var ytop,val,color,x,values=this.values,options=this.options,min=this.min,max=this.max,range=this.range,interval=this.interval,target=this.target,canvasHeight=this.canvasHeight,lineHeight=this.lineHeight,pheight=canvasHeight-lineHeight;val=clipval(values[valuenum],min,max);x=valuenum*interval;ytop=Math.round(pheight-pheight*((val-min)/range));color=options.get(options.get("thresholdColor")&&val<options.get("thresholdValue")?"thresholdColor":"lineColor");highlight&&(color=this.calcHighlightColor(color,options));return target.drawLine(x,ytop,x,ytop+lineHeight,color)}});$.fn.sparkline.bullet=bullet=createClass($.fn.sparkline._base,{type:"bullet",init:function(el,values,options,width,height){var min,max,vals;bullet._super.init.call(this,el,values,options,width,height);this.values=values=normalizeValues(values);vals=values.slice();vals[0]=null===vals[0]?vals[2]:vals[0];vals[1]=null===values[1]?vals[2]:vals[1];min=Math.min.apply(Math,values);max=Math.max.apply(Math,values);min=options.get("base")===undefined?0>min?min:0:options.get("base");this.min=min;this.max=max;this.range=max-min;this.shapes={};this.valueShapes={};this.regiondata={};this.width=width="auto"===options.get("width")?"4.0em":width;this.target=this.$el.simpledraw(width,height,options.get("composite"));values.length||(this.disabled=!0);this.initTarget()},getRegion:function(el,x,y){var shapeid=this.target.getShapeAt(el,x,y);return shapeid!==undefined&&this.shapes[shapeid]!==undefined?this.shapes[shapeid]:undefined},getCurrentRegionFields:function(){var currentRegion=this.currentRegion;return{fieldkey:currentRegion.substr(0,1),value:this.values[currentRegion.substr(1)],region:currentRegion}},changeHighlight:function(highlight){var shape,currentRegion=this.currentRegion,shapeid=this.valueShapes[currentRegion];delete this.shapes[shapeid];switch(currentRegion.substr(0,1)){case"r":shape=this.renderRange(currentRegion.substr(1),highlight);break;case"p":shape=this.renderPerformance(highlight);break;case"t":shape=this.renderTarget(highlight)}this.valueShapes[currentRegion]=shape.id;this.shapes[shape.id]=currentRegion;this.target.replaceWithShape(shapeid,shape)},renderRange:function(rn,highlight){var rangeval=this.values[rn],rangewidth=Math.round(this.canvasWidth*((rangeval-this.min)/this.range)),color=this.options.get("rangeColors")[rn-2];highlight&&(color=this.calcHighlightColor(color,this.options));return this.target.drawRect(0,0,rangewidth-1,this.canvasHeight-1,color,color)},renderPerformance:function(highlight){var perfval=this.values[1],perfwidth=Math.round(this.canvasWidth*((perfval-this.min)/this.range)),color=this.options.get("performanceColor");highlight&&(color=this.calcHighlightColor(color,this.options));return this.target.drawRect(0,Math.round(.3*this.canvasHeight),perfwidth-1,Math.round(.4*this.canvasHeight)-1,color,color)},renderTarget:function(highlight){var targetval=this.values[0],x=Math.round(this.canvasWidth*((targetval-this.min)/this.range)-this.options.get("targetWidth")/2),targettop=Math.round(.1*this.canvasHeight),targetheight=this.canvasHeight-2*targettop,color=this.options.get("targetColor");highlight&&(color=this.calcHighlightColor(color,this.options));return this.target.drawRect(x,targettop,this.options.get("targetWidth")-1,targetheight-1,color,color)},render:function(){var i,shape,vlen=this.values.length,target=this.target;if(bullet._super.render.call(this)){for(i=2;vlen>i;i++){shape=this.renderRange(i).append();this.shapes[shape.id]="r"+i;this.valueShapes["r"+i]=shape.id}if(null!==this.values[1]){shape=this.renderPerformance().append();this.shapes[shape.id]="p1";this.valueShapes.p1=shape.id}if(null!==this.values[0]){shape=this.renderTarget().append();this.shapes[shape.id]="t0";this.valueShapes.t0=shape.id}target.render()}}});$.fn.sparkline.pie=pie=createClass($.fn.sparkline._base,{type:"pie",init:function(el,values,options,width,height){var i,total=0;pie._super.init.call(this,el,values,options,width,height);this.shapes={};this.valueShapes={};this.values=values=$.map(values,Number);"auto"===options.get("width")&&(this.width=this.height);if(values.length>0)for(i=values.length;i--;)total+=values[i];this.total=total;this.initTarget();this.radius=Math.floor(Math.min(this.canvasWidth,this.canvasHeight)/2)},getRegion:function(el,x,y){var shapeid=this.target.getShapeAt(el,x,y);return shapeid!==undefined&&this.shapes[shapeid]!==undefined?this.shapes[shapeid]:undefined},getCurrentRegionFields:function(){var currentRegion=this.currentRegion;return{isNull:this.values[currentRegion]===undefined,value:this.values[currentRegion],percent:this.values[currentRegion]/this.total*100,color:this.options.get("sliceColors")[currentRegion%this.options.get("sliceColors").length],offset:currentRegion}},changeHighlight:function(highlight){var currentRegion=this.currentRegion,newslice=this.renderSlice(currentRegion,highlight),shapeid=this.valueShapes[currentRegion];delete this.shapes[shapeid];this.target.replaceWithShape(shapeid,newslice);this.valueShapes[currentRegion]=newslice.id;this.shapes[newslice.id]=currentRegion},renderSlice:function(valuenum,highlight){var start,end,i,vlen,color,target=this.target,options=this.options,radius=this.radius,borderWidth=options.get("borderWidth"),offset=options.get("offset"),circle=2*Math.PI,values=this.values,total=this.total,next=offset?2*Math.PI*(offset/360):0;vlen=values.length;for(i=0;vlen>i;i++){start=next;end=next;total>0&&(end=next+circle*(values[i]/total));
if(valuenum===i){color=options.get("sliceColors")[i%options.get("sliceColors").length];highlight&&(color=this.calcHighlightColor(color,options));return target.drawPieSlice(radius,radius,radius-borderWidth,start,end,undefined,color)}next=end}},render:function(){var shape,i,target=this.target,values=this.values,options=this.options,radius=this.radius,borderWidth=options.get("borderWidth");if(pie._super.render.call(this)){borderWidth&&target.drawCircle(radius,radius,Math.floor(radius-borderWidth/2),options.get("borderColor"),undefined,borderWidth).append();for(i=values.length;i--;)if(values[i]){shape=this.renderSlice(i).append();this.valueShapes[i]=shape.id;this.shapes[shape.id]=i}target.render()}}});$.fn.sparkline.box=box=createClass($.fn.sparkline._base,{type:"box",init:function(el,values,options,width,height){box._super.init.call(this,el,values,options,width,height);this.values=$.map(values,Number);this.width="auto"===options.get("width")?"4.0em":width;this.initTarget();this.values.length||(this.disabled=1)},getRegion:function(){return 1},getCurrentRegionFields:function(){var result=[{field:"lq",value:this.quartiles[0]},{field:"med",value:this.quartiles[1]},{field:"uq",value:this.quartiles[2]}];this.loutlier!==undefined&&result.push({field:"lo",value:this.loutlier});this.routlier!==undefined&&result.push({field:"ro",value:this.routlier});this.lwhisker!==undefined&&result.push({field:"lw",value:this.lwhisker});this.rwhisker!==undefined&&result.push({field:"rw",value:this.rwhisker});return result},render:function(){var lwhisker,loutlier,iqr,q1,q2,q3,rwhisker,routlier,i,size,unitSize,target=this.target,values=this.values,vlen=values.length,options=this.options,canvasWidth=this.canvasWidth,canvasHeight=this.canvasHeight,minValue=options.get("chartRangeMin")===undefined?Math.min.apply(Math,values):options.get("chartRangeMin"),maxValue=options.get("chartRangeMax")===undefined?Math.max.apply(Math,values):options.get("chartRangeMax"),canvasLeft=0;if(box._super.render.call(this)){if(options.get("raw"))if(options.get("showOutliers")&&values.length>5){loutlier=values[0];lwhisker=values[1];q1=values[2];q2=values[3];q3=values[4];rwhisker=values[5];routlier=values[6]}else{lwhisker=values[0];q1=values[1];q2=values[2];q3=values[3];rwhisker=values[4]}else{values.sort(function(a,b){return a-b});q1=quartile(values,1);q2=quartile(values,2);q3=quartile(values,3);iqr=q3-q1;if(options.get("showOutliers")){lwhisker=rwhisker=undefined;for(i=0;vlen>i;i++){lwhisker===undefined&&values[i]>q1-iqr*options.get("outlierIQR")&&(lwhisker=values[i]);values[i]<q3+iqr*options.get("outlierIQR")&&(rwhisker=values[i])}loutlier=values[0];routlier=values[vlen-1]}else{lwhisker=values[0];rwhisker=values[vlen-1]}}this.quartiles=[q1,q2,q3];this.lwhisker=lwhisker;this.rwhisker=rwhisker;this.loutlier=loutlier;this.routlier=routlier;unitSize=canvasWidth/(maxValue-minValue+1);if(options.get("showOutliers")){canvasLeft=Math.ceil(options.get("spotRadius"));canvasWidth-=2*Math.ceil(options.get("spotRadius"));unitSize=canvasWidth/(maxValue-minValue+1);lwhisker>loutlier&&target.drawCircle((loutlier-minValue)*unitSize+canvasLeft,canvasHeight/2,options.get("spotRadius"),options.get("outlierLineColor"),options.get("outlierFillColor")).append();routlier>rwhisker&&target.drawCircle((routlier-minValue)*unitSize+canvasLeft,canvasHeight/2,options.get("spotRadius"),options.get("outlierLineColor"),options.get("outlierFillColor")).append()}target.drawRect(Math.round((q1-minValue)*unitSize+canvasLeft),Math.round(.1*canvasHeight),Math.round((q3-q1)*unitSize),Math.round(.8*canvasHeight),options.get("boxLineColor"),options.get("boxFillColor")).append();target.drawLine(Math.round((lwhisker-minValue)*unitSize+canvasLeft),Math.round(canvasHeight/2),Math.round((q1-minValue)*unitSize+canvasLeft),Math.round(canvasHeight/2),options.get("lineColor")).append();target.drawLine(Math.round((lwhisker-minValue)*unitSize+canvasLeft),Math.round(canvasHeight/4),Math.round((lwhisker-minValue)*unitSize+canvasLeft),Math.round(canvasHeight-canvasHeight/4),options.get("whiskerColor")).append();target.drawLine(Math.round((rwhisker-minValue)*unitSize+canvasLeft),Math.round(canvasHeight/2),Math.round((q3-minValue)*unitSize+canvasLeft),Math.round(canvasHeight/2),options.get("lineColor")).append();target.drawLine(Math.round((rwhisker-minValue)*unitSize+canvasLeft),Math.round(canvasHeight/4),Math.round((rwhisker-minValue)*unitSize+canvasLeft),Math.round(canvasHeight-canvasHeight/4),options.get("whiskerColor")).append();target.drawLine(Math.round((q2-minValue)*unitSize+canvasLeft),Math.round(.1*canvasHeight),Math.round((q2-minValue)*unitSize+canvasLeft),Math.round(.9*canvasHeight),options.get("medianColor")).append();if(options.get("target")){size=Math.ceil(options.get("spotRadius"));target.drawLine(Math.round((options.get("target")-minValue)*unitSize+canvasLeft),Math.round(canvasHeight/2-size),Math.round((options.get("target")-minValue)*unitSize+canvasLeft),Math.round(canvasHeight/2+size),options.get("targetColor")).append();target.drawLine(Math.round((options.get("target")-minValue)*unitSize+canvasLeft-size),Math.round(canvasHeight/2),Math.round((options.get("target")-minValue)*unitSize+canvasLeft+size),Math.round(canvasHeight/2),options.get("targetColor")).append()}target.render()}}});VShape=createClass({init:function(target,id,type,args){this.target=target;this.id=id;this.type=type;this.args=args},append:function(){this.target.appendShape(this);return this}});VCanvas_base=createClass({_pxregex:/(\d+)(px)?\s*$/i,init:function(width,height,target){if(width){this.width=width;this.height=height;this.target=target;this.lastShapeId=null;target[0]&&(target=target[0]);$.data(target,"_jqs_vcanvas",this)}},drawLine:function(x1,y1,x2,y2,lineColor,lineWidth){return this.drawShape([[x1,y1],[x2,y2]],lineColor,lineWidth)},drawShape:function(path,lineColor,fillColor,lineWidth){return this._genShape("Shape",[path,lineColor,fillColor,lineWidth])},drawCircle:function(x,y,radius,lineColor,fillColor,lineWidth){return this._genShape("Circle",[x,y,radius,lineColor,fillColor,lineWidth])},drawPieSlice:function(x,y,radius,startAngle,endAngle,lineColor,fillColor){return this._genShape("PieSlice",[x,y,radius,startAngle,endAngle,lineColor,fillColor])},drawRect:function(x,y,width,height,lineColor,fillColor){return this._genShape("Rect",[x,y,width,height,lineColor,fillColor])},getElement:function(){return this.canvas},getLastShapeId:function(){return this.lastShapeId},reset:function(){alert("reset not implemented")},_insert:function(el,target){$(target).html(el)},_calculatePixelDims:function(width,height,canvas){var match;match=this._pxregex.exec(height);this.pixelHeight=match?match[1]:$(canvas).height();match=this._pxregex.exec(width);this.pixelWidth=match?match[1]:$(canvas).width()},_genShape:function(shapetype,shapeargs){var id=shapeCount++;shapeargs.unshift(id);return new VShape(this,id,shapetype,shapeargs)},appendShape:function(){alert("appendShape not implemented")},replaceWithShape:function(){alert("replaceWithShape not implemented")},insertAfterShape:function(){alert("insertAfterShape not implemented")},removeShapeId:function(){alert("removeShapeId not implemented")},getShapeAt:function(){alert("getShapeAt not implemented")},render:function(){alert("render not implemented")}});VCanvas_canvas=createClass(VCanvas_base,{init:function(width,height,target,interact){VCanvas_canvas._super.init.call(this,width,height,target);this.canvas=document.createElement("canvas");target[0]&&(target=target[0]);$.data(target,"_jqs_vcanvas",this);$(this.canvas).css({display:"inline-block",width:width,height:height,verticalAlign:"top"});this._insert(this.canvas,target);this._calculatePixelDims(width,height,this.canvas);this.canvas.width=this.pixelWidth;this.canvas.height=this.pixelHeight;this.interact=interact;this.shapes={};this.shapeseq=[];this.currentTargetShapeId=undefined;$(this.canvas).css({width:this.pixelWidth,height:this.pixelHeight})},_getContext:function(lineColor,fillColor,lineWidth){var context=this.canvas.getContext("2d");lineColor!==undefined&&(context.strokeStyle=lineColor);context.lineWidth=lineWidth===undefined?1:lineWidth;fillColor!==undefined&&(context.fillStyle=fillColor);return context},reset:function(){var context=this._getContext();context.clearRect(0,0,this.pixelWidth,this.pixelHeight);this.shapes={};this.shapeseq=[];this.currentTargetShapeId=undefined},_drawShape:function(shapeid,path,lineColor,fillColor,lineWidth){var i,plen,context=this._getContext(lineColor,fillColor,lineWidth);context.beginPath();context.moveTo(path[0][0]+.5,path[0][1]+.5);for(i=1,plen=path.length;plen>i;i++)context.lineTo(path[i][0]+.5,path[i][1]+.5);lineColor!==undefined&&context.stroke();fillColor!==undefined&&context.fill();this.targetX!==undefined&&this.targetY!==undefined&&context.isPointInPath(this.targetX,this.targetY)&&(this.currentTargetShapeId=shapeid)},_drawCircle:function(shapeid,x,y,radius,lineColor,fillColor,lineWidth){var context=this._getContext(lineColor,fillColor,lineWidth);context.beginPath();context.arc(x,y,radius,0,2*Math.PI,!1);this.targetX!==undefined&&this.targetY!==undefined&&context.isPointInPath(this.targetX,this.targetY)&&(this.currentTargetShapeId=shapeid);lineColor!==undefined&&context.stroke();fillColor!==undefined&&context.fill()},_drawPieSlice:function(shapeid,x,y,radius,startAngle,endAngle,lineColor,fillColor){var context=this._getContext(lineColor,fillColor);context.beginPath();context.moveTo(x,y);context.arc(x,y,radius,startAngle,endAngle,!1);context.lineTo(x,y);context.closePath();lineColor!==undefined&&context.stroke();fillColor&&context.fill();this.targetX!==undefined&&this.targetY!==undefined&&context.isPointInPath(this.targetX,this.targetY)&&(this.currentTargetShapeId=shapeid)},_drawRect:function(shapeid,x,y,width,height,lineColor,fillColor){return this._drawShape(shapeid,[[x,y],[x+width,y],[x+width,y+height],[x,y+height],[x,y]],lineColor,fillColor)},appendShape:function(shape){this.shapes[shape.id]=shape;this.shapeseq.push(shape.id);this.lastShapeId=shape.id;return shape.id},replaceWithShape:function(shapeid,shape){var i,shapeseq=this.shapeseq;this.shapes[shape.id]=shape;for(i=shapeseq.length;i--;)shapeseq[i]==shapeid&&(shapeseq[i]=shape.id);delete this.shapes[shapeid]},replaceWithShapes:function(shapeids,shapes){var sid,i,first,shapeseq=this.shapeseq,shapemap={};for(i=shapeids.length;i--;)shapemap[shapeids[i]]=!0;for(i=shapeseq.length;i--;){sid=shapeseq[i];if(shapemap[sid]){shapeseq.splice(i,1);delete this.shapes[sid];first=i}}for(i=shapes.length;i--;){shapeseq.splice(first,0,shapes[i].id);this.shapes[shapes[i].id]=shapes[i]}},insertAfterShape:function(shapeid,shape){var i,shapeseq=this.shapeseq;for(i=shapeseq.length;i--;)if(shapeseq[i]===shapeid){shapeseq.splice(i+1,0,shape.id);this.shapes[shape.id]=shape;return}},removeShapeId:function(shapeid){var i,shapeseq=this.shapeseq;for(i=shapeseq.length;i--;)if(shapeseq[i]===shapeid){shapeseq.splice(i,1);break}delete this.shapes[shapeid]},getShapeAt:function(el,x,y){this.targetX=x;this.targetY=y;this.render();return this.currentTargetShapeId},render:function(){var shapeid,shape,i,shapeseq=this.shapeseq,shapes=this.shapes,shapeCount=shapeseq.length,context=this._getContext();context.clearRect(0,0,this.pixelWidth,this.pixelHeight);for(i=0;shapeCount>i;i++){shapeid=shapeseq[i];shape=shapes[shapeid];this["_draw"+shape.type].apply(this,shape.args)}if(!this.interact){this.shapes={};this.shapeseq=[]}}});VCanvas_vml=createClass(VCanvas_base,{init:function(width,height,target){var groupel;VCanvas_vml._super.init.call(this,width,height,target);target[0]&&(target=target[0]);$.data(target,"_jqs_vcanvas",this);this.canvas=document.createElement("span");$(this.canvas).css({display:"inline-block",position:"relative",overflow:"hidden",width:width,height:height,margin:"0px",padding:"0px",verticalAlign:"top"});this._insert(this.canvas,target);this._calculatePixelDims(width,height,this.canvas);this.canvas.width=this.pixelWidth;this.canvas.height=this.pixelHeight;groupel='<v:group coordorigin="0 0" coordsize="'+this.pixelWidth+" "+this.pixelHeight+'" style="position:absolute;top:0;left:0;width:'+this.pixelWidth+"px;height="+this.pixelHeight+'px;"></v:group>';this.canvas.insertAdjacentHTML("beforeEnd",groupel);this.group=$(this.canvas).children()[0];this.rendered=!1;this.prerender=""},_drawShape:function(shapeid,path,lineColor,fillColor,lineWidth){var initial,stroke,fill,closed,vel,plen,i,vpath=[];for(i=0,plen=path.length;plen>i;i++)vpath[i]=""+path[i][0]+","+path[i][1];initial=vpath.splice(0,1);lineWidth=lineWidth===undefined?1:lineWidth;stroke=lineColor===undefined?' stroked="false" ':' strokeWeight="'+lineWidth+'px" strokeColor="'+lineColor+'" ';fill=fillColor===undefined?' filled="false"':' fillColor="'+fillColor+'" filled="true" ';closed=vpath[0]===vpath[vpath.length-1]?"x ":"";vel='<v:shape coordorigin="0 0" coordsize="'+this.pixelWidth+" "+this.pixelHeight+'"  id="jqsshape'+shapeid+'" '+stroke+fill+' style="position:absolute;left:0px;top:0px;height:'+this.pixelHeight+"px;width:"+this.pixelWidth+'px;padding:0px;margin:0px;"  path="m '+initial+" l "+vpath.join(", ")+" "+closed+'e"> </v:shape>';return vel},_drawCircle:function(shapeid,x,y,radius,lineColor,fillColor,lineWidth){var stroke,fill,vel;x-=radius;y-=radius;stroke=lineColor===undefined?' stroked="false" ':' strokeWeight="'+lineWidth+'px" strokeColor="'+lineColor+'" ';fill=fillColor===undefined?' filled="false"':' fillColor="'+fillColor+'" filled="true" ';vel='<v:oval  id="jqsshape'+shapeid+'" '+stroke+fill+' style="position:absolute;top:'+y+"px; left:"+x+"px; width:"+2*radius+"px; height:"+2*radius+'px"></v:oval>';return vel},_drawPieSlice:function(shapeid,x,y,radius,startAngle,endAngle,lineColor,fillColor){var vpath,startx,starty,endx,endy,stroke,fill,vel;if(startAngle===endAngle)return"";if(endAngle-startAngle===2*Math.PI){startAngle=0;endAngle=2*Math.PI}startx=x+Math.round(Math.cos(startAngle)*radius);starty=y+Math.round(Math.sin(startAngle)*radius);endx=x+Math.round(Math.cos(endAngle)*radius);endy=y+Math.round(Math.sin(endAngle)*radius);if(startx===endx&&starty===endy){if(endAngle-startAngle<Math.PI)return"";startx=endx=x+radius;starty=endy=y}if(startx===endx&&starty===endy&&endAngle-startAngle<Math.PI)return"";vpath=[x-radius,y-radius,x+radius,y+radius,startx,starty,endx,endy];stroke=lineColor===undefined?' stroked="false" ':' strokeWeight="1px" strokeColor="'+lineColor+'" ';fill=fillColor===undefined?' filled="false"':' fillColor="'+fillColor+'" filled="true" ';vel='<v:shape coordorigin="0 0" coordsize="'+this.pixelWidth+" "+this.pixelHeight+'"  id="jqsshape'+shapeid+'" '+stroke+fill+' style="position:absolute;left:0px;top:0px;height:'+this.pixelHeight+"px;width:"+this.pixelWidth+'px;padding:0px;margin:0px;"  path="m '+x+","+y+" wa "+vpath.join(", ")+' x e"> </v:shape>';return vel},_drawRect:function(shapeid,x,y,width,height,lineColor,fillColor){return this._drawShape(shapeid,[[x,y],[x,y+height],[x+width,y+height],[x+width,y],[x,y]],lineColor,fillColor)},reset:function(){this.group.innerHTML=""},appendShape:function(shape){var vel=this["_draw"+shape.type].apply(this,shape.args);this.rendered?this.group.insertAdjacentHTML("beforeEnd",vel):this.prerender+=vel;this.lastShapeId=shape.id;return shape.id},replaceWithShape:function(shapeid,shape){var existing=$("#jqsshape"+shapeid),vel=this["_draw"+shape.type].apply(this,shape.args);existing[0].outerHTML=vel},replaceWithShapes:function(shapeids,shapes){var i,existing=$("#jqsshape"+shapeids[0]),replace="",slen=shapes.length;for(i=0;slen>i;i++)replace+=this["_draw"+shapes[i].type].apply(this,shapes[i].args);existing[0].outerHTML=replace;for(i=1;i<shapeids.length;i++)$("#jqsshape"+shapeids[i]).remove()},insertAfterShape:function(shapeid,shape){var existing=$("#jqsshape"+shapeid),vel=this["_draw"+shape.type].apply(this,shape.args);existing[0].insertAdjacentHTML("afterEnd",vel)},removeShapeId:function(shapeid){var existing=$("#jqsshape"+shapeid);this.group.removeChild(existing[0])},getShapeAt:function(el){var shapeid=el.id.substr(8);return shapeid},render:function(){if(!this.rendered){this.group.innerHTML=this.prerender;this.rendered=!0}}})})}(document,Math);define("views/shared/results_table/renderers/NullCellRenderer",["require","exports","module","underscore","./BaseCellRenderer"],function(require){var _=require("underscore"),BaseCellRenderer=require("./BaseCellRenderer");return BaseCellRenderer.extend({canRender:function(cellData){return _.isNull(cellData.value)||_.isEqual(cellData.value,[])},render:function($td){$td.html("&nbsp;")}})});define("views/shared/results_table/renderers/NumberCellRenderer",["require","exports","module","underscore","../ResultsTableRow","./BaseCellRenderer"],function(require){var _=require("underscore"),ResultsTableRow=require("../ResultsTableRow"),BaseCellRenderer=require("./BaseCellRenderer");return BaseCellRenderer.extend({canRender:function(cellData){return"number"===cellData.columnType},setup:function($td){$td.addClass("numeric")},teardown:function($td){$td.removeClass("numeric with-overlay")},render:function($td,cellData){cellData=_.extend({floatValue:parseFloat(cellData.value),heatValue:"heatmap"===cellData.dataOverlay?Math.min(Math.max(Math.ceil(cellData.value/cellData.heatDelta*1e3)/1e3,-1),1):null,MV_SUBCELL_CLASSNAME:ResultsTableRow.MV_SUBCELL_CLASSNAME,MV_INDEX_ATTR:ResultsTableRow.MV_INDEX_ATTR},cellData);"highlow"===cellData.dataOverlay||"heatmap"===cellData.dataOverlay?$td.addClass("with-overlay"):$td.removeClass("with-overlay");$td.html(_.template(this.template,cellData))},template:'            <% if (dataOverlay === "heatmap") { %>                <div class="overlay-cell">                    <div class="overlay-cell-value heat-value" style="opacity: <%- heatValue %>; filter: alpha(opacity=<%- heatValue * 100 %>);"></div>                </div>            <% } else if (dataOverlay === "highlow") { %>                <% if (floatValue === extremes.min) { %>                    <div class="overlay-cell">                        <div class="overlay-cell-value min-value"></div>                    </div>                <% } else if (floatValue === extremes.max) { %>                    <div class="overlay-cell">                        <div class="overlay-cell-value max-value"></div>                    </div>                <% } else { %>                    <div class="overlay-cell">                        <div class="overlay-cell-value no-value"></div>                    </div>                <% } %>            <% } %>            <% if (_.isArray(value)) { %>                <% _(value).each(function(subValue, i) { %>                    <div class="<%- MV_SUBCELL_CLASSNAME %>" <%- MV_INDEX_ATTR %>="<%- i %>">                        <%- subValue %>                    </div>                <% }) %>            <% } else { %>                <%- value %>            <% } %>        '})});define("views/shared/results_table/renderers/SparklineCellRenderer",["require","exports","module","jquery","underscore","jquery.sparkline","./BaseCellRenderer"],function(require){var _=(require("jquery"),require("underscore")),BaseCellRenderer=(require("jquery.sparkline"),require("./BaseCellRenderer")),DEFAULT_SPARKLINE_SETTINGS={type:"line",lineColor:"#65A637",highlightSpotColor:null,minSpotColor:null,maxSpotColor:null,spotColor:null,fillColor:null};return BaseCellRenderer.extend({canRender:function(cellData){return _.isArray(cellData.value)&&"##__SPARKLINE__##"===cellData.value[0]},render:function($td,cellData){var sparklineSettings=_.extend({},DEFAULT_SPARKLINE_SETTINGS,cellData.sparklineFormat);$td.sparkline(_.isArray(cellData.value)?_.map(cellData.value.slice(1),function(v){return v&&parseFloat(v)||0}):[],sparklineSettings)}})});define("views/shared/results_table/renderers/StringCellRenderer",["require","exports","module","underscore","../ResultsTableRow","./BaseCellRenderer"],function(require){var _=require("underscore"),ResultsTableRow=require("../ResultsTableRow"),BaseCellRenderer=require("./BaseCellRenderer");return BaseCellRenderer.extend({canRender:function(){return!0},render:function($td,cellData){cellData=_.extend({MV_SUBCELL_CLASSNAME:ResultsTableRow.MV_SUBCELL_CLASSNAME,MV_INDEX_ATTR:ResultsTableRow.MV_INDEX_ATTR},cellData);$td.html(_.template(this.template,cellData))},template:'            <% if (_.isArray(value)) { %>                <% _(value).each(function(subValue, i) { %>                    <div class="<%- MV_SUBCELL_CLASSNAME %>" <%- MV_INDEX_ATTR %>="<%- i %>">                        <%- subValue %>                    </div>                <% }) %>            <% } else { %>                <%- value %>            <% } %>        '})});define("views/shared/results_table/renderers/TimeCellRenderer",["require","exports","module","underscore","splunk.i18n","util/time","./BaseCellRenderer"],function(require){var _=require("underscore"),i18n=require("splunk.i18n"),TimeUtils=require("util/time"),BaseCellRenderer=require("./BaseCellRenderer");return BaseCellRenderer.extend({canRender:function(cellData){return"timestamp"===cellData.columnType},setup:function($td){$td.addClass("timestamp")},teardown:function($td){$td.removeClass("timestamp")},render:function($td,cellData){cellData=_.extend({formattedValue:"ALL"!==cellData.value?i18n.format_date(TimeUtils.isoToDateObject(cellData.value),cellData.timestampFormat):cellData.value},cellData);$td.html(_.template(this.template,cellData))},template:"            <%- formattedValue %>        "})});define("views/shared/results_table/ResultsTableMaster",["jquery","underscore","module","views/Base","./ResultsTableHeader","./ResultsTableRow","views/shared/delegates/ColumnSort","views/shared/delegates/TableDock","views/shared/delegates/TableHeadStatic","helpers/grid/RowIterator","helpers/Printer","splunk.util","util/general_utils","util/time","util/math_utils","jquery.sparkline","./renderers/BaseCellRenderer","./renderers/BaseRowExpansionRenderer","./renderers/NullCellRenderer","./renderers/NumberCellRenderer","./renderers/SparklineCellRenderer","./renderers/StringCellRenderer","./renderers/TimeCellRenderer","util/console"],function($,_,module,Base,ResultsTableHeader,ResultsTableRow,ColumnSort,TableDock,TableHeadStatic,RowIterator,Printer,splunkUtils,generalUtils,timeUtils,mathUtils,_sparkline,BaseCellRenderer,BaseRowExpansionRenderer,NullCellRenderer,NumberCellRenderer,SparklineCellRenderer,StringCellRenderer,TimeCellRenderer,console){var DATA_FIELD_REGEX=/^[^_]|^_time$|^_raw$/,TIMESTAMP_FORMATS={year:"YYYY",month:"YYYY-MM",day:"YYYY-MM-dd",hour:"YYYY-MM-dd HH:00",minute:"YYYY-MM-dd HH:mm:00",second:"YYYY-MM-dd HH:mm:ss"},REPORT_FORMAT_ATTRIBUTES=["display.statistics.wrap","display.statistics.rowNumbers","display.statistics.overlay","display.statistics.sparkline.format"],MV_SUBCELL_SELECTOR="."+ResultsTableRow.MV_SUBCELL_CLASSNAME,ENTER_KEY=13;return Base.extend({moduleId:module.id,events:{"mouseover tbody td":function(e){this.handleCellMouseover($(e.target))},"mouseout tbody td":function(e){this.handleCellMouseout($(e.target))},"mousedown tbody td":function(e){this.handleCellMousedown($(e.target),e)},"click tbody td":function(e){this.handleCellClick($(e.target),e)},"keypress tbody td":function(e){e.which===ENTER_KEY&&this.handleCellClick($(e.target),e)},"keypress tbody tr":function(e){e.which===ENTER_KEY&&this.handleCellClick($(e.target).find("td").first(),e)}},initialize:function(options){Base.prototype.initialize.call(this,options);if(this.options.enableStaticHeader&&this.options.enableTableDock!==!1)throw new Error("Static header and docking header cannot be enabled at the same time");var defaults={sortKeyAttr:"sortKey",sortDirAttr:"sortDirection",sortableFields:!0,countAttr:"count",offsetAttr:"offset",numRowSplits:1,headerClass:ResultsTableHeader};this.options=$.extend(!0,defaults,this.options);this._cellRenderers=[];this._rowExpansionRenderers=[];this.children.columnSort=new ColumnSort({el:this.el,model:this.model.metadata,autoUpdate:!0,sortKeyAttr:this.options.sortKeyAttr,sortDirAttr:this.options.sortDirAttr});this.options.enableTableDock!==!1&&(this.children.tableDock=new TableDock({el:this.el,offset:this.options.tableDockOffset}));this.addCellRenderer(new StringCellRenderer);this.addCellRenderer(new TimeCellRenderer);this.addCellRenderer(new NumberCellRenderer);this.addCellRenderer(new SparklineCellRenderer);this.addCellRenderer(new NullCellRenderer);this.rawFields=[];this.rawRows=[];this.dataFields=[];this.dataRows=[];this.columnTypes={};this.fieldHeatDeltas={};this.fieldExtremes={};this.fieldTimestampFormats={};this.sparklineFormatSettings={};this.updateFormatSettings();this.readResults();this.activate({skipUpdate:!0})},startListening:function(){this.listenTo(this.model.results,"change",_.debounce(function(){this.active&&this.handleResultsChange()},0));this.listenTo(this.model.format,"change",this.handleFormatChange);this.options.enableStaticHeader&&this.listenTo(Printer,Printer.PRINT_END,function(){this.children.staticHead.update()})},activate:function(options){options=options||{};if(this.active)return Base.prototype.activate.apply(this,arguments);this.options.disable&&this.$el.addClass("table-disabled");if(!options.skipUpdate){this.updateFormatSettings();this.handleResultsChange()}return Base.prototype.activate.apply(this,arguments)},deactivate:function(){if(!this.active)return Base.prototype.deactivate.apply(this,arguments);Base.prototype.deactivate.apply(this,arguments);this.collapseRow();return this},addCellRenderer:function(cellRenderer){if("function"!=typeof cellRenderer&&!(cellRenderer instanceof BaseCellRenderer))throw new Error("Parameter cellRenderer must be a function or an instance of views/shared/results_table/renderers/BaseCellRenderer.");this._cellRenderers.unshift(cellRenderer)},removeCellRenderer:function(cellRenderer){if("function"!=typeof cellRenderer&&!(cellRenderer instanceof BaseCellRenderer))throw new Error("Parameter cellRenderer must be a function or an instance of views/shared/results_table/renderers/BaseCellRenderer.");for(var cellRenderers=this._cellRenderers,i=0,l=cellRenderers.length;l>i;i++)if(cellRenderers[i]===cellRenderer){cellRenderers.splice(i,1);break}},getCellRenderers:function(){return this._cellRenderers.concat()},addRowExpansionRenderer:function(rowExpansionRenderer){if(!(rowExpansionRenderer instanceof BaseRowExpansionRenderer))throw new Error("Parameter rowExpansionRenderer must be an instance of views/shared/results_table/renderers/BaseRowExpansionRenderer.");this._rowExpansionRenderers.unshift(rowExpansionRenderer)},removeRowExpansionRenderer:function(rowExpansionRenderer){if(!(rowExpansionRenderer instanceof BaseRowExpansionRenderer))throw new Error("Parameter rowExpansionRenderer must be an instance of views/shared/results_table/renderers/BaseRowExpansionRenderer.");for(var rowExpansionRenderers=this._rowExpansionRenderers,i=0,l=rowExpansionRenderers.length;l>i;i++)if(rowExpansionRenderers[i]===rowExpansionRenderer){rowExpansionRenderers.splice(i,1);break}},getRowExpansionRenderers:function(){return this._rowExpansionRenderers.concat()},expandRow:function(rowIndex){if("number"!=typeof rowIndex)throw new Error("Parameter rowIndex must be a Number.");this.collapseRow();var rowView=this.children["row_"+rowIndex];if(rowView)for(var rowExpansionRenderer,rowData=rowView.getRowData(),rowExpansionRenderers=this._rowExpansionRenderers,i=0,l=rowExpansionRenderers.length;l>i;i++){rowExpansionRenderer=rowExpansionRenderers[i];if(rowExpansionRenderer.canRender(rowData)){this._expandedRow=rowView;this._expandedRowIndex=rowIndex;rowView.expandRow(rowExpansionRenderer,rowData);break}}},collapseRow:function(){var rowView=this._expandedRow;if(rowView){this._expandedRowIndex=-1;this._expandedRow=null;rowView.collapseRow()}},getExpandedRowIndex:function(){return this._expandedRowIndex>=0?this._expandedRowIndex:-1},remove:function(){this.collapseRow();return Base.prototype.remove.apply(this,arguments)},handleResultsChange:function(){this.readResults();this.render()},readResults:function(){this.rawFields=this.getFieldList();this.rawRows=this.model.results.get("rows")||[];this.dataFields=_(this.rawFields).filter(this.isDataField,this);this.dataRows=_(this.rawRows).map(function(row){return _(row).filter(function(data,i){return this.isDataField(this.rawFields[i])},this)},this)},handleFormatChange:function(){var changedFormatAttributes=this.model.format.changedAttributes();if(_(changedFormatAttributes).chain().pick(REPORT_FORMAT_ATTRIBUTES).isEmpty().value())changedFormatAttributes.hasOwnProperty("display.statistics.drilldown")&&this.updateDrilldownClasses();else{this.updateFormatSettings();this.debouncedRender()}},render:function(){if(this.options.enableStaticHeader&&!this.el.innerHTML){this.$el.html(this.staticHeaderTemplate);this.children.staticHead=new TableHeadStatic({el:this.el,flexWidthColumn:!1})}var html=this.compiledTemplate({wrapResults:splunkUtils.normalizeBoolean(this.model.format.get("display.statistics.wrap")),numDataColumns:this.dataFields.length}),$html=$(html);this.disposeOfChildren();if(this.dataFields.length>0&&this.dataRows.length>0){console.debug("rendering results table with data:",{fields:this.dataFields,rows:this.dataRows});var columns=this.resultsAsColumns();this.updateColumnTypes(columns);this.insertHeader($html,this.dataFields);this.insertRows($html,this.dataFields,this.dataRows,columns);this.children.columnSort.update($html)}if(this.options.enableStaticHeader){this.$(".scroll-table-wrapper").html($html);this.children.staticHead.update()}else this.$el.html($html);$.sparkline_display_visible();this.children.tableDock&&this.children.tableDock.update();if(this.options.disable){this.$tableDisabled=$('<div class="table-disabled-screen"></div>');this.$el.append(this.$tableDisabled)}this.updateDrilldownClasses();this.trigger("rendered");this.$table=this.$("table").last();this.reflow();return this},reflow:function(){this.children.tableDock&&this.children.tableDock.update();Base.prototype.reflow.apply(this,arguments);this.$tableDisabled&&this.$table.length>0&&this.$tableDisabled.width(this.$table[0].scrollWidth)},handleCellMouseover:function($target){var drilldown=this.model.format.get("display.statistics.drilldown"),rowNumbers=splunkUtils.normalizeBoolean(this.model.format.get("display.statistics.rowNumbers")),rowExpansion=this._rowExpansionRenderers.length>0;if("none"!==drilldown){var $cell=$target.closest("td"),cellInfo=this.getCellInfo($cell),rowView=this.children["row_"+cellInfo.rowIndex];if(rowView)if("cell"===drilldown){if($cell.find(MV_SUBCELL_SELECTOR).length>0&&!$target.is(MV_SUBCELL_SELECTOR))return;this.children.header.highlightColumn(cellInfo.cellIndex);var cellIndexOffset=(rowNumbers?1:0)+(rowExpansion?1:0);this.children.tableDock&&this.children.tableDock.$headerTable.find("th").eq(parseInt(cellInfo.cellIndex,10)+cellIndexOffset).addClass("highlighted");this.children.staticHead&&this.children.staticHead.$headerTable.find("th").eq(parseInt(cellInfo.cellIndex,10)+cellIndexOffset).addClass("highlighted");rowView.highlightCell($target,cellInfo.cellIndex)}else rowView.highlightRow()}},handleCellMouseout:function($target){var drilldown=this.model.format.get("display.statistics.drilldown"),rowNumbers=splunkUtils.normalizeBoolean(this.model.format.get("display.statistics.rowNumbers")),rowExpansion=this._rowExpansionRenderers.length>0;if("none"!==drilldown){var $cell=$target.closest("td"),cellInfo=this.getCellInfo($cell),rowView=this.children["row_"+cellInfo.rowIndex];if(rowView)if("cell"===drilldown){if($cell.find(MV_SUBCELL_SELECTOR).length>0&&!$target.is(MV_SUBCELL_SELECTOR))return;this.children.header.unHighlightColumn(cellInfo.cellIndex);var cellIndexOffset=(rowNumbers?1:0)+(rowExpansion?1:0);this.children.tableDock&&this.children.tableDock.$headerTable.find("th").eq(parseInt(cellInfo.cellIndex,10)+cellIndexOffset).removeClass("highlighted");this.children.staticHead&&this.children.staticHead.$headerTable.find("th").eq(parseInt(cellInfo.cellIndex,10)+cellIndexOffset).removeClass("highlighted");
rowView.unHighlightCell($target,cellInfo.cellIndex)}else rowView.unHighlightRow()}},handleCellMousedown:function($target,event){this.mouseDownX=event.pageX;this.mouseDownY=event.pageY},handleCellClick:function($target,clickEvent){clickEvent.preventDefault();var deltaMouseX=clickEvent.pageX&&this.mouseDownX?Math.abs(clickEvent.pageX-this.mouseDownX):0,deltaMouseY=clickEvent.pageY&&this.mouseDownY?Math.abs(clickEvent.pageY-this.mouseDownY):0;this.mouseDownX=0;this.mouseDownY=0;var dragThreshold=2;if(!(deltaMouseX>dragThreshold||deltaMouseY>dragThreshold)){var $cell=$target.closest("td");if($cell.hasClass(ResultsTableRow.ROW_EXPANSION_CLASSNAME)){var $row=$cell.closest("tr"),rowIndex=Number($row.attr(ResultsTableRow.ROW_INDEX_ATTR));this.getExpandedRowIndex()!=rowIndex?this.expandRow(rowIndex):this.collapseRow()}else{var drilldown=this.model.format.get("display.statistics.drilldown");if("none"!==drilldown){var isMultiValue=$cell.find(MV_SUBCELL_SELECTOR).length>0;if("cell"!==drilldown||!isMultiValue||$target.is(MV_SUBCELL_SELECTOR)){var cellInfo=this.getCellInfo($cell),modifierKey=!(!clickEvent.ctrlKey&&!clickEvent.metaKey);isMultiValue&&(cellInfo.mvIndex=this.getMultiValueIndex($target));this.emitDrilldownEvent(cellInfo,modifierKey,clickEvent)}}}}},emitDrilldownEvent:function(cellInfo,modifierKey,clickEvent){if(void 0!==cellInfo.rowIndex&&void 0!==cellInfo.cellIndex){var rowIndex=cellInfo.rowIndex,cellIndex=cellInfo.cellIndex,rowName=this.dataFields[0],rowSplitIsTime=this.isTimeField(rowName),rowValue=this.dataRows[rowIndex][0],drilldownInfo={modifierKey:modifierKey,name:rowName,value:rowSplitIsTime?splunkUtils.getEpochTimeFromISO(rowValue):rowValue};if(rowSplitIsTime){var spanSeries=this.getSpanSeriesForTimeField(rowName);drilldownInfo._span=spanSeries?parseInt(spanSeries[rowIndex],10):.001}var isMultiValue=_.isArray(this.dataRows[rowIndex][cellIndex]);if(cellIndex>this.options.numRowSplits-1||isMultiValue){drilldownInfo.name2=this.dataFields[cellIndex];drilldownInfo.value2=isMultiValue?this.dataRows[rowIndex][cellIndex][cellInfo.mvIndex||0]:this.dataRows[rowIndex][cellIndex]}var rowContext={};_(this.dataRows[rowIndex]).each(function(value,i){rowContext["row."+this.dataFields[i]]=value},this);drilldownInfo.rowContext=rowContext;drilldownInfo.rowIndex=parseInt(rowIndex,10);drilldownInfo.cellIndex=parseInt(cellIndex,10);drilldownInfo.originalEvent=clickEvent;this.trigger("cellClick",drilldownInfo)}},insertHeader:function($rootEl,dataFields){this.children.header=new this.options.headerClass({rowNumbers:splunkUtils.normalizeBoolean(this.model.format.get("display.statistics.rowNumbers")),rowExpansion:this._rowExpansionRenderers.length>0,fields:dataFields,columnTypes:this.columnTypes,sortKeyAttribute:ColumnSort.SORT_KEY_ATTR,sortableFields:this.options.sortableFields});this.children.header.render().replaceAll($rootEl.find("thead"))},insertRows:function($rootEl,dataFields,dataRows,dataColumns){var dataOverlay=this.model.format.get("display.statistics.overlay"),showRowNumbers=splunkUtils.normalizeBoolean(this.model.format.get("display.statistics.rowNumbers")),rowExpansion=this._rowExpansionRenderers.length>0;"heatmap"===dataOverlay?this.updateHeatDeltas(dataColumns):"highlow"===dataOverlay&&this.updateExtremes(dataColumns);_(this.columnTypes).contains("timestamp")&&this.updateFieldTimestampFormats(dataFields,dataRows,dataColumns);var rowIterator=new RowIterator({offset:this.model.metadata.get(this.options.offsetAttr)}),$tbody=$rootEl.find("tbody");rowIterator.eachRow(dataRows,function(row,i,rowNumber){var viewOptions={table:this,fields:dataFields,values:row,cells:this.generateCellObjects(row,dataFields,dataOverlay),dataOverlay:dataOverlay,rowIndex:i,numRowSplits:this.options.numRowSplits,rowExpansion:rowExpansion};showRowNumbers&&(viewOptions.rowNumber=rowNumber);var rowView=this.children["row_"+i]=new ResultsTableRow(viewOptions);rowView.render().appendTo($tbody)},this)},generateCellObjects:function(row,fields,dataOverlay){return _(row).map(function(value,i){var field=fields[i];return{value:value,field:field,dataOverlay:dataOverlay,columnType:this.columnTypes[field]||"string",heatDelta:this.fieldHeatDeltas[field],extremes:this.fieldExtremes[field],timestampFormat:this.fieldTimestampFormats[field],sparklineFormat:this.sparklineFormatSettings[field],index:i}},this)},disposeOfChildren:function(){this.collapseRow();_(this.children).each(function(child,name){if("header"===name||"row_"===name.substr(0,4)){child.stopListening();delete this.children[name]}},this)},resultsAsColumns:function(){var columns={},rows=this.model.results.get("rows")||[];_(this.getFieldList()).each(function(field,i){columns[field]=_(rows).pluck(i)});return columns},updateDrilldownClasses:function(){var drilldown=this.model.format.get("display.statistics.drilldown"),$table=this.$(".table"),$rows=$table.find("tbody > tr"),$cells=$table.find("tbody > tr > td");if("none"===drilldown){$table.removeClass("table-drilldown table-drilldown-row table-drilldown-cell");$cells.removeAttr("tabindex");$rows.removeAttr("tabindex")}else if("cell"===drilldown){$table.addClass("table-drilldown table-drilldown-cell").removeClass("table-drilldown-row");$cells.attr("tabindex","0");$rows.removeAttr("tabindex")}else{$table.addClass("table-drilldown table-drilldown-row").removeClass("table-drilldown-cell");$rows.attr("tabindex","0");$cells.removeAttr("tabindex")}$table.find(".row-expansion-toggle").removeAttr("tabindex")},updateFormatSettings:function(){var settings=this.sparklineFormatSettings={};this.model.format.has("display.statistics.sparkline.format")&&_.extend(settings,this.model.format.get("display.statistics.sparkline.format"))},updateColumnTypes:function(columns){this.columnTypes={};_(columns).each(function(column,field){this.isDataField(field)&&(this.columnTypes[field]=this.isTimeField(field)?"timestamp":generalUtils.valuesAreNumeric(column)?"number":"string")},this)},updateHeatDeltas:function(columns){var allNumericValues=this.getAllNumericValues(columns),bounds=generalUtils.getPercentiles(allNumericValues.sort(function(a,b){return a-b}),.05,.95),heatDelta=Math.max(Math.abs(bounds.lower),Math.abs(bounds.upper));this.fieldHeatDeltas={};_(columns).each(function(column,field){"number"===this.columnTypes[field]&&(this.fieldHeatDeltas[field]=heatDelta)},this)},updateExtremes:function(columns){var allNumericValues=this.getAllNumericValues(columns),extremes={min:_(allNumericValues).chain().without(null).min().value(),max:_(allNumericValues).max()};this.fieldExtremes={};_(columns).each(function(column,field){"number"===this.columnTypes[field]&&(this.fieldExtremes[field]=extremes)},this)},getAllNumericValues:function(columns){var normalizeToNumber=function(value){return mathUtils.strictParseFloat(value)||null};return _(columns).chain().filter(function(column,field){return"number"===this.columnTypes[field]},this).flatten().map(normalizeToNumber).value()},updateFieldTimestampFormats:function(fields,rows,columns){this.fieldTimestampFormats={};_(fields).each(function(field){if(this.isTimeField(field))if(this.isBucketedTimeField(field)){var labelGranularity=timeUtils.determineLabelGranularity(columns[field]);this.fieldTimestampFormats[field]=TIMESTAMP_FORMATS[labelGranularity]}else this.fieldTimestampFormats[field]=TIMESTAMP_FORMATS["second"]},this)},getFieldList:function(){return _(this.model.results.get("fields")||[]).map(function(field){return _(field).isString()?field:field.name})},isDataField:function(fieldName){return DATA_FIELD_REGEX.test(fieldName)},isTimeField:function(fieldName){return fieldName in{_time:!0,earliest_time:!0,latest_time:!0}},isBucketedTimeField:function(fieldName){return"_time"===fieldName&&!!this.getSpanSeriesForTimeField(fieldName)},getSpanSeriesForTimeField:function(){var spanSeriesName="_span";return this.resultsAsColumns()[spanSeriesName]},getCellInfo:function($cell){return{cellIndex:$cell.attr(ResultsTableRow.CELL_INDEX_ATTR),rowIndex:$cell.closest("tr").attr(ResultsTableRow.ROW_INDEX_ATTR)}},getMultiValueIndex:function($el){return $el.attr(ResultsTableRow.MV_INDEX_ATTR)},template:'            <table class="table table-chrome table-striped <%= wrapResults ? "wrapped-results" : "not-wrapped-results" %> <%= numDataColumns === 1 ? \'single-column-table\' : \'\' %>">                <thead></thead>                <tbody></tbody>            </table>        ',staticHeaderTemplate:'            <div class="header-table-static"></div>            <div class="scroll-table-wrapper"></div>        '},{TIMESTAMP_FORMATS:TIMESTAMP_FORMATS})});define("splunkjs/mvc/drilldown",["require","underscore","jquery","./utils","uri/route","util/console","splunk.util","./sharedmodels","splunk.config","models/services/search/IntentionsParser","util/general_utils"],function(require){var _=require("underscore"),$=require("jquery"),utils=require("./utils"),route=require("uri/route"),console=require("util/console"),util=require("splunk.util"),sharedModels=require("./sharedmodels"),splunkConfig=require("splunk.config"),IntentionsParser=require("models/services/search/IntentionsParser"),GeneralUtils=require("util/general_utils"),Drilldown={applyDrilldownIntention:function(clickInfo,manager,options){options||(options={});var applicationModel=sharedModels.get("app"),query=manager.settings.resolve({qualified:!0}),earliest=manager.job.properties().searchEarliestTime,latest=manager.job.properties().searchLatestTime;!earliest&&manager.job.properties().earliestTime&&(earliest=util.getEpochTimeFromISO(manager.job.properties().earliestTime));!latest&&manager.job.properties().latestTime&&(latest=util.getEpochTimeFromISO(manager.job.properties().latestTime));var intentionParams,intentionsParser=new IntentionsParser;if("geoviz"===options.drilldownType){intentionParams=_.extend({action:"geoviz"},options.params);options.negate&&(intentionParams.negate="true")}else if("legendClick"===clickInfo.type)intentionParams=clickInfo.hasOwnProperty("name")&&clickInfo.hasOwnProperty("value")?{action:"fieldvalue",field:clickInfo.name,value:clickInfo.value}:{action:"keyword",field:clickInfo.name2};else{var field,value;clickInfo._span&&intentionsParser.set({"dispatch.earliest_time":clickInfo.value,"dispatch.latest_time":JSON.stringify(parseFloat(clickInfo.value)+clickInfo._span)},{silent:!0});if("row"===options.drilldownType){field=_(clickInfo.rowContext).keys().map(function(f){return f.replace("row.","")});value=_(clickInfo.rowContext).values()}else if("_time"===clickInfo.name){field=clickInfo.name2;value=clickInfo.value2}else if(clickInfo.name&&clickInfo.name2){field=[clickInfo.name,clickInfo.name2];value=[clickInfo.value,clickInfo.value2]}else if(clickInfo.name){field=clickInfo.name;value=clickInfo.value}else{field=clickInfo.name2;value=clickInfo.value2}intentionParams={action:"fieldvalue",field:field||"",value:value||""}}console.info("Applying intention",intentionParams);var dfd=$.Deferred();intentionsParser.fetch({data:_.extend({q:query,fieldMetaData:JSON.stringify(manager.job.properties().fieldMetadataResults),app:applicationModel.get("app"),owner:applicationModel.get("owner")},intentionParams),sync:options.sync}).done(function(){dfd.resolve({q:util.stripLeadingSearchCommand(intentionsParser.get("fullSearch")),earliest:intentionsParser.get("dispatch.earliest_time")||earliest||0,latest:intentionsParser.get("dispatch.latest_time")||latest||""},clickInfo.modifierKey)}).fail(function(){dfd.reject.apply(dfd,arguments)});return dfd.promise()},handleDrilldown:function(click,drilldownType,manager){console.warn("DEPRECATED Drilldown.handleDrilldown() - use Drilldown.autoDrilldown() instead");return Drilldown.autoDrilldown(click,manager,{drilldownType:drilldownType})},autoDrilldown:function(click,manager,options){Drilldown.applyDrilldownIntention(click,manager,options).done(splunkConfig.ON_DRILLDOWN||Drilldown.redirectToSearchPage)},redirectToSearchPage:function(params,newWindow){var app=sharedModels.get("app").toJSON(),url=route.search(app.root,app.locale,app.app,{data:params});utils.redirect(url,newWindow)},getNormalizedTimerange:function(manager,e){if(e&&"_time"===e.name&&e._span){var span=parseFloat(e._span),earliest=parseInt(e.value,10);return{earliest:earliest||"",latest:earliest+span||""}}return Drilldown.getSearchJobTimerange(manager)},getSearchJobTimerange:function(manager){var earliest,latest;if(manager.job){earliest=manager.job.properties().searchEarliestTime;latest=manager.job.properties().searchLatestTime;!earliest&&manager.job.properties().earliestTime&&(earliest=util.getEpochTimeFromISO(manager.job.properties().earliestTime));!latest&&manager.job.properties().latestTime&&(latest=util.getEpochTimeFromISO(manager.job.properties().latestTime))}return{earliest:earliest||"",latest:latest||""}},normalizeDrilldownEventData:function(e,options){options||(options={});var data={},manager=options.manager;_.extend(data,{"click.name":e.name,"click.value":e.value});e.hasOwnProperty("name2")?_.extend(data,{"click.name2":e.name2,"click.value2":e.value2}):_.extend(data,{"click.name2":e.name,"click.value2":e.value});options.contextProperty&&_.extend(data,e[options.contextProperty]);_.extend(data,options.jobTimeOnly?Drilldown.getSearchJobTimerange(manager):Drilldown.getNormalizedTimerange(manager,e,options));return data},createEventPayload:function(data,defaultHandler){var defaultPrevented=!1;return _.extend(data,{preventDefault:function(){defaultPrevented=!0},defaultPrevented:function(){return defaultPrevented},drilldown:_.once(defaultHandler)})},getNormalizedDrilldownType:function(value,options){options=_.extend({allowBoolean:!1,validValues:["all","none"],"default":"all"},options);options.aliasMap=_.extend(_.object(options.validValues,options.validValues),options.aliasMap);return options.aliasMap.hasOwnProperty(value)?options.aliasMap[value]:options.allowBoolean&&GeneralUtils.isBooleanEquivalent(value)?GeneralUtils.normalizeBoolean(value)?"all":"none":options["default"]}};return Drilldown});requirejs.s.contexts._.nextTick=function(f){f()};require(["css"],function(css){css.addBuffer("splunkjs/css/paginator.css")});requirejs.s.contexts._.nextTick=requirejs.nextTick;define("splunkjs/mvc/paginatorview",["require","exports","module","underscore","./mvc","./basesplunkview","./settings","css!../css/paginator.css"],function(require,exports,module){var _=require("underscore"),BaseSplunkView=(require("./mvc"),require("./basesplunkview")),DEFAULT_PAGE=(require("./settings"),0),DEFAULT_PAGE_SIZE=10;require("css!../css/paginator.css");var PaginatorView=BaseSplunkView.extend({moduleId:module.id,className:"splunk-paginator",events:{"click a":"onPageClick"},options:{itemCount:-1,page:DEFAULT_PAGE,pageSize:DEFAULT_PAGE_SIZE},initialize:function(){this.configure();this.settings.on("change",this.render,this)},hide:function(){this.$el.css("display","none")},render:function(){this.$el.empty();var pageSize=this.settings.get("pageSize"),itemCount=this.settings.get("itemCount");if(pageSize>=itemCount)return this;var page=this.settings.get("page"),pageCount=Math.ceil(itemCount/pageSize),windowSize=Math.min(10,pageCount);if(page>pageCount){page=pageCount;this.settings.set({page:page})}var page0,pageN;page0=Math.max(0,page-windowSize/2);pageN=Math.min(pageCount,page0+windowSize)-1;page0=Math.max(0,pageN-windowSize+1);var link=function(num){return"<a href='#' data-page='"+num+"'/>"},disabled='<a href="#" class="disabled"/>',selected='<a href="#" class="selected"/>',list=this.$el,item=$(0==page?disabled:link("prev"),list);item.html("&laquo; "+_("prev").t()).appendTo(list);var i;for(i=page0;pageN>=i;++i){item=$(i==page?selected:link(i));item.text(i+1).appendTo(list)}item=$(page==pageN?disabled:link("next"),list);item.html(_("next").t()+" &raquo;").appendTo(list);return this},show:function(){this.$el.css("display","")},onPageClick:function(e){e.stopPropagation();e.preventDefault();if(!$(e.currentTarget).is(".selected,.disabled")){var dataPage=$(e.currentTarget).attr("data-page"),page=this.settings.get("page");switch(dataPage){case"prev":e.shiftKey?page=0:page-=1;break;case"next":if(e.shiftKey){var itemCount=this.settings.get("itemCount"),pageSize=this.settings.get("pageSize");page=parseInt(itemCount/pageSize,10)-(itemCount%pageSize==0?1:0)}else page+=1;break;default:page=parseInt(dataPage,10)}this.settings.set({page:page})}}});return PaginatorView});requirejs.s.contexts._.nextTick=function(f){f()};require(["css"],function(css){css.addBuffer("splunkjs/css/results-table.css")});requirejs.s.contexts._.nextTick=requirejs.nextTick;define("splunkjs/mvc/tableview",["require","exports","module","jquery","underscore","./mvc","./utils","backbone","./basesplunkview","views/shared/results_table/ResultsTableMaster","./messages","./drilldown","./paginatorview","views/shared/results_table/renderers/BaseCellRenderer","views/shared/results_table/renderers/BaseRowExpansionRenderer","util/console","./tokenawaremodel","util/general_utils","css!../css/results-table"],function(require,exports,module){var $=require("jquery"),_=require("underscore"),mvc=require("./mvc"),utils=require("./utils"),Backbone=require("backbone"),BaseSplunkView=require("./basesplunkview"),ResultsTableView=require("views/shared/results_table/ResultsTableMaster"),Messages=require("./messages"),Drilldown=require("./drilldown"),PaginatorView=require("./paginatorview"),BaseCellRenderer=require("views/shared/results_table/renderers/BaseCellRenderer"),BaseRowExpansionRenderer=require("views/shared/results_table/renderers/BaseRowExpansionRenderer"),TokenAwareModel=(require("util/console"),require("./tokenawaremodel")),GeneralUtils=require("util/general_utils");require("css!../css/results-table");var DEFAULT_PAGE_SIZE=10,MAX_PAGE_SIZE=100,fieldSplitterRegex=/(["'].*?["']|[^"',\s]+)(?=\s*|\s*,|\s*$)/g,quoteStripperRegex=/^["']|["|']$/g,TableView=BaseSplunkView.extend({moduleId:module.id,className:"splunk-table",options:{data:"preview",drilldown:"row",drilldownRedirect:!0,pagerPosition:"bottom",fields:[],pageSize:DEFAULT_PAGE_SIZE},normalizeOptions:function(options){if(options.hasOwnProperty("count")){var count=parseInt(this.options.count,10)||DEFAULT_PAGE_SIZE;this.settings.set("pageSize",count>MAX_PAGE_SIZE||1>count?DEFAULT_PAGE_SIZE:count)}options.hasOwnProperty("wrap")&&(GeneralUtils.isBooleanEquivalent(options.wrap)?this.settings.set("wrap",GeneralUtils.normalizeBoolean(options.wrap)?"1":"0"):this.settings.set("wrap",options.wrap));options.hasOwnProperty("rowNumbers")?GeneralUtils.isBooleanEquivalent(options.rowNumbers)?this.settings.set("displayRowNumbers",GeneralUtils.normalizeBoolean(options.rowNumbers)?"1":"0"):this.settings.set("displayRowNumbers",options.rowNumbers):options.hasOwnProperty("displayRowNumbers")&&this.settings.set("displayRowNumbers",GeneralUtils.normalizeBoolean(options.displayRowNumbers)?"1":"0");options.hasOwnProperty("overlay")&&this.settings.set("dataOverlayMode",options["display.statistics.overlay"]);this.settings.set("drilldown",Drilldown.getNormalizedDrilldownType(options.drilldown,{validValues:["row","cell","none"],aliasMap:{all:"cell",off:"none"},"default":"cell"}));if(options.format){var sparklineSettings={};_.each(options.format,function(formats,field){_.each(formats,function(format){"sparkline"===format.type&&(sparklineSettings[field]=format.options)})});_(sparklineSettings).isEmpty()||this.settings.set({"sparkline.format":sparklineSettings})}},initialize:function(options){this.configure();this.model=this.options.reportModel||TokenAwareModel._createReportModel();this.normalizeOptions(options);this.settings._sync=utils.syncModels(this.settings,this.model,{auto:!0,alias:{displayRowNumbers:"display.statistics.rowNumbers",dataOverlayMode:"display.statistics.overlay",pageSize:"display.prefs.statistics.count"},prefix:"display.statistics.",include:["displayRowNumbers","dataOverlayMode","pageSize","stripedRows","drilldown","sortKey","sortDirection","overlay","count","sparkline.format","wrap","fields"],exclude:["drilldownRedirect"]});var results=this.results=new Backbone.Model({rows:[],fields:[]}),pagesize=this.settings.get("pageSize")||DEFAULT_PAGE_SIZE,metadata=this.metadata=new Backbone.Model({pageSize:pagesize>MAX_PAGE_SIZE||1>pagesize?DEFAULT_PAGE_SIZE:pagesize,offset:0}),table=this.table=new ResultsTableView({enableTableDock:!1,el:$("<div></div>").appendTo(this.el),model:{results:results,metadata:metadata,format:this.model}});this._rendered=!1;this.listenTo(this.table,"rendered",function(){this._rendered=!0;this.trigger("rendered",this)},this);this.settings._syncMeta=utils.syncModels(this.settings,this.metadata,{include:["sortKey","sortDirection","pageSize"],auto:"push"});this.listenTo(metadata,"change",this.applyFetchOptions);this._onShowPagerChanged();this.settings.on("change:showPager",this._onShowPagerChanged,this);this.settings.on("change:pagerPosition",this._onPaginatorPositionChange,this);this.transformFieldsToArray();this.listenTo(this.settings,"change:fields",this.onFieldsChanged);table.on("cellClick",this.emitDrilldownEvent,this);this.bindToComponentSetting("managerid",this.onManagerChange,this);this.manager||this.onManagerChange(mvc.Components,null)},emitDrilldownEvent:function(e){var manager=this.manager,drilldownType=this.settings.get("drilldown"),data=Drilldown.normalizeDrilldownEventData(e,{manager:manager,contextProperty:"rowContext",jobTimeOnly:!0}),originalRows=this.resultsModel?this.resultsModel.data().rows:null;if(originalRows&&e.rowIndex<originalRows.length){var originalRow=originalRows[e.rowIndex];_(this.resultsModel.data().fields).each(function(originalField,i){data["row."+originalField]=originalRow[i]})}var payload=Drilldown.createEventPayload({field:e.name2||e.name,data:data,event:e},function(){Drilldown.autoDrilldown(e,manager,{drilldownType:drilldownType})});this.trigger("drilldown click",payload,this);var model=this.collection.at(e.rowIndex);if(model){var key=e.hasOwnProperty("name2")?e.name2:e.name,value=e.hasOwnProperty("value2")?e.value2:e.value,originalEvent=e.originalEvent;this.trigger("clicked:row click:row",_.extend({model:model,index:e.rowIndex,originalEvent:originalEvent,component:this,event:originalEvent},payload),this);this.trigger("clicked:cell click:cell",_.extend({model:model,index:e.rowIndex,column:e.cellIndex,key:key,value:value,originalEvent:originalEvent,event:originalEvent,component:this},payload),this)}"none"!==drilldownType&&this.settings.get("drilldownRedirect")&&!payload.defaultPrevented()&&payload.drilldown()},onManagerChange:function(managers,manager){if(this.manager){this.stopListening(this.manager);this.manager=null}if(this.resultsModel){this.stopListening(this.resultsModel);this.resultsModel=null}if(manager){this.renderMessage("empty");this.manager=manager;this.resultsModel=this.manager.data(this.settings.get("data"),{autofetch:!0,output_mode:"json_rows",show_empty_fields:"True",count:this.metadata.get("pageSize"),offset:this.metadata.get("offset")});this.listenTo(this.manager,"search:start",this.onSearchStart);this.listenTo(this.manager,"search:progress",this.onSearchProgress);this.listenTo(this.manager,"search:cancelled",this.onSearchCancelled);this.listenTo(this.manager,"search:refresh",this.onSearchRefresh);this.listenTo(this.manager,"search:fail",this.onSearchFailed);this.listenTo(this.manager,"search:error",this.onSearchError);this.listenTo(this.manager,"search:done",this.onSearchDone);this.listenTo(this.resultsModel,"data",this.renderResults);this.listenTo(this.resultsModel,"error",this.onSearchError);var content=this.manager.get("data");if(content){this.onSearchStart(content);this.onSearchProgress({content:content});content.isDone&&this.onSearchDone({content:content})}this.manager.replayLastSearchEvent(this)}else this.renderMessage("no-search")},_showMessages:function(){this.$(".msg").show();this.table.$el.hide();this.paginator&&this.paginator.$el.hide()},_hideMessages:function(){this.$(".msg").hide();this.table.$el.show();this.paginator&&this.paginator.$el.show()},renderMessage:function(msg){var el=this.$(".msg");el.length||(el=$('<div class="msg"></div>').appendTo(this.$el));Messages.render(msg,el);this._showMessages()},onSearchStart:function(){this._searchRunning=!0;this.clearResults();this.renderMessage("waiting");this.paginator&&this.paginator.settings.set("page",0)},onSearchDone:function(properties){this._searchRunning=!1;var previewCount=((properties||{}).content||{}).resultPreviewCount||0;this.updateCount(previewCount)},onSearchProgress:function(properties){properties=properties||{};var job=properties.content||{},previewCount=job.resultPreviewCount||0;previewCount>0&&this.updateCount(previewCount)},onSearchCancelled:function(){this.renderMessage("cancelled")},onSearchRefresh:function(){this.renderMessage("refresh")},onSearchError:function(message,err){var msg=Messages.getSearchErrorMessage(err)||message;this.renderMessage({level:"error",icon:"warning-sign",message:msg})},onSearchFailed:function(state){var msg=Messages.getSearchFailureMessage(state);this.renderMessage({level:"error",icon:"warning-sign",message:msg})},applyFetchOptions:function(){if(this.resultsModel){var args={count:this.metadata.get("pageSize"),offset:this.metadata.get("offset")};this.metadata.has("sortKey")&&(args.search=["|","sort","0","desc"===this.metadata.get("sortDirection")?"-":"",JSON.stringify(this.metadata.get("sortKey"))].join(" "));this.resultsModel.set(args)}},updateCount:function(count){if(0===count){this.clearResults();this.renderMessage(this._searchRunning?"waiting":"no-results")}this.paginator&&this.paginator.settings.set("itemCount",count)},onFieldsChanged:function(){this.transformFieldsToArray();this.renderResults()},transformFieldsToArray:function(){var fields=this.settings.get("fields");if(_.isString(fields)){fields=$.trim(fields);fields="["===fields[0]&&"]"===fields.slice(-1)?JSON.parse(fields):_.map(fields.match(fieldSplitterRegex),function(field){return field.replace(quoteStripperRegex,"")});this.settings.set("fields",fields,{silent:!0})}},renderResults:function(){var rows,fields;if(this.resultsModel&&this.resultsModel.hasData()){this.collection=this.resultsModel.collection();if(this.settings.has("fields")&&!_.isEmpty(this.settings.get("fields"))){fields=this.settings.get("fields");var fieldsIdx={},resultsFields=this.resultsModel.data().fields;_(fields).contains("*")&&(fields=_(fields).chain().map(function(field){return"*"===field?_(resultsFields).select(function(resField){return!_(fields).contains(resField)}):field}).flatten().unique().value());_(resultsFields).each(function(f,i){fieldsIdx[f]=i});rows=_(this.resultsModel.data().rows).map(function(o){return _(fields).map(function(f){return fieldsIdx.hasOwnProperty(f)?o[fieldsIdx[f]]:null})})}else{rows=this.resultsModel.data().rows;fields=this.resultsModel.data().fields}this.results.set({rows:rows,fields:fields});this._hideMessages()}},clearResults:function(){this.paginator&&this.paginator.settings.set("itemCount",0);this.results.set({rows:[],fields:[]})},render:function(){this.table.render();this.paginator&&this.paginator.render();return this},remove:function(){this.table&&this.table.remove();this.paginator&&this.paginator.remove();if(this.settings){this.settings.off();this.settings._sync&&this.settings._sync.destroy();this.settings._syncMeta&&this.settings._syncMeta.destroy()}BaseSplunkView.prototype.remove.call(this)},addRowExpansionRenderer:function(rowExpansionRenderer){this.table.addRowExpansionRenderer(rowExpansionRenderer);this._rendered&&this.render()},removeRowExpansionRenderer:function(rowExpansionRenderer){this.table.removeRowExpansionRenderer(rowExpansionRenderer);this._rendered&&this.render()},getRowExpansionRenderers:function(){return this.table.getRowExpansionRenderers()},expandRow:function(rowIndex){this.table.expandRow(rowIndex)},collapseRow:function(){this.table.collapseRow()},addCellRenderer:function(cellRenderer){this.table.addCellRenderer(cellRenderer);this._rendered&&this.render()},removeCellRenderer:function(cellRenderer){this.table.removeCellRenderer(cellRenderer);this._rendered&&this.render()},getCellRenderers:function(rowIndex){return this.table.getCellRenderers(rowIndex)},_onShowPagerChanged:function(){if(this.settings.get("showPager")!==!1){if(!this.paginator){this.paginator=new PaginatorView({id:_.uniqueId(this.id+"-paginator"),el:$("<div></div>"),pageSize:this.metadata.get("pageSize")});this.metadata.on("change:pageSize",this._onPageSizeChanged,this);this.paginator.settings.on("change:page",function(){var count=this.metadata.get("pageSize"),page=this.paginator.settings.get("page");this.metadata.set("offset",count*page)},this);this._onPaginatorPositionChange()}}else if(this.paginator){this.metadata.off("change:pageSize",this._onPageSizeChanged,this);this.paginator.settings.off("change:page");this.paginator.remove();this.paginator=null}},_onPageSizeChanged:function(){this.paginator.settings.set("pageSize",this.metadata.get("pageSize"))},_onPaginatorPositionChange:function(){var action="bottom"===this.settings.get("pagerPosition")?"appendTo":"prependTo";if(this.paginator){this.paginator.$el.detach();this.paginator.$el[action](this.$el)}}});TableView.BaseCellRenderer=BaseCellRenderer;TableView.BaseRowExpansionRenderer=BaseRowExpansionRenderer;return TableView});define("splunkjs/mvc/simplexml/element/table",["require","underscore","../../../mvc","./base","../../tableview","util/console","../mapper","splunk.util","../../drilldown"],function(require){var _=require("underscore"),DashboardElement=(require("../../../mvc"),require("./base")),TableView=require("../../tableview"),Mapper=(require("util/console"),require("../mapper")),SplunkUtil=require("splunk.util"),Drilldown=require("../../drilldown"),TableMapper=Mapper.extend({tagName:"table",map:function(report,result,options){result.options.wrap=String(SplunkUtil.normalizeBoolean(report.get("display.statistics.wrap",options)));result.options.rowNumbers=String(SplunkUtil.normalizeBoolean(report.get("display.statistics.rowNumbers",options)));result.options.dataOverlayMode=report.get("display.statistics.overlay",options);result.options.drilldown=Drilldown.getNormalizedDrilldownType(report.get("display.statistics.drilldown",options),{validValues:["cell","row","none"],"default":"row",aliasMap:{all:"cell",off:"none"}});result.options.count=report.get("display.prefs.statistics.count",options);result.options.labelField=null;result.options.valueField=null;var fields=report.get("display.statistics.fields",options);result.tags.fields=_.isArray(fields)?_.isEmpty(fields)?null:JSON.stringify(fields):"[]"===fields?null:fields}});Mapper.register("statistics",TableMapper);var TableVisualization=TableView.extend({panelClassName:"table",prefix:"display.statistics.",reportDefaults:{"display.general.type":"statistics","display.prefs.statistics.count":10,"display.statistics.drilldown":"cell"},getResultsLinkOptions:function(){return{}}});DashboardElement.registerVisualization("statistics",TableVisualization);var TableElement=DashboardElement.extend({initialVisualization:"statistics"});return TableElement});Splunk.Legend={_numLabels:0,_targetMap:new Object,_targetList:new Array,_labelMap:new Object,_labelList:new Array,_isLabelMapValid:!0,_timeoutID:0,_listeners:new Object,numLabels:function(){this._validateLabelMap();return this._numLabels},register:function(id){if(!id)throw new Error("Parameter id must be non-null.");var targetData=this._targetMap[id];if(!targetData){targetData=new Object;this._targetMap[id]=targetData;this._targetList.push(targetData)}},unregister:function(id){var targetData=this._targetMap[id];if(targetData){for(var i=this._targetList.length-1;i>=0;i--)if(this._targetList[i]==targetData){this._targetList.splice(i,1);break}delete this._targetMap[id];this._invalidateLabelMap()}},setLabels:function(id,labels){var targetData=this._targetMap[id];if(targetData){targetData.labels=labels;this._invalidateLabelMap()}},getLabelIndex:function(label){this._validateLabelMap();var index=this._labelMap[label];return null!=index?index:-1},addEventListener:function(event,closure){var listeners=this._listeners[event];
listeners||(listeners=this._listeners[event]=new Array);for(var numListeners=listeners.length,i=0;numListeners>i;i++)if(listeners[i]==closure)return;listeners.push(closure)},removeEventListener:function(event,closure){var listeners=this._listeners[event];if(listeners)for(var numListeners=listeners.length,i=0;numListeners>i;i++)if(listeners[i]==closure){listeners.splice(i,1);return}},dispatchEvent:function(event){var listeners=this._listeners[event];if(listeners){listeners=listeners.concat();var i,eventParams=new Array,numArguments=arguments.length;for(i=1;numArguments>i;i++)eventParams.push(arguments[i]);var closure,numListeners=listeners.length;for(i=0;numListeners>i;i++){closure=listeners[i];try{closure.apply(null,eventParams)}catch(e){}}}},_invalidateLabelMap:function(){if(this._isLabelMapValid){this._isLabelMapValid=!1;var self=this,f=function(){self._validateLabelMap()};this._timeoutID=setTimeout(f,0)}},_validateLabelMap:function(){if(!this._isLabelMapValid){this._isLabelMapValid=!0;clearTimeout(this._timeoutID);this._updateLabelMap()}},_updateLabelMap:function(){var targetData,targetLabels,targetLabelsLength,targetLabel,numLabels,i,j,currentLabelList=this._labelList,changed=!1,labelMap=new Object,labelList=new Array,targetList=this._targetList,targetListLength=targetList.length;for(i=0;targetListLength>i;i++){targetData=targetList[i];targetLabels=targetData.labels;if(targetLabels){targetLabelsLength=targetLabels.length;for(j=0;targetLabelsLength>j;j++){targetLabel=targetLabels[j];if(null==labelMap[targetLabel]){labelMap[targetLabel]=labelList.length;labelList.push(targetLabel)}}}}numLabels=labelList.length;if(numLabels!=currentLabelList.length)changed=!0;else for(i=0;numLabels>i;i++)if(labelList[i]!=currentLabelList[i]){changed=!0;break}if(changed){this._labelMap=labelMap;this._labelList=labelList;this._numLabels=numLabels;this.dispatchEvent("labelIndexMapChanged")}}};define("splunk.legend",["splunk"],function(global){return function(){var ret;return ret||global.Splunk.Legend}}(this));define("util/jscharting_utils",["underscore","helpers/user_agent","splunk.util"],function(_,userAgent,splunkUtils){var normalizePointLimit=function(limitValue){return parseInt(limitValue,10)||1/0},VISIBLE_FIELD_REGEX=/^[^_]|^_time/,MAX_SERIES=50,MAX_POINTS=function(){var crossBrowserLimit=splunkUtils.getConfigValue("JSCHART_TRUNCATION_LIMIT",2e4);return normalizePointLimit(null!==crossBrowserLimit?crossBrowserLimit:userAgent.isFirefox()?splunkUtils.getConfigValue("JSCHART_TRUNCATION_LIMIT_FIREFOX",2e4):userAgent.isSafari()?splunkUtils.getConfigValue("JSCHART_TRUNCATION_LIMIT_SAFARI",2e4):userAgent.isIE11()?splunkUtils.getConfigValue("JSCHART_TRUNCATION_LIMIT_IE11",2e4):userAgent.isIE10()?splunkUtils.getConfigValue("JSCHART_TRUNCATION_LIMIT_IE10",2e4):userAgent.isIE9()?splunkUtils.getConfigValue("JSCHART_TRUNCATION_LIMIT_IE9",2e4):userAgent.isIE8()?splunkUtils.getConfigValue("JSCHART_TRUNCATION_LIMIT_IE8",2e3):userAgent.isIE7()?splunkUtils.getConfigValue("JSCHART_TRUNCATION_LIMIT_IE7",2e3):splunkUtils.getConfigValue("JSCHART_TRUNCATION_LIMIT_CHROME",2e4))}(),getCustomDisplayProperties=function(chartData,webConfig){webConfig=webConfig||{};var customProps={};webConfig["JSCHART_TEST_MODE"]&&(customProps.testMode=!0);chartData.hasField("_tc")&&(customProps.fieldHideList=["percent"]);return customProps},sliceResultsToSeriesLength=function(rawData,length){var sliced={fields:rawData.fields,columns:[]};_(rawData.columns).each(function(column,i){sliced.columns[i]=column.slice(0,length)});return sliced},fieldIsVisible=function(field){var fieldName=_.isString(field)?field:field.name;return VISIBLE_FIELD_REGEX.test(fieldName)},preprocessChartData=function(rawData,displayProperties){if(0===rawData.columns.length||0===rawData.columns[0].length)return rawData;var chartType=displayProperties.chart||"column";if(chartType in{pie:!0,scatter:!0,radialGauge:!0,fillerGauge:!0,markerGauge:!0})return rawData;if(rawData.fields.length>=MAX_SERIES){var spanColumn,normalizedFields=_(rawData.fields).map(function(field){return _.isString(field)?field:field.name}),spanIndex=_(normalizedFields).indexOf("_span");spanIndex>-1&&spanIndex>=MAX_SERIES&&(spanColumn=rawData.columns[spanIndex]);rawData={columns:rawData.columns.slice(0,MAX_SERIES),fields:rawData.fields.slice(0,MAX_SERIES)};if(spanColumn){rawData.columns.push(spanColumn);rawData.fields.push("_span")}}var perChartLimit=parseInt(displayProperties["chart.resultTruncationLimit"],10)||parseInt(displayProperties["resultTruncationLimit"],10),truncationLimit=perChartLimit>0?perChartLimit:MAX_POINTS,visibleFields=_(rawData.fields).filter(fieldIsVisible),numDataSeries=visibleFields.length-1,pointsPerSeries=rawData.columns[0].length,allowedPointsPerSeries=Math.floor(truncationLimit/numDataSeries);return pointsPerSeries>allowedPointsPerSeries?sliceResultsToSeriesLength(rawData,allowedPointsPerSeries):rawData};return{getCustomDisplayProperties:getCustomDisplayProperties,preprocessChartData:preprocessChartData}});!function($){function num(v){return parseInt(v,10)||0}function isNumber(value){return!isNaN(parseInt(value,10))}$.widget("ui.resizable",$.ui.mouse,{version:"1.10.3",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_create:function(){var n,i,handle,axis,hname,that=this,o=this.options;this.element.addClass("ui-resizable");$.extend(this,{_aspectRatio:!!o.aspectRatio,aspectRatio:o.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:o.helper||o.ghost||o.animate?o.helper||"ui-resizable-helper":null});if(this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)){this.element.wrap($("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")}));this.element=this.element.parent().data("ui-resizable",this.element.data("ui-resizable"));this.elementIsWrapper=!0;this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")});this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0});this.originalResizeStyle=this.originalElement.css("resize");this.originalElement.css("resize","none");this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"}));this.originalElement.css({margin:this.originalElement.css("margin")});this._proportionallyResize()}this.handles=o.handles||($(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se");if(this.handles.constructor===String){"all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw");n=this.handles.split(",");this.handles={};for(i=0;i<n.length;i++){handle=$.trim(n[i]);hname="ui-resizable-"+handle;axis=$("<div class='ui-resizable-handle "+hname+"'></div>");axis.css({zIndex:o.zIndex});"se"===handle&&axis.addClass("ui-icon ui-icon-gripsmall-diagonal-se");this.handles[handle]=".ui-resizable-"+handle;this.element.append(axis)}}this._renderAxis=function(target){var i,axis,padPos,padWrapper;target=target||this.element;for(i in this.handles){this.handles[i].constructor===String&&(this.handles[i]=$(this.handles[i],this.element).show());if(this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)){axis=$(this.handles[i],this.element);padWrapper=/sw|ne|nw|se|n|s/.test(i)?axis.outerHeight():axis.outerWidth();padPos=["padding",/ne|nw|n/.test(i)?"Top":/se|sw|s/.test(i)?"Bottom":/^e$/.test(i)?"Right":"Left"].join("");target.css(padPos,padWrapper);this._proportionallyResize()}$(this.handles[i]).length}};this._renderAxis(this.element);this._handles=$(".ui-resizable-handle",this.element).disableSelection();this._handles.mouseover(function(){if(!that.resizing){this.className&&(axis=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i));that.axis=axis&&axis[1]?axis[1]:"se"}});if(o.autoHide){this._handles.hide();$(this.element).addClass("ui-resizable-autohide").mouseenter(function(){if(!o.disabled){$(this).removeClass("ui-resizable-autohide");that._handles.show()}}).mouseleave(function(){if(!o.disabled&&!that.resizing){$(this).addClass("ui-resizable-autohide");that._handles.hide()}})}this._mouseInit()},_destroy:function(){this._mouseDestroy();var wrapper,_destroy=function(exp){$(exp).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};if(this.elementIsWrapper){_destroy(this.element);wrapper=this.element;this.originalElement.css({position:wrapper.css("position"),width:wrapper.outerWidth(),height:wrapper.outerHeight(),top:wrapper.css("top"),left:wrapper.css("left")}).insertAfter(wrapper);wrapper.remove()}this.originalElement.css("resize",this.originalResizeStyle);_destroy(this.originalElement);return this},_mouseCapture:function(event){var i,handle,capture=!1;for(i in this.handles){handle=$(this.handles[i])[0];(handle===event.target||$.contains(handle,event.target))&&(capture=!0)}return!this.options.disabled&&capture},_mouseStart:function(event){var curleft,curtop,cursor,o=this.options,iniPos=this.element.position(),el=this.element;this.resizing=!0;/absolute/.test(el.css("position"))?el.css({position:"absolute",top:el.css("top"),left:el.css("left")}):el.is(".ui-draggable")&&el.css({position:"absolute",top:iniPos.top,left:iniPos.left});this._renderProxy();curleft=num(this.helper.css("left"));curtop=num(this.helper.css("top"));if(o.containment){curleft+=$(o.containment).scrollLeft()||0;curtop+=$(o.containment).scrollTop()||0}this.offset=this.helper.offset();this.position={left:curleft,top:curtop};this.size=this._helper?{width:el.outerWidth(),height:el.outerHeight()}:{width:el.width(),height:el.height()};this.originalSize=this._helper?{width:el.outerWidth(),height:el.outerHeight()}:{width:el.width(),height:el.height()};this.originalPosition={left:curleft,top:curtop};this.sizeDiff={width:el.outerWidth()-el.width(),height:el.outerHeight()-el.height()};this.originalMousePosition={left:event.pageX,top:event.pageY};this.aspectRatio="number"==typeof o.aspectRatio?o.aspectRatio:this.originalSize.width/this.originalSize.height||1;cursor=$(".ui-resizable-"+this.axis).css("cursor");$("body").css("cursor","auto"===cursor?this.axis+"-resize":cursor);el.addClass("ui-resizable-resizing");this._propagate("start",event);return!0},_mouseDrag:function(event){var data,el=this.helper,props={},smp=this.originalMousePosition,a=this.axis,prevTop=this.position.top,prevLeft=this.position.left,prevWidth=this.size.width,prevHeight=this.size.height,dx=event.pageX-smp.left||0,dy=event.pageY-smp.top||0,trigger=this._change[a];if(!trigger)return!1;data=trigger.apply(this,[event,dx,dy]);this._updateVirtualBoundaries(event.shiftKey);(this._aspectRatio||event.shiftKey)&&(data=this._updateRatio(data,event));data=this._respectSize(data,event);this._updateCache(data);this._propagate("resize",event);this.position.top!==prevTop&&(props.top=this.position.top+"px");this.position.left!==prevLeft&&(props.left=this.position.left+"px");this.size.width!==prevWidth&&(props.width=this.size.width+"px");this.size.height!==prevHeight&&(props.height=this.size.height+"px");el.css(props);!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize();$.isEmptyObject(props)||this._trigger("resize",event,this.ui());return!1},_mouseStop:function(event){this.resizing=!1;var pr,ista,soffseth,soffsetw,s,left,top,o=this.options,that=this;if(this._helper){pr=this._proportionallyResizeElements;ista=pr.length&&/textarea/i.test(pr[0].nodeName);soffseth=ista&&$.ui.hasScroll(pr[0],"left")?0:that.sizeDiff.height;soffsetw=ista?0:that.sizeDiff.width;s={width:that.helper.width()-soffsetw,height:that.helper.height()-soffseth};left=parseInt(that.element.css("left"),10)+(that.position.left-that.originalPosition.left)||null;top=parseInt(that.element.css("top"),10)+(that.position.top-that.originalPosition.top)||null;o.animate||this.element.css($.extend(s,{top:top,left:left}));that.helper.height(that.size.height);that.helper.width(that.size.width);this._helper&&!o.animate&&this._proportionallyResize()}$("body").css("cursor","auto");this.element.removeClass("ui-resizable-resizing");this._propagate("stop",event);this._helper&&this.helper.remove();return!1},_updateVirtualBoundaries:function(forceAspectRatio){var pMinWidth,pMaxWidth,pMinHeight,pMaxHeight,b,o=this.options;b={minWidth:isNumber(o.minWidth)?o.minWidth:0,maxWidth:isNumber(o.maxWidth)?o.maxWidth:1/0,minHeight:isNumber(o.minHeight)?o.minHeight:0,maxHeight:isNumber(o.maxHeight)?o.maxHeight:1/0};if(this._aspectRatio||forceAspectRatio){pMinWidth=b.minHeight*this.aspectRatio;pMinHeight=b.minWidth/this.aspectRatio;pMaxWidth=b.maxHeight*this.aspectRatio;pMaxHeight=b.maxWidth/this.aspectRatio;pMinWidth>b.minWidth&&(b.minWidth=pMinWidth);pMinHeight>b.minHeight&&(b.minHeight=pMinHeight);pMaxWidth<b.maxWidth&&(b.maxWidth=pMaxWidth);pMaxHeight<b.maxHeight&&(b.maxHeight=pMaxHeight)}this._vBoundaries=b},_updateCache:function(data){this.offset=this.helper.offset();isNumber(data.left)&&(this.position.left=data.left);isNumber(data.top)&&(this.position.top=data.top);isNumber(data.height)&&(this.size.height=data.height);isNumber(data.width)&&(this.size.width=data.width)},_updateRatio:function(data){var cpos=this.position,csize=this.size,a=this.axis;isNumber(data.height)?data.width=data.height*this.aspectRatio:isNumber(data.width)&&(data.height=data.width/this.aspectRatio);if("sw"===a){data.left=cpos.left+(csize.width-data.width);data.top=null}if("nw"===a){data.top=cpos.top+(csize.height-data.height);data.left=cpos.left+(csize.width-data.width)}return data},_respectSize:function(data){var o=this._vBoundaries,a=this.axis,ismaxw=isNumber(data.width)&&o.maxWidth&&o.maxWidth<data.width,ismaxh=isNumber(data.height)&&o.maxHeight&&o.maxHeight<data.height,isminw=isNumber(data.width)&&o.minWidth&&o.minWidth>data.width,isminh=isNumber(data.height)&&o.minHeight&&o.minHeight>data.height,dw=this.originalPosition.left+this.originalSize.width,dh=this.position.top+this.size.height,cw=/sw|nw|w/.test(a),ch=/nw|ne|n/.test(a);isminw&&(data.width=o.minWidth);isminh&&(data.height=o.minHeight);ismaxw&&(data.width=o.maxWidth);ismaxh&&(data.height=o.maxHeight);isminw&&cw&&(data.left=dw-o.minWidth);ismaxw&&cw&&(data.left=dw-o.maxWidth);isminh&&ch&&(data.top=dh-o.minHeight);ismaxh&&ch&&(data.top=dh-o.maxHeight);data.width||data.height||data.left||!data.top?data.width||data.height||data.top||!data.left||(data.left=null):data.top=null;return data},_proportionallyResize:function(){if(this._proportionallyResizeElements.length){var i,j,borders,paddings,prel,element=this.helper||this.element;for(i=0;i<this._proportionallyResizeElements.length;i++){prel=this._proportionallyResizeElements[i];if(!this.borderDif){this.borderDif=[];borders=[prel.css("borderTopWidth"),prel.css("borderRightWidth"),prel.css("borderBottomWidth"),prel.css("borderLeftWidth")];paddings=[prel.css("paddingTop"),prel.css("paddingRight"),prel.css("paddingBottom"),prel.css("paddingLeft")];for(j=0;j<borders.length;j++)this.borderDif[j]=(parseInt(borders[j],10)||0)+(parseInt(paddings[j],10)||0)}prel.css({height:element.height()-this.borderDif[0]-this.borderDif[2]||0,width:element.width()-this.borderDif[1]-this.borderDif[3]||0})}}},_renderProxy:function(){var el=this.element,o=this.options;this.elementOffset=el.offset();if(this._helper){this.helper=this.helper||$("<div style='overflow:hidden;'></div>");this.helper.addClass(this._helper).css({width:this.element.outerWidth()-1,height:this.element.outerHeight()-1,position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++o.zIndex});this.helper.appendTo("body").disableSelection()}else this.helper=this.element},_change:{e:function(event,dx){return{width:this.originalSize.width+dx}},w:function(event,dx){var cs=this.originalSize,sp=this.originalPosition;return{left:sp.left+dx,width:cs.width-dx}},n:function(event,dx,dy){var cs=this.originalSize,sp=this.originalPosition;return{top:sp.top+dy,height:cs.height-dy}},s:function(event,dx,dy){return{height:this.originalSize.height+dy}},se:function(event,dx,dy){return $.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[event,dx,dy]))},sw:function(event,dx,dy){return $.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[event,dx,dy]))},ne:function(event,dx,dy){return $.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[event,dx,dy]))},nw:function(event,dx,dy){return $.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[event,dx,dy]))}},_propagate:function(n,event){$.ui.plugin.call(this,n,[event,this.ui()]);"resize"!==n&&this._trigger(n,event,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}});$.ui.plugin.add("resizable","animate",{stop:function(event){var that=$(this).data("ui-resizable"),o=that.options,pr=that._proportionallyResizeElements,ista=pr.length&&/textarea/i.test(pr[0].nodeName),soffseth=ista&&$.ui.hasScroll(pr[0],"left")?0:that.sizeDiff.height,soffsetw=ista?0:that.sizeDiff.width,style={width:that.size.width-soffsetw,height:that.size.height-soffseth},left=parseInt(that.element.css("left"),10)+(that.position.left-that.originalPosition.left)||null,top=parseInt(that.element.css("top"),10)+(that.position.top-that.originalPosition.top)||null;that.element.animate($.extend(style,top&&left?{top:top,left:left}:{}),{duration:o.animateDuration,easing:o.animateEasing,step:function(){var data={width:parseInt(that.element.css("width"),10),height:parseInt(that.element.css("height"),10),top:parseInt(that.element.css("top"),10),left:parseInt(that.element.css("left"),10)};pr&&pr.length&&$(pr[0]).css({width:data.width,height:data.height});that._updateCache(data);that._propagate("resize",event)}})}});$.ui.plugin.add("resizable","containment",{start:function(){var element,p,co,ch,cw,width,height,that=$(this).data("ui-resizable"),o=that.options,el=that.element,oc=o.containment,ce=oc instanceof $?oc.get(0):/parent/.test(oc)?el.parent().get(0):oc;if(ce){that.containerElement=$(ce);if(/document/.test(oc)||oc===document){that.containerOffset={left:0,top:0};that.containerPosition={left:0,top:0};that.parentData={element:$(document),left:0,top:0,width:$(document).width(),height:$(document).height()||document.body.parentNode.scrollHeight}}else{element=$(ce);p=[];$(["Top","Right","Left","Bottom"]).each(function(i,name){p[i]=num(element.css("padding"+name))});that.containerOffset=element.offset();that.containerPosition=element.position();that.containerSize={height:element.innerHeight()-p[3],width:element.innerWidth()-p[1]};co=that.containerOffset;ch=that.containerSize.height;cw=that.containerSize.width;width=$.ui.hasScroll(ce,"left")?ce.scrollWidth:cw;height=$.ui.hasScroll(ce)?ce.scrollHeight:ch;that.parentData={element:ce,left:co.left,top:co.top,width:width,height:height}}}},resize:function(event){var woset,hoset,isParent,isOffsetRelative,that=$(this).data("ui-resizable"),o=that.options,co=that.containerOffset,cp=that.position,pRatio=that._aspectRatio||event.shiftKey,cop={top:0,left:0},ce=that.containerElement;ce[0]!==document&&/static/.test(ce.css("position"))&&(cop=co);if(cp.left<(that._helper?co.left:0)){that.size.width=that.size.width+(that._helper?that.position.left-co.left:that.position.left-cop.left);pRatio&&(that.size.height=that.size.width/that.aspectRatio);that.position.left=o.helper?co.left:0}if(cp.top<(that._helper?co.top:0)){that.size.height=that.size.height+(that._helper?that.position.top-co.top:that.position.top);pRatio&&(that.size.width=that.size.height*that.aspectRatio);that.position.top=that._helper?co.top:0}that.offset.left=that.parentData.left+that.position.left;that.offset.top=that.parentData.top+that.position.top;woset=Math.abs((that._helper?that.offset.left-cop.left:that.offset.left-cop.left)+that.sizeDiff.width);hoset=Math.abs((that._helper?that.offset.top-cop.top:that.offset.top-co.top)+that.sizeDiff.height);isParent=that.containerElement.get(0)===that.element.parent().get(0);isOffsetRelative=/relative|absolute/.test(that.containerElement.css("position"));isParent&&isOffsetRelative&&(woset-=that.parentData.left);if(woset+that.size.width>=that.parentData.width){that.size.width=that.parentData.width-woset;pRatio&&(that.size.height=that.size.width/that.aspectRatio)}if(hoset+that.size.height>=that.parentData.height){that.size.height=that.parentData.height-hoset;pRatio&&(that.size.width=that.size.height*that.aspectRatio)}},stop:function(){var that=$(this).data("ui-resizable"),o=that.options,co=that.containerOffset,cop=that.containerPosition,ce=that.containerElement,helper=$(that.helper),ho=helper.offset(),w=helper.outerWidth()-that.sizeDiff.width,h=helper.outerHeight()-that.sizeDiff.height;that._helper&&!o.animate&&/relative/.test(ce.css("position"))&&$(this).css({left:ho.left-cop.left-co.left,width:w,height:h});that._helper&&!o.animate&&/static/.test(ce.css("position"))&&$(this).css({left:ho.left-cop.left-co.left,width:w,height:h})}});$.ui.plugin.add("resizable","alsoResize",{start:function(){var that=$(this).data("ui-resizable"),o=that.options,_store=function(exp){$(exp).each(function(){var el=$(this);el.data("ui-resizable-alsoresize",{width:parseInt(el.width(),10),height:parseInt(el.height(),10),left:parseInt(el.css("left"),10),top:parseInt(el.css("top"),10)})})};if("object"!=typeof o.alsoResize||o.alsoResize.parentNode)_store(o.alsoResize);else if(o.alsoResize.length){o.alsoResize=o.alsoResize[0];_store(o.alsoResize)}else $.each(o.alsoResize,function(exp){_store(exp)})},resize:function(event,ui){var that=$(this).data("ui-resizable"),o=that.options,os=that.originalSize,op=that.originalPosition,delta={height:that.size.height-os.height||0,width:that.size.width-os.width||0,top:that.position.top-op.top||0,left:that.position.left-op.left||0},_alsoResize=function(exp,c){$(exp).each(function(){var el=$(this),start=$(this).data("ui-resizable-alsoresize"),style={},css=c&&c.length?c:el.parents(ui.originalElement[0]).length?["width","height"]:["width","height","top","left"];$.each(css,function(i,prop){var sum=(start[prop]||0)+(delta[prop]||0);sum&&sum>=0&&(style[prop]=sum||null)});el.css(style)})};"object"!=typeof o.alsoResize||o.alsoResize.nodeType?_alsoResize(o.alsoResize):$.each(o.alsoResize,function(exp,c){_alsoResize(exp,c)})},stop:function(){$(this).removeData("resizable-alsoresize")}});$.ui.plugin.add("resizable","ghost",{start:function(){var that=$(this).data("ui-resizable"),o=that.options,cs=that.size;that.ghost=that.originalElement.clone();that.ghost.css({opacity:.25,display:"block",position:"relative",height:cs.height,width:cs.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass("string"==typeof o.ghost?o.ghost:"");that.ghost.appendTo(that.helper)},resize:function(){var that=$(this).data("ui-resizable");that.ghost&&that.ghost.css({position:"relative",height:that.size.height,width:that.size.width})},stop:function(){var that=$(this).data("ui-resizable");that.ghost&&that.helper&&that.helper.get(0).removeChild(that.ghost.get(0))}});$.ui.plugin.add("resizable","grid",{resize:function(){var that=$(this).data("ui-resizable"),o=that.options,cs=that.size,os=that.originalSize,op=that.originalPosition,a=that.axis,grid="number"==typeof o.grid?[o.grid,o.grid]:o.grid,gridX=grid[0]||1,gridY=grid[1]||1,ox=Math.round((cs.width-os.width)/gridX)*gridX,oy=Math.round((cs.height-os.height)/gridY)*gridY,newWidth=os.width+ox,newHeight=os.height+oy,isMaxWidth=o.maxWidth&&o.maxWidth<newWidth,isMaxHeight=o.maxHeight&&o.maxHeight<newHeight,isMinWidth=o.minWidth&&o.minWidth>newWidth,isMinHeight=o.minHeight&&o.minHeight>newHeight;o.grid=grid;isMinWidth&&(newWidth+=gridX);isMinHeight&&(newHeight+=gridY);isMaxWidth&&(newWidth-=gridX);isMaxHeight&&(newHeight-=gridY);if(/^(se|s|e)$/.test(a)){that.size.width=newWidth;that.size.height=newHeight}else if(/^(ne)$/.test(a)){that.size.width=newWidth;that.size.height=newHeight;that.position.top=op.top-oy}else if(/^(sw)$/.test(a)){that.size.width=newWidth;that.size.height=newHeight;that.position.left=op.left-ox}else{that.size.width=newWidth;that.size.height=newHeight;that.position.top=op.top-oy;that.position.left=op.left-ox}}})}(jQuery);define("jquery.ui.resizable",["jquery.ui.widget","jquery.ui.mouse"],function(){});requirejs.s.contexts._.nextTick=function(f){f()};require(["css"],function(css){css.addBuffer("splunkjs/css/jschart.css")});requirejs.s.contexts._.nextTick=requirejs.nextTick;define("splunkjs/mvc/chartview",["require","exports","module","underscore","jquery","./mvc","./basesplunkview","./messages","./drilldown","./utils","util/console","splunk.util","splunk.legend","util/jscharting_utils","splunk.config","jquery.ui.resizable","util/general_utils","./tokenawaremodel","uri/route","helpers/Printer","css!../css/jschart"],function(require,exports,module){var JSCharting,_=require("underscore"),$=require("jquery"),mvc=require("./mvc"),BaseSplunkView=require("./basesplunkview"),Messages=require("./messages"),Drilldown=require("./drilldown"),utils=require("./utils"),console=require("util/console"),SplunkUtil=require("splunk.util"),SplunkLegend=require("splunk.legend"),jschartingUtils=require("util/jscharting_utils"),splunkConfig=require("splunk.config"),GeneralUtils=(require("jquery.ui.resizable"),require("util/general_utils")),TokenAwareModel=require("./tokenawaremodel"),Route=require("uri/route"),Printer=require("helpers/Printer");require("css!../css/jschart");var ChartView=BaseSplunkView.extend({moduleId:module.id,className:"splunk-chart",chartOptionPrefix:"charting.",options:{height:"250px",data:"preview",type:"column",drilldownRedirect:!0,"charting.drilldown":"all",resizable:!1},omitFromSettings:["el","reportModel","drilldown"],normalizeOptions:function(settings,options){this._normalizeDrilldownType(settings,options[options.hasOwnProperty("charting.drilldown")?"charting.drilldown":"drilldown"]);options.hasOwnProperty("charting.layout.splitSeries")&&(GeneralUtils.isBooleanEquivalent(options["charting.layout.splitSeries"])?settings.set("charting.layout.splitSeries",GeneralUtils.normalizeBoolean(options["charting.layout.splitSeries"])?"1":"0"):settings.set("charting.layout.splitSeries",options["charting.layout.splitSeries"]));options.hasOwnProperty("show")&&settings.set("show",SplunkUtil.normalizeBoolean(options.show)?"1":"0");options.hasOwnProperty("charting.axisY2.enabled")&&(GeneralUtils.isBooleanEquivalent(options["charting.axisY2.enabled"])?settings.set("charting.axisY2.enabled",GeneralUtils.normalizeBoolean(options["charting.axisY2.enabled"])?"1":"0"):settings.set("charting.axisY2.enabled",options["charting.axisY2.enabled"]));options.hasOwnProperty("charting.legend.labelStyle.overflowMode")&&("default"===options["charting.legend.labelStyle.overflowMode"]?settings.set("charting.legend.labelStyle.overflowMode","ellipsisMiddle"):settings.set("charting.legend.labelStyle.overflowMode",options["charting.legend.labelStyle.overflowMode"]))},_normalizeDrilldownType:function(settings,value){settings.set("charting.drilldown",Drilldown.getNormalizedDrilldownType(value,{allowBoolean:!0}))},initialize:function(options){this.configure();this.model=this.options.reportModel||TokenAwareModel._createReportModel();this.settings._sync=utils.syncModels(this.settings,this.model,{auto:!0,prefix:"display.visualizations.",exclude:["managerid","id","name","data","type","drilldownRedirect","height"]});this.normalizeOptions(this.settings,options);this.settings.on("change:drilldown change:charting.drilldown",this._normalizeDrilldownType,this);this.maxResultCount=1e3;this.settings.has("charting.data.count")&&!_.isNaN(parseInt(this.settings.get("charting.data.count"),10))&&(this.maxResultCount=parseInt(this.settings.get("charting.data.count"),10));this._currentHeight=parseInt(this.settings.get("height"),10);this.$chart=$("<div></div>");this.$msg=$("<div></div>");this.$inlineMsg=$("<div></div>");this.settings.on("change",this.render,this);var self=this;require(["js_charting/js_charting"],function(JSChartingLib){JSCharting=JSChartingLib;self._chartCreationPending&&self.chartData&&self._createChart();self.createChart=self._createChart});this.bindToComponentSetting("managerid",this._onManagerChange,this);SplunkLegend.register(this.cid);this._onResizeMouseup=_.bind(this._onResizeMouseup,this);this.settings.on("change:resizable",function(model,value){value?this._enableResize():this._disableResize()},this);this.settings.get("resizable")&&this._enableResize();this.settings.on("change:height",this._onChartHeightChange,this);this.listenTo(Printer,Printer.PRINT_START,this.resizeChart);this.listenTo(Printer,Printer.PRINT_END,this.resizeChart);this.manager||this._onManagerChange(mvc.Components,null)},_onManagerChange:function(managers,manager){if(this.manager){this.manager.off(null,null,this);this.manager=null}if(this.resultsModel){this.resultsModel.off(null,null,this);this.resultsModel=null}if(manager){this.message("empty");this._err=!1;this.manager=manager;this.resultsModel=this.manager.data(this.settings.get("data"),{autofetch:!0,output_mode:"json_cols",show_metadata:!0,count:this.maxResultCount});this.resultsModel.on("data",this._onDataChanged,this);this.resultsModel.on("error",this._onSearchError,this);manager.on("search:start",this._onSearchStart,this);manager.on("search:progress",this._onSearchProgress,this);manager.on("search:done",this._onSearchProgress,this);manager.on("search:cancelled",this._onSearchCancelled,this);manager.on("search:refresh",this._onSearchRefresh,this);manager.on("search:fail",this._onSearchFailed,this);manager.on("search:error",this._onSearchError,this);manager.replayLastSearchEvent(this)}else this.message("no-search")},_onDataChanged:function(){if(this.resultsModel.hasData()){var chartData=this.resultsModel.data();console.log("chart data changed:",chartData);if(chartData.fields.length){this.chartData=chartData;this.updateChart()}}else this._isJobDone&&this.message("no-results")},_onSearchProgress:function(properties){this._err=!1;properties=properties||{};var content=properties.content||{},previewCount=content.resultPreviewCount||0,isJobDone=this._isJobDone=content.isDone||!1;0===previewCount&&isJobDone?this.message("no-results"):0===previewCount&&this.message("waiting")},_onSearchCancelled:function(){this._isJobDone=!1;this.message("cancelled")},_onSearchRefresh:function(){this._isJobDone=!1;this.message("refresh")},_onSearchError:function(message,err){this._isJobDone=!1;this._err=!0;var msg=Messages.getSearchErrorMessage(err)||message;this.message({level:"error",icon:"warning-sign",message:msg})},_onSearchFailed:function(state){this._isJobDone=!1;this._err=!0;var msg=Messages.getSearchFailureMessage(state);this.message({level:"error",icon:"warning-sign",message:msg})},_onSearchStart:function(){this._isJobDone=!1;this._err=!1;this.destroyChart();this.message("waiting")},message:function(info){this.$msg.detach();Messages.render(info,this.$msg);this.$msg.prependTo(this.$el)},inlineMessage:function(info){info.compact=!0;Messages.render(info,this.$inlineMsg)},render:function(){this.$el.height(this._currentHeight).css("overflow","hidden");this.$msg.height(this._currentHeight).css("overflow","hidden");this.$chart.appendTo(this.$el);this.$inlineMsg.appendTo(this.$el);
this.chart&&this.destroyChart();this._boundInvalidateChart||(this._boundInvalidateChart=_.bind(this.invalidateChart,this));SplunkLegend.removeEventListener("labelIndexMapChanged",this._boundInvalidateChart);SplunkLegend.addEventListener("labelIndexMapChanged",this._boundInvalidateChart);this._debouncedResize||(this._debouncedResize=_.debounce(_.bind(this.resizeChart,this),100));$(window).off("resize",this._debouncedResize);$(window).on("resize",this._debouncedResize);this.createChart();return this},show:function(){this.$el.css("display","")},hide:function(){this.$el.css("display","none")},createChart:function(){this._chartCreationPending=!0},_enableResize:function(){if(this._canEnableResize()){this.$el.resizable({autoHide:!0,handles:"s",stop:this._onResizeStop.bind(this)});this.$el.on("mouseup",this._onResizeMouseup)}},_disableResize:function(){if(this._canEnableResize()){this.$el.resizable("destroy");this.$el.off("mouseup",this._onResizeMouseup)}},_onResizeMouseup:function(){$(this).width("100%")},_onResizeStop:function(event){$(event.target).width("100%");this._currentHeight=this.$el.height();this.settings.set("height",this._currentHeight);this.resizeChart()},_canEnableResize:function(){return!0},_createChart:function(){var displayProperties={chart:this.settings.get("type")},prefix=this.chartOptionPrefix;_.each(this.settings.toJSON(),function(value,key){key.substring(0,prefix.length)==prefix&&(displayProperties[key.substring(prefix.length)]=value)},this);if(!this._err){this.$msg.detach();console.log("Creating chart with data: ",displayProperties);var chart=this.chart=JSCharting.createChart(this.$chart,displayProperties);chart.on("pointClick",this.emitDrilldownEvent.bind(this));chart.on("legendClick",this.emitDrilldownEvent.bind(this));chart.on("chartRangeSelect",this.emitSelectionEvent.bind(this));this.updateChart()}},_onChartHeightChange:function(){this._currentHeight=parseInt(this.settings.get("height"),10);this.resizeChart()},resizeChart:function(){if(this.chart){this.updateChartContainerHeight();this.chart.resize()}},updateChart:function(){if(!this._err){console.log("updateChart data=%o this.chart=%o",this.chartData,this.chart);if(this.chartData)if(this.chart){this.$msg.detach();this.$inlineMsg.empty();var processedChartData=jschartingUtils.preprocessChartData(this.chartData,this.chart.getCurrentDisplayProperties()),chartReadyData=JSCharting.extractChartReadyData(processedChartData);this.chart.prepare(chartReadyData,jschartingUtils.getCustomDisplayProperties(chartReadyData,splunkConfig));if(processedChartData.columns.length>0&&(processedChartData.columns.length<this.chartData.columns.length||processedChartData.columns[0].length<this.chartData.columns[0].length)){var rawMessage="These results may be truncated. Your search generated too much data for the current visualization configuration.",message=_(rawMessage).t(),pageInfo=utils.getPageInfo(),docsHref=Route.docHelp(pageInfo.root,pageInfo.locale,"learnmore.charting.datatruncation"),helpLink=' <a href="<%- href %>" target="_blank"><span><%- text %></span><i class="icon-external icon-no-underline"></i></a>';message+=_(helpLink).template({href:docsHref,text:_("Learn More").t()});this.inlineMessage({level:"warn",message:message})}else this.chartData.columns.length>0&&this.maxResultCount>0&&this.chartData.columns[0].length>=this.maxResultCount&&this.inlineMessage({level:"warn",message:SplunkUtil.sprintf(_("These results may be truncated. This visualization is configured to display a maximum of %s results per series, and that limit has been reached.").t(),this.maxResultCount)});this.updateChartContainerHeight();if(this.chart.requiresExternalColorPalette()){var fieldList=this.chart.getFieldList();SplunkLegend.setLabels(this.cid,fieldList)}this.invalidateChart()}else this.createChart()}},destroyChart:function(){if(this.chart){this.chart.off();this.chart.destroy();this.chart=null;clearTimeout(this._redrawChartTimeout)}},updateChartContainerHeight:function(){this.$chart.height(this._currentHeight-this.$inlineMsg.outerHeight())},invalidateChart:function(){clearTimeout(this._redrawChartTimeout);if(this.chart&&this.chartData){var self=this;this._redrawChartTimeout=setTimeout(function(){self.chart.requiresExternalColorPalette()&&self.setChartColorPalette();var startTime=(new Date).getTime();self.chart.draw().done(function(){console.DEBUG_ENABLED&&console.log("Chart=%o drawn in duration=%o ms",self.model.get("display.visualizations.charting.chart"),(new Date).getTime()-startTime);self.trigger("rendered",self);self.model.set({currentChartFields:self.chart.getFieldList()})})},5)}},setChartColorPalette:function(){var fieldIndexMap={};_(this.chart.getFieldList()).each(function(field){fieldIndexMap[field]=SplunkLegend.getLabelIndex(field)});this.chart.setExternalColorPalette(fieldIndexMap,SplunkLegend.numLabels())},emitDrilldownEvent:function(e){var manager=this.manager,drilldownType=Drilldown.getNormalizedDrilldownType(this.settings.get("charting.drilldown"),{allowBoolean:!0}),payload=Drilldown.createEventPayload({field:e.name2||e.name,data:Drilldown.normalizeDrilldownEventData(e,{manager:manager,contextProperty:"rowContext"}),event:e},function(){Drilldown.autoDrilldown(e,manager,{drilldownType:"all"===drilldownType?"all":"none"})});this.trigger("drilldown click",payload,this);this.trigger("legendClick"===e.type?"clicked:legend click:legend":"clicked:chart click:chart",_.extend({},e,{preventDefault:payload.preventDefault,drilldown:payload.drilldown}),this);"all"===drilldownType&&this.settings.get("drilldownRedirect")&&!payload.defaultPrevented()&&payload.drilldown()},emitSelectionEvent:function(e){var data={start:e.startXValue,end:e.endXValue},results=this.resultsModel.data();_(results.fields).each(function(field,idx){data["start."+field.name]=results.columns[idx][e.startXIndex];data["end."+field.name]=results.columns[idx][e.endXIndex]});var eventObj={data:data,preventDefault:function(){e.preventDefault()},results:results,selection:function(){for(var data=[],i=e.startXIndex;i<=e.endXIndex;i++)data.push(_(results.columns).pluck(i));var fields=_(results.fields).pluck("name");return _(data).map(function(d){return _.object(fields,d)})},startIndex:e.startXIndex,endIndex:e.endXIndex,startValue:e.startXValue,endValue:e.endXValue,isReset:e.isReset,event:e};this.trigger("selection",eventObj,this)},remove:function(){SplunkLegend.unregister(this.cid);this._boundInvalidateChart&&SplunkLegend.removeEventListener("labelIndexMapChanged",this._boundInvalidateChart);this._debouncedResize&&$(window).off("resize",this._debouncedResize);this.chart&&this.destroyChart();if(this.settings){this.settings.off();this.settings._sync&&this.settings._sync.destroy()}BaseSplunkView.prototype.remove.call(this)}});return ChartView});define("splunkjs/mvc/simplexml/element/chart",["require","underscore","jquery","backbone","../../../mvc","./base","../../chartview","../mapper","util/console","splunk.util","../../drilldown"],function(require){var _=require("underscore"),DashboardElement=(require("jquery"),require("backbone"),require("../../../mvc"),require("./base")),ChartView=require("../../chartview"),Mapper=require("../mapper"),SplunkUtil=(require("util/console"),require("splunk.util")),Drilldown=require("../../drilldown"),chartingPrefix="display.visualizations.charting.",vizPrefix="display.visualizations.";Mapper.register("visualizations:charting",Mapper.extend({tagName:"chart",map:function(report,result,options){_(report.toJSON(options)).each(function(value,key){key.substring(0,chartingPrefix.length)===chartingPrefix&&(result.options[key.substring(vizPrefix.length)]=report.get(key,options))});options["charting.drilldown"]=Drilldown.getNormalizedDrilldownType(options["charting.drilldown"]||options.drilldown,{allowBoolean:!0});delete options.drilldown;result.removeOptions=["drilldown"];result.options["charting.axisY2.enabled"]=String(SplunkUtil.normalizeBoolean(result.options["charting.axisY2.enabled"]))}}));var ChartViz=ChartView.extend({panelClassName:"chart",reportDefaults:{"display.visualizations.show":!0,"display.visualizations.type":"charting","display.general.type":"visualizations"},options:_.defaults({resizable:!0},ChartView.prototype.options),getResultsLinkOptions:function(){return{}}});DashboardElement.registerVisualization("visualizations:charting",ChartViz);DashboardElement.registerVisualization("visualizations",ChartViz);var ChartElement=DashboardElement.extend({initialVisualization:"visualizations:charting"});return ChartElement});define("models/search/SelectedField",["models/Base"],function(BaseModel){return BaseModel.extend({initialize:function(){BaseModel.prototype.initialize.apply(this,arguments)},sync:function(){throw"Method disabled"}})});define("collections/search/SelectedFields",["collections/Base","models/search/SelectedField"],function(BaseCollection,SelectedFieldModel){return BaseCollection.extend({model:SelectedFieldModel,initialize:function(){BaseCollection.prototype.initialize.apply(this,arguments);this.on("reset add remove",function(){delete this._names},this)},sync:function(){throw"Method disabled"},valuesToJSONString:function(){return JSON.stringify(this.pluck("name"))},names:function(){this._names||(this._names=this.pluck("name"));return this._names},findByName:function(name){return this.find(function(model){return name===model.get("name")})}})});define("models/services/configs/EventRenderer",["models/SplunkDBase"],function(SplunkDBaseModel){return SplunkDBaseModel.extend({url:"configs/conf-event_renderers",initialize:function(){SplunkDBaseModel.prototype.initialize.apply(this,arguments)},getPriority:function(){return parseInt(this.entry.content.get("priority"),10)},getEventtype:function(){return this.entry.content.get("eventtype")}})});define("collections/services/configs/EventRenderers",["underscore","models/services/configs/EventRenderer","collections/SplunkDsBase"],function(_,EventRendererModel,SplunkDsBaseCollection){return SplunkDsBaseCollection.extend({url:"configs/conf-event_renderers",model:EventRendererModel,initialize:function(){SplunkDsBaseCollection.prototype.initialize.apply(this,arguments)},getRenderer:function(eventtypes){var renderer;if(eventtypes)for(var i=0;i<eventtypes.length;i++)for(var j=0;j<this.models.length;j++){var model=this.models[j];if(model.getEventtype()===eventtypes[i]){(!renderer||model.getPriority()>renderer.getPriority())&&(renderer=model);break}}return renderer}})});define("models/services/data/ui/WorkflowAction",["backbone","underscore","models/SplunkDBase"],function(Backbone,_,SplunkDBaseModel){var RAW_REX=/\$_raw\$/g;return SplunkDBaseModel.extend({url:"data/ui/workflow-actions",initialize:function(){SplunkDBaseModel.prototype.initialize.apply(this,arguments)},fieldSubstitute:function(text,data){var settings={interpolate:/\$([\s\S]+?)\$/g},$matches$=text.match(settings.interpolate);text=this.convertRaw(text,data);$matches$&&_($matches$).each(function($string$){data[$string$.match(/\$([\s\S]+?)\$/)[1]]||(text=text.replace($string$,""))},this);return _.template(text,data,settings)},systemSubstitute:function(text,sid,offset,namespace,latest_time,fieldName,fieldValue){var settings={interpolate:/\$@([\s\S]+?)\$/g},data={sid:sid,offset:offset,namespace:namespace,latest_time:latest_time,field_name:fieldName,field_value:fieldValue};return _.template(text,data,settings)},convertRaw:function(text,data){return RAW_REX.test(text)&&!_(data._raw).isArray()?text.replace(RAW_REX,data._raw.value):text},isInFieldMenu:function(){return"event_menu"!=this.entry.content.get("display_location")},isInEventMenu:function(){return"field_menu"!=this.entry.content.get("display_location")},isRestrictedByPresenceOfAllFields:function(event){var eventFields=event.toJSON(),fieldsPresent=0,fields=_(this.entry.content.get("fields").split(",")).map(function(field){return $.trim(field)},this),fieldsMatching=new Array(fields.length),len=fields.length;for(var field in eventFields)for(var k=0;len>k;k++){var rex=this.globber(fields[k]);if(rex){var value=rex.exec(field);if(!fieldsMatching[k]&&value&&value.length>0){fieldsMatching[k]=!0;fieldsPresent++;if(fieldsPresent>=len)return!1}}}return!0},isRestrictedByEventtype:function(event){var eventtypes,eventTypeFromEvent;if(!this.entry.content.has("eventtypes"))return!1;eventtypes=_(this.entry.content.get("eventtypes").split(",")).map(function(eventtype){return $.trim(eventtype)},this);if(event.has("eventtype")){eventTypeFromEvent=event.get("eventtype");var eventtypesLen=eventtypes.length,j=0;for(j;eventtypesLen>j;j++){var rex=this.globber(eventtypes[j]);if(rex){var len=eventTypeFromEvent.length,i=0;for(i;len>i;i++){var value=rex.exec(eventTypeFromEvent[i]);if(value&&value.length>0)return!1}}}}else if(eventtypes.indexOf("*")>-1)return!1;return!0},globber:function(str){var rex,chars=str.split("");"*"!==_.first(chars)&&chars.unshift("^");"*"!==_.last(chars)&&chars.push("$");str=chars.join("").replace(/\*/g,".*");try{rex=new RegExp(str)}catch(e){}return rex}})});define("collections/services/data/ui/WorkflowActions",["jquery","underscore","backbone","models/services/data/ui/WorkflowAction","collections/SplunkDsBase"],function($,_,Backbone,WorkflowActionModel,SplunkDsBaseCollection){return SplunkDsBaseCollection.extend({url:"data/ui/workflow-actions",model:WorkflowActionModel,initialize:function(){SplunkDsBaseCollection.prototype.initialize.apply(this,arguments)},getEventActions:function(event){var idxs=[];this.each(function(model,i){!model.isInEventMenu()||model.isRestrictedByEventtype(event)||model.isRestrictedByPresenceOfAllFields(event)||idxs.push(i)},this);return idxs},getFieldActions:function(event,field){var idxs=[];this.each(function(model,q){if(model.isInFieldMenu()&&!model.isRestrictedByEventtype(event)){var fields=_(model.entry.content.get("fields").split(",")).map(function(field){return $.trim(field)},this),k=0,len=fields.length;for(k;len>k;k++){var rex=model.globber(fields[k]);if(rex){var value=rex.exec(field);if(value&&value.length>0){idxs.push(q);break}}}}},this);return idxs}})});define("models/shared/fetchdata/ResultsFetchData",["underscore","models/Base"],function(_,Base){return Base.extend({defaults:{filter:{}},toJSON:function(){var json=Base.prototype.toJSON.apply(this,arguments),sortKey=json.sortKey,sortDirection=json.sortDirection,search=[];if(_(json.filter).size()>0){_(json.filter).each(function(match,key){var matches=_.isArray(match)?match:match.split(" ");search.push(matches.length>1?"("+_.chain(matches).map(function(match){return key+"=*"+match+"*"},this).join(" AND ").value()+")":"("+key+"=*"+matches[0]+"*)")});search=["search "+search.join(" OR ")]}delete json.filter;sortKey&&search.push("| sort 0 "+("desc"===sortDirection?"-":"")+'"'+sortKey+'"');delete json.sortKey;delete json.sortDirection;search.length>0&&(json.search=(void 0!=json.search?json.search:"")+search.join(" "));return json}})});define("models/services/search/jobs/Result",["jquery","underscore","backbone","models/Base","models/shared/fetchdata/ResultsFetchData","collections/Base","util/splunkd_utils","util/time","splunk.i18n"],function($,_,Backbone,BaseModel,ResultsFetchData,BaseCollection,splunkd_utils,time_utils,i18n){var Result=Backbone.Model.extend({initialize:function(){this.on("change",function(){this._keys=void 0;this._strip=void 0},this)},clear:function(){delete this._keys;delete this._strip;Backbone.Model.prototype.clear.apply(this,arguments)},idAttribute:"1ee63861-c188-11e2-8743-0017f209b4d8",systemFields:["host","source","sourcetype","punct"],timeFields:["_time","date_zone","date_year","date_month","date_mday","date_wday","date_hour","date_minute","date_second","timeendpos","timestartpos"],keys:function(){this._keys||(this._keys=_.keys(this.toJSON()));return this._keys},strip:function(){this._strip||(this._strip=_.intersection(this.keys(),_.filter(this.keys(),function(key){return!(0===key.indexOf("_")||0===key.indexOf("tag::")||0===key.indexOf("_raw"))})));return this._strip},system:function(){return _.intersection(this.strip(),this.systemFields)},notSystemOrTime:function(){var fields=this.strip();return _.intersection(fields,_.difference(fields,_.union(this.time(),this.system())))},time:function(){return _.intersection(this.keys(),this.timeFields)},isTruncated:function(){return this.has("_fulllinecount")},getFieldsLength:function(fields){return _(fields).reduce(function(m,f){return m+this.get(f).length},0,this)},rawToHTML:function(){function _rawToHtml(stree){var html=[],i=0;for(i=0;i<stree.length;i++){var leaf=stree[i];"object"==typeof leaf?html.push('<span class="t'+(leaf.highlight?" a":"")+'">',_rawToHtml(leaf.array),"</span>"):html.push(_.escape(tokens[leaf]||""))}return html.join("")}var raw=this.get("_raw");if(!raw)return"";{var tokens=raw.tokens,stree=raw.segment_tree;raw.types}return _rawToHtml(stree)},getRawText:function(){var raw=this.get("_raw");return raw?_.isArray(raw)?raw[0]:raw.value:""},getRawSegmentation:function(){var raw=this.get("_raw");return _.isArray(raw)?_.escape(raw[0]):this.rawToHTML()},formattedTime:function(){var time=this.get("_time");return time?i18n.format_datetime_microseconds(time_utils.jsDateToSplunkDateTimeWithMicroseconds(time_utils.isoToDateObject(time[0]))):""},replace:function(){return BaseModel.prototype.replace.apply(this,arguments)},deepOff:function(){this.off()},sync:function(method,model,options){if("read"!==method)throw new Error("invalid method: "+method);options=options||{};var appOwner=(options.data.search,{}),defaults={data:{output_mode:"json"}},url=model.id;options.data&&(appOwner=$.extend(appOwner,{app:options.data.app||void 0,owner:options.data.owner||void 0,sharing:options.data.sharing||void 0}));options.data.isRt?defaults.data.search=["search _serial=",this.get("_serial")[0]," AND ","splunk_server=",this.get("splunk_server")[0]," | head 1"].join(""):defaults.data.offset=this.collection.indexOf(this)+options.data.eventsOffset;defaults.url=splunkd_utils.fullpath(url,appOwner);defaults.data.count=1;defaults.truncation_mode="abstract";$.extend(!0,defaults,options);delete defaults.data.isRt;delete defaults.data.app;delete defaults.data.owner;delete defaults.data.sharing;delete defaults.data.eventsOffset;return Backbone.sync.call(this,method,model,defaults)},parse:function(response){_(response.results).each(function(result){_.each(result,function(v,k){result[k]="string"==typeof v?[v]:v},this)},this);return response.results[0]}}),Model=BaseModel.extend({url:"",initialize:function(data,options){options=options||{};options.fetchData=options.fetchData||new ResultsFetchData;BaseModel.prototype.initialize.call(this,data,options);this.initializeAssociated();options&&options.splunkDPayload&&this.setFromSplunkD(options.splunkDPayload,{silent:!0})},clear:function(){delete this.responseText;return BaseModel.prototype.clear.apply(this,arguments)},initializeAssociated:function(){var RootClass=this.constructor;this.associated=this.associated||{};this.results=this.results||new RootClass.Results;this.associated.results=this.results;this.messages=this.messages||new RootClass.Messages;this.associated.messages=this.messages;this.fields=this.fields||new RootClass.Fields;this.associated.fields=this.fields},sync:function(method,model,options){if("read"!==method)throw new Error("invalid method: "+method);options=options||{};var appOwner={},defaults={data:{output_mode:"json"},dataType:"text"},url=_.isFunction(model.url)?model.url():model.url||model.id;options.data&&(appOwner=$.extend(appOwner,{app:options.data.app||void 0,owner:options.data.owner||void 0,sharing:options.data.sharing||void 0}));defaults.url=splunkd_utils.fullpath(url,appOwner);$.extend(!0,defaults,options);delete defaults.data.app;delete defaults.data.owner;delete defaults.data.sharing;return Backbone.sync.call(this,method,model,defaults)},setFromSplunkD:function(payload,options){options=options||{};options.skipStoringResponseText||(this.responseText=JSON.stringify(payload));this.attributes={};if(payload){if(payload.messages){this.messages.reset(payload.messages,options);delete payload.messages}if(payload.fields){this.fields.reset(payload.fields,options);delete payload.fields}this.set(payload,options);if(payload.results){this.normalizeResults(payload.results);this.results.reset(payload.results,options);delete payload.results}}},parse:function(response,options){this.initializeAssociated();this.responseText=response;response=JSON.parse(response);if(options.parseLite){this.results.reset(_(response.results).map(function(){return{}}));return{}}this.normalizeResults(response.results);this.messages.reset(response.messages);delete response.messages;this.fields.reset(response.fields);delete response.fields;var results=response.results;delete response.results;this.set(response);this.results.reset(results);return{}},normalizeResults:function(results){_(results).each(function(result){_(result).each(function(v,k){result[k]="string"==typeof v?[v]:v},this)},this)},endOffset:function(){return(this.get("init_offset")||0)+this.results.length},lineNumber:function(offset,isRealTime){return isRealTime?this.endOffset()-offset:(this.get("init_offset")||0)+offset+1},offset:function(index){return(this.get("init_offset")||0)+index},getTags:function(field,value){var tags=this.get("tags"),matched=[];if(tags){matched=tags[field];matched&&(matched=matched[value]||[])}return matched||[]},setTagsSynthetically:function(field,value,tags){this.get("tags")||this.set("tags",{});this.get("tags")[field]||(this.get("tags")[field]={});this.get("tags")[field][value]||(this.get("tags")[field][value]=[]);this.get("tags")[field][value]=tags;this.trigger("tags-updated")}},{Results:BaseCollection.extend({model:Result,get:function(obj){if(null==obj)return void 0;this._idAttr||(this._idAttr=this.model.prototype.idAttribute);return this._byId[obj[this._idAttr]]}},{Result:Result}),Messages:BaseCollection.extend({model:BaseModel}),Fields:BaseCollection.extend({model:BaseModel})});return Model});define("models/services/search/jobs/Summary",["jquery","underscore","backbone","models/Base","collections/Base","util/splunkd_utils"],function($,_,Backbone,BaseModel,BaseCollection,splunkdutils){var Field=Backbone.Model.extend({idAttribute:"name",isNumeric:function(){return this.get("numeric_count")>this.get("count")/2},replace:function(){return BaseModel.prototype.replace.apply(this,arguments)},deepOff:function(){this.off()}}),Fields=BaseCollection.extend({model:Field}),Model=BaseModel.extend({url:"",initialize:function(data,options){BaseModel.prototype.initialize.apply(this,arguments);this.initializeAssociated();options&&options.splunkDPayload&&this.setFromSplunkD(options.splunkDPayload,{silent:!0});this.memoizedFrequency={};this.memoizedFields={};this.memoizedFilterByMinFrequency={};this.getFields().on("reset",function(){this.memoizedFrequency={};this.memoizedFields={};this.memoizedFilterByMinFrequency={}},this)},initializeAssociated:function(){var RootClass=this.constructor;this.associated=this.associated||{};this.fields=this.fields||new RootClass.Fields;this.associated.fields=this.fields},sync:function(method,model,options){if("read"!==method)throw new Error("invalid method: "+method);options=options||{};var appOwner={},defaults={data:{output_mode:"json"}},url=_.isFunction(model.url)?model.url():model.url||model.id;options.data&&(appOwner=$.extend(appOwner,{app:options.data.app||void 0,owner:options.data.owner||void 0,sharing:options.data.sharing||void 0}));defaults.url=splunkdutils.fullpath(url,appOwner);$.extend(!0,defaults,options);delete defaults.data.app;delete defaults.data.owner;delete defaults.data.sharing;return Backbone.sync.call(this,method,model,defaults)},_fields:function(data){var fields=[];_.each(data,function(fieldValue,fieldName){var field={name:fieldName};_.each(fieldValue,function(fieldPropertyValue,fieldPropertyName){field[fieldPropertyName]=fieldPropertyValue});fields.push(field)},this);return fields},parse:function(response,options){this.initializeAssociated();if(!response)return{};response=$.extend(!0,{},response);return this.parseAssociated(response,options)},setFromSplunkD:function(payload,options){payload=$.extend(!0,{},payload);this.attributes={};payload&&this.parseAssociated(payload,options)},parseAssociated:function(response,options){var fields=this._fields(this.getFieldsFromResponse(response));this.deleteFieldsFromResponse(response);this.set(response,options);var resetOptions=$.extend(!0,{parse:!0},options);this.getFields().reset(fields,resetOptions);return response},filterByMinFrequency:function(frequency){if(this.memoizedFilterByMinFrequency.hasOwnProperty(frequency))return this.memoizedFilterByMinFrequency[frequency];var eventCount=this.getEventCount(),filteredByMinFreq=this.getFields().filter(function(field){return field.get("count")/eventCount>=frequency});this.memoizedFilterByMinFrequency[frequency]=filteredByMinFreq;return filteredByMinFreq},frequency:function(fieldName){if(void 0!==this.memoizedFrequency[fieldName])return this.memoizedFrequency[fieldName];var freq,field=this.findByFieldName(fieldName);if(!field){this.memoizedFrequency[fieldName]=0;return 0}freq=field.get("count")/this.getEventCount();this.memoizedFrequency[fieldName]=freq;return freq},findByFieldName:function(fieldName){if(this.memoizedFields.hasOwnProperty(fieldName))return this.memoizedFields[fieldName];var field=this.getFields().get(fieldName);this.memoizedFields[fieldName]=field;return field},distribution:function(fieldName){var fieldHistogram,field=this.findByFieldName(fieldName),rootHistogram=this.get("histogram");if(!field)return[];fieldHistogram=field.get("histogram");if(!rootHistogram||!fieldHistogram)return[];var i,numBuckets=Math.min(rootHistogram.length,fieldHistogram.length),counts=[],totals=[];for(i=0;numBuckets>i;i++){counts.push(fieldHistogram[i].count);totals.push(rootHistogram[i].count)}for(var mergedCounts,mergedTotals,maxBuckets=30;numBuckets>maxBuckets;){mergedCounts=[];mergedTotals=[];for(i=numBuckets-1;i>=0;i-=2)if(i>0){mergedCounts.unshift(counts[i]+counts[i-1]);mergedTotals.unshift(totals[i]+totals[i-1])}else{mergedCounts.unshift(counts[i]);mergedTotals.unshift(totals[i])}counts=mergedCounts;totals=mergedTotals;numBuckets=counts.length}var percentages=[];for(i=0;numBuckets>i;i++)percentages.push(totals[i]>0?Math.min(100,counts[i]/totals[i]*100):0);return percentages},getEventCount:function(){return this.get("event_count")},getFields:function(){return this.fields},getFieldsFromResponse:function(response){return response.fields},deleteFieldsFromResponse:function(response){delete response.fields}},{Fields:Fields,Field:Field});return Model});define("views/shared/delegates/Modalize",["jquery","underscore","views/shared/delegates/Base"],function($,_,DelegateBase){return DelegateBase.extend({initialize:function(){var defaults={tbody:"> tbody",parentContainerSelector:"div",overlayZIndex:404};_.defaults(this.options,defaults);DelegateBase.prototype.initialize.apply(this,arguments)},show:function(rowIdx,optArg){this.cleanup();if(_.isNumber(rowIdx)){this.rowIdx=rowIdx;this.optArg=optArg;var $row=this.$(this.options.tbody).children(':not(".field-row")').eq(this.rowIdx),dimens={topHeight:0,bottomHeight:0,tableHeaderHeight:0,dockedThead:0,width:this.$el[0].scrollWidth+"px"};this.$el.append(this.$top=$('<div class="modalize-table-top" />'));this.$el.append(this.$bottom=$('<div class="modalize-table-bottom" />'));$(".main-section-body").append(this.$overlay=$('<div class="modalize-table-overlay" />'));this.addEventHandlers(_.debounce(function(rowIdx,optArg){this.show(rowIdx,optArg)}.bind(this),100));$row.prevAll(":visible").each(function(index,el){dimens.topHeight+=$(el).outerHeight(!0)});$row.nextAll(":visible").each(function(index,el){optArg&&0==index||(dimens.bottomHeight+=$(el).outerHeight(!0))});this.$el.find("> table:not(.table-expanded, .table-embed)").each(function(i,el){dimens.tableHeaderHeight+=$(el).find("tr").first().height()});this.applycss(dimens)}},update:function(){this.rowIdx&&this.show(this.rowIdx)},addEventHandlers:function(show){var unmodalize=function(){this.$top.remove();this.$bottom.remove();this.$overlay.remove();this.trigger("unmodalize",this.rowIdx);this.$el.closest(this.options.parentContainerSelector).css({"z-index":0})}.bind(this);this.$top.on("click",unmodalize);this.$bottom.on("click",unmodalize);this.$overlay.on("click",unmodalize);this.lastHeight=$(window).height();this.lastWidth=$(window).width();$(window).on("resize."+this.cid,function(){var height=$(window).height(),width=$(window).width();if(height!=this.lastHeight||width!=this.lastWidth){this.lastHeight=height;this.lastWidth=width;show(this.rowIdx,this.optArg)}}.bind(this))},cleanup:function(){this.rowIdx&&delete this.rowIdx;this.$top&&this.$top.remove();this.$bottom&&this.$bottom.remove();this.$overlay&&this.$overlay.remove();$(window).off("."+this.cid);this.$el.closest(this.options.parentContainerSelector).css({"z-index":0})},applycss:function(dimens){this.$el.closest(this.options.parentContainerSelector).css({"z-index":this.options.overlayZIndex+1});this.$top.css({width:dimens.width,height:dimens.topHeight+dimens.tableHeaderHeight+"px"});this.$bottom.css({width:dimens.width,height:dimens.bottomHeight+"px"});this.$overlay.css({"z-index":this.options.overlayZIndex})},remove:function(){DelegateBase.prototype.remove.apply(this);$(window).off("resize."+this.cid);this.$top&&this.$top.remove();this.$bottom&&this.$bottom.remove();this.$overlay&&this.$overlay.remove();return this}})});define("views/shared/eventsviewer/shared/TableHead",["underscore","jquery","module","views/Base","helpers/user_agent"],function(_,$,module,BaseView,user_agent){return BaseView.extend({moduleId:module.id,tagName:"thead",initialize:function(){var defaults={allowLineNum:!0};this.options=$.extend(!0,defaults,this.options);BaseView.prototype.initialize.apply(this,arguments)},updateLabels:function(labels){this.options.labels=labels;this.render()},render:function(){this.$el.html(this.compiledTemplate({_:_,is_ie7:user_agent.isIE7()||user_agent.isIE()&&user_agent.isInIE7DocumentMode()?"ie7":"",is_ie8:user_agent.isIE8()?"ie8":"",labels:this.options.labels||[],allowRowExpand:this.options.allowRowExpand,allowLineNum:this.options.allowLineNum}));return this},template:'                <tr>                    <% if (allowRowExpand) { %>                        <th class="col-info"><i class="icon-info"></i></th>                    <% } %>                    <% if (allowLineNum) { %>                        <th class="line-num <%- is_ie7 %>">&nbsp;</i></th>                    <% } %>                    <% _.each(labels, function(label, index) { %>                        <% if(index == labels.length-1) { %>                            <th class="col-<%- index %> <%- is_ie7 %> <%- is_ie8 %>"><%- _(label).t() %></th>                        <% } else { %>                            <th class="col-<%- index %> <%- is_ie7 %>"><%- _(label).t() %></th>                        <% } %>                    <% }) %>                </tr>            '})});define("keyboard/SearchModifier",["underscore"],function(_){function Modifier(options){options||(options={});var defaults=options.defaults||_.extend({},Modifier.defaults),custom=options.custom||_.extend([],Modifier.custom);this.map=this.parse(defaults,custom)}Modifier.prototype={isNegation:function(e){return!!e[this.map.negate]},isReplacement:function(e){return!!e[this.map.replace]},parse:function(defaults,custom){for(var userAgent=navigator.userAgent||"",modifierMatch=null,i=custom.length-1;i>-1;i--){var modifier=custom[i];-1!=userAgent.search(modifier.userAgentRex)&&(modifierMatch=modifier)}modifierMatch||(modifierMatch=defaults);return modifierMatch}};Modifier.custom=[{userAgentRex:/Macintosh/,negate:"altKey",replace:"metaKey"},{userAgentRex:/Linux.*Chrome/,negate:"ctrlKey",replace:"shiftKey"},{userAgentRex:/Linux/,negate:"ctrlKey",replace:"metaKey"},{userAgentRex:/Windows/,negate:"altKey",replace:"ctrlKey"}];Modifier.defaults={userAgentRex:/.*/,negate:"altKey",replace:"metaKey"};
return Modifier});define("contrib/text!views/shared/FieldInfo.html",[],function(){return'<% if (field) { %>\n    <a href="#" class="close"><i class="icon-close"></i></a>\n    <h2 class="field-info-header"><%- field.get(\'name\') %></h2>\n    <div class="divider"></div>\n    <% if (selectableFields) { %>\n        <div class="pull-right">\n            <label class="select-field-label"><%- _("Selected").t() %></label>\n            <div class="btn-group btn-group-radio">\n                <% var is_selected_field = selectedFields.findWhere({\'name\': field.get(\'name\')}); %>\n                <button class="btn select <%- is_selected_field ? \'active\' : \'\' %>" data-field-name="<%- field.get(\'name\') %>"><%- _("Yes").t() %></button>\n                <button class="btn unselect <%- is_selected_field ? \'\' : \'active\' %>" data-field-name="<%- field.get(\'name\') %>"><%- _("No").t() %></button>\n            </div>\n        </div>\n    <% } %>\n    <p><%- field.get("is_exact") ? "" : ">" %><%- field.get("distinct_count") %> <%- (field.get("distinct_count")>1) ?  _("Values").t(): _("Value").t() %>, <%= i18n.format_percent(summary.frequency(field.get(\'name\'))) %> <%- _("of events").t() %></p>\n    <h3 class="reports-header"><%- _("Reports").t() %></h3>\n    <table class="fields">\n        <tbody>\n            <% if (field.isNumeric()) { %>\n                <tr class="fields-numeric">\n                    <td><a href="#" data-visualization="line" data-report="avgbytime" data-field="<%- field.get(\'name\') %>"><%- _("Average over time").t() %></a></td>\n                    <td><a href="#" data-visualization="line" data-report="maxbytime" data-field="<%- field.get(\'name\') %>"><%- _("Maximum value over time").t() %></td>\n                    <td colspan="2"><a href="#" data-visualization="line" data-report="minbytime" data-field="<%- field.get(\'name\') %>"><%- _("Minimum value over time").t() %></td>\n                </tr>\n            <% } %>\n            <tr class="fields-values">\n                <td><a href="#" data-visualization="bar" data-report="top" data-field="<%- field.get(\'name\') %>"><%- _("Top values").t() %></a></td>\n                <td><a href="#" data-visualization="line" data-report="topbytime" data-field="<%- field.get(\'name\') %>"><%- _("Top values by time").t() %></td>\n                <td colspan="2"><a href="#" data-visualization="line" data-report="rare" data-field="<%- field.get(\'name\') %>"><%- _("Rare values").t() %></td>\n            </tr>\n            <tr class="fields-events">\n                <td colspan="4"><a href="#" data-report="fieldvalue" data-field="<%- field.get(\'name\') %>" data-field-value="*"><%- _("Events with this field").t() %></td>\n            </tr>\n            <% if (field.isNumeric()) { %>\n            <tr class="field-stats">\n                <td colspan="3">\n                    <ul class="field-stats inline">\n                        <li>\n                            <strong class="stats-label"><%- _("Avg").t() %>:</strong>\n                            <span class="val numeric"><%- field.get("mean") %></span>\n                        </li>\n                        <li>\n                            <strong class="stats-label"><%- _("Min").t() %>:</strong>\n                            <span class="val numeric"><%- field.get("min") %></span>\n                        </li>\n                        <li>\n                            <strong class="stats-label"><%- _("Max").t() %>:</strong>\n                            <span class="val numeric"><%- field.get("max") %></span>\n                        </li>\n                        <li>\n                            <strong class="stats-label"><%- _("Std").t() %>&nbsp;<%- _("Dev").t() %>:</strong>\n                            <span class="val numeric"><%- field.get("stdev") %></span>\n                        </li>\n                    </ul>\n                </td>\n            </tr>\n            <% } %>\n        </tbody>\n    </table>\n    <table class="table table-condensed table-dotted">\n        <thead>\n            <tr>\n            <% if (field.get(\'modes\').length >= 10) { %>\n                <th class="value"><strong><%- _("Top 10 Values").t() %></strong></th>\n            <% } else { %>\n                <th class="value"><strong><%- _("Values").t() %></strong></th>\n            <% } %>\n            <td class="count"><%- _("Count").t() %></td>\n                <td class="percent">%</td>\n                <td class="bar">&nbsp;</td>\n            </tr>\n        </thead>\n        <tbody>\n            <% var modes_len = field.get(\'modes\').length %>\n            <% _.each(field.get(\'modes\'), function(mode) { %>\n                <tr>\n                    <td class="value"><a href="#" data-report="fieldvalue" data-field="<%- field.get(\'name\') %>" data-value="<%- mode.value %>"><%- mode.value %></a></td>\n                    <td class="count"><%- format_decimal(mode.count || -1) %></td>\n                    <% percent = mode.count/field.get(\'count\') %>\n                    <td class="percent"><%- format_percent(percent) %></td>\n                    <% if (modes_len > 1) { %>\n                        <td class="bar">\n                            <div style="width:<%- Math.round(percent * 100) %>%;" class="graph-bar"></div>\n                        </td> \n                    <% } %>\n                </tr>\n            <% }); %>\n        </tbody>\n    </table>\n<% } %>\n'});define("views/shared/FieldInfo",["underscore","module","views/shared/PopTart","splunk.i18n","models/services/search/IntentionsParser","contrib/text!views/shared/FieldInfo.html"],function(_,module,PopTartView,i18n,IntentionsParser,template){return PopTartView.extend({moduleId:module.id,initialize:function(){PopTartView.prototype.initialize.apply(this,arguments);var defaults={selectableFields:!0};this.options=$.extend(!0,defaults,this.options);this.model.intentionsParser=new IntentionsParser;this.model.intentionsParser.on("change",function(){this.hide();var search=this.model.intentionsParser.fullSearch();this.model.intentionsParser.has("visualization")?this.model.report.entry.content.set({search:search,"display.general.type":"visualizations","display.visualizations.charting.chart":this.model.intentionsParser.get("visualization")}):this.model.report.entry.content.set("search",search);this.model.report.trigger("eventsviewer:drilldown")},this);this.model.summary.fields.on("reset",this.render,this);this.collection.selectedFields.on("add remove reset",this.render,this);this.model.field.on("change",this.render,this)},events:{"click .unselect":function(e){this.collection.selectedFields.remove(this.collection.selectedFields.findWhere({name:$(e.currentTarget).attr("data-field-name")}));e.preventDefault()},"click .select":function(e){this.collection.selectedFields.push({name:$(e.currentTarget).attr("data-field-name")});e.preventDefault()},"click .close":function(e){this.hide();e.preventDefault()},"click tr.fields-values > td > a[data-field]":function(e){var $target=$(e.currentTarget),data=$target.data(),field=data.field,report=data.report;this.model.intentionsParser.clear({silent:!0});this.model.intentionsParser.set({visualization:data.visualization},{silent:!0});this.model.intentionsParser.fetch({data:{q:this.model.report.entry.content.get("search"),action:report,field:field,app:this.model.application.get("app"),owner:this.model.application.get("owner")}});e.preventDefault()},"click tr.fields-events > td > a[data-field]":function(e){var $target=$(e.currentTarget),data=$target.data(),field=data.field,report=data.report;this.model.intentionsParser.clear({silent:!0});this.model.intentionsParser.fetch({data:{q:this.model.report.entry.content.get("search"),action:report,field:field,value:"*",app:this.model.application.get("app"),owner:this.model.application.get("owner")}});e.preventDefault()},"click tr.fields-numeric > td > a[data-field]":function(e){var $target=$(e.currentTarget),data=$target.data(),field=data.field,report=data.report;this.model.intentionsParser.clear({silent:!0});this.model.intentionsParser.set({visualization:data.visualization},{silent:!0});this.model.intentionsParser.fetch({data:{q:this.model.report.entry.content.get("search"),action:report,field:field,app:this.model.application.get("app"),owner:this.model.application.get("owner")}});e.preventDefault()},"click td.value > a":function(e){var $target=$(e.currentTarget),data=$target.data();this.model.intentionsParser.clear({silent:!0});this.model.intentionsParser.fetch({data:{q:this.model.report.entry.content.get("search"),stripReportsSearch:!1,action:data.report,field:data.field,value:data.value,app:this.model.application.get("app"),owner:this.model.application.get("owner")}});e.preventDefault()}},render:function(){var html=this.compiledTemplate({field:this.model.summary.fields.findWhere({name:this.model.field.get("name")}),summary:this.model.summary,selectedFields:this.collection.selectedFields,i18n:i18n,_:_,selectableFields:this.options.selectableFields});this.$el.html(PopTartView.prototype.template);this.$(".popdown-dialog-body").html(html);return this},template:template})});define("models/services/saved/FVTags",["jquery","underscore","models/SplunkDBase"],function($,_,BaseModel){return BaseModel.extend({url:"saved/fvtags",initialize:function(){BaseModel.prototype.initialize.apply(this,arguments)},resetTags:function(tags){_(this.entry.content.toJSON()).each(function(v,k){k.match(/^tag.+/g)&&this.entry.content.unset(k)},this);this.entry.content.unset("tags");if(tags){var attrs={};_(tags).each(function(tag){attrs["tag."+tag]=tag},this);this.entry.content.set(attrs)}},setId:function(app,owner,fieldName,fieldValue){this.set("id","/servicesNS/"+encodeURIComponent(owner)+"/"+encodeURIComponent(app)+"/saved/fvtags/"+encodeURIComponent(fieldName)+"%3D"+encodeURIComponent(fieldValue))}},{tagStringtoArray:function(tag){return tag?$.trim(tag.replace(/,/g," ")).split(/\s+/):[]},tagArraytoString:function(tags){return tags.join(", ")}})});define("views/shared/eventsviewer/shared/TagDialog",["underscore","module","models/services/saved/FVTags","views/shared/Modal","views/shared/controls/ControlGroup","views/shared/FlashMessages"],function(_,module,FVTags,Modal,ControlGroup,FlashMessage){return Modal.extend({moduleId:module.id,initialize:function(){Modal.prototype.initialize.apply(this,arguments);this.children.flashMessage=new FlashMessage({model:this.model.tags});this.children.field=new ControlGroup({className:"field-value control-group",controlType:"Textarea",controlOptions:{modelAttribute:"name",model:this.model.tags.entry.content,save:!1,placeholder:"Optional",enabled:!1},label:_("Field Value").t()});this.children.tags=new ControlGroup({className:"tags control-group",controlType:"Textarea",controlOptions:{modelAttribute:"ui.tags",model:this.model.tags.entry.content,save:!1,placeholder:""},label:_("Tag(s)").t(),help:_("Comma or space separated list of tags.").t()})},events:$.extend(!0,{},Modal.prototype.events,{"click .btn-primary":function(e){var data=this.model.application.getPermissions("private"),tags=FVTags.tagStringtoArray(_.escape(this.model.tags.entry.content.get("ui.tags")));this.model.tags.resetTags(tags);this.model.tags.entry.content.unset("ui.tags");if(this.model.tags.id){data={};if(!tags.length){this.model.tags.destroy();this.trigger("tags_saved");this.hide();e.preventDefault();return}}this.model.tags.save({},{data:data,success:function(){this.trigger("tags_saved");this.hide()}.bind(this)});e.preventDefault()}}),render:function(){this.$el.html(Modal.TEMPLATE);this.$(Modal.HEADER_TITLE_SELECTOR).html(_("Create Tags").t());this.children.flashMessage.render().prependTo(this.$(Modal.BODY_SELECTOR));this.$(Modal.BODY_SELECTOR).append(Modal.FORM_HORIZONTAL);this.children.field.render().appendTo(this.$(Modal.BODY_FORM_SELECTOR));this.children.tags.render().appendTo(this.$(Modal.BODY_FORM_SELECTOR));this.$(Modal.FOOTER_SELECTOR).append(Modal.BUTTON_CANCEL);this.$(Modal.FOOTER_SELECTOR).append(Modal.BUTTON_SAVE);return this}})});define("views/shared/eventsviewer/shared/WorkflowActions",["jquery","underscore","module","views/shared/PopTart","models/services/saved/FVTags","models/SplunkDBase","views/shared/eventsviewer/shared/TagDialog","util/general_utils","splunk.util","uri/route"],function($,_,module,PopTartView,FVTags,SplunkDModel,TagDialog,generalUtils,util,route){return PopTartView.extend({className:"dropdown-menu",moduleId:module.id,initialize:function(){PopTartView.prototype.initialize.apply(this,arguments);if(this.options.field){this.fname=this.options.field.name;this.fvalue=this.options.field.value}this.model.tags=new FVTags;this.actions=this.collection[this.isFieldAction()?"getFieldActions":"getEventActions"](this.model.event,this.fname)},isFieldAction:function(){return this.fname&&this.fvalue},events:$.extend(!0,{},PopTartView.prototype.events,{"click a.actions":function(e){var data=$(e.target).data();this[data.type](this.getTransformedAttrs(this.collection.at(data.idx)),data.target);e.preventDefault()},"click a.edit-tag":function(e){e.preventDefault();this.model.tags.entry.content.set("name",this.fname+"="+this.fvalue);this.children.tagDialog=new TagDialog({model:{tags:this.model.tags,application:this.model.application},onHiddenRemove:!0});this.children.tagDialog.on("tags_saved",function(){this.model.result.setTagsSynthetically(this.fname,this.fvalue,this.model.tags.entry.content.get("tags"))},this);this.model.tags.setId(this.model.application.get("app"),this.model.application.get("owner"),this.fname,this.fvalue);this.model.clonedTags=new SplunkDModel;this.model.clonedTags.setFromSplunkD(this.model.tags.toSplunkD());this.model.clonedTags.id=this.model.tags.id;this.model.clonedTags.fetch({success:function(){this.children.tagDialog.render().appendTo($("body"));this.model.tags.setFromSplunkD(this.model.clonedTags.toSplunkD());this.model.tags.entry.content.set("ui.tags",FVTags.tagArraytoString(this.model.tags.entry.content.get("tags")));this.children.tagDialog.show()}.bind(this),error:function(){this.children.tagDialog.render().appendTo($("body"));this.model.tags.setFromSplunkD(this.model.clonedTags.toSplunkD());this.model.tags.unset("id");this.children.tagDialog.show()}.bind(this)})}}),uri:function(uri){return 0===uri.indexOf("/")?route.encodeRoot(this.model.application.get("root"),this.model.application.get("locale"))+uri:uri},link:function(content,target){var uri=this.uri(content["link.uri"]);if("get"===content["link.method"].toLowerCase()){"self"===content["link.target"]?window.location.href=uri:window.open(uri,"_blank");return!0}var $form=$('<form class="workflow-action"/>');$form.attr("target",target);$form.attr("action",uri);$form.attr("method","post");_(generalUtils.filterObjectByRegexes(content,/^link\.postargs\.\d\..*/)).each(function(v,k){$form.append($("<input/>").attr({type:"hidden",name:k.replace(/^link\.postargs\.\d\./,""),value:v}))},this);$("body").append($form);$("form.workflow-action").submit().remove();return!1},search:function(content,target){var options={data:{}};if(util.normalizeBoolean(content["search.preserve_timerange"])){this.model.report.entry.content.get("dispatch.earliest_time")&&(options.data.earliest=this.model.report.entry.content.get("dispatch.earliest_time"));this.model.report.entry.content.get("dispatchu.latest_time")&&(options.data.latest=this.model.report.entry.content.get("dispatch.latest_time"))}if(content["search.earliest"]||content["search.latest"]){options.data.earliest=content["search.earliest"];options.data.latest=content["search.latest"]}options.data.q=content["search.search_string"];var url=route.page(this.model.application.get("root"),this.model.application.get("locale"),content["eai:appName"],this.model.application.get("page"),options);"_self"===target?window.location.href=url:window.open(url,"_blank");return!1},getTransformedAttrs:function(model){var obj={},content=model.entry.content.toJSON(),sid=this.model.searchJob.get("id"),offset=(this.model.searchJob.entry.content.get("eventSorting"),this.model.result.offset(this.model.result.results.indexOf(this.model.event))),namespace=this.model.application.get("app"),latest_time=this.model.report.entry.content.get("display.events.timelineLatestTime");_.each(content,function(value,key){if("string"==typeof value){var systemSubstitute=model.systemSubstitute(value,sid,offset,namespace,latest_time,this.fname,this.fvalue);obj[key]=model.fieldSubstitute(systemSubstitute,this.model.event.toJSON())}else obj[key]=value},this);return obj},render:function(){this.el.innerHTML=PopTartView.prototype.template_menu;this.$el.append(this.compiledTemplate({getTransformedAttrs:this.getTransformedAttrs,isFieldAction:this.isFieldAction(),actions:this.actions,collection:this.collection,trim:util.smartTrim,that:this,_:_}));return this},template:'                <ul>                    <% if (isFieldAction) { %>                        <li>                            <a href="#" class="edit-tag"><%- _("Edit Tags").t() %></a>                        </li>                    <% } %>                    <% var i = 0, len = actions.length %>                    <% for(i; i<len; i++) { %>                        <% var attrs = getTransformedAttrs.call(that, collection.at(actions[i])); %>                        <li>                            <a class="actions" href="#" data-target="<%- "_"+(attrs["link.target"] || attrs["search.target"]) %>" data-idx="<%- that.actions[i] %>" data-type="<%-attrs["type"] %>"><%- trim(attrs["label"], 100) %></a>                        </li>                    <% } %>                </ul>            '})});define("views/shared/eventsviewer/shared/TimeInfo",["underscore","jquery","module","util/time","splunk.util","views/shared/PopTart","strftime"],function(_,$,module,timeutils,splunkutils,PopTartView){return PopTartView.extend({moduleId:module.id,initialize:function(){PopTartView.prototype.initialize.apply(this,arguments)},events:{"click td > a.et-lt":function(e){var $target=$(e.currentTarget),timebounds=$target.data().time;if("before"===timebounds)this.model.report.entry.content.set("dispatch.latest_time",this.options.time);else if("after"==timebounds)this.model.report.entry.content.set("dispatch.earliest_time",this.options.time);else{var et=parseFloat(splunkutils.getEpochTimeFromISO(this.options.time)),lt=et+.001;this.model.report.entry.content.set({"dispatch.latest_time":lt,"dispatch.earliest_time":et})}this.model.report.trigger("eventsviewer:drilldown");e.preventDefault()},"click td > a.time-range":function(e){var $target=$(e.currentTarget),ranges=timeutils.rangeFromIsoAndOffset(this.options.time,$target.data().timeUnit);this.model.report.entry.content.set({"dispatch.latest_time":ranges.upperRange.strftime("%s.%Q"),"dispatch.earliest_time":ranges.lowerRange.strftime("%s.%Q")});this.model.report.trigger("eventsviewer:drilldown");e.preventDefault()}},render:function(){this.$el.html(PopTartView.prototype.template);this.$(".popdown-dialog-body").html(this.compiledTemplate({_:_}));return this},template:'                <h3>_time</h3>                <table>                    <thead>                        <tr><th><%- _("Events Before or After").t() %></th><th><%- _("Nearby Events").t() %></th></tr>                    </thead>                    <tbody>                        <tr>                            <td>                                <a class="et-lt" data-time="before" href="#"><%- _("Before this time").t() %></a><br>                                <a class="et-lt" data-time="after" href="#"><%- _("After this time").t() %></a><br>                                <a class="et-lt" data-time="at" href="#"><%- _("At this time").t() %></a><br>                            </td>                            <td>                                <a class="time-range" data-time-unit="w" href="#"><%- _("+/- 1 week").t() %></a><br>                                <a class="time-range" data-time-unit="d" href="#"><%- _("+/- 1 day").t() %></a><br>                                <a class="time-range" data-time-unit="h" href="#"><%- _("+/- 1 hour").t() %></a><br>                                <a class="time-range" data-time-unit="m" href="#"><%- _("+/- 1 minute").t() %></a><br>                                <a class="time-range" data-time-unit="s" href="#"><%- _("+/- 1 second").t() %></a><br>                                <a class="time-range" data-time-unit="ms" href="#"><%- _("+/- 1 milliseconds").t() %></a><br>                            </td>                        </tr>                    </tbody>                </table>            '})});define("views/shared/eventsviewer/shared/BaseFields",["jquery","underscore","backbone","module","keyboard/SearchModifier","views/Base","views/shared/FieldInfo","views/shared/eventsviewer/shared/WorkflowActions","views/shared/eventsviewer/shared/TimeInfo"],function($,_,Backbone,module,KeyboardSearchModifier,BaseView,FieldInfo,WorkflowActionsView,TimeInfoView){return BaseView.extend({initialize:function(){BaseView.prototype.initialize.apply(this,arguments);this.rowExpanded="r"+this.options.idx;this.keyboardSearchModifier=new KeyboardSearchModifier},startListening:function(){this.listenTo(this.model.event,"change",this.render);this.listenTo(this.collection.selectedFields,"reset add remove",function(){this.model.state.get(this.rowExpanded)&&this.render()})},events:{"click .field-value a.f-v":function(e){e.preventDefault();this.drilldown($(e.target),e)},"click .tag":function(e){e.preventDefault();this.drilldown($(e.target),e,!0)},"click .field-value .tag":function(e){e.preventDefault();this.drilldown($(e.target),e,!0)},"click ._time":function(e){e.preventDefault()},"click .field-info":function(e){e.preventDefault()},"click .field-actions":function(e){e.preventDefault()},"click .event-actions":function(e){e.preventDefault()},"mousedown ._time":"openTimeInfo","mousedown .field-info":"openFieldInfo","mousedown .field-actions":"openFieldActions","mousedown .event-actions":"openEventActions","keydown ._time":function(e){13==e.keyCode&&this.openTimeInfo(e)},"keydown .field-info":function(e){13==e.keyCode&&this.openFieldInfo(e)},"keydown .field-actions":function(e){13==e.keyCode&&this.openFieldActions(e)},"keydown .event-actions":function(e){13==e.keyCode&&this.openEventActions(e)}},drilldown:function($target,e,tagclick){var data=$target.data(),value=$.trim($target.text()),field=$.trim(data.taggedFieldName||data.fieldName);this.model.state.trigger("drilldown",$.extend(!0,{},{data:{q:tagclick?this.model.searchJob.getStrippedEventSearch():this.model.report.entry.content.get("search"),stripReportsSearch:tagclick,action:"fieldvalue",field:field,negate:this.keyboardSearchModifier.isNegation(e),value:value,app:this.model.application.get("app"),owner:this.model.application.get("owner")},event:e,idx:this.options.idx}))},openTimeInfo:function(e){var $target=$(e.currentTarget),time=$target.data().time;this.children.time&&this.children.time.shown&&this.children.time.hide();this.children.time=new TimeInfoView({model:{report:this.model.report},time:time,onHiddenRemove:!0});this.children.time.render().appendTo($("body")).show($target);e.preventDefault()},openFieldInfo:function(e){var $target=$(e.currentTarget),field=this.model.summary.fields.findWhere({name:$target.attr("data-field-name")}),fieldName=field.get("name");if(this.children.fieldInfo&&this.children.fieldInfo.shown){this.children.fieldInfo.hide();if(this.lastMenu==fieldName+"-field-info")return!0}field||alert(_("This event is no longer within the results window.").t());this.children.fieldInfo=new FieldInfo({model:{field:field,summary:this.model.summary,report:this.model.report,application:this.model.application},collection:{selectedFields:this.collection.selectedFields},onHiddenRemove:!0,selectableFields:this.options.selectableFields});this.lastMenu=fieldName+"-field-info";_.isNumber(this.model.state.get("modalize"))||this.model.state.set({modalize:this.options.idx,sleep:!0});this.children.fieldInfo.render().appendTo($("body")).show($target);e.preventDefault()},openFieldActions:function(e){var $target=$(e.currentTarget),fieldName=$target.attr("data-field-name"),fieldValue=$.trim($target.closest("tr").find(".f-v").text());if(this.children.fieldActions&&this.children.fieldActions.shown){this.children.fieldActions.hide();if(this.lastMenu==fieldName+"-field-actions")return!0}this.children.fieldActions=new WorkflowActionsView({model:this.model,collection:this.collection.workflowActions,field:{name:fieldName,value:fieldValue},mode:"menu"});this.lastMenu=fieldName+"-field-actions";_.isNumber(this.model.state.get("modalize"))||this.model.state.set({modalize:this.options.idx,sleep:!0});this.children.fieldActions.render().appendTo($("body")).show($target);e.preventDefault()},openEventActions:function(e){var $target=$(e.currentTarget);if(this.children.eventActions&&this.children.eventActions.shown){this.children.eventActions.hide();return!0}this.children.eventActions=new WorkflowActionsView({model:this.model,collection:this.collection.workflowActions,mode:"menu",onHiddenRemove:!0});this.children.eventActions.render().appendTo($("body")).show($target);e.preventDefault()},_partial:_.template('                <%  _(fields).each(function(field, i) { %>                    <% var fieldlist = m.get(field) %>                    <% if(fieldlist.length > 1){ %>                        <%  _(fieldlist).each(function(mv_field, j) { %>                            <tr>                               <% if(i==0 && j==0 && label) { %>                                   <td rowspan="<%= m.getFieldsLength(fields) %>" class="field-type"><%- label %></td>                               <% } %>                               <% if(selectableFields && j==0) { %>                                   <td rowspan="<%= fieldlist.length %>" class="col-visibility"><label class="checkbox">                                   <a href="#" data-name="Everyone.read" class="btn <%- iconVisibility ? "hide" : "show" %>-field">                                   <% if(iconVisibility) { %>                                    <i class="icon-check"></i>                                    <% } %>                                   </label></td>                               <% } %>                               <% if(j==0 && slen>0) {%>                                    <td rowspan="<%=fieldlist.length %>" class="field-key">                                        <a class="popdown-toggle field-info" href="#" data-field-name="<%- field %>">                                            <span><%- field %></span><span class="caret"></span>                                        </a>                                    </td>                               <% } else if(j==0 && slen==0) { %>                                    <td rowspan="<%=fieldlist.length %>" class="field-key">                                        <span  data-field-name="<%- field %>"><%- field %></span>                                    </td>                               <% } %>                               <td class="field-value">                                   <a data-field-name="<%- field %>"  class="f-v" href="#"><%- mv_field %></a>                                   <% var tags = r.getTags(field, mv_field); %>                                   <% if (tags.length) { %>                                       (<% _(tags).each(function(tag, idx){ %><a data-tagged-field-name="tag::<%- field %>" class="tag" href="#"><%- tag %><%if(idx!=tags.length-1){%> <%}%></a><% }); %>)                                   <% } %>                               </td>                               <td  class="actions popdown">                                       <a class="popdown-toggle field-actions" href="#" data-field-name="<%- field %>">                                           <span class="caret"></span>                                       </a>                               </td>                            </tr>                        <% }) %>                    <% } else { %>                        <tr>                           <% if(i==0 && label) { %>                               <td rowspan="<%= m.getFieldsLength(fields) %>" class="field-type"><%- label %></td>                           <% } %>                           <% if(selectableFields) { %>                               <td rowspan="<%= fieldlist.length %>" class="col-visibility"><label class="checkbox">                               <a href="#" data-name="Everyone.read" class="btn <%- iconVisibility ? "hide" : "show" %>-field">                               <% if(iconVisibility) { %>                                <i class="icon-check"></i>                                <% } %>                               </a></label></td>                           <% } %>                           <% if(slen >0) { %>                               <td class="field-key">                                   <a class="popdown-toggle field-info" href="#" data-field-name="<%- field %>">                                       <span><%- field %></span><span class="caret"></span>                                   </a>                               </td>                           <% } else { %>                                <td class="field-key">                                    <span  data-field-name="<%- field %>"><%- field %></span>                                </td>                           <% } %>                           <td class="field-value">                               <a data-field-name="<%- field %>"  class="f-v" href="#"><%- m.get(field)[0] %></a>                               <% var tags = r.getTags(field, m.get(field)); %>                               <% if (tags.length > 0) { %>                                   (<% _(tags).each(function(tag, idx){ %><a data-field-name="<%- field %>" data-tagged-field-name="tag::<%- field %>" class="tag" href="#"><%- tag %><%if(idx!=tags.length-1){%> <%}%></a><% }); %>)                               <% } %>                           </td>                           <td  class="actions">                                   <a class="popdown-toggle field-actions" href="#" data-field-name="<%- field %>">                                       <i class="icon-chevron-down"></i>                                   </a>                           </td>                       </tr>                   <% } %>               <% }); %>           ')})});define("views/shared/eventsviewer/list/body/row/SelectedFields",["jquery","underscore","backbone","module","views/shared/eventsviewer/shared/BaseFields"],function($,_,Backbone,module,BaseFields){return BaseFields.extend({moduleId:module.id,initialize:function(){BaseFields.prototype.initialize.apply(this,arguments);this.rowExpanded=this.options.rowExpanded},startListening:function(){this.listenTo(this.collection.selectedFields,"add remove reset",function(){this.model.state.get(this.rowExpanded)&&this.render()})},render:function(){var strippedfields=this.model.event.strip(),selectedfields=_.intersection(strippedfields,this.collection.selectedFields.pluck("name")).sort();this.$el.html(this.compiledTemplate({selectedfields:selectedfields,m:this.model.event,r:this.model.result,selected:selectedfields.length,_:_}));return this},template:'                <% if (selected) { %>                    <ul class="condensed-selected-fields">                    <%  _(selectedfields).each(function(field, i) { %>                        <% var values = m.get(field) %>                        <li>                            <% _(values).each(function(value, idx) { %>                                <span class="field"><%- field %> =</span>                                <span class="field-value"><a class="f-v" data-field-name="<%-field %>" title="<%= value ? value : "&nbsp;"%>"><% if(value) {%><%- value %><% } else { %>&nbsp;<% } %></a></span>                                <% var tags = r.getTags(field, value); %>                                <% if (tags.length) { %>                                      <% _(tags).each(function(tag, idx){ %><a data-tagged-field-name="tag::<%- field %>" class="tag" href="#"><%- tag %>                                            <%if(idx!=tags.length-1){%> <%}%>                                        </a><% }); %>                                <% } %>                            <% }) %>                        </li>                    <% }) %>                  </ul>                <% } %>           '})
});define("views/shared/eventsviewer/shared/EventFields",["jquery","underscore","backbone","module","views/shared/eventsviewer/shared/BaseFields"],function($,_,Backbone,module,FieldsView){return FieldsView.extend({moduleId:module.id,initialize:function(){FieldsView.prototype.initialize.apply(this,arguments);this.swappingKey=this.options.swappingKey;this.showAllLines=this.options.showAllLines;this.rowExpanded="r"+this.options.idx},startListening:function(){FieldsView.prototype.startListening.apply(this,arguments);this.listenTo(this.model.event,"change",function(model,options){options.swap&&(this.isSwapping=!1);this.render()});this.listenTo(this.model.result,"tags-updated",this.render);this.listenTo(this.model.event,"failed-swap",function(){this.$(".event-fields-loading").text(_("We were unable to provide the correct event").t())});this.listenTo(this.model.state,"change:timeExpanded",this.render);this.listenTo(this.model.state,"change:"+this.showAllLines,function(){this.isSwapping=!0});this.listenTo(this.model.state,"unmodalize"+this.options.idx,function(){this.isSwapping=!0});this.listenTo(this.model.result,this.swappingKey,function(){this.isSwapping=!0})},activate:function(){if(this.active)return FieldsView.prototype.activate.apply(this,arguments);this.isSwapping=!0;return FieldsView.prototype.activate.apply(this,arguments)},events:$.extend({},FieldsView.prototype.events,{"click ._time-expand":function(e){this.model.state.set("timeExpanded",!this.model.state.get("timeExpanded"));e.preventDefault()},"click a.show-field":function(e){var $eye=$(e.currentTarget),fieldName=$.trim($eye.closest("td").siblings(".field-key").text());this.collection.selectedFields.push({name:fieldName});e.preventDefault()},"click a.hide-field":function(e){var $eye=$(e.currentTarget),fieldName=$.trim($eye.closest("td").siblings(".field-key").text());this.collection.selectedFields.remove(this.collection.selectedFields.find(function(model){return model.get("name")===fieldName},this));e.preventDefault()},"click a.btn.disabled":function(e){e.preventDefault()},"keydown td.actions:last":function(e){if(!e.shiftKey&&9===e.keyCode){e.preventDefault();this.$el.parent().find("a.event-actions").focus()}},keydown:function(e){if(27===e.keyCode){e.preventDefault();this.model.state.set(this.rowExpanded,!1)}}}),setMaxWidth:function(){if(!this.el.innerHTML||!this.$el.is(":visible"))return!1;var $stylesheet=$("#"+this.cid+"-styles");$stylesheet&&$stylesheet.remove();var $wrapper=this.$el.closest("table").parent(),wrapperWidth=$wrapper.width(),wrapperLeft=$wrapper.offset().left-$wrapper.scrollLeft(),margin=20,elLeft=this.$el.offset().left,maxWidth=wrapperWidth-(elLeft-wrapperLeft)-margin,maxWidthPx=(maxWidth>500?maxWidth:500)+"px";this.$("table").css("maxWidth",maxWidthPx)},reflow:function(){this.setMaxWidth()},render:function(){var strippedfields=this.model.event.strip(),selectedfields=_.intersection(strippedfields,this.collection.selectedFields.pluck("name")).sort(),eventfields=_.difference(_.intersection(strippedfields,this.model.event.notSystemOrTime()),selectedfields).sort(),timefields=_.difference(this.model.event.time(),selectedfields).sort(),timefieldsNoTime=_.difference(timefields,["_time"]),systemfields=_.difference(this.model.event.system(),selectedfields).sort();this.$el.html(this.compiledTemplate({selectedfields:selectedfields,eventfields:eventfields,timefields:this.model.state.get("timeExpanded")?timefieldsNoTime:[],systemfields:systemfields,expanded:1===timefields.length?"":this.model.state.get("timeExpanded")?"icon-minus-circle":"icon-plus-circle",selectableFields:this.options.selectableFields,hideEventActions:this.model.searchJob.isRealtime(),r:this.model.result,m:this.model.event,mTime:this.model.event.get("_time"),slen:this.model.summary.fields.length,_partial:this._partial,isSwapping:!1,_:_}));this.setMaxWidth();return this},template:'                <% if (!isSwapping) { %>                    <% if (!hideEventActions) { %>                        <a class="btn popdown-toggle event-actions" href="#"><span><%-_("Event Actions").t()%></span><span class="caret"></span></a>                    <% } %>                    <table class="table table-condensed table-embed table-expanded table-dotted">                        <thead>                            <th class="col-field-type"><%- _("Type").t() %></th>                            <% if(selectableFields){ %> <th class="col-visibility"><label class="checkbox"><a href="#" class="btn disabled"><i class="icon-check"></i></a></label></th><% } %>                            <th class="col-field-name"><%- _("Field").t() %></th>                            <th class="col-field-value"><%- _("Value").t() %></th>                            <th class="col-field-action"><%- _("Actions").t() %></th>                        </thead>                        <tbody>                        <%= _partial({fields: selectedfields, slen: slen, iconVisibility: true, m: m, r:r, label: _("Selected").t(), selectableFields: selectableFields}) %>                        <%= _partial({fields: eventfields, slen: slen, iconVisibility: false, m: m, r:r, label: _("Event").t(), selectableFields: selectableFields}) %>                        <% if (mTime) { %>                            <tr>                                <td rowspan="<%- timefields.length+1 %>" class="field-type"><%- _("Time").t() %><a class="_time-expand <%= expanded %>" href=""></a></td>                                <% if (selectableFields) { %>                                    <td></td>                                <% } %>                               <td class="time">                                   <a class="popdown-toggle _time" href="#" data-time="<%- mTime[0] %>">                                       <span>_time</span><span class="caret"></span>                                   </a>                               </td>                               <td class="field-value f-v"><%- mTime[0] %>                                   <% var tags = r.getTags("_time", mTime); %>                                   <% if (tags.length > 0) { %>(<% _(tags).each(function(tag, idx){ %><a data-field-name="_time" data-tagged-field-name="tag::_time" class="tag" href="#"><%- tag %><%if(idx!=tags.length-1){%> <%}%></a><% }); %>)<% } %>                               </td>                               <td class="actions"></td>                            </tr>                        <% } %>                        <%= _partial({fields: timefields, slen: slen, iconVisibility: false, m: m, r:r, label: null, selectableFields: selectableFields}) %>                        <%= _partial({fields: systemfields, slen: slen, iconVisibility: false, m: m, r:r, label: _("Default").t(), selectableFields: selectableFields}) %>                        </tbody>                    </table>                <% } else { %>                    <div class="event-fields-loading">Loading...</div>                <% } %>            '})});define("views/shared/JSONTree",["jquery","underscore","module","views/Base"],function($,_,module,BaseView){return BaseView.extend({moduleId:module.id,className:"json-tree",initialize:function(){BaseView.prototype.initialize.apply(this,arguments);var defaults={isValidJSON:!1,json:"{}"};this.options=$.extend(!0,defaults,this.options);this.options.isValidJSON?this._json=this.options.json:this.setJSON(this.options.json)},setJSON:function(json){var parsed;"string"!=typeof json&&(json=JSON.stringify(json));try{parsed=JSON.parse(json)}catch(e){}this._json=parsed},isValidJSON:function(){return!!this._json},events:{"click .jsexpands":function(e){var $target=$(e.currentTarget);this.trigger("interaction");this.interacted=!0;$target.removeClass("jsexpands").addClass("jscollapse").text("[-]").next().show();e.preventDefault()},"click .jscollapse":function(e){var $target=$(e.currentTarget);this.trigger("interaction");this.interacted=!0;$target.removeClass("jscollapse").addClass("jsexpands").text("[+]").next().hide();e.preventDefault()}},render:function(){this.interacted||this.$el.html(this.compiledTemplate({obj:this._json,indent:0,template:this.compiledTemplate,_:_}));return this},template:'                <% var indent = indent + 2; %>                <% var level  = indent/2; %>                <% var type   = (obj === null) ? "null": typeof obj; %>                                <% if(!_.isObject(obj)) { %>                    <span class="t <%- type %>"><%- obj || "null" %></span>                <% } else { %>                    <% var isObj = !(obj instanceof Array) %>                    <% var list  = (isObj) ? _.keys(obj).sort() : obj.sort(); %>                    <span><%if(isObj) { %>{<% } else { %>[<% } %></span>                                        <% if (list.length > 0) { %>                        <% if(!(level < 2)) { %>                            <a class="jsexpands">[+]</a>                        <% } else { %>                            <a class="jscollapse">[-]</a>                        <% } %>                    <% } %>                                        <% if (level != 1) { %>                        <span style="display: none;">                    <% } else { %>                        <span>                    <% } %>                                        <% var i = 0; %>                    <% for(; i<list.length; i++){ %>                        <br><% for(var j=0; j<indent; j++){ %>&nbsp;<% } %>                        <% if(isObj) { %>                            <span class="key level-<%-level%>">                                <span class="key-name"><%-list[i]%></span>:                                <%= template({ obj:obj[list[i]], indent: indent, template: template, _:_}) %>                            </span>                        <% } else { %>                            <%= template({ obj:list[i], indent: indent, template: template, _:_}) %>                        <% } %>                    <% } %>                    </span><br>                    <span>                        <% for(var j=0; j<indent-2; j++){ %>&nbsp;<% } %>                        <% if(isObj){ %><span>}</span><% } else { %><span>]</span><%}%>                    </span>                                <% } %>                            '})});define("views/shared/eventsviewer/shared/RawField",["underscore","module","keyboard/SearchModifier","splunk.util","views/Base","views/shared/JSONTree"],function(_,module,KeyboardSearchModifier,util,BaseView,JSONTree){return BaseView.extend({decorations:{decoration_audit_valid:{msg:"Valid",label:"label-success",icon:"icon-check-circle"},decoration_audit_gap:{msg:"Gap",label:"label-warning",icon:"icon-minus-circle"},decoration_audit_tampered:{msg:"Tampered!",label:"label-important",icon:"icon-alert-circle"},decoration_audit_cantvalidate:{msg:"Can't validate!",label:"label-info",icon:"icon-question-circle"}},moduleId:module.id,tagName:"div",initialize:function(){BaseView.prototype.initialize.apply(this,arguments);this.keyboardSearchModifier=new KeyboardSearchModifier;this.options=$.extend(!0,{segmentation:!0},this.options);this.interaction="i"+this.options.idx;this.showFormattedJSON="j"+this.options.idx;this.showAllLines="s"+this.options.idx;this.children.json=new JSONTree({json:this.model.event.getRawText()});this.model.state.set(this.showFormattedJSON,this.children.json.isValidJSON())},startListening:function(){this.listenTo(this.model.event,"change",function(){this.children.json.setJSON(this.model.event.getRawText(),!1);this.render()});this.listenTo(this.model.report.entry.content,"change:display.events.type",function(){var wrap=util.normalizeBoolean(this.model.report.entry.content.get("display.events.list.wrap")),$raw=this.$(".raw-event");$raw.removeClass("wrap");("raw"===this.model.report.entry.content.get("display.events.type")||wrap)&&$raw.addClass("wrap")});this.listenTo(this.model.report.entry.content,"change:display.events.list.wrap",function(){var wrap=util.normalizeBoolean(this.model.report.entry.content.get("display.events.list.wrap")),$raw=this.$(".raw-event");wrap&&!$raw.hasClass("wrap")?$raw.addClass("wrap"):$raw.removeClass("wrap")});this.listenTo(this.children.json,"interaction",function(){this.model.state.trigger(this.interaction)})},events:{"mouseover .t":function(e){var $elem=this.getSegmentParent(e.target);$elem.addClass("h");e.preventDefault()},"mouseout .t":function(e){var $elem=this.getSegmentParent(e.target);$elem.removeClass("h")},"click .t":function(e){var data,$root=this.getSegmentRoot($(e.currentTarget));$root||($root=this.getSegmentParent(e.currentTarget));data={value:$root.text(),app:this.model.application.get("app"),owner:this.model.application.get("owner"),stripReportsSearch:!1};data=$root.hasClass("a")?$.extend(data,{q:this.model.report.entry.content.get("search"),action:"removeterm"}):this.children.json.isValidJSON()?$.extend(data,{q:this.keyboardSearchModifier.isReplacement(e)?"*":this.model.report.entry.content.get("search"),action:"fieldvalue",field:$root.siblings().eq(0).text(),value:$root.text(),negate:this.keyboardSearchModifier.isNegation(e),usespath:!0}):$.extend(data,{q:this.keyboardSearchModifier.isReplacement(e)?"*":this.model.report.entry.content.get("search"),action:"addterm",negate:this.keyboardSearchModifier.isNegation(e)});this.model.state.trigger("drilldown",{data:data,event:e,idx:this.options.idx});return!1},"click .hideinline":function(e){this.model.state.set(this.showAllLines,!1);e.preventDefault()},"click .showinline":function(e){this.model.state.set(this.showAllLines,!0);e.preventDefault()},"click .toggle-raw-json":function(e){this.model.state.set(this.showFormattedJSON,!this.model.state.get(this.showFormattedJSON));this.render();this.model.state.trigger(this.interaction);e.preventDefault()}},getSegmentParent:function(element){var parent=element.parentNode;parent.childNodes[parent.childNodes.length-1]==element&&$(parent).hasClass("t")&&(element=parent);return $(element)},isType:function(type){return this.model.report.entry.content.get("display.events.type")===type},getSegmentRoot:function($element){return $element.hasClass("event")?void 0:$element.hasClass("a")?$element:this.getSegmentRoot($element.parent())},render:function(){var wrap=!0,content=this.model.report.entry.content,linecount=parseInt(this.model.event.get("_fulllinecount"),10);(this.isType("list")||this.isType("table"))&&(wrap=util.normalizeBoolean(content.get("display.events.list.wrap")));this.el.innerHTML=this.compiledTemplate({_:_,isTable:this.isType("table"),isJSON:this.children.json.isValidJSON(),isFormatted:this.model.state.get(this.showFormattedJSON),model:this.model.event,linecount:linecount,wrap:wrap,expanded:this.model.state.get(this.showAllLines),decorations:this.decorations});var $rawevent=this.$(".raw-event"),$jsonevent=this.$(".json-event");!this.isType("table")&&this.model.state.get(this.showFormattedJSON)?this.children.json.render().appendTo($jsonevent):this.isType("table")?$rawevent.append(_.escape(this.model.event.getRawText())):$rawevent[0].innerHTML=this.model.event.getRawSegmentation();return this},template:'                <% if(model.has("_decoration") && decorations[model.get("_decoration")]) { %>                    <% var decoration = decorations[model.get("_decoration")]; %>                    <span class="audit label  <%- decoration.label %>"><i class="<%- decoration.icon %>"></i> <%- decoration.msg %></span>                <% } %>                <div class="json-event"></div>                <div class="raw-event normal <% if(wrap){ %> wrap <% } %>"></div>                <% if(isJSON && !isTable) { %><a href="#" class="toggle-raw-json"><%- (!isFormatted) ? _("Show syntax highlighted").t(): _("Show as raw text").t() %></a> <% } %>                <% if (expanded) { %>                    <a href="#" class="hideinline">Collapse</a>                <% } else if (model.isTruncated()) { %>                    <a href="#" class="showinline">Show all <%= linecount %> lines</a>                <% } %>            '})});define("views/shared/eventsviewer/list/body/row/Master",["jquery","underscore","backbone","module","views/Base","views/shared/eventsviewer/list/body/row/SelectedFields","views/shared/eventsviewer/shared/EventFields","views/shared/eventsviewer/shared/RawField","splunk.util"],function($,_,Backbone,module,BaseView,SelectedFieldsView,EventFieldsView,RawField,splunkUtil){return BaseView.extend({moduleId:module.id,tagName:"tr",initialize:function(){BaseView.prototype.initialize.apply(this,arguments);this.interaction="i"+this.options.idx;this.rowExpanded="r"+this.options.idx;this.showAllLines="s"+this.options.idx;this.model.state.unset(this.showAllLines);this.model.renderer=this.collection.eventRenderers.getRenderer(this.model.event.get("eventtype"));this.children.raw=new RawField({model:{event:this.model.event,state:this.model.state,result:this.model.result,report:this.model.report,searchJob:this.model.searchJob,application:this.model.application},collection:{eventRenderers:this.collection.eventRenderers},idx:this.options.idx});this.children.selectedFields=new SelectedFieldsView({model:{event:this.model.event,state:this.model.state,result:this.model.result,summary:this.model.summary,application:this.model.application,report:this.model.report,searchJob:this.model.searchJob},collection:{selectedFields:this.collection.selectedFields,workflowActions:this.collection.workflowActions},rowExpanded:this.rowExpanded,selectableFields:this.options.selectableFields})},startListening:function(){this.listenTo(this.model.state,this.interaction,function(){this.isExpanded()||this.expand()});this.listenTo(this.model.state,"change:"+this.rowExpanded,function(model,value){value||this.collapseState()});this.listenTo(this.model.state,"change:"+this.showAllLines,function(){!this.isExpanded()&&this.options.allowRowExpand?this.expand():this.eventFetch()});this.listenTo(this.model.state,"intentions-fetch",this.collapseState);this.listenTo(this.model.report.entry.content,"change:display.events.type",this.manageListRawState)},manageListRawState:function(){if(this.isList()){this.$("td._time").show();this.children.selectedFields.active?this.children.selectedFields.$el.show():this.children.selectedFields.activate().$el.show()}else{this.children.selectedFields.deactivate().$el.hide();this.$("td._time").hide()}},events:{"click td.expands":function(e){this.expand();e.preventDefault()},"click .formated-time":function(e){e.preventDefault();this.drilldown($(e.currentTarget),e)},"keyup ._time":function(e){e.preventDefault();13===e.which&&this.drilldown($(e.currentTarget).find("span.formated-time"),e)}},drilldown:function($target,e){var timeIso,epoch,data=$target.data();if(data.timeIso){timeIso=data.timeIso;epoch=splunkUtil.getEpochTimeFromISO(timeIso);this.model.state.trigger("drilldown",{noFetch:!0,data:{"dispatch.earliest_time":epoch,"dispatch.latest_time":""+(parseFloat(epoch)+1)},event:e,_time:timeIso,idx:this.options.idx})}},eventFieldsFactory:function(){this.children.eventFields=new EventFieldsView({model:{event:this.model.event,state:this.model.state,result:this.model.result,summary:this.model.summary,application:this.model.application,report:this.model.report,searchJob:this.model.searchJob},collection:{selectedFields:this.collection.selectedFields,workflowActions:this.collection.workflowActions},selectableFields:this.options.selectableFields,allowRowExpand:this.options.allowRowExpand,idx:this.options.idx,swappingKey:this.swappingKey,showAllLines:this.showAllLines});this.children.eventFields.render().insertAfter(this.$(".event").find(this.children.raw.el))},expand:function(){if(this.options.allowRowExpand){this.children.eventFields||this.eventFieldsFactory();this.isExpanded()?this.collapseState():this.expandState()}},eventFetch:function(){this.model.event.id=this.model.searchJob.entry.links.get("events");this.model.event.fetch({data:$.extend(!0,this.model.application.toJSON(),{isRt:this.model.searchJob.isRealtime(),search:this.model.report.getSortingSearch(),earliest_time:this.model.report.entry.content.get("display.events.timelineEarliestTime"),latest_time:this.model.report.entry.content.get("display.events.timelineLatestTime"),segmentation:this.model.report.entry.content.get("display.events.list.drilldown"),max_lines:this.model.state.get(this.showAllLines)?0:this.model.report.getNearestMaxlines(),eventsOffset:+this.model.report.entry.content.get("display.prefs.events.offset")||0,oid:this.model.application.get("oid")})})},isExpanded:function(){return this.model.state.get(this.rowExpanded)},expandState:function(){this.eventFetch();this.model.state.set(this.rowExpanded,!0);this.children.eventFields&&this.children.eventFields.activate().$el.show();this.isList()&&this.children.selectedFields.deactivate().$el.hide();this.toggleArrow(!0)},collapseState:function(){this.model.state.set(this.rowExpanded,!1);this.children.eventFields&&this.children.eventFields.deactivate().$el.hide();this.isList()&&this.children.selectedFields.activate().$el.show();this.toggleArrow(!1)},isList:function(){return"list"===this.model.report.entry.content.get("display.events.type")},toggleArrow:function(open){var $arrow=this.$("td.expands > a > i").removeClass("icon-triangle-right-small icon-triangle-down-small");$arrow.addClass(open?"icon-triangle-down-small":"icon-triangle-right-small")},render:function(){this.$el.html(this.compiledTemplate({$:$,event:this.model.event,lineNum:this.options.lineNum,application:this.model.application,expanded:this.isExpanded(),isList:this.isList(),formattedTime:this.model.event.formattedTime(),colorClass:this.model.renderer?this.model.renderer.entry.content.get("css_class"):"",allowRowExpand:this.options.allowRowExpand}));this.children.raw.render().appendTo(this.$(".event"));this.children.selectedFields.render().appendTo(this.$(".event"));this.isList()||this.children.selectedFields.deactivate().$el.hide();return this},template:'                <% if (allowRowExpand) { %>                <td class="expands <%- colorClass %>">                    <a href="#"><i class="icon-triangle-<%- expanded ? "down" : "right" %>-small"></i></a>                </td>                <% } %>                <td class="line-num"><span><%- lineNum %></span></td>                <td class="_time" <% if (!isList) { %> style="display:none" <%}%> tabindex="0">                    <span class="formated-time" data-time-iso="<%- event.get("_time") %>">                    <% if(application.get("locale").indexOf("en") > -1){ %>                         <span><%- $.trim(formattedTime.slice(0, formattedTime.indexOf(" "))) %></span>                         <br>                         <span><%- $.trim(formattedTime.slice(formattedTime.indexOf(" "))) %></span>                    <% } else { %>                         <%- formattedTime %>                    <% } %>                    </span>                </td>                <td class="event"></td>            '})});define("views/shared/eventsviewer/list/body/Master",["module","underscore","views/Base","views/shared/eventsviewer/list/body/row/Master","util/console"],function(module,_,BaseView,Row,console){return BaseView.extend({moduleId:module.id,tagName:"tbody",initialize:function(){BaseView.prototype.initialize.apply(this,arguments)},startListening:function(){this.listenTo(this.model.result.results,"reset",function(){this.model.state.get("isModalized")||this.debouncedCleanupAndRender()})},activate:function(options){var clonedOptions=_.extend({},options||{});delete clonedOptions.deep;if(this.active)return BaseView.prototype.activate.call(this,clonedOptions);BaseView.prototype.activate.call(this,clonedOptions);this.synchronousCleanupAndDebouncedRender();return this},synchronousCleanupAndDebouncedRender:function(){if(this.active){this.cleanup();this.debouncedRender()}},debouncedCleanupAndRender:_.debounce(function(){if(this.active){this.cleanup();this.render()}},0),cleanup:function(){this.trigger("rows:pre-remove");this.eachChild(function(child){child.deactivate({deep:!0});child.debouncedRemove({detach:!0})},this);this.children={}},render:function(){if(_.isEmpty(this.children)){var fragment=document.createDocumentFragment(),isRT=this.model.searchJob.entry.content.get("isRealTimeSearch"),results=isRT?this.model.result.results.reverse({mutate:!1}):this.model.result.results.models;console.debug("Events Lister: rendering",results.length,"events",isRT?"in real-time mode":"in historical mode");_.each(results,function(event,idx){var lineNum,id="row_"+idx;lineNum=isRT?this.model.result.endOffset()-idx:this.model.result.get("init_offset")+idx+1;this.children[id]=new Row({lineNum:lineNum,model:{state:this.model.state,event:event,result:this.model.result,summary:this.model.summary,report:this.model.report,application:this.model.application,searchJob:this.model.searchJob},collection:{selectedFields:this.collection.selectedFields,eventRenderers:this.collection.eventRenderers,workflowActions:this.collection.workflowActions},idx:idx,selectableFields:this.options.selectableFields,allowRowExpand:this.options.allowRowExpand});this.children[id].render().appendTo(fragment);this.children[id].activate({deep:!0})},this);this.el.appendChild(fragment);_(this.model.state.toJSON()).each(function(value,key){0===key.indexOf("pendingRemove")&&this.model.state.unset(key)},this);this.trigger("rows:added")}return this}})});define("views/shared/eventsviewer/list/Master",["underscore","module","views/Base","views/shared/delegates/Modalize","views/shared/delegates/TableDock","views/shared/delegates/TableHeadStatic","views/shared/eventsviewer/shared/TableHead","views/shared/eventsviewer/list/body/Master","splunk.util"],function(_,module,BaseView,Modalize,TableDock,TableHeadStatic,TableHeadView,TableBodyView,util){return BaseView.extend({moduleId:module.id,className:"scrolling-table-wrapper",initialize:function(){BaseView.prototype.initialize.apply(this,arguments);this.tableId=this.cid+"-table";this.children.modalize=new Modalize({el:this.el,tbody:"#"+this.tableId+" > tbody"});this.children.head=new TableHeadView({model:this.model.report,labels:this.isList()?["Time","Event"]:["Event"],allowRowExpand:this.options.allowRowExpand});this.children.body=new TableBodyView({model:{result:this.model.result,summary:this.model.summary,state:this.model.state,searchJob:this.model.searchJob,report:this.model.report,application:this.model.application},collection:{selectedFields:this.collection.selectedFields,eventRenderers:this.collection.eventRenderers,workflowActions:this.collection.workflowActions},selectableFields:this.options.selectableFields,allowRowExpand:this.options.allowRowExpand});"dock"===this.options.headerMode?this.children.tableDock=new TableDock({el:this.el,offset:this.options.headerOffset,defaultLayout:"fixed"}):"static"===this.options.headerMode&&(this.children.staticHead=new TableHeadStatic({el:this.el,scrollContainer:"> .vertical-scrolling-table-wrapper",flexWidthColumn:!1}))},isList:function(){return"list"===this.model.report.entry.content.get("display.events.type")},modalize:function(idx){this.children.modalize.show(idx)},activate:function(){if(this.active)return BaseView.prototype.activate.apply(this,arguments);this.showHideRowNum();this.children.head.updateLabels(this.isList()?["Time","Event"]:["Event"]);return BaseView.prototype.activate.apply(this,arguments)},startListening:function(){var modalize=_.debounce(this.modalize);this.listenTo(this.model.state,"change",function(model){var key;for(key in model.changed)if(this.model.state.ROW_EXPAND_REX.test(key)){if(model.changed[key]){this.model.state.set("isModalized",!0);modalize.call(this,+/\d+/.exec(key)[0]);this.children.tableDock&&this.children.tableDock.disable();this.children.staticHead&&this.children.staticHead.deactivate()}else{this.model.state.set("isModalized",!1);modalize.call(this);this.children.tableDock&&this.children.tableDock.enable();this.children.staticHead&&this.children.staticHead.activate()}break}});this.listenTo(this.collection.selectedFields,"reset add remove",this.children.modalize.update);this.listenTo(this.children.modalize,"unmodalize",function(idx){this.model.state.set("r"+idx,!1)});this.listenTo(this.model.report.entry.content,"change:display.events.rowNumbers",function(model,value){var $table=this.$("table:not(.table-embed)"),hasRowNumbers=util.normalizeBoolean(value);hasRowNumbers?$table.removeClass("hide-line-num"):$table.addClass("hide-line-num");this.updateTableHead()});this.listenTo(this.model.report.entry.content,"change:display.events.type",function(){this.showHideRowNum();this.children.head.updateLabels(this.isList()?["Time","Event"]:["Event"]);this.updateTableHead()});this.listenTo(this.model.report.entry.content,"change:display.events.list.wrap",function(){this.updateTableHead()});this.listenTo(this.model.result.results,"reset",function(){this.model.state.get("isModalized")||this.updateTableHead()});this.listenTo(this.children.body,"rows:pre-remove",function(){this.$el.css("minHeight",this.$el.height())});this.listenTo(this.children.body,"rows:added",function(){this.$el.css("minHeight","")})},deactivate:function(){if(!this.active)return BaseView.prototype.deactivate.apply(this,arguments);this.$(".header-table-docked").remove();BaseView.prototype.deactivate.apply(this,arguments);return this},showHideRowNum:function(){var $table=this.$("#"+this.tableId),hasRowNumbers=util.normalizeBoolean(this.model.report.entry.content.get("display.events.rowNumbers"));this.isList()&&hasRowNumbers?$table.removeClass("hide-line-num"):this.isList()&&hasRowNumbers||$table.addClass("hide-line-num")},updateTableHead:function(){this.children.tableDock?_.defer(this.children.tableDock.update.bind(this.children.tableDock)):this.children.staticHead&&_.defer(function(){this.updateContainerHeight();_.defer(function(){this.children.staticHead.update()}.bind(this))}.bind(this))},updateContainerHeight:function(height){height?this.$("> .vertical-scrolling-table-wrapper").css("height",height):this.$("> .vertical-scrolling-table-wrapper").css("max-height",$(window).height()-this.$el.offset().top)},render:function(){this.$el.html(this.compiledTemplate({hidelinenums:!util.normalizeBoolean(this.model.report.entry.content.get("display.events.rowNumbers")),addstatichead:!!this.children.staticHead,tableId:this.tableId}));this.children.head.render().appendTo(this.$("#"+this.tableId));this.children.body.render().appendTo(this.$("#"+this.tableId));return this},reflow:function(){this.updateTableHead();return this},template:'                <% if (addstatichead) { %>                    <div class="header-table-static"></div>                    <div class="vertical-scrolling-table-wrapper">                <% } %>                <table class="table table-chrome <% if(hidelinenums){ %> hide-line-num <% } %> table-row-expanding events-results events-results-table" id="<%= tableId %>"></table>                <% if (addstatichead) { %>                    </div>                <% } %>            '})});define("views/shared/eventsviewer/table/TableHead",["underscore","module","views/Base","splunk.util","helpers/user_agent"],function(_,module,BaseView,util,user_agent){return BaseView.extend({moduleId:module.id,tagName:"thead",initialize:function(){BaseView.prototype.initialize.apply(this,arguments);_.defaults(this.options,{sortableFields:!0})},startListening:function(){this.listenTo(this.collection.intersectedFields,"reset",this.render);this.listenTo(this.model.report.entry.content,"change:display.events.rowNumbers change:display.events.table.sortDirection change:display.events.table.sortColumn",this.render)},activate:function(){if(this.active)return BaseView.prototype.activate.apply(this,arguments);BaseView.prototype.activate.apply(this,arguments);this.render();return this},events:{"click th":function(e){var $target=$(e.currentTarget);this.model.report.entry.content.set({"display.events.table.sortDirection":$target.hasClass("asc")?"desc":"asc","display.events.table.sortColumn":$target.attr("data-name")});
e.preventDefault()}},render:function(){this.$el.html(this.compiledTemplate({collection:this.collection.intersectedFields,hasRowNum:util.normalizeBoolean(this.model.report.entry.content.get("display.events.rowNumbers")),allowRowExpand:this.options.allowRowExpand,content:this.model.report.entry.content,sortableFields:this.options.sortableFields,reorderableHandle:this.options.selectableFields?"on":"off",isRealTime:this.model.searchJob.entry.content.get("isRealTimeSearch"),is_ie7:user_agent.isIE7()?"ie7":"",_:_}));return this},template:'                <tr class="">                    <% if (allowRowExpand) { %>                        <th class="col-info"><i class="icon-info"></i></th>                    <% } %>                    <% if(hasRowNum) { %>                        <th class="line-num <%- is_ie7 %>">&nbsp;</th>                    <% }%>                    <th class="col-time <%- content.get("display.events.table.sortColumn") ? "sorts" : "" %> <%- is_ie7 %>">_time</th>                    <% collection.each(function(model) { %>                        <% var active = (!isRealTime && (content.get("display.events.table.sortColumn") == model.get("name"))) ? "active": ""%>                        <% var dir = (!isRealTime && (active==="active")) ? content.get("display.events.table.sortDirection") : ""%>                        <% var sorts = (!isRealTime && sortableFields) ? "sorts" : ""; %>                        <% var reorderable = (!isRealTime) ? "reorderable" : ""; %>                        <% var reorderableLabel = (!isRealTime) ? "reorderable-label" : ""; %>                        <th class=" <%- reorderable %> <%- sorts %> <%-active%> <%-dir%>" data-name="<%- model.get("name") %>"><span class="<%- reorderableLabel %> <%- reorderableHandle %>"><%- _(model.get("name")).t() %></span></th>                    <% }) %>                </tr>            '})});define("views/shared/eventsviewer/table/body/PrimaryRow",["jquery","underscore","module","keyboard/SearchModifier","views/Base","splunk.util"],function($,_,module,KeyboardSearchModifier,BaseView,splunkUtil){return BaseView.extend({moduleId:module.id,tagName:"tr",initialize:function(){BaseView.prototype.initialize.apply(this,arguments);this.$el.addClass(this.options.idx%2?"even":"odd");this.keyboardSearchModifier=new KeyboardSearchModifier;this.model.renderer=this.collection.eventRenderers.getRenderer(this.model.event.get("eventtype"));this.rowExpanded="r"+this.options.idx;this.interaction="i"+this.options.idx;this.showAllLines="s"+this.options.idx},startListening:function(){this.listenTo(this.model.state,"change:"+this.rowExpanded,function(model,value){value||this.collapseState();this.$(".expands").attr("rowspan",value?2:1)});this.listenTo(this.collection.selectedFields,"reset add remove",this.render);this.listenTo(this.model.report.entry.content,"change:display.events.table.drilldown",this.render);this.listenTo(this.model.report.entry.content,"change:display.prefs.events.offset",this.collapseState);this.listenTo(this.model.report.entry.content,"change:display.events.list.wrap",function(){var wrap=splunkUtil.normalizeBoolean(this.model.report.entry.content.get("display.events.list.wrap")),$cells=this.$("a.field-val").parents("td");wrap?$cells.removeClass("no-wrap"):$cells.addClass("no-wrap")})},events:{"click td.expands":function(e){this.expand();e.preventDefault()},"click ._time-drilldown > a":function(e){e.preventDefault()},"click ._time-drilldown":function(e){e.preventDefault();splunkUtil.normalizeBoolean(this.model.report.entry.content.get("display.events.table.drilldown"))&&this.drilldown($(e.currentTarget).find("a"),e)},"click .one-value-drilldown > a.field-val":function(e){e.preventDefault()},"click .one-value-drilldown":function(e){e.preventDefault();this.drilldown($(e.currentTarget).find("a"),e)},"click .multi-value-drilldown > a.field-val":function(e){e.preventDefault();this.drilldown($(e.currentTarget),e)},"keypress td":function(e){e.preventDefault();13===e.which&&this.drilldown($(e.currentTarget).find("a"),e)}},expand:function(){this.isExpanded()?this.collapseState():this.expandState()},isExpanded:function(){return this.model.state.get(this.rowExpanded)},eventFetch:function(){this.model.event.id=this.model.searchJob.entry.links.get("events");this.model.event.fetch({data:$.extend(!0,this.model.application.toJSON(),{isRt:this.model.searchJob.isRealtime(),search:this.model.report.getSortingSearch(),earliest_time:this.model.report.entry.content.get("display.events.timelineEarliestTime"),latest_time:this.model.report.entry.content.get("display.events.timelineLatestTime"),segmentation:this.model.report.entry.content.get("display.events.list.drilldown"),max_lines:this.model.state.get(this.showAllLines)?0:this.model.report.getNearestMaxlines(),eventsOffset:+this.model.report.entry.content.get("display.prefs.events.offset")||0})})},debouncedRemove:function(){this.model.state.set(this.pendingRemove,!0);BaseView.prototype.debouncedRemove.apply(this,arguments);return this},drilldown:function($target,e){var timeIso,epoch,data=$target.data();if(data.timeIso){timeIso=data.timeIso;epoch=splunkUtil.getEpochTimeFromISO(timeIso);this.model.state.trigger("drilldown",{noFetch:!0,data:{"dispatch.earliest_time":epoch,"dispatch.latest_time":""+(parseFloat(epoch)+1)},event:e,_time:timeIso,idx:this.options.idx})}else this.model.state.trigger("drilldown",{data:{q:this.model.report.entry.content.get("search"),negate:this.keyboardSearchModifier.isNegation(e),action:"fieldvalue",field:$target.data().name,value:$.trim($target.text()),app:this.model.application.get("app"),owner:this.model.application.get("owner")},event:e,idx:this.options.idx})},expandState:function(){this.eventFetch();this.model.state.set(this.rowExpanded,!0);this.toggleArrow(!0)},collapseState:function(){this.model.state.set(this.rowExpanded,!1);this.toggleArrow(!1)},toggleArrow:function(open){var $arrow=this.$("td.expands > a > i").removeClass("icon-triangle-right-small icon-triangle-down-small");$arrow.addClass(open?"icon-triangle-down-small":"icon-triangle-right-small")},render:function(){var root=this.el;this.$el.find("> td").each(function(key,element){root.removeChild(element)});this.$el.append(this.compiledTemplate({$:$,_:_,event:this.model.event,lineNum:this.options.lineNum,expanded:this.model.state.get(this.rowExpanded),drilldown:splunkUtil.normalizeBoolean(this.model.report.entry.content.get("display.events.table.drilldown")),application:this.model.application,selectedFields:this.collection.selectedFields,colorClass:this.model.renderer?this.model.renderer.entry.content.get("css_class"):"",formattedTime:this.model.event.formattedTime(),allowRowExpand:this.options.allowRowExpand,wrap:splunkUtil.normalizeBoolean(this.model.report.entry.content.get("display.events.table.wrap"))}));return this},template:'                <% if (allowRowExpand) { %>                    <td <%if(expanded) {%>rowspan=2<%}%> class="expands <%- colorClass %>">                        <a href="#"><i class="icon-triangle-<%- expanded ? "down" : "right" %>-small"></i></a>                    </td>                <% } %>                <td class="line-num"><span><%- lineNum %></span></td>                <td class="_time <%= drilldown ? "_time-drilldown" : "" %>" tabindex="0">                    <% if(drilldown) { %>                        <a data-time-iso="<%- event.get("_time") %>">                    <% } else { %>                        <span data-time-iso="<%- event.get("_time") %>">                    <% } %>                        <% if(application.get("locale").indexOf("en") > -1){ %>                             <span><%- $.trim(formattedTime.slice(0, formattedTime.indexOf(" "))) %></span>                             <br>                             <span><%- $.trim(formattedTime.slice(formattedTime.indexOf(" "))) %></span>                        <% } else { %>                             <%- formattedTime %>                        <% } %>                    <% if(drilldown) { %>  </a>  <% } else { %> </span> <% } %>                </td>                <% selectedFields.each(function(model) { %>                    <% var fields = event.get(model.get("name")); %>                    <% if (drilldown) { %>                        <td class="<% if(!wrap) { %>no-wrap<% } %> <%= drilldown && fields && fields.length > 1 ? "multi-value-drilldown" : ""  %> <%= drilldown && fields && fields.length == 1 ? "one-value-drilldown" : ""  %>"  tabindex="0"><% _(fields).each(function(field) { %><a class="field-val" data-name="<%- model.get("name") %>"><%- field %></a><% }) %></td>                    <% } else { %>                        <td class="<% if(!wrap) { %>no-wrap<% } %>"  tabindex="0"><% _(fields).each(function(field) { %><span class="field-val" data-name="<%- model.get("name") %>"><%- field %></span><% }) %></td>                    <% } %>                <% }) %>            '})});define("views/shared/eventsviewer/table/body/SecondaryRow",["module","underscore","views/Base","views/shared/eventsviewer/shared/EventFields","views/shared/eventsviewer/shared/RawField","splunk.util"],function(module,_,BaseView,EventFields,RawField,util){return BaseView.extend({moduleId:module.id,tagName:"tr",className:"field-row",initialize:function(){BaseView.prototype.initialize.apply(this,arguments);this.$el.addClass(this.options.idx%2?"even":"odd");this.rowExpanded="r"+this.options.idx;this.showAllLines="s"+this.options.idx;this.children.eventFields=new EventFields({model:{event:this.model.event,report:this.model.report,summary:this.model.summary,result:this.model.result,state:this.model.state,application:this.model.application,searchJob:this.model.searchJob},collection:{workflowActions:this.collection.workflowActions,selectedFields:this.collection.selectedFields},selectableFields:this.options.selectableFields,idx:this.options.idx});this.children.raw=new RawField({model:{event:this.model.event,state:this.model.state,result:this.model.result,report:this.model.report,searchJob:this.model.searchJob,application:this.model.application},segmentation:!1,idx:this.options.idx})},startListening:function(){this.listenTo(this.model.state,"change:"+this.rowExpanded,this.visibility);this.listenTo(this.model.result,"tags-updated",function(){this.model.state.get(this.rowExpanded)&&this.render()});this.listenTo(this.model.state,"change:"+this.showAllLines,this.eventFetch);this.listenTo(this.model.state,"unmodalize"+this.options.idx,this.collapseState);this.listenTo(this.collection.selectedFields,"reset add remove",function(){this.model.state.get(this.rowExpanded)&&this.$(".event").attr("colspan",this.model.event.keys().length)})},eventFetch:function(){this.model.event.id=this.model.searchJob.entry.links.get("events");this.model.event.fetch({data:$.extend(!0,this.model.application.toJSON(),{isRt:this.model.searchJob.isRealtime(),search:this.model.report.getSortingSearch(),earliest_time:this.model.report.entry.content.get("display.events.timelineEarliestTime"),latest_time:this.model.report.entry.content.get("display.events.timelineLatestTime"),segmentation:this.model.report.entry.content.get("display.events.list.drilldown"),max_lines:this.model.state.get(this.showAllLines)?0:this.model.report.getNearestMaxlines(),eventsOffset:+this.model.report.entry.content.get("display.prefs.events.offset")||0})})},visibility:function(){var $arrow=this.$("td.expands > a > i").removeClass("icon-triangle-right-small icon-triangle-down-small");if(this.model.state.get(this.rowExpanded)){this.$el.css("display","");$arrow.addClass("icon-triangle-down-small");this.children.raw.activate().$el.show();this.children.eventFields.activate().$el.show()}else{this.$el.hide();$arrow.addClass("icon-triangle-right-small");this.children.raw.deactivate().$el.hide();this.children.eventFields.deactivate().$el.hide()}},getCalculatedColSpan:function(){return this.collection.selectedFields.length+1+(util.normalizeBoolean(this.model.report.entry.content.get("display.events.rowNumbers"))?1:0)},collapseState:function(){this.model.state.unset("modalize");this.model.state.unset(this.rowExpanded);this.model.state.unset("sleep")},render:function(){var root=this.el;this.$el.find("> td").each(function(key,element){root.removeChild(element)});this.$el.append(this.compiledTemplate({cspan:this.getCalculatedColSpan(),raw:this.model.event.getRawText()}));this.children.raw.render().appendTo(this.$(".event"));this.children.eventFields.render().appendTo(this.$(".event"));this.visibility();return this},template:'                <td class="event" colspan="<%- cspan %>"></td>            '})});define("views/shared/eventsviewer/table/body/Master",["jquery","underscore","module","views/Base","views/shared/eventsviewer/table/body/PrimaryRow","views/shared/eventsviewer/table/body/SecondaryRow","util/console"],function($,_,module,BaseView,PrimaryRow,SecondaryRow,console){return BaseView.extend({moduleId:module.id,tagName:"tbody",initialize:function(){BaseView.prototype.initialize.apply(this,arguments)},startListening:function(){this.listenTo(this.model.result.results,"reset",this.debouncedCleanupAndRender);this.listenTo(this.collection.intersectedFields,"reset",this.debouncedCleanupAndRender)},activate:function(options){var clonedOptions=_.extend({},options||{});delete clonedOptions.deep;if(this.active)return BaseView.prototype.activate.call(this,clonedOptions);BaseView.prototype.activate.call(this,clonedOptions);this.synchronousCleanupAndDebouncedRender();return this},synchronousCleanupAndDebouncedRender:function(){if(this.active){this.cleanup();this.debouncedRender()}},debouncedCleanupAndRender:_.debounce(function(){if(this.active){this.cleanup();this.render()}},0),cleanup:function(){this.trigger("rows:pre-remove");this.eachChild(function(child){child.deactivate({deep:!0});child.debouncedRemove({detach:!0})},this);this.children={}},render:function(){if(_.isEmpty(this.children)){var fragment=document.createDocumentFragment(),isRealTimeSearch=this.model.searchJob.entry.content.get("isRealTimeSearch"),results=isRealTimeSearch?this.model.result.results.reverse({mutate:!1}):this.model.result.results.models;console.debug("Events Table: rendering",results.length,"events",isRealTimeSearch?"in real-time mode":"in historical mode");_.each(results,function(event,idx){var lineNum;lineNum=this.model.searchJob.entry.content.get("isRealTimeSearch")?this.model.result.endOffset()-idx:this.model.result.get("init_offset")+idx+1;this.children["masterRow_"+idx]=new PrimaryRow({model:{event:event,report:this.model.report,application:this.model.application,searchJob:this.model.searchJob,result:this.model.result,state:this.model.state},collection:{eventRenderers:this.collection.eventRenderers,selectedFields:this.collection.intersectedFields},lineNum:lineNum,idx:idx,allowRowExpand:this.options.allowRowExpand});this.children["masterRow_"+idx].render().appendTo(fragment);this.children["masterRow_"+idx].activate({deep:!0});this.children["fieldRow_"+idx]=new SecondaryRow({model:{event:event,report:this.model.report,result:this.model.result,summary:this.model.summary,state:this.model.state,application:this.model.application,searchJob:this.model.searchJob},collection:{workflowActions:this.collection.workflowActions,selectedFields:this.collection.selectedFields},idx:idx,selectableFields:this.options.selectableFields});this.children["fieldRow_"+idx].render().appendTo(fragment);this.children["fieldRow_"+idx].activate({deep:!0})},this);this.el.appendChild(fragment);_(this.model.state.toJSON()).each(function(value,key){0===key.indexOf("pendingRemove")&&this.model.state.unset(key)},this);this.trigger("rows:added");this.reflow()}return this},reflow:function(){this.model.state.trigger("init-draggable")}})});define("views/shared/eventsviewer/table/Master",["module","underscore","splunk.util","jquery.ui.draggable","views/Base","views/shared/delegates/Modalize","views/shared/delegates/TableDock","views/shared/delegates/TableHeadStatic","views/shared/eventsviewer/table/TableHead","views/shared/eventsviewer/table/body/Master"],function(module,_,util,undefined,BaseView,Modalize,TableDock,TableHeadStatic,TableHeadView,TableBodyView){return BaseView.extend({moduleId:module.id,className:"scrolling-table-wrapper",initialize:function(){BaseView.prototype.initialize.apply(this,arguments);_.defaults(this.options,{sortableFields:!0});this.tableId=this.cid+"-table";this.drag={};this.collection.intersectedFields=this.collection.selectedFields.deepClone();this.children.modalize=new Modalize({el:this.el,tbody:"#"+this.tableId+" > tbody"});this.children.head=new TableHeadView({model:{report:this.model.report,searchJob:this.model.searchJob},collection:{intersectedFields:this.collection.intersectedFields,selectedFields:this.collection.selectedFields},selectableFields:this.options.selectableFields,sortableFields:this.options.sortableFields,allowRowExpand:this.options.allowRowExpand,isRealTime:this.model.searchJob.entry.content.get("isRealTimeSearch")});this.children.body=new TableBodyView({model:{result:this.model.result,state:this.model.state,summary:this.model.summary,searchJob:this.model.searchJob,report:this.model.report,application:this.model.application},collection:{workflowActions:this.collection.workflowActions,intersectedFields:this.collection.intersectedFields,eventRenderers:this.collection.eventRenderers,selectedFields:this.collection.selectedFields},selectableFields:this.options.selectableFields,allowRowExpand:this.options.allowRowExpand});"dock"===this.options.headerMode?this.children.tableDock=new TableDock({el:this.el,offset:this.options.headerOffset,defaultLayout:"fixed"}):"static"===this.options.headerMode&&(this.children.staticHead=new TableHeadStatic({el:this.el,scrollContainer:"> .vertical-scrolling-table-wrapper",flexWidthColumn:!1}))},startListening:function(){var modalize=_.debounce(function(idx,optArg){this.modalize(idx,optArg)}.bind(this),0);this.listenTo(this.model.state,"change",function(model){var key;for(key in model.changed)if(this.model.state.ROW_EXPAND_REX.test(key)){if(model.changed[key]){this.model.state.set("isModalized",!0);modalize.call(this,+/\d+/.exec(key)[0],!0);this.children.tableDock&&this.children.tableDock.disable();this.children.staticHead&&this.children.staticHead.deactivate()}else{this.model.state.set("isModalized",!1);modalize.call(this);this.children.tableDock&&this.children.tableDock.enable();this.children.staticHead&&this.children.staticHead.activate()}break}});this.listenTo(this.children.modalize,"unmodalize",function(idx){this.model.state.set("r"+idx,!1);this.updateIntersectedFields()});this.listenTo(this.model.state,"init-draggable",this.initDraggable);this.listenTo(this.collection.selectedFields,"reset add remove",function(model,collection,options){if(!options){options=collection;collection=model;model=undefined}if(!this.model.state.get("isModalized")){model&&model.get("name")===this.model.report.entry.content.get("display.events.table.sortColumn")&&this.model.report.entry.content.set({"display.events.table.sortColumn":"","display.events.table.sortDirection":""});this.updateIntersectedFields();modalize(this.model.state.get("modalize"),"table")}});this.listenTo(this.model.result.results,"reset",function(){this.model.state.get("isModalized")||this.updateIntersectedFields()});this.listenTo(this.model.report.entry.content,"change:display.events.rowNumbers",this.showHideRowNum);this.listenTo(this.model.report.entry.content,"change:display.events.table.wrap",this.updateTableHead);this.listenTo(this.model.report.entry.content,"change:display.page.search.showFields",this.updateTableHead);this.options.selectableFields&&this.children.tableDock&&this.listenTo(this.children.tableDock,"updated",this.initDraggable);this.listenTo(this.children.body,"rows:pre-remove",function(){this.$el.css("minHeight",this.$el.height())});this.listenTo(this.children.body,"rows:added",function(){this.$el.css("minHeight","");this.updateTableHead()})},activate:function(options){options=options||{};options.startListening=!1;if(this.active)return BaseView.prototype.activate.apply(this,arguments);this.stopListening();this.startListening();this.updateIntersectedFields();this.showHideRowNum();return BaseView.prototype.activate.call(this,options)},deactivate:function(){if(!this.active)return BaseView.prototype.deactivate.apply(this,arguments);this.$(".header-table-docked").remove();BaseView.prototype.deactivate.apply(this,arguments);return this},updateIntersectedFields:function(){var models=[];if(this.model.result.results.length){_.each(_(this.collection.selectedFields.pluck("name")).intersection(this.model.result.fields.pluck("name")),function(value){models.push({name:value})});this.collection.intersectedFields.reset(models)}},showHideRowNum:function(){var $table=this.$("#"+this.tableId),hasRowNumbers=util.normalizeBoolean(this.model.report.entry.content.get("display.events.rowNumbers"));hasRowNumbers?$table.removeClass("hide-line-num"):$table.addClass("hide-line-num")},remove:function(){BaseView.prototype.remove.apply(this,arguments);$(window).off("."+this.cid)},reflow:function(){BaseView.prototype.reflow.apply(this,arguments);this.isAttachedToDocument()&&this.children.head.$el.is(":visible")&&this.updateTableHead();return this},style:function(){var maxWidth=this.$el.width();return"#"+this.tableId+" .table-expanded{max-width:"+(maxWidth?maxWidth-80:500)+"px}"},modalize:function(idx,optArg){this.children.modalize.show(idx,optArg)},render:function(){this.$el.html(this.compiledTemplate({hidelinenums:!util.normalizeBoolean(this.model.report.entry.content.get("display.events.rowNumbers")),addstatichead:!!this.children.staticHead,tableId:this.tableId}));this.children.head.render().appendTo(this.$("#"+this.tableId));this.children.body.render().appendTo(this.$("#"+this.tableId));return this},initDraggable:function(){if(this.options.selectableFields){this.drag.$theads=this.$el.find(".reorderable");this.drag.$theads.draggable({helper:this.dragHelper.bind(this),start:this.startDrag.bind(this),stop:this.stopDrag.bind(this),drag:this.dragged.bind(this),containment:this.el,distance:5,scroll:!0})}},updateTableHead:function(){this.children.tableDock?_.defer(this.children.tableDock.update.bind(this.children.tableDock)):this.children.staticHead&&_.defer(function(){this.updateContainerHeight();_.defer(function(){this.children.staticHead.update()}.bind(this))}.bind(this))},updateContainerHeight:function(height){height?this.$("> .vertical-scrolling-table-wrapper").css("height",height):this.$("> .vertical-scrolling-table-wrapper").css("max-height",$(window).height()-this.$el.offset().top)},dragHelper:function(e){this.drag.$th=$(e.currentTarget).addClass("moving");this.drag.thOffsetTop=this.drag.$th.offset().top;this.drag.containerLeft=this.$el.position().left;this.drag.$insertionCursor=this.$(".table-insertion-cursor");this.drag.$insertionCursor.show();this.drag.$helper=$("<div class='reorderable-helper'><span class='reorderable-label'>"+this.drag.$th.text()+"</span></div>").appendTo(this.$el);this.drag.$helper.width(this.drag.$th.width());this.drag.$helper.css("marginRight",-this.drag.$th.width()+"px");this.findInsertionPoints();return this.drag.$helper[0]},findInsertionPoints:function(){this.drag.insertionPoints=[];var $headers=this.$("#"+this.tableId+" > thead > tr > th.reorderable"),originalEl=$headers.filter("[data-name="+this.drag.$th.data("name")+"]")[0],originalIndex=this.drag.originalIndex=$headers.index(originalEl);$headers.each(function(index,el){var $el=$(el),left=$el.position().left+this.$el.scrollLeft();if(originalIndex>index)this.drag.insertionPoints.push({left:left,index:index});else if(index==originalIndex){this.drag.insertionPoints.push({left:left,index:index});this.drag.insertionPoints.push({left:left+$el.outerWidth(),index:index})}else this.drag.insertionPoints.push({left:left+$el.outerWidth(),index:index})}.bind(this))},findClosestInsertion:function(e,ui){if(ui.helper.offset().top-this.drag.thOffsetTop>100)return-1;var closest=-1,closestDistance=1e7,cursorLeft=e.pageX-this.drag.containerLeft+this.$el.scrollLeft();$.each(this.drag.insertionPoints,function(index,point){var distance=Math.abs(point.left-cursorLeft);if(closestDistance>distance){closest=point;closestDistance=distance}});return closest},startDrag:function(){},stopDrag:function(e,ui){var closest=this.findClosestInsertion(e,ui),movingModel=this.collection.selectedFields.findWhere({name:this.drag.$th.data().name});if(-1==closest)this.collection.selectedFields.remove(movingModel);else if(closest.index!==this.drag.originalIndex){this.collection.selectedFields.remove(movingModel,{silent:!0});this.collection.selectedFields.add(movingModel,{at:closest.index})}this.drag.$th.removeClass("moving");this.drag.$insertionCursor.hide()},dragged:function(e,ui){var closest=this.findClosestInsertion(e,ui);if(-1===closest){this.drag.$insertionCursor.hide();ui.helper.addClass("reorderable-remove")}else{this.drag.$insertionCursor.show().css("left",closest.left);ui.helper.removeClass("reorderable-remove")}},template:'                <% if (addstatichead) { %>                    <div class="header-table-static"></div>                    <div class="vertical-scrolling-table-wrapper">                <% } %>                <table class="table table-chrome table-striped <% if(hidelinenums){ %> hide-line-num <% } %> table-row-expanding events-results events-results-table" id="<%= tableId %>"></table>                <% if (addstatichead) { %>                    </div>                <% } %>                <div class="table-insertion-cursor"></div>            '})});define("views/shared/eventsviewer/Master",["jquery","underscore","module","models/Base","models/services/search/jobs/Result","models/services/search/IntentionsParser","views/Base","views/shared/eventsviewer/list/Master","views/shared/eventsviewer/table/Master"],function($,_,module,BaseModel,ResultModel,IntentionsParser,BaseView,EventsListRawView,EventsTableView){var ROW_EXPAND_REX=/r\d+/;return BaseView.extend({moduleId:module.id,initialize:function(){BaseView.prototype.initialize.apply(this,arguments);this.options=$.extend(!0,{selectableFields:!0,sortableFields:!0,headerMode:"dock",headerOffset:0,allowRowExpand:!0,scrollToTopOnPagination:!1,defaultDrilldown:!0},this.options);this.rendered={listraw:!1,table:!1};this.model._result=new ResultModel;this.model.state=this.model.state||new BaseModel;this.model.listrawState=new BaseModel;this.model.tableState=new BaseModel;this.model.intentions=new IntentionsParser;this.model.state.ROW_EXPAND_REX=ROW_EXPAND_REX;this.model.listrawState.ROW_EXPAND_REX=ROW_EXPAND_REX;this.model.tableState.ROW_EXPAND_REX=ROW_EXPAND_REX;this.children.listraw=new EventsListRawView({model:{result:this.model._result,summary:this.model.summary,searchJob:this.model.searchJob,report:this.model.report,application:this.model.application,state:this.model.listrawState},collection:{selectedFields:this.collection.selectedFields,eventRenderers:this.collection.eventRenderers,workflowActions:this.collection.workflowActions},selectableFields:this.options.selectableFields,headerMode:this.options.headerMode,headerOffset:this.options.headerOffset,allowRowExpand:this.options.allowRowExpand});this.children.table=new EventsTableView({model:{result:this.model._result,summary:this.model.summary,searchJob:this.model.searchJob,report:this.model.report,application:this.model.application,state:this.model.tableState},collection:{selectedFields:this.collection.selectedFields,eventRenderers:this.collection.eventRenderers,workflowActions:this.collection.workflowActions},selectableFields:this.options.selectableFields,sortableFields:this.options.sortableFields,headerMode:this.options.headerMode,headerOffset:this.options.headerOffset,allowRowExpand:this.options.allowRowExpand});this.activate({stopRender:!0})},startListening:function(){this.listenTo(this.model.result.results,"reset",function(){if(this.model.state.get("isModalized"))this.model.state.set("pendingRender",!0);else{var responseText=this.model.result.responseText?JSON.parse(this.model.result.responseText):{};this.model._result.setFromSplunkD(responseText,{skipStoringResponseText:!0})}});this.listenTo(this.model.state,"unmodalize",function(){var key,state=this.getType()+"State";for(key in this.model[state].toJSON())if(ROW_EXPAND_REX.test(key)&&this.model[state].get(key)){this.model[state].set(key,!1);break}this.handlePendingRender()});this.listenTo(this.model.listrawState,"change:isModalized",function(model,value){this.model.state.set("isModalized",value)});this.listenTo(this.model.tableState,"change:isModalized",function(model,value){this.model.state.set("isModalized",value)});this.listenTo(this.model.state,"change:isModalized",this.handlePendingRender);this.listenTo(this.model.intentions,"change",function(){this.model.state.trigger("unmodalize");this.model.report.entry.content.set("search",this.model.intentions.fullSearch())});this.listenTo(this.model.tableState,"drilldown",this.drilldownHandler);this.listenTo(this.model.listrawState,"drilldown",this.drilldownHandler);this.listenTo(this.model.report.entry.content,"change:display.events.type",function(model,value){var previousType=model.previousAttributes()["display.events.type"];("table"===value||"table"===previousType)&&this.manageStateOfChildren()});this.listenTo(this.model.state,"change:fieldpicker",function(){this.children.table&&this.children.table.updateTableHead()});this.listenTo(this.model.report.entry.content,"change:display.page.search.showFields",function(){this.children.table.updateTableHead();this.children.listraw.updateTableHead()});this.listenTo(this.model.report.entry.content,"change:display.prefs.events.offset",function(){if(this.options.scrollToTopOnPagination){var containerTop=this.$el.offset().top,currentScrollPos=$(document).scrollTop(),headerHeight=this.$el.children(":visible").find("thead:visible").height(),eventControlsHeight=$(".events-controls-inner").height();currentScrollPos>containerTop&&$(document).scrollTop(containerTop-(headerHeight+eventControlsHeight))}})},activate:function(options){var clonedOptions=_.extend({},options||{});delete clonedOptions.deep;if(this.active)return BaseView.prototype.activate.call(this,clonedOptions);this.model._result.setFromSplunkD(this.model.result.responseText?JSON.parse(this.model.result.responseText):{});BaseView.prototype.activate.call(this,clonedOptions);this.manageStateOfChildren(clonedOptions);return this},deactivate:function(){if(!this.active)return BaseView.prototype.deactivate.apply(this,arguments);if(this.model.state.get("isModalized")){this.model.state.trigger("unmodalize");this.model.state.set("isModalized",!1)}BaseView.prototype.deactivate.apply(this,arguments);this.model._result.clear();this.model.intentions.clear();this.model.listrawState.clear();this.model.tableState.clear();return this},drilldownHandler:function(drilldownInfo){var drilldown=this.getDrilldownCallback(drilldownInfo.data,drilldownInfo.noFetch);this.options.defaultDrilldown&&drilldown();this.trigger("drilldown",drilldownInfo,drilldown)},getDrilldownCallback:function(data,noFetch){var that=this;return function(){if(noFetch){that.model.state.trigger("unmodalize");that.model.report.entry.content.set(data);return $.Deferred().resolve()}return that.model.intentions.fetch({data:data})}},events:{"click .header-table-docked.disabled":function(e){this.model.state.trigger("unmodalize");e.preventDefault()}},handlePendingRender:function(){if(this.model.state.get("pendingRender")){var responseText=this.model.result.responseText?JSON.parse(this.model.result.responseText):{};this.model._result.setFromSplunkD(responseText,{clone:!0});this.model.state.set("pendingRender",!1)}},getType:function(){var type=this.model.report.entry.content.get("display.events.type");return"table"===type?"table":"listraw"},manageStateOfChildren:function(options){options||(options={});var type=this.getType();options.stopRender||this._render(type);switch(type){case"listraw":this.children.listraw.activate({deep:!0}).$el.show();
this.children.table.deactivate({deep:!0}).$el.hide();break;case"table":this.children.listraw.deactivate({deep:!0}).$el.hide();this.children.table.activate({deep:!0}).$el.show();break;default:this.children.listraw.deactivate({deep:!0}).$el.hide();this.children.table.deactivate({deep:!0}).$el.hide()}},updateTableHead:function(){this.children[this.getType()].updateTableHead()},updateContainerHeight:function(height){this.children[this.getType()].updateContainerHeight(height)},_render:function(type){if(!this.rendered[type]){this.children[type].render().appendTo(this.$el);this.rendered[type]=!0}},render:function(){this._render(this.getType());return this}})});requirejs.s.contexts._.nextTick=function(f){f()};require(["css"],function(css){css.addBuffer("splunkjs/css/events-viewer.css")});requirejs.s.contexts._.nextTick=requirejs.nextTick;define("splunkjs/mvc/eventsviewerview",["require","exports","module","jquery","underscore","splunk.util","collections/search/SelectedFields","collections/services/configs/EventRenderers","collections/services/data/ui/WorkflowActions","models/search/Job","models/services/search/jobs/Result","splunk.config","models/services/search/jobs/Summary","util/console","views/shared/eventsviewer/Master","./basesplunkview","./messages","./mvc","./paginatorview","./utils","./sharedmodels","util/general_utils","./tokenawaremodel","models/search/Report","./drilldown","css!../css/events-viewer"],function(require){var $=require("jquery"),_=require("underscore"),SplunkUtil=require("splunk.util"),SelectedFieldsCollection=require("collections/search/SelectedFields"),EventRenderersCollection=require("collections/services/configs/EventRenderers"),WorkflowActionsCollection=require("collections/services/data/ui/WorkflowActions"),SearchJobModel=require("models/search/Job"),ResultModel=require("models/services/search/jobs/Result"),splunkConfig=require("splunk.config"),SummaryModel=require("models/services/search/jobs/Summary"),EventsViewerMaster=(require("util/console"),require("views/shared/eventsviewer/Master")),BaseSplunkView=require("./basesplunkview"),Messages=require("./messages"),mvc=require("./mvc"),PaginatorView=require("./paginatorview"),Utils=require("./utils"),sharedModels=require("./sharedmodels"),GeneralUtils=require("util/general_utils"),TokenAwareModel=require("./tokenawaremodel"),ReportModel=require("models/search/Report"),Drilldown=require("./drilldown");require("css!../css/events-viewer");var fieldSplitterRegex=/(["'].*?["']|[^"',\s]+)(?=\s*|\s*,|\s*$)/g,quoteStripperRegex=/^["']|["|']$/g,EventsViewerView=BaseSplunkView.extend({className:"splunk-events-viewer",options:{managerid:null,data:"events",showPager:!0,pagerPosition:"bottom",drilldownRedirect:!0,maxCount:100},reportDefaults:{"display.events.fields":'["host", "source", "sourcetype"]',"display.events.type":"list","display.prefs.events.count":10,"display.events.rowNumbers":"1","display.events.maxLines":"5","display.events.histogram":"0","display.events.raw.drilldown":"full","display.events.list.wrap":"1","display.events.list.drilldown":"full","display.events.table.wrap":"1","display.events.table.drilldown":"1","display.events.table.sortDirection":"asc"},omitFromSettings:["el","id","name","manager","reportModel","displayRowNumbers","segmentation","softWrap"],normalizeOptions:function(settings,options){options.hasOwnProperty("rowNumbers")?GeneralUtils.isBooleanEquivalent(options.rowNumbers)?settings.set("rowNumbers",GeneralUtils.normalizeBoolean(options.rowNumbers)?"1":"0"):settings.set("rowNumbers",options.rowNumbers):options.hasOwnProperty("displayRowNumbers")&&settings.set("rowNumbers",SplunkUtil.normalizeBoolean(options.displayRowNumbers)?"1":"0");options.hasOwnProperty("drilldown")&&this._applyDrilldownType(options.drilldown,settings);options.hasOwnProperty("raw.drilldown")?settings.set("raw.drilldown",options["raw.drilldown"]):options.hasOwnProperty("segmentation")&&!options.hasOwnProperty("drilldown")&&settings.set("raw.drilldown",options.segmentation);options.hasOwnProperty("list.drilldown")?settings.set("list.drilldown",options["list.drilldown"]):options.hasOwnProperty("segmentation")&&!options.hasOwnProperty("drilldown")&&settings.set("list.drilldown",options.segmentation);if(options.hasOwnProperty("table.drilldown")){var drilldown=options["table.drilldown"];"all"===drilldown?drilldown=!0:"none"===drilldown&&(drilldown=!1);GeneralUtils.isBooleanEquivalent(drilldown)?settings.set("table.drilldown",GeneralUtils.normalizeBoolean(drilldown)?"1":"0"):settings.set("table.drilldown",drilldown)}else options.hasOwnProperty("segmentation")&&settings.set("table.drilldown","none"!==options.segmentation?"1":"0");options.hasOwnProperty("list.wrap")?GeneralUtils.isBooleanEquivalent(options["list.wrap"])?settings.set("list.wrap",GeneralUtils.normalizeBoolean(options["list.wrap"])?"1":"0"):settings.set("list.wrap",options["list.wrap"]):options.hasOwnProperty("softWrap")&&settings.set("list.wrap",SplunkUtil.normalizeBoolean(options.softWrap)?"1":"0");options.hasOwnProperty("table.wrap")?GeneralUtils.isBooleanEquivalent(options["table.wrap"])?settings.set("table.wrap",GeneralUtils.normalizeBoolean(options["table.wrap"])?"1":"0"):settings.set("table.wrap",options["table.wrap"]):options.hasOwnProperty("softWrap")&&settings.set("table.wrap",SplunkUtil.normalizeBoolean(options.softWrap)?"1":"0");options.hasOwnProperty("count")||settings.has("count")||settings.set("count",this.reportDefaults["display.prefs.events.count"]);options.hasOwnProperty("maxLines")||settings.has("maxLines")?settings.set("maxLines",settings.get("maxLines").toString()):settings.set("maxLines",this.reportDefaults["display.events.count"].toString())},initialize:function(options){this.configure();this.model=this.options.reportModel||TokenAwareModel._createReportModel(this.reportDefaults);this.settings._sync=Utils.syncModels({source:this.settings,dest:this.model,prefix:"display.events.",include:["fields","type","count","rowNumbers","maxLines","raw.drilldown","list.drilldown","list.wrap","table.drilldown","table.wrap","table.sortDirection","table.sortColumn"],exclude:["drilldownRedirect","managerid"],auto:!0,alias:{count:"display.prefs.events.count"}});this.settings.on("change",this.onSettingsChange,this);this.model.on("change",this.onReportChange,this);this.normalizeOptions(this.settings,options);this.resultModel=new ResultModel;this.summaryModel=new SummaryModel;this.searchJobModel=new SearchJobModel;this.reportModel=new ReportModel;this.reportModel._syncPush=Utils.syncModels({source:this.model,dest:this.reportModel.entry.content,tokens:!1,auto:"push"});this.reportModel._syncPull=Utils.syncModels({source:this.model,dest:this.reportModel.entry.content,tokens:!1,include:["display.events.table.sortColumn","display.events.table.sortDirection"],auto:"pull"});this.listenTo(this.reportModel,"eventsviewer:drilldown",this.handleMiscDrilldown);this.applicationModel=sharedModels.get("app");this.selectedFieldsCollection=new SelectedFieldsCollection;this.workflowActionsCollection=new WorkflowActionsCollection;this.workflowActionsCollection.fetch({data:{app:this.applicationModel.get("app"),owner:this.applicationModel.get("owner"),count:-1,sort_key:"name"},success:_.bind(function(){this._isWorkflowActionsCollectionReady=!0;this.render()},this)});this.eventRenderersCollection=new EventRenderersCollection;this.eventRenderersCollection.fetch({success:_.bind(function(){this._isEventRenderersCollectionReady=!0;this.render()},this)});this._lastJobFetched=null;this.updateSelectedFields();this.bindToComponentSetting("managerid",this.onManagerChange,this);this.eventsViewer=new EventsViewerMaster({model:{result:this.resultModel,summary:this.summaryModel,searchJob:this.searchJobModel,report:this.reportModel,application:this.applicationModel},collection:{selectedFields:this.selectedFieldsCollection,workflowActions:this.workflowActionsCollection,eventRenderers:this.eventRenderersCollection},selectableFields:!1,headerMode:"none",allowRowExpand:!0,defaultDrilldown:!1});this.listenTo(this.eventsViewer,"drilldown",this.emitDrilldownEvent);this.manager||this.onManagerChange(mvc.Components,null)},onManagerChange:function(ctxs,manager){if(this.manager){this.manager.off(null,null,this);this.manager=null}if(this.eventData){this.eventData.off();this.eventData.destroy();this.eventData=null}if(this.summaryData){this.summaryData.off();this.summaryData.destroy();this.summaryData=null}this._searchStatus=null;this._eventCount=0;this._isSummaryModelReady=!1;this._isSearchJobModelReady=!1;this._lastJobFetched=null;this.resultModel.setFromSplunkD({});this.summaryModel.setFromSplunkD({});if(manager){this._searchStatus={state:"start"};this.manager=manager;this.manager.on("search:start",this.onSearchStart,this);this.manager.on("search:progress",this.onSearchProgress,this);this.manager.on("search:done",this.onSearchDone,this);this.manager.on("search:cancelled",this.onSearchCancelled,this);this.manager.on("search:refresh",this.onSearchRefreshed,this);this.manager.on("search:error",this.onSearchError,this);this.manager.on("search:fail",this.onSearchFailed,this);this.eventData=this.manager.data("events",{autofetch:!1,output_mode:"json",truncation_mode:"abstract"});this.eventData.on("data",this.onEventData,this);this.eventData.on("error",this.onSearchError,this);this.summaryData=this.manager.data("summary",{autofetch:!1,output_mode:"json",top_count:10,output_time_format:"%d/%m/%y %l:%M:%S.%Q %p"});this.summaryData.on("data",this.onSummaryData,this);this.summaryData.on("error",this._onSummaryError,this);var content=this.manager.get("data");if(content&&content.eventAvailableCount){this.onSearchStart(content);this.onSearchProgress({content:content});content.isDone&&this.onSearchDone({content:content})}else this.render();manager.replayLastSearchEvent(this)}else{this._searchStatus={state:"nomanager"};this.render()}},_fetchJob:function(job){this._isRealTimeSearch=job.isRealTimeSearch;if(this._lastJobFetched!==job.sid||!this._isSearchJobModelReady){this._lastJobFetched=job.sid;this.searchJobModel.set("id",job.sid);var state=this.manager.job.state();if(0===_(state).size())return;this.searchJobModel.setFromSplunkD({entry:[state]});if(!this._isSearchJobModelReady){this._isSearchJobModelReady=!0;this.render()}}},onSearchStart:function(job){this._searchStatus={state:"running"};this._eventCount=0;this._statusBuckets=void 0;this._lastJobFetched=null;this._isSummaryModelReady=!1;this._isSearchJobModelReady=!1;this.resultModel.setFromSplunkD({});this.summaryModel.setFromSplunkD({});this._fetchJob(job);this.render()},onSearchProgress:function(properties){this._searchStatus={state:"running"};properties=properties||{};var job=properties.content||{},eventCount=job.eventAvailableCount||0,statusBuckets=this._statusBuckets=job.statusBuckets||0,searchString=properties.name,isRealTimeSearch=job.isRealTimeSearch;this._fetchJob(job);if(searchString){searchString=SplunkUtil.stripLeadingSearchCommand(searchString);this.reportModel.entry.content.set("search",searchString,{silent:!0})}this._eventCount=eventCount;eventCount>0&&this.updateEventData();(statusBuckets>0||isRealTimeSearch)&&this.updateSummaryData();this.render()},onSearchDone:function(properties){this._searchStatus={state:"done"};properties=properties||{};var job=properties.content||{},eventCount=job.eventAvailableCount||0;this._fetchJob(job);this._eventCount=eventCount;this.updateEventData();this.updateSummaryData();this.render()},onSearchCancelled:function(){this._searchStatus={state:"cancelled"};this.render()},onSearchRefreshed:function(){this._searchStatus={state:"refresh"};this.render()},onSearchError:function(message,err){var msg=Messages.getSearchErrorMessage(err)||message;this._searchStatus={state:"error",message:msg};this.render()},onSearchFailed:function(state){var msg=Messages.getSearchFailureMessage(state);this._searchStatus={state:"error",message:msg};this.render()},onEventData:function(model,data){this.resultModel.setFromSplunkD(data);this.render()},onSummaryData:function(model,data){this.summaryModel.setFromSplunkD(data);if(!this._isSummaryModelReady){this._isSummaryModelReady=!0;this.render()}},_onSummaryError:function(message,err){this.onSearchError(message,err)},onSettingsChange:function(model){model.hasChanged("fields")&&this.updateSelectedFields();(model.hasChanged("showPager")||model.hasChanged("pagerPosition")||model.hasChanged("count")||model.hasChanged("fields"))&&this.render();(model.hasChanged("showPager")||model.hasChanged("type")||model.hasChanged("count")||model.hasChanged("maxLines")||model.hasChanged("raw.drilldown")||model.hasChanged("table.drilldown")||model.hasChanged("list.drilldown"))&&this.updateEventData();if(model.hasChanged("drilldown"))this._applyDrilldownType(model.get("drilldown"),model);else if(model.hasChanged("table.drilldown")||model.hasChanged("raw.drilldown")||model.hasChanged("list.drilldown")){var segmentation=this.options.segmentation,checkSetting=_.bind(function(settings,value,name){return settings.get(name+".drilldown")===value},null,this.settings);_({table:"1",raw:segmentation||"full",list:segmentation||"full"}).all(checkSetting)?this.settings.set("drilldown","all"):_({table:"0",raw:"none",list:"none"}).all(checkSetting)?this.settings.set("drilldown","none"):this.settings.unset("drilldown")}},_applyDrilldownType:function(type,settings){if("all"===type){var segmentation=this.options.segmentation||"full";settings.set({"raw.drilldown":segmentation,"list.drilldown":segmentation,"table.drilldown":"1"})}else"none"===type&&settings.set({"raw.drilldown":"none","list.drilldown":"none","table.drilldown":"0"});type&&settings.set("drilldown",type,{silent:!0})},onReportChange:function(model){(model.hasChanged("display.events.table.sortColumn")||model.hasChanged("display.events.table.sortDirection"))&&this.updateEventData()},emitDrilldownEvent:function(e,defaultDrilldown){var displayType=this.model.get("display.events.type"),drilldownMode=this.settings.get(displayType+".drilldown");if("none"!==drilldownMode&&("table"!==displayType||SplunkUtil.normalizeBoolean(drilldownMode)!==!1)){var field=e.data.field,value=e.data.value;if(void 0===field&&"addterm"===e.data.action)field="_raw";else if(void 0===field&&e._time){field="_time";value=SplunkUtil.getEpochTimeFromISO(e._time)}var data={"click.name":field,"click.value":value,"click.name2":field,"click.value2":value},idx=e.idx;if(void 0!==idx&&idx>=0){var event=this.resultModel.results.at(idx).toJSON();if(event){_.each(event,function(value,field){data["row."+field]=value.length>1?value.join(","):value[0]});var earliest=SplunkUtil.getEpochTimeFromISO(event._time);data.earliest=earliest;data.latest=String(parseFloat(earliest)+1)}}var defaultDrilldownCallback=_.bind(this._onIntentionsApplied,this,e),reportModel=this.model,payload=Drilldown.createEventPayload({field:field,data:data,event:e},function(){var searchAttributes=_.pick(reportModel.toJSON({tokens:!0}),"search","dispatch.earliest_time","dispatch.latest_time");defaultDrilldown().done(defaultDrilldownCallback).always(function(){reportModel.set(searchAttributes,{tokens:!0,silent:!0})})});this.trigger("drilldown click",payload,this);this.settings.get("drilldownRedirect")&&!payload.defaultPrevented()&&payload.drilldown()}},_onIntentionsApplied:function(e){var model=this.reportModel.entry.content,search=model.get("search"),timeRange={earliest:model.get("dispatch.earliest_time"),latest:model.get("dispatch.latest_time")};timeRange.earliest===this.manager.get("earliest_time")&&timeRange.latest===this.manager.get("latest_time")&&(timeRange=Drilldown.getNormalizedTimerange(this.manager));var data=_.extend({q:search},timeRange),preventRedirect=!1;this.trigger("drilldown:redirect",{data:data,preventDefault:function(){preventRedirect=!0}});if(!preventRedirect){var drilldownFunction=splunkConfig.ON_DRILLDOWN||Drilldown.redirectToSearchPage;drilldownFunction(data,e.event.ctrlKey||e.event.metaKey)}},handleMiscDrilldown:function(){var drilldownFunction=splunkConfig.ON_DRILLDOWN||Drilldown.redirectToSearchPage,data={q:this.reportModel.entry.content.get("search"),earliest:this.reportModel.entry.content.get("dispatch.earliest_time")||"",latest:this.reportModel.entry.content.get("dispatch.latest_time")||""};drilldownFunction(data)},onPageChange:function(){this.updateEventData()},updateEventData:function(){if(this.eventData){var pageSize=this.paginator?parseInt(this.paginator.settings.get("pageSize"),10):0,page=this.paginator?parseInt(this.paginator.settings.get("page"),10):0,type=this.settings.get("type"),offset=pageSize*page,count=parseInt(this.settings.get("count"),10)||this.reportDefaults["display.prefs.events.count"],postProcessSearch=_.isFunction(this.manager.query.postProcessResolve)?this.manager.query.postProcessResolve():"";this._isRealTimeSearch&&!postProcessSearch&&(offset=0-count-offset);var maxLines=this.settings.get("maxLines").toString(),rawDrilldown=this.settings.get("raw.drilldown"),listDrilldown=this.settings.get("list.drilldown"),tableSortColumn=this.model.get("display.events.table.sortColumn"),tableSortDirection=this.model.get("display.events.table.sortDirection"),segmentation=null,search=null;count=count>this.options.maxCount||1>count?this.reportDefaults["display.prefs.events.count"]:count;"raw"===type?segmentation=rawDrilldown:"list"===type&&(segmentation=listDrilldown);segmentation=segmentation?segmentation.toLowerCase():null;switch(segmentation){case"inner":case"outer":case"full":case"none":break;default:segmentation="full"}"table"===type&&tableSortColumn&&(search="desc"===tableSortDirection?"| sort "+(offset+count)+" - "+tableSortColumn:"| sort "+(offset+count)+" "+tableSortColumn);var fields=JSON.parse(this.settings.get("fields"));fields=_.union(fields,["_raw","_time","_audit","_decoration","eventtype","linecount","_fulllinecount"]);this._isRealTimeSearch&&(fields=_.union(fields,["_serial","splunk_server"]));this.eventData.set({offset:offset,count:count,max_lines:maxLines,segmentation:segmentation,search:search,fields:fields});this.eventData.fetch()}},updateSummaryData:function(){this.summaryData&&this.summaryData.fetch()},updateSelectedFields:function(){var fields=this.settings.get("fields");if(fields){if(_.isString(fields)){fields=$.trim(fields);if("["===fields[0]&&"]"===fields.slice(-1))try{fields=JSON.parse(fields)}catch(e){}else{fields=_.map(fields.match(fieldSplitterRegex),function(field){return field.replace(quoteStripperRegex,"")});this.settings.set("fields",JSON.stringify(fields),{silent:!0})}}else this.settings.set("fields",JSON.stringify(fields),{silent:!0});fields=_.map(fields,function(field){return{name:field}});(0===fields.length||"*"===fields[0].name)&&(fields=_.filter(this.resultModel.fields.toJSON(),function(field){return"_"!==field.name.charAt(0)}))}this.selectedFieldsCollection.reset(fields);this.updateEventData()},render:function(){var searchStatus=this._searchStatus||null,eventCount=this._eventCount||0,isSummaryModelReady=(void 0===this._statusBuckets||this._statusBuckets>0,this._isSummaryModelReady===!0),isSearchJobModelReady=this._isSearchJobModelReady===!0,isWorkflowActionsCollectionReady=this._isWorkflowActionsCollectionReady===!0,isEventRenderersCollectionReady=this._isEventRenderersCollectionReady===!0,areModelsReady=isSummaryModelReady&&isSearchJobModelReady&&isWorkflowActionsCollectionReady&&isEventRenderersCollectionReady,showPager=SplunkUtil.normalizeBoolean(this.settings.get("showPager")),pagerPosition=this.settings.get("pagerPosition"),count=parseInt(this.settings.get("count"),10)||this.reportDefaults["display.prefs.events.count"];count=count>this.options.maxCount||1>count?this.reportDefaults["display.prefs.events.count"]:count;var message=null;if(searchStatus)switch(searchStatus.state){case"nomanager":message="no-search";break;case"start":message="empty";break;case"running":0!==eventCount&&areModelsReady||(message="waiting");break;case"cancelled":message="cancelled";break;case"refresh":message="refresh";break;case"done":0===eventCount&&(message="no-events");break;case"error":message={level:"error",icon:"warning-sign",message:searchStatus.message}}if(message){this.messageElement||(this.messageElement=$('<div class="msg"></div>'));Messages.render(message,this.messageElement);this.$el.append(this.messageElement)}else if(this.messageElement){this.messageElement.remove();this.messageElement=null}if(areModelsReady&&searchStatus&&!message){if(this.eventsViewer&&!this._eventsViewerRendered){this._eventsViewerRendered=!0;this.eventsViewer.render();this.$el.append(this.eventsViewer.el)}this.eventsViewer.activate({deep:!0}).$el.show()}else this.eventsViewer&&this.eventsViewer.deactivate({deep:!0}).$el.hide();if(areModelsReady&&searchStatus&&!message&&showPager){if(!this.paginator){this.paginator=new PaginatorView({id:_.uniqueId(this.id+"-paginator")});this.paginator.settings.on("change:page",this.onPageChange,this)}this.paginator.settings.set({pageSize:count,itemCount:eventCount});"top"===pagerPosition?this.$el.prepend(this.paginator.el):this.$el.append(this.paginator.el)}else if(this.paginator){this.paginator.settings.off("change:page",this.onPageChange,this);this.paginator.remove();this.paginator=null}this.trigger("rendered",this);return this},remove:function(){if(this.eventsViewer){this.eventsViewer.deactivate({deep:!0});this.eventsViewer.remove();this.eventsViewer=null}if(this.paginator){this.paginator.settings.off("change:page",this.onPageChange,this);this.paginator.remove();this.paginator=null}if(this.eventData){this.eventData.off();this.eventData.destroy();this.eventData=null}if(this.summaryData){this.summaryData.off();this.summaryData.destroy();this.summaryData=null}if(this.settings){this.settings.off();this.settings._sync&&this.settings._sync.destroy()}if(this.reportModel){this.reportModel.off();this.reportModel._syncPush&&this.reportModel._syncPush.destroy();this.reportModel._syncPull&&this.reportModel._syncPull.destroy()}this.model&&this.model.off("change",this.onReportChange,this);BaseSplunkView.prototype.remove.call(this)}});return EventsViewerView});define("splunkjs/mvc/simplexml/element/event",["require","underscore","jquery","backbone","../../../mvc","./base","../../eventsviewerview","../mapper","util/console","splunk.util"],function(require){var _=require("underscore"),DashboardElement=(require("jquery"),require("backbone"),require("../../../mvc"),require("./base")),EventsViewer=require("../../eventsviewerview"),Mapper=require("../mapper"),SplunkUtil=(require("util/console"),require("splunk.util")),eventsPrefix="display.events.",EventMapper=Mapper.extend({tagName:"event",map:function(report,result,options){result.options.count=report.get("display.prefs.events.count",options);_(report.toJSON(options)).each(function(v,key){if(0===key.indexOf(eventsPrefix)){var value=report.get(key,options);_.isArray(value)&&(value=JSON.stringify(value));result.options[key.substring(eventsPrefix.length)]=null!=value?String(value):null}});result.options["table.drilldown"]&&(result.options["table.drilldown"]=SplunkUtil.normalizeBoolean(result.options["table.drilldown"])?"all":"none");result.removeOptions=["drilldown","segmentation"]}});Mapper.register("events:raw",EventMapper);Mapper.register("events:list",EventMapper);Mapper.register("events:table",EventMapper);var EventsVisualization=EventsViewer.extend({reportDefaults:{"display.general.type":"events","display.prefs.events.count":10},getResultsLinkOptions:function(){return{}}});DashboardElement.registerVisualization("events",EventsVisualization);DashboardElement.registerVisualization("events:raw",EventsVisualization);DashboardElement.registerVisualization("events:list",EventsVisualization);DashboardElement.registerVisualization("events:table",EventsVisualization);var EventElement=DashboardElement.extend({initialVisualization:"events"});return EventElement});define("views/shared/SingleValue",["jquery","underscore","module","views/Base","splunk.util","uri/route"],function($,_,module,Base,splunkUtil,route){var getStringRepresentation=function(label,formatted){if(_.isFunction(label))try{label=label(formatted)}catch(e){return""}return label};return Base.extend({moduleId:module.id,className:"single-value",initialize:function(){Base.prototype.initialize.apply(this,arguments);this.activate()},events:{"click a.single-drilldown":function(e){e.preventDefault();var target=$(e.currentTarget),resModel=this.model.searchResultsColumn,rowContext=_.object(_(resModel.get("fields")).map(function(f){return"row."+f}),_(resModel.get("columns")).pluck(0)),drilldownInfo={modifierKey:!(!e.ctrlKey&&!e.metaKey),name:target.data("field"),value:target.data("value"),rowContext:rowContext},specificEventNames=_(target.children("span").attr("class").split(" ")).map(function(cls){return"click:"+cls}).join(" ");this.trigger("click "+specificEventNames,drilldownInfo)}},startListening:function(){this.listenTo(this.model.state,"change:display.visualizations.singlevalue.beforeLabel change:display.visualizations.singlevalue.afterLabel change:display.visualizations.singlevalue.underLabel change:display.visualizations.singlevalue.additionalClass",this.render);this.listenTo(this.model.searchResultsColumn,"change",this.render)},getResultField:function(field){return this.getFieldValue(this.determineResultFieldName(field))},getFieldNames:function(){var fields=this.model.searchResultsColumn.get("fields");return fields&&0!==fields.length?_.isObject(fields[0])?_(fields).pluck("name"):$.extend([],fields):[]},setSeverity:function(){if(this.model.searchResultsColumn.get("fields")){var fields=_(this.model.searchResultsColumn.get("fields")).pluck("name"),i=fields.indexOf("range");i>-1&&this.$("span.single-result").addClass(this.model.searchResultsColumn.get("columns")[i][0])}},determineResultFieldName:function(configuredField){var fields=this.getFieldNames();return configuredField&&_(fields).contains(configuredField)?configuredField:_(fields).find(function(f){return"_time"===f||"_raw"===f||"_"!==f[0]})},getFieldValue:function(field,defaultValue){var fields=this.getFieldNames(),idx=_(fields).indexOf(field),columns=this.model.searchResultsColumn.get("columns")||[],column=columns[idx];return column&&column.length?column[0]:defaultValue},render:function(){this._originalClass||(this._originalClass=this.$el.attr("class"));var resultField=this.determineResultFieldName(this.model.state.get("display.visualizations.singlevalue.field")),resultFieldValue=this.getFieldValue(resultField,_("N/A").t()),html=this.compiledTemplate({result:resultFieldValue,beforeLabel:getStringRepresentation(this.model.state.get("display.visualizations.singlevalue.beforeLabel")||"",resultFieldValue),afterLabel:getStringRepresentation(this.model.state.get("display.visualizations.singlevalue.afterLabel")||"",resultFieldValue),underLabel:getStringRepresentation(this.model.state.get("display.visualizations.singlevalue.underLabel")||"",resultFieldValue)}),cls=[this._originalClass,this.model.state.get("display.visualizations.singlevalue.additionalClass"),this.getResultField(this.model.state.get("display.visualizations.singlevalue.classField"))];this.$el.attr("class",cls.join(" "));this.$el.html(html);this.wrapLinks(resultField,resultFieldValue);this.setSeverity();return this},wrapLinks:function(field,value){if(this.model.application){var linkFields=this.model.state.get("display.visualizations.singlevalue.linkFields");linkFields=linkFields?$.trim(linkFields).split(/\s*,\s*/):[];var link,linkView=this.model.state.get("display.visualizations.singlevalue.linkView"),linkSearch=this.model.state.get("display.visualizations.singlevalue.linkSearch"),drilldown=this.model.state.get("display.visualizations.singlevalue.drilldown")||"none",app=this.model.application.toJSON(),LINK_FIELDS={beforelabel:".before-label",afterlabel:".after-label",underlabel:".under-label",result:".single-result"};if("search"!==linkView&&linkFields.length||linkSearch){var url;if(linkView){var params=linkSearch?{q:linkSearch}:void 0;url="/"===linkView.charAt(0)?splunkUtil.make_full_url(linkView,params):route.page(app.root,app.locale,app.app,linkView,{data:params})}else url=route.search(app.root,app.locale,app.app,{data:{q:linkSearch}});link=$("<a />").attr("href",url)}else if("none"!==drilldown){link=$('<a class="single-drilldown" href="#"></a>');_(linkFields).contains("result")||linkFields.push("result")}if(link){link.data({field:field,value:value});var el=this.$el;_(linkFields).each(function(lf){var cls=LINK_FIELDS[lf];cls&&el.children(cls).wrap(link)})}}},template:'                <span class="before-label">                    <%- beforeLabel %>                </span>                <span class="single-result">                    <%- result %>                </span>                <span class="after-label">                    <%- afterLabel %>                </span>                <br>                <span class="under-label">                    <%- underLabel %>                </span>            '})});requirejs.s.contexts._.nextTick=function(f){f()};require(["css"],function(css){css.addBuffer("splunkjs/css/single-value.css")});requirejs.s.contexts._.nextTick=requirejs.nextTick;define("splunkjs/mvc/singleview",["require","exports","module","underscore","jquery","./mvc","./basesplunkview","views/shared/SingleValue","backbone","./utils","./messages","./tokenawaremodel","./sharedmodels","./drilldown","css!../css/single-value"],function(require,exports,module){var $=(require("underscore"),require("jquery")),mvc=require("./mvc"),BaseSplunkView=require("./basesplunkview"),SingleValue=require("views/shared/SingleValue"),Backbone=require("backbone"),Utils=require("./utils"),Messages=require("./messages"),TokenAwareModel=require("./tokenawaremodel"),SharedModels=require("./sharedmodels"),Drilldown=require("./drilldown");require("css!../css/single-value");var SingleView=BaseSplunkView.extend({moduleId:module.id,className:"splunk-single",options:{data:"preview",beforeLabel:"",afterLabel:"",field:"",classField:"",linkView:"search",drilldownRedirect:!0},omitFromSettings:["el","reportModel"],initialize:function(){this.configure();this.model=this.options.reportModel||TokenAwareModel._createReportModel();this.settings._sync=Utils.syncModels(this.settings,this.model,{auto:!0,prefix:"display.visualizations.singlevalue.",include:["additionalClass","linkView","field","linkFields","classField","beforeLabel","afterLabel","underLabel","linkSearch","drilldown"]});this.settings.set("drilldown",Drilldown.getNormalizedDrilldownType(this.settings.get("drilldown"),{"default":"none"}));this.results=new Backbone.Model({columns:[],fields:[]});this.reportModel=TokenAwareModel._createReportModel();this.reportModel._sync=Utils.syncModels(this.model,this.reportModel,{auto:"push",tokens:!0});this.singleValue=new SingleValue({model:{searchResultsColumn:this.results,state:this.reportModel,application:SharedModels.get("app")}});this.listenTo(this.singleValue,"click",this.emitDrilldownEvent);this.bindToComponentSetting("managerid",this._onManagerChange,this);this.settings.on("change",this.render,this);this.manager||this._onManagerChange(mvc.Components,null)},emitDrilldownEvent:function(e){var manager=this.manager,payload=Drilldown.createEventPayload({field:e.name2||e.name,data:Drilldown.normalizeDrilldownEventData(e,{contextProperty:"rowContext",manager:manager}),event:e},function(){Drilldown.autoDrilldown(e,manager,{sync:e.modifierKey})});this.trigger("drilldown click",payload,this);this.settings.get("drilldownRedirect")&&!payload.defaultPrevented()&&payload.drilldown()},_onManagerChange:function(managers,manager){if(this.manager){this.manager.off(null,null,this);this.manager=null}if(this.resultsModel){this.resultsModel.off(null,null,this);this.resultsModel=null}this._searchStatus=null;this._clearResults();if(manager){this._searchStatus={state:"start"};this.manager=manager;manager.on("search:start search:progress",this.onSearchProgress,this);manager.on("search:done",this.onSearchDone,this);manager.on("search:error",this.onSearchError,this);
manager.on("search:fail",this.onSearchFailed,this);this.resultsModel=this.manager.data(this.settings.get("data"),{output_mode:"json_cols",count:1,offset:0,show_empty_fields:"True"});this.resultsModel.on("data",this._onDataUpdate,this);this.resultsModel.on("error",this.onSearchError,this);var replayed=manager.replayLastSearchEvent(this);replayed||this.render()}else{this._searchStatus={state:"nomanager"};this.render()}},onSearchProgress:function(properties){var previewCount=((properties||{}).content||{}).resultPreviewCount||0;this._searchStatus={state:"running",previewCount:previewCount};this.render()},onSearchDone:function(properties){var previewCount=((properties||{}).content||{}).resultPreviewCount||0;this._searchStatus={state:"done",previewCount:previewCount};this.render()},onSearchError:function(message,err){var msg=Messages.getSearchErrorMessage(err)||message;this._searchStatus={state:"error",message:msg};this.render()},onSearchFailed:function(state){var msg=Messages.getSearchFailureMessage(state);this._searchStatus={state:"error",message:msg};this.render()},_clearResults:function(){this.results.set({columns:null,fields:null},{unset:!0})},_onDataUpdate:function(){if(this.resultsModel.hasData())this.results.set({columns:this.resultsModel.data().columns,fields:this.resultsModel.data().fields});else{this._clearResults();this._searchStatus&&(this._searchStatus.previewCount=0)}this.render()},render:function(){var searchStatus=this._searchStatus||null,haveResults=searchStatus&&searchStatus.previewCount,resultsLoaded=haveResults&&this.resultsModel&&this.resultsModel.hasData(),message=null;if(searchStatus)switch(searchStatus.state){case"nomanager":message="no-search";break;case"start":message="empty";break;case"running":haveResults||(message="waiting");break;case"cancelled":message="cancelled";break;case"done":haveResults?resultsLoaded||(message="waiting"):message="no-results";break;case"error":message={level:"error",icon:"warning-sign",message:searchStatus.message}}if(message){this.messageElement||(this.messageElement=$('<div class="msg"></div>'));"waiting"===message?this.messageElement.addClass("waiting").html('<div class="single-value"><span class="single-result">&hellip;</span></div>'):"no-results"===message?this.messageElement.addClass("no-results").html('<div class="single-value"><span class="single-result">N/A</span></div>'):Messages.render(message,this.messageElement.removeClass("waiting"));this.$el.append(this.messageElement)}else if(this.messageElement){this.messageElement.remove();this.messageElement=null}searchStatus&&resultsLoaded&&!message?this.singleValue.activate().render().appendTo(this.el):this.singleValue&&this.singleValue.deactivate().$el.detach();this.trigger("rendered",this);return this},remove:function(){this.singleValue&&this.singleValue.remove();if(this.reportModel){this.reportModel._sync&&this.reportModel._sync.destroy();this.reportModel.off()}if(this.settings){this.settings.off();this.settings._sync&&this.settings._sync.destroy()}BaseSplunkView.prototype.remove.call(this)}});return SingleView});define("splunkjs/mvc/simplexml/element/single",["require","underscore","../../../mvc","./base","../../singleview","../mapper","util/console","../../drilldown"],function(require){var _=require("underscore"),DashboardElement=(require("../../../mvc"),require("./base")),SingleView=require("../../singleview"),Mapper=require("../mapper"),console=require("util/console"),Drilldown=require("../../drilldown");Mapper.register("visualizations:singlevalue",Mapper.extend({tagName:"single",map:function(report,result,options){var prefix="display.visualizations.singlevalue.";console.log(report.toJSON(options));_(report.toJSON(options)).each(function(v,k){k.substring(0,prefix.length)===prefix&&(result.options[k.substring(prefix.length)]=v)});console.log("single export options: ",result.options);result.options.drilldown=Drilldown.getNormalizedDrilldownType(result.options.drilldown,{"default":"none"})}}));var SingleViz=SingleView.extend({panelClassName:"single",reportDefaults:{"display.visualizations.show":!0,"display.visualizations.type":"singlevalue","display.general.type":"visualizations"},getResultsLinkOptions:function(){return{"link.visible":!1}}});DashboardElement.registerVisualization("visualizations:singlevalue",SingleViz);var SingleElement=DashboardElement.extend({initialVisualization:"visualizations:singlevalue"});return SingleElement});jg_import.define("jgatt.events.EventData",function(){jg_namespace("jgatt.events",function(){this.EventData=jg_extend(Object,function(){this.event=null;this.target=null;this.currentEvent=null;this.currentTarget=null;this._isPropagationStopped=!1;this._isImmediatePropagationStopped=!1;this._isDefaultPrevented=!1;this.constructor=function(){};this.stopPropagation=function(){this._isPropagationStopped=!0};this.stopImmediatePropagation=function(){this._isPropagationStopped=!0;this._isImmediatePropagationStopped=!0};this.preventDefault=function(){this._isDefaultPrevented=!0};this.isPropagationStopped=function(){return this._isPropagationStopped};this.isImmediatePropagationStopped=function(){return this._isImmediatePropagationStopped};this.isDefaultPrevented=function(){return this._isDefaultPrevented}})})});jg_import.define("jgatt.utils.TypeUtils",function(){jg_namespace("jgatt.utils",function(){this.TypeUtils=jg_static(function(TypeUtils){TypeUtils.isTypeOf=function(value,type){if(null==value)return!1;if(type===Object)return!0;switch(typeof value){case"number":return type===Number;case"boolean":return type===Boolean;case"string":return type===String;default:return value instanceof type}};TypeUtils.isSubclassOf=function(c,type){return null!=c&&null!=c.prototype&&c.prototype instanceof type}})})});jg_import.define("jgatt.properties.Property",function(){jg_namespace("jgatt.properties",function(){var TypeUtils=jg_import("jgatt.utils.TypeUtils");this.Property=jg_extend(Object,function(Property){this._name=null;this._type=null;this._defaultValue=null;this._readOnly=!1;this._getter=null;this._setter=null;this._readFilter=null;this._writeFilter=null;this._onRead=null;this._onWrite=null;this.constructor=function(name,type,defaultValue,readOnly){if(null==name)throw new Error("Parameter name must be non-null.");if("string"!=typeof name)throw new Error("Parameter name must be a string.");if(null==type)throw new Error("Parameter type must be non-null.");if("function"!=typeof type)throw new Error("Parameter type must be a class.");this._name=name;this._type=type;defaultValue=this.assertType(defaultValue,"Parameter defaultValue is incompatible with property type.");if(null!=readOnly&&"boolean"!=typeof readOnly)throw new Error("Parameter readOnly must be a boolean.");this._defaultValue=defaultValue;this._readOnly=readOnly===!0};this.name=function(){return this._name};this.type=function(){return this._type};this.defaultValue=function(){return this._defaultValue};this.readOnly=function(){return this._readOnly};this.getter=function(value){if(0==arguments.length)return this._getter;if(null!=value&&"function"!=typeof value)throw new Error("Parameter getter must be a function.");this._getter=value?value:null;return this};this.setter=function(value){if(0==arguments.length)return this._setter;if(null!=value&&"function"!=typeof value)throw new Error("Parameter setter must be a function.");this._setter=value?value:null;return this};this.readFilter=function(value){if(0==arguments.length)return this._readFilter;if(null!=value&&"function"!=typeof value)throw new Error("Parameter readFilter must be a function.");this._readFilter=value?value:null;return this};this.writeFilter=function(value){if(0==arguments.length)return this._writeFilter;if(null!=value&&"function"!=typeof value)throw new Error("Parameter writeFilter must be a function.");this._writeFilter=value?value:null;return this};this.onRead=function(value){if(0==arguments.length)return this._onRead;if(null!=value&&"function"!=typeof value)throw new Error("Parameter onRead must be a function.");this._onRead=value?value:null;return this};this.onWrite=function(value){if(0==arguments.length)return this._onWrite;if(null!=value&&"function"!=typeof value)throw new Error("Parameter onWrite must be a function.");this._onWrite=value?value:null;return this};this.get=function(target,propertyMap){this._onRead&&this._onRead.call(target);var value=this.getInternal(target,propertyMap);if(this._readFilter){var value2=this._readFilter.call(target,value);value2!==value&&(value=this.assertType(value2,"Value returned from readFilter for property "+this._name+" is incompatible with property type."))}return value};this.set=function(target,propertyMap,value){if(this._readOnly)throw new Error("Property "+this._name+" is read-only.");value=this.assertType(value,"Value assigned to property "+this._name+" is incompatible with property type.");if(this._writeFilter){var value2=this._writeFilter.call(target,value);value2!==value&&(value=this.assertType(value2,"Value returned from writeFilter for property "+this._name+" is incompatible with property type."))}if(!this.setInternal(target,propertyMap,value))return!1;this._onWrite&&this._onWrite.call(target);return!0};this.getInternal=function(target,propertyMap){var propertyInfo=propertyMap.get(this);propertyInfo||(propertyInfo=propertyMap.set(this,this.createPropertyInfo(this,target)));var value=propertyInfo.value;if(this._getter){var value2=this._getter.call(target);value2!==value&&(value=propertyInfo.value=this.assertType(value2,"Value returned from getter for property "+this._name+" is incompatible with property type."))}return value};this.setInternal=function(target,propertyMap,value){value=this.assertType(value,"Value assigned to property "+this._name+" is incompatible with property type.");var propertyInfo=propertyMap.get(this);propertyInfo||(propertyInfo=propertyMap.set(this,this.createPropertyInfo(this,target)));this._setter&&this._setter.call(target,value);propertyInfo.value=value;return!0};this.assertType=function(value,message){var type=this._type;if(null!=value&&!TypeUtils.isTypeOf(value,type))throw new Error(message);null==value&&(value=type===Number?0:type===Boolean?!1:null);return value};this.createPropertyInfo=function(property,target){return new Property.PropertyInfo(property,target)}});this.Property.PropertyInfo=jg_extend(Object,function(){this.property=null;this.target=null;this.value=null;this.constructor=function(property,target){this.property=property;this.target=target;this.value=property._defaultValue}})})});jg_import.define("jgatt.utils.Dictionary",function(){jg_namespace("jgatt.utils",function(){this.Dictionary=jg_extend(Object,function(){var _HASH_KEY="__jgatt_utils_Dictionary_hash",_hashCount=0,_hash=function(value){if(null===value)return"null";switch(typeof value){case"object":case"function":if(value.hasOwnProperty(_HASH_KEY))return value[_HASH_KEY];var hash=value[_HASH_KEY]="#"+ ++_hashCount;return hash;case"string":return'"'+value+'"';default:return value+""}};this._kvs=null;this._size=0;this.constructor=function(){this._kvs={}};this.size=function(){return this._size};this.get=function(key){var hash=_hash(key);return this._kvs.hasOwnProperty(hash)?this._kvs[hash].v:void 0};this.set=function(key,value){var hash=_hash(key);if(this._kvs.hasOwnProperty(hash)){this._kvs[hash].v=value;return value}this._kvs[hash]={k:key,v:value};this._size++;return value};this.del=function(key){var hash=_hash(key);if(this._kvs.hasOwnProperty(hash)){var value=this._kvs[hash].v;delete this._kvs[hash];this._size--;return value}return void 0};this.has=function(key){var hash=_hash(key);return this._kvs.hasOwnProperty(hash)};this.keys=function(){var keys=[],kvs=this._kvs;for(var hash in kvs)kvs.hasOwnProperty(hash)&&keys.push(kvs[hash].k);return keys};this.values=function(){var values=[],kvs=this._kvs;for(var hash in kvs)kvs.hasOwnProperty(hash)&&values.push(kvs[hash].v);return values}})})});jg_import.define("jgatt.properties.MPropertyTarget",function(){jg_namespace("jgatt.properties",function(){var Property=jg_import("jgatt.properties.Property"),Dictionary=jg_import("jgatt.utils.Dictionary");this.MPropertyTarget=jg_static(function(){var _resolveProperty=function(target,property){if(null==property)throw new Error("Parameter property must be non-null.");if(property instanceof Property)return property;if("string"!=typeof property)throw new Error("Parameter property must be a string or an instance of jgatt.properties.Property.");var targetProperty=target[property];if(!(targetProperty instanceof Property))throw new Error('Unknown property "'+property+'".');return targetProperty};this._propertyMap=null;this.constructor=function(){this._propertyMap=new Dictionary};this.get=function(property){property=_resolveProperty(this,property);return property.get(this,this._propertyMap)};this.set=function(property,value){property=_resolveProperty(this,property);return property.set(this,this._propertyMap,value)};this.getInternal=function(property){property=_resolveProperty(this,property);return property.getInternal(this,this._propertyMap)};this.setInternal=function(property,value){property=_resolveProperty(this,property);return property.setInternal(this,this._propertyMap,value)}})})});jg_import.define("jgatt.utils.ErrorUtils",function(){jg_namespace("jgatt.utils",function(){this.ErrorUtils=jg_static(function(ErrorUtils){ErrorUtils.asyncThrow=function(e){setTimeout(function(){throw e},1)}})})});jg_import.define("jgatt.events.Event",function(){jg_namespace("jgatt.events",function(ns){var EventData=jg_import("jgatt.events.EventData"),MPropertyTarget=jg_import("jgatt.properties.MPropertyTarget"),Property=jg_import("jgatt.properties.Property"),Dictionary=jg_import("jgatt.utils.Dictionary"),ErrorUtils=jg_import("jgatt.utils.ErrorUtils"),TypeUtils=jg_import("jgatt.utils.TypeUtils");this.Event=jg_extend(Object,function(){var _listenerInfoComparator=function(info1,info2){return info1.priority>info2.priority?-1:info1.priority<info2.priority?1:info1.index<info2.index?-1:info2.index>info2.index?1:0};this._name=null;this._type=null;this._bubbles=!1;this._cancelable=!1;this.constructor=function(name,type,bubbles,cancelable){if(null==name)throw new Error("Parameter name must be non-null.");if("string"!=typeof name)throw new Error("Parameter name must be a string.");if(null==type)throw new Error("Parameter type must be non-null.");if("function"!=typeof type)throw new Error("Parameter type must be a class.");if(type!==EventData&&!TypeUtils.isSubclassOf(type,EventData))throw new Error("Parameter type must be a subclass of jgatt.events.EventData.");if(null!=bubbles&&"boolean"!=typeof bubbles)throw new Error("Parameter bubbles must be a boolean.");if(null!=cancelable&&"boolean"!=typeof cancelable)throw new Error("Parameter cancelable must be a boolean.");this._name=name;this._type=type;this._bubbles=bubbles===!0;this._cancelable=cancelable===!0};this.name=function(){return this._name};this.type=function(){return this._type};this.bubbles=function(){return this._bubbles};this.cancelable=function(){return this._cancelable};this.addEventListener=function(target,eventMap,listener,priority){if(null==listener)throw new Error("Parameter listener must be non-null.");if("function"!=typeof listener)throw new Error("Parameter listener must be a function.");if(null!=priority&&"number"!=typeof priority)throw new Error("Parameter priority must be a number.");(null==priority||isNaN(priority))&&(priority=0);var eventInfo=eventMap.get(this);eventInfo||(eventInfo=eventMap.set(this,{map:new Dictionary,list:null,index:0}));var listenerMap=eventInfo.map,listenerInfo=listenerMap.get(listener);if(listenerInfo){if(listenerInfo.priority===priority)return}else listenerInfo=listenerMap.set(listener,{listener:listener});listenerInfo.priority=priority;listenerInfo.index=eventInfo.index;eventInfo.list=null;eventInfo.index++};this.removeEventListener=function(target,eventMap,listener){if(null==listener)throw new Error("Parameter listener must be non-null.");if("function"!=typeof listener)throw new Error("Parameter listener must be a function.");var eventInfo=eventMap.get(this);if(eventInfo){var listenerMap=eventInfo.map;if(listenerMap.has(listener)){listenerMap.del(listener);eventInfo.list=null}}};this.hasEventListener=function(target,eventMap){var eventInfo=eventMap.get(this);return eventInfo?eventInfo.map.size()>0:!1};this.dispatchEvent=function(target,eventMap,eventData){if(null==eventData)throw new Error("Parameter eventData must be non-null.");if(!(eventData instanceof this._type))throw new Error("Parameter eventData is incompatible with event type.");if(eventData.isPropagationStopped())return!this._cancelable||!eventData.isDefaultPrevented();null==eventData.event&&(eventData.event=this);null==eventData.target&&(eventData.target=target);eventData.currentEvent=this;eventData.currentTarget=target;var eventInfo=eventMap.get(this);if(eventInfo){var listenerList=eventInfo.list;if(!listenerList){var listenerMap=eventInfo.map;if(listenerMap.size()>0){listenerList=eventInfo.list=listenerMap.values();listenerList.sort(_listenerInfoComparator)}}if(listenerList)for(var listenerInfo,i=0,l=listenerList.length;l>i;i++){listenerInfo=listenerList[i];try{eventData.currentEvent=this;eventData.currentTarget=target;listenerInfo.listener.call(target,eventData);if(eventData.isImmediatePropagationStopped())break}catch(e){ErrorUtils.asyncThrow(e)}}}if(this._bubbles&&!eventData.isPropagationStopped()){var parent=target.parent;null!=parent?parent instanceof Property&&jg_has_mixin(target,MPropertyTarget)&&(parent=target.get(parent)):parent=target.parentNode;null!=parent&&ns.MEventTarget&&jg_has_mixin(parent,ns.MEventTarget)&&parent.dispatchEvent(this,eventData)}return!this._cancelable||!eventData.isDefaultPrevented()}})})});jg_import.define("jgatt.events.ChainedEvent",function(){jg_namespace("jgatt.events",function(){var Event=jg_import("jgatt.events.Event"),TypeUtils=jg_import("jgatt.utils.TypeUtils");this.ChainedEvent=jg_extend(Event,function(ChainedEvent,base){this._parentEvent=null;this.constructor=function(name,parentEvent,type,bubbles,cancelable){if(null==parentEvent)throw new Error("Parameter parentEvent must be non-null.");if(!(parentEvent instanceof Event))throw new Error("Parameter parentEvent must be an instance of jgatt.events.Event.");var parentType=parentEvent._type;if(null==type)type=parentType;else{if("function"!=typeof type)throw new Error("Parameter type must be a class.");if(type!==parentType&&!TypeUtils.isSubclassOf(type,parentType))throw new Error("Parameter type must be a subclass of parentEvent type.")}base.constructor.call(this,name,type,bubbles,cancelable);this._parentEvent=parentEvent};this.parentEvent=function(){return this._parentEvent};this.dispatchEvent=function(target,eventMap,eventData){base.dispatchEvent.call(this,target,eventMap,eventData);eventData.isPropagationStopped()||this._parentEvent.dispatchEvent(target,eventMap,eventData);return!this._cancelable||!eventData.isDefaultPrevented()}})})});jg_import.define("jgatt.events.MEventTarget",function(){jg_namespace("jgatt.events",function(){var Event=jg_import("jgatt.events.Event"),Dictionary=jg_import("jgatt.utils.Dictionary");this.MEventTarget=jg_static(function(){var _resolveEvent=function(target,event){if(null==event)throw new Error("Parameter event must be non-null.");if(event instanceof Event)return event;if("string"!=typeof event)throw new Error("Parameter event must be a string or an instance of jgatt.events.Event.");var targetEvent=target._eventNameMap[event];if(!targetEvent){var eventPath=event.split(".");targetEvent=target;for(var i=0,l=eventPath.length;l>i;i++){targetEvent=targetEvent[eventPath[i]];if(null==targetEvent)break}if(!(targetEvent instanceof Event))throw new Error('Unknown event "'+event+'".');target._eventNameMap[event]=targetEvent}return targetEvent};this._eventMap=null;this._eventNameMap=null;this.constructor=function(){this._eventMap=new Dictionary;this._eventNameMap={}};this.addEventListener=function(event,listener,priority){event=_resolveEvent(this,event);event.addEventListener(this,this._eventMap,listener,priority)};this.removeEventListener=function(event,listener){event=_resolveEvent(this,event);event.removeEventListener(this,this._eventMap,listener)};this.hasEventListener=function(event){event=_resolveEvent(this,event);return event.hasEventListener(this,this._eventMap)};this.dispatchEvent=function(event,eventData){event=_resolveEvent(this,event);return event.dispatchEvent(this,this._eventMap,eventData)}})})});jg_import.define("jgatt.events.MObservable",function(){jg_namespace("jgatt.events",function(){var Event=jg_import("jgatt.events.Event"),EventData=jg_import("jgatt.events.EventData"),MEventTarget=jg_import("jgatt.events.MEventTarget");this.MObservable=jg_static(function(){this.mixin=function(base){base=jg_mixin(this,MEventTarget,base)};this.changed=new Event("changed",EventData)})})});jg_import.define("jgatt.geom.Point",function(){jg_namespace("jgatt.geom",function(){this.Point=jg_extend(Object,function(Point){this.x=0;this.y=0;this.constructor=function(x,y){this.x=void 0!==x?x:0;this.y=void 0!==y?y:0};this.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};this.hasNaN=function(){return isNaN(this.x)||isNaN(this.y)};this.hasInfinity=function(){return 1/0==this.x||this.x==-1/0||1/0==this.y||this.y==-1/0};this.hasPositiveInfinity=function(){return 1/0==this.x||1/0==this.y};this.hasNegativeInfinity=function(){return this.x==-1/0||this.y==-1/0};this.isFinite=function(){return this.x-this.x===0&&this.y-this.y===0};this.equals=function(point){return this.x==point.x&&this.y==point.y};this.clone=function(){return new Point(this.x,this.y)};this.toString=function(){return"("+this.x+", "+this.y+")"}})})});jg_import.define("jgatt.geom.Matrix",function(){jg_namespace("jgatt.geom",function(){var Point=jg_import("jgatt.geom.Point");this.Matrix=jg_extend(Object,function(Matrix){this.a=1;this.b=0;this.c=0;this.d=1;this.tx=0;this.ty=0;this.constructor=function(a,b,c,d,tx,ty){this.a=void 0!==a?a:1;this.b=void 0!==b?b:0;this.c=void 0!==c?c:0;this.d=void 0!==d?d:1;this.tx=void 0!==tx?tx:0;this.ty=void 0!==ty?ty:0};this.transformPoint=function(point){var x=this.a*point.x+this.c*point.y+this.tx,y=this.b*point.x+this.d*point.y+this.ty;return new Point(x,y)};this.translate=function(x,y){this.tx+=x;this.ty+=y};this.scale=function(scaleX,scaleY){this.a*=scaleX;this.b*=scaleY;this.c*=scaleX;this.d*=scaleY;this.tx*=scaleX;this.ty*=scaleY};this.rotate=function(angle){angle=angle/180*Math.PI;var cosAngle=Math.cos(angle),sinAngle=Math.sin(angle),a=this.a,b=this.b,c=this.c,d=this.d,tx=this.tx,ty=this.ty;this.a=a*cosAngle-b*sinAngle;this.b=b*cosAngle+a*sinAngle;this.c=c*cosAngle-d*sinAngle;this.d=d*cosAngle+c*sinAngle;this.tx=tx*cosAngle-ty*sinAngle;this.ty=ty*cosAngle+tx*sinAngle};this.skew=function(skewX,skewY){skewX=skewX/180*Math.PI;skewY=skewY/180*Math.PI;var tanSkewX=Math.tan(skewX),tanSkewY=Math.tan(skewY),a=this.a,b=this.b,c=this.c,d=this.d,tx=this.tx,ty=this.ty;this.a=a+b*tanSkewX;this.b=b+a*tanSkewY;this.c=c+d*tanSkewX;this.d=d+c*tanSkewY;this.tx=tx+ty*tanSkewX;this.ty=ty+tx*tanSkewY};this.concat=function(matrix){var a1=this.a,b1=this.b,c1=this.c,d1=this.d,tx1=this.tx,ty1=this.ty,a2=matrix.a,b2=matrix.b,c2=matrix.c,d2=matrix.d,tx2=matrix.tx,ty2=matrix.ty;this.a=a1*a2+b1*c2;this.b=b1*d2+a1*b2;this.c=c1*a2+d1*c2;this.d=d1*d2+c1*b2;this.tx=tx1*a2+ty1*c2+tx2;this.ty=ty1*d2+tx1*b2+ty2};this.invert=function(){var det=this.determinant(),a=this.a/det,b=this.b/det,c=this.c/det,d=this.d/det,tx=this.tx,ty=this.ty;this.a=d;this.b=-b;this.c=-c;this.d=a;this.tx=c*ty-d*tx;this.ty=b*tx-a*ty};this.identity=function(){this.a=1;this.b=0;this.c=0;this.d=1;this.tx=0;this.ty=0};this.determinant=function(){return this.a*this.d-this.b*this.c};this.hasInverse=function(){var det=Math.abs(this.determinant());return det>0&&1/0>det};this.hasNaN=function(){return isNaN(this.a)||isNaN(this.b)||isNaN(this.c)||isNaN(this.d)||isNaN(this.tx)||isNaN(this.ty)};this.hasInfinity=function(){return 1/0==this.a||this.a==-1/0||1/0==this.b||this.b==-1/0||1/0==this.c||this.c==-1/0||1/0==this.d||this.d==-1/0||1/0==this.tx||this.tx==-1/0||1/0==this.ty||this.ty==-1/0};this.hasPositiveInfinity=function(){return 1/0==this.a||1/0==this.b||1/0==this.c||1/0==this.d||1/0==this.tx||1/0==this.ty};this.hasNegativeInfinity=function(){return this.a==-1/0||this.b==-1/0||this.c==-1/0||this.d==-1/0||this.tx==-1/0||this.ty==-1/0};this.isFinite=function(){return this.a-this.a===0&&this.b-this.b===0&&this.c-this.c===0&&this.d-this.d===0&&this.tx-this.tx===0&&this.ty-this.ty===0};this.isIdentity=function(){return 1==this.a&&0==this.b&&0==this.c&&1==this.d&&0==this.tx&&0==this.ty};this.equals=function(matrix){return this.a==matrix.a&&this.b==matrix.b&&this.c==matrix.c&&this.d==matrix.d&&this.tx==matrix.tx&&this.ty==matrix.ty};this.clone=function(){return new Matrix(this.a,this.b,this.c,this.d,this.tx,this.ty)};this.toString=function(){return"("+this.a+", "+this.b+", "+this.c+", "+this.d+", "+this.tx+", "+this.ty+")"}})})});jg_import.define("jgatt.geom.Rectangle",function(){jg_namespace("jgatt.geom",function(){this.Rectangle=jg_extend(Object,function(Rectangle){this.x=0;this.y=0;this.width=0;this.height=0;this.constructor=function(x,y,width,height){this.x=void 0!==x?x:0;this.y=void 0!==y?y:0;this.width=void 0!==width?width:0;this.height=void 0!==height?height:0};this.hasNaN=function(){return isNaN(this.x)||isNaN(this.y)||isNaN(this.width)||isNaN(this.height)};this.hasInfinity=function(){return 1/0==this.x||this.x==-1/0||1/0==this.y||this.y==-1/0||1/0==this.width||this.width==-1/0||1/0==this.height||this.height==-1/0};this.hasPositiveInfinity=function(){return 1/0==this.x||1/0==this.y||1/0==this.width||1/0==this.height};this.hasNegativeInfinity=function(){return this.x==-1/0||this.y==-1/0||this.width==-1/0||this.height==-1/0};this.isFinite=function(){return this.x-this.x===0&&this.y-this.y===0&&this.width-this.width===0&&this.height-this.height===0};this.equals=function(rectangle){return this.x==rectangle.x&&this.y==rectangle.y&&this.width==rectangle.width&&this.height==rectangle.height};this.clone=function(){return new Rectangle(this.x,this.y,this.width,this.height)};this.toString=function(){return"("+this.x+", "+this.y+", "+this.width+", "+this.height+")"}})})});jg_import.define("jgatt.graphics.Caps",function(){jg_namespace("jgatt.graphics",function(){this.Caps=jg_static(function(Caps){Caps.NONE="none";Caps.ROUND="round";Caps.SQUARE="square"})})});jg_import.define("jgatt.utils.NumberUtils",function(){jg_namespace("jgatt.utils",function(){this.NumberUtils=jg_static(function(NumberUtils){NumberUtils.EPSILON=function(){for(var eps=1,temp=1;1+temp>1;){eps=temp;temp/=2}return eps}();NumberUtils.PRECISION=function(){for(var prec=0,temp=9;temp%10==9;){prec++;temp=10*temp+9}return prec}();NumberUtils.parseNumber=function(value){if(null==value)return 0/0;switch(typeof value){case"number":return value;case"string":return value?Number(value):0/0;case"boolean":return value?1:0}return 0/0};NumberUtils.toPrecision=function(n,precision){precision=void 0!==precision?precision:0;1>precision&&(precision=NumberUtils.PRECISION+precision);1>precision?precision=1:precision>21&&(precision=21);return Number(n.toPrecision(precision))};NumberUtils.toFixed=function(n,decimalDigits){decimalDigits=void 0!==decimalDigits?decimalDigits:0;0>decimalDigits?decimalDigits=0:decimalDigits>20&&(decimalDigits=20);return Number(n.toFixed(decimalDigits))};NumberUtils.roundTo=function(n,units){units=void 0!==units?units:1;return NumberUtils.toPrecision(Math.round(n/units)*units,-1)};NumberUtils.minMax=function(n,min,max){min>n&&(n=min);n>max&&(n=max);return n};NumberUtils.maxMin=function(n,max,min){n>max&&(n=max);min>n&&(n=min);return n};NumberUtils.interpolate=function(n1,n2,f){return n1*(1-f)+n2*f};NumberUtils.approxZero=function(n,threshold){if(0==n)return!0;threshold=void 0!==threshold?threshold:0/0;isNaN(threshold)&&(threshold=NumberUtils.EPSILON);return 0>n?threshold>-n:threshold>n};NumberUtils.approxOne=function(n,threshold){if(1==n)return!0;n-=1;threshold=void 0!==threshold?threshold:0/0;isNaN(threshold)&&(threshold=NumberUtils.EPSILON);return 0>n?threshold>-n:threshold>n};NumberUtils.approxEqual=function(n1,n2,threshold){if(n1==n2)return!0;n1-=n2;threshold=void 0!==threshold?threshold:0/0;isNaN(threshold)&&(threshold=NumberUtils.EPSILON);return 0>n1?threshold>-n1:threshold>n1};NumberUtils.approxLessThan=function(n1,n2,threshold){return n2>n1&&!NumberUtils.approxEqual(n1,n2,threshold)};NumberUtils.approxLessThanOrEqual=function(n1,n2,threshold){return n2>n1||NumberUtils.approxEqual(n1,n2,threshold)};NumberUtils.approxGreaterThan=function(n1,n2,threshold){return n1>n2&&!NumberUtils.approxEqual(n1,n2,threshold)};NumberUtils.approxGreaterThanOrEqual=function(n1,n2,threshold){return n1>n2||NumberUtils.approxEqual(n1,n2,threshold)}})})});jg_import.define("jgatt.graphics.ColorUtils",function(){jg_namespace("jgatt.graphics",function(){var NumberUtils=jg_import("jgatt.utils.NumberUtils");this.ColorUtils=jg_static(function(ColorUtils){ColorUtils.toRGB=function(color){var rgb={};rgb.r=color>>16&255;rgb.g=color>>8&255;rgb.b=255&color;return rgb};ColorUtils.fromRGB=function(rgb){return rgb.r<<16|rgb.g<<8|rgb.b};ColorUtils.brightness=function(color,brightness){var c,rgb=ColorUtils.toRGB(color);if(0>brightness){brightness=-brightness;c=0}else c=255;brightness>1&&(brightness=1);rgb.r+=Math.round((c-rgb.r)*brightness);rgb.g+=Math.round((c-rgb.g)*brightness);rgb.b+=Math.round((c-rgb.b)*brightness);return ColorUtils.fromRGB(rgb)};ColorUtils.interpolate=function(color1,color2,f){var rgb1=ColorUtils.toRGB(color1),rgb2=ColorUtils.toRGB(color2),rgb={};rgb.r=Math.round(NumberUtils.interpolate(rgb1.r,rgb2.r,f));rgb.g=Math.round(NumberUtils.interpolate(rgb1.g,rgb2.g,f));rgb.b=Math.round(NumberUtils.interpolate(rgb1.b,rgb2.b,f));return ColorUtils.fromRGB(rgb)}})})});jg_import.define("jgatt.graphics.GradientType",function(){jg_namespace("jgatt.graphics",function(){this.GradientType=jg_static(function(GradientType){GradientType.LINEAR="linear";GradientType.RADIAL="radial"})})});jg_import.define("jgatt.graphics.Graphics",function(){jg_namespace("jgatt.graphics",function(){{var Matrix=jg_import("jgatt.geom.Matrix");jg_import("jgatt.geom.Point")}this.Graphics=jg_extend(Object,function(){this._width=1;this._height=1;this._strokeStyle=null;this._strokeCommands=null;this._fillCommands=null;this._drawingStack=null;this._drawingStackIndex=0;this._penX=0;this._penY=0;this._element=null;this._canvas=null;this._context=null;this.constructor=function(width,height){this._width=width>1&&1/0>width?Math.floor(width):1;this._height=height>1&&1/0>height?Math.floor(height):1;this._strokeStyle={thickness:1,caps:"none",joints:"miter",miterLimit:10,pixelHinting:!0};this._drawingStack=[]};this.appendTo=function(element){if(!element)throw new Error("Parameter element must be non-null.");if(element===this._element)return!0;this.remove();var canvas=document.createElement("canvas");if(!canvas)return!1;if("function"!=typeof canvas.getContext)return!1;var context=canvas.getContext("2d");if(!context)return!1;canvas.style.position="absolute";canvas.width=this._width;canvas.height=this._height;element.appendChild(canvas);this._element=element;this._canvas=canvas;this._context=context;this._draw(!0);return!0};this.remove=function(){if(!this._element)return!1;var context=this._context;context.clearRect(0,0,context.canvas.width,context.canvas.height);context.beginPath();var canvas=this._canvas,parentNode=canvas.parentNode;parentNode&&parentNode.removeChild(canvas);this._element=null;this._canvas=null;this._context=null;return!0};this.setSize=function(width,height){width=width>1&&1/0>width?Math.floor(width):1;height=height>1&&1/0>height?Math.floor(height):1;if(width!==this._width||height!==this._height){this._width=width;this._height=height;var canvas=this._canvas;if(canvas){canvas.width=width;canvas.height=height;this._draw(!0)}}};this.setStrokeStyle=function(thickness,caps,joints,miterLimit,pixelHinting){if(null!=caps&&"none"!==caps&&"round"!==caps&&"square"!==caps)throw new Error('Parameter caps must be one of "none", "round", or "square".');
if(null!=joints&&"miter"!==joints&&"round"!==joints&&"bevel"!==joints)throw new Error('Parameter joints must be one of "miter", "round", or "bevel".');thickness*=1;thickness=thickness>0&&1/0>thickness?thickness:1;caps=caps?caps:"none";joints=joints?joints:"miter";miterLimit*=1;miterLimit=miterLimit>0&&1/0>miterLimit?miterLimit:10;pixelHinting=0!=pixelHinting;this._strokeStyle={thickness:thickness,caps:caps,joints:joints,miterLimit:miterLimit,pixelHinting:pixelHinting}};this.beginSolidStroke=function(color,alpha){this.endStroke();color=isNaN(color)?0:Math.min(Math.max(Math.floor(color),0),16777215);alpha=isNaN(alpha)?1:Math.min(Math.max(alpha,0),1);var strokeCommands=this._strokeCommands=[];strokeCommands.push({name:"solidStroke",strokeStyle:this._strokeStyle,color:color,alpha:alpha});strokeCommands.push({name:"moveTo",x:this._penX,y:this._penY})};this.beginGradientStroke=function(type,colors,alphas,ratios,matrix,focalPointRatio){if(null==type)throw new Error("Parameter type must be non-null.");if("linear"!==type&&"radial"!==type)throw new Error('Parameter type must be one of "linear" or "radial".');if(null==colors)throw new Error("Parameter colors must be non-null.");if(!(colors instanceof Array))throw new Error("Parameter colors must be an array.");if(null==alphas)throw new Error("Parameter alphas must be non-null.");if(!(alphas instanceof Array))throw new Error("Parameter alphas must be an array.");if(null==ratios)throw new Error("Parameter ratios must be non-null.");if(!(ratios instanceof Array))throw new Error("Parameter ratios must be an array.");if(null!=matrix&&!(matrix instanceof Matrix))throw new Error("Parameter matrix must be an instance of jgatt.geom.Matrix.");this.endStroke();var numStops=Math.min(colors.length,alphas.length,ratios.length);colors=colors.slice(0,numStops);alphas=alphas.slice(0,numStops);ratios=ratios.slice(0,numStops);for(var color,alpha,ratio,i=0;numStops>i;i++){color=colors[i];colors[i]=isNaN(color)?0:Math.min(Math.max(Math.floor(color),0),16777215);alpha=alphas[i];alphas[i]=isNaN(alpha)?1:Math.min(Math.max(alpha,0),1);ratio=ratios[i];ratios[i]=isNaN(ratio)?0:Math.min(Math.max(ratio,0),1)}if(matrix){matrix=new Matrix(1*matrix.a,1*matrix.b,1*matrix.c,1*matrix.d,1*matrix.tx,1*matrix.ty);matrix.tx-matrix.tx!==0&&(matrix.tx=0);matrix.ty-matrix.ty!==0&&(matrix.ty=0);matrix.hasInverse()||(matrix=null)}focalPointRatio=isNaN(focalPointRatio)?0:Math.min(Math.max(focalPointRatio,-1),1);var strokeCommands=this._strokeCommands=[];strokeCommands.push({name:"gradientStroke",strokeStyle:this._strokeStyle,type:type,colors:colors,alphas:alphas,ratios:ratios,matrix:matrix,focalPointRatio:focalPointRatio});strokeCommands.push({name:"moveTo",x:this._penX,y:this._penY})};this.beginImageStroke=function(){};this.endStroke=function(){if(this._strokeCommands){this._drawingStack.push(this._strokeCommands);this._strokeCommands=null;this._draw()}};this.beginSolidFill=function(color,alpha){this.endFill();color=isNaN(color)?0:Math.min(Math.max(Math.floor(color),0),16777215);alpha=isNaN(alpha)?1:Math.min(Math.max(alpha,0),1);var fillCommands=this._fillCommands=[];fillCommands.push({name:"solidFill",color:color,alpha:alpha});fillCommands.push({name:"moveTo",x:this._penX,y:this._penY})};this.beginGradientFill=function(type,colors,alphas,ratios,matrix,focalPointRatio){if(null==type)throw new Error("Parameter type must be non-null.");if("linear"!==type&&"radial"!==type)throw new Error('Parameter type must be one of "linear" or "radial".');if(null==colors)throw new Error("Parameter colors must be non-null.");if(!(colors instanceof Array))throw new Error("Parameter colors must be an array.");if(null==alphas)throw new Error("Parameter alphas must be non-null.");if(!(alphas instanceof Array))throw new Error("Parameter alphas must be an array.");if(null==ratios)throw new Error("Parameter ratios must be non-null.");if(!(ratios instanceof Array))throw new Error("Parameter ratios must be an array.");if(null!=matrix&&!(matrix instanceof Matrix))throw new Error("Parameter matrix must be an instance of jgatt.geom.Matrix.");this.endFill();var numStops=Math.min(colors.length,alphas.length,ratios.length);colors=colors.slice(0,numStops);alphas=alphas.slice(0,numStops);ratios=ratios.slice(0,numStops);for(var color,alpha,ratio,i=0;numStops>i;i++){color=colors[i];colors[i]=isNaN(color)?0:Math.min(Math.max(Math.floor(color),0),16777215);alpha=alphas[i];alphas[i]=isNaN(alpha)?1:Math.min(Math.max(alpha,0),1);ratio=ratios[i];ratios[i]=isNaN(ratio)?0:Math.min(Math.max(ratio,0),1)}if(matrix){matrix=new Matrix(1*matrix.a,1*matrix.b,1*matrix.c,1*matrix.d,1*matrix.tx,1*matrix.ty);matrix.tx-matrix.tx!==0&&(matrix.tx=0);matrix.ty-matrix.ty!==0&&(matrix.ty=0);matrix.hasInverse()||(matrix=null)}focalPointRatio=isNaN(focalPointRatio)?0:Math.min(Math.max(focalPointRatio,-1),1);var fillCommands=this._fillCommands=[];fillCommands.push({name:"gradientFill",type:type,colors:colors,alphas:alphas,ratios:ratios,matrix:matrix,focalPointRatio:focalPointRatio});fillCommands.push({name:"moveTo",x:this._penX,y:this._penY})};this.beginImageFill=function(){};this.endFill=function(){if(this._fillCommands){this._drawingStack.push(this._fillCommands);this._fillCommands=null;this._draw()}};this.moveTo=function(x,y){x*=1;x-x!==0&&(x=0);y*=1;y-y!==0&&(y=0);this._penX=x;this._penY=y;var command={name:"moveTo",x:x,y:y};this._strokeCommands&&this._strokeCommands.push(command);this._fillCommands&&this._fillCommands.push(command)};this.lineTo=function(x,y){x*=1;x-x!==0&&(x=0);y*=1;y-y!==0&&(y=0);this._penX=x;this._penY=y;var command={name:"lineTo",x:x,y:y};this._strokeCommands&&this._strokeCommands.push(command);this._fillCommands&&this._fillCommands.push(command)};this.curveTo=function(controlX,controlY,anchorX,anchorY){controlX*=1;controlX-controlX!==0&&(controlX=0);controlY*=1;controlY-controlY!==0&&(controlY=0);anchorX*=1;anchorX-anchorX!==0&&(anchorX=0);anchorY*=1;anchorY-anchorY!==0&&(anchorY=0);this._penX=anchorX;this._penY=anchorY;var command={name:"curveTo",controlX:controlX,controlY:controlY,anchorX:anchorX,anchorY:anchorY};this._strokeCommands&&this._strokeCommands.push(command);this._fillCommands&&this._fillCommands.push(command)};this.clear=function(){this._strokeCommands=null;this._fillCommands=null;this._drawingStack=[];this._draw(!0)};this._draw=function(redraw){var context=this._context;if(context){if(1==redraw){this._drawingStackIndex=0;context.clearRect(0,0,context.canvas.width,context.canvas.height);context.beginPath()}var commands,i,drawingStack=this._drawingStack,drawingStackSize=drawingStack.length;for(i=this._drawingStackIndex;drawingStackSize>i;i++){commands=drawingStack[i];switch(commands[0].name){case"solidStroke":case"gradientStroke":this._drawStroke(commands);break;case"solidFill":case"gradientFill":this._drawFill(commands)}}this._drawingStackIndex=i}};this._drawStroke=function(commands){var context=this._context;if(context){var startX,startY,endX,endY,gradient,numStops,colors,alphas,ratios,color,alpha,ratio,matrix,i,numCommands=commands.length,command=commands[0],strokeStyle=command.strokeStyle,offset=strokeStyle.pixelHinting?strokeStyle.thickness%2/2:0,hasPath=!1;context.beginPath();for(i=1;numCommands>i;i++){command=commands[i];if("moveTo"===command.name){hasPath&&startX===endX&&startY===endY&&context.closePath();hasPath=!1;startX=command.x;startY=command.y;context.moveTo(startX+offset,startY+offset)}else if("lineTo"===command.name){hasPath=!0;endX=command.x;endY=command.y;context.lineTo(endX+offset,endY+offset)}else if("curveTo"===command.name){hasPath=!0;endX=command.anchorX;endY=command.anchorY;context.quadraticCurveTo(command.controlX+offset,command.controlY+offset,endX+offset,endY+offset)}}hasPath&&startX===endX&&startY===endY&&context.closePath();context.save();context.lineWidth=strokeStyle.thickness;context.lineCap="none"===strokeStyle.caps?"butt":strokeStyle.caps;context.lineJoin=strokeStyle.joints;context.miterLimit=strokeStyle.miterLimit;command=commands[0];if("solidStroke"===command.name){color=command.color;alpha=command.alpha;context.strokeStyle="rgba("+(color>>16&255)+", "+(color>>8&255)+", "+(255&color)+", "+alpha+")"}else if("gradientStroke"===command.name){gradient="radial"===command.type?context.createRadialGradient(.5+.49*command.focalPointRatio,.5,0,.5,.5,.5):context.createLinearGradient(0,0,1,0);colors=command.colors;alphas=command.alphas;ratios=command.ratios;numStops=colors.length;for(i=0;numStops>i;i++){color=colors[i];alpha=alphas[i];ratio=ratios[i];gradient.addColorStop(ratio,"rgba("+(color>>16&255)+", "+(color>>8&255)+", "+(255&color)+", "+alpha+")")}matrix=command.matrix;matrix&&context.setTransform(matrix.a,matrix.b,matrix.c,matrix.d,matrix.tx,matrix.ty);context.strokeStyle=gradient}context.stroke();context.restore();context.beginPath()}};this._drawFill=function(commands){var context=this._context;if(context){var command,gradient,numStops,colors,alphas,ratios,color,alpha,ratio,matrix,i,numCommands=commands.length;context.beginPath();for(i=1;numCommands>i;i++){command=commands[i];"moveTo"===command.name?context.moveTo(command.x,command.y):"lineTo"===command.name?context.lineTo(command.x,command.y):"curveTo"===command.name&&context.quadraticCurveTo(command.controlX,command.controlY,command.anchorX,command.anchorY)}context.save();command=commands[0];if("solidFill"===command.name){color=command.color;alpha=command.alpha;context.fillStyle="rgba("+(color>>16&255)+", "+(color>>8&255)+", "+(255&color)+", "+alpha+")"}else if("gradientFill"===command.name){gradient="radial"===command.type?context.createRadialGradient(.5+.49*command.focalPointRatio,.5,0,.5,.5,.5):context.createLinearGradient(0,0,1,0);colors=command.colors;alphas=command.alphas;ratios=command.ratios;numStops=colors.length;for(i=0;numStops>i;i++){color=colors[i];alpha=alphas[i];ratio=ratios[i];gradient.addColorStop(ratio,"rgba("+(color>>16&255)+", "+(color>>8&255)+", "+(255&color)+", "+alpha+")")}matrix=command.matrix;matrix&&context.setTransform(matrix.a,matrix.b,matrix.c,matrix.d,matrix.tx,matrix.ty);context.fillStyle=gradient}context.fill();context.restore();context.beginPath()}}})})});jg_import.define("jgatt.graphics.Joints",function(){jg_namespace("jgatt.graphics",function(){this.Joints=jg_static(function(Joints){Joints.MITER="miter";Joints.ROUND="round";Joints.BEVEL="bevel"})})});jg_import.define("jgatt.properties.PropertyEventData",function(){jg_namespace("jgatt.properties",function(){var EventData=jg_import("jgatt.events.EventData");this.PropertyEventData=jg_extend(EventData,function(){this.property=null;this.oldValue=null;this.newValue=null;this.constructor=function(property,oldValue,newValue){this.property=property;this.oldValue=oldValue;this.newValue=newValue}})})});jg_import.define("jgatt.graphics.brushes.Brush",function(){jg_namespace("jgatt.graphics.brushes",function(){var MObservable=jg_import("jgatt.events.MObservable"),Matrix=jg_import("jgatt.geom.Matrix"),Point=jg_import("jgatt.geom.Point"),Graphics=jg_import("jgatt.graphics.Graphics"),MPropertyTarget=jg_import("jgatt.properties.MPropertyTarget"),Property=jg_import("jgatt.properties.Property"),PropertyEventData=jg_import("jgatt.properties.PropertyEventData");this.Brush=jg_extend(Object,function(Brush,base){base=jg_mixin(this,MObservable,base);base=jg_mixin(this,MPropertyTarget,base);this._properties=null;this._commands=null;this._graphics=null;this._matrix=null;this._bounds=null;this.constructor=function(){base.constructor.call(this);this.addEventListener(this.changed,this._self_changed,1/0)};this.beginBrush=function(graphics,matrix,bounds){if(!graphics)throw new Error("Parameter graphics must be non-null.");if(!(graphics instanceof Graphics))throw new Error("Parameter graphics must be an instance of jgatt.graphics.Graphics.");if(null!=matrix&&!(matrix instanceof Matrix))throw new Error("Parameter matrix must be an instance of jgatt.geom.Matrix.");if(null!=bounds&&!(bounds instanceof Array))throw new Error("Parameter bounds must be an array.");this.endBrush();this._properties||(this._properties=this._getProperties());this._commands=[];this._graphics=graphics;this._matrix=matrix?matrix.clone():null;if(bounds)for(var point,bounds2=this._bounds=[],numPoints=bounds.length,i=0;numPoints>i;i++){point=bounds[i];point instanceof Point&&bounds2.push(point.clone())}};this.endBrush=function(){if(this._graphics){this.draw(this._properties,this._commands,this._graphics,this._matrix,this._bounds);this._commands=null;this._graphics=null;this._matrix=null;this._bounds=null}};this.moveTo=function(x,y){this._graphics&&this._commands.push({name:"moveTo",x:x,y:y})};this.lineTo=function(x,y){this._graphics&&this._commands.push({name:"lineTo",x:x,y:y})};this.curveTo=function(controlX,controlY,anchorX,anchorY){this._graphics&&this._commands.push({name:"curveTo",controlX:controlX,controlY:controlY,anchorX:anchorX,anchorY:anchorY})};this.draw=function(){};this._getProperties=function(){var property,properties={};for(var p in this){property=this[p];property instanceof Property&&(properties[p]=this.getInternal(property))}return properties};this._self_changed=function(e){e.target===this&&e instanceof PropertyEventData&&(this._properties=null)}})})});jg_import.define("jgatt.graphics.brushes.DrawingUtils",function(){jg_namespace("jgatt.graphics.brushes",function(){var Point=jg_import("jgatt.geom.Point"),Brush=jg_import("jgatt.graphics.brushes.Brush");this.DrawingUtils=jg_static(function(DrawingUtils){DrawingUtils.arcTo=function(brush,startX,startY,startAngle,arcAngle,radius,radiusY){if(null==brush)throw new Error("Parameter brush must be non-null.");if(!(brush instanceof Brush))throw new Error("Parameter brush must be an instance of jgatt.graphics.brushes.Brush.");arcAngle>360?arcAngle=360:-360>arcAngle&&(arcAngle=-360);void 0===radiusY&&(radiusY=radius);var angleMid,bx,by,cx,cy,i,segs=Math.ceil(Math.abs(arcAngle)/45),segAngle=arcAngle/segs,theta=segAngle/180*Math.PI,cosThetaMid=Math.cos(theta/2),angle=startAngle/180*Math.PI,ax=startX-Math.cos(angle)*radius,ay=startY-Math.sin(angle)*radiusY;for(i=0;segs>i;i++){angle+=theta;angleMid=angle-theta/2;bx=ax+Math.cos(angle)*radius;by=ay+Math.sin(angle)*radiusY;cx=ax+Math.cos(angleMid)*(radius/cosThetaMid);cy=ay+Math.sin(angleMid)*(radiusY/cosThetaMid);brush.curveTo(cx,cy,bx,by)}return new Point(bx,by)};DrawingUtils.drawRectangle=function(brush,x,y,width,height){if(null==brush)throw new Error("Parameter brush must be non-null.");if(!(brush instanceof Brush))throw new Error("Parameter brush must be an instance of jgatt.graphics.brushes.Brush.");var x2=x+width,y2=y+height;brush.moveTo(x,y);brush.lineTo(x2,y);brush.lineTo(x2,y2);brush.lineTo(x,y2);brush.lineTo(x,y)};DrawingUtils.drawEllipse=function(brush,x,y,radiusX,radiusY){if(null==brush)throw new Error("Parameter brush must be non-null.");if(!(brush instanceof Brush))throw new Error("Parameter brush must be an instance of jgatt.graphics.brushes.Brush.");x+=radiusX;brush.moveTo(x,y);DrawingUtils.arcTo(brush,x,y,0,360,radiusX,radiusY)}})})});jg_import.define("jgatt.utils.FunctionUtils",function(){jg_namespace("jgatt.utils",function(){this.FunctionUtils=jg_static(function(FunctionUtils){FunctionUtils.bind=function(f,scope){if(null==f)throw new Error("Parameter f must be non-null.");if("function"!=typeof f)throw new Error("Parameter f must be a function.");return function(){return f.apply(scope,arguments)}}})})});jg_import.define("jgatt.properties.ObservableProperty",function(){jg_namespace("jgatt.properties",function(){var ChainedEvent=jg_import("jgatt.events.ChainedEvent"),Event=jg_import("jgatt.events.Event"),EventData=jg_import("jgatt.events.EventData"),MObservable=jg_import("jgatt.events.MObservable"),Property=jg_import("jgatt.properties.Property"),PropertyEventData=jg_import("jgatt.properties.PropertyEventData"),Dictionary=jg_import("jgatt.utils.Dictionary"),FunctionUtils=jg_import("jgatt.utils.FunctionUtils");this.ObservableProperty=jg_extend(Property,function(ObservableProperty,base){var _defaultChangedComparator=function(oldValue,newValue){return oldValue===newValue?!1:oldValue!==oldValue&&newValue!==newValue?!1:!0};this.changed=null;this._noChaining=!1;this._changedComparator=null;this._onChanged=null;this.constructor=function(name,type,defaultValue,readOnly,noChaining){base.constructor.call(this,name,type,defaultValue,readOnly);if(null!=noChaining&&"boolean"!=typeof noChaining)throw new Error("Parameter noChaining must be a boolean.");this._noChaining=noChaining===!0;this.changed=this._noChaining?new Event("changed",EventData):new ChainedEvent("changed",MObservable.changed)};this.noChaining=function(){return this._noChaining};this.changedComparator=function(value){if(0==arguments.length)return this._changedComparator;if(null!=value&&"function"!=typeof value)throw new Error("Parameter changedComparator must be a function.");this._changedComparator=value?value:null;return this};this.onChanged=function(value){if(0==arguments.length)return this._onChanged;if(null!=value&&"function"!=typeof value)throw new Error("Parameter onChanged must be a function.");this._onChanged=value?value:null;return this};this.setInternal=function(target,propertyMap,value){value=this.assertType(value,"Value assigned to property "+this._name+" is incompatible with property type.");var propertyInfo=propertyMap.get(this);propertyInfo||(propertyInfo=propertyMap.set(this,this.createPropertyInfo(this,target)));if(propertyInfo.isChanging)return!1;try{propertyInfo.isChanging=!0;var oldValue=propertyInfo.value;if(this._changedComparator){if(!this._changedComparator.call(target,oldValue,value))return!1}else if(!_defaultChangedComparator(oldValue,value))return!1;this._setter&&this._setter.call(target,value);propertyInfo.value=value;propertyInfo.setupValueChain();propertyInfo.isObservable&&target.dispatchEvent(this.changed,new PropertyEventData(this,oldValue,value))}finally{propertyInfo.isChanging=!1}return!0};this.createPropertyInfo=function(property,target){return new ObservableProperty.PropertyInfo(property,target)}});this.ObservableProperty.PropertyInfo=jg_extend(Property.PropertyInfo,function(PropertyInfo,base){this.cachedValue=null;this.isObservable=!1;this.isChanging=!1;this.isValueChangingMap=null;this.constructor=function(property,target){base.constructor.call(this,property,target);this.isObservable=jg_has_mixin(target,MObservable);this.isValueChangingMap=new Dictionary;this.value_changed=FunctionUtils.bind(this.value_changed,this);property._onChanged&&this.isObservable&&target.addEventListener(property.changed,property._onChanged,1/0)};this.setupValueChain=function(){this.clearValueChain();var value=this.value;if(null!=value&&jg_has_mixin(value,MObservable)){this.cachedValue=value;value.addEventListener(value.changed,this.value_changed,-1/0)}};this.clearValueChain=function(){var value=this.cachedValue;if(null!=value){value.removeEventListener(value.changed,this.value_changed);this.cachedValue=null}};this.value_changed=function(e){if(this.isObservable&&!this.isChanging&&!this.isValueChangingMap.has(e)&&!e.isPropagationStopped())try{this.isValueChangingMap.set(e,!0);this.target.dispatchEvent(this.property.changed,e)}finally{this.isValueChangingMap.del(e)}}})})});jg_import.define("jgatt.graphics.brushes.TileBrush",function(){jg_namespace("jgatt.graphics.brushes",function(){var Matrix=jg_import("jgatt.geom.Matrix"),Point=jg_import("jgatt.geom.Point"),Brush=jg_import("jgatt.graphics.brushes.Brush"),ObservableProperty=jg_import("jgatt.properties.ObservableProperty");this.TileBrush=jg_extend(Brush,function(TileBrush,base){this.stretchMode=new ObservableProperty("stretchMode",String,"fill").writeFilter(function(value){switch(value){case"none":case"fill":case"uniform":case"uniformToFill":case"uniformToWidth":case"uniformToHeight":return value;default:return"fill"}});this.alignmentX=new ObservableProperty("alignmentX",Number,.5).writeFilter(function(value){return value>-1/0&&1/0>value?value:.5});this.alignmentY=new ObservableProperty("alignmentY",Number,.5).writeFilter(function(value){return value>-1/0&&1/0>value?value:.5});this.tileTransform=new ObservableProperty("tileTransform",Matrix,null).readFilter(function(value){return value?value.clone():null}).writeFilter(function(value){return value?value.clone():null});this.renderTransform=new ObservableProperty("renderTransform",Matrix,null).readFilter(function(value){return value?value.clone():null}).writeFilter(function(value){return value?value.clone():null});this.fitToDrawing=new ObservableProperty("fitToDrawing",Boolean,!1);this.constructor=function(stretchMode,alignmentX,alignmentY,tileTransform,renderTransform,fitToDrawing){base.constructor.call(this);null!=stretchMode&&this.set(this.stretchMode,stretchMode);null!=alignmentX&&this.set(this.alignmentX,alignmentX);null!=alignmentY&&this.set(this.alignmentY,alignmentY);null!=tileTransform&&this.set(this.tileTransform,tileTransform);null!=renderTransform&&this.set(this.renderTransform,renderTransform);null!=fitToDrawing&&this.set(this.fitToDrawing,fitToDrawing)};this.computeTileMatrix=function(tileWidth,tileHeight,properties,commands,matrix,bounds){var tileMatrix,tileTransform=properties.tileTransform;if(tileTransform){tileMatrix=tileTransform.clone();var p1=new Point(0,0),p2=new Point(tileWidth,0),p3=new Point(tileWidth,tileHeight),p4=new Point(0,tileHeight);p1=tileMatrix.transformPoint(p1);p2=tileMatrix.transformPoint(p2);p3=tileMatrix.transformPoint(p3);p4=tileMatrix.transformPoint(p4);var left=Math.min(p1.x,p2.x,p3.x,p4.x),right=Math.max(p1.x,p2.x,p3.x,p4.x),top=Math.min(p1.y,p2.y,p3.y,p4.y),bottom=Math.max(p1.y,p2.y,p3.y,p4.y);tileWidth=right-left;tileHeight=bottom-top;tileMatrix.translate(-left,-top)}else tileMatrix=new Matrix;var invertedMatrix;if(matrix&&matrix.hasInverse()){invertedMatrix=matrix.clone();invertedMatrix.invert()}var point,i,minX=1/0,minY=1/0,maxX=-1/0,maxY=-1/0;if(bounds&&!properties.fitToDrawing){var numPoints=bounds.length;for(i=0;numPoints>i;i++){point=bounds[i];invertedMatrix&&(point=invertedMatrix.transformPoint(point));minX=Math.min(point.x,minX);minY=Math.min(point.y,minY);maxX=Math.max(point.x,maxX);maxY=Math.max(point.y,maxY)}}else{var command,numCommands=commands.length;for(i=0;numCommands>i;i++){command=commands[i];if("moveTo"==command.name)point=new Point(command.x,command.y);else if("lineTo"==command.name)point=new Point(command.x,command.y);else{if("curveTo"!=command.name)continue;point=new Point(command.anchorX,command.anchorY)}invertedMatrix&&(point=invertedMatrix.transformPoint(point));minX=Math.min(point.x,minX);minY=Math.min(point.y,minY);maxX=Math.max(point.x,maxX);maxY=Math.max(point.y,maxY)}}1/0==minX&&(minX=minY=maxX=maxY=0);var scaleX,scaleY,offsetX,offsetY,width=maxX-minX,height=maxY-minY;switch(properties.stretchMode){case"none":offsetX=(width-tileWidth)*properties.alignmentX;offsetY=(height-tileHeight)*properties.alignmentY;tileMatrix.translate(offsetX,offsetY);break;case"uniform":scaleX=tileWidth>0?width/tileWidth:1;scaleY=tileHeight>0?height/tileHeight:1;scaleX=scaleY=Math.min(scaleX,scaleY);offsetX=(width-tileWidth*scaleX)*properties.alignmentX;offsetY=(height-tileHeight*scaleY)*properties.alignmentY;tileMatrix.scale(scaleX,scaleY);tileMatrix.translate(offsetX,offsetY);break;case"uniformToFill":scaleX=tileWidth>0?width/tileWidth:1;scaleY=tileHeight>0?height/tileHeight:1;scaleX=scaleY=Math.max(scaleX,scaleY);offsetX=(width-tileWidth*scaleX)*properties.alignmentX;offsetY=(height-tileHeight*scaleY)*properties.alignmentY;tileMatrix.scale(scaleX,scaleY);tileMatrix.translate(offsetX,offsetY);break;case"uniformToWidth":scaleX=scaleY=tileWidth>0?width/tileWidth:1;offsetX=(width-tileWidth*scaleX)*properties.alignmentX;offsetY=(height-tileHeight*scaleY)*properties.alignmentY;tileMatrix.scale(scaleX,scaleY);tileMatrix.translate(offsetX,offsetY);break;case"uniformToHeight":scaleX=scaleY=tileHeight>0?height/tileHeight:1;offsetX=(width-tileWidth*scaleX)*properties.alignmentX;offsetY=(height-tileHeight*scaleY)*properties.alignmentY;tileMatrix.scale(scaleX,scaleY);tileMatrix.translate(offsetX,offsetY);break;default:scaleX=tileWidth>0?width/tileWidth:1;scaleY=tileHeight>0?height/tileHeight:1;tileMatrix.scale(scaleX,scaleY)}var renderTransform=properties.renderTransform;renderTransform&&tileMatrix.concat(renderTransform);tileMatrix.translate(minX,minY);matrix&&tileMatrix.concat(matrix);return tileMatrix}})})});jg_import.define("jgatt.properties.ObservableArrayProperty",function(){jg_namespace("jgatt.properties",function(){var MObservable=jg_import("jgatt.events.MObservable"),ObservableProperty=jg_import("jgatt.properties.ObservableProperty"),TypeUtils=jg_import("jgatt.utils.TypeUtils");this.ObservableArrayProperty=jg_extend(ObservableProperty,function(ObservableArrayProperty,base){this._elementType=null;this.constructor=function(name,elementType,defaultValue,readOnly,noChaining){if(null==elementType)throw new Error("Parameter elementType must be non-null.");if("function"!=typeof elementType)throw new Error("Parameter elementType must be a class.");this._elementType=elementType;base.constructor.call(this,name,Array,defaultValue,readOnly,noChaining)};this.elementType=function(){return this._elementType};this.assertType=function(value,message){if(null==value)return null;if(!(value instanceof Array))throw new Error(message);var elementType=this._elementType;if(elementType===Object)return value;for(var elementValue,i=0,l=value.length;l>i;i++){elementValue=value[i];if(null==elementValue||!TypeUtils.isTypeOf(elementValue,elementType))throw new Error(message)}return value};this.createPropertyInfo=function(property,target){return new ObservableArrayProperty.PropertyInfo(property,target)}});this.ObservableArrayProperty.PropertyInfo=jg_extend(ObservableProperty.PropertyInfo,function(PropertyInfo,base){this.cachedElementValues=null;this.constructor=function(property,target){base.constructor.call(this,property,target)};this.setupValueChain=function(){this.clearValueChain();var value=this.value;if(null!=value){if(jg_has_mixin(value,MObservable)){this.cachedValue=value;value.addEventListener(value.changed,this.value_changed,-1/0)}if(0!=value.length)for(var elementValue,elementValues=this.cachedElementValues=[],i=0,l=value.length;l>i;i++){elementValue=value[i];if(jg_has_mixin(elementValue,MObservable)){elementValues.push(elementValue);elementValue.addEventListener(elementValue.changed,this.value_changed,-1/0)}}}};this.clearValueChain=function(){var elementValues=this.cachedElementValues;if(elementValues){for(var elementValue,i=elementValues.length-1;i>=0;i--){elementValue=value[i];elementValue.removeEventListener(elementValue.changed,this.value_changed)}this.cachedElementValues=null}var value=this.cachedValue;if(null!=value){value.removeEventListener(value.changed,this.value_changed);this.cachedValue=null}}})})});jg_import.define("jgatt.graphics.brushes.GradientFillBrush",function(){jg_namespace("jgatt.graphics.brushes",function(){var Matrix=jg_import("jgatt.geom.Matrix"),TileBrush=jg_import("jgatt.graphics.brushes.TileBrush"),ObservableArrayProperty=jg_import("jgatt.properties.ObservableArrayProperty"),ObservableProperty=jg_import("jgatt.properties.ObservableProperty"),NumberUtils=jg_import("jgatt.utils.NumberUtils");this.GradientFillBrush=jg_extend(TileBrush,function(GradientFillBrush,base){this.type=new ObservableProperty("type",String,"linear").writeFilter(function(value){switch(value){case"linear":case"radial":return value;default:return"linear"}});this.colors=new ObservableArrayProperty("colors",Number,[]).readFilter(function(value){return value.concat()}).writeFilter(function(value){return value?value.concat():[]});this.alphas=new ObservableArrayProperty("alphas",Number,[]).readFilter(function(value){return value.concat()}).writeFilter(function(value){return value?value.concat():[]});this.ratios=new ObservableArrayProperty("ratios",Number,[]).readFilter(function(value){return value.concat()}).writeFilter(function(value){return value?value.concat():[]});this.focalPointRatio=new ObservableProperty("focalPointRatio",Number,0).writeFilter(function(value){return isNaN(value)?0:NumberUtils.minMax(value,-1,1)});this.gradientWidth=new ObservableProperty("gradientWidth",Number,100).writeFilter(function(value){return value>0&&1/0>value?value:100});this.gradientHeight=new ObservableProperty("gradientHeight",Number,100).writeFilter(function(value){return value>0&&1/0>value?value:100});this.constructor=function(type,colors,alphas,ratios,focalPointRatio){base.constructor.call(this);null!=type&&this.set(this.type,type);null!=colors&&this.set(this.colors,colors);null!=alphas&&this.set(this.alphas,alphas);null!=ratios&&this.set(this.ratios,ratios);null!=focalPointRatio&&this.set(this.focalPointRatio,focalPointRatio)};this.draw=function(properties,commands,graphics,matrix,bounds){var gradientWidth=properties.gradientWidth,gradientHeight=properties.gradientHeight,tileMatrix=new Matrix(gradientWidth,0,0,gradientHeight);tileMatrix.concat(this.computeTileMatrix(gradientWidth,gradientHeight,properties,commands,matrix,bounds));graphics.beginGradientFill(properties.type,properties.colors,properties.alphas,properties.ratios,tileMatrix,properties.focalPointRatio);for(var command,numCommands=commands.length,i=0;numCommands>i;i++){command=commands[i];"moveTo"===command.name?graphics.moveTo(command.x,command.y):"lineTo"===command.name?graphics.lineTo(command.x,command.y):"curveTo"===command.name&&graphics.curveTo(command.controlX,command.controlY,command.anchorX,command.anchorY)}graphics.endFill()}})})});jg_import.define("jgatt.graphics.brushes.GroupBrush",function(){jg_namespace("jgatt.graphics.brushes",function(){var Brush=jg_import("jgatt.graphics.brushes.Brush"),ObservableArrayProperty=jg_import("jgatt.properties.ObservableArrayProperty");this.GroupBrush=jg_extend(Brush,function(GroupBrush,base){this.brushes=new ObservableArrayProperty("brushes",Brush,[]).readFilter(function(value){return value.concat()}).writeFilter(function(value){return value?value.concat():[]});this.constructor=function(brushes){base.constructor.call(this);null!=brushes&&this.set(this.brushes,brushes)};this.draw=function(properties,commands,graphics,matrix,bounds){var brush,command,i,j,brushes=properties.brushes,numBrushes=brushes.length,numCommands=commands.length;for(i=0;numBrushes>i;i++){brush=brushes[i];brush.beginBrush(graphics,matrix,bounds);for(j=0;numCommands>j;j++){command=commands[j];"moveTo"===command.name?brush.moveTo(command.x,command.y):"lineTo"===command.name?brush.lineTo(command.x,command.y):"curveTo"===command.name&&brush.curveTo(command.controlX,command.controlY,command.anchorX,command.anchorY)}brush.endBrush()}}})})});jg_import.define("jgatt.graphics.brushes.SolidFillBrush",function(){jg_namespace("jgatt.graphics.brushes",function(){var Brush=jg_import("jgatt.graphics.brushes.Brush"),ObservableProperty=jg_import("jgatt.properties.ObservableProperty"),NumberUtils=jg_import("jgatt.utils.NumberUtils");this.SolidFillBrush=jg_extend(Brush,function(SolidFillBrush,base){this.color=new ObservableProperty("color",Number,0).writeFilter(function(value){return isNaN(value)?0:NumberUtils.minMax(Math.floor(value),0,16777215)});this.alpha=new ObservableProperty("alpha",Number,1).writeFilter(function(value){return isNaN(value)?1:NumberUtils.minMax(value,0,1)});this.constructor=function(color,alpha){base.constructor.call(this);null!=color&&this.set(this.color,color);null!=alpha&&this.set(this.alpha,alpha)};this.draw=function(properties,commands,graphics){graphics.beginSolidFill(properties.color,properties.alpha);for(var command,numCommands=commands.length,i=0;numCommands>i;i++){command=commands[i];"moveTo"===command.name?graphics.moveTo(command.x,command.y):"lineTo"===command.name?graphics.lineTo(command.x,command.y):"curveTo"===command.name&&graphics.curveTo(command.controlX,command.controlY,command.anchorX,command.anchorY)}graphics.endFill()}})})});jg_import.define("jgatt.graphics.brushes.SolidStrokeBrush",function(){jg_namespace("jgatt.graphics.brushes",function(){var Brush=jg_import("jgatt.graphics.brushes.Brush"),ObservableProperty=jg_import("jgatt.properties.ObservableProperty"),NumberUtils=jg_import("jgatt.utils.NumberUtils");
this.SolidStrokeBrush=jg_extend(Brush,function(SolidStrokeBrush,base){this.color=new ObservableProperty("color",Number,0).writeFilter(function(value){return isNaN(value)?0:NumberUtils.minMax(Math.floor(value),0,16777215)});this.alpha=new ObservableProperty("alpha",Number,1).writeFilter(function(value){return isNaN(value)?1:NumberUtils.minMax(value,0,1)});this.thickness=new ObservableProperty("thickness",Number,1).writeFilter(function(value){return value>0&&1/0>value?value:1});this.caps=new ObservableProperty("caps",String,"none").writeFilter(function(value){switch(value){case"none":case"round":case"square":return value;default:return"none"}});this.joints=new ObservableProperty("joints",String,"miter").writeFilter(function(value){switch(value){case"miter":case"round":case"bevel":return value;default:return"miter"}});this.miterLimit=new ObservableProperty("miterLimit",Number,10).writeFilter(function(value){return value>0&&1/0>value?value:10});this.pixelHinting=new ObservableProperty("pixelHinting",Boolean,!0);this.constructor=function(color,alpha,thickness,caps,joints,miterLimit,pixelHinting){base.constructor.call(this);null!=color&&this.set(this.color,color);null!=alpha&&this.set(this.alpha,alpha);null!=thickness&&this.set(this.thickness,thickness);null!=caps&&this.set(this.caps,caps);null!=joints&&this.set(this.joints,joints);null!=miterLimit&&this.set(this.miterLimit,miterLimit);null!=pixelHinting&&this.set(this.pixelHinting,pixelHinting)};this.draw=function(properties,commands,graphics){graphics.setStrokeStyle(properties.thickness,properties.caps,properties.joints,properties.miterLimit,properties.pixelHinting);graphics.beginSolidStroke(properties.color,properties.alpha);for(var command,numCommands=commands.length,i=0;numCommands>i;i++){command=commands[i];"moveTo"===command.name?graphics.moveTo(command.x,command.y):"lineTo"===command.name?graphics.lineTo(command.x,command.y):"curveTo"===command.name&&graphics.curveTo(command.controlX,command.controlY,command.anchorX,command.anchorY)}graphics.endStroke()}})})});jg_import.define("jgatt.graphics.brushes.StretchMode",function(){jg_namespace("jgatt.graphics.brushes",function(){this.StretchMode=jg_static(function(StretchMode){StretchMode.NONE="none";StretchMode.FILL="fill";StretchMode.UNIFORM="uniform";StretchMode.UNIFORM_TO_FILL="uniformToFill";StretchMode.UNIFORM_TO_WIDTH="uniformToWidth";StretchMode.UNIFORM_TO_HEIGHT="uniformToHeight"})})});jg_import.define("jgatt.motion.easers.Easer",function(){jg_namespace("jgatt.motion.easers",function(){this.Easer=jg_extend(Object,function(){this.direction=1;this.constructor=function(direction){this.direction=void 0!==direction?direction:1};this.ease=function(position){return this.direction>0?this.easeOverride(position):this.direction<0?1-this.easeOverride(1-position):.5>position?this.easeOverride(2*position)/2:.5+(1-this.easeOverride(2-2*position))/2};this.easeOverride=function(position){return position}})})});jg_import.define("jgatt.motion.Tween",function(){jg_namespace("jgatt.motion",function(){var Event=jg_import("jgatt.events.Event"),EventData=jg_import("jgatt.events.EventData"),MEventTarget=jg_import("jgatt.events.MEventTarget"),Easer=jg_import("jgatt.motion.easers.Easer"),MPropertyTarget=jg_import("jgatt.properties.MPropertyTarget"),Property=jg_import("jgatt.properties.Property");this.Tween=jg_extend(Object,function(Tween,base){base=jg_mixin(this,MEventTarget,base);base=jg_mixin(this,MPropertyTarget,base);this.begin=new Event("begin",EventData);this.end=new Event("end",EventData);this.update=new Event("update",EventData);this.easer=new Property("easer",Easer,null).onWrite(function(){this.endTween()});this._runningEaser=null;this._isRunning=!1;this.constructor=function(easer){base.constructor.call(this);null!=easer&&this.set(this.easer,easer)};this.beginTween=function(){this.endTween();if(!this.beginTweenOverride())return!1;this._runningEaser=this.getInternal(this.easer);this._isRunning=!0;this.dispatchEvent(this.begin,new EventData);return!0};this.endTween=function(){if(!this._isRunning)return!1;this.endTweenOverride();this._isRunning=!1;this.dispatchEvent(this.end,new EventData);return!0};this.updateTween=function(position){if(!this._isRunning)return!1;var easer=this._runningEaser;easer&&(position=easer.ease(position));if(!this.updateTweenOverride(position))return!1;this.dispatchEvent(this.update,new EventData);return!0};this.beginTweenOverride=function(){return!1};this.endTweenOverride=function(){};this.updateTweenOverride=function(){return!1}})})});jg_import.define("jgatt.properties.ArrayProperty",function(){jg_namespace("jgatt.properties",function(){var Property=jg_import("jgatt.properties.Property"),TypeUtils=jg_import("jgatt.utils.TypeUtils");this.ArrayProperty=jg_extend(Property,function(ArrayProperty,base){this._elementType=null;this.constructor=function(name,elementType,defaultValue,readOnly){if(null==elementType)throw new Error("Parameter elementType must be non-null.");if("function"!=typeof elementType)throw new Error("Parameter elementType must be a class.");this._elementType=elementType;base.constructor.call(this,name,Array,defaultValue,readOnly)};this.elementType=function(){return this._elementType};this.assertType=function(value,message){if(null==value)return null;if(!(value instanceof Array))throw new Error(message);var elementType=this._elementType;if(elementType===Object)return value;for(var elementValue,i=0,l=value.length;l>i;i++){elementValue=value[i];if(null==elementValue||!TypeUtils.isTypeOf(elementValue,elementType))throw new Error(message)}return value}})})});jg_import.define("jgatt.motion.GroupTween",function(){jg_namespace("jgatt.motion",function(){var Tween=jg_import("jgatt.motion.Tween"),ArrayProperty=jg_import("jgatt.properties.ArrayProperty");this.GroupTween=jg_extend(Tween,function(GroupTween,base){this.tweens=new ArrayProperty("tweens",Tween,[]).readFilter(function(value){return value.concat()}).writeFilter(function(value){return value?value.concat():[]}).onWrite(function(){this.endTween()});this._runningTweens=null;this.constructor=function(tweens,easer){base.constructor.call(this,easer);null!=tweens&&this.set(this.tweens,tweens)};this.beginTweenOverride=function(){for(var tween,runningTweens=[],tweens=this.getInternal(this.tweens),i=0,l=tweens.length;l>i;i++){tween=tweens[i];tween.beginTween()&&runningTweens.push(tween)}if(0==runningTweens.length)return!1;this._runningTweens=runningTweens;return!0};this.endTweenOverride=function(){for(var runningTweens=this._runningTweens,i=0,l=runningTweens.length;l>i;i++)runningTweens[i].endTween();this._runningTweens=null};this.updateTweenOverride=function(position){for(var tween,runningTweens=this._runningTweens,numTweens=runningTweens.length,i=0;numTweens>i;i++){tween=runningTweens[i];if(!tween.updateTween(position)){tween.endTween();runningTweens.splice(i,1);i--;numTweens--}}return runningTweens.length>0}})})});jg_import.define("jgatt.motion.interpolators.Interpolator",function(){jg_namespace("jgatt.motion.interpolators",function(){this.Interpolator=jg_extend(Object,function(){this.interpolate=function(value1,value2,position){return.5>position?value1:value2}})})});jg_import.define("jgatt.motion.interpolators.NumberInterpolator",function(){jg_namespace("jgatt.motion.interpolators",function(){var Interpolator=jg_import("jgatt.motion.interpolators.Interpolator"),NumberUtils=jg_import("jgatt.utils.NumberUtils");this.NumberInterpolator=jg_extend(Interpolator,function(){this.snap=0;this.constructor=function(snap){this.snap=void 0!==snap?snap:0};this.interpolate=function(value1,value2,position){var number1=Number(value1),number2=Number(value2),number=NumberUtils.interpolate(number1,number2,position),snap=this.snap;snap>0&&(number=Math.round(number/snap)*snap);return number}})})});jg_import.define("jgatt.motion.MethodTween",function(){jg_namespace("jgatt.motion",function(){var Tween=jg_import("jgatt.motion.Tween"),Interpolator=jg_import("jgatt.motion.interpolators.Interpolator"),NumberInterpolator=jg_import("jgatt.motion.interpolators.NumberInterpolator"),Property=jg_import("jgatt.properties.Property"),Dictionary=jg_import("jgatt.utils.Dictionary");this.MethodTween=jg_extend(Tween,function(MethodTween,base){var _DEFAULT_INTERPOLATOR=new NumberInterpolator,_runningTargets=new Dictionary;this.target=new Property("target",Object,null).onWrite(function(){this.endTween()});this.getter=new Property("getter",Function,null).onWrite(function(){this.endTween()});this.setter=new Property("setter",Function,null).onWrite(function(){this.endTween()});this.startValue=new Property("startValue",Object,null).onWrite(function(){this.endTween()});this.endValue=new Property("endValue",Object,null).onWrite(function(){this.endTween()});this.interpolator=new Property("interpolator",Interpolator,null).onWrite(function(){this.endTween()});this._runningTarget=null;this._runningGetter=null;this._runningSetter=null;this._runningStartValue=null;this._runningEndValue=null;this._runningInterpolator=null;this.constructor=function(target,getter,setter,startValue,endValue,easer,interpolator){base.constructor.call(this,easer);null!=target&&this.set(this.target,target);null!=getter&&this.set(this.getter,getter);null!=setter&&this.set(this.setter,setter);null!=startValue&&this.set(this.startValue,startValue);null!=endValue&&this.set(this.endValue,endValue);null!=interpolator&&this.set(this.interpolator,interpolator)};this.beginTweenOverride=function(){var target=this.getInternal(this.target);if(null==target)return!1;var getter=this.getInternal(this.getter);if(null==getter)return!1;var setter=this.getInternal(this.setter);if(null==setter)return!1;var endValue=this.getInternal(this.endValue);if(null==endValue)return!1;var startValue=this.getInternal(this.startValue);if(null==startValue)try{startValue=getter.call(target)}catch(e){return!1}var interpolator=this.getInternal(this.interpolator);interpolator||(interpolator=_DEFAULT_INTERPOLATOR);this._runningTarget=target;this._runningGetter=getter;this._runningSetter=setter;this._runningStartValue=startValue;this._runningEndValue=endValue;this._runningInterpolator=interpolator;var runningSetters=_runningTargets.get(target);runningSetters||(runningSetters=_runningTargets.set(target,new Dictionary));var runningTween=runningSetters.get(setter);runningSetters.set(setter,this);runningTween&&runningTween.endTween();return!0};this.endTweenOverride=function(){var target=this._runningTarget,setter=this._runningSetter;this._runningTarget=null;this._runningGetter=null;this._runningSetter=null;this._runningStartValue=null;this._runningEndValue=null;this._runningInterpolator=null;var runningSetters=_runningTargets.get(target);if(runningSetters.get(setter)===this){runningSetters.del(setter);runningSetters.size()>0||_runningTargets.del(target)}};this.updateTweenOverride=function(position){var value=this._runningInterpolator.interpolate(this._runningStartValue,this._runningEndValue,position);try{this._runningSetter.call(this._runningTarget,value)}catch(e){return!1}return!0}})})});jg_import.define("jgatt.motion.PropertyTween",function(){jg_namespace("jgatt.motion",function(){var Tween=jg_import("jgatt.motion.Tween"),Interpolator=jg_import("jgatt.motion.interpolators.Interpolator"),NumberInterpolator=jg_import("jgatt.motion.interpolators.NumberInterpolator"),MPropertyTarget=jg_import("jgatt.properties.MPropertyTarget"),Property=jg_import("jgatt.properties.Property"),Dictionary=jg_import("jgatt.utils.Dictionary");this.PropertyTween=jg_extend(Tween,function(PropertyTween,base){var _DEFAULT_INTERPOLATOR=new NumberInterpolator,_runningTargets=new Dictionary;this.target=new Property("target",Object,null).writeFilter(function(value){if(null!=value&&!jg_has_mixin(value,MPropertyTarget))throw new Error("Parameter target must have the mixin jgatt.properties.MPropertyTarget.");return value}).onWrite(function(){this.endTween()});this.property=new Property("property",Object,null).writeFilter(function(value){if(null!=value&&"string"!=typeof value&&!(value instanceof Property))throw new Error("Parameter property must be a string or an instance of jgatt.properties.Property.");return value}).onWrite(function(){this.endTween()});this.startValue=new Property("startValue",Object,null).onWrite(function(){this.endTween()});this.endValue=new Property("endValue",Object,null).onWrite(function(){this.endTween()});this.interpolator=new Property("interpolator",Interpolator,null).onWrite(function(){this.endTween()});this._runningTarget=null;this._runningProperty=null;this._runningStartValue=null;this._runningEndValue=null;this._runningInterpolator=null;this.constructor=function(target,property,startValue,endValue,easer,interpolator){base.constructor.call(this,easer);null!=target&&this.set(this.target,target);null!=property&&this.set(this.property,property);null!=startValue&&this.set(this.startValue,startValue);null!=endValue&&this.set(this.endValue,endValue);null!=interpolator&&this.set(this.interpolator,interpolator)};this.beginTweenOverride=function(){var target=this.getInternal(this.target);if(null==target)return!1;var property=this.getInternal(this.property);if(null==property)return!1;if("string"==typeof property){property=target[property];if(!(property instanceof Property))return!1}var endValue=this.getInternal(this.endValue);if(null==endValue)return!1;var startValue=this.getInternal(this.startValue);if(null==startValue)try{startValue=target.get(property)}catch(e){return!1}var interpolator=this.getInternal(this.interpolator);interpolator||(interpolator=_DEFAULT_INTERPOLATOR);this._runningTarget=target;this._runningProperty=property;this._runningStartValue=startValue;this._runningEndValue=endValue;this._runningInterpolator=interpolator;var runningProperties=_runningTargets.get(target);runningProperties||(runningProperties=_runningTargets.set(target,new Dictionary));var runningTween=runningProperties.get(property);runningProperties.set(property,this);runningTween&&runningTween.endTween();return!0};this.endTweenOverride=function(){var target=this._runningTarget,property=this._runningProperty;this._runningTarget=null;this._runningProperty=null;this._runningStartValue=null;this._runningEndValue=null;this._runningInterpolator=null;var runningProperties=_runningTargets.get(target);if(runningProperties.get(property)===this){runningProperties.del(property);runningProperties.size()>0||_runningTargets.del(target)}};this.updateTweenOverride=function(position){var value=this._runningInterpolator.interpolate(this._runningStartValue,this._runningEndValue,position);try{this._runningTarget.set(this._runningProperty,value)}catch(e){return!1}return!0}})})});jg_import.define("jgatt.motion.TweenRunner",function(){jg_namespace("jgatt.motion",function(){var Tween=jg_import("jgatt.motion.Tween"),Dictionary=jg_import("jgatt.utils.Dictionary");this.TweenRunner=jg_static(function(TweenRunner){var _tweenRunInfo=new Dictionary,_tweenInterval=0,_tweenTime=0,_tweenStep=function(){var tweenTime=(new Date).getTime()/1e3,time=tweenTime-_tweenTime;0>time?time=0:time>.1&&(time=.1);_tweenTime=tweenTime;for(var runInfo,position,runInfos=_tweenRunInfo.values(),i=0,l=runInfos.length;l>i;i++){runInfo=runInfos[i];runInfo.time+=time;position=runInfo.time/runInfo.duration;position>1&&(position=1);runInfo.tween.updateTween(position)||(position=1);1==position&&TweenRunner.stop(runInfo.tween)}};TweenRunner.start=function(tween,duration){if(null==tween)throw new Error("Parameter tween must be non-null.");if(!(tween instanceof Tween))throw new Error("Parameter tween must be an instance of jgatt.motion.Tween.");TweenRunner.stop(tween);if(!tween.beginTween())return!1;if(tween.updateTween(0))if(duration>0){{_tweenRunInfo.set(tween,{tween:tween,duration:duration,time:0})}if(1==_tweenRunInfo.size()){_tweenInterval=setInterval(_tweenStep,1e3/30);_tweenTime=(new Date).getTime()/1e3}}else{tween.updateTween(1);tween.endTween()}else tween.endTween();return!0};TweenRunner.stop=function(tween){if(null==tween)throw new Error("Parameter tween must be non-null.");if(!(tween instanceof Tween))throw new Error("Parameter tween must be an instance of jgatt.motion.Tween.");var runInfo=_tweenRunInfo.get(tween);if(!runInfo)return!1;_tweenRunInfo.del(tween);0==_tweenRunInfo.size()&&clearInterval(_tweenInterval);tween.endTween();return!0}})})});jg_import.define("jgatt.motion.easers.CubicEaser",function(){jg_namespace("jgatt.motion.easers",function(){var Easer=jg_import("jgatt.motion.easers.Easer");this.CubicEaser=jg_extend(Easer,function(CubicEaser,base){this.constructor=function(direction){base.constructor.call(this,direction)};this.easeOverride=function(position){return position*position*position}})})});jg_import.define("jgatt.motion.easers.EaseDirection",function(){jg_namespace("jgatt.motion.easers",function(){this.EaseDirection=jg_static(function(EaseDirection){EaseDirection.IN=1;EaseDirection.OUT=-1;EaseDirection.IN_OUT=0})})});jg_import.define("jgatt.utils.Comparator",function(){jg_namespace("jgatt.utils",function(){this.Comparator=jg_extend(Object,function(){this.compare=function(){return 0}})})});jg_import.define("jgatt.utils.AlphabeticComparator",function(){jg_namespace("jgatt.utils",function(){var Comparator=jg_import("jgatt.utils.Comparator");this.AlphabeticComparator=jg_extend(Comparator,function(){this.compare=function(value1,value2){var str1=String(value1).toLowerCase(),str2=String(value2).toLowerCase();return str2>str1?-1:str1>str2?1:0}})})});jg_import.define("jgatt.utils.NaturalComparator",function(){jg_namespace("jgatt.utils",function(){var Comparator=jg_import("jgatt.utils.Comparator");this.NaturalComparator=jg_extend(Comparator,function(){this.compare=function(value1,value2){return value2>value1?-1:value1>value2?1:0}})})});jg_import.define("jgatt.utils.ArrayUtils",function(){jg_namespace("jgatt.utils",function(){var Comparator=jg_import("jgatt.utils.Comparator"),NaturalComparator=jg_import("jgatt.utils.NaturalComparator");this.ArrayUtils=jg_static(function(ArrayUtils){var _NATURAL_COMPARATOR=new NaturalComparator;ArrayUtils.indexOf=function(a,value){if(null==a)throw new Error("Parameter a must be non-null.");if(!(a instanceof Array))throw new Error("Parameter a must be an array.");for(var i=0,l=a.length;l>i;i++)if(a[i]===value)return i;return-1};ArrayUtils.lastIndexOf=function(a,value){if(null==a)throw new Error("Parameter a must be non-null.");if(!(a instanceof Array))throw new Error("Parameter a must be an array.");for(var i=a.length-1;i>=0;i--)if(a[i]===value)return i;return-1};ArrayUtils.sort=function(a,comparator){if(null==a)throw new Error("Parameter a must be non-null.");if(!(a instanceof Array))throw new Error("Parameter a must be an array.");if(null!=comparator&&!(comparator instanceof Comparator))throw new Error("Parameter comparator must be an instance of jgatt.utils.Comparator.");comparator||(comparator=_NATURAL_COMPARATOR);var compare=function(value1,value2){return comparator.compare(value1,value2)};a.sort(compare)};ArrayUtils.binarySearch=function(a,value,comparator){if(null==a)throw new Error("Parameter a must be non-null.");if(!(a instanceof Array))throw new Error("Parameter a must be an array.");if(null!=comparator&&!(comparator instanceof Comparator))throw new Error("Parameter comparator must be an instance of jgatt.utils.Comparator.");var high=a.length-1;if(0>high)return-1;comparator||(comparator=_NATURAL_COMPARATOR);for(var mid,comp,low=0;high>=low;){mid=low+Math.floor((high-low)/2);comp=comparator.compare(value,a[mid]);if(0>comp)high=mid-1;else{if(!(comp>0))return mid;low=mid+1}}return-low-1}})})});jg_import.define("jgatt.utils.FunctionComparator",function(){jg_namespace("jgatt.utils",function(){var Comparator=jg_import("jgatt.utils.Comparator");this.FunctionComparator=jg_extend(Comparator,function(){this._f=null;this.constructor=function(f){if(null==f)throw new Error("Parameter f must be non-null.");if("function"!=typeof f)throw new Error("Parameter f must be a function.");this._f=f};this.compare=function(value1,value2){return this._f(value1,value2)}})})});jg_import.define("jgatt.utils.GroupComparator",function(){jg_namespace("jgatt.utils",function(){var Comparator=jg_import("jgatt.utils.Comparator");this.GroupComparator=jg_extend(Comparator,function(){this._comparators=null;this.constructor=function(comparators){if(null==comparators)throw new Error("Parameter comparators must be non-null.");if(!(comparators instanceof Array))throw new Error("Parameter comparators must be an array.");for(var comparator,comparatorsCopy=[],i=0,l=comparators.length;l>i;i++){comparator=comparators[i];if(null!=comparator){if(!(comparator instanceof Comparator))throw new Error("Parameter comparators must be an array containing only instances of jgatt.utils.Comparator.");comparatorsCopy.push(comparator)}}this._comparators=comparatorsCopy};this.compare=function(value1,value2){for(var comparator,result,comparators=this._comparators,i=0,l=comparators.length;l>i;i++){comparator=comparators[i];result=comparator.compare(value1,value2);if(0!=result)return result}return 0}})})});jg_import.define("jgatt.utils.NumericComparator",function(){jg_namespace("jgatt.utils",function(){var Comparator=jg_import("jgatt.utils.Comparator"),NumberUtils=jg_import("jgatt.utils.NumberUtils");this.NumericComparator=jg_extend(Comparator,function(){this.compare=function(value1,value2){var num1=NumberUtils.parseNumber(value1),num2=NumberUtils.parseNumber(value2);return num2>num1?-1:num1>num2?1:0}})})});jg_import.define("jgatt.utils.PropertyComparator",function(){jg_namespace("jgatt.utils",function(){var MPropertyTarget=jg_import("jgatt.properties.MPropertyTarget"),Property=jg_import("jgatt.properties.Property"),Comparator=jg_import("jgatt.utils.Comparator"),NaturalComparator=jg_import("jgatt.utils.NaturalComparator");this.PropertyComparator=jg_extend(Comparator,function(){var _getValue=function(target,property){if(null==target)return void 0;if("string"==typeof property){var value=target[property];if(!(value instanceof Property))return value;property=value}return jg_has_mixin(target,MPropertyTarget)?target.get(property):void 0};this._property=null;this._comparator=null;this.constructor=function(property,comparator){if(null==property)throw new Error("Parameter property must be non-null.");if("string"!=typeof property&&!(property instanceof Property))throw new Error("Parameter property must be a string or an instance of jgatt.properties.Property.");if(null!=comparator&&!(comparator instanceof Comparator))throw new Error("Parameter comparator must be an instance of jgatt.utils.Comparator.");this._property=property;this._comparator=comparator||new NaturalComparator};this.compare=function(value1,value2){var property=this._property;value1=_getValue(value1,property);value2=_getValue(value2,property);return this._comparator.compare(value1,value2)}})})});jg_import.define("jgatt.utils.ReverseComparator",function(){jg_namespace("jgatt.utils",function(){var Comparator=jg_import("jgatt.utils.Comparator"),NaturalComparator=jg_import("jgatt.utils.NaturalComparator");this.ReverseComparator=jg_extend(Comparator,function(){this._comparator=null;this.constructor=function(comparator){if(null!=comparator&&!(comparator instanceof Comparator))throw new Error("Parameter comparator must be an instance of jgatt.utils.Comparator.");this._comparator=comparator||new NaturalComparator};this.compare=function(value1,value2){return-this._comparator.compare(value1,value2)}})})});jg_import.define("jgatt.utils.SequentialNumericComparator",function(){jg_namespace("jgatt.utils",function(){var Comparator=jg_import("jgatt.utils.Comparator");this.SequentialNumericComparator=jg_extend(Comparator,function(){var _NUMERIC_PATTERN=/\d+/g;this.compare=function(value1,value2){for(var num1,num2,str1=String(value1),str2=String(value2),arr1=str1.match(_NUMERIC_PATTERN),arr2=str2.match(_NUMERIC_PATTERN),len1=arr1.length,len2=arr2.length,len=len2>len1?len1:len2,i=0;len>i;i++){num1=Number(arr1[i]);num2=Number(arr2[i]);if(num2>num1)return-1;if(num1>num2)return 1}return len2>len1?-1:len1>len2?1:0}})})});jg_import.define("jgatt.utils.StringUtils",function(){jg_namespace("jgatt.utils",function(){this.StringUtils=jg_static(function(StringUtils){StringUtils.escapeHTML=function(str){if(null==str)return str;str=String(str);return str.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}})})});jg_import.define("jgatt.validation.ValidateEventData",function(){jg_namespace("jgatt.validation",function(){var EventData=jg_import("jgatt.events.EventData");this.ValidateEventData=jg_extend(EventData,function(){this.pass=null;this.constructor=function(pass){this.pass=pass}})})});jg_import.define("jgatt.validation.ValidatePass",function(){jg_namespace("jgatt.validation",function(ns){var ChainedEvent=jg_import("jgatt.events.ChainedEvent"),Event=jg_import("jgatt.events.Event"),Comparator=jg_import("jgatt.utils.Comparator"),ValidateEventData=jg_import("jgatt.validation.ValidateEventData");this.ValidatePass=jg_extend(Object,function(){this.invalidated=null;this.validated=null;this._methodName=null;this._priority=0;this._targetComparator=null;this.constructor=function(methodName,priority,targetComparator){if(null==methodName)throw new Error("Parameter methodName must be non-null.");if("string"!=typeof methodName)throw new Error("Parameter methodName must be a string.");if(null==priority)throw new Error("Parameter priority must be non-null.");if("number"!=typeof priority)throw new Error("Parameter priority must be a number.");if(isNaN(priority))throw new Error("Parameter priority must be a valid number.");if(null!=targetComparator&&!(targetComparator instanceof Comparator))throw new Error("Parameter targetComparator must be an instance of jgatt.utils.Comparator.");this._methodName=methodName;this._priority=priority;this._targetComparator=targetComparator?targetComparator:null;this.invalidated=ns.MValidateTarget?new ChainedEvent("invalidated",ns.MValidateTarget.invalidated):new Event("invalidated",ValidateEventData);this.validated=ns.MValidateTarget?new ChainedEvent("validated",ns.MValidateTarget.validated):new Event("validated",ValidateEventData)};this.methodName=function(){return this._methodName};this.priority=function(){return this._priority};this.targetComparator=function(){return this._targetComparator}})})});jg_import.define("jgatt.validation.ValidateQueue",function(){jg_namespace("jgatt.validation",function(){var ArrayUtils=jg_import("jgatt.utils.ArrayUtils"),Dictionary=jg_import("jgatt.utils.Dictionary"),ErrorUtils=jg_import("jgatt.utils.ErrorUtils");this.ValidateQueue=jg_static(function(ValidateQueue){var _passesMap=new Dictionary,_passesList=[],_validateInterval=0,_validateIndex=-1,_isValidating=!1;ValidateQueue.enqueue=function(target,pass){var targetsMap=_passesMap.get(pass);if(!targetsMap){targetsMap=_passesMap.set(pass,new Dictionary);for(var pass2,passPriority=pass.priority(),passAdded=!1,i=0,l=_passesList.length;l>i;i++){pass2=_passesList[i];if(passPriority<pass2.priority()){_passesList.splice(i,0,pass);_validateIndex>=i&&_validateIndex++;passAdded=!0;break}}passAdded||_passesList.push(pass);_validateInterval||(_validateInterval=setInterval(ValidateQueue.validateAll,1))}targetsMap.set(target,!0)};ValidateQueue.dequeue=function(target,pass){var targetsMap=_passesMap.get(pass);targetsMap&&targetsMap.del(target)};ValidateQueue.contains=function(target,pass){var targetsMap=_passesMap.get(pass);return targetsMap?targetsMap.has(target):!1};ValidateQueue.validateAll=function(){if(_isValidating)return!1;try{_isValidating=!0;var targetsMap,targetsList,targetComparator,pass,i,l;for(_validateIndex=0;_validateIndex<_passesList.length;_validateIndex++){pass=_passesList[_validateIndex];targetsMap=_passesMap.get(pass);targetsList=targetsMap.keys();targetComparator=pass.targetComparator();targetComparator&&ArrayUtils.sort(targetsList,targetComparator);for(i=0,l=targetsList.length;l>i;i++)try{targetsList[i].validate(pass)}catch(e){ErrorUtils.asyncThrow(e)}}_validateIndex=-1;for(i=_passesList.length-1;i>=0;i--){pass=_passesList[i];targetsMap=_passesMap.get(pass);if(!targetsMap||0==targetsMap.size()){_passesMap.del(pass);_passesList.splice(i,1)}}if(0==_passesList.length){clearInterval(_validateInterval);_validateInterval=0}}catch(e){clearInterval(_validateInterval);_validateInterval=0;throw e}finally{_isValidating=!1}return!0};ValidateQueue.isValidating=function(){return _isValidating}})})});jg_import.define("jgatt.validation.MValidateTarget",function(){jg_namespace("jgatt.validation",function(){var Event=jg_import("jgatt.events.Event"),MEventTarget=jg_import("jgatt.events.MEventTarget"),Dictionary=jg_import("jgatt.utils.Dictionary"),ErrorUtils=jg_import("jgatt.utils.ErrorUtils"),ValidateEventData=jg_import("jgatt.validation.ValidateEventData"),ValidatePass=jg_import("jgatt.validation.ValidatePass"),ValidateQueue=jg_import("jgatt.validation.ValidateQueue");this.MValidateTarget=jg_static(function(){this.mixin=function(base){base=jg_mixin(this,MEventTarget,base)};var _resolvePass=function(target,pass){if(null==pass)throw new Error("Parameter pass must be non-null.");if(pass instanceof ValidatePass)return pass;if("string"!=typeof pass)throw new Error("Parameter pass must be a string or an instance of jgatt.validation.ValidatePass.");var targetPass=target[pass];if(!(targetPass instanceof ValidatePass))throw new Error('Unknown pass "'+pass+'".');return targetPass},_passComparator=function(pass1,pass2){var priority1=pass1.priority(),priority2=pass2.priority();return priority2>priority1?-1:priority1>priority2?1:0},_batchValidate=function(target,endPass){if(target._batchValidateList)return!1;var invalidPasses=target._invalidPasses;if(0==invalidPasses.size())return!1;var result=!1;try{target._batchValidateEndPass=endPass;var pass,i,passesList=target._batchValidateList=invalidPasses.keys();if(endPass){var endPassPriority=endPass.priority();for(i=passesList.length-1;i>=0;i--){pass=passesList[i];pass.priority()>=endPassPriority&&passesList.splice(i,1)}}passesList.sort(_passComparator);i=target._batchValidateIndex=0;for(;i<passesList.length;){pass=passesList[i];if(invalidPasses.has(pass))try{result=target.validate(pass)||result}catch(e){ErrorUtils.asyncThrow(e)}i=++target._batchValidateIndex}}finally{target._batchValidateList=null;target._batchValidateIndex=-1;target._batchValidateEndPass=null}return result};this.invalidated=new Event("invalidated",ValidateEventData);this.validated=new Event("validated",ValidateEventData);this._invalidPasses=null;this._validatingPasses=null;this._batchValidateList=null;this._batchValidateIndex=-1;this._batchValidateEndPass=null;this.constructor=function(){this._invalidPasses=new Dictionary;this._validatingPasses=new Dictionary};this.invalidate=function(pass){pass=_resolvePass(this,pass);if(this._invalidPasses.has(pass))return!1;if(this._batchValidateList){var passPriority=pass.priority(),pass2=this._batchValidateEndPass;if(!pass2||passPriority<pass2.priority()){for(var passesList=this._batchValidateList,validateIndex=this._batchValidateIndex,needsAppend=!0,i=validateIndex,l=passesList.length;l>i;i++){pass2=passesList[i];if(passPriority<pass2.priority()){i>validateIndex&&passesList.splice(i,0,pass);needsAppend=!1;break}}needsAppend&&passesList.push(pass)}}this._invalidPasses.set(pass,!0);ValidateQueue.enqueue(this,pass);this.dispatchEvent(pass.invalidated,new ValidateEventData(pass));return!0};this.validate=function(pass){if(null==pass)return _batchValidate(this);pass=_resolvePass(this,pass);if(this._validatingPasses.has(pass))return!1;this.validatePreceding(pass);if(!this._invalidPasses.has(pass))return!1;this._validatingPasses.set(pass,!0);var result=!1;try{var methodName=pass.methodName(),method=this[methodName];if("function"!=typeof method)throw new Error('Unknown method "'+methodName+'".');method.call(this);result=!0}catch(e){ErrorUtils.asyncThrow(e)}this.setValid(pass);return result};this.validatePreceding=function(pass){pass=_resolvePass(this,pass);
return ValidateQueue.isValidating()||this._batchValidateList?!1:_batchValidate(this,pass)};this.setValid=function(pass){if(null==pass){var passesList=this._invalidPasses.keys();passesList.sort(_passComparator);for(var result=!1,i=0,l=passesList.length;l>i;i++){pass=passesList[i];invalidPasses.has(pass)&&(result=this.setValid(pass)||result)}return result}pass=_resolvePass(this,pass);if(!this._invalidPasses.has(pass))return!1;this._invalidPasses.del(pass);this._validatingPasses.del(pass);ValidateQueue.dequeue(this,pass);this.dispatchEvent(pass.validated,new ValidateEventData(pass));return!0};this.isValid=function(pass){if(null==pass)return 0==this._invalidPasses.size();pass=_resolvePass(this,pass);return!this._invalidPasses.has(pass)}})})});define("jgatt",["jg_global"],function(global){return function(){var ret;return ret||global.jgatt}}(this));define("splunk/charting/Legend",["require","jg_global","jg_global","jgatt","jgatt","jgatt","jgatt","jgatt","jgatt","jgatt","jgatt"],function(require){var jg_extend=require("jg_global").jg_extend,jg_mixin=require("jg_global").jg_mixin,ChainedEvent=require("jgatt").events.ChainedEvent,Event=require("jgatt").events.Event,EventData=require("jgatt").events.EventData,MObservable=require("jgatt").events.MObservable,MPropertyTarget=require("jgatt").properties.MPropertyTarget,ObservableProperty=require("jgatt").properties.ObservableProperty,ArrayUtils=require("jgatt").utils.ArrayUtils,Dictionary=require("jgatt").utils.Dictionary;return jg_extend(Object,function(Legend,base){base=jg_mixin(this,MObservable,base);base=jg_mixin(this,MPropertyTarget,base);this.settingLabels=new Event("settingLabels",EventData);this.labelIndexMapChanged=new ChainedEvent("labelIndexMapChanged",this.changed);this.labels=new ObservableProperty("labels",Array,[]).readFilter(function(value){return value.concat()}).writeFilter(function(value){return value?value.concat():[]}).onChanged(function(){this._updateLabelMap()});this._targetMap=null;this._targetList=null;this._labelMap=null;this._labelList=null;this._isSettingLabels=!1;this.constructor=function(){base.constructor.call(this);this._targetMap=new Dictionary;this._targetList=[];this._labelMap={};this._labelList=[]};this.register=function(target){if(null==target)throw new Error("Parameter target must be non-null.");var targetData=this._targetMap.get(target);if(!targetData){targetData={labels:null};this._targetMap.set(target,targetData);this._targetList.push(targetData)}};this.unregister=function(target){if(null==target)throw new Error("Parameter target must be non-null.");var targetData=this._targetMap.get(target);if(targetData){var targetIndex=ArrayUtils.indexOf(this._targetList,targetData);targetIndex>=0&&this._targetList.splice(targetIndex,1);this._targetMap.del(target);this._updateLabelMap()}};this.setLabels=function(target,labels){if(null==target)throw new Error("Parameter target must be non-null.");if(null!=labels&&!(labels instanceof Array))throw new Error("Parameter labels must be an array.");var targetData=this._targetMap.get(target);if(targetData){targetData.labels=labels?labels.concat():null;this.notifySettingLabels()}};this.getLabelIndex=function(label){if(null==label)throw new Error("Parameter label must be non-null.");if("string"!=typeof label)throw new Error("Parameter label must be a string.");var index=this.getLabelIndexOverride(label);if(0>index){var labelIndex=this._labelMap[label];index=null!=labelIndex?labelIndex:-1}return index};this.getNumLabels=function(){var value=this.getNumLabelsOverride();0>value&&(value=this._labelList.length);return value};this.notifySettingLabels=function(){if(!this._isSettingLabels)try{this._isSettingLabels=!0;this.dispatchEvent(this.settingLabels,new EventData);this._updateLabelMap()}finally{this._isSettingLabels=!1}};this.notifyLabelIndexMapChanged=function(){this.dispatchEvent(this.labelIndexMapChanged,new EventData)};this.getNumLabelsOverride=function(){return-1};this.getLabelIndexOverride=function(){return-1};this.updateLabelsOverride=function(){return!1};this._updateLabelMap=function(){var targetData,targetLabels,targetLabel,i,j,l,m,currentLabelList=this._labelList,changed=!1,labelMap={},labelList=[],targetList=this._targetList;targetLabels=this.getInternal(this.labels);for(i=0,l=targetLabels.length;l>i;i++){targetLabel=String(targetLabels[i]);if(null==labelMap[targetLabel]){labelMap[targetLabel]=labelList.length;labelList.push(targetLabel)}}for(i=0,l=targetList.length;l>i;i++){targetData=targetList[i];targetLabels=targetData.labels;if(targetLabels)for(j=0,m=targetLabels.length;m>j;j++){targetLabel=String(targetLabels[j]);if(null==labelMap[targetLabel]){labelMap[targetLabel]=labelList.length;labelList.push(targetLabel)}}}if(labelList.length!=currentLabelList.length)changed=!0;else for(i=0,l=labelList.length;l>i;i++)if(labelList[i]!==currentLabelList[i]){changed=!0;break}if(changed){this._labelMap=labelMap;this._labelList=labelList;this.updateLabelsOverride(labelList.concat())||this.notifyLabelIndexMapChanged()}}})});define("splunk/charting/ExternalLegend",["require","splunk.legend","jg_global","jgatt","splunk/charting/Legend"],function(require){var SplunkLegend=require("splunk.legend"),jg_extend=require("jg_global").jg_extend,FunctionUtils=require("jgatt").utils.FunctionUtils,Legend=require("splunk/charting/Legend");return jg_extend(Legend,function(ExternalLegend,base){var _instanceCount=0;this._id=null;this._isConnected=!1;this._cachedExternalNumLabels=-1;this._cachedExternalLabelMap=null;this.constructor=function(){base.constructor.call(this);this._external_setLabels=FunctionUtils.bind(this._external_setLabels,this);this._external_labelIndexMapChanged=FunctionUtils.bind(this._external_labelIndexMapChanged,this);this._id="splunk-charting-ExternalLegend-"+ ++_instanceCount};this.connect=function(){this.close();SplunkLegend.register(this._id);SplunkLegend.addEventListener("setLabels",this._external_setLabels);SplunkLegend.addEventListener("labelIndexMapChanged",this._external_labelIndexMapChanged);this._isConnected=!0};this.close=function(){if(this._isConnected){this._isConnected=!1;SplunkLegend.removeEventListener("labelIndexMapChanged",this._external_labelIndexMapChanged);SplunkLegend.removeEventListener("setLabels",this._external_setLabels);SplunkLegend.unregister(this._id)}};this.isConnected=function(){return this._isConnected};this.getNumLabelsOverride=function(){if(this._isConnected){var value=this._cachedExternalNumLabels;0>value&&(value=this._cachedExternalNumLabels=SplunkLegend.numLabels());return value}return-1};this.getLabelIndexOverride=function(label){if(this._isConnected){var labelMap=this._cachedExternalLabelMap;labelMap||(labelMap=this._cachedExternalLabelMap={});var index=labelMap[label];null==index&&(index=labelMap[label]=SplunkLegend.getLabelIndex(label));return index}return-1};this.updateLabelsOverride=function(labels){if(this._isConnected){this._cachedExternalNumLabels=-1;this._cachedExternalLabelMap=null;SplunkLegend.setLabels(this._id,labels);return!0}return!1};this._external_setLabels=function(){this.notifySettingLabels()};this._external_labelIndexMapChanged=function(){this._cachedExternalNumLabels=-1;this._cachedExternalLabelMap=null;this.notifyLabelIndexMapChanged()}})});define("contrib/text!contrib/leaflet/leaflet.css",[],function(){return'/* required styles */\n\n.leaflet-map-pane,\n.leaflet-tile,\n.leaflet-marker-icon,\n.leaflet-marker-shadow,\n.leaflet-tile-pane,\n.leaflet-overlay-pane,\n.leaflet-shadow-pane,\n.leaflet-marker-pane,\n.leaflet-popup-pane,\n.leaflet-overlay-pane svg,\n.leaflet-zoom-box,\n.leaflet-image-layer,\n.leaflet-layer { /* TODO optimize classes */\n	position: absolute;\n	}\n.leaflet-container {\n	overflow: hidden;\n	outline: 0;\n	}\n.leaflet-tile,\n.leaflet-marker-icon,\n.leaflet-marker-shadow {\n	-moz-user-select: none;\n	-webkit-user-select: none;\n	user-select: none;\n	}\n.leaflet-marker-icon,\n.leaflet-marker-shadow {\n	display: block;\n	}\n.leaflet-clickable {\n	cursor: pointer;\n	}\n.leaflet-dragging, .leaflet-dragging .leaflet-clickable {\n	cursor: move;\n	}\n.leaflet-container img {\n    /* map is broken in FF if you have max-width: 100% on tiles */\n	max-width: none !important;\n	}\n.leaflet-container img.leaflet-image-layer {\n    /* stupid Android 2 doesn\'t understand "max-width: none" properly */\n    max-width: 15000px !important;\n    }\n\n.leaflet-tile-pane { z-index: 2; }\n.leaflet-objects-pane { z-index: 3; }\n.leaflet-overlay-pane { z-index: 4; }\n.leaflet-shadow-pane { z-index: 5; }\n.leaflet-marker-pane { z-index: 6; }\n.leaflet-popup-pane { z-index: 7; }\n\n.leaflet-tile {\n    filter: inherit;\n    visibility: hidden;\n	}\n.leaflet-tile-loaded {\n	visibility: inherit;\n	}\n\n.leaflet-zoom-box {\n    width: 0;\n    height: 0;\n    }\n\n/* Leaflet controls */\n\n.leaflet-control {\n	position: relative;\n	z-index: 7;\n	pointer-events: auto;\n	}\n.leaflet-top,\n.leaflet-bottom {\n	position: absolute;\n	z-index: 1000;\n	pointer-events: none;\n	}\n.leaflet-top {\n	top: 0;\n	}\n.leaflet-right {\n	right: 0;\n	}\n.leaflet-bottom {\n	bottom: 0;\n	}\n.leaflet-left {\n	left: 0;\n	}\n.leaflet-control {\n	float: left;\n	clear: both;\n	}\n.leaflet-right .leaflet-control {\n	float: right;\n	}\n.leaflet-top .leaflet-control {\n	margin-top: 10px;\n	}\n.leaflet-bottom .leaflet-control {\n	margin-bottom: 10px;\n	}\n.leaflet-left .leaflet-control {\n	margin-left: 10px;\n	}\n.leaflet-right .leaflet-control {\n	margin-right: 10px;\n	}\n\n.leaflet-control-zoom {\n	-moz-border-radius: 7px;\n	-webkit-border-radius: 7px;\n	border-radius: 7px;\n	}\n.leaflet-control-zoom {\n	padding: 5px;\n	background: rgba(0, 0, 0, 0.25);\n	}\n.leaflet-control-zoom a {\n	background-color: rgba(255, 255, 255, 0.75);\n	}\n.leaflet-control-zoom a, .leaflet-control-layers a {\n	background-position: 50% 50%;\n	background-repeat: no-repeat;\n	display: block;\n	}\n.leaflet-control-zoom a {\n	-moz-border-radius: 4px;\n	-webkit-border-radius: 4px;\n	border-radius: 4px;\n	width: 19px;\n	height: 19px;\n	}\n.leaflet-control-zoom a:hover {\n	background-color: #fff;\n	}\n.leaflet-touch .leaflet-control-zoom a {\n	width: 27px;\n	height: 27px;\n	}\n.leaflet-control-zoom-in {\n	background-image: url(images/zoom-in.png);\n	margin-bottom: 5px;\n	}\n.leaflet-control-zoom-out {\n	background-image: url(images/zoom-out.png);\n	}\n\n.leaflet-control-layers {\n	box-shadow: 0 1px 7px #999;\n	background: #f8f8f9;\n	-moz-border-radius: 8px;\n	-webkit-border-radius: 8px;\n	border-radius: 8px;\n	}\n.leaflet-control-layers a {\n	background-image: url(images/layers.png);\n	width: 36px;\n	height: 36px;\n	}\n.leaflet-touch .leaflet-control-layers a {\n	width: 44px;\n	height: 44px;\n	}\n.leaflet-control-layers .leaflet-control-layers-list,\n.leaflet-control-layers-expanded .leaflet-control-layers-toggle {\n	display: none;\n	}\n.leaflet-control-layers-expanded .leaflet-control-layers-list {\n	display: block;\n	position: relative;\n	}\n.leaflet-control-layers-expanded {\n	padding: 6px 10px 6px 6px;\n	font: 12px/1.5 "Helvetica Neue", Arial, Helvetica, sans-serif;\n	color: #333;\n	background: #fff;\n	}\n.leaflet-control-layers input {\n	margin-top: 2px;\n	position: relative;\n	top: 1px;\n	}\n.leaflet-control-layers label {\n	display: block;\n	}\n.leaflet-control-layers-separator {\n	height: 0;\n	border-top: 1px solid #ddd;\n	margin: 5px -10px 5px -6px;\n	}\n\n.leaflet-container .leaflet-control-attribution {\n	background-color: rgba(255, 255, 255, 0.7);\n	box-shadow: 0 0 5px #bbb;\n	margin: 0;\n    }\n\n.leaflet-control-attribution,\n.leaflet-control-scale-line {\n	padding: 0 5px;\n	color: #333;\n	}\n\n.leaflet-container .leaflet-control-attribution,\n.leaflet-container .leaflet-control-scale {\n	font: 11px/1.5 "Helvetica Neue", Arial, Helvetica, sans-serif;\n	}\n\n.leaflet-left .leaflet-control-scale {\n	margin-left: 5px;\n	}\n.leaflet-bottom .leaflet-control-scale {\n	margin-bottom: 5px;\n	}\n\n.leaflet-control-scale-line {\n	border: 2px solid #777;\n	border-top: none;\n	color: black;\n	line-height: 1;\n	font-size: 10px;\n	padding-bottom: 2px;\n	text-shadow: 1px 1px 1px #fff;\n	background-color: rgba(255, 255, 255, 0.5);\n	}\n.leaflet-control-scale-line:not(:first-child) {\n	border-top: 2px solid #777;\n	padding-top: 1px;\n	border-bottom: none;\n	margin-top: -2px;\n	}\n.leaflet-control-scale-line:not(:first-child):not(:last-child) {\n	border-bottom: 2px solid #777;\n	}\n\n.leaflet-touch .leaflet-control-attribution, .leaflet-touch .leaflet-control-layers {\n	box-shadow: none;\n	}\n.leaflet-touch .leaflet-control-layers {\n	border: 5px solid #bbb;\n	}\n\n\n/* Zoom and fade animations */\n\n.leaflet-fade-anim .leaflet-tile, .leaflet-fade-anim .leaflet-popup {\n	opacity: 0;\n\n	-webkit-transition: opacity 0.2s linear;\n	-moz-transition: opacity 0.2s linear;\n	-o-transition: opacity 0.2s linear;\n	transition: opacity 0.2s linear;\n	}\n.leaflet-fade-anim .leaflet-tile-loaded, .leaflet-fade-anim .leaflet-map-pane .leaflet-popup {\n	opacity: 1;\n	}\n\n.leaflet-zoom-anim .leaflet-zoom-animated {\n	-webkit-transition: -webkit-transform 0.25s cubic-bezier(0.25,0.1,0.25,0.75);\n	-moz-transition: -moz-transform 0.25s cubic-bezier(0.25,0.1,0.25,0.75);\n	-o-transition: -o-transform 0.25s cubic-bezier(0.25,0.1,0.25,0.75);\n	transition: transform 0.25s cubic-bezier(0.25,0.1,0.25,0.75);\n	}\n\n.leaflet-zoom-anim .leaflet-tile,\n.leaflet-pan-anim .leaflet-tile,\n.leaflet-touching .leaflet-zoom-animated {\n    -webkit-transition: none;\n    -moz-transition: none;\n    -o-transition: none;\n    transition: none;\n    }\n\n.leaflet-zoom-anim .leaflet-zoom-hide {\n	visibility: hidden;\n	}\n\n\n/* Popup layout */\n\n.leaflet-popup {\n	position: absolute;\n	text-align: center;\n	}\n.leaflet-popup-content-wrapper {\n	padding: 1px;\n	text-align: left;\n	}\n.leaflet-popup-content {\n	margin: 14px 20px;\n	}\n.leaflet-popup-tip-container {\n	margin: 0 auto;\n	width: 40px;\n	height: 20px;\n	position: relative;\n	overflow: hidden;\n	}\n.leaflet-popup-tip {\n	width: 15px;\n	height: 15px;\n	padding: 1px;\n\n	margin: -8px auto 0;\n\n	-moz-transform: rotate(45deg);\n	-webkit-transform: rotate(45deg);\n	-ms-transform: rotate(45deg);\n	-o-transform: rotate(45deg);\n	transform: rotate(45deg);\n	}\n.leaflet-container a.leaflet-popup-close-button {\n	position: absolute;\n	top: 0;\n	right: 0;\n	padding: 4px 5px 0 0;\n	text-align: center;\n	width: 18px;\n	height: 14px;\n	font: 16px/14px Tahoma, Verdana, sans-serif;\n	color: #c3c3c3;\n	text-decoration: none;\n	font-weight: bold;\n	}\n.leaflet-container a.leaflet-popup-close-button:hover {\n	color: #999;\n	}\n.leaflet-popup-content p {\n	margin: 18px 0;\n	}\n.leaflet-popup-scrolled {\n	overflow: auto;\n	border-bottom: 1px solid #ddd;\n	border-top: 1px solid #ddd;\n	}\n\n\n/* Visual appearance */\n\n.leaflet-container {\n	background: #ddd;\n	}\n.leaflet-container a {\n	color: #0078A8;\n	}\n.leaflet-container a.leaflet-active {\n    outline: 2px solid orange;\n    }\n.leaflet-zoom-box {\n	border: 2px dotted #05f;\n	background: white;\n	opacity: 0.5;\n	}\n.leaflet-div-icon {\n    background: #fff;\n    border: 1px solid #666;\n    }\n.leaflet-editing-icon {\n    border-radius: 2px;\n    }\n.leaflet-popup-content-wrapper, .leaflet-popup-tip {\n	background: white;\n\n	box-shadow: 0 3px 10px #888;\n	-moz-box-shadow: 0 3px 10px #888;\n	-webkit-box-shadow: 0 3px 14px #999;\n	}\n.leaflet-popup-content-wrapper {\n	-moz-border-radius: 20px;\n	-webkit-border-radius: 20px;\n	border-radius: 20px;\n	}\n.leaflet-popup-content {\n	font: 12px/1.4 "Helvetica Neue", Arial, Helvetica, sans-serif;\n	}\n'});define("contrib/text!contrib/leaflet/leaflet.ie.css",[],function(){return".leaflet-vml-shape {\n	width: 1px;\n	height: 1px;\n	}\n.lvml {\n	behavior: url(#default#VML); \n	display: inline-block; \n	position: absolute;\n	}\n	\n.leaflet-control {\n	display: inline;\n	}\n\n.leaflet-popup-tip {\n	width: 21px;\n	_width: 27px;\n	margin: 0 auto;\n	_margin-top: -3px;\n	\n	filter: progid:DXImageTransform.Microsoft.Matrix(M11=0.70710678, M12=0.70710678, M21=-0.70710678, M22=0.70710678);\n	-ms-filter: \"progid:DXImageTransform.Microsoft.Matrix(M11=0.70710678, M12=0.70710678, M21=-0.70710678, M22=0.70710678)\";\n	}\n.leaflet-popup-tip-container {\n	margin-top: -1px;\n	}\n.leaflet-popup-content-wrapper, .leaflet-popup-tip {\n	border: 1px solid #bbb;\n	}\n.leaflet-popup-content-wrapper {\n	zoom: 1;\n	}\n\n.leaflet-control-zoom {\n	filter: progid:DXImageTransform.Microsoft.gradient(startColorStr='#3F000000',EndColorStr='#3F000000');\n	}\n.leaflet-control-zoom a {\n	background-color: #eee;\n	}\n.leaflet-control-zoom a:hover {\n	background-color: #fff;\n	}\n.leaflet-control-layers-toggle {\n	}\n.leaflet-control-attribution, .leaflet-control-layers {\n	background: white;\n	}"});!function(e,t){var n,r;typeof exports!=t+""?n=exports:(r=e.L,n={},n.noConflict=function(){return e.L=r,this},e.L=n),n.version="0.4.5",n.Util={extend:function(e){for(var i,t=Array.prototype.slice.call(arguments,1),n=0,r=t.length;r>n;n++){i=t[n]||{};for(var s in i)i.hasOwnProperty(s)&&(e[s]=i[s])}return e},bind:function(e,t){var n=arguments.length>2?Array.prototype.slice.call(arguments,2):null;return function(){return e.apply(t,n||arguments)}},stamp:function(){var e=0,t="_leaflet_id";return function(n){return n[t]=n[t]||++e,n[t]}}(),limitExecByInterval:function(e,t,n){var r,i;return function s(){var o=arguments;r?i=!0:(r=!0,setTimeout(function(){r=!1,i&&(s.apply(n,o),i=!1)},t),e.apply(n,o))}},falseFn:function(){return!1},formatNum:function(e,t){var n=Math.pow(10,t||5);return Math.round(e*n)/n},splitWords:function(e){return e.replace(/^\s+|\s+$/g,"").split(/\s+/)},setOptions:function(e,t){return e.options=n.Util.extend({},e.options,t),e.options},getParamString:function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n+"="+e[n]);return"?"+t.join("&")},template:function(e,t){return e.replace(/\{ *([\w_]+) *\}/g,function(e,n){var r=t[n];if(!t.hasOwnProperty(n))throw Error("No value provided for variable "+e);return r})},emptyImageUrl:"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="},function(){function t(t){var n,r,i=["webkit","moz","o","ms"];for(n=0;n<i.length&&!r;n++)r=e[i[n]+t];return r}function r(t){return e.setTimeout(t,1e3/60)}var i=e.requestAnimationFrame||t("RequestAnimationFrame")||r,s=e.cancelAnimationFrame||t("CancelAnimationFrame")||t("CancelRequestAnimationFrame")||function(t){e.clearTimeout(t)};n.Util.requestAnimFrame=function(t,s,o,u){t=n.Util.bind(t,s);if(!o||i!==r)return i.call(e,t,u);t();return void 0},n.Util.cancelAnimFrame=function(t){t&&s.call(e,t)}}(),n.Class=function(){},n.Class.extend=function(e){var t=function(){this.initialize&&this.initialize.apply(this,arguments)},r=function(){};r.prototype=this.prototype;var i=new r;i.constructor=t,t.prototype=i;for(var s in this)this.hasOwnProperty(s)&&"prototype"!==s&&(t[s]=this[s]);return e.statics&&(n.Util.extend(t,e.statics),delete e.statics),e.includes&&(n.Util.extend.apply(null,[i].concat(e.includes)),delete e.includes),e.options&&i.options&&(e.options=n.Util.extend({},i.options,e.options)),n.Util.extend(i,e),t},n.Class.include=function(e){n.Util.extend(this.prototype,e)},n.Class.mergeOptions=function(e){n.Util.extend(this.prototype.options,e)};var i="_leaflet_events";n.Mixin={},n.Mixin.Events={addEventListener:function(e,t,r){var o,u,a,s=this[i]=this[i]||{};if("object"==typeof e){for(o in e)e.hasOwnProperty(o)&&this.addEventListener(o,e[o],t);return this}e=n.Util.splitWords(e);for(u=0,a=e.length;a>u;u++)s[e[u]]=s[e[u]]||[],s[e[u]].push({action:t,context:r||this});return this},hasEventListeners:function(e){return i in this&&e in this[i]&&this[i][e].length>0},removeEventListener:function(e,t,r){var o,u,a,f,l,s=this[i];if("object"==typeof e){for(o in e)e.hasOwnProperty(o)&&this.removeEventListener(o,e[o],t);return this}e=n.Util.splitWords(e);for(u=0,a=e.length;a>u;u++)if(this.hasEventListeners(e[u])){f=s[e[u]];for(l=f.length-1;l>=0;l--)!(t&&f[l].action!==t||r&&f[l].context!==r||!f.splice(l,1))}return this},fireEvent:function(e,t){if(!this.hasEventListeners(e))return this;for(var r=n.Util.extend({type:e,target:this},t),s=this[i][e].slice(),o=0,u=s.length;u>o;o++)s[o].action.call(s[o].context||this,r);return this}},n.Mixin.Events.on=n.Mixin.Events.addEventListener,n.Mixin.Events.off=n.Mixin.Events.removeEventListener,n.Mixin.Events.fire=n.Mixin.Events.fireEvent,function(){var r=navigator.userAgent.toLowerCase(),i=!!e.ActiveXObject,s=i&&!e.XMLHttpRequest,o=-1!==r.indexOf("webkit"),u=-1!==r.indexOf("gecko"),a=-1!==r.indexOf("chrome"),f=e.opera,l=-1!==r.indexOf("android"),c=-1!==r.search("android [23]"),h=typeof orientation!=t+""?!0:!1,p=document.documentElement,d=i&&"transition"in p.style,v=o&&"WebKitCSSMatrix"in e&&"m11"in new e.WebKitCSSMatrix,m=u&&"MozPerspective"in p.style,g=f&&"OTransition"in p.style,y=!e.L_NO_TOUCH&&function(){var e="ontouchstart";if(e in p)return!0;var t=document.createElement("div"),n=!1;return t.setAttribute?(t.setAttribute(e,"return;"),"function"==typeof t[e]&&(n=!0),t.removeAttribute(e),t=null,n):!1}(),b="devicePixelRatio"in e&&e.devicePixelRatio>1||"matchMedia"in e&&e.matchMedia("(min-resolution:144dpi)").matches;n.Browser={ua:r,ie:i,ie6:s,webkit:o,gecko:u,opera:f,android:l,android23:c,chrome:a,ie3d:d,webkit3d:v,gecko3d:m,opera3d:g,any3d:!e.L_DISABLE_3D&&(d||v||m||g),mobile:h,mobileWebkit:h&&o,mobileWebkit3d:h&&v,mobileOpera:h&&f,touch:y,retina:b}}(),n.Point=function(e,t,n){this.x=n?Math.round(e):e,this.y=n?Math.round(t):t},n.Point.prototype={add:function(e){return this.clone()._add(n.point(e))},_add:function(e){return this.x+=e.x,this.y+=e.y,this},subtract:function(e){return this.clone()._subtract(n.point(e))},_subtract:function(e){return this.x-=e.x,this.y-=e.y,this},divideBy:function(e,t){return new n.Point(this.x/e,this.y/e,t)},multiplyBy:function(e,t){return new n.Point(this.x*e,this.y*e,t)},distanceTo:function(e){e=n.point(e);var t=e.x-this.x,r=e.y-this.y;return Math.sqrt(t*t+r*r)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},clone:function(){return new n.Point(this.x,this.y)},toString:function(){return"Point("+n.Util.formatNum(this.x)+", "+n.Util.formatNum(this.y)+")"}},n.point=function(e,t,r){return e instanceof n.Point?e:e instanceof Array?new n.Point(e[0],e[1]):isNaN(e)?e:new n.Point(e,t,r)},n.Bounds=n.Class.extend({initialize:function(e,t){if(e)for(var n=t?[e,t]:e,r=0,i=n.length;i>r;r++)this.extend(n[r])},extend:function(e){return e=n.point(e),this.min||this.max?(this.min.x=Math.min(e.x,this.min.x),this.max.x=Math.max(e.x,this.max.x),this.min.y=Math.min(e.y,this.min.y),this.max.y=Math.max(e.y,this.max.y)):(this.min=e.clone(),this.max=e.clone()),this},getCenter:function(e){return new n.Point((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,e)},getBottomLeft:function(){return new n.Point(this.min.x,this.max.y)},getTopRight:function(){return new n.Point(this.max.x,this.min.y)},contains:function(e){var t,r;return e="number"==typeof e[0]||e instanceof n.Point?n.point(e):n.bounds(e),e instanceof n.Bounds?(t=e.min,r=e.max):t=r=e,t.x>=this.min.x&&r.x<=this.max.x&&t.y>=this.min.y&&r.y<=this.max.y},intersects:function(e){e=n.bounds(e);var t=this.min,r=this.max,i=e.min,s=e.max,o=s.x>=t.x&&i.x<=r.x,u=s.y>=t.y&&i.y<=r.y;return o&&u}}),n.bounds=function(e,t){return!e||e instanceof n.Bounds?e:new n.Bounds(e,t)},n.Transformation=n.Class.extend({initialize:function(e,t,n,r){this._a=e,this._b=t,this._c=n,this._d=r},transform:function(e,t){return this._transform(e.clone(),t)},_transform:function(e,t){return t=t||1,e.x=t*(this._a*e.x+this._b),e.y=t*(this._c*e.y+this._d),e},untransform:function(e,t){return t=t||1,new n.Point((e.x/t-this._b)/this._a,(e.y/t-this._d)/this._c)}}),n.DomUtil={get:function(e){return"string"==typeof e?document.getElementById(e):e},getStyle:function(e,t){var n=e.style[t];!n&&e.currentStyle&&(n=e.currentStyle[t]);if(!n||"auto"===n){var r=document.defaultView.getComputedStyle(e,null);n=r?r[t]:null}return"auto"===n?null:n},getViewportOffset:function(e){var t=0,r=0,i=e,s=document.body;do{t+=i.offsetTop||0,r+=i.offsetLeft||0;if(i.offsetParent===s&&"absolute"===n.DomUtil.getStyle(i,"position"))break;if("fixed"===n.DomUtil.getStyle(i,"position")){t+=s.scrollTop||0,r+=s.scrollLeft||0;break}i=i.offsetParent}while(i);i=e;do{if(i===s)break;t-=i.scrollTop||0,r-=i.scrollLeft||0,i=i.parentNode}while(i);return new n.Point(r,t)},create:function(e,t,n){var r=document.createElement(e);return r.className=t,n&&n.appendChild(r),r},disableTextSelection:function(){document.selection&&document.selection.empty&&document.selection.empty(),this._onselectstart||(this._onselectstart=document.onselectstart,document.onselectstart=n.Util.falseFn)},enableTextSelection:function(){document.onselectstart=this._onselectstart,this._onselectstart=null},hasClass:function(e,t){return e.className.length>0&&RegExp("(^|\\s)"+t+"(\\s|$)").test(e.className)},addClass:function(e,t){n.DomUtil.hasClass(e,t)||(e.className+=(e.className?" ":"")+t)},removeClass:function(e,t){function n(e,n){return n===t?"":e}e.className=e.className.replace(/(\S+)\s*/g,n).replace(/(^\s+|\s+$)/,"")},setOpacity:function(e,t){if("opacity"in e.style)e.style.opacity=t;else if(n.Browser.ie){var r=!1,i="DXImageTransform.Microsoft.Alpha";try{r=e.filters.item(i)}catch(s){}t=Math.round(100*t),r?(r.Enabled=100!==t,r.Opacity=t):e.style.filter+=" progid:"+i+"(opacity="+t+")"}},testProp:function(e){for(var t=document.documentElement.style,n=0;n<e.length;n++)if(e[n]in t)return e[n];return!1},getTranslateString:function(e){var t=n.Browser.webkit3d,r="translate"+(t?"3d":"")+"(",i=(t?",0":"")+")";return r+e.x+"px,"+e.y+"px"+i},getScaleString:function(e,t){var r=n.DomUtil.getTranslateString(t.add(t.multiplyBy(-1*e))),i=" scale("+e+") ";return r+i},setPosition:function(e,t,r){e._leaflet_pos=t,!r&&n.Browser.any3d?(e.style[n.DomUtil.TRANSFORM]=n.DomUtil.getTranslateString(t),n.Browser.mobileWebkit3d&&(e.style.WebkitBackfaceVisibility="hidden")):(e.style.left=t.x+"px",e.style.top=t.y+"px")},getPosition:function(e){return e._leaflet_pos}},n.Util.extend(n.DomUtil,{TRANSITION:n.DomUtil.testProp(["transition","webkitTransition","OTransition","MozTransition","msTransition"]),TRANSFORM:n.DomUtil.testProp(["transform","WebkitTransform","OTransform","MozTransform","msTransform"])}),n.LatLng=function(e,t,n){var r=parseFloat(e),i=parseFloat(t);if(isNaN(r)||isNaN(i))throw Error("Invalid LatLng object: ("+e+", "+t+")");n!==!0&&(r=Math.max(Math.min(r,90),-90),i=(i+180)%360+(-180>i||180===i?180:-180)),this.lat=r,this.lng=i},n.Util.extend(n.LatLng,{DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,MAX_MARGIN:1e-9}),n.LatLng.prototype={equals:function(e){if(!e)return!1;e=n.latLng(e);var t=Math.max(Math.abs(this.lat-e.lat),Math.abs(this.lng-e.lng));return t<=n.LatLng.MAX_MARGIN},toString:function(){return"LatLng("+n.Util.formatNum(this.lat)+", "+n.Util.formatNum(this.lng)+")"},distanceTo:function(e){e=n.latLng(e);var t=6378137,r=n.LatLng.DEG_TO_RAD,i=(e.lat-this.lat)*r,s=(e.lng-this.lng)*r,o=this.lat*r,u=e.lat*r,a=Math.sin(i/2),f=Math.sin(s/2),l=a*a+f*f*Math.cos(o)*Math.cos(u);return 2*t*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))}},n.latLng=function(e,t,r){return e instanceof n.LatLng?e:e instanceof Array?new n.LatLng(e[0],e[1]):isNaN(e)?e:new n.LatLng(e,t,r)},n.LatLngBounds=n.Class.extend({initialize:function(e,t){if(e)for(var n=t?[e,t]:e,r=0,i=n.length;i>r;r++)this.extend(n[r])},extend:function(e){return e="number"==typeof e[0]||e instanceof n.LatLng?n.latLng(e):n.latLngBounds(e),e instanceof n.LatLng?this._southWest||this._northEast?(this._southWest.lat=Math.min(e.lat,this._southWest.lat),this._southWest.lng=Math.min(e.lng,this._southWest.lng),this._northEast.lat=Math.max(e.lat,this._northEast.lat),this._northEast.lng=Math.max(e.lng,this._northEast.lng)):(this._southWest=new n.LatLng(e.lat,e.lng,!0),this._northEast=new n.LatLng(e.lat,e.lng,!0)):e instanceof n.LatLngBounds&&(this.extend(e._southWest),this.extend(e._northEast)),this},pad:function(e){var t=this._southWest,r=this._northEast,i=Math.abs(t.lat-r.lat)*e,s=Math.abs(t.lng-r.lng)*e;return new n.LatLngBounds(new n.LatLng(t.lat-i,t.lng-s),new n.LatLng(r.lat+i,r.lng+s))},getCenter:function(){return new n.LatLng((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new n.LatLng(this._northEast.lat,this._southWest.lng,!0)},getSouthEast:function(){return new n.LatLng(this._southWest.lat,this._northEast.lng,!0)},contains:function(e){e="number"==typeof e[0]||e instanceof n.LatLng?n.latLng(e):n.latLngBounds(e);var i,s,t=this._southWest,r=this._northEast;return e instanceof n.LatLngBounds?(i=e.getSouthWest(),s=e.getNorthEast()):i=s=e,i.lat>=t.lat&&s.lat<=r.lat&&i.lng>=t.lng&&s.lng<=r.lng},intersects:function(e){e=n.latLngBounds(e);var t=this._southWest,r=this._northEast,i=e.getSouthWest(),s=e.getNorthEast(),o=s.lat>=t.lat&&i.lat<=r.lat,u=s.lng>=t.lng&&i.lng<=r.lng;return o&&u},toBBoxString:function(){var e=this._southWest,t=this._northEast;return[e.lng,e.lat,t.lng,t.lat].join(",")},equals:function(e){return e?(e=n.latLngBounds(e),this._southWest.equals(e.getSouthWest())&&this._northEast.equals(e.getNorthEast())):!1}}),n.latLngBounds=function(e,t){return!e||e instanceof n.LatLngBounds?e:new n.LatLngBounds(e,t)},n.Projection={},n.Projection.SphericalMercator={MAX_LATITUDE:85.0511287798,project:function(e){var t=n.LatLng.DEG_TO_RAD,r=this.MAX_LATITUDE,i=Math.max(Math.min(r,e.lat),-r),s=e.lng*t,o=i*t;return o=Math.log(Math.tan(Math.PI/4+o/2)),new n.Point(s,o)},unproject:function(e){var t=n.LatLng.RAD_TO_DEG,r=e.x*t,i=(2*Math.atan(Math.exp(e.y))-Math.PI/2)*t;return new n.LatLng(i,r,!0)}},n.Projection.LonLat={project:function(e){return new n.Point(e.lng,e.lat)},unproject:function(e){return new n.LatLng(e.y,e.x,!0)}},n.CRS={latLngToPoint:function(e,t){var n=this.projection.project(e),r=this.scale(t);return this.transformation._transform(n,r)},pointToLatLng:function(e,t){var n=this.scale(t),r=this.transformation.untransform(e,n);return this.projection.unproject(r)},project:function(e){return this.projection.project(e)},scale:function(e){return 256*Math.pow(2,e)}},n.CRS.EPSG3857=n.Util.extend({},n.CRS,{code:"EPSG:3857",projection:n.Projection.SphericalMercator,transformation:new n.Transformation(.5/Math.PI,.5,-.5/Math.PI,.5),project:function(e){var t=this.projection.project(e),n=6378137;return t.multiplyBy(n)}}),n.CRS.EPSG900913=n.Util.extend({},n.CRS.EPSG3857,{code:"EPSG:900913"}),n.CRS.EPSG4326=n.Util.extend({},n.CRS,{code:"EPSG:4326",projection:n.Projection.LonLat,transformation:new n.Transformation(1/360,.5,-1/360,.5)}),n.Map=n.Class.extend({includes:n.Mixin.Events,options:{crs:n.CRS.EPSG3857,fadeAnimation:n.DomUtil.TRANSITION&&!n.Browser.android23,trackResize:!0,markerZoomAnimation:n.DomUtil.TRANSITION&&n.Browser.any3d},initialize:function(e,r){r=n.Util.setOptions(this,r),this._initContainer(e),this._initLayout(),this._initHooks(),this._initEvents(),r.maxBounds&&this.setMaxBounds(r.maxBounds),r.center&&r.zoom!==t&&this.setView(n.latLng(r.center),r.zoom,!0),this._initLayers(r.layers)},setView:function(e,t){return this._resetView(n.latLng(e),this._limitZoom(t)),this},setZoom:function(e){return this.setView(this.getCenter(),e)},zoomIn:function(){return this.setZoom(this._zoom+1)},zoomOut:function(){return this.setZoom(this._zoom-1)},fitBounds:function(e){var t=this.getBoundsZoom(e);return this.setView(n.latLngBounds(e).getCenter(),t)},fitWorld:function(){var e=new n.LatLng(-60,-170),t=new n.LatLng(85,179);return this.fitBounds(new n.LatLngBounds(e,t))},panTo:function(e){return this.setView(e,this._zoom)},panBy:function(e){return this.fire("movestart"),this._rawPanBy(n.point(e)),this.fire("move"),this.fire("moveend")},setMaxBounds:function(e){e=n.latLngBounds(e),this.options.maxBounds=e;
if(!e)return this._boundsMinZoom=null,this;var t=this.getBoundsZoom(e,!0);return this._boundsMinZoom=t,this._loaded&&(this._zoom<t?this.setView(e.getCenter(),t):this.panInsideBounds(e)),this},panInsideBounds:function(e){e=n.latLngBounds(e);var t=this.getBounds(),r=this.project(t.getSouthWest()),i=this.project(t.getNorthEast()),s=this.project(e.getSouthWest()),o=this.project(e.getNorthEast()),u=0,a=0;return i.y<o.y&&(a=o.y-i.y),i.x>o.x&&(u=o.x-i.x),r.y>s.y&&(a=s.y-r.y),r.x<s.x&&(u=s.x-r.x),this.panBy(new n.Point(u,a,!0))},addLayer:function(e){var t=n.Util.stamp(e);if(this._layers[t])return this;this._layers[t]=e,e.options&&!isNaN(e.options.maxZoom)&&(this._layersMaxZoom=Math.max(this._layersMaxZoom||0,e.options.maxZoom)),e.options&&!isNaN(e.options.minZoom)&&(this._layersMinZoom=Math.min(this._layersMinZoom||1/0,e.options.minZoom)),this.options.zoomAnimation&&n.TileLayer&&e instanceof n.TileLayer&&(this._tileLayersNum++,this._tileLayersToLoad++,e.on("load",this._onTileLayerLoad,this));var r=function(){e.onAdd(this),this.fire("layeradd",{layer:e})};return this._loaded?r.call(this):this.on("load",r,this),this},removeLayer:function(e){var t=n.Util.stamp(e);return this._layers[t]?(e.onRemove(this),delete this._layers[t],this.options.zoomAnimation&&n.TileLayer&&e instanceof n.TileLayer&&(this._tileLayersNum--,this._tileLayersToLoad--,e.off("load",this._onTileLayerLoad,this)),this.fire("layerremove",{layer:e})):void 0},hasLayer:function(e){var t=n.Util.stamp(e);return this._layers.hasOwnProperty(t)},invalidateSize:function(e){var t=this.getSize();this._sizeChanged=!0,this.options.maxBounds&&this.setMaxBounds(this.options.maxBounds);if(!this._loaded)return this;var r=t.subtract(this.getSize()).divideBy(2,!0);return e===!0?this.panBy(r):(this._rawPanBy(r),this.fire("move"),clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(n.Util.bind(this.fire,this,"moveend"),200)),this},addHandler:function(e,t){return t?(this[e]=new t(this),this.options[e]&&this[e].enable(),this):void 0},getCenter:function(){return this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var e=this.getPixelBounds(),t=this.unproject(e.getBottomLeft()),r=this.unproject(e.getTopRight());return new n.LatLngBounds(t,r)},getMinZoom:function(){var e=this.options.minZoom||0,t=this._layersMinZoom||0,n=this._boundsMinZoom||0;return Math.max(e,t,n)},getMaxZoom:function(){var e=this.options.maxZoom===t?1/0:this.options.maxZoom,n=this._layersMaxZoom===t?1/0:this._layersMaxZoom;return Math.min(e,n)},getBoundsZoom:function(e,t){e=n.latLngBounds(e);var a,f,l,r=this.getSize(),i=this.options.minZoom||0,s=this.getMaxZoom(),o=e.getNorthEast(),u=e.getSouthWest(),c=!0;t&&i--;do i++,f=this.project(o,i),l=this.project(u,i),a=new n.Point(Math.abs(f.x-l.x),Math.abs(l.y-f.y)),c=t?a.x<r.x||a.y<r.y:a.x<=r.x&&a.y<=r.y;while(c&&s>=i);return c&&t?null:t?i:i-1},getSize:function(){(!this._size||this._sizeChanged)&&(this._size=new n.Point(this._container.clientWidth,this._container.clientHeight),this._sizeChanged=!1);return this._size},getPixelBounds:function(){var e=this._getTopLeftPoint();return new n.Bounds(e,e.add(this.getSize()))},getPixelOrigin:function(){return this._initialTopLeftPoint},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(e){var t=this.options.crs;return t.scale(e)/t.scale(this._zoom)},getScaleZoom:function(e){return this._zoom+Math.log(e)/Math.LN2},project:function(e,r){return r=r===t?this._zoom:r,this.options.crs.latLngToPoint(n.latLng(e),r)},unproject:function(e,r){return r=r===t?this._zoom:r,this.options.crs.pointToLatLng(n.point(e),r)},layerPointToLatLng:function(e){var t=n.point(e).add(this._initialTopLeftPoint);return this.unproject(t)},latLngToLayerPoint:function(e){var t=this.project(n.latLng(e))._round();return t._subtract(this._initialTopLeftPoint)},containerPointToLayerPoint:function(e){return n.point(e).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(e){return n.point(e).add(this._getMapPanePos())},containerPointToLatLng:function(e){var t=this.containerPointToLayerPoint(n.point(e));return this.layerPointToLatLng(t)},latLngToContainerPoint:function(e){return this.layerPointToContainerPoint(this.latLngToLayerPoint(n.latLng(e)))},mouseEventToContainerPoint:function(e){return n.DomEvent.getMousePosition(e,this._container)},mouseEventToLayerPoint:function(e){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(e))},mouseEventToLatLng:function(e){return this.layerPointToLatLng(this.mouseEventToLayerPoint(e))},_initContainer:function(e){var t=this._container=n.DomUtil.get(e);if(t._leaflet)throw Error("Map container is already initialized.");t._leaflet=!0},_initLayout:function(){var e=this._container;e.innerHTML="",n.DomUtil.addClass(e,"leaflet-container"),n.Browser.touch&&n.DomUtil.addClass(e,"leaflet-touch"),this.options.fadeAnimation&&n.DomUtil.addClass(e,"leaflet-fade-anim");var t=n.DomUtil.getStyle(e,"position");"absolute"!==t&&"relative"!==t&&"fixed"!==t&&(e.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var e=this._panes={};this._mapPane=e.mapPane=this._createPane("leaflet-map-pane",this._container),this._tilePane=e.tilePane=this._createPane("leaflet-tile-pane",this._mapPane),this._objectsPane=e.objectsPane=this._createPane("leaflet-objects-pane",this._mapPane),e.shadowPane=this._createPane("leaflet-shadow-pane"),e.overlayPane=this._createPane("leaflet-overlay-pane"),e.markerPane=this._createPane("leaflet-marker-pane"),e.popupPane=this._createPane("leaflet-popup-pane");var t=" leaflet-zoom-hide";this.options.markerZoomAnimation||(n.DomUtil.addClass(e.markerPane,t),n.DomUtil.addClass(e.shadowPane,t),n.DomUtil.addClass(e.popupPane,t))},_createPane:function(e,t){return n.DomUtil.create("div",e,t||this._objectsPane)},_initializers:[],_initHooks:function(){var e,t;for(e=0,t=this._initializers.length;t>e;e++)this._initializers[e].call(this)},_initLayers:function(e){e=e?e instanceof Array?e:[e]:[],this._layers={},this._tileLayersNum=0;var t,n;for(t=0,n=e.length;n>t;t++)this.addLayer(e[t])},_resetView:function(e,t,r,i){var s=this._zoom!==t;i||(this.fire("movestart"),s&&this.fire("zoomstart")),this._zoom=t,this._initialTopLeftPoint=this._getNewTopLeftPoint(e),r?this._initialTopLeftPoint._add(this._getMapPanePos()):n.DomUtil.setPosition(this._mapPane,new n.Point(0,0)),this._tileLayersToLoad=this._tileLayersNum,this.fire("viewreset",{hard:!r}),this.fire("move"),(s||i)&&this.fire("zoomend"),this.fire("moveend",{hard:!r}),this._loaded||(this._loaded=!0,this.fire("load"))},_rawPanBy:function(e){n.DomUtil.setPosition(this._mapPane,this._getMapPanePos().subtract(e))},_initEvents:function(){if(n.DomEvent){n.DomEvent.on(this._container,"click",this._onMouseClick,this);var r,i,t=["dblclick","mousedown","mouseup","mouseenter","mouseleave","mousemove","contextmenu"];for(r=0,i=t.length;i>r;r++)n.DomEvent.on(this._container,t[r],this._fireMouseEvent,this);this.options.trackResize&&n.DomEvent.on(e,"resize",this._onResize,this)}},_onResize:function(){n.Util.cancelAnimFrame(this._resizeRequest),this._resizeRequest=n.Util.requestAnimFrame(this.invalidateSize,this,!1,this._container)},_onMouseClick:function(e){!this._loaded||this.dragging&&this.dragging.moved()||(this.fire("preclick"),this._fireMouseEvent(e))},_fireMouseEvent:function(e){if(this._loaded){var t=e.type;t="mouseenter"===t?"mouseover":"mouseleave"===t?"mouseout":t;if(this.hasEventListeners(t)){"contextmenu"===t&&n.DomEvent.preventDefault(e);var r=this.mouseEventToContainerPoint(e),i=this.containerPointToLayerPoint(r),s=this.layerPointToLatLng(i);this.fire(t,{latlng:s,layerPoint:i,containerPoint:r,originalEvent:e})}}},_onTileLayerLoad:function(){this._tileLayersToLoad--,this._tileLayersNum&&!this._tileLayersToLoad&&this._tileBg&&(clearTimeout(this._clearTileBgTimer),this._clearTileBgTimer=setTimeout(n.Util.bind(this._clearTileBg,this),500))},_getMapPanePos:function(){return n.DomUtil.getPosition(this._mapPane)},_getTopLeftPoint:function(){if(!this._loaded)throw Error("Set map center and zoom first.");return this._initialTopLeftPoint.subtract(this._getMapPanePos())},_getNewTopLeftPoint:function(e,t){var n=this.getSize().divideBy(2);return this.project(e,t)._subtract(n)._round()},_latLngToNewLayerPoint:function(e,t,n){var r=this._getNewTopLeftPoint(n,t).add(this._getMapPanePos());return this.project(e,t)._subtract(r)},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize().divideBy(2))},_getCenterOffset:function(e){return this.latLngToLayerPoint(e).subtract(this._getCenterLayerPoint())},_limitZoom:function(e){var t=this.getMinZoom(),n=this.getMaxZoom();return Math.max(t,Math.min(n,e))}}),n.Map.addInitHook=function(e){var t=Array.prototype.slice.call(arguments,1),n="function"==typeof e?e:function(){this[e].apply(this,t)};this.prototype._initializers.push(n)},n.map=function(e,t){return new n.Map(e,t)},n.Projection.Mercator={MAX_LATITUDE:85.0840591556,R_MINOR:6356752.3142,R_MAJOR:6378137,project:function(e){var t=n.LatLng.DEG_TO_RAD,r=this.MAX_LATITUDE,i=Math.max(Math.min(r,e.lat),-r),s=this.R_MAJOR,o=this.R_MINOR,u=e.lng*t*s,a=i*t,f=o/s,l=Math.sqrt(1-f*f),c=l*Math.sin(a);c=Math.pow((1-c)/(1+c),.5*l);var h=Math.tan(.5*(.5*Math.PI-a))/c;return a=-o*Math.log(h),new n.Point(u,a)},unproject:function(e){for(var d,t=n.LatLng.RAD_TO_DEG,r=this.R_MAJOR,i=this.R_MINOR,s=e.x*t/r,o=i/r,u=Math.sqrt(1-o*o),a=Math.exp(-e.y/i),f=Math.PI/2-2*Math.atan(a),l=15,c=1e-7,h=l,p=.1;Math.abs(p)>c&&--h>0;)d=u*Math.sin(f),p=Math.PI/2-2*Math.atan(a*Math.pow((1-d)/(1+d),.5*u))-f,f+=p;return new n.LatLng(f*t,s,!0)}},n.CRS.EPSG3395=n.Util.extend({},n.CRS,{code:"EPSG:3395",projection:n.Projection.Mercator,transformation:function(){var e=n.Projection.Mercator,t=e.R_MAJOR,r=e.R_MINOR;return new n.Transformation(.5/(Math.PI*t),.5,-.5/(Math.PI*r),.5)}()}),n.TileLayer=n.Class.extend({includes:n.Mixin.Events,options:{minZoom:0,maxZoom:18,tileSize:256,subdomains:"abc",errorTileUrl:"",attribution:"",zoomOffset:0,opacity:1,unloadInvisibleTiles:n.Browser.mobile,updateWhenIdle:n.Browser.mobile},initialize:function(e,t){t=n.Util.setOptions(this,t),t.detectRetina&&n.Browser.retina&&t.maxZoom>0&&(t.tileSize=Math.floor(t.tileSize/2),t.zoomOffset++,t.minZoom>0&&t.minZoom--,this.options.maxZoom--),this._url=e;var r=this.options.subdomains;"string"==typeof r&&(this.options.subdomains=r.split(""))},onAdd:function(e){this._map=e,this._initContainer(),this._createTileProto(),e.on({viewreset:this._resetCallback,moveend:this._update},this),this.options.updateWhenIdle||(this._limitedUpdate=n.Util.limitExecByInterval(this._update,150,this),e.on("move",this._limitedUpdate,this)),this._reset(),this._update()},addTo:function(e){return e.addLayer(this),this},onRemove:function(e){e._panes.tilePane.removeChild(this._container),e.off({viewreset:this._resetCallback,moveend:this._update},this),this.options.updateWhenIdle||e.off("move",this._limitedUpdate,this),this._container=null,this._map=null},bringToFront:function(){var e=this._map._panes.tilePane;return this._container&&(e.appendChild(this._container),this._setAutoZIndex(e,Math.max)),this},bringToBack:function(){var e=this._map._panes.tilePane;return this._container&&(e.insertBefore(this._container,e.firstChild),this._setAutoZIndex(e,Math.min)),this},getAttribution:function(){return this.options.attribution},setOpacity:function(e){return this.options.opacity=e,this._map&&this._updateOpacity(),this},setZIndex:function(e){return this.options.zIndex=e,this._updateZIndex(),this},setUrl:function(e,t){return this._url=e,t||this.redraw(),this},redraw:function(){return this._map&&(this._map._panes.tilePane.empty=!1,this._reset(!0),this._update()),this},_updateZIndex:function(){this._container&&this.options.zIndex!==t&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(e,t){for(var i,n=e.getElementsByClassName("leaflet-layer"),r=-t(1/0,-1/0),s=0,o=n.length;o>s;s++)n[s]!==this._container&&(i=parseInt(n[s].style.zIndex,10),isNaN(i)||(r=t(r,i)));this._container.style.zIndex=isFinite(r)?r+t(1,-1):""},_updateOpacity:function(){n.DomUtil.setOpacity(this._container,this.options.opacity);var e,t=this._tiles;if(n.Browser.webkit)for(e in t)t.hasOwnProperty(e)&&(t[e].style.webkitTransform+=" translate(0,0)")},_initContainer:function(){var e=this._map._panes.tilePane;(!this._container||e.empty)&&(this._container=n.DomUtil.create("div","leaflet-layer"),this._updateZIndex(),e.appendChild(this._container),this.options.opacity<1&&this._updateOpacity())},_resetCallback:function(e){this._reset(e.hard)},_reset:function(e){var t,n=this._tiles;for(t in n)n.hasOwnProperty(t)&&this.fire("tileunload",{tile:n[t]});this._tiles={},this._tilesToLoad=0,this.options.reuseTiles&&(this._unusedTiles=[]),e&&this._container&&(this._container.innerHTML=""),this._initContainer()},_update:function(){if(!this._map._panTransition||!this._map._panTransition._inProgress){var t=this._map.getPixelBounds(),r=this._map.getZoom(),i=this.options.tileSize;if(!(r>this.options.maxZoom||r<this.options.minZoom)){var s=new n.Point(Math.floor(t.min.x/i),Math.floor(t.min.y/i)),o=new n.Point(Math.floor(t.max.x/i),Math.floor(t.max.y/i)),u=new n.Bounds(s,o);this._addTilesFromCenterOut(u),(this.options.unloadInvisibleTiles||this.options.reuseTiles)&&this._removeOtherTiles(u)}}},_addTilesFromCenterOut:function(e){var i,s,o,t=[],r=e.getCenter();for(i=e.min.y;i<=e.max.y;i++)for(s=e.min.x;s<=e.max.x;s++)o=new n.Point(s,i),this._tileShouldBeLoaded(o)&&t.push(o);var u=t.length;if(0!==u){t.sort(function(e,t){return e.distanceTo(r)-t.distanceTo(r)});var a=document.createDocumentFragment();this._tilesToLoad||this.fire("loading"),this._tilesToLoad+=u;for(s=0;u>s;s++)this._addTile(t[s],a);this._container.appendChild(a)}},_tileShouldBeLoaded:function(e){if(e.x+":"+e.y in this._tiles)return!1;if(!this.options.continuousWorld){var t=this._getWrapTileNum();if(this.options.noWrap&&(e.x<0||e.x>=t)||e.y<0||e.y>=t)return!1}return!0},_removeOtherTiles:function(e){var t,n,r,i;for(i in this._tiles)this._tiles.hasOwnProperty(i)&&(t=i.split(":"),n=parseInt(t[0],10),r=parseInt(t[1],10),(n<e.min.x||n>e.max.x||r<e.min.y||r>e.max.y)&&this._removeTile(i))},_removeTile:function(e){var t=this._tiles[e];this.fire("tileunload",{tile:t,url:t.src}),this.options.reuseTiles?(n.DomUtil.removeClass(t,"leaflet-tile-loaded"),this._unusedTiles.push(t)):t.parentNode===this._container&&this._container.removeChild(t),n.Browser.android||(t.src=n.Util.emptyImageUrl),delete this._tiles[e]},_addTile:function(e,t){var r=this._getTilePos(e),i=this._getTile();n.DomUtil.setPosition(i,r,n.Browser.chrome||n.Browser.android23),this._tiles[e.x+":"+e.y]=i,this._loadTile(i,e),i.parentNode!==this._container&&t.appendChild(i)},_getZoomForUrl:function(){var e=this.options,t=this._map.getZoom();return e.zoomReverse&&(t=e.maxZoom-t),t+e.zoomOffset},_getTilePos:function(e){var t=this._map.getPixelOrigin(),n=this.options.tileSize;return e.multiplyBy(n).subtract(t)},getTileUrl:function(e){return this._adjustTilePoint(e),n.Util.template(this._url,n.Util.extend({s:this._getSubdomain(e),z:this._getZoomForUrl(),x:e.x,y:e.y},this.options))},_getWrapTileNum:function(){return Math.pow(2,this._getZoomForUrl())},_adjustTilePoint:function(e){var t=this._getWrapTileNum();!this.options.continuousWorld&&!this.options.noWrap&&(e.x=(e.x%t+t)%t),this.options.tms&&(e.y=t-e.y-1)},_getSubdomain:function(e){var t=(e.x+e.y)%this.options.subdomains.length;return this.options.subdomains[t]},_createTileProto:function(){var e=this._tileImg=n.DomUtil.create("img","leaflet-tile");e.galleryimg="no";var t=this.options.tileSize;e.style.width=t+"px",e.style.height=t+"px"},_getTile:function(){if(this.options.reuseTiles&&this._unusedTiles.length>0){var e=this._unusedTiles.pop();return this._resetTile(e),e}return this._createTile()},_resetTile:function(){},_createTile:function(){var e=this._tileImg.cloneNode(!1);return e.onselectstart=e.onmousemove=n.Util.falseFn,e},_loadTile:function(e,t){e._layer=this,e.onload=this._tileOnLoad,e.onerror=this._tileOnError,e.src=this.getTileUrl(t)},_tileLoaded:function(){this._tilesToLoad--,this._tilesToLoad||this.fire("load")},_tileOnLoad:function(){var t=this._layer;this.src!==n.Util.emptyImageUrl&&(n.DomUtil.addClass(this,"leaflet-tile-loaded"),t.fire("tileload",{tile:this,url:this.src})),t._tileLoaded()},_tileOnError:function(){var t=this._layer;t.fire("tileerror",{tile:this,url:this.src});var n=t.options.errorTileUrl;n&&(this.src=n),t._tileLoaded()}}),n.tileLayer=function(e,t){return new n.TileLayer(e,t)},n.TileLayer.WMS=n.TileLayer.extend({defaultWmsParams:{service:"WMS",request:"GetMap",version:"1.1.1",layers:"",styles:"",format:"image/jpeg",transparent:!1},initialize:function(e,t){this._url=e;var r=n.Util.extend({},this.defaultWmsParams);r.width=r.height=t.detectRetina&&n.Browser.retina?2*this.options.tileSize:this.options.tileSize;for(var i in t)this.options.hasOwnProperty(i)||(r[i]=t[i]);this.wmsParams=r,n.Util.setOptions(this,t)},onAdd:function(e){var t=parseFloat(this.wmsParams.version)>=1.3?"crs":"srs";this.wmsParams[t]=e.options.crs.code,n.TileLayer.prototype.onAdd.call(this,e)},getTileUrl:function(e,t){var r=this._map,i=r.options.crs,s=this.options.tileSize,o=e.multiplyBy(s),u=o.add(new n.Point(s,s)),a=i.project(r.unproject(o,t)),f=i.project(r.unproject(u,t)),l=[a.x,f.y,f.x,a.y].join(","),c=n.Util.template(this._url,{s:this._getSubdomain(e)});return c+n.Util.getParamString(this.wmsParams)+"&bbox="+l},setParams:function(e,t){return n.Util.extend(this.wmsParams,e),t||this.redraw(),this}}),n.tileLayer.wms=function(e,t){return new n.TileLayer.WMS(e,t)},n.TileLayer.Canvas=n.TileLayer.extend({options:{async:!1},initialize:function(e){n.Util.setOptions(this,e)},redraw:function(){var e,t=this._tiles;for(e in t)t.hasOwnProperty(e)&&this._redrawTile(t[e])},_redrawTile:function(e){this.drawTile(e,e._tilePoint,e._zoom)},_createTileProto:function(){var e=this._canvasProto=n.DomUtil.create("canvas","leaflet-tile"),t=this.options.tileSize;e.width=t,e.height=t},_createTile:function(){var e=this._canvasProto.cloneNode(!1);return e.onselectstart=e.onmousemove=n.Util.falseFn,e},_loadTile:function(e,t,n){e._layer=this,e._tilePoint=t,e._zoom=n,this.drawTile(e,t,n),this.options.async||this.tileDrawn(e)},drawTile:function(){},tileDrawn:function(e){this._tileOnLoad.call(e)}}),n.tileLayer.canvas=function(e){return new n.TileLayer.Canvas(e)},n.ImageOverlay=n.Class.extend({includes:n.Mixin.Events,options:{opacity:1},initialize:function(e,t,r){this._url=e,this._bounds=n.latLngBounds(t),n.Util.setOptions(this,r)},onAdd:function(e){this._map=e,this._image||this._initImage(),e._panes.overlayPane.appendChild(this._image),e.on("viewreset",this._reset,this),e.options.zoomAnimation&&n.Browser.any3d&&e.on("zoomanim",this._animateZoom,this),this._reset()},onRemove:function(e){e.getPanes().overlayPane.removeChild(this._image),e.off("viewreset",this._reset,this),e.options.zoomAnimation&&e.off("zoomanim",this._animateZoom,this)},addTo:function(e){return e.addLayer(this),this},setOpacity:function(e){return this.options.opacity=e,this._updateOpacity(),this},bringToFront:function(){return this._image&&this._map._panes.overlayPane.appendChild(this._image),this},bringToBack:function(){var e=this._map._panes.overlayPane;return this._image&&e.insertBefore(this._image,e.firstChild),this},_initImage:function(){this._image=n.DomUtil.create("img","leaflet-image-layer"),this._map.options.zoomAnimation&&n.Browser.any3d?n.DomUtil.addClass(this._image,"leaflet-zoom-animated"):n.DomUtil.addClass(this._image,"leaflet-zoom-hide"),this._updateOpacity(),n.Util.extend(this._image,{galleryimg:"no",onselectstart:n.Util.falseFn,onmousemove:n.Util.falseFn,onload:n.Util.bind(this._onImageLoad,this),src:this._url})},_animateZoom:function(e){var t=this._map,r=this._image,i=t.getZoomScale(e.zoom),s=this._bounds.getNorthWest(),o=this._bounds.getSouthEast(),u=t._latLngToNewLayerPoint(s,e.zoom,e.center),a=t._latLngToNewLayerPoint(o,e.zoom,e.center).subtract(u),f=t.latLngToLayerPoint(o).subtract(t.latLngToLayerPoint(s)),l=u.add(a.subtract(f).divideBy(2));r.style[n.DomUtil.TRANSFORM]=n.DomUtil.getTranslateString(l)+" scale("+i+") "},_reset:function(){var e=this._image,t=this._map.latLngToLayerPoint(this._bounds.getNorthWest()),r=this._map.latLngToLayerPoint(this._bounds.getSouthEast()).subtract(t);n.DomUtil.setPosition(e,t),e.style.width=r.x+"px",e.style.height=r.y+"px"},_onImageLoad:function(){this.fire("load")},_updateOpacity:function(){n.DomUtil.setOpacity(this._image,this.options.opacity)}}),n.imageOverlay=function(e,t,r){return new n.ImageOverlay(e,t,r)},n.Icon=n.Class.extend({options:{className:""},initialize:function(e){n.Util.setOptions(this,e)},createIcon:function(){return this._createIcon("icon")},createShadow:function(){return this._createIcon("shadow")},_createIcon:function(e){var t=this._getIconUrl(e);if(!t){if("icon"===e)throw Error("iconUrl not set in Icon options (see the docs).");return null}var n=this._createImg(t);return this._setIconStyles(n,e),n},_setIconStyles:function(e,t){var s,r=this.options,i=n.point(r[t+"Size"]);s=n.point("shadow"===t?r.shadowAnchor||r.iconAnchor:r.iconAnchor),!s&&i&&(s=i.divideBy(2,!0)),e.className="leaflet-marker-"+t+" "+r.className,s&&(e.style.marginLeft=-s.x+"px",e.style.marginTop=-s.y+"px"),i&&(e.style.width=i.x+"px",e.style.height=i.y+"px")},_createImg:function(e){var t;return n.Browser.ie6?(t=document.createElement("div"),t.style.filter='progid:DXImageTransform.Microsoft.AlphaImageLoader(src="'+e+'")'):(t=document.createElement("img"),t.src=e),t},_getIconUrl:function(e){return this.options[e+"Url"]}}),n.icon=function(e){return new n.Icon(e)},n.Icon.Default=n.Icon.extend({options:{iconSize:new n.Point(25,41),iconAnchor:new n.Point(13,41),popupAnchor:new n.Point(1,-34),shadowSize:new n.Point(41,41)},_getIconUrl:function(e){var t=e+"Url";if(this.options[t])return this.options[t];var r=n.Icon.Default.imagePath;if(!r)throw Error("Couldn't autodetect L.Icon.Default.imagePath, set it manually.");return r+"/marker-"+e+".png"}}),n.Icon.Default.imagePath=function(){var n,r,i,s,e=document.getElementsByTagName("script"),t=/\/?leaflet[\-\._]?([\w\-\._]*)\.js\??/;for(n=0,r=e.length;r>n;n++){i=e[n].src,s=i.match(t);if(s)return i.split(t)[0]+"/images"}}(),n.Marker=n.Class.extend({includes:n.Mixin.Events,options:{icon:new n.Icon.Default,title:"",clickable:!0,draggable:!1,zIndexOffset:0,opacity:1},initialize:function(e,t){n.Util.setOptions(this,t),this._latlng=n.latLng(e)},onAdd:function(e){this._map=e,e.on("viewreset",this.update,this),this._initIcon(),this.update(),e.options.zoomAnimation&&e.options.markerZoomAnimation&&e.on("zoomanim",this._animateZoom,this)},addTo:function(e){return e.addLayer(this),this},onRemove:function(e){this._removeIcon(),this.closePopup&&this.closePopup(),e.off({viewreset:this.update,zoomanim:this._animateZoom},this),this._map=null},getLatLng:function(){return this._latlng},setLatLng:function(e){this._latlng=n.latLng(e),this.update(),this._popup&&this._popup.setLatLng(e)},setZIndexOffset:function(e){this.options.zIndexOffset=e,this.update()},setIcon:function(e){this._map&&this._removeIcon(),this.options.icon=e,this._map&&(this._initIcon(),this.update())},update:function(){if(this._icon){var e=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(e)}},_initIcon:function(){var e=this.options,t=this._map,r=t.options.zoomAnimation&&t.options.markerZoomAnimation,i=r?"leaflet-zoom-animated":"leaflet-zoom-hide",s=!1;this._icon||(this._icon=e.icon.createIcon(),e.title&&(this._icon.title=e.title),this._initInteraction(),s=this.options.opacity<1,n.DomUtil.addClass(this._icon,i)),this._shadow||(this._shadow=e.icon.createShadow(),this._shadow&&(n.DomUtil.addClass(this._shadow,i),s=this.options.opacity<1)),s&&this._updateOpacity();var o=this._map._panes;o.markerPane.appendChild(this._icon),this._shadow&&o.shadowPane.appendChild(this._shadow)},_removeIcon:function(){var e=this._map._panes;e.markerPane.removeChild(this._icon),this._shadow&&e.shadowPane.removeChild(this._shadow),this._icon=this._shadow=null},_setPos:function(e){n.DomUtil.setPosition(this._icon,e),this._shadow&&n.DomUtil.setPosition(this._shadow,e),this._icon.style.zIndex=e.y+this.options.zIndexOffset},_animateZoom:function(e){var t=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center);this._setPos(t)},_initInteraction:function(){if(this.options.clickable){var e=this._icon,t=["dblclick","mousedown","mouseover","mouseout"];n.DomUtil.addClass(e,"leaflet-clickable"),n.DomEvent.on(e,"click",this._onMouseClick,this);for(var r=0;r<t.length;r++)n.DomEvent.on(e,t[r],this._fireMouseEvent,this);n.Handler.MarkerDrag&&(this.dragging=new n.Handler.MarkerDrag(this),this.options.draggable&&this.dragging.enable())}},_onMouseClick:function(e){n.DomEvent.stopPropagation(e);this.dragging&&this.dragging.moved()||this._map.dragging&&this._map.dragging.moved()||this.fire(e.type,{originalEvent:e})},_fireMouseEvent:function(e){this.fire(e.type,{originalEvent:e}),"mousedown"!==e.type&&n.DomEvent.stopPropagation(e)},setOpacity:function(e){this.options.opacity=e,this._map&&this._updateOpacity()},_updateOpacity:function(){n.DomUtil.setOpacity(this._icon,this.options.opacity),this._shadow&&n.DomUtil.setOpacity(this._shadow,this.options.opacity)}}),n.marker=function(e,t){return new n.Marker(e,t)},n.DivIcon=n.Icon.extend({options:{iconSize:new n.Point(12,12),className:"leaflet-div-icon"},createIcon:function(){var e=document.createElement("div"),t=this.options;return t.html&&(e.innerHTML=t.html),t.bgPos&&(e.style.backgroundPosition=-t.bgPos.x+"px "+-t.bgPos.y+"px"),this._setIconStyles(e,"icon"),e},createShadow:function(){return null}}),n.divIcon=function(e){return new n.DivIcon(e)},n.Map.mergeOptions({closePopupOnClick:!0}),n.Popup=n.Class.extend({includes:n.Mixin.Events,options:{minWidth:50,maxWidth:300,maxHeight:null,autoPan:!0,closeButton:!0,offset:new n.Point(0,6),autoPanPadding:new n.Point(5,5),className:""},initialize:function(e,t){n.Util.setOptions(this,e),this._source=t},onAdd:function(e){this._map=e,this._container||this._initLayout(),this._updateContent();var t=e.options.fadeAnimation;t&&n.DomUtil.setOpacity(this._container,0),e._panes.popupPane.appendChild(this._container),e.on("viewreset",this._updatePosition,this),n.Browser.any3d&&e.on("zoomanim",this._zoomAnimation,this),e.options.closePopupOnClick&&e.on("preclick",this._close,this),this._update(),t&&n.DomUtil.setOpacity(this._container,1)},addTo:function(e){return e.addLayer(this),this},openOn:function(e){return e.openPopup(this),this},onRemove:function(e){e._panes.popupPane.removeChild(this._container),n.Util.falseFn(this._container.offsetWidth),e.off({viewreset:this._updatePosition,preclick:this._close,zoomanim:this._zoomAnimation},this),e.options.fadeAnimation&&n.DomUtil.setOpacity(this._container,0),this._map=null},setLatLng:function(e){return this._latlng=n.latLng(e),this._update(),this},setContent:function(e){return this._content=e,this._update(),this},_close:function(){var e=this._map;e&&(e._popup=null,e.removeLayer(this).fire("popupclose",{popup:this}))},_initLayout:function(){var r,e="leaflet-popup",t=this._container=n.DomUtil.create("div",e+" "+this.options.className+" leaflet-zoom-animated");this.options.closeButton&&(r=this._closeButton=n.DomUtil.create("a",e+"-close-button",t),r.href="#close",r.innerHTML="&#215;",n.DomEvent.on(r,"click",this._onCloseButtonClick,this));var i=this._wrapper=n.DomUtil.create("div",e+"-content-wrapper",t);n.DomEvent.disableClickPropagation(i),this._contentNode=n.DomUtil.create("div",e+"-content",i),n.DomEvent.on(this._contentNode,"mousewheel",n.DomEvent.stopPropagation),this._tipContainer=n.DomUtil.create("div",e+"-tip-container",t),this._tip=n.DomUtil.create("div",e+"-tip",this._tipContainer)},_update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},_updateContent:function(){if(this._content){if("string"==typeof this._content)this._contentNode.innerHTML=this._content;else{for(;this._contentNode.hasChildNodes();)this._contentNode.removeChild(this._contentNode.firstChild);this._contentNode.appendChild(this._content)}this.fire("contentupdate")}},_updateLayout:function(){var e=this._contentNode,t=e.style;t.width="",t.whiteSpace="nowrap";var r=e.offsetWidth;r=Math.min(r,this.options.maxWidth),r=Math.max(r,this.options.minWidth),t.width=r+1+"px",t.whiteSpace="",t.height="";var i=e.offsetHeight,s=this.options.maxHeight,o="leaflet-popup-scrolled";s&&i>s?(t.height=s+"px",n.DomUtil.addClass(e,o)):n.DomUtil.removeClass(e,o),this._containerWidth=this._container.offsetWidth},_updatePosition:function(){var e=this._map.latLngToLayerPoint(this._latlng),t=n.Browser.any3d,r=this.options.offset;t&&n.DomUtil.setPosition(this._container,e),this._containerBottom=-r.y-(t?0:e.y),this._containerLeft=-Math.round(this._containerWidth/2)+r.x+(t?0:e.x),this._container.style.bottom=this._containerBottom+"px",this._container.style.left=this._containerLeft+"px"},_zoomAnimation:function(e){var t=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center);n.DomUtil.setPosition(this._container,t)},_adjustPan:function(){if(this.options.autoPan){var e=this._map,t=this._container.offsetHeight,r=this._containerWidth,i=new n.Point(this._containerLeft,-t-this._containerBottom);n.Browser.any3d&&i._add(n.DomUtil.getPosition(this._container));var s=e.layerPointToContainerPoint(i),o=this.options.autoPanPadding,u=e.getSize(),a=0,f=0;s.x<0&&(a=s.x-o.x),s.x+r>u.x&&(a=s.x+r-u.x+o.x),s.y<0&&(f=s.y-o.y),s.y+t>u.y&&(f=s.y+t-u.y+o.y),(a||f)&&e.panBy(new n.Point(a,f))}},_onCloseButtonClick:function(e){this._close(),n.DomEvent.stop(e)}}),n.popup=function(e,t){return new n.Popup(e,t)},n.Marker.include({openPopup:function(){return this._popup&&this._map&&(this._popup.setLatLng(this._latlng),this._map.openPopup(this._popup)),this},closePopup:function(){return this._popup&&this._popup._close(),this},bindPopup:function(e,t){var r=n.point(this.options.icon.options.popupAnchor)||new n.Point(0,0);return r=r.add(n.Popup.prototype.options.offset),t&&t.offset&&(r=r.add(t.offset)),t=n.Util.extend({offset:r},t),this._popup||this.on("click",this.openPopup,this),this._popup=new n.Popup(t,this).setContent(e),this},unbindPopup:function(){return this._popup&&(this._popup=null,this.off("click",this.openPopup)),this}}),n.Map.include({openPopup:function(e){return this.closePopup(),this._popup=e,this.addLayer(e).fire("popupopen",{popup:this._popup})},closePopup:function(){return this._popup&&this._popup._close(),this}}),n.LayerGroup=n.Class.extend({initialize:function(e){this._layers={};var t,n;if(e)for(t=0,n=e.length;n>t;t++)this.addLayer(e[t])},addLayer:function(e){var t=n.Util.stamp(e);return this._layers[t]=e,this._map&&this._map.addLayer(e),this},removeLayer:function(e){var t=n.Util.stamp(e);return delete this._layers[t],this._map&&this._map.removeLayer(e),this},clearLayers:function(){return this.eachLayer(this.removeLayer,this),this},invoke:function(e){var n,r,t=Array.prototype.slice.call(arguments,1);for(n in this._layers)this._layers.hasOwnProperty(n)&&(r=this._layers[n],r[e]&&r[e].apply(r,t));return this},onAdd:function(e){this._map=e,this.eachLayer(e.addLayer,e)},onRemove:function(e){this.eachLayer(e.removeLayer,e),this._map=null},addTo:function(e){return e.addLayer(this),this},eachLayer:function(e,t){for(var n in this._layers)this._layers.hasOwnProperty(n)&&e.call(t,this._layers[n])}}),n.layerGroup=function(e){return new n.LayerGroup(e)},n.FeatureGroup=n.LayerGroup.extend({includes:n.Mixin.Events,addLayer:function(e){return this._layers[n.Util.stamp(e)]?this:(e.on("click dblclick mouseover mouseout mousemove contextmenu",this._propagateEvent,this),n.LayerGroup.prototype.addLayer.call(this,e),this._popupContent&&e.bindPopup&&e.bindPopup(this._popupContent),this)
},removeLayer:function(e){return e.off("click dblclick mouseover mouseout mousemove contextmenu",this._propagateEvent,this),n.LayerGroup.prototype.removeLayer.call(this,e),this._popupContent?this.invoke("unbindPopup"):this},bindPopup:function(e){return this._popupContent=e,this.invoke("bindPopup",e)},setStyle:function(e){return this.invoke("setStyle",e)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var e=new n.LatLngBounds;return this.eachLayer(function(t){e.extend(t instanceof n.Marker?t.getLatLng():t.getBounds())},this),e},_propagateEvent:function(e){e.layer=e.target,e.target=this,this.fire(e.type,e)}}),n.featureGroup=function(e){return new n.FeatureGroup(e)},n.Path=n.Class.extend({includes:[n.Mixin.Events],statics:{CLIP_PADDING:n.Browser.mobile?Math.max(0,Math.min(.5,(1280/Math.max(e.innerWidth,e.innerHeight)-1)/2)):.5},options:{stroke:!0,color:"#0033ff",dashArray:null,weight:5,opacity:.5,fill:!1,fillColor:null,fillOpacity:.2,clickable:!0},initialize:function(e){n.Util.setOptions(this,e)},onAdd:function(e){this._map=e,this._container||(this._initElements(),this._initEvents()),this.projectLatlngs(),this._updatePath(),this._container&&this._map._pathRoot.appendChild(this._container),e.on({viewreset:this.projectLatlngs,moveend:this._updatePath},this)},addTo:function(e){return e.addLayer(this),this},onRemove:function(e){e._pathRoot.removeChild(this._container),this._map=null,n.Browser.vml&&(this._container=null,this._stroke=null,this._fill=null),e.off({viewreset:this.projectLatlngs,moveend:this._updatePath},this)},projectLatlngs:function(){},setStyle:function(e){return n.Util.setOptions(this,e),this._container&&this._updateStyle(),this},redraw:function(){return this._map&&(this.projectLatlngs(),this._updatePath()),this}}),n.Map.include({_updatePathViewport:function(){var e=n.Path.CLIP_PADDING,t=this.getSize(),r=n.DomUtil.getPosition(this._mapPane),i=r.multiplyBy(-1)._subtract(t.multiplyBy(e)),s=i.add(t.multiplyBy(1+2*e));this._pathViewport=new n.Bounds(i,s)}}),n.Path.SVG_NS="http://www.w3.org/2000/svg",n.Browser.svg=!!document.createElementNS&&!!document.createElementNS(n.Path.SVG_NS,"svg").createSVGRect,n.Path=n.Path.extend({statics:{SVG:n.Browser.svg},bringToFront:function(){return this._container&&this._map._pathRoot.appendChild(this._container),this},bringToBack:function(){if(this._container){var e=this._map._pathRoot;e.insertBefore(this._container,e.firstChild)}return this},getPathString:function(){},_createElement:function(e){return document.createElementNS(n.Path.SVG_NS,e)},_initElements:function(){this._map._initPathRoot(),this._initPath(),this._initStyle()},_initPath:function(){this._container=this._createElement("g"),this._path=this._createElement("path"),this._container.appendChild(this._path)},_initStyle:function(){this.options.stroke&&(this._path.setAttribute("stroke-linejoin","round"),this._path.setAttribute("stroke-linecap","round")),this.options.fill&&this._path.setAttribute("fill-rule","evenodd"),this._updateStyle()},_updateStyle:function(){this.options.stroke?(this._path.setAttribute("stroke",this.options.color),this._path.setAttribute("stroke-opacity",this.options.opacity),this._path.setAttribute("stroke-width",this.options.weight),this.options.dashArray?this._path.setAttribute("stroke-dasharray",this.options.dashArray):this._path.removeAttribute("stroke-dasharray")):this._path.setAttribute("stroke","none"),this.options.fill?(this._path.setAttribute("fill",this.options.fillColor||this.options.color),this._path.setAttribute("fill-opacity",this.options.fillOpacity)):this._path.setAttribute("fill","none")},_updatePath:function(){var e=this.getPathString();e||(e="M0 0"),this._path.setAttribute("d",e)},_initEvents:function(){if(this.options.clickable){(n.Browser.svg||!n.Browser.vml)&&this._path.setAttribute("class","leaflet-clickable"),n.DomEvent.on(this._container,"click",this._onMouseClick,this);for(var e=["dblclick","mousedown","mouseover","mouseout","mousemove","contextmenu"],t=0;t<e.length;t++)n.DomEvent.on(this._container,e[t],this._fireMouseEvent,this)}},_onMouseClick:function(e){this._map.dragging&&this._map.dragging.moved()||(this._fireMouseEvent(e),n.DomEvent.stopPropagation(e))},_fireMouseEvent:function(e){if(this.hasEventListeners(e.type)){"contextmenu"===e.type&&n.DomEvent.preventDefault(e);var t=this._map,r=t.mouseEventToContainerPoint(e),i=t.containerPointToLayerPoint(r),s=t.layerPointToLatLng(i);this.fire(e.type,{latlng:s,layerPoint:i,containerPoint:r,originalEvent:e})}}}),n.Map.include({_initPathRoot:function(){this._pathRoot||(this._pathRoot=n.Path.prototype._createElement("svg"),this._panes.overlayPane.appendChild(this._pathRoot),this.options.zoomAnimation&&n.Browser.any3d?(this._pathRoot.setAttribute("class"," leaflet-zoom-animated"),this.on({zoomanim:this._animatePathZoom,zoomend:this._endPathZoom})):this._pathRoot.setAttribute("class"," leaflet-zoom-hide"),this.on("moveend",this._updateSvgViewport),this._updateSvgViewport())},_animatePathZoom:function(e){var t=this.getZoomScale(e.zoom),r=this._getCenterOffset(e.center).divideBy(1-1/t),i=this.containerPointToLayerPoint(this.getSize().multiplyBy(-n.Path.CLIP_PADDING)),s=i.add(r).round();this._pathRoot.style[n.DomUtil.TRANSFORM]=n.DomUtil.getTranslateString(s.multiplyBy(-1).add(n.DomUtil.getPosition(this._pathRoot)).multiplyBy(t).add(s))+" scale("+t+") ",this._pathZooming=!0},_endPathZoom:function(){this._pathZooming=!1},_updateSvgViewport:function(){if(!this._pathZooming){this._updatePathViewport();var e=this._pathViewport,t=e.min,r=e.max,i=r.x-t.x,s=r.y-t.y,o=this._pathRoot,u=this._panes.overlayPane;n.Browser.mobileWebkit&&u.removeChild(o),n.DomUtil.setPosition(o,t),o.setAttribute("width",i),o.setAttribute("height",s),o.setAttribute("viewBox",[t.x,t.y,i,s].join(" ")),n.Browser.mobileWebkit&&u.appendChild(o)}}}),n.Path.include({bindPopup:function(e,t){this._popup&&this._popup.options===t||(this._popup=new n.Popup(t,this));return this._popup.setContent(e),this._openPopupAdded||(this.on("click",this._openPopup,this),this._openPopupAdded=!0),this},openPopup:function(e){return this._popup&&(e=e||this._latlng||this._latlngs[Math.floor(this._latlngs.length/2)],this._openPopup({latlng:e})),this},_openPopup:function(e){this._popup.setLatLng(e.latlng),this._map.openPopup(this._popup)}}),n.Browser.vml=function(){try{var e=document.createElement("div");e.innerHTML='<v:shape adj="1"/>';var t=e.firstChild;return t.style.behavior="url(#default#VML)",t&&"object"==typeof t.adj}catch(n){return!1}}(),n.Path=n.Browser.svg||!n.Browser.vml?n.Path:n.Path.extend({statics:{VML:!0,CLIP_PADDING:.02},_createElement:function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(e){return document.createElement("<lvml:"+e+' class="lvml">')}}catch(e){return function(e){return document.createElement("<"+e+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}}(),_initPath:function(){var e=this._container=this._createElement("shape");n.DomUtil.addClass(e,"leaflet-vml-shape"),this.options.clickable&&n.DomUtil.addClass(e,"leaflet-clickable"),e.coordsize="1 1",this._path=this._createElement("path"),e.appendChild(this._path),this._map._pathRoot.appendChild(e)},_initStyle:function(){this._updateStyle()},_updateStyle:function(){var e=this._stroke,t=this._fill,n=this.options,r=this._container;r.stroked=n.stroke,r.filled=n.fill,n.stroke?(e||(e=this._stroke=this._createElement("stroke"),e.endcap="round",r.appendChild(e)),e.weight=n.weight+"px",e.color=n.color,e.opacity=n.opacity,e.dashStyle=n.dashArray?n.dashArray.replace(/ *, */g," "):""):e&&(r.removeChild(e),this._stroke=null),n.fill?(t||(t=this._fill=this._createElement("fill"),r.appendChild(t)),t.color=n.fillColor||n.color,t.opacity=n.fillOpacity):t&&(r.removeChild(t),this._fill=null)},_updatePath:function(){var e=this._container.style;e.display="none",this._path.v=this.getPathString()+" ",e.display=""}}),n.Map.include(n.Browser.svg||!n.Browser.vml?{}:{_initPathRoot:function(){if(!this._pathRoot){var e=this._pathRoot=document.createElement("div");e.className="leaflet-vml-container",this._panes.overlayPane.appendChild(e),this.on("moveend",this._updatePathViewport),this._updatePathViewport()}}}),n.Browser.canvas=function(){return!!document.createElement("canvas").getContext}(),n.Path=n.Path.SVG&&!e.L_PREFER_CANVAS||!n.Browser.canvas?n.Path:n.Path.extend({statics:{CANVAS:!0,SVG:!1},redraw:function(){return this._map&&(this.projectLatlngs(),this._requestUpdate()),this},setStyle:function(e){return n.Util.setOptions(this,e),this._map&&(this._updateStyle(),this._requestUpdate()),this},onRemove:function(e){e.off("viewreset",this.projectLatlngs,this).off("moveend",this._updatePath,this),this._requestUpdate(),this._map=null},_requestUpdate:function(){this._map&&(n.Util.cancelAnimFrame(this._fireMapMoveEnd),this._updateRequest=n.Util.requestAnimFrame(this._fireMapMoveEnd,this._map))},_fireMapMoveEnd:function(){this.fire("moveend")},_initElements:function(){this._map._initPathRoot(),this._ctx=this._map._canvasCtx},_updateStyle:function(){var e=this.options;e.stroke&&(this._ctx.lineWidth=e.weight,this._ctx.strokeStyle=e.color),e.fill&&(this._ctx.fillStyle=e.fillColor||e.color)},_drawPath:function(){var e,t,r,i,s,o;this._ctx.beginPath();for(e=0,r=this._parts.length;r>e;e++){for(t=0,i=this._parts[e].length;i>t;t++)s=this._parts[e][t],o=(0===t?"move":"line")+"To",this._ctx[o](s.x,s.y);this instanceof n.Polygon&&this._ctx.closePath()}},_checkIfEmpty:function(){return!this._parts.length},_updatePath:function(){if(!this._checkIfEmpty()){var e=this._ctx,t=this.options;this._drawPath(),e.save(),this._updateStyle(),t.fill&&(t.fillOpacity<1&&(e.globalAlpha=t.fillOpacity),e.fill()),t.stroke&&(t.opacity<1&&(e.globalAlpha=t.opacity),e.stroke()),e.restore()}},_initEvents:function(){this.options.clickable&&this._map.on("click",this._onClick,this)},_onClick:function(e){this._containsPoint(e.layerPoint)&&this.fire("click",e)}}),n.Map.include(n.Path.SVG&&!e.L_PREFER_CANVAS||!n.Browser.canvas?{}:{_initPathRoot:function(){var t,e=this._pathRoot;e||(e=this._pathRoot=document.createElement("canvas"),e.style.position="absolute",t=this._canvasCtx=e.getContext("2d"),t.lineCap="round",t.lineJoin="round",this._panes.overlayPane.appendChild(e),this.options.zoomAnimation&&(this._pathRoot.className="leaflet-zoom-animated",this.on("zoomanim",this._animatePathZoom),this.on("zoomend",this._endPathZoom)),this.on("moveend",this._updateCanvasViewport),this._updateCanvasViewport())},_updateCanvasViewport:function(){if(!this._pathZooming){this._updatePathViewport();var e=this._pathViewport,t=e.min,r=e.max.subtract(t),i=this._pathRoot;n.DomUtil.setPosition(i,t),i.width=r.x,i.height=r.y,i.getContext("2d").translate(-t.x,-t.y)}}}),n.LineUtil={simplify:function(e,t){if(!t||!e.length)return e.slice();var n=t*t;return e=this._reducePoints(e,n),e=this._simplifyDP(e,n)},pointToSegmentDistance:function(e,t,n){return Math.sqrt(this._sqClosestPointOnSegment(e,t,n,!0))},closestPointOnSegment:function(e,t,n){return this._sqClosestPointOnSegment(e,t,n)},_simplifyDP:function(e,n){var r=e.length,i=typeof Uint8Array!=t+""?Uint8Array:Array,s=new i(r);s[0]=s[r-1]=1,this._simplifyDPStep(e,s,n,0,r-1);var o,u=[];for(o=0;r>o;o++)s[o]&&u.push(e[o]);return u},_simplifyDPStep:function(e,t,n,r,i){var o,u,a,s=0;for(u=r+1;i-1>=u;u++)a=this._sqClosestPointOnSegment(e[u],e[r],e[i],!0),a>s&&(o=u,s=a);s>n&&(t[o]=1,this._simplifyDPStep(e,t,n,r,o),this._simplifyDPStep(e,t,n,o,i))},_reducePoints:function(e,t){for(var n=[e[0]],r=1,i=0,s=e.length;s>r;r++)this._sqDist(e[r],e[i])>t&&(n.push(e[r]),i=r);return s-1>i&&n.push(e[s-1]),n},clipSegment:function(e,t,n,r){var o=(n.min,n.max,r?this._lastCode:this._getBitCode(e,n)),u=this._getBitCode(t,n);this._lastCode=u;for(;;){if(!(o|u))return[e,t];if(o&u)return!1;var a=o||u,f=this._getEdgeIntersection(e,t,a,n),l=this._getBitCode(f,n);a===o?(e=f,o=l):(t=f,u=l)}},_getEdgeIntersection:function(e,t,r,i){var s=t.x-e.x,o=t.y-e.y,u=i.min,a=i.max;return 8&r?new n.Point(e.x+s*(a.y-e.y)/o,a.y):4&r?new n.Point(e.x+s*(u.y-e.y)/o,u.y):2&r?new n.Point(a.x,e.y+o*(a.x-e.x)/s):1&r?new n.Point(u.x,e.y+o*(u.x-e.x)/s):void 0},_getBitCode:function(e,t){var n=0;return e.x<t.min.x?n|=1:e.x>t.max.x&&(n|=2),e.y<t.min.y?n|=4:e.y>t.max.y&&(n|=8),n},_sqDist:function(e,t){var n=t.x-e.x,r=t.y-e.y;return n*n+r*r},_sqClosestPointOnSegment:function(e,t,r,i){var l,s=t.x,o=t.y,u=r.x-s,a=r.y-o,f=u*u+a*a;return f>0&&(l=((e.x-s)*u+(e.y-o)*a)/f,l>1?(s=r.x,o=r.y):l>0&&(s+=u*l,o+=a*l)),u=e.x-s,a=e.y-o,i?u*u+a*a:new n.Point(s,o)}},n.Polyline=n.Path.extend({initialize:function(e,t){n.Path.prototype.initialize.call(this,t),this._latlngs=this._convertLatLngs(e),n.Handler.PolyEdit&&(this.editing=new n.Handler.PolyEdit(this),this.options.editable&&this.editing.enable())},options:{smoothFactor:1,noClip:!1},projectLatlngs:function(){this._originalPoints=[];for(var e=0,t=this._latlngs.length;t>e;e++)this._originalPoints[e]=this._map.latLngToLayerPoint(this._latlngs[e])},getPathString:function(){for(var e=0,t=this._parts.length,n="";t>e;e++)n+=this._getPathPartStr(this._parts[e]);return n},getLatLngs:function(){return this._latlngs},setLatLngs:function(e){return this._latlngs=this._convertLatLngs(e),this.redraw()},addLatLng:function(e){return this._latlngs.push(n.latLng(e)),this.redraw()},spliceLatLngs:function(){var n=[].splice.apply(this._latlngs,arguments);return this._convertLatLngs(this._latlngs),this.redraw(),n},closestLayerPoint:function(e){for(var i,s,t=1/0,r=this._parts,o=null,u=0,a=r.length;a>u;u++)for(var f=r[u],l=1,c=f.length;c>l;l++){i=f[l-1],s=f[l];var h=n.LineUtil._sqClosestPointOnSegment(e,i,s,!0);t>h&&(t=h,o=n.LineUtil._sqClosestPointOnSegment(e,i,s))}return o&&(o.distance=Math.sqrt(t)),o},getBounds:function(){for(var e=new n.LatLngBounds,t=this.getLatLngs(),r=0,i=t.length;i>r;r++)e.extend(t[r]);return e},onAdd:function(e){n.Path.prototype.onAdd.call(this,e),this.editing&&this.editing.enabled()&&this.editing.addHooks()},onRemove:function(e){this.editing&&this.editing.enabled()&&this.editing.removeHooks(),n.Path.prototype.onRemove.call(this,e)},_convertLatLngs:function(e){var t,r;for(t=0,r=e.length;r>t;t++){if(e[t]instanceof Array&&"number"!=typeof e[t][0])return;e[t]=n.latLng(e[t])}return e},_initEvents:function(){n.Path.prototype._initEvents.call(this)},_getPathPartStr:function(e){for(var o,t=n.Path.VML,r=0,i=e.length,s="";i>r;r++)o=e[r],t&&o._round(),s+=(r?"L":"M")+o.x+" "+o.y;return s},_clipPoints:function(){var r,i,s,e=this._originalPoints,t=e.length;if(this.options.noClip)this._parts=[e];else{this._parts=[];var o=this._parts,u=this._map._pathViewport,a=n.LineUtil;for(r=0,i=0;t-1>r;r++){s=a.clipSegment(e[r],e[r+1],u,r);if(s){o[i]=o[i]||[],o[i].push(s[0]);(s[1]!==e[r+1]||r===t-2)&&(o[i].push(s[1]),i++)}}}},_simplifyPoints:function(){for(var e=this._parts,t=n.LineUtil,r=0,i=e.length;i>r;r++)e[r]=t.simplify(e[r],this.options.smoothFactor)},_updatePath:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),n.Path.prototype._updatePath.call(this))}}),n.polyline=function(e,t){return new n.Polyline(e,t)},n.PolyUtil={},n.PolyUtil.clipPolygon=function(e,t){var s,u,a,f,l,c,h,p,d,o=(t.min,t.max,[1,4,2,8]),v=n.LineUtil;for(u=0,h=e.length;h>u;u++)e[u]._code=v._getBitCode(e[u],t);for(f=0;4>f;f++){p=o[f],s=[];for(u=0,h=e.length,a=h-1;h>u;a=u++)l=e[u],c=e[a],l._code&p?c._code&p||(d=v._getEdgeIntersection(c,l,p,t),d._code=v._getBitCode(d,t),s.push(d)):(c._code&p&&(d=v._getEdgeIntersection(c,l,p,t),d._code=v._getBitCode(d,t),s.push(d)),s.push(l));e=s}return e},n.Polygon=n.Polyline.extend({options:{fill:!0},initialize:function(e,t){n.Polyline.prototype.initialize.call(this,e,t),e&&e[0]instanceof Array&&"number"!=typeof e[0][0]&&(this._latlngs=this._convertLatLngs(e[0]),this._holes=e.slice(1))},projectLatlngs:function(){n.Polyline.prototype.projectLatlngs.call(this),this._holePoints=[];if(this._holes)for(var e=0,t=this._holes.length;t>e;e++){this._holePoints[e]=[];for(var i=0,s=this._holes[e].length;s>i;i++)this._holePoints[e][i]=this._map.latLngToLayerPoint(this._holes[e][i])}},_clipPoints:function(){var e=this._originalPoints,t=[];this._parts=[e].concat(this._holePoints);if(!this.options.noClip){for(var r=0,i=this._parts.length;i>r;r++){var s=n.PolyUtil.clipPolygon(this._parts[r],this._map._pathViewport);s.length&&t.push(s)}this._parts=t}},_getPathPartStr:function(e){var t=n.Polyline.prototype._getPathPartStr.call(this,e);return t+(n.Browser.svg?"z":"x")}}),n.polygon=function(e,t){return new n.Polygon(e,t)},function(){function e(e){return n.FeatureGroup.extend({initialize:function(e,t){this._layers={},this._options=t,this.setLatLngs(e)},setLatLngs:function(t){var n=0,r=t.length;this.eachLayer(function(e){r>n?e.setLatLngs(t[n++]):this.removeLayer(e)},this);for(;r>n;)this.addLayer(new e(t[n++],this._options));return this}})}n.MultiPolyline=e(n.Polyline),n.MultiPolygon=e(n.Polygon),n.multiPolyline=function(e,t){return new n.MultiPolyline(e,t)},n.multiPolygon=function(e,t){return new n.MultiPolygon(e,t)}}(),n.Rectangle=n.Polygon.extend({initialize:function(e,t){n.Polygon.prototype.initialize.call(this,this._boundsToLatLngs(e),t)},setBounds:function(e){this.setLatLngs(this._boundsToLatLngs(e))},_boundsToLatLngs:function(e){return e=n.latLngBounds(e),[e.getSouthWest(),e.getNorthWest(),e.getNorthEast(),e.getSouthEast(),e.getSouthWest()]}}),n.rectangle=function(e,t){return new n.Rectangle(e,t)},n.Circle=n.Path.extend({initialize:function(e,t,r){n.Path.prototype.initialize.call(this,r),this._latlng=n.latLng(e),this._mRadius=t},options:{fill:!0},setLatLng:function(e){return this._latlng=n.latLng(e),this.redraw()},setRadius:function(e){return this._mRadius=e,this.redraw()},projectLatlngs:function(){var e=this._getLngRadius(),t=new n.LatLng(this._latlng.lat,this._latlng.lng-e,!0),r=this._map.latLngToLayerPoint(t);this._point=this._map.latLngToLayerPoint(this._latlng),this._radius=Math.max(Math.round(this._point.x-r.x),1)},getBounds:function(){var e=this._map,t=this._radius*Math.cos(Math.PI/4),r=e.project(this._latlng),i=new n.Point(r.x-t,r.y+t),s=new n.Point(r.x+t,r.y-t),o=e.unproject(i),u=e.unproject(s);return new n.LatLngBounds(o,u)},getLatLng:function(){return this._latlng},getPathString:function(){var e=this._point,t=this._radius;return this._checkIfEmpty()?"":n.Browser.svg?"M"+e.x+","+(e.y-t)+"A"+t+","+t+",0,1,1,"+(e.x-.1)+","+(e.y-t)+" z":(e._round(),t=Math.round(t),"AL "+e.x+","+e.y+" "+t+","+t+" 0,23592600")},getRadius:function(){return this._mRadius},_getLngRadius:function(){var e=40075017,t=e*Math.cos(n.LatLng.DEG_TO_RAD*this._latlng.lat);return this._mRadius/t*360},_checkIfEmpty:function(){if(!this._map)return!1;var e=this._map._pathViewport,t=this._radius,n=this._point;return n.x-t>e.max.x||n.y-t>e.max.y||n.x+t<e.min.x||n.y+t<e.min.y}}),n.circle=function(e,t,r){return new n.Circle(e,t,r)},n.CircleMarker=n.Circle.extend({options:{radius:10,weight:2},initialize:function(e,t){n.Circle.prototype.initialize.call(this,e,null,t),this._radius=this.options.radius},projectLatlngs:function(){this._point=this._map.latLngToLayerPoint(this._latlng)},setRadius:function(e){return this._radius=e,this.redraw()}}),n.circleMarker=function(e,t){return new n.CircleMarker(e,t)},n.Polyline.include(n.Path.CANVAS?{_containsPoint:function(e,t){var r,i,s,o,u,a,f,l=this.options.weight/2;n.Browser.touch&&(l+=10);for(r=0,o=this._parts.length;o>r;r++){f=this._parts[r];for(i=0,u=f.length,s=u-1;u>i;s=i++)if(t||0!==i){a=n.LineUtil.pointToSegmentDistance(e,f[s],f[i]);if(l>=a)return!0}}return!1}}:{}),n.Polygon.include(n.Path.CANVAS?{_containsPoint:function(e){var r,i,s,o,u,a,f,l,t=!1;if(n.Polyline.prototype._containsPoint.call(this,e,!0))return!0;for(o=0,f=this._parts.length;f>o;o++){r=this._parts[o];for(u=0,l=r.length,a=l-1;l>u;a=u++)i=r[u],s=r[a],i.y>e.y!=s.y>e.y&&e.x<(s.x-i.x)*(e.y-i.y)/(s.y-i.y)+i.x&&(t=!t)}return t}}:{}),n.Circle.include(n.Path.CANVAS?{_drawPath:function(){var e=this._point;this._ctx.beginPath(),this._ctx.arc(e.x,e.y,this._radius,0,2*Math.PI,!1)},_containsPoint:function(e){var t=this._point,n=this.options.stroke?this.options.weight/2:0;return e.distanceTo(t)<=this._radius+n}}:{}),n.GeoJSON=n.FeatureGroup.extend({initialize:function(e,t){n.Util.setOptions(this,t),this._layers={},e&&this.addData(e)},addData:function(e){var r,i,t=e instanceof Array?e:e.features;if(t){for(r=0,i=t.length;i>r;r++)this.addData(t[r]);return this}var s=this.options;if(!s.filter||s.filter(e)){var o=n.GeoJSON.geometryToLayer(e,s.pointToLayer);return o.feature=e,this.resetStyle(o),s.onEachFeature&&s.onEachFeature(e,o),this.addLayer(o)}},resetStyle:function(e){var t=this.options.style;t&&this._setLayerStyle(e,t)},setStyle:function(e){this.eachLayer(function(t){this._setLayerStyle(t,e)},this)},_setLayerStyle:function(e,t){"function"==typeof t&&(t=t(e.feature)),e.setStyle&&e.setStyle(t)}}),n.Util.extend(n.GeoJSON,{geometryToLayer:function(e,t){var o,u,a,f,l,r="Feature"===e.type?e.geometry:e,i=r.coordinates,s=[];switch(r.type){case"Point":return o=this.coordsToLatLng(i),t?t(e,o):new n.Marker(o);case"MultiPoint":for(a=0,f=i.length;f>a;a++)o=this.coordsToLatLng(i[a]),l=t?t(e,o):new n.Marker(o),s.push(l);return new n.FeatureGroup(s);case"LineString":return u=this.coordsToLatLngs(i),new n.Polyline(u);case"Polygon":return u=this.coordsToLatLngs(i,1),new n.Polygon(u);case"MultiLineString":return u=this.coordsToLatLngs(i,1),new n.MultiPolyline(u);case"MultiPolygon":return u=this.coordsToLatLngs(i,2),new n.MultiPolygon(u);case"GeometryCollection":for(a=0,f=r.geometries.length;f>a;a++)l=this.geometryToLayer(r.geometries[a],t),s.push(l);return new n.FeatureGroup(s);default:throw Error("Invalid GeoJSON object.")}},coordsToLatLng:function(e,t){var r=parseFloat(e[t?0:1]),i=parseFloat(e[t?1:0]);return new n.LatLng(r,i,!0)},coordsToLatLngs:function(e,t,n){var r,s,o,i=[];for(s=0,o=e.length;o>s;s++)r=t?this.coordsToLatLngs(e[s],t-1,n):this.coordsToLatLng(e[s],n),i.push(r);return i}}),n.geoJson=function(e,t){return new n.GeoJSON(e,t)},n.DomEvent={addListener:function(e,t,r,i){var u,a,f,s=n.Util.stamp(r),o="_leaflet_"+t+s;return e[o]?this:(u=function(t){return r.call(i||e,t||n.DomEvent._getEvent())},n.Browser.touch&&"dblclick"===t&&this.addDoubleTapListener?this.addDoubleTapListener(e,u,s):("addEventListener"in e?"mousewheel"===t?(e.addEventListener("DOMMouseScroll",u,!1),e.addEventListener(t,u,!1)):"mouseenter"===t||"mouseleave"===t?(a=u,f="mouseenter"===t?"mouseover":"mouseout",u=function(t){return n.DomEvent._checkMouse(e,t)?a(t):void 0},e.addEventListener(f,u,!1)):e.addEventListener(t,u,!1):"attachEvent"in e&&e.attachEvent("on"+t,u),e[o]=u,this))},removeListener:function(e,t,r){var i=n.Util.stamp(r),s="_leaflet_"+t+i,o=e[s];return o?(n.Browser.touch&&"dblclick"===t&&this.removeDoubleTapListener?this.removeDoubleTapListener(e,i):"removeEventListener"in e?"mousewheel"===t?(e.removeEventListener("DOMMouseScroll",o,!1),e.removeEventListener(t,o,!1)):"mouseenter"===t||"mouseleave"===t?e.removeEventListener("mouseenter"===t?"mouseover":"mouseout",o,!1):e.removeEventListener(t,o,!1):"detachEvent"in e&&e.detachEvent("on"+t,o),e[s]=null,this):void 0},stopPropagation:function(e){return e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,this},disableClickPropagation:function(e){var t=n.DomEvent.stopPropagation;return n.DomEvent.addListener(e,n.Draggable.START,t).addListener(e,"click",t).addListener(e,"dblclick",t)},preventDefault:function(e){return e.preventDefault?e.preventDefault():e.returnValue=!1,this},stop:function(e){return n.DomEvent.preventDefault(e).stopPropagation(e)},getMousePosition:function(e,t){var r=document.body,i=document.documentElement,s=e.pageX?e.pageX:e.clientX+r.scrollLeft+i.scrollLeft,o=e.pageY?e.pageY:e.clientY+r.scrollTop+i.scrollTop,u=new n.Point(s,o);return t?u._subtract(n.DomUtil.getViewportOffset(t)):u},getWheelDelta:function(e){var t=0;return e.wheelDelta&&(t=e.wheelDelta/120),e.detail&&(t=-e.detail/3),t},_checkMouse:function(e,t){var n=t.relatedTarget;if(!n)return!0;try{for(;n&&n!==e;)n=n.parentNode}catch(r){return!1}return n!==e},_getEvent:function(){var t=e.event;if(!t)for(var n=arguments.callee.caller;n;){t=n.arguments[0];if(t&&e.Event===t.constructor)break;n=n.caller}return t}},n.DomEvent.on=n.DomEvent.addListener,n.DomEvent.off=n.DomEvent.removeListener,n.Draggable=n.Class.extend({includes:n.Mixin.Events,statics:{START:n.Browser.touch?"touchstart":"mousedown",END:n.Browser.touch?"touchend":"mouseup",MOVE:n.Browser.touch?"touchmove":"mousemove",TAP_TOLERANCE:15},initialize:function(e,t){this._element=e,this._dragStartTarget=t||e},enable:function(){this._enabled||(n.DomEvent.on(this._dragStartTarget,n.Draggable.START,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(n.DomEvent.off(this._dragStartTarget,n.Draggable.START,this._onDown),this._enabled=!1,this._moved=!1)},_onDown:function(e){if(!(!n.Browser.touch&&e.shiftKey||1!==e.which&&1!==e.button&&!e.touches)){this._simulateClick=!0;if(e.touches&&e.touches.length>1)this._simulateClick=!1;else{var t=e.touches&&1===e.touches.length?e.touches[0]:e,r=t.target;n.DomEvent.preventDefault(e),n.Browser.touch&&"a"===r.tagName.toLowerCase()&&n.DomUtil.addClass(r,"leaflet-active"),this._moved=!1;this._moving||(this._startPos=this._newPos=n.DomUtil.getPosition(this._element),this._startPoint=new n.Point(t.clientX,t.clientY),n.DomEvent.on(document,n.Draggable.MOVE,this._onMove,this),n.DomEvent.on(document,n.Draggable.END,this._onUp,this))}}},_onMove:function(e){if(!(e.touches&&e.touches.length>1)){var t=e.touches&&1===e.touches.length?e.touches[0]:e,r=new n.Point(t.clientX,t.clientY),i=r.subtract(this._startPoint);(i.x||i.y)&&(n.DomEvent.preventDefault(e),this._moved||(this.fire("dragstart"),this._moved=!0,n.Browser.touch||(n.DomUtil.disableTextSelection(),this._setMovingCursor())),this._newPos=this._startPos.add(i),this._moving=!0,n.Util.cancelAnimFrame(this._animRequest),this._animRequest=n.Util.requestAnimFrame(this._updatePosition,this,!0,this._dragStartTarget))}},_updatePosition:function(){this.fire("predrag"),n.DomUtil.setPosition(this._element,this._newPos),this.fire("drag")},_onUp:function(e){if(this._simulateClick&&e.changedTouches){var t=e.changedTouches[0],r=t.target,i=this._newPos&&this._newPos.distanceTo(this._startPos)||0;"a"===r.tagName.toLowerCase()&&n.DomUtil.removeClass(r,"leaflet-active"),i<n.Draggable.TAP_TOLERANCE&&this._simulateEvent("click",t)}n.Browser.touch||(n.DomUtil.enableTextSelection(),this._restoreCursor()),n.DomEvent.off(document,n.Draggable.MOVE,this._onMove),n.DomEvent.off(document,n.Draggable.END,this._onUp),this._moved&&(n.Util.cancelAnimFrame(this._animRequest),this.fire("dragend")),this._moving=!1},_setMovingCursor:function(){n.DomUtil.addClass(document.body,"leaflet-dragging")},_restoreCursor:function(){n.DomUtil.removeClass(document.body,"leaflet-dragging")},_simulateEvent:function(t,n){var r=document.createEvent("MouseEvents");r.initMouseEvent(t,!0,!0,e,1,n.screenX,n.screenY,n.clientX,n.clientY,!1,!1,!1,!1,0,null),n.target.dispatchEvent(r)}}),n.Handler=n.Class.extend({initialize:function(e){this._map=e},enable:function(){this._enabled||(this._enabled=!0,this.addHooks())},disable:function(){this._enabled&&(this._enabled=!1,this.removeHooks())},enabled:function(){return!!this._enabled}}),n.Map.mergeOptions({dragging:!0,inertia:!n.Browser.android23,inertiaDeceleration:3e3,inertiaMaxSpeed:1500,inertiaThreshold:n.Browser.touch?32:14,worldCopyJump:!0}),n.Map.Drag=n.Handler.extend({addHooks:function(){if(!this._draggable){this._draggable=new n.Draggable(this._map._mapPane,this._map._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this);var e=this._map.options;e.worldCopyJump&&(this._draggable.on("predrag",this._onPreDrag,this),this._map.on("viewreset",this._onViewReset,this))}this._draggable.enable()},removeHooks:function(){this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){var e=this._map;e.fire("movestart").fire("dragstart"),e._panTransition&&e._panTransition._onTransitionEnd(!0),e.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(){if(this._map.options.inertia){var e=this._lastTime=+new Date,t=this._lastPos=this._draggable._newPos;this._positions.push(t),this._times.push(e),e-this._times[0]>200&&(this._positions.shift(),this._times.shift())}this._map.fire("move").fire("drag")},_onViewReset:function(){var e=this._map.getSize().divideBy(2),t=this._map.latLngToLayerPoint(new n.LatLng(0,0));this._initialWorldOffset=t.subtract(e).x,this._worldWidth=this._map.project(new n.LatLng(0,180)).x},_onPreDrag:function(){var t=(this._map,this._worldWidth),n=Math.round(t/2),r=this._initialWorldOffset,i=this._draggable._newPos.x,s=(i-n+r)%t+n-r,o=(i+n+r)%t-n-r,u=Math.abs(s+r)<Math.abs(o+r)?s:o;this._draggable._newPos.x=u},_onDragEnd:function(){var e=this._map,r=e.options,i=+new Date-this._lastTime,s=!r.inertia||i>r.inertiaThreshold||this._positions[0]===t;if(s)e.fire("moveend");else{var o=this._lastPos.subtract(this._positions[0]),u=(this._lastTime+i-this._times[0])/1e3,a=o.multiplyBy(.58/u),f=a.distanceTo(new n.Point(0,0)),l=Math.min(r.inertiaMaxSpeed,f),c=a.multiplyBy(l/f),h=l/r.inertiaDeceleration,p=c.multiplyBy(-h/2).round(),d={duration:h,easing:"ease-out"};n.Util.requestAnimFrame(n.Util.bind(function(){this._map.panBy(p,d)},this))}e.fire("dragend"),r.maxBounds&&n.Util.requestAnimFrame(this._panInsideMaxBounds,e,!0,e._container)},_panInsideMaxBounds:function(){this.panInsideBounds(this.options.maxBounds)}}),n.Map.addInitHook("addHandler","dragging",n.Map.Drag),n.Map.mergeOptions({doubleClickZoom:!0}),n.Map.DoubleClickZoom=n.Handler.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick)},_onDoubleClick:function(e){this.setView(e.latlng,this._zoom+1)}}),n.Map.addInitHook("addHandler","doubleClickZoom",n.Map.DoubleClickZoom),n.Map.mergeOptions({scrollWheelZoom:!n.Browser.touch}),n.Map.ScrollWheelZoom=n.Handler.extend({addHooks:function(){n.DomEvent.on(this._map._container,"mousewheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){n.DomEvent.off(this._map._container,"mousewheel",this._onWheelScroll)},_onWheelScroll:function(e){var t=n.DomEvent.getWheelDelta(e);this._delta+=t,this._lastMousePos=this._map.mouseEventToContainerPoint(e),clearTimeout(this._timer),this._timer=setTimeout(n.Util.bind(this._performZoom,this),40),n.DomEvent.preventDefault(e)},_performZoom:function(){var e=this._map,t=Math.round(this._delta),n=e.getZoom();t=Math.max(Math.min(t,4),-4),t=e._limitZoom(n+t)-n,this._delta=0;if(t){var r=n+t,i=this._getCenterForScrollWheelZoom(this._lastMousePos,r);e.setView(i,r)}},_getCenterForScrollWheelZoom:function(e,t){var n=this._map,r=n.getZoomScale(t),i=n.getSize().divideBy(2),s=e.subtract(i).multiplyBy(1-1/r),o=n._getTopLeftPoint().add(i).add(s);return n.unproject(o)}}),n.Map.addInitHook("addHandler","scrollWheelZoom",n.Map.ScrollWheelZoom),n.Util.extend(n.DomEvent,{addDoubleTapListener:function(e,t,n){function l(e){if(1===e.touches.length){var t=Date.now(),n=t-(r||t);o=e.touches[0],i=n>0&&s>=n,r=t}}function c(){i&&(o.type="dblclick",t(o),r=null)}var r,o,i=!1,s=250,u="_leaflet_",a="touchstart",f="touchend";return e[u+a+n]=l,e[u+f+n]=c,e.addEventListener(a,l,!1),e.addEventListener(f,c,!1),this},removeDoubleTapListener:function(e,t){var n="_leaflet_";return e.removeEventListener(e,e[n+"touchstart"+t],!1),e.removeEventListener(e,e[n+"touchend"+t],!1),this}}),n.Map.mergeOptions({touchZoom:n.Browser.touch&&!n.Browser.android23}),n.Map.TouchZoom=n.Handler.extend({addHooks:function(){n.DomEvent.on(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){n.DomEvent.off(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(e){var t=this._map;if(e.touches&&2===e.touches.length&&!t._animatingZoom&&!this._zooming){var r=t.mouseEventToLayerPoint(e.touches[0]),i=t.mouseEventToLayerPoint(e.touches[1]),s=t._getCenterLayerPoint();
this._startCenter=r.add(i).divideBy(2,!0),this._startDist=r.distanceTo(i),this._moved=!1,this._zooming=!0,this._centerOffset=s.subtract(this._startCenter),n.DomEvent.on(document,"touchmove",this._onTouchMove,this).on(document,"touchend",this._onTouchEnd,this),n.DomEvent.preventDefault(e)}},_onTouchMove:function(e){if(e.touches&&2===e.touches.length){var t=this._map,r=t.mouseEventToLayerPoint(e.touches[0]),i=t.mouseEventToLayerPoint(e.touches[1]);this._scale=r.distanceTo(i)/this._startDist,this._delta=r.add(i).divideBy(2,!0).subtract(this._startCenter);1!==this._scale&&(this._moved||(n.DomUtil.addClass(t._mapPane,"leaflet-zoom-anim leaflet-touching"),t.fire("movestart").fire("zoomstart")._prepareTileBg(),this._moved=!0),n.Util.cancelAnimFrame(this._animRequest),this._animRequest=n.Util.requestAnimFrame(this._updateOnMove,this,!0,this._map._container),n.DomEvent.preventDefault(e))}},_updateOnMove:function(){var e=this._map,t=this._getScaleOrigin(),r=e.layerPointToLatLng(t);e.fire("zoomanim",{center:r,zoom:e.getScaleZoom(this._scale)}),e._tileBg.style[n.DomUtil.TRANSFORM]=n.DomUtil.getTranslateString(this._delta)+" "+n.DomUtil.getScaleString(this._scale,this._startCenter)},_onTouchEnd:function(){if(this._moved&&this._zooming){var t=this._map;this._zooming=!1,n.DomUtil.removeClass(t._mapPane,"leaflet-touching"),n.DomEvent.off(document,"touchmove",this._onTouchMove).off(document,"touchend",this._onTouchEnd);var r=this._getScaleOrigin(),i=t.layerPointToLatLng(r),s=t.getZoom(),o=t.getScaleZoom(this._scale)-s,u=o>0?Math.ceil(o):Math.floor(o),a=t._limitZoom(s+u);t.fire("zoomanim",{center:i,zoom:a}),t._runAnimation(i,a,t.getZoomScale(a)/this._scale,r,!0)}},_getScaleOrigin:function(){var e=this._centerOffset.subtract(this._delta).divideBy(this._scale);return this._startCenter.add(e)}}),n.Map.addInitHook("addHandler","touchZoom",n.Map.TouchZoom),n.Map.mergeOptions({boxZoom:!0}),n.Map.BoxZoom=n.Handler.extend({initialize:function(e){this._map=e,this._container=e._container,this._pane=e._panes.overlayPane},addHooks:function(){n.DomEvent.on(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){n.DomEvent.off(this._container,"mousedown",this._onMouseDown)},_onMouseDown:function(e){if(!e.shiftKey||1!==e.which&&1!==e.button)return!1;n.DomUtil.disableTextSelection(),this._startLayerPoint=this._map.mouseEventToLayerPoint(e),this._box=n.DomUtil.create("div","leaflet-zoom-box",this._pane),n.DomUtil.setPosition(this._box,this._startLayerPoint),this._container.style.cursor="crosshair",n.DomEvent.on(document,"mousemove",this._onMouseMove,this).on(document,"mouseup",this._onMouseUp,this).preventDefault(e),this._map.fire("boxzoomstart");return void 0},_onMouseMove:function(e){var t=this._startLayerPoint,r=this._box,i=this._map.mouseEventToLayerPoint(e),s=i.subtract(t),o=new n.Point(Math.min(i.x,t.x),Math.min(i.y,t.y));n.DomUtil.setPosition(r,o),r.style.width=Math.abs(s.x)-4+"px",r.style.height=Math.abs(s.y)-4+"px"},_onMouseUp:function(e){this._pane.removeChild(this._box),this._container.style.cursor="",n.DomUtil.enableTextSelection(),n.DomEvent.off(document,"mousemove",this._onMouseMove).off(document,"mouseup",this._onMouseUp);var t=this._map,r=t.mouseEventToLayerPoint(e),i=new n.LatLngBounds(t.layerPointToLatLng(this._startLayerPoint),t.layerPointToLatLng(r));t.fitBounds(i),t.fire("boxzoomend",{boxZoomBounds:i})}}),n.Map.addInitHook("addHandler","boxZoom",n.Map.BoxZoom),n.Map.mergeOptions({keyboard:!0,keyboardPanOffset:80,keyboardZoomOffset:1}),n.Map.Keyboard=n.Handler.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61],zoomOut:[189,109]},initialize:function(e){this._map=e,this._setPanOffset(e.options.keyboardPanOffset),this._setZoomOffset(e.options.keyboardZoomOffset)},addHooks:function(){var e=this._map._container;-1===e.tabIndex&&(e.tabIndex="0"),n.DomEvent.addListener(e,"focus",this._onFocus,this).addListener(e,"blur",this._onBlur,this).addListener(e,"mousedown",this._onMouseDown,this),this._map.on("focus",this._addHooks,this).on("blur",this._removeHooks,this)},removeHooks:function(){this._removeHooks();var e=this._map._container;n.DomEvent.removeListener(e,"focus",this._onFocus,this).removeListener(e,"blur",this._onBlur,this).removeListener(e,"mousedown",this._onMouseDown,this),this._map.off("focus",this._addHooks,this).off("blur",this._removeHooks,this)},_onMouseDown:function(){this._focused||this._map._container.focus()},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanOffset:function(e){var r,i,t=this._panKeys={},n=this.keyCodes;for(r=0,i=n.left.length;i>r;r++)t[n.left[r]]=[-1*e,0];for(r=0,i=n.right.length;i>r;r++)t[n.right[r]]=[e,0];for(r=0,i=n.down.length;i>r;r++)t[n.down[r]]=[0,e];for(r=0,i=n.up.length;i>r;r++)t[n.up[r]]=[0,-1*e]},_setZoomOffset:function(e){var r,i,t=this._zoomKeys={},n=this.keyCodes;for(r=0,i=n.zoomIn.length;i>r;r++)t[n.zoomIn[r]]=e;for(r=0,i=n.zoomOut.length;i>r;r++)t[n.zoomOut[r]]=-e},_addHooks:function(){n.DomEvent.addListener(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){n.DomEvent.removeListener(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(e){var t=e.keyCode;if(this._panKeys.hasOwnProperty(t))this._map.panBy(this._panKeys[t]);else{if(!this._zoomKeys.hasOwnProperty(t))return;this._map.setZoom(this._map.getZoom()+this._zoomKeys[t])}n.DomEvent.stop(e)}}),n.Map.addInitHook("addHandler","keyboard",n.Map.Keyboard),n.Handler.MarkerDrag=n.Handler.extend({initialize:function(e){this._marker=e},addHooks:function(){var e=this._marker._icon;this._draggable||(this._draggable=new n.Draggable(e,e).on("dragstart",this._onDragStart,this).on("drag",this._onDrag,this).on("dragend",this._onDragEnd,this)),this._draggable.enable()},removeHooks:function(){this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){this._marker.closePopup().fire("movestart").fire("dragstart")},_onDrag:function(){var t=n.DomUtil.getPosition(this._marker._icon);this._marker._shadow&&n.DomUtil.setPosition(this._marker._shadow,t),this._marker._latlng=this._marker._map.layerPointToLatLng(t),this._marker.fire("move").fire("drag")},_onDragEnd:function(){this._marker.fire("moveend").fire("dragend")}}),n.Handler.PolyEdit=n.Handler.extend({options:{icon:new n.DivIcon({iconSize:new n.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon"})},initialize:function(e,t){this._poly=e,n.Util.setOptions(this,t)},addHooks:function(){this._poly._map&&(this._markerGroup||this._initMarkers(),this._poly._map.addLayer(this._markerGroup))},removeHooks:function(){this._poly._map&&(this._poly._map.removeLayer(this._markerGroup),delete this._markerGroup,delete this._markers)},updateMarkers:function(){this._markerGroup.clearLayers(),this._initMarkers()},_initMarkers:function(){this._markerGroup||(this._markerGroup=new n.LayerGroup),this._markers=[];var t,r,i,s,e=this._poly._latlngs;for(t=0,i=e.length;i>t;t++)s=this._createMarker(e[t],t),s.on("click",this._onMarkerClick,this),this._markers.push(s);var o,u;for(t=0,r=i-1;i>t;r=t++)(0!==t||n.Polygon&&this._poly instanceof n.Polygon)&&(o=this._markers[r],u=this._markers[t],this._createMiddleMarker(o,u),this._updatePrevNext(o,u))},_createMarker:function(e,t){var r=new n.Marker(e,{draggable:!0,icon:this.options.icon});return r._origLatLng=e,r._index=t,r.on("drag",this._onMarkerDrag,this),r.on("dragend",this._fireEdit,this),this._markerGroup.addLayer(r),r},_fireEdit:function(){this._poly.fire("edit")},_onMarkerDrag:function(e){var t=e.target;n.Util.extend(t._origLatLng,t._latlng),t._middleLeft&&t._middleLeft.setLatLng(this._getMiddleLatLng(t._prev,t)),t._middleRight&&t._middleRight.setLatLng(this._getMiddleLatLng(t,t._next)),this._poly.redraw()},_onMarkerClick:function(e){if(!(this._poly._latlngs.length<3)){var t=e.target,n=t._index;t._prev&&t._next&&(this._createMiddleMarker(t._prev,t._next),this._updatePrevNext(t._prev,t._next)),this._markerGroup.removeLayer(t),t._middleLeft&&this._markerGroup.removeLayer(t._middleLeft),t._middleRight&&this._markerGroup.removeLayer(t._middleRight),this._markers.splice(n,1),this._poly.spliceLatLngs(n,1),this._updateIndexes(n,-1),this._poly.fire("edit")}},_updateIndexes:function(e,t){this._markerGroup.eachLayer(function(n){n._index>e&&(n._index+=t)})},_createMiddleMarker:function(e,t){var i,s,o,n=this._getMiddleLatLng(e,t),r=this._createMarker(n);r.setOpacity(.6),e._middleRight=t._middleLeft=r,s=function(){var s=t._index;r._index=s,r.off("click",i).on("click",this._onMarkerClick,this),n.lat=r.getLatLng().lat,n.lng=r.getLatLng().lng,this._poly.spliceLatLngs(s,0,n),this._markers.splice(s,0,r),r.setOpacity(1),this._updateIndexes(s,1),t._index++,this._updatePrevNext(e,r),this._updatePrevNext(r,t)},o=function(){r.off("dragstart",s,this),r.off("dragend",o,this),this._createMiddleMarker(e,r),this._createMiddleMarker(r,t)},i=function(){s.call(this),o.call(this),this._poly.fire("edit")},r.on("click",i,this).on("dragstart",s,this).on("dragend",o,this),this._markerGroup.addLayer(r)},_updatePrevNext:function(e,t){e._next=t,t._prev=e},_getMiddleLatLng:function(e,t){var n=this._poly._map,r=n.latLngToLayerPoint(e.getLatLng()),i=n.latLngToLayerPoint(t.getLatLng());return n.layerPointToLatLng(r._add(i).divideBy(2))}}),n.Control=n.Class.extend({options:{position:"topright"},initialize:function(e){n.Util.setOptions(this,e)},getPosition:function(){return this.options.position},setPosition:function(e){var t=this._map;return t&&t.removeControl(this),this.options.position=e,t&&t.addControl(this),this},addTo:function(e){this._map=e;var t=this._container=this.onAdd(e),r=this.getPosition(),i=e._controlCorners[r];return n.DomUtil.addClass(t,"leaflet-control"),-1!==r.indexOf("bottom")?i.insertBefore(t,i.firstChild):i.appendChild(t),this},removeFrom:function(e){var t=this.getPosition(),n=e._controlCorners[t];return n.removeChild(this._container),this._map=null,this.onRemove&&this.onRemove(e),this}}),n.control=function(e){return new n.Control(e)},n.Map.include({addControl:function(e){return e.addTo(this),this},removeControl:function(e){return e.removeFrom(this),this},_initControlPos:function(){function i(i,s){var o=t+i+" "+t+s;e[i+s]=n.DomUtil.create("div",o,r)}var e=this._controlCorners={},t="leaflet-",r=this._controlContainer=n.DomUtil.create("div",t+"control-container",this._container);i("top","left"),i("top","right"),i("bottom","left"),i("bottom","right")}}),n.Control.Zoom=n.Control.extend({options:{position:"topleft"},onAdd:function(e){var t="leaflet-control-zoom",r=n.DomUtil.create("div",t);return this._createButton("Zoom in",t+"-in",r,e.zoomIn,e),this._createButton("Zoom out",t+"-out",r,e.zoomOut,e),r},_createButton:function(e,t,r,i,s){var o=n.DomUtil.create("a",t,r);return o.href="#",o.title=e,n.DomEvent.on(o,"click",n.DomEvent.stopPropagation).on(o,"click",n.DomEvent.preventDefault).on(o,"click",i,s).on(o,"dblclick",n.DomEvent.stopPropagation),o}}),n.Map.mergeOptions({zoomControl:!0}),n.Map.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new n.Control.Zoom,this.addControl(this.zoomControl))}),n.control.zoom=function(e){return new n.Control.Zoom(e)},n.Control.Attribution=n.Control.extend({options:{position:"bottomright",prefix:'Powered by <a href="http://leaflet.cloudmade.com">Leaflet</a>'},initialize:function(e){n.Util.setOptions(this,e),this._attributions={}},onAdd:function(e){return this._container=n.DomUtil.create("div","leaflet-control-attribution"),n.DomEvent.disableClickPropagation(this._container),e.on("layeradd",this._onLayerAdd,this).on("layerremove",this._onLayerRemove,this),this._update(),this._container},onRemove:function(e){e.off("layeradd",this._onLayerAdd).off("layerremove",this._onLayerRemove)},setPrefix:function(e){return this.options.prefix=e,this._update(),this},addAttribution:function(e){return e?(this._attributions[e]||(this._attributions[e]=0),this._attributions[e]++,this._update(),this):void 0},removeAttribution:function(e){return e?(this._attributions[e]--,this._update(),this):void 0},_update:function(){if(this._map){var e=[];for(var t in this._attributions)this._attributions.hasOwnProperty(t)&&this._attributions[t]&&e.push(t);var n=[];this.options.prefix&&n.push(this.options.prefix),e.length&&n.push(e.join(", ")),this._container.innerHTML=n.join(" &#8212; ")}},_onLayerAdd:function(e){e.layer.getAttribution&&this.addAttribution(e.layer.getAttribution())},_onLayerRemove:function(e){e.layer.getAttribution&&this.removeAttribution(e.layer.getAttribution())}}),n.Map.mergeOptions({attributionControl:!0}),n.Map.addInitHook(function(){this.options.attributionControl&&(this.attributionControl=(new n.Control.Attribution).addTo(this))}),n.control.attribution=function(e){return new n.Control.Attribution(e)},n.Control.Scale=n.Control.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0,updateWhenIdle:!1},onAdd:function(e){this._map=e;var t="leaflet-control-scale",r=n.DomUtil.create("div",t),i=this.options;return this._addScales(i,t,r),e.on(i.updateWhenIdle?"moveend":"move",this._update,this),this._update(),r},onRemove:function(e){e.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(e,t,r){e.metric&&(this._mScale=n.DomUtil.create("div",t+"-line",r)),e.imperial&&(this._iScale=n.DomUtil.create("div",t+"-line",r))},_update:function(){var e=this._map.getBounds(),t=e.getCenter().lat,n=6378137*Math.PI*Math.cos(t*Math.PI/180),r=n*(e.getNorthEast().lng-e.getSouthWest().lng)/180,i=this._map.getSize(),s=this.options,o=0;i.x>0&&(o=r*(s.maxWidth/i.x)),this._updateScales(s,o)},_updateScales:function(e,t){e.metric&&t&&this._updateMetric(t),e.imperial&&t&&this._updateImperial(t)},_updateMetric:function(e){var t=this._getRoundNum(e);this._mScale.style.width=this._getScaleWidth(t/e)+"px",this._mScale.innerHTML=1e3>t?t+" m":t/1e3+" km"},_updateImperial:function(e){var r,i,s,t=3.2808399*e,n=this._iScale;t>5280?(r=t/5280,i=this._getRoundNum(r),n.style.width=this._getScaleWidth(i/r)+"px",n.innerHTML=i+" mi"):(s=this._getRoundNum(t),n.style.width=this._getScaleWidth(s/t)+"px",n.innerHTML=s+" ft")},_getScaleWidth:function(e){return Math.round(this.options.maxWidth*e)-10},_getRoundNum:function(e){var t=Math.pow(10,(Math.floor(e)+"").length-1),n=e/t;return n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:1,t*n}}),n.control.scale=function(e){return new n.Control.Scale(e)},n.Control.Layers=n.Control.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0},initialize:function(e,t,r){n.Util.setOptions(this,r),this._layers={},this._lastZIndex=0;for(var i in e)e.hasOwnProperty(i)&&this._addLayer(e[i],i);for(i in t)t.hasOwnProperty(i)&&this._addLayer(t[i],i,!0)},onAdd:function(){return this._initLayout(),this._update(),this._container},addBaseLayer:function(e,t){return this._addLayer(e,t),this._update(),this},addOverlay:function(e,t){return this._addLayer(e,t,!0),this._update(),this},removeLayer:function(e){var t=n.Util.stamp(e);return delete this._layers[t],this._update(),this},_initLayout:function(){var e="leaflet-control-layers",t=this._container=n.DomUtil.create("div",e);n.Browser.touch?n.DomEvent.on(t,"click",n.DomEvent.stopPropagation):n.DomEvent.disableClickPropagation(t);var r=this._form=n.DomUtil.create("form",e+"-list");if(this.options.collapsed){n.DomEvent.on(t,"mouseover",this._expand,this).on(t,"mouseout",this._collapse,this);var i=this._layersLink=n.DomUtil.create("a",e+"-toggle",t);i.href="#",i.title="Layers",n.Browser.touch?n.DomEvent.on(i,"click",n.DomEvent.stopPropagation).on(i,"click",n.DomEvent.preventDefault).on(i,"click",this._expand,this):n.DomEvent.on(i,"focus",this._expand,this),this._map.on("movestart",this._collapse,this)}else this._expand();this._baseLayersList=n.DomUtil.create("div",e+"-base",r),this._separator=n.DomUtil.create("div",e+"-separator",r),this._overlaysList=n.DomUtil.create("div",e+"-overlays",r),t.appendChild(r)},_addLayer:function(e,t,r){var i=n.Util.stamp(e);this._layers[i]={layer:e,name:t,overlay:r},this.options.autoZIndex&&e.setZIndex&&(this._lastZIndex++,e.setZIndex(this._lastZIndex))},_update:function(){if(this._container){this._baseLayersList.innerHTML="",this._overlaysList.innerHTML="";var e=!1,t=!1;for(var n in this._layers)if(this._layers.hasOwnProperty(n)){var r=this._layers[n];this._addItem(r),t=t||r.overlay,e=e||!r.overlay}this._separator.style.display=t&&e?"":"none"}},_createRadioElement:function(e,t){var n='<input type="radio" name="'+e+'"';t&&(n+=' checked="checked"'),n+="/>";var r=document.createElement("div");return r.innerHTML=n,r.firstChild},_addItem:function(e){var r,t=document.createElement("label"),i=this._map.hasLayer(e.layer);e.overlay?(r=document.createElement("input"),r.type="checkbox",r.defaultChecked=i):r=this._createRadioElement("leaflet-base-layers",i),r.layerId=n.Util.stamp(e.layer),n.DomEvent.on(r,"click",this._onInputClick,this);var s=document.createTextNode(" "+e.name);t.appendChild(r),t.appendChild(s);var o=e.overlay?this._overlaysList:this._baseLayersList;o.appendChild(t)},_onInputClick:function(){var e,t,n,r=this._form.getElementsByTagName("input"),i=r.length;for(e=0;i>e;e++)t=r[e],n=this._layers[t.layerId],t.checked?this._map.addLayer(n.layer,!n.overlay):this._map.removeLayer(n.layer)},_expand:function(){n.DomUtil.addClass(this._container,"leaflet-control-layers-expanded")},_collapse:function(){this._container.className=this._container.className.replace(" leaflet-control-layers-expanded","")}}),n.control.layers=function(e,t,r){return new n.Control.Layers(e,t,r)},n.Transition=n.Class.extend({includes:n.Mixin.Events,statics:{CUSTOM_PROPS_SETTERS:{position:n.DomUtil.setPosition},implemented:function(){return n.Transition.NATIVE||n.Transition.TIMER}},options:{easing:"ease",duration:.5},_setProperty:function(e,t){var r=n.Transition.CUSTOM_PROPS_SETTERS;e in r?r[e](this._el,t):this._el.style[e]=t}}),n.Transition=n.Transition.extend({statics:function(){var e=n.DomUtil.TRANSITION,t="webkitTransition"===e||"OTransition"===e?e+"End":"transitionend";return{NATIVE:!!e,TRANSITION:e,PROPERTY:e+"Property",DURATION:e+"Duration",EASING:e+"TimingFunction",END:t,CUSTOM_PROPS_PROPERTIES:{position:n.Browser.any3d?n.DomUtil.TRANSFORM:"top, left"}}}(),options:{fakeStepInterval:100},initialize:function(e,t){this._el=e,n.Util.setOptions(this,t),n.DomEvent.on(e,n.Transition.END,this._onTransitionEnd,this),this._onFakeStep=n.Util.bind(this._onFakeStep,this)},run:function(e){var t,r=[],i=n.Transition.CUSTOM_PROPS_PROPERTIES;for(t in e)e.hasOwnProperty(t)&&(t=i[t]?i[t]:t,t=this._dasherize(t),r.push(t));this._el.style[n.Transition.DURATION]=this.options.duration+"s",this._el.style[n.Transition.EASING]=this.options.easing,this._el.style[n.Transition.PROPERTY]="all";for(t in e)e.hasOwnProperty(t)&&this._setProperty(t,e[t]);n.Util.falseFn(this._el.offsetWidth),this._inProgress=!0,n.Browser.mobileWebkit&&(this.backupEventFire=setTimeout(n.Util.bind(this._onBackupFireEnd,this),1.2*this.options.duration*1e3)),n.Transition.NATIVE?(clearInterval(this._timer),this._timer=setInterval(this._onFakeStep,this.options.fakeStepInterval)):this._onTransitionEnd()},_dasherize:function(){function t(e){return"-"+e.toLowerCase()}var e=/([A-Z])/g;return function(n){return n.replace(e,t)}}(),_onFakeStep:function(){this.fire("step")},_onTransitionEnd:function(e){this._inProgress&&(this._inProgress=!1,clearInterval(this._timer),this._el.style[n.Transition.TRANSITION]="",clearTimeout(this.backupEventFire),delete this.backupEventFire,this.fire("step"),e&&e.type&&this.fire("end"))},_onBackupFireEnd:function(){var e=document.createEvent("Event");e.initEvent(n.Transition.END,!0,!1),this._el.dispatchEvent(e)}}),n.Transition=n.Transition.NATIVE?n.Transition:n.Transition.extend({statics:{getTime:Date.now||function(){return+new Date},TIMER:!0,EASINGS:{linear:function(e){return e},"ease-out":function(e){return e*(2-e)}},CUSTOM_PROPS_GETTERS:{position:n.DomUtil.getPosition},UNIT_RE:/^[\d\.]+(\D*)$/},options:{fps:50},initialize:function(e,t){this._el=e,n.Util.extend(this.options,t),this._easing=n.Transition.EASINGS[this.options.easing]||n.Transition.EASINGS["ease-out"],this._step=n.Util.bind(this._step,this),this._interval=Math.round(1e3/this.options.fps)},run:function(e){this._props={};var t=n.Transition.CUSTOM_PROPS_GETTERS,r=n.Transition.UNIT_RE;this.fire("start");for(var i in e)if(e.hasOwnProperty(i)){var s={};if(i in t)s.from=t[i](this._el);else{var o=this._el.style[i].match(r);s.from=parseFloat(o[0]),s.unit=o[1]}s.to=e[i],this._props[i]=s}clearInterval(this._timer),this._timer=setInterval(this._step,this._interval),this._startTime=n.Transition.getTime()},_step:function(){var e=n.Transition.getTime(),t=e-this._startTime,r=1e3*this.options.duration;r>t?this._runFrame(this._easing(t/r)):(this._runFrame(1),this._complete())},_runFrame:function(e){var r,i,s,t=n.Transition.CUSTOM_PROPS_SETTERS;for(r in this._props)this._props.hasOwnProperty(r)&&(i=this._props[r],r in t?(s=i.to.subtract(i.from).multiplyBy(e).add(i.from),t[r](this._el,s)):this._el.style[r]=(i.to-i.from)*e+i.from+i.unit);this.fire("step")},_complete:function(){clearInterval(this._timer),this.fire("end")}}),n.Map.include(n.Transition&&n.Transition.implemented()?{setView:function(e,t,n){t=this._limitZoom(t);var r=this._zoom!==t;if(this._loaded&&!n&&this._layers){var i=r?this._zoomToIfClose&&this._zoomToIfClose(e,t):this._panByIfClose(e);if(i)return clearTimeout(this._sizeTimer),this}return this._resetView(e,t),this},panBy:function(e,t){return e=n.point(e),e.x||e.y?(this._panTransition||(this._panTransition=new n.Transition(this._mapPane),this._panTransition.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),n.Util.setOptions(this._panTransition,n.Util.extend({duration:.25},t)),this.fire("movestart"),n.DomUtil.addClass(this._mapPane,"leaflet-pan-anim"),this._panTransition.run({position:n.DomUtil.getPosition(this._mapPane).subtract(e)}),this):this},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){n.DomUtil.removeClass(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_panByIfClose:function(e){var t=this._getCenterOffset(e)._floor();return this._offsetIsWithinView(t)?(this.panBy(t),!0):!1},_offsetIsWithinView:function(e,t){var n=t||1,r=this.getSize();return Math.abs(e.x)<=r.x*n&&Math.abs(e.y)<=r.y*n}}:{}),n.Map.mergeOptions({zoomAnimation:n.DomUtil.TRANSITION&&!n.Browser.android23&&!n.Browser.mobileOpera}),n.DomUtil.TRANSITION&&n.Map.addInitHook(function(){n.DomEvent.on(this._mapPane,n.Transition.END,this._catchTransitionEnd,this)}),n.Map.include(n.DomUtil.TRANSITION?{_zoomToIfClose:function(e,t){if(this._animatingZoom)return!0;if(!this.options.zoomAnimation)return!1;var r=this.getZoomScale(t),i=this._getCenterOffset(e).divideBy(1-1/r);if(!this._offsetIsWithinView(i,1))return!1;n.DomUtil.addClass(this._mapPane,"leaflet-zoom-anim"),this.fire("movestart").fire("zoomstart"),this.fire("zoomanim",{center:e,zoom:t});var s=this._getCenterLayerPoint().add(i);return this._prepareTileBg(),this._runAnimation(e,t,r,s),!0},_catchTransitionEnd:function(){this._animatingZoom&&this._onZoomTransitionEnd()},_runAnimation:function(e,t,r,i,s){this._animateToCenter=e,this._animateToZoom=t,this._animatingZoom=!0;var o=n.DomUtil.TRANSFORM,u=this._tileBg;clearTimeout(this._clearTileBgTimer),n.Util.falseFn(u.offsetWidth);var a=n.DomUtil.getScaleString(r,i),f=u.style[o];u.style[o]=s?f+" "+a:a+" "+f},_prepareTileBg:function(){var e=this._tilePane,t=this._tileBg;if(t&&this._getLoadedTilesPercentage(t)>.5&&this._getLoadedTilesPercentage(e)<.5)e.style.visibility="hidden",e.empty=!0,this._stopLoadingImages(e);else{t||(t=this._tileBg=this._createPane("leaflet-tile-pane",this._mapPane),t.style.zIndex=1),t.style[n.DomUtil.TRANSFORM]="",t.style.visibility="hidden",t.empty=!0,e.empty=!1,this._tilePane=this._panes.tilePane=t;var r=this._tileBg=e;n.DomUtil.addClass(r,"leaflet-zoom-animated"),this._stopLoadingImages(r)}},_getLoadedTilesPercentage:function(e){var n,r,t=e.getElementsByTagName("img"),i=0;for(n=0,r=t.length;r>n;n++)t[n].complete&&i++;return i/r},_stopLoadingImages:function(e){var r,i,s,t=Array.prototype.slice.call(e.getElementsByTagName("img"));for(r=0,i=t.length;i>r;r++)s=t[r],s.complete||(s.onload=n.Util.falseFn,s.onerror=n.Util.falseFn,s.src=n.Util.emptyImageUrl,s.parentNode.removeChild(s))},_onZoomTransitionEnd:function(){this._restoreTileFront(),n.Util.falseFn(this._tileBg.offsetWidth),this._resetView(this._animateToCenter,this._animateToZoom,!0,!0),n.DomUtil.removeClass(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1},_restoreTileFront:function(){this._tilePane.innerHTML="",this._tilePane.style.visibility="",this._tilePane.style.zIndex=2,this._tileBg.style.zIndex=1},_clearTileBg:function(){!this._animatingZoom&&!this.touchZoom._zooming&&(this._tileBg.innerHTML="")}}:{}),n.Map.include({_defaultLocateOptions:{watch:!1,setView:!1,maxZoom:1/0,timeout:1e4,maximumAge:0,enableHighAccuracy:!1},locate:function(e){e=this._locationOptions=n.Util.extend(this._defaultLocateOptions,e);if(!navigator.geolocation)return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var t=n.Util.bind(this._handleGeolocationResponse,this),r=n.Util.bind(this._handleGeolocationError,this);return e.watch?this._locationWatchId=navigator.geolocation.watchPosition(t,r,e):navigator.geolocation.getCurrentPosition(t,r,e),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch(this._locationWatchId),this},_handleGeolocationError:function(e){var t=e.code,n=e.message||(1===t?"permission denied":2===t?"position unavailable":"timeout");this._locationOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:t,message:"Geolocation error: "+n+"."})},_handleGeolocationResponse:function(e){var t=180*e.coords.accuracy/4e7,r=2*t,i=e.coords.latitude,s=e.coords.longitude,o=new n.LatLng(i,s),u=new n.LatLng(i-t,s-r),a=new n.LatLng(i+t,s+r),f=new n.LatLngBounds(u,a),l=this._locationOptions;if(l.setView){var c=Math.min(this.getBoundsZoom(f),l.maxZoom);this.setView(o,c)}this.fire("locationfound",{latlng:o,bounds:f,accuracy:e.coords.accuracy})}})}(this);define("leaflet",["jquery","splunk.util","splunk.config","helpers/user_agent","contrib/text!contrib/leaflet/leaflet.css","contrib/text!contrib/leaflet/leaflet.ie.css"],function(global){return function(){var ret,fn;fn=function($,SplunkUtil,splunkConfig,userAgent,css,iecss){if(splunkConfig.INDEPENDENT_MODE){var imageUrl=require.toUrl("")+"splunkjs/contrib/leaflet/images";css=css.replace(/url\(images/g,"url("+imageUrl)}else css=css.replace(/url\(images/g,"url("+SplunkUtil.make_url("/static/js/contrib/leaflet/images"));$("head").append('<style type="text/css">'+css+"</style>");userAgent.isIELessThan(9)&&$("head").append('<style type="text/css">'+iecss+"</style>")};ret=fn.apply(global,arguments);return ret||global.L}}(this));define("splunk/events/GenericEventData",["require","jg_global","jgatt"],function(require){var jg_extend=require("jg_global").jg_extend,EventData=require("jgatt").events.EventData;return jg_extend(EventData,function(){this.constructor=function(attributes){if(null!=attributes)for(var a in attributes)!attributes.hasOwnProperty(a)||a in this||(this[a]=attributes[a])}})});define("splunk/mapping/LatLon",["require","leaflet","jg_global"],function(require){var Leaflet=require("leaflet"),jg_extend=require("jg_global").jg_extend;return jg_extend(Object,function(LatLon){LatLon.fromLeaflet=function(latLng){return new LatLon(latLng.lat,latLng.lng)};this.lat=0;this.lon=0;this.constructor=function(lat,lon){this.lat=void 0!==lat?lat:0;this.lon=void 0!==lon?lon:0};this.normalize=function(center){var lat=this.lat;-90>lat?lat=-90:lat>90&&(lat=90);var centerLon=center?center.lon:0,lon=(this.lon-centerLon)%360;-180>lon?lon+=360:lon>180&&(lon-=360);lon+=centerLon;return new LatLon(lat,lon)};this.isFinite=function(){return this.lat-this.lat===0&&this.lon-this.lon===0};this.equals=function(latLon){return this.lat==latLon.lat&&this.lon==latLon.lon};this.clone=function(){return new LatLon(this.lat,this.lon)};this.toString=function(){return"("+this.lat+", "+this.lon+")"};this.toLeaflet=function(){var latLng=new Leaflet.LatLng(0,0);latLng.lat=this.lat;latLng.lng=this.lon;return latLng}})});define("splunk/mapping/LatLonBounds",["require","leaflet","jg_global","splunk/mapping/LatLon"],function(require){var Leaflet=require("leaflet"),jg_extend=require("jg_global").jg_extend,LatLon=require("splunk/mapping/LatLon");return jg_extend(Object,function(LatLonBounds){LatLonBounds.fromLeaflet=function(latLngBounds){var sw=latLngBounds.getSouthWest(),ne=latLngBounds.getNorthEast();return new LatLonBounds(sw.lat,sw.lng,ne.lat,ne.lng)};this.s=0;this.w=0;this.n=0;this.e=0;this.constructor=function(s,w,n,e){this.s=void 0!==s?s:0;this.w=void 0!==w?w:0;this.n=void 0!==n?n:0;this.e=void 0!==e?e:0};this.getSW=function(){return new LatLon(this.s,this.w)};this.getSE=function(){return new LatLon(this.s,this.e)};this.getNW=function(){return new LatLon(this.n,this.w)};this.getNE=function(){return new LatLon(this.n,this.e)};this.getCenter=function(){return new LatLon((this.s+this.n)/2,(this.w+this.e)/2)};this.expand=function(latLon){latLon.lat<this.s&&(this.s=latLon.lat);latLon.lat>this.n&&(this.n=latLon.lat);latLon.lon<this.w&&(this.w=latLon.lon);latLon.lon>this.e&&(this.e=latLon.lon)};this.contains=function(latLon){return latLon.lat>=this.s&&latLon.lat<=this.n&&latLon.lon>=this.w&&latLon.lon<=this.e};this.normalize=function(center){var s=this.s;-90>s?s=-90:s>90&&(s=90);var n=this.n;s>n?n=s:n>90&&(n=90);var centerLon=center?center.lon:0,w=this.w-centerLon,e=this.e-centerLon;if(e-w>=360){w=-180;e=180}else{w%=360;-180>w?w+=360:w>180&&(w-=360);e%=360;-180>e?e+=360:e>180&&(e-=360);w>e&&(e>-w?w-=360:e+=360)}w+=centerLon;e+=centerLon;return new LatLonBounds(s,w,n,e)};this.isFinite=function(){return this.s-this.s===0&&this.w-this.w===0&&this.n-this.n===0&&this.e-this.e===0};this.equals=function(bounds){return this.s==bounds.s&&this.w==bounds.w&&this.n==bounds.n&&this.e==bounds.e};this.clone=function(){return new LatLonBounds(this.s,this.w,this.n,this.e)};this.toString=function(){return"("+this.s+", "+this.w+", "+this.n+", "+this.e+")"};this.toLeaflet=function(){var sw=new Leaflet.LatLng(0,0);sw.lat=this.s;sw.lng=this.w;var ne=new Leaflet.LatLng(0,0);ne.lat=this.n;ne.lng=this.e;return new Leaflet.LatLngBounds(sw,ne)}})});define("splunk/viz/MRenderTarget",["require","jg_global","jg_global","jgatt","jgatt","jgatt","jgatt","jgatt"],function(require){var jg_static=require("jg_global").jg_static,jg_mixin=require("jg_global").jg_mixin,MObservable=require("jgatt").events.MObservable,MPropertyTarget=require("jgatt").properties.MPropertyTarget,PropertyComparator=require("jgatt").utils.PropertyComparator,MValidateTarget=require("jgatt").validation.MValidateTarget,ValidatePass=require("jgatt").validation.ValidatePass;return jg_static(function(){this.mixin=function(base){base=jg_mixin(this,MObservable,base);base=jg_mixin(this,MPropertyTarget,base);base=jg_mixin(this,MValidateTarget,base)};this.renderPass=new ValidatePass("render",3,new PropertyComparator("renderPriority"));this.renderPriority=0;this.render=function(){}})});define("splunk/mapping/layers/LayerBase",["require","jg_global","jg_global","jgatt","jgatt","splunk/viz/MRenderTarget"],function(require){var jg_extend=require("jg_global").jg_extend,jg_mixin=require("jg_global").jg_mixin,Property=require("jgatt").properties.Property,FunctionUtils=require("jgatt").utils.FunctionUtils,MRenderTarget=require("splunk/viz/MRenderTarget");return jg_extend(Object,function(LayerBase,base){base=jg_mixin(this,MRenderTarget,base);LayerBase.METADATA_KEY="__splunk_mapping_layers_LayerBase_metadata";this.map=new Property("map",Object,null,!0);this.leafletLayer=null;this.constructor=function(){base.constructor.call(this);this._map_boundsChanged=FunctionUtils.bind(this._map_boundsChanged,this);this.leafletLayer=this.createLeafletLayer();if(!this.leafletLayer)throw new Error("Value returned from createLeafletLayer() must be non-null.")
};this.render=function(){this.validatePreceding("renderPass");if(!this.isValid("renderPass")){var map=this.getInternal("map");map&&this.renderOverride(map);this.setValid("renderPass")}};this.createLeafletLayer=function(){throw new Error("Must implement method createLeafletLayer.")};this.renderOverride=function(){};this.onAddedToMap=function(map){this.setInternal("map",map);map.addEventListener("boundsChanged",this._map_boundsChanged);this.invalidate("renderPass")};this.onRemovedFromMap=function(map){map.removeEventListener("boundsChanged",this._map_boundsChanged);this.setInternal("map",null)};this._map_boundsChanged=function(){this.invalidate("renderPass")}})});define("splunk/viz/VizBase",["require","jquery","jg_global","jg_global","jgatt","jgatt","jgatt","jgatt"],function(require){var $=require("jquery"),jg_extend=require("jg_global").jg_extend,jg_mixin=require("jg_global").jg_mixin,MObservable=require("jgatt").events.MObservable,MPropertyTarget=require("jgatt").properties.MPropertyTarget,Property=require("jgatt").properties.Property,MValidateTarget=require("jgatt").validation.MValidateTarget;return jg_extend(Object,function(VizBase,base){base=jg_mixin(this,MObservable,base);base=jg_mixin(this,MPropertyTarget,base);base=jg_mixin(this,MValidateTarget,base);var _INSTANCE_KEY="__splunk_viz_VizBase_instance",_instanceCount=0;VizBase.getInstance=function(element){if(null==element)return null;element=$(element);if(0==element.length)return null;element=element[0];var instance=element[_INSTANCE_KEY];return instance instanceof VizBase?instance:null};this.id=new Property("id",String,null,!0);this.element=null;this.$element=null;this.constructor=function(html){if(null!=html&&"string"!=typeof html)throw new Error("Parameter html must be a string.");var query=$(html?html:"<div></div>");if(0==query.length)throw new Error("Parameter html must be valid markup.");base.constructor.call(this);var id="splunk-viz-VizBase-"+ ++_instanceCount;this.element=query[0];this.$element=$(this.element);this.setInternal("id",id);this.addStyleClass("splunk-viz-VizBase")};this.addStyleClass=function(styleClass){this.$element.addClass(styleClass)};this.removeStyleClass=function(styleClass){this.$element.removeClass(styleClass)};this.setStyle=function(style){this.$element.css(style)};this.appendTo=function(parentElement){if(null==parentElement)throw new Error("Parameter parentElement must be non-null.");parentElement instanceof VizBase&&(parentElement=parentElement.element);parentElement=$(parentElement);if(0!=parentElement.length){parentElement=parentElement[0];var oldParent=this.element.parentNode;oldParent&&oldParent!==parentElement&&this.onRemove();parentElement.appendChild(this.element);oldParent!==parentElement&&this.onAppend()}};this.replace=function(element){if(null==element)throw new Error("Parameter element must be non-null.");element instanceof VizBase&&(element=element.element);element=$(element);if(0!=element.length){element=element[0];var parentElement=element.parentNode;if(null!=parentElement){var oldParent=this.element.parentNode;oldParent&&oldParent!==parentElement&&this.onRemove();parentElement.replaceChild(this.element,element);oldParent!==parentElement&&this.onAppend()}}};this.remove=function(){var element=this.element,parentElement=element.parentNode;if(parentElement){this.onRemove();parentElement.removeChild(element)}};this.dispose=function(){this.remove();this.$element.remove()};this.onAppend=function(){};this.onRemove=function(){}})});define("splunk/mapping/Map",["require","leaflet","jg_global","jgatt","jgatt","jgatt","jgatt","jgatt","jgatt","jgatt","jgatt","jgatt","jgatt","jgatt","splunk/events/GenericEventData","splunk/mapping/LatLon","splunk/mapping/LatLonBounds","splunk/mapping/layers/LayerBase","splunk/viz/VizBase"],function(require){var Leaflet=require("leaflet"),jg_extend=require("jg_global").jg_extend,ChainedEvent=require("jgatt").events.ChainedEvent,Event=require("jgatt").events.Event,EventData=require("jgatt").events.EventData,ObservableArrayProperty=require("jgatt").properties.ObservableArrayProperty,ObservableProperty=require("jgatt").properties.ObservableProperty,Property=require("jgatt").properties.Property,ArrayUtils=require("jgatt").utils.ArrayUtils,FunctionUtils=require("jgatt").utils.FunctionUtils,NumberUtils=require("jgatt").utils.NumberUtils,StringUtils=require("jgatt").utils.StringUtils,ValidatePass=require("jgatt").validation.ValidatePass,GenericEventData=require("splunk/events/GenericEventData"),LatLon=require("splunk/mapping/LatLon"),LatLonBounds=require("splunk/mapping/LatLonBounds"),LayerBase=require("splunk/mapping/layers/LayerBase"),VizBase=require("splunk/viz/VizBase"),Map=jg_extend(VizBase,function(Map,base){this.updateLeafletMapSizePass=new ValidatePass("updateLeafletMapSize",-1);this.updateTilesPass=new ValidatePass("updateTiles",0);this.boundsChanged=new ChainedEvent("boundsChanged",this.changed,EventData);this.mapClicked=new Event("mapClicked",GenericEventData);this.center=new Property("center",LatLon,null).getter(function(){return LatLon.fromLeaflet(this.leafletMap.getCenter())}).setter(function(value){value=value&&value.isFinite()?value.clone():new LatLon;this.validate();this.leafletMap.setView(value.toLeaflet(),this.leafletMap.getZoom(),!0);this._checkBoundsChanged();clearTimeout(this._setCenterTimeout);this._setCenterTimeout=setTimeout(FunctionUtils.bind(function(){this.leafletMap.setView(value.toLeaflet(),this.leafletMap.getZoom(),!0);this._checkBoundsChanged()},this),500)});this.zoom=new Property("zoom",Number,0).getter(function(){return this.leafletMap.getZoom()}).setter(function(value){value=value>=0&&1/0>value?value:0;this.validate();this.leafletMap.setView(this.leafletMap.getCenter(),value,!0);this._checkBoundsChanged()});this.tileURL=new ObservableProperty("tileURL",String,null).onChanged(function(){this.invalidate("updateTilesPass")});this.tileSubdomains=new ObservableArrayProperty("tileSubdomains",String,["a","b","c"]).readFilter(function(value){return value.concat()}).writeFilter(function(value){return value?value.concat():[]}).changedComparator(function(oldValue,newValue){if(oldValue.length!==newValue.length)return!0;for(var i=0,l=oldValue.length;l>i;i++)if(oldValue[i]!==newValue[i])return!0;return!1}).onChanged(function(){this.invalidate("updateTilesPass")});this.tileMinZoom=new ObservableProperty("tileMinZoom",Number,0).writeFilter(function(value){return value>=0&&1/0>value?Math.floor(value):0}).onChanged(function(){this.invalidate("updateTilesPass")});this.tileMaxZoom=new ObservableProperty("tileMaxZoom",Number,1/0).writeFilter(function(value){return value>=0&&1/0>value?Math.floor(value):1/0}).onChanged(function(){this.invalidate("updateTilesPass")});this.tileInvertY=new ObservableProperty("tileInvertY",Boolean,!1).onChanged(function(){this.invalidate("updateTilesPass")});this.tileAttribution=new ObservableProperty("tileAttribution",String,null).onChanged(function(){this.invalidate("updateTilesPass")});this.leafletMap=null;this.formatNumber=null;this.formatDegrees=null;this._tooltip=null;this._tooltipMetadata=null;this._layers=null;this._tileLayer=null;this._width=0;this._height=0;this._bounds=null;this._updateSizeInterval=0;this._setCenterTimeout=0;this.constructor=function(){base.constructor.call(this);this.addStyleClass("splunk-mapping-Map");this.setStyle({position:"relative",width:"100%",height:"100%",overflow:"hidden",background:"none"});this.updateSize=FunctionUtils.bind(this.updateSize,this);this._leafletMap_moveend=FunctionUtils.bind(this._leafletMap_moveend,this);this._leafletMap_zoomend=FunctionUtils.bind(this._leafletMap_zoomend,this);this._self_mouseOver=FunctionUtils.bind(this._self_mouseOver,this);this._self_mouseOut=FunctionUtils.bind(this._self_mouseOut,this);this._self_mouseMove=FunctionUtils.bind(this._self_mouseMove,this);this._self_click=FunctionUtils.bind(this._self_click,this);this.leafletMap=new Leaflet.Map(this.element,{center:new Leaflet.LatLng(0,0),zoom:0,trackResize:!1,worldCopyJump:!1});this.leafletMap.attributionControl.setPrefix("");this.leafletMap.on("moveend",this._leafletMap_moveend);this.leafletMap.on("zoomend",this._leafletMap_zoomend);this._tooltip=new LeafletTooltip;this._layers=[];this.$element.bind("mouseover",this._self_mouseOver);this.$element.bind("mouseout",this._self_mouseOut);this.$element.bind("mousemove",this._self_mouseMove);this.$element.bind("click",this._self_click)};this.updateLeafletMapSize=function(){this.validatePreceding("updateLeafletMapSizePass");if(!this.isValid("updateLeafletMapSizePass")){this.leafletMap.invalidateSize();clearTimeout(this.leafletMap._sizeTimer);this.leafletMap.fire("moveend");this.setValid("updateLeafletMapSizePass")}};this.updateTiles=function(){this.validatePreceding("updateTilesPass");if(!this.isValid("updateTilesPass")){var leafletMap=this.leafletMap,tileLayer=this._tileLayer;if(tileLayer){leafletMap.removeLayer(tileLayer);this._tileLayer=null}var tileOptions={};tileOptions.subdomains=this.getInternal("tileSubdomains");tileOptions.minZoom=this.getInternal("tileMinZoom");tileOptions.maxZoom=this.getInternal("tileMaxZoom");tileOptions.tms=this.getInternal("tileInvertY");tileOptions.attribution=this.getInternal("tileAttribution");var tileURL=this.getInternal("tileURL");if(tileURL){tileLayer=this._tileLayer=new Leaflet.TileLayer(tileURL,tileOptions);leafletMap.addLayer(tileLayer,!0)}leafletMap.options.minZoom=tileOptions.minZoom;leafletMap.options.maxZoom=tileOptions.maxZoom;leafletMap.setZoom(leafletMap.getZoom());this.setValid("updateTilesPass");this._checkBoundsChanged()}};this.addLayer=function(layer){if(null==layer)throw new Error("Parameter layer must be non-null.");if(!(layer instanceof LayerBase))throw new Error("Parameter layer must be an instance of splunk.mapping.layers.LayerBase");var layers=this._layers;if(!(ArrayUtils.indexOf(layers,layer)>=0)){layers.push(layer);this.leafletMap.addLayer(layer.leafletLayer);layer.onAddedToMap(this)}};this.removeLayer=function(layer){if(null==layer)throw new Error("Parameter layer must be non-null.");if(!(layer instanceof LayerBase))throw new Error("Parameter layer must be an instance of splunk.mapping.layers.LayerBase");var layers=this._layers,index=ArrayUtils.indexOf(layers,layer);if(!(0>index)){layer.onRemovedFromMap(this);this.leafletMap.removeLayer(layer.leafletLayer);layers.splice(index,1)}};this.fitWorld=function(viewportInside){if(null!=viewportInside&&"boolean"!=typeof viewportInside)throw new Error("Parameter viewportInside must be a boolean.");this.fitBounds(new LatLonBounds(-60,-180,85,180),viewportInside)};this.fitBounds=function(latLonBounds,viewportInside){if(null==latLonBounds)throw new Error("Parameter latLonBounds must be non-null.");if(!(latLonBounds instanceof LatLonBounds))throw new Error("Parameter latLonBounds must be an instance of splunk.mapping.LatLonBounds.");if(null!=viewportInside&&"boolean"!=typeof viewportInside)throw new Error("Parameter viewportInside must be a boolean.");latLonBounds=latLonBounds.isFinite()?latLonBounds:new LatLonBounds(-60,-180,85,180);viewportInside=viewportInside===!0;clearTimeout(this._setCenterTimeout);var zoom=this.leafletMap.getBoundsZoom(latLonBounds.toLeaflet(),viewportInside);this.leafletMap.setView(this.leafletMap.getCenter(),zoom,!0);var tl=this.leafletMap.latLngToLayerPoint(latLonBounds.getNW().toLeaflet()),br=this.leafletMap.latLngToLayerPoint(latLonBounds.getSE().toLeaflet()),centerPoint=new Leaflet.Point((tl.x+br.x)/2,(tl.y+br.y)/2),center=this.leafletMap.layerPointToLatLng(centerPoint);this.leafletMap.setView(center,zoom,!0);this._checkBoundsChanged()};this.getLatLonBounds=function(){return LatLonBounds.fromLeaflet(this.leafletMap.getBounds())};this.updateSize=function(){var width=this.$element.width(),height=this.$element.height();if((width!==this._width||height!==this._height)&&this.$element.is(":visible")){this._width=width;this._height=height;this.leafletMap.invalidateSize();this.invalidate("updateLeafletMapSizePass");this._checkBoundsChanged()}};this.dispose=function(){clearTimeout(this._setCenterTimeout);for(var layers=this._layers.concat(),i=layers.length-1;i>=0;i--)this.removeLayer(layers[i]);base.dispose.call(this)};this.onAppend=function(){this._updateSizeInterval=setInterval(this.updateSize,50);this.updateSize()};this.onRemove=function(){clearInterval(this._updateSizeInterval)};this._checkBoundsChanged=function(){var oldBounds=this._bounds,newBounds=this.getLatLonBounds();if(!oldBounds||!oldBounds.equals(newBounds)){this._bounds=newBounds;this.dispatchEvent("boundsChanged",new EventData)}};this._updateTooltip=function(element){var tooltip=this._tooltip,metadata=this._getMetadataFromElement(element);if(metadata&&metadata!==this._tooltipMetadata){this._tooltipMetadata=metadata;var data=metadata.data,fields=metadata.fields,sliceList=metadata.sliceList,tooltipLatLng=metadata.tooltipLatLng,tooltipOffsetRadius=metadata.tooltipOffsetRadius;if(data&&fields&&tooltipLatLng){var field,slice,i,l,content="";content+='<table style="border: 0 none; border-spacing: 0; border-collapse: collapse;">';for(i=0,l=Math.min(fields.length,2);l>i;i++){field=fields[i];content+="<tr>";content+='<td style="padding: 0; text-align: left; white-space: nowrap; color: #333333;">'+StringUtils.escapeHTML(field)+':&nbsp;&nbsp;</td><td style="padding: 0; text-align: right; white-space: nowrap;">'+StringUtils.escapeHTML(this._formatDegrees(data[field],0===i?"ns":"ew"))+"</td>";content+="</tr>"}for(i=0,l=sliceList.length;l>i;i++){slice=sliceList[i];content+="<tr>";content+='<td style="padding: 0; text-align: left; white-space: nowrap; color: #'+(16777216|slice.series.color).toString(16).substring(1)+';">'+StringUtils.escapeHTML(slice.series.name)+':&nbsp;&nbsp;</td><td style="padding: 0; text-align: right; white-space: nowrap;">'+StringUtils.escapeHTML(this._formatNumber(slice.value))+"</td>";content+="</tr>"}content+="</table>";tooltip.setLatLng(tooltipLatLng);tooltip.setOffsetRadius(tooltipOffsetRadius);tooltip.setContent(content);this.leafletMap.openPopup(tooltip)}else this.leafletMap.closePopup()}else if(!metadata&&this._tooltipMetadata){this._tooltipMetadata=null;this.leafletMap.closePopup()}};this._getMetadataFromElement=function(element){for(;element;){if(element[LayerBase.METADATA_KEY])return element[LayerBase.METADATA_KEY];element=element.parentNode}return null};this._formatNumber=function(num){var format=this.formatNumber;return"function"==typeof format?format(Number(num)):String(num)};this._formatDegrees=function(degrees,orientation){var format=this.formatDegrees;return"function"==typeof format?format(Number(degrees),orientation):String(degrees)};this._leafletMap_moveend=function(){this._checkBoundsChanged()};this._leafletMap_zoomend=function(){this._checkBoundsChanged()};this._self_mouseOver=function(e){this._updateTooltip(e.target)};this._self_mouseOut=function(e){this._updateTooltip(e.target)};this._self_mouseMove=function(e){this._updateTooltip(e.target)};this._self_click=function(e){if(!this.leafletMap.dragging||!this.leafletMap.dragging.moved()){var metadata=this._getMetadataFromElement(e.target);if(metadata&&metadata.data&&metadata.fields){e.preventDefault();var data={};for(var p in metadata.data)data[p]=metadata.data[p];var fields=metadata.fields.concat();this.dispatchEvent("mapClicked",new GenericEventData({data:data,fields:fields,altKey:e.altKey,ctrlKey:e.ctrlKey||e.metaKey,shiftKey:e.shiftKey,jQueryEvent:e,originalEvent:e.originalEvent}))}}}}),LeafletTooltip=Leaflet.Popup.extend({options:{paddingX:5,paddingY:5},_offsetRadius:0,initialize:function(options){options=Leaflet.Util.extend(options||{},{maxWidth:1/0,maxHeight:1/0,autoPan:!1,closeButton:!1});Leaflet.Popup.prototype.initialize.call(this,options)},setOffsetRadius:function(offsetRadius){this._offsetRadius=offsetRadius;this._update();return this},_initLayout:function(){Leaflet.Popup.prototype._initLayout.call(this);this._tipContainer.style.display="none"},_updatePosition:function(){var map=this._map,mapTL=map.containerPointToLayerPoint(new Leaflet.Point(0,0)),mapBR=map.containerPointToLayerPoint(map.getSize()),mapLeft=mapTL.x,mapTop=mapTL.y,mapRight=mapBR.x,mapBottom=mapBR.y,container=this._container,containerWidth=container.offsetWidth,containerHeight=container.offsetHeight,is3d=L.Browser.any3d,offsetRadius=this._offsetRadius,paddingX=this.options.paddingX,paddingY=this.options.paddingY,centerPoint=map.latLngToLayerPoint(this._latlng),offsetX=centerPoint.x>(mapLeft+mapRight)/2?-containerWidth-offsetRadius-paddingX:offsetRadius+paddingX,offsetY=NumberUtils.maxMin(centerPoint.y-containerHeight/2,mapBottom-containerHeight-paddingY,mapTop+paddingY)-centerPoint.y;is3d&&L.DomUtil.setPosition(container,centerPoint);var x=offsetX+(is3d?0:centerPoint.x),y=offsetY+(is3d?0:centerPoint.y);container.style.left=Math.round(x)+"px";container.style.top=Math.round(y)+"px"}});Leaflet.Control.Attribution.include({_update:function(){if(this._map){var attribs=[];for(var i in this._attributions)this._attributions.hasOwnProperty(i)&&this._attributions[i]&&attribs.push(i);var prefixAndAttribs=[];this.options.prefix&&prefixAndAttribs.push(this.options.prefix);attribs.length&&prefixAndAttribs.push(attribs.join(", "));var text=prefixAndAttribs.join(" &#8212; ");this._container.innerHTML=text;this._container.style.display=text?"":"none"}}});return Map});define("splunk/vectors/VectorElement",["require","jg_global","jg_global","jg_global"],function(require){var jg_extend=require("jg_global").jg_extend,jg_mixin=require("jg_global").jg_mixin,jg_static=require("jg_global").jg_static;return jg_extend(Object,function(VectorElement){var _HAS_SVG="function"==typeof document.createElementNS,_HAS_VML=!_HAS_SVG&&function(){try{document.namespaces.add("splvml","urn:schemas-microsoft-com:vml");var styleText=".splvml { behavior: url(#default#VML); display: inline-block; position: absolute; }",styleNode=document.createElement("style");styleNode.setAttribute("type","text/css");var headNode=document.getElementsByTagName("head")[0];headNode.appendChild(styleNode);styleNode.styleSheet?styleNode.styleSheet.cssText=styleText:styleNode.appendChild(document.createTextNode(styleText));return!0}catch(e){return!1}}();VectorElement.mixin=function(target,sourceSVG,sourceVML){if(_HAS_SVG){jg_mixin(target,sourceSVG);sourceSVG.constructor!==Object&&"function"==typeof sourceSVG.constructor&&(target.constructor=sourceSVG.constructor)}else if(_HAS_VML){jg_mixin(target,sourceVML);sourceVML.constructor!==Object&&"function"==typeof sourceVML.constructor&&(target.constructor=sourceVML.constructor)}};this.hasSVG=_HAS_SVG;this.hasVML=_HAS_VML;this.element=null;this.constructor=function(tagName){if(null!=tagName&&"string"!=typeof tagName)throw new Error("Parameter tagName must be a string.");this.element=this.createElement(tagName||null)};this.appendTo=function(parentElement){if(null==parentElement)throw new Error("Parameter parentElement must be non-null.");if(!(parentElement instanceof VectorElement))throw new Error("Parameter parentElement must be an instance of splunk.vectors.VectorElement.");parentElement.element.appendChild(this.element);return this};this.remove=function(){this.element.parentNode&&this.element.parentNode.removeChild(this.element);return this};this.dispose=function(){this.remove();this.element=null};this.display=function(value){this.element.style.display=value?value:"";return this};this.visibility=function(value){this.element.style.visibility=value?value:"";return this};this.translate=function(x,y){x=null!=x&&x>-1/0&&1/0>x?x:0;y=null!=y&&y>-1/0&&1/0>y?y:0;this.element.style.left=0!=x?x+"px":"";this.element.style.top=0!=y?y+"px":"";return this};this.createElement=function(){var dummy=document.createElement("div");dummy.style.position="absolute";return dummy};var SVGVectorElement=jg_static(function(){var _NS_SVG="http://www.w3.org/2000/svg";this.display=function(value){value?this.element.setAttribute("display",value):this.element.removeAttribute("display");return this};this.visibility=function(value){value?this.element.setAttribute("visibility",value):this.element.removeAttribute("visibility");return this};this.translate=function(x,y){x=null!=x&&x>-1/0&&1/0>x?x:0;y=null!=y&&y>-1/0&&1/0>y?y:0;0!=x||0!=y?this.element.setAttribute("transform","translate("+x+","+y+")"):this.element.removeAttribute("transform");return this};this.createElement=function(tagName){return document.createElementNS(_NS_SVG,tagName||"g")}}),VMLVectorElement=jg_static(function(){this.createElement=function(tagName){return document.createElement("<splvml:"+(tagName||"group")+' class="splvml">')}});VectorElement.mixin(this,SVGVectorElement,VMLVectorElement)})});define("splunk/vectors/Group",["require","jg_global","jg_global","splunk/vectors/VectorElement"],function(require){var jg_extend=require("jg_global").jg_extend,jg_static=require("jg_global").jg_static,VectorElement=require("splunk/vectors/VectorElement");return jg_extend(VectorElement,function(Group,base){this.constructor=function(){base.constructor.call(this)};var SVGGroup=jg_static(function(){this.constructor=function(){base.constructor.call(this,"g")}}),VMLGroup=jg_static(function(){this.constructor=function(){base.constructor.call(this,"group");this.element.style.width="1px";this.element.style.height="1px";this.element.coordsize="1,1"}});VectorElement.mixin(this,SVGGroup,VMLGroup)})});define("splunk/vectors/VectorUtils",["require","jg_global"],function(require){var jg_static=require("jg_global").jg_static;return jg_static(function(VectorUtils){VectorUtils.toSVGString=function(element){var clonedElement=element.cloneNode(!0),containerElement=document.createElement("div");containerElement.appendChild(clonedElement);var svgString=containerElement.innerHTML;svgString=svgString.replace(/xlink:href=|href=/g,"x:href=");svgString=svgString.replace(/<image([\S\s]*?)\s*\/?>\s*(<\/image>)?/g,"<image$1></image>");svgString=svgString.replace(/^<svg/,'<svg xmlns="http://www.w3.org/2000/svg" xmlns:x="http://www.w3.org/1999/xlink"');clonedElement=null;containerElement=null;return svgString};VectorUtils.concatSVGStrings=function(){for(var svgString,viewBoxMatch,viewBox,concatString="",width=0,height=0,i=0,l=arguments.length;l>i;i++){svgString=arguments[i];viewBoxMatch=svgString.match(/^<svg[^>]*viewBox=\"([^ ]+) ([^ ]+) ([^ ]+) ([^\"]+)\"[^>]*>/);if(viewBoxMatch&&5==viewBoxMatch.length){viewBox={x:Number(viewBoxMatch[1]),y:Number(viewBoxMatch[2]),width:Number(viewBoxMatch[3]),height:Number(viewBoxMatch[4])};width=Math.max(width,viewBox.width);height=Math.max(height,viewBox.height)}else viewBox=null;svgString=!viewBox||0==viewBox.x&&0==viewBox.y?svgString.replace(/^<svg[^>]*>/,"<g>"):svgString.replace(/^<svg[^>]*>/,'<g transform="translate('+-viewBox.x+", "+-viewBox.y+')">');svgString=svgString.replace(/<\/svg>$/,"</g>");concatString+=svgString}svgString="<svg";svgString+=' xmlns="http://www.w3.org/2000/svg"';svgString+=' xmlns:x="http://www.w3.org/1999/xlink"';svgString+=' width="'+width+'"';svgString+=' height="'+height+'"';svgString+=' viewBox="0 0 '+width+" "+height+'"';svgString+=">";svgString+=concatString;svgString+="</svg>";return svgString}})});define("splunk/vectors/Viewport",["require","jg_global","jg_global","jgatt","splunk/vectors/VectorElement","splunk/vectors/VectorUtils"],function(require){var jg_extend=require("jg_global").jg_extend,jg_static=require("jg_global").jg_static,Rectangle=require("jgatt").geom.Rectangle,VectorElement=require("splunk/vectors/VectorElement"),VectorUtils=require("splunk/vectors/VectorUtils");return jg_extend(VectorElement,function(Viewport,base){this.constructor=function(){base.constructor.call(this)};this.width=function(){return this};this.height=function(){return this};this.viewBox=function(){return this};this.preserveAspectRatio=function(){return this};this.toSVGString=function(){return""};var SVGViewport=jg_static(function(){this.constructor=function(width,height,viewBox,preserveAspectRatio){base.constructor.call(this,"svg");this.width(null!=width?width:0);this.height(null!=height?height:0);null!=viewBox&&this.viewBox(viewBox);null!=preserveAspectRatio&&this.preserveAspectRatio(preserveAspectRatio)};this.appendTo=function(parentElement){if(null==parentElement)throw new Error("Parameter parentElement must be non-null.");if(null==parentElement.appendChild)throw new Error("Parameter parentElement must be a DOM node.");parentElement.appendChild(this.element);return this};this.width=function(value){null!=value&&1/0>value?this.element.setAttribute("width",Math.max(value,0)):this.element.setAttribute("width",0);return this};this.height=function(value){null!=value&&1/0>value?this.element.setAttribute("height",Math.max(value,0)):this.element.setAttribute("height",0);return this};this.viewBox=function(value){value&&value instanceof Rectangle&&value.isFinite()?this.element.setAttribute("viewBox",value.x+" "+value.y+" "+value.width+" "+value.height):this.element.removeAttribute("viewBox");return this};this.preserveAspectRatio=function(value){value?this.element.setAttribute("preserveAspectRatio",value):this.element.removeAttribute("preserveAspectRatio");return this};this.toSVGString=function(){return VectorUtils.toSVGString(this.element)}}),VMLViewport=jg_static(function(){this._containerElement=null;this._width=0;this._height=0;this._viewBox=null;this.constructor=function(width,height,viewBox,preserveAspectRatio){base.constructor.call(this,"group");this._containerElement=document.createElement("div");this._containerElement.style.position="relative";this._containerElement.style.overflow="hidden";this._containerElement.appendChild(this.element);this.width(null!=width?width:0);this.height(null!=height?height:0);null!=viewBox&&this.viewBox(viewBox);null!=preserveAspectRatio&&this.preserveAspectRatio(preserveAspectRatio)};this.appendTo=function(parentElement){if(null==parentElement)throw new Error("Parameter parentElement must be non-null.");if(null==parentElement.appendChild)throw new Error("Parameter parentElement must be a DOM node.");parentElement.appendChild(this._containerElement);return this};this.remove=function(){this._containerElement.parentNode&&this._containerElement.parentNode.removeChild(this._containerElement);return this};this.dispose=function(){base.dispose.call(this);this._containerElement=null};this.display=function(value){this._containerElement.style.display=value?value:"";return this};this.visibility=function(value){this._containerElement.style.visibility=value?value:"";return this};this.translate=function(x,y){x=null!=x&&x>-1/0&&1/0>x?x:0;y=null!=y&&y>-1/0&&1/0>y?y:0;this._containerElement.style.left=0!=x?x+"px":"";this._containerElement.style.top=0!=y?y+"px":"";return this};this.width=function(value){this._width=null!=value&&1/0>value?Math.max(value,0):0;this._updateView();return this};this.height=function(value){this._height=null!=value&&1/0>value?Math.max(value,0):0;this._updateView();return this};this.viewBox=function(value){this._viewBox=value&&value instanceof Rectangle&&value.isFinite()?value.clone():null;this._updateView();return this};this.preserveAspectRatio=function(){return this};this._updateView=function(){var width=Math.round(this._width),height=Math.round(this._height),viewBox=this._viewBox,viewX=viewBox?Math.round(viewBox.x):0,viewY=viewBox?Math.round(viewBox.y):0,viewWidth=viewBox?Math.round(Math.max(viewBox.width,1)):width,viewHeight=viewBox?Math.round(Math.max(viewBox.height,1)):height,element=this.element,style=element.style,containerStyle=this._containerElement.style;style.display="none";element.coordorigin=viewX+","+viewY;element.coordsize=viewWidth+","+viewHeight;style.width=width+"px";style.height=height+"px";containerStyle.width=width+"px";containerStyle.height=height+"px";style.display=""}});VectorElement.mixin(this,SVGViewport,VMLViewport)})});define("splunk/mapping/layers/VectorLayerBase",["require","leaflet","jg_global","jgatt","jgatt","splunk/mapping/layers/LayerBase","splunk/vectors/Group","splunk/vectors/Viewport"],function(require){var Leaflet=require("leaflet"),jg_extend=require("jg_global").jg_extend,Rectangle=require("jgatt").geom.Rectangle,FunctionUtils=require("jgatt").utils.FunctionUtils,LayerBase=require("splunk/mapping/layers/LayerBase"),Group=require("splunk/vectors/Group"),Viewport=require("splunk/vectors/Viewport"),VectorLayerBase=jg_extend(LayerBase,function(VectorLayerBase,base){this.vectorContainer=null;this.vectorBounds=null;this._isZooming=!1;this.constructor=function(){base.constructor.call(this);this._leafletMap_move=FunctionUtils.bind(this._leafletMap_move,this);this._leafletMap_zoomstart=FunctionUtils.bind(this._leafletMap_zoomstart,this);this._leafletMap_zoomend=FunctionUtils.bind(this._leafletMap_zoomend,this);this.vectorContainer=this.leafletLayer.vectorContainer;this.vectorBounds={minX:0,minY:0,maxX:0,maxY:0}};this.createLeafletLayer=function(){return new LeafletVectorLayer};this.renderOverride=function(){this._isZooming||this.vectorContainer.display(null)};this.onAddedToMap=function(map){base.onAddedToMap.call(this,map);var leafletMap=map.leafletMap;this.vectorContainer.hasSVG?leafletMap.on("move",this._leafletMap_move):leafletMap.on("moveend",this._leafletMap_move);leafletMap.on("viewreset",this._leafletMap_move);leafletMap.on("zoomstart",this._leafletMap_zoomstart);leafletMap.on("zoomend",this._leafletMap_zoomend);this.vectorBounds=leafletMap._vectorLayerBounds;this.vectorContainer.display("none")};this.onRemovedFromMap=function(map){var leafletMap=map.leafletMap;this.vectorContainer.hasSVG?leafletMap.off("move",this._leafletMap_move):leafletMap.off("moveend",this._leafletMap_move);leafletMap.off("viewreset",this._leafletMap_move);leafletMap.off("zoomstart",this._leafletMap_zoomstart);leafletMap.off("zoomend",this._leafletMap_zoomend);this.vectorBounds={minX:0,minY:0,maxX:0,maxY:0};base.onRemovedFromMap.call(this,map)};this._leafletMap_move=function(){this.invalidate("renderPass")};this._leafletMap_zoomstart=function(){this._isZooming=!0;this.vectorContainer.display("none")};this._leafletMap_zoomend=function(){this._isZooming=!1;this.invalidate("renderPass")}}),LeafletVectorLayer=Leaflet.Class.extend({includes:[Leaflet.Mixin.Events],options:{clickable:!0},vectorContainer:null,initialize:function(options){Leaflet.Util.setOptions(this,options);this.vectorContainer=new Group},onAdd:function(map){this._map=map;map._initVectorLayerViewport();this.vectorContainer.appendTo(map._vectorLayerViewport)},onRemove:function(){this._map=null;this.vectorContainer.remove()}});Leaflet.Map.include({_initVectorLayerViewport:function(){if(!this._vectorLayerRoot){var root=this._vectorLayerRoot=document.createElement("div");root.style.position="absolute";this._panes.overlayPane.appendChild(root);var viewport=this._vectorLayerViewport=new Viewport;viewport.appendTo(root);this._vectorLayerBounds={minX:0,minY:0,maxX:0,maxY:0};viewport.hasSVG?this.on("move",this._updateVectorLayerBounds):this.on("moveend",this._updateVectorLayerBounds);this._updateVectorLayerBounds()}},_updateVectorLayerBounds:function(){var root=this._vectorLayerRoot,viewport=this._vectorLayerViewport,bounds=this._vectorLayerBounds,padding=viewport.hasSVG?0:.5,size=this.getSize(),panePos=Leaflet.DomUtil.getPosition(this._mapPane),min=panePos.multiplyBy(-1)._subtract(size.multiplyBy(padding)),max=min.add(size.multiplyBy(1+2*padding)),width=max.x-min.x,height=max.y-min.y;bounds.minX=min.x;bounds.minY=min.y;bounds.maxX=max.x;bounds.maxY=max.y;Leaflet.DomUtil.setPosition(root,min);viewport.width(width);viewport.height(height);viewport.viewBox(new Rectangle(min.x,min.y,width,height))}});return VectorLayerBase});define("splunk/palettes/ColorPalette",["require","jg_global","jg_global","jgatt","jgatt","jgatt","jgatt"],function(require){var jg_extend=require("jg_global").jg_extend,jg_mixin=require("jg_global").jg_mixin,MObservable=require("jgatt").events.MObservable,MPropertyTarget=require("jgatt").properties.MPropertyTarget,Property=require("jgatt").properties.Property,PropertyEventData=require("jgatt").properties.PropertyEventData;
return jg_extend(Object,function(ColorPalette,base){base=jg_mixin(this,MObservable,base);base=jg_mixin(this,MPropertyTarget,base);this._properties=null;this.constructor=function(){base.constructor.call(this);this.addEventListener(this.changed,this._self_changed,1/0)};this.getColor=function(field,index,count){if(null!=field&&"string"!=typeof field)throw new Error("Parameter field must be a string.");if(null==index)throw new Error("Parameter index must be non-null.");if("number"!=typeof index)throw new Error("Parameter index must be a number.");if(null==count)throw new Error("Parameter count must be non-null.");if("number"!=typeof count)throw new Error("Parameter count must be a number.");this._properties||(this._properties=this._getProperties());return this.getColorOverride(this._properties,field,Math.floor(index),Math.floor(count))};this.getColorOverride=function(){return 0};this._getProperties=function(){var property,properties={};for(var p in this){property=this[p];property instanceof Property&&(properties[p]=this.getInternal(property))}return properties};this._self_changed=function(e){e.target===this&&e instanceof PropertyEventData&&(this._properties=null)}})});define("splunk/palettes/ListColorPalette",["require","jg_global","jgatt","jgatt","jgatt","splunk/palettes/ColorPalette"],function(require){var jg_extend=require("jg_global").jg_extend,ColorUtils=require("jgatt").graphics.ColorUtils,ObservableArrayProperty=require("jgatt").properties.ObservableArrayProperty,ObservableProperty=require("jgatt").properties.ObservableProperty,ColorPalette=require("splunk/palettes/ColorPalette");return jg_extend(ColorPalette,function(ListColorPalette,base){this.colors=new ObservableArrayProperty("colors",Number,[]).readFilter(function(value){return value.concat()}).writeFilter(function(value){return value?value.concat():[]});this.interpolate=new ObservableProperty("interpolate",Boolean,!1);this.constructor=function(colors,interpolate){base.constructor.call(this);null!=colors&&this.set(this.colors,colors);null!=interpolate&&this.set(this.interpolate,interpolate)};this.getColorOverride=function(properties,field,index,count){var colors=properties.colors,numColors=colors.length;if(0==numColors)return 0;0>index&&(index=0);if(properties.interpolate){1>count&&(count=1);index>count&&(index=count);var p=1==count?0:(numColors-1)*(index/(count-1)),index1=Math.floor(p),index2=Math.min(index1+1,numColors-1);p-=index1;return ColorUtils.interpolate(colors[index1],colors[index2],p)}return colors[index%numColors]}})});define("splunk/vectors/Shape",["require","jg_global","jg_global","jgatt","splunk/vectors/VectorElement"],function(require){var jg_extend=require("jg_global").jg_extend,jg_static=require("jg_global").jg_static,NumberUtils=require("jgatt").utils.NumberUtils,VectorElement=require("splunk/vectors/VectorElement");return jg_extend(VectorElement,function(Shape,base){this.constructor=function(tagName){base.constructor.call(this,tagName)};this.fillColor=function(){return this};this.fillOpacity=function(){return this};this.strokeColor=function(){return this};this.strokeOpacity=function(){return this};this.strokeWidth=function(){return this};this.strokeLineCap=function(){return this};this.strokeLineJoin=function(){return this};this.strokeMiterLimit=function(){return this};var SVGShape=jg_static(function(){this.constructor=function(tagName){base.constructor.call(this,tagName);this.fillColor(0/0);this.strokeColor(0/0);this.strokeLineCap("none");this.strokeLineJoin("miter")};this.fillColor=function(value){if(null==value||isNaN(value))this.element.setAttribute("fill","none");else{value=NumberUtils.minMax(Math.floor(value),0,16777215);this.element.setAttribute("fill","#"+(16777216|value).toString(16).substring(1))}return this};this.fillOpacity=function(value){null==value||isNaN(value)?this.element.removeAttribute("fill-opacity"):this.element.setAttribute("fill-opacity",NumberUtils.minMax(value,0,1));return this};this.strokeColor=function(value){if(null==value||isNaN(value))this.element.removeAttribute("stroke");else{value=NumberUtils.minMax(Math.floor(value),0,16777215);this.element.setAttribute("stroke","#"+(16777216|value).toString(16).substring(1))}return this};this.strokeOpacity=function(value){null==value||isNaN(value)?this.element.removeAttribute("stroke-opacity"):this.element.setAttribute("stroke-opacity",NumberUtils.minMax(value,0,1));return this};this.strokeWidth=function(value){null!=value&&1/0>value?this.element.setAttribute("stroke-width",Math.max(value,1)):this.element.removeAttribute("stroke-width");return this};this.strokeLineCap=function(value){"round"===value?this.element.setAttribute("stroke-linecap","round"):"square"===value?this.element.setAttribute("stroke-linecap","square"):this.element.removeAttribute("stroke-linecap");return this};this.strokeLineJoin=function(value){"round"===value?this.element.setAttribute("stroke-linejoin","round"):"bevel"===value?this.element.setAttribute("stroke-linejoin","bevel"):this.element.removeAttribute("stroke-linejoin");return this};this.strokeMiterLimit=function(value){null!=value&&1/0>value?this.element.setAttribute("stroke-miterlimit",Math.max(value,1)):this.element.removeAttribute("stroke-miterlimit");return this}}),VMLShape=jg_static(function(){this._fillElement=null;this._strokeElement=null;this.constructor=function(tagName){base.constructor.call(this,tagName);this._fillElement=this.createElement("fill");this._strokeElement=this.createElement("stroke");this.element.appendChild(this._fillElement);this.element.appendChild(this._strokeElement);this.fillColor(0/0);this.strokeColor(0/0);this.strokeLineCap("none");this.strokeLineJoin("miter")};this.dispose=function(){base.dispose.call(this);this._fillElement=null;this._strokeElement=null};this.fillColor=function(value){if(null==value||isNaN(value)){this._fillElement.on=!1;this._fillElement.color="#000000"}else{value=NumberUtils.minMax(Math.floor(value),0,16777215);this._fillElement.on=!0;this._fillElement.color="#"+(16777216|value).toString(16).substring(1)}return this};this.fillOpacity=function(value){this._fillElement.opacity=null==value||isNaN(value)?1:NumberUtils.minMax(value,0,1);return this};this.strokeColor=function(value){if(null==value||isNaN(value)){this._strokeElement.on=!1;this._strokeElement.color="#000000"}else{value=NumberUtils.minMax(Math.floor(value),0,16777215);this._strokeElement.on=!0;this._strokeElement.color="#"+(16777216|value).toString(16).substring(1)}return this};this.strokeOpacity=function(value){this._strokeElement.opacity=null==value||isNaN(value)?1:NumberUtils.minMax(value,0,1);return this};this.strokeWidth=function(value){this._strokeElement.weight=null!=value&&1/0>value?Math.max(value,1)+"px":"1px";return this};this.strokeLineCap=function(value){this._strokeElement.endcap="round"===value?"round":"square"===value?"square":"flat";return this};this.strokeLineJoin=function(value){this._strokeElement.joinstyle="round"===value?"round":"bevel"===value?"bevel":"miter";return this};this.strokeMiterLimit=function(value){this._strokeElement.miterlimit=null!=value&&1/0>value?Math.max(value,1):4;return this}});VectorElement.mixin(this,SVGShape,VMLShape)})});define("splunk/vectors/Wedge",["require","jg_global","jg_global","jgatt","splunk/vectors/Shape","splunk/vectors/VectorElement"],function(require){var jg_extend=require("jg_global").jg_extend,jg_static=require("jg_global").jg_static,NumberUtils=require("jgatt").utils.NumberUtils,Shape=require("splunk/vectors/Shape"),VectorElement=require("splunk/vectors/VectorElement");return jg_extend(Shape,function(Wedge,base){this.constructor=function(){base.constructor.call(this)};this.draw=function(){return this};var SVGWedge=jg_static(function(){this.constructor=function(){base.constructor.call(this,"path")};this.draw=function(x,y,radiusX,radiusY,startAngle,arcAngle){x=null!=x&&x>-1/0&&1/0>x?x:0;y=null!=y&&y>-1/0&&1/0>y?y:0;radiusX=null!=radiusX&&1/0>radiusX?Math.max(radiusX,0):0;radiusY=null!=radiusY&&1/0>radiusY?Math.max(radiusY,0):0;startAngle=null!=startAngle&&startAngle>-1/0&&1/0>startAngle?startAngle:0;arcAngle=null==arcAngle||null==arcAngle||isNaN(arcAngle)?0:NumberUtils.minMax(arcAngle,-360,360);if(0==radiusX||0==radiusY||0==arcAngle){this.element.removeAttribute("d");return this}var a1=startAngle/180*Math.PI,x1=x+Math.cos(a1)*radiusX,y1=y+Math.sin(a1)*radiusY,a2=(startAngle+arcAngle/2)/180*Math.PI,x2=x+Math.cos(a2)*radiusX,y2=y+Math.sin(a2)*radiusY,a3=(startAngle+arcAngle)/180*Math.PI,x3=x+Math.cos(a3)*radiusX,y3=y+Math.sin(a3)*radiusY,sweepFlag=0>arcAngle?0:1,pathData="";if(arcAngle>-360&&360>arcAngle){pathData+="M"+x+","+y;pathData+=" L"+x1+","+y1}else pathData+="M"+x1+","+y1;pathData+=" A"+radiusX+","+radiusY+" 0 0 "+sweepFlag+" "+x2+","+y2;pathData+=" "+radiusX+","+radiusY+" 0 0 "+sweepFlag+" "+x3+","+y3;pathData+=" Z";this.element.setAttribute("d",pathData);return this}}),VMLWedge=jg_static(function(){var _RES=64;this._pathElement=null;this.constructor=function(){base.constructor.call(this,"shape");this._pathElement=this.createElement("path");this.element.style.width="1px";this.element.style.height="1px";this.element.coordsize=_RES+","+_RES;this.element.appendChild(this._pathElement)};this.dispose=function(){base.dispose.call(this);this._pathElement=null};this.draw=function(x,y,radiusX,radiusY,startAngle,arcAngle){x=null!=x&&x>-1/0&&1/0>x?x:0;y=null!=y&&y>-1/0&&1/0>y?y:0;radiusX=null!=radiusX&&1/0>radiusX?Math.max(radiusX,0):0;radiusY=null!=radiusY&&1/0>radiusY?Math.max(radiusY,0):0;startAngle=null!=startAngle&&startAngle>-1/0&&1/0>startAngle?startAngle:0;arcAngle=null==arcAngle||null==arcAngle||isNaN(arcAngle)?0:NumberUtils.minMax(arcAngle,-360,360);if(0==radiusX||0==radiusY||0==arcAngle){this._pathElement.v=" ";return this}var a1=startAngle/180*Math.PI,x1=x+Math.cos(a1)*radiusX,y1=y+Math.sin(a1)*radiusY,a2=(startAngle+arcAngle/2)/180*Math.PI,x2=x+Math.cos(a2)*radiusX,y2=y+Math.sin(a2)*radiusY,a3=(startAngle+arcAngle)/180*Math.PI,x3=x+Math.cos(a3)*radiusX,y3=y+Math.sin(a3)*radiusY,left=Math.round((x-radiusX)*_RES),top=Math.round((y-radiusY)*_RES),right=Math.round((x+radiusX)*_RES),bottom=Math.round((y+radiusY)*_RES);x=Math.round(x*_RES);y=Math.round(y*_RES);x1=Math.round(x1*_RES);y1=Math.round(y1*_RES);x2=Math.round(x2*_RES);y2=Math.round(y2*_RES);x3=Math.round(x3*_RES);y3=Math.round(y3*_RES);var pathData="";if(arcAngle>-360&&360>arcAngle){pathData+="m "+x+","+y;pathData+=" l "+x1+","+y1}else pathData+="m "+x1+","+y1;pathData+=0>arcAngle?" at":" wa";pathData+=" "+left+","+top+","+right+","+bottom+", "+x1+","+y1+", "+x2+","+y2;pathData+=", "+left+","+top+","+right+","+bottom+", "+x2+","+y2+", "+x3+","+y3;pathData+=" x";this._pathElement.v=pathData;return this}});VectorElement.mixin(this,SVGWedge,VMLWedge)})});define("splunk/viz/MDataTarget",["require","jg_global","jg_global","jgatt","jgatt","jgatt","jgatt","jgatt","jgatt","jgatt","splunk/charting/Legend"],function(require){var jg_static=require("jg_global").jg_static,jg_mixin=require("jg_global").jg_mixin,MObservable=require("jgatt").events.MObservable,MPropertyTarget=require("jgatt").properties.MPropertyTarget,ObservableArrayProperty=require("jgatt").properties.ObservableArrayProperty,ObservableProperty=require("jgatt").properties.ObservableProperty,FunctionUtils=require("jgatt").utils.FunctionUtils,MValidateTarget=require("jgatt").validation.MValidateTarget,ValidatePass=require("jgatt").validation.ValidatePass,Legend=require("splunk/charting/Legend");return jg_static(function(){this.mixin=function(base){base=jg_mixin(this,MObservable,base);base=jg_mixin(this,MPropertyTarget,base);base=jg_mixin(this,MValidateTarget,base)};this.processDataPass=new ValidatePass("processData",.1);this.updateLegendLabelsPass=new ValidatePass("updateLegendLabels",.2);this.renderDataPass=new ValidatePass("renderData",.3);this.data=new ObservableProperty("data",Array,null).onChanged(function(){this.invalidate("processDataPass")});this.fields=new ObservableArrayProperty("fields",String,null).onChanged(function(){this.invalidate("processDataPass")});this.legend=new ObservableProperty("legend",Legend,null).onChanged(function(e){if(e.target!==this)e.event!==e.target.labelIndexMapChanged||this.invalidate("renderDataPass");else{var oldLegend=e.oldValue,newLegend=e.newValue;if(oldLegend){oldLegend.removeEventListener("settingLabels",this._legend_settingLabels);oldLegend.unregister(this)}if(newLegend){newLegend.register(this);newLegend.addEventListener("settingLabels",this._legend_settingLabels)}this.invalidate("updateLegendLabelsPass")}});this._cachedData=null;this._cachedFields=null;this._cachedLegend=null;this.constructor=function(){this._legend_settingLabels=FunctionUtils.bind(this._legend_settingLabels,this)};this.processData=function(){this.validatePreceding("processDataPass");if(!this.isValid("processDataPass")){this.invalidate("updateLegendLabelsPass");var data=this._cachedData=this.getInternal("data")||[],fields=this._cachedFields=this.getInternal("fields")||[];this.processDataOverride(data,fields);this.setValid("processDataPass")}};this.updateLegendLabels=function(){this.validatePreceding("updateLegendLabelsPass");if(!this.isValid("updateLegendLabelsPass")){this.invalidate("renderDataPass");var legend=this._cachedLegend=this.getInternal("legend"),labels=null;legend&&(labels=this.updateLegendLabelsOverride(this._cachedData,this._cachedFields));this.setValid("updateLegendLabelsPass");legend&&legend.setLabels(this,labels)}};this.renderData=function(){this.validatePreceding("renderDataPass");if(!this.isValid("renderDataPass")){this.renderDataOverride(this._cachedData,this._cachedFields,this._cachedLegend);this.setValid("renderDataPass")}};this.processDataOverride=function(){};this.updateLegendLabelsOverride=function(){return null};this.renderDataOverride=function(){};this._legend_settingLabels=function(){this.validate("updateLegendLabelsPass")}})});define("splunk/mapping/layers/PieMarkerLayer",["require","leaflet","jg_global","jg_global","jgatt","jgatt","jgatt","jgatt","splunk/mapping/LatLon","splunk/mapping/LatLonBounds","splunk/mapping/layers/LayerBase","splunk/mapping/layers/VectorLayerBase","splunk/palettes/ColorPalette","splunk/palettes/ListColorPalette","splunk/vectors/Group","splunk/vectors/Wedge","splunk/viz/MDataTarget"],function(require){var jg_extend=(require("leaflet"),require("jg_global").jg_extend),jg_mixin=require("jg_global").jg_mixin,ObservableProperty=(require("jgatt").geom.Point,require("jgatt").geom.Rectangle,require("jgatt").properties.ObservableProperty),NumberUtils=require("jgatt").utils.NumberUtils,LatLon=require("splunk/mapping/LatLon"),LatLonBounds=require("splunk/mapping/LatLonBounds"),LayerBase=require("splunk/mapping/layers/LayerBase"),VectorLayerBase=require("splunk/mapping/layers/VectorLayerBase"),ColorPalette=require("splunk/palettes/ColorPalette"),ListColorPalette=require("splunk/palettes/ListColorPalette"),Group=require("splunk/vectors/Group"),Wedge=require("splunk/vectors/Wedge"),MDataTarget=require("splunk/viz/MDataTarget"),PieMarkerLayer=jg_extend(VectorLayerBase,function(PieMarkerLayer,base){base=jg_mixin(this,MDataTarget,base);this.markerColorPalette=new ObservableProperty("markerColorPalette",ColorPalette,new ListColorPalette([52224,13421568,13369344],!0)).onChanged(function(){this.invalidate("renderDataPass")});this.markerOpacity=new ObservableProperty("markerOpacity",Number,1).writeFilter(function(value){return value>=0&&1/0>=value?Math.min(value,1):0}).onChanged(function(){this.invalidate("renderDataPass")});this.markerMinSize=new ObservableProperty("markerMinSize",Number,10).writeFilter(function(value){return value>=0&&1/0>value?value:0}).onChanged(function(){this.invalidate("renderDataPass")});this.markerMaxSize=new ObservableProperty("markerMaxSize",Number,50).writeFilter(function(value){return value>=0&&1/0>value?value:0}).onChanged(function(){this.invalidate("renderDataPass")});this.wrapX=new ObservableProperty("wrapX",Boolean,!0).onChanged(function(){this.invalidate("renderPass")});this.wrapY=new ObservableProperty("wrapY",Boolean,!1).onChanged(function(){this.invalidate("renderPass")});this._seriesList=null;this._markerList=null;this.constructor=function(){base.constructor.call(this);this._seriesList=[];this._markerList=[]};this.getLatLonBounds=function(center){if(null!=center&&!(center instanceof LatLon))throw new Error("Parameter center must be an instance of splunk.mapping.LatLon.");this.validate();for(var bounds=new LatLonBounds(1/0,1/0,-1/0,-1/0),markerList=this._markerList,i=0,l=markerList.length;l>i;i++)bounds.expand(markerList[i].latLon.normalize(center));return bounds.isFinite()?bounds:null};this.processDataOverride=function(data,fields){var series,marker,sliceList,numSlices,slice,i,j,seriesList=this._seriesList,numSeries=0,markerList=this._markerList,numMarkers=0,numRows=data.length,numFields=fields.length;if(numRows>0&&numFields>2){var fieldSeries,obj,valueLat,valueLon,valueSeries,mag,sum,angle1,angle2,vectorContainer=this.vectorContainer,fieldLat=fields[0],fieldLon=fields[1],magMin=1/0,magMax=-1/0,magSpan=0;for(i=2;numFields>i;i++){fieldSeries=fields[i];if(numSeries<seriesList.length)series=seriesList[numSeries];else{series=new Series;seriesList.push(series)}series.name=fieldSeries;numSeries++}for(i=0;numRows>i;i++){obj=data[i];if(null!=obj){valueLat=NumberUtils.parseNumber(obj[fieldLat]);valueLon=NumberUtils.parseNumber(obj[fieldLon]);if(!isNaN(valueLat)&&!isNaN(valueLon)){if(numMarkers<markerList.length)marker=markerList[numMarkers];else{marker=new PieMarker;marker.appendTo(vectorContainer);markerList.push(marker)}sliceList=marker.sliceList;numSlices=0;mag=0;for(j=0;numSeries>j;j++){series=seriesList[j];valueSeries=NumberUtils.parseNumber(obj[series.name]);if(!(isNaN(valueSeries)||0>=valueSeries)){if(numSlices<sliceList.length)slice=sliceList[numSlices];else{slice=new PieSlice;slice.appendTo(marker);sliceList.push(slice)}slice.series=series;slice.value=valueSeries;mag+=valueSeries;numSlices++}}if(0!==numSlices){marker.latLon=new LatLon(valueLat,valueLon);marker.data=obj;marker.fields=fields;marker.magnitude=mag;magMin>mag&&(magMin=mag);mag>magMax&&(magMax=mag);sum=0;angle1=0;angle2=0;for(j=0;numSlices>j;j++){slice=sliceList[j];sum+=slice.value;angle1=angle2;angle2=360*(sum/mag);slice.startAngle=angle1-90;slice.arcAngle=angle2-angle1}for(j=sliceList.length-1;j>=numSlices;j--){slice=sliceList.pop();slice.dispose()}numMarkers++}}}}magSpan=magMax-magMin;for(i=0;numMarkers>i;i++){marker=markerList[i];marker.scale=magSpan>0?NumberUtils.minMax((marker.magnitude-magMin)/magSpan,0,1):1/numMarkers}}for(i=markerList.length-1;i>=numMarkers;i--){marker=markerList.pop();marker.dispose()}for(i=seriesList.length-1;i>=numSeries;i--)seriesList.pop()};this.updateLegendLabelsOverride=function(){for(var seriesList=this._seriesList,numSeries=seriesList.length,labels=numSeries>0?new Array(numSeries):null,i=0;numSeries>i;i++)labels[i]=seriesList[i].name;return labels};this.renderDataOverride=function(data,fields,legend){this.invalidate("renderPass");var series,seriesIndex,seriesCount,marker,sliceList,numSlices,slice,i,j,seriesList=this._seriesList,numSeries=seriesList.length,markerColorPalette=this.getInternal("markerColorPalette"),markerOpacity=this.getInternal("markerOpacity"),markerMinSize=this.getInternal("markerMinSize"),markerMaxSize=this.getInternal("markerMaxSize"),markerList=this._markerList,numMarkers=markerList.length;seriesCount=legend?legend.getNumLabels():numSeries;for(i=0;numSeries>i;i++){series=seriesList[i];seriesIndex=legend?legend.getLabelIndex(series.name):i;series.color=markerColorPalette?markerColorPalette.getColor(series.name,seriesIndex,seriesCount):0}for(i=0;numMarkers>i;i++){marker=markerList[i];sliceList=marker.sliceList;numSlices=sliceList.length;marker.radius=Math.round(NumberUtils.interpolate(markerMinSize,markerMaxSize,marker.scale))/2;marker.tooltipOffsetRadius=marker.radius;marker.display("none");for(j=0;numSlices>j;j++){slice=sliceList[j];slice.fillColor(slice.series.color);slice.fillOpacity(markerOpacity);slice.draw(0,0,marker.radius,marker.radius,slice.startAngle,slice.arcAngle)}}};this.renderOverride=function(map){base.renderOverride.call(this,map);for(var marker,markerLatLng,markerPoint,leafletMap=map.leafletMap,centerLatLng=leafletMap.getCenter(),wrapX=this.getInternal("wrapX"),wrapY=this.getInternal("wrapY"),vectorBounds=this.vectorBounds,minX=vectorBounds.minX,minY=vectorBounds.minY,maxX=vectorBounds.maxX,maxY=vectorBounds.maxY,markerList=this._markerList,i=0,l=markerList.length;l>i;i++){marker=markerList[i];markerLatLng=marker.latLon.toLeaflet();if(wrapX){markerLatLng.lng-=centerLatLng.lng;markerLatLng.lng%=360;markerLatLng.lng>180?markerLatLng.lng-=360:markerLatLng.lng<-180&&(markerLatLng.lng+=360);markerLatLng.lng+=centerLatLng.lng}if(wrapY){markerLatLng.lat-=centerLatLng.lat;markerLatLng.lat%=180;markerLatLng.lat>90?markerLatLng.lat-=180:markerLatLng.lat<-90&&(markerLatLng.lat+=180);markerLatLng.lat+=centerLatLng.lat}marker.tooltipLatLng=markerLatLng;markerPoint=leafletMap.latLngToLayerPoint(markerLatLng);marker.translate(markerPoint.x,markerPoint.y);marker.display(markerPoint.x+marker.radius<minX||markerPoint.x-marker.radius>maxX||markerPoint.y+marker.radius<minY||markerPoint.y-marker.radius>maxY?"none":null)}}}),Series=jg_extend(Object,function(){this.name=null;this.color=0;this.constructor=function(){}}),PieMarker=jg_extend(Group,function(PieMarker,base){this.sliceList=null;this.latLon=null;this.data=null;this.fields=null;this.magnitude=0;this.scale=0;this.radius=0;this.tooltipLatLng=null;this.tooltipOffsetRadius=0;this.constructor=function(){base.constructor.call(this);this.element[LayerBase.METADATA_KEY]=this;this.sliceList=[]};this.dispose=function(){for(var sliceList=this.sliceList,i=sliceList.length-1;i>=0;i--)sliceList[i].dispose();this.element[LayerBase.METADATA_KEY]=null;base.dispose.call(this)}}),PieSlice=jg_extend(Wedge,function(PieSlice,base){this.series=null;this.value=0;this.startAngle=0;this.arcAngle=0;this.constructor=function(){base.constructor.call(this)}});return PieMarkerLayer});define("splunk/parsers/Parser",["require","jg_global"],function(require){var jg_extend=require("jg_global").jg_extend;return jg_extend(Object,function(){this.stringToValue=function(){return null};this.valueToString=function(){return null}})});define("splunk/parsers/ParseUtils",["require","jg_global"],function(require){var jg_static=require("jg_global").jg_static;return jg_static(function(ParseUtils){var _UNESCAPE_PATTERN=/\\([.\n\r]?)/g,_ESCAPE_SLASH_PATTERN=/\\/g,_ESCAPE_QUOTE_PATTERN=/"/g;ParseUtils.prepareArray=function(str){if(!str||"string"!=typeof str)return null;str=ParseUtils.trimWhiteSpace(str);if(!str)return null;var length=str.length;if(2>length)return null;if("["!=str.charAt(0))return null;if("]"!=str.charAt(length-1))return null;str=str.substring(1,length-1);length=str.length;for(var value,arr=[],index=-1;length>index;){index++;value=_readUntil(str,index,",");index+=value.length;value=ParseUtils.trimWhiteSpace(value);(value||length>index||arr.length>0)&&arr.push(ParseUtils.unescapeString(value))}return arr};ParseUtils.prepareObject=function(str){if(!str||"string"!=typeof str)return null;str=ParseUtils.trimWhiteSpace(str);if(!str)return null;var length=str.length;if(2>length)return null;if("{"!=str.charAt(0))return null;if("}"!=str.charAt(length-1))return null;str=str.substring(1,length-1);length=str.length;for(var key,value,obj={},index=0;length>index;){key=_readUntil(str,index,":");index+=key.length+1;if(index>length)break;value=_readUntil(str,index,",");index+=value.length+1;key=ParseUtils.unescapeString(key);key&&(obj[key]=ParseUtils.unescapeString(value))}return obj};ParseUtils.prepareTuple=function(str){if(!str||"string"!=typeof str)return null;str=ParseUtils.trimWhiteSpace(str);if(!str)return null;var length=str.length;if(2>length)return null;if("("!=str.charAt(0))return null;if(")"!=str.charAt(length-1))return null;str=str.substring(1,length-1);length=str.length;for(var value,arr=[],index=-1;length>index;){index++;value=_readUntil(str,index,",");index+=value.length;value=ParseUtils.trimWhiteSpace(value);(value||length>index||arr.length>0)&&arr.push(ParseUtils.unescapeString(value))}return arr};ParseUtils.unescapeString=function(str){if(null==str||"string"!=typeof str)return null;if(!str)return str;str=ParseUtils.trimWhiteSpace(str);if(!str)return str;var length=str.length;if(2>length)return str;if('"'!=str.charAt(0))return str;if('"'!=str.charAt(length-1))return str;str=str.substring(1,length-1);if(!str)return str;str=str.replace(_UNESCAPE_PATTERN,"$1");return str};ParseUtils.escapeString=function(str){if(null==str||"string"!=typeof str)return null;str=str.replace(_ESCAPE_SLASH_PATTERN,"\\\\");str=str.replace(_ESCAPE_QUOTE_PATTERN,'\\"');return'"'+str+'"'};ParseUtils.trimWhiteSpace=function(str){if(null==str||"string"!=typeof str)return null;if(!str)return str;var startIndex=0,endIndex=str.length-1;for(startIndex;endIndex>=startIndex&&ParseUtils.isWhiteSpace(str.charAt(startIndex));startIndex++);for(endIndex;endIndex>=startIndex&&ParseUtils.isWhiteSpace(str.charAt(endIndex));endIndex--);return str.substring(startIndex,endIndex+1)};ParseUtils.isWhiteSpace=function(ch){return" "===ch||"	"===ch||"\n"===ch||"\r"===ch};var _readUntil=function(str,startIndex,endChar){for(var ch,nestBeginChar,nestEndChar,substr="",index=startIndex,length=str.length,isQuote=!1,nestLevel=0;length>index;){ch=str.charAt(index);if(isQuote){if('"'==ch)isQuote=!1;else if("\\"==ch){substr+=ch;index++;ch=str.charAt(index)}}else if(nestLevel>0)ch==nestEndChar?nestLevel--:ch==nestBeginChar?nestLevel++:'"'==ch&&(isQuote=!0);else{if(ch==endChar)break;if("["==ch){nestLevel=1;nestBeginChar="[";nestEndChar="]"}else if("{"==ch){nestLevel=1;nestBeginChar="{";nestEndChar="}"}else if("("==ch){nestLevel=1;nestBeginChar="(";nestEndChar=")"}else'"'==ch&&(isQuote=!0)}substr+=ch;index++}return substr}})});define("splunk/parsers/NumberParser",["require","jg_global","splunk/parsers/Parser","splunk/parsers/ParseUtils"],function(require){var jg_extend=require("jg_global").jg_extend,Parser=require("splunk/parsers/Parser"),ParseUtils=require("splunk/parsers/ParseUtils");return jg_extend(Parser,function(NumberParser){var _instance=null;NumberParser.getInstance=function(){_instance||(_instance=new NumberParser);return _instance};this.stringToValue=function(str){str=ParseUtils.trimWhiteSpace(str);return str?Number(str):0/0};this.valueToString=function(value){return String("number"==typeof value?value:0/0)}})});define("splunk/mapping/parsers/LatLonBoundsParser",["require","jg_global","splunk/mapping/LatLonBounds","splunk/parsers/NumberParser","splunk/parsers/Parser","splunk/parsers/ParseUtils"],function(require){var jg_extend=require("jg_global").jg_extend,LatLonBounds=require("splunk/mapping/LatLonBounds"),NumberParser=require("splunk/parsers/NumberParser"),Parser=require("splunk/parsers/Parser"),ParseUtils=require("splunk/parsers/ParseUtils");return jg_extend(Parser,function(LatLonBoundsParser){var _instance=null;LatLonBoundsParser.getInstance=function(){_instance||(_instance=new LatLonBoundsParser);return _instance};this.numberParser=null;this.constructor=function(){this.numberParser=NumberParser.getInstance()};this.stringToValue=function(str){var values=ParseUtils.prepareTuple(str);if(!values)return null;var latLonBounds=new LatLonBounds,numValues=values.length;numValues>0&&(latLonBounds.s=this.numberParser.stringToValue(values[0]));numValues>1&&(latLonBounds.w=this.numberParser.stringToValue(values[1]));numValues>2&&(latLonBounds.n=this.numberParser.stringToValue(values[2]));numValues>3&&(latLonBounds.e=this.numberParser.stringToValue(values[3]));return latLonBounds};this.valueToString=function(value){var latLonBounds=value instanceof LatLonBounds?value:null;if(!latLonBounds)return null;var str="";str+=this.numberParser.valueToString(latLonBounds.s)+",";str+=this.numberParser.valueToString(latLonBounds.w)+",";str+=this.numberParser.valueToString(latLonBounds.n)+",";str+=this.numberParser.valueToString(latLonBounds.e);return"("+str+")"}})});define("splunk/mapping/parsers/LatLonParser",["require","jg_global","splunk/mapping/LatLon","splunk/parsers/NumberParser","splunk/parsers/Parser","splunk/parsers/ParseUtils"],function(require){var jg_extend=require("jg_global").jg_extend,LatLon=require("splunk/mapping/LatLon"),NumberParser=require("splunk/parsers/NumberParser"),Parser=require("splunk/parsers/Parser"),ParseUtils=require("splunk/parsers/ParseUtils");return jg_extend(Parser,function(LatLonParser){var _instance=null;LatLonParser.getInstance=function(){_instance||(_instance=new LatLonParser);return _instance};this.numberParser=null;this.constructor=function(){this.numberParser=NumberParser.getInstance()};this.stringToValue=function(str){var values=ParseUtils.prepareTuple(str);if(!values)return null;var latLon=new LatLon,numValues=values.length;numValues>0&&(latLon.lat=this.numberParser.stringToValue(values[0]));numValues>1&&(latLon.lon=this.numberParser.stringToValue(values[1]));return latLon};this.valueToString=function(value){var latLon=value instanceof LatLon?value:null;if(!latLon)return null;var str="";str+=this.numberParser.valueToString(latLon.lat)+",";str+=this.numberParser.valueToString(latLon.lon);return"("+str+")"}})});define("splunk/palettes/FieldColorPalette",["require","jg_global","jgatt","splunk/palettes/ColorPalette"],function(require){var jg_extend=require("jg_global").jg_extend,ObservableProperty=require("jgatt").properties.ObservableProperty,ColorPalette=require("splunk/palettes/ColorPalette");return jg_extend(ColorPalette,function(FieldColorPalette,base){var _cloneFieldColors=function(fieldColors){var fieldColors2={};for(var field in fieldColors)null!=fieldColors[field]&&(fieldColors2[field]=Number(fieldColors[field]));return fieldColors2};this.fieldColors=new ObservableProperty("fieldColors",Object,{}).readFilter(function(value){return _cloneFieldColors(value)}).writeFilter(function(value){return _cloneFieldColors(value)});this.defaultColorPalette=new ObservableProperty("defaultColorPalette",ColorPalette,null);this.constructor=function(fieldColors,defaultColorPalette){base.constructor.call(this);null!=fieldColors&&this.set(this.fieldColors,fieldColors);null!=defaultColorPalette&&this.set(this.defaultColorPalette,defaultColorPalette)};this.getColorOverride=function(properties,field,index,count){if(field){var color=properties.fieldColors[field];if(null!=color&&!isNaN(color))return color}return properties.defaultColorPalette?properties.defaultColorPalette.getColor(field,index,count):0}})});define("splunk/parsers/StringParser",["require","jg_global","splunk/parsers/Parser"],function(require){var jg_extend=require("jg_global").jg_extend,Parser=require("splunk/parsers/Parser");return jg_extend(Parser,function(StringParser){var _instance=null;StringParser.getInstance=function(){_instance||(_instance=new StringParser);return _instance};this.stringToValue=function(str){return null==str||"string"!=typeof str?null:str};this.valueToString=function(value){return null==value?null:String(value)}})});define("splunk/parsers/ArrayParser",["require","jg_global","jgatt","splunk/parsers/Parser","splunk/parsers/ParseUtils","splunk/parsers/StringParser"],function(require){var jg_extend=require("jg_global").jg_extend,Dictionary=require("jgatt").utils.Dictionary,Parser=require("splunk/parsers/Parser"),ParseUtils=require("splunk/parsers/ParseUtils"),StringParser=require("splunk/parsers/StringParser");return jg_extend(Parser,function(ArrayParser){var _instances=new Dictionary;ArrayParser.getInstance=function(elementParser){var instance=_instances.get(elementParser);instance||(instance=_instances.set(elementParser,new ArrayParser(elementParser)));return instance};this.elementParser=null;this.constructor=function(elementParser){if(null==elementParser)throw new Error("Parameter elementParser must be non-null.");if(!(elementParser instanceof Parser))throw new Error("Parameter elementParser must be an instance of splunk.parsers.Parser.");
this.elementParser=elementParser};this.stringToValue=function(str){var array=ParseUtils.prepareArray(str);if(!array)return null;for(var elementParser=this.elementParser,i=0,l=array.length;l>i;i++)array[i]=elementParser.stringToValue(array[i]);return array};this.valueToString=function(value){var array=value instanceof Array?value:null;if(!array)return null;for(var elementValue,str="",elementParser=this.elementParser,i=0,l=array.length;l>i;i++){elementValue=array[i];str&&(str+=",");str+=elementParser instanceof StringParser?ParseUtils.escapeString(elementParser.valueToString(elementValue)):elementParser.valueToString(elementValue)}return"["+str+"]"}})});define("splunk/parsers/BooleanParser",["require","jg_global","splunk/parsers/Parser","splunk/parsers/ParseUtils"],function(require){var jg_extend=require("jg_global").jg_extend,Parser=require("splunk/parsers/Parser"),ParseUtils=require("splunk/parsers/ParseUtils");return jg_extend(Parser,function(BooleanParser){var _instance=null;BooleanParser.getInstance=function(){_instance||(_instance=new BooleanParser);return _instance};this.stringToValue=function(str){str=ParseUtils.trimWhiteSpace(str);str&&(str=str.toLowerCase());return"true"===str||"t"===str||"1"===str};this.valueToString=function(value){return value?"true":"false"}})});define("splunk/parsers/ObjectParser",["require","jg_global","jgatt","splunk/parsers/Parser","splunk/parsers/ParseUtils","splunk/parsers/StringParser"],function(require){var jg_extend=require("jg_global").jg_extend,Dictionary=require("jgatt").utils.Dictionary,Parser=require("splunk/parsers/Parser"),ParseUtils=require("splunk/parsers/ParseUtils"),StringParser=require("splunk/parsers/StringParser");return jg_extend(Parser,function(ObjectParser){var _instances=new Dictionary;ObjectParser.getInstance=function(elementParser){var instance=_instances.get(elementParser);instance||(instance=_instances.set(elementParser,new ObjectParser(elementParser)));return instance};this.elementParser=null;this.constructor=function(elementParser){if(null==elementParser)throw new Error("Parameter elementParser must be non-null.");if(!(elementParser instanceof Parser))throw new Error("Parameter elementParser must be an instance of splunk.parsers.Parser.");this.elementParser=elementParser};this.stringToValue=function(str){var map=ParseUtils.prepareObject(str);if(!map)return null;var elementParser=this.elementParser;for(var key in map)map.hasOwnProperty(key)&&(map[key]=elementParser.stringToValue(map[key]));return map};this.valueToString=function(value){var map=value instanceof Object?value:null;if(!map)return null;var str="",elementParser=this.elementParser;for(var key in map)if(map.hasOwnProperty(key)){str&&(str+=",");str+=ParseUtils.escapeString(key)+":";str+=elementParser instanceof StringParser?ParseUtils.escapeString(elementParser.valueToString(map[key])):elementParser.valueToString(map[key])}return"{"+str+"}"}})});define("views/shared/Map",["require","exports","module","jquery","splunk.i18n","splunk.util","jgatt","jgatt","splunk/charting/ExternalLegend","splunk/mapping/Map","splunk/mapping/layers/PieMarkerLayer","splunk/mapping/parsers/LatLonBoundsParser","splunk/mapping/parsers/LatLonParser","splunk/palettes/FieldColorPalette","splunk/palettes/ListColorPalette","splunk/parsers/ArrayParser","splunk/parsers/BooleanParser","splunk/parsers/NumberParser","splunk/parsers/ObjectParser","splunk/parsers/StringParser","views/Base","util/console"],function(require,exports,module){var $=require("jquery"),SplunkI18N=require("splunk.i18n"),_=SplunkI18N._,SplunkUtil=require("splunk.util"),sprintf=SplunkUtil.sprintf,FunctionUtils=require("jgatt").utils.FunctionUtils,ValidateQueue=require("jgatt").validation.ValidateQueue,ExternalLegend=require("splunk/charting/ExternalLegend"),Map=require("splunk/mapping/Map"),PieMarkerLayer=require("splunk/mapping/layers/PieMarkerLayer"),LatLonBoundsParser=require("splunk/mapping/parsers/LatLonBoundsParser"),LatLonParser=require("splunk/mapping/parsers/LatLonParser"),FieldColorPalette=require("splunk/palettes/FieldColorPalette"),ListColorPalette=require("splunk/palettes/ListColorPalette"),ArrayParser=require("splunk/parsers/ArrayParser"),BooleanParser=require("splunk/parsers/BooleanParser"),NumberParser=require("splunk/parsers/NumberParser"),ObjectParser=require("splunk/parsers/ObjectParser"),StringParser=require("splunk/parsers/StringParser"),Base=require("views/Base"),console=require("util/console"),_DEFAULT_PROPERTY_VALUES={fieldColors:"",seriesColors:"[0x6CB8CA,0xFAC61D,0xD85E3D,0x956E96,0xF7912C,0x9AC23C,0x5479AF,0x999755,0xDD87B0,0x65AA82,0xA7D4DF,0xFCDD77,0xE89E8B,0xBFA8C0,0xFABD80,0xC2DA8A,0x98AFCF,0xC2C199,0xEBB7D0,0xA3CCB4,0x416E79,0x967711,0x823825,0x59425A,0x94571A,0x5C7424,0x324969,0x5C5B33,0x85516A,0x3D664E]","data.maxClusters":"100","tileLayer.url":"/splunkd/__raw/services/mbtiles/splunk-tiles/{z}/{x}/{y}","tileLayer.subdomains":"[a,b,c]","tileLayer.minZoom":"0","tileLayer.maxZoom":"7","tileLayer.invertY":"false","tileLayer.attribution":"","markerLayer.markerOpacity":"1","markerLayer.markerMinSize":"10","markerLayer.markerMaxSize":"50"},_R_PROPERTY_PREFIX=/^display\.visualizations\.mapping\./;return Base.extend({moduleId:module.id,_map:null,_markerLayer:null,_externalLegend:null,_fieldColorPalette:null,_seriesColorPalette:null,_propertyValues:null,_booleanParser:null,_numberParser:null,_stringParser:null,_numberArrayParser:null,_stringArrayParser:null,_numberObjectParser:null,_latLonParser:null,_latLonBoundsParser:null,_maxClusters:100,_isPrinting:!1,_prePrintCenter:null,_prePrintZoom:0,initialize:function(options){Base.prototype.initialize.apply(this,arguments);this.options=options||{};this.$el.width(this.options.width||"100%");this.$el.height(this.options.height||"400px");this._map_boundsChanged=FunctionUtils.bind(this._map_boundsChanged,this);this._map_mapClicked=FunctionUtils.bind(this._map_mapClicked,this);this._document_PrintStart=FunctionUtils.bind(this._document_PrintStart,this);this._document_PrintEnd=FunctionUtils.bind(this._document_PrintEnd,this);this._propertyValues={};this._booleanParser=BooleanParser.getInstance();this._numberParser=NumberParser.getInstance();this._stringParser=StringParser.getInstance();this._numberArrayParser=ArrayParser.getInstance(this._numberParser);this._stringArrayParser=ArrayParser.getInstance(this._stringParser);this._numberObjectParser=ObjectParser.getInstance(this._numberParser);this._latLonParser=LatLonParser.getInstance();this._latLonBoundsParser=LatLonBoundsParser.getInstance();this._seriesColorPalette=new ListColorPalette;this._fieldColorPalette=new FieldColorPalette(null,this._seriesColorPalette);this._externalLegend=new ExternalLegend;this._externalLegend.connect();this._markerLayer=new PieMarkerLayer;this._markerLayer.set("legend",this._externalLegend);this._markerLayer.set("markerColorPalette",this._fieldColorPalette);this._map=new Map;this._map.formatNumber=this._formatNumber;this._map.formatDegrees=this._formatDegrees;this._map.addLayer(this._markerLayer);this._map.addEventListener("boundsChanged",this._map_boundsChanged);this._map.addEventListener("mapClicked",this._map_mapClicked);this._map.appendTo(this.$el);this._map.fitWorld(!0);$(document).bind("PrintStart",this._document_PrintStart);$(document).bind("PrintEnd",this._document_PrintEnd);this.updateData();this.updateProperties();this._updateDataBounds();this.activate()},startListening:function(){this.model.searchResultsRow?this.listenTo(this.model.searchResultsRow,"change destroy error",this.updateData):this.model.searchResultsColumn&&this.listenTo(this.model.searchResultsColumn,"change destroy error",this.updateData);this.model.state&&this.listenTo(this.model.state,"change",this._state_change)},getCenter:function(){return this._map.get("center").normalize()},getZoom:function(){return this._map.get("zoom")},getLatLonBounds:function(){return this._map.getLatLonBounds().normalize()},getPostProcessSearch:function(){var bounds=this._map.getLatLonBounds().normalize();return"geofilter south="+bounds.s+" west="+bounds.w+" north="+bounds.n+" east="+bounds.e+" maxclusters="+this._maxClusters},getMaxClusters:function(){return this._maxClusters},updateData:function(){var extractedData=null;this.model.searchResultsRow?extractedData=this._extractRowData(this.model.searchResultsRow):this.model.searchResultsColumn&&(extractedData=this._extractColumnData(this.model.searchResultsColumn));console.debug("Updating map data to",extractedData);this._markerLayer.set("data",extractedData?extractedData.data:null);this._markerLayer.set("fields",extractedData?this._filterFields(extractedData.fields):null)},updateProperties:function(){var p,curValues=this._propertyValues,newValues={};for(p in curValues)curValues.hasOwnProperty(p)&&(newValues[p]=null);var defaultValues=_DEFAULT_PROPERTY_VALUES;for(p in defaultValues)defaultValues.hasOwnProperty(p)&&(newValues[p]=defaultValues[p]);var stateValue,stateValues=this.model.state?this.model.state.toJSON():{};for(p in stateValues)if(stateValues.hasOwnProperty(p)&&_R_PROPERTY_PREFIX.test(p)){stateValue=stateValues[p];null!=stateValue&&""!==stateValue&&(newValues[p.replace(_R_PROPERTY_PREFIX,"")]=stateValue)}newValues.hasOwnProperty("map.zoom")&&this._setMapProperty("map.zoom",newValues["map.zoom"]);newValues.hasOwnProperty("map.center")&&this._setMapProperty("map.center",newValues["map.center"]);newValues.hasOwnProperty("map.fitBounds")&&this._setMapProperty("map.fitBounds",newValues["map.fitBounds"]);for(p in newValues)newValues.hasOwnProperty(p)&&this._setMapProperty(p,newValues[p])},render:function(){return this},remove:function(){$(document).unbind("PrintStart",this._document_PrintStart);$(document).unbind("PrintEnd",this._document_PrintEnd);this._map.removeEventListener("boundsChanged",this._map_boundsChanged);this._map.removeEventListener("mapClicked",this._map_mapClicked);this._map.dispose();this._externalLegend.close();return Base.prototype.remove.apply(this,arguments)},onShow:function(){this._map.updateSize();this._map.validate();Base.prototype.onShow.call(this)},_updateDataBounds:function(){var model=this.model.state;if(model){var bounds=this._map.getLatLonBounds().normalize();model.set({"display.visualizations.mapping.data.bounds":this._latLonBoundsParser.valueToString(bounds)})}},_needsPropertyUpdate:function(changedProperties){if(!changedProperties)return!1;for(var p in changedProperties)if(changedProperties.hasOwnProperty(p)&&"display.visualizations.mapping.data.bounds"!==p)return!0;return!1},_extractRowData:function(model){var extractedData={},fields=model.get("fields"),rows=model.get("rows");if(fields&&rows){var numEntries,row,obj,i,j,numFields=fields.length,numRows=rows.length;extractedData.fields=fields.concat();extractedData.data=[];for(i=0;numRows>i;i++){row=rows[i];numEntries=Math.min(row.length,numFields);obj={};for(j=0;numEntries>j;j++)obj[fields[j]]=row[j];extractedData.data.push(obj)}}return extractedData},_extractColumnData:function(model){var extractedData={},fields=model.get("fields"),columns=model.get("columns");if(fields&&columns){var obj,i,j,numColumns=Math.min(fields.length,columns.length),numRows=numColumns>0?columns[0].length:0;for(i=1;numColumns>i;i++)numRows=Math.min(numRows,columns[i].length);extractedData.fields=fields.slice(0,numColumns);extractedData.data=[];for(i=0;numRows>i;i++){obj={};for(j=0;numColumns>j;j++)obj[fields[j]]=columns[j][i];extractedData.data.push(obj)}}return extractedData},_filterFields:function(fields){if(!fields)return null;for(var field,filteredFields=[],i=0,l=fields.length;l>i;i++){field=fields[i];field&&"_"!==field.charAt(0)&&filteredFields.push(field)}return filteredFields},_setMapProperty:function(propertyName,propertyValue){propertyValue=null!=propertyValue?String(propertyValue):null;if(this._propertyValues[propertyName]!=propertyValue){null!=propertyValue?this._propertyValues[propertyName]=propertyValue:delete this._propertyValues[propertyName];switch(propertyName){case"fieldColors":this._fieldColorPalette.set("fieldColors",this._numberObjectParser.stringToValue(propertyValue));break;case"seriesColors":this._seriesColorPalette.set("colors",this._numberArrayParser.stringToValue(propertyValue));break;case"data.maxClusters":var maxClusters=this._numberParser.stringToValue(propertyValue);this._maxClusters=1/0>maxClusters?Math.max(Math.floor(maxClusters),64):100;break;case"map.center":var center=this._latLonParser.stringToValue(propertyValue);center&&this._map.set("center",center);break;case"map.zoom":var zoom=this._numberParser.stringToValue(propertyValue);isNaN(zoom)||this._map.set("zoom",zoom);break;case"map.fitBounds":var fitBounds=this._latLonBoundsParser.stringToValue(propertyValue);fitBounds&&this._map.fitBounds(fitBounds);break;case"tileLayer.url":this._map.set("tileURL",this._resolveURL(propertyValue));break;case"tileLayer.subdomains":this._map.set("tileSubdomains",this._stringArrayParser.stringToValue(propertyValue));break;case"tileLayer.minZoom":this._map.set("tileMinZoom",this._numberParser.stringToValue(propertyValue));break;case"tileLayer.maxZoom":this._map.set("tileMaxZoom",this._numberParser.stringToValue(propertyValue));break;case"tileLayer.invertY":this._map.set("tileInvertY",this._booleanParser.stringToValue(propertyValue));break;case"tileLayer.attribution":this._map.set("tileAttribution",this._stringParser.stringToValue(propertyValue));break;case"markerLayer.markerOpacity":this._markerLayer.set("markerOpacity",this._numberParser.stringToValue(propertyValue));break;case"markerLayer.markerMinSize":this._markerLayer.set("markerMinSize",this._numberParser.stringToValue(propertyValue));break;case"markerLayer.markerMaxSize":this._markerLayer.set("markerMaxSize",this._numberParser.stringToValue(propertyValue))}}},_resolveURL:function(propertyValue){var propertyValue2=propertyValue?SplunkUtil.trim(propertyValue):propertyValue;if(propertyValue2&&"/"===propertyValue2.charAt(0)){var hadTrailingSlash="/"===propertyValue2.charAt(propertyValue2.length-1);propertyValue2=SplunkUtil.make_url(propertyValue2);var hasTrailingSlash="/"===propertyValue2.charAt(propertyValue2.length-1);hasTrailingSlash!=hadTrailingSlash&&(propertyValue2=hadTrailingSlash?propertyValue2+"/":propertyValue2.substring(0,propertyValue2.length-1));propertyValue=propertyValue2}return propertyValue},_formatNumber:function(num){var pos=Math.abs(num);return pos>0&&(.001>pos||pos>=1e9)?SplunkI18N.format_scientific(num,"##0E0"):SplunkI18N.format_decimal(num)},_formatDegrees:function(degrees,orientation){var deg=Math.abs(degrees),degInt=Math.floor(deg),degStr=""+degInt,min=60*(deg-degInt),minInt=Math.floor(min),minStr=10>minInt?"0"+minInt:""+minInt,sec=60*(min-minInt),secInt=Math.floor(sec),secStr=10>secInt?"0"+secInt:""+secInt,dirStr="";degrees>0?dirStr=_("ns"===orientation?"N":"E"):0>degrees&&(dirStr=_("ns"===orientation?"S":"W"));return secInt>0?sprintf("%(degrees)s°%(minutes)s'%(seconds)s\"%(direction)s",{degrees:degStr,minutes:minStr,seconds:secStr,direction:dirStr}):minInt>0?sprintf("%(degrees)s°%(minutes)s'%(direction)s",{degrees:degStr,minutes:minStr,direction:dirStr}):sprintf("%(degrees)s°%(direction)s",{degrees:degStr,direction:dirStr})},_state_change:function(){if("mapping"===this.model.state.get("display.visualizations.type")){var changedProperties=this.model.state.filterChangedByWildcards(_R_PROPERTY_PREFIX,{allowEmpty:!0});this._needsPropertyUpdate(changedProperties)&&this.updateProperties()}},_map_boundsChanged:function(){if(!this._isPrinting){this._updateDataBounds();this.trigger("boundsChanged",{})}},_map_mapClicked:function(e){this._isPrinting||this.trigger("mapClicked",{data:e.data,fields:e.fields,altKey:e.altKey,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey})},_document_PrintStart:function(){if(!this._isPrinting){this._isPrinting=!0;this._prePrintCenter=this._map.get("center");this._prePrintZoom=this._map.get("zoom");this._map.updateSize();var dataBounds=this._markerLayer.getLatLonBounds(this._prePrintCenter);dataBounds&&this._map.fitBounds(dataBounds);ValidateQueue.validateAll()}},_document_PrintEnd:function(){if(this._isPrinting){this._map.set("center",this._prePrintCenter);this._map.set("zoom",this._prePrintZoom);this._prePrintCenter=null;this._prePrintZoom=0;this._isPrinting=!1}}},{DEFAULT_PROPERTY_VALUES:_DEFAULT_PROPERTY_VALUES})});define("splunkjs/mvc/splunkmapview",["require","exports","module","jquery","underscore","./mvc","./basesplunkview","./messages","views/shared/Map","backbone","./utils","uri/route","util/console","jquery.ui.resizable","splunk.util","./tokenawaremodel","./drilldown","splunk.config"],function(require,exports,module){var $=require("jquery"),_=require("underscore"),BaseSplunkView=(require("./mvc"),require("./basesplunkview")),Messages=require("./messages"),Map=require("views/shared/Map"),Backbone=require("backbone"),utils=require("./utils"),console=(require("uri/route"),require("util/console")),TokenAwareModel=(require("jquery.ui.resizable"),require("splunk.util"),require("./tokenawaremodel")),Drilldown=require("./drilldown"),splunkConfig=require("splunk.config"),TileSources={openStreetMap:{url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",maxZoom:18}},SplunkMapView=BaseSplunkView.extend({moduleId:module.id,className:"splunk-map",options:{data:"preview",height:"400px",tileSource:void 0,drilldown:"all",drilldownRedirect:!0,resizable:!1},omitFromSettings:["el","reportModel"],normalizeOptions:function(settings,options){settings.set("drilldown",Drilldown.getNormalizedDrilldownType(options.drilldown,{allowBoolean:!0}))},initialize:function(options){this.configure();this.model=this.options.reportModel||TokenAwareModel._createReportModel();this.settings._sync=utils.syncModels(this.settings,this.model,{auto:!0,prefix:"display.visualizations.",alias:{tileUrl:"display.visualizations.mapping.tileLayer.url",maxZoom:"display.visualizations.mapping.tileLayer.maxZoom",drilldown:"display.visualizations.mapping.drilldown"},exclude:["managerid","data","tileSource","type","drilldownRedirect"]});this.normalizeOptions(this.settings,options);this.listenTo(this.settings,"change:maxZoom",function(model,value){this.settings.set({"mapping.tileLayer.maxZoom":value},{silent:!0})});this.listenTo(this.settings,"change:tileUrl",function(model,value){this.settings.set({"mapping.tileLayer.url":value},{silent:!0})});this.listenTo(this.settings,"change:drilldown",function(model,value){this.settings.set({"mapping.drilldown":value},{silent:!0})});splunkConfig.INDEPENDENT_MODE&&(this.settings.has("tileSource")||this.settings.set("tileSource","openStreetMap"));this.results=new Backbone.Model({columns:[],fields:[]});this._currentHeight=parseInt(this.settings.get("height"),10);this.$map=$("<div></div>");this.$msg=$("<div></div>");this.createMap=_.debounce(_.bind(this.createMap,this),0);this.createMap();this.settings.on("change:tileSource",this._updateTileSource,this);this._updateTileSource();this.bindToComponentSetting("managerid",this._onManagerChange,this)},_updateTileSource:function(){if(this.settings.has("tileSource")){var tileSource=TileSources[this.settings.get("tileSource")];tileSource?this.settings.set({tileUrl:tileSource.url,maxZoom:tileSource.maxZoom}):console.warn("Invalid tileSource parameter value=%o",tileSource)}},destroyMap:function(){if(this.map){this.map.off();this.map.remove();this.map=null}},createMap:function(){this.destroyMap();this.map=new Map({el:this.$map.appendTo(this.el),model:{searchResultsColumn:this.results,state:this.model},height:this.settings.get("height")});this._readMapCenterAndZoom();this.map.on("boundsChanged",this._onBoundsChanged,this);this.map.on("mapClicked",this.emitDrilldownEvent,this);this._onBoundsChanged();this._onResizeMouseup=_.bind(this._onResizeMouseup,this);this.settings.on("change:resizable",function(model,value){value?this._enableResize():this._disableResize()},this);this.settings.get("resizable")&&this._enableResize()},_enableResize:function(){if(this._canEnableResize()){this.map.$el.resizable({autoHide:!0,handles:"s",stop:this._onResizeStop.bind(this)});this.map.$el.on("mouseup",this._onResizeMouseup)}},_disableResize:function(){if(this._canEnableResize()){this.map.$el.resizable("destroy");this.map.$el.off("mouseup",this._onResizeMouseup)}},_onResizeMouseup:function(){$(this).width("100%")},_onResizeStop:function(event){$(event.target).width("100%");this._currentHeight=parseInt(this.settings.get("height"),10);this.$msg.height(this._currentHeight).css("overflow","hidden")},_canEnableResize:function(){return!0},_onManagerChange:function(managers,manager){if(this.manager){this.manager.off(null,null,this);this.manager=null}if(this.resultsModel){this.resultsModel.off(null,null,this);this.resultsModel=null}this._clearResults();if(manager){this.manager=manager;this.manager.on("search:start",this._onSearchStart,this);this.manager.on("search:progress",this._onSearchProgress,this);this.manager.on("search:cancelled",this._onSearchCancelled,this);this.manager.on("search:fail",this._onSearchFail,this);this.manager.on("search:error",this._onSearchError,this);this.resultsModel=this.manager.data(this.settings.get("data"),{serialfetch:!0,output_mode:"json_cols",offset:0,count:this.map?this.map.getMaxClusters():100,show_empty_fields:"True",search:this.map?this.map.getPostProcessSearch():""});this.resultsModel.on("data",this._onDataUpdate,this);this.resultsModel.on("error",this._onSearchError,this);this.manager.replayLastSearchEvent(this)}else this.message("no-search")},_onSearchStart:function(){this._clearResults()},_onSearchProgress:function(){},_onSearchCancelled:function(){this.message("cancelled")},_onSearchFail:function(state){var msg=Messages.getSearchFailureMessage(state);this.message({level:"error",icon:"warning-sign",message:msg})},_onSearchError:function(message,err){var msg=Messages.getSearchErrorMessage(err)||message;this.message({level:"error",icon:"warning-sign",message:msg})},_onDataUpdate:function(){if(this.resultsModel.hasData()){this.$msg.detach();this.$map.css("visibility","");this.results.set(this.resultsModel.data())}else this._clearResults();this.render()},_onBoundsChanged:function(){this._readMapCenterAndZoom();this.resultsModel&&this.resultsModel.set("search",this.map.getPostProcessSearch())},_readMapCenterAndZoom:function(){this.model.set({currentMapZoom:this.map.getZoom(),currentMapCenter:this.map.getCenter().clone()})},emitDrilldownEvent:function(e){if("none"!==this.settings.get("drilldown")){e=e||{};var event=_.extend({modifierKey:e.ctrlKey,ctrlKey:e.ctrlKey,fields:e.fields},e),data=event.data={};_(e.fields).each(function(key){var value=e.data[key];data["row."+key]=value;if("latitude"!==key&&"longitude"!=key&&!data.hasOwnProperty("click.name")){data["click.name"]=key;data["click.value"]=value;data["click.name2"]=key;data["click.value2"]=value}});_(["south","west","north","east"]).each(function(orientation){data["click.bounds."+orientation]=e.data["_geo_bounds_"+orientation]});data["click.lat.name"]=e.data["_geo_lat_field"];data["click.lon.name"]=e.data["_geo_long_field"];data["click.lat.value"]=e.data["latitude"];data["click.lon.value"]=e.data["longitude"];event.field=data["click.name"]||null;_.extend(data,Drilldown.getNormalizedTimerange(this.manager));var payload=Drilldown.createEventPayload(event,_.bind(this._doDrilldown,this,e,this.manager));this.trigger("drilldown click click:marker",payload,this);var drilldownType=Drilldown.getNormalizedDrilldownType(this.settings.get("drilldown"),{allowBoolean:!0});this.settings.get("drilldownRedirect")&&"all"===drilldownType&&!payload.defaultPrevented()&&payload.drilldown()}},_doDrilldown:function(event,manager){if(event&&manager){var DRILLDOWN_PROPERTIES={_geo_lat_field:"_geo_lat_field",_geo_lon_field:"_geo_long_field",_geo_bounds_south:"_geo_bounds_south",_geo_bounds_west:"_geo_bounds_west",_geo_bounds_north:"_geo_bounds_north",_geo_bounds_east:"_geo_bounds_east"};if(event.data)if(_.all(DRILLDOWN_PROPERTIES,function(srcKey){return!!event.data[srcKey]})){var params=_(DRILLDOWN_PROPERTIES).chain().map(function(srcKey,prop){return[prop,event.data[srcKey]]}).object().value();event.modifierKey=event.ctrlKey;Drilldown.autoDrilldown(event,manager,{drilldownType:"geoviz",negate:event.altKey,sync:event.modifierKey,params:params})}else{var latLonFields=event.fields.slice(0,2),values=_(latLonFields).map(function(f){return event.data[f]});Drilldown.autoDrilldown({name:latLonFields,value:values},manager,{sync:event.modifierKey,negate:event.altKey})}}},_clearResults:function(){this.results.set({columns:[],fields:[]})},message:function(info){this.$map.css("visibility","hidden");this.$msg.detach();Messages.render(info,this.$msg);this.$msg.prependTo(this.$el)},render:function(){this.$el.css({overflow:"hidden",position:"relative"});this.$msg.height(this._currentHeight).css({overflow:"hidden",position:"absolute",width:"100%"});return this},remove:function(){this.destroyMap();if(this.settings){this.settings.off();this.settings._sync&&this.settings._sync.destroy()}BaseSplunkView.prototype.remove.call(this)}});return SplunkMapView});define("splunkjs/mvc/simplexml/element/map",["require","underscore","jquery","backbone","../../../mvc","./base","../../splunkmapview","../mapper","util/console","../../drilldown"],function(require){var _=require("underscore"),DashboardElement=(require("jquery"),require("backbone"),require("../../../mvc"),require("./base")),SplunkMapView=require("../../splunkmapview"),Mapper=require("../mapper"),Drilldown=(require("util/console"),require("../../drilldown")),mappingPrefix="display.visualizations.mapping.",vizPrefix="display.visualizations.";Mapper.register("visualizations:mapping",Mapper.extend({tagName:"map",map:function(report,result,options){_(report.toJSON()).each(function(value,key){0===key.indexOf(mappingPrefix)&&(result.options[key.substring(vizPrefix.length)]=report.get(key,options))});(options||{}).pdf||delete result.options["mapping.data.bounds"];result.options.drilldown=Drilldown.getNormalizedDrilldownType(result.options["mapping.drilldown"],{allowBoolean:!0});delete result.options["mapping.drilldown"]}}));var MapViz=SplunkMapView.extend({panelClassName:"map",options:_.defaults({drilldown:!0,resizable:!0},SplunkMapView.prototype.options),reportDefaults:{"display.visualizations.show":!0,"display.visualizations.type":"mapping","display.general.type":"visualizations"},getResultsLinkOptions:function(){return{}}});DashboardElement.registerVisualization("visualizations:mapping",MapViz);var MapElement=DashboardElement.extend({initialVisualization:"visualizations:mapping"});return MapElement});define("splunkjs/mvc/simplexml/element/list",["require","underscore","jquery","backbone","../../../mvc","./base","util/console"],function(require){var _=require("underscore"),DashboardElement=(require("jquery"),require("backbone"),require("../../../mvc"),require("./base")),console=require("util/console"),ListElement=DashboardElement.extend({initialVisualization:"statistics",constructor:function(options){_.extend(options,{displayRowNumbers:!1,fields:[options.labelField||"",options.valueField||""],sortKey:options.initialSort||options.labelField,sortDirection:options.initialSortDir||"asc"});console.log("[%o] Creating table with options: %o",options.id,options);return DashboardElement.prototype.constructor.call(this,options)}});return ListElement});define("splunkjs/mvc/simplexml/element/html",["require","underscore","jquery","backbone","../../../mvc","../../utils","./base","../controller","../../tokenutils","splunk.util"],function(require){var _=require("underscore"),$=require("jquery"),Backbone=require("backbone"),DashboardElement=(require("../../../mvc"),require("../../utils"),require("./base")),Dashboard=require("../controller"),TokenUtils=require("../../tokenutils"),SplunkUtil=require("splunk.util"),HtmlElement=DashboardElement.extend({configure:function(){this.options.settingsOptions=_.extend({tokenEscaper:TokenUtils.getEscaper("html")},this.options.settingsOptions||{});DashboardElement.prototype.configure.apply(this,arguments)},initialize:function(){this.configure();this.model=new Backbone.Model;this.reportReady=$.Deferred();this.reportReady.resolve(this.model);this.model.mapToXML=_.bind(this.mapToXML,this);this.settings.on("change",this.render,this);this.listenTo(Dashboard.getStateModel(),"change:edit",this.onEditModeChange,this);this._setupTokenDependencies()},mapToXML:function(report,result,options){return{type:"html",content:this.settings.get("html",options),cdata:!0,attributes:{encoded:"1"}}},updateTitle:function(){this.$(".panel-head").remove();Dashboard.isEditMode()&&$('<div class="panel-head"><h3><span class="untitled">HTML Panel</span></h3></div>').prependTo(this.$el)},createPanelElementEditor:function(){},createRefreshTimeIndicator:function(){},render:function(){this.$("script").remove();this.settings.has("html")||this.settings.set("html",$.trim(this.$(".panel-body").html()),{tokens:!0});this.$(".panel-body").html(this.settings.get("html"));this.$("a").each(function(){var el=$(this),href=el.attr("href");href&&"/"===href[0]&&"/"!==href[1]&&el.attr("href",SplunkUtil.make_url(href))});this.onEditModeChange(Dashboard.getStateModel());return this},getExportParams:function(){return{}}});return HtmlElement});define("splunkjs/mvc/simplexml/urltokenmodel",["require","exports","module","../basetokenmodel","./dashboardurl","./controller","util/general_utils"],function(require,exports,module){var BaseTokenModel=require("../basetokenmodel"),dashboardUrl=require("./dashboardurl"),DashboardController=require("./controller"),general_utils=require("util/general_utils"),UrlTokenModel=BaseTokenModel.extend({moduleId:module.id,initialize:function(){dashboardUrl.on("change",function(){this.setFromClassicUrl()},this);this.setFromClassicUrl();DashboardController.router.on("route",function(){this.trigger("url:navigate")},this)},save:function(attributes,options){this.set(attributes);this.saveClassicUrl(options)},saveOnlyWithPrefix:function(prefix,attributes,options){var filter=["^"+prefix+".*","^earliest$","^latest$"];this.save(general_utils.filterObjectByRegexes(attributes,filter,{allowEmpty:!0,allowObject:!0}),options)},saveClassicUrl:function(options){dashboardUrl.save(this.toJSON(),options)},setFromClassicUrl:function(){this.set(dashboardUrl.toJSON())}});return UrlTokenModel});define("contrib/text!views/shared/footer/AboutDialog.html",[],function(){return"<dl class=\"list-dotted\">\n    <dt><%= _('Splunk Version').t() %></dt>\n    <dd><%- version %></dd>\n    <dt><%= _('Splunk Build').t() %></dt>\n    <dd><%- build %></dd>\n</dl>\n<dl class=\"list-dotted\">\n    <dt><%= _('Current App').t() %></dt>\n    <dd><%- currentApp %></dd>\n    <% if (appVersion) { %>\n        <dt><%= _('App Version').t() %></dt>\n        <dd><%- appVersion %></dd>\n    <% } %>\n    <% if (appBuild) { %>\n        <dt><%= _('App Build').t() %></dt>\n        <dd><%- appBuild %></dd>\n    <% } %>\n</dl>\n<% if (listOfProducts) { %>\n<dl class=\"list-dotted\">\n    <dt><%= _('List of Products: ').t() %></dt>\n    <dd><%- listOfProducts %></dd>\n</dl>\n<% } %>\n<dl class=\"list-dotted\">\n    <dt><%= _('Server Name').t() %></dt>\n    <dd><%- serverName %></dd>\n</dl>\n"});define("views/shared/footer/AboutDialog",["underscore","module","views/Base","views/shared/Modal","contrib/text!views/shared/footer/AboutDialog.html"],function(_,module,Base,Modal,Template){return Modal.extend({moduleId:module.id,template:Template,initialize:function(){Modal.prototype.initialize.apply(this,arguments);var currentApp,that=this,currentAppName=that.model.applicationModel.get("app");this.logoFlavors={hunk:"&#xF000;",enterprise:"&#xF001;",cloud:"&#xF002;"};if("launcher"===currentAppName)that.currentAppLabel=_("Home").t();else{currentApp=that.collection.find(function(app){return app.entry.get("name")===currentAppName});that.currentAppLabel=currentApp?currentApp.entry.content.get("label"):_("N/A").t()}this.model.serverInfo.on("change reset",function(){this.render()},this)},getListOfProducts:function(){var result,addOns=this.model.serverInfo.entry.content.get("addOns");
addOns&&!$.isEmptyObject(addOns)&&(result=_(addOns).keys().join(", "));return result},getLogoFlavorIcon:function(){var branding=this.model.serverInfo.getBranding(),icon="";this.logoFlavors.hasOwnProperty(branding)&&(icon=this.logoFlavors[branding]);return icon},render:function(){this.$el.html(Modal.TEMPLATE);this.$(Modal.HEADER_TITLE_SELECTOR).html('splunk<span class="prompt">&gt;&#x00AE;'+this.getLogoFlavorIcon()+"</span>");var template=this.compiledTemplate({serverName:this.model.serverInfo.entry.content.get("serverName")||_("N/A").t(),version:this.model.serverInfo.entry.content.get("version")||_("N/A").t(),build:this.model.serverInfo.entry.content.get("build")||_("N/A").t(),appVersion:this.model.appLocal.entry.content.get("version")||null,appBuild:this.model.appLocal.entry.content.get("build")||null,listOfProducts:this.getListOfProducts(),currentApp:this.currentAppLabel});this.$(Modal.BODY_SELECTOR).html(template);return this}})});define("contrib/text!views/shared/footer/Master.html",[],function(){return'<ul class="nav nav-footer">\n    <li><a href="#" id="about"><%= _(\'About\').t() %></a></li>\n\n    <li><a href="http://www.splunk.com/r/support" target="_blank"><%= _(\'Support\').t() %></a></li>\n    <li><a href="http://www.splunk.com/r/bugs" target="_blank"><%= _(\'File a Bug\').t() %></a></li>\n    <li><a href="<%- makeDocLink(currentPageDocLocation) %>" target="_blank"><%- _("Documentation").t() %></a></li>\n    <li><a href="http://www.splunk.com/r/privacy" target="_blank"><%= _(\'Privacy Policy\').t() %></a></li>\n</ul>\n<p class="copyright">&copy; 2005-<%=new Date().getFullYear()%> <%= _(\'Splunk Inc. All rights reserved.\').t() %></p>\n'});define("views/shared/footer/Master",["jquery","module","views/Base","./AboutDialog","models/services/server/ServerInfo","models/shared/Application","models/services/AppLocal","collections/services/AppLocals","contrib/text!views/shared/footer/Master.html","uri/route","util/splunkd_utils"],function($,module,BaseView,AboutDialogView,ServerInfoModel,ApplicationModel,AppLocalModel,AppsCollection,footerTemplate,route,splunkDUtils){var View=BaseView.extend({moduleId:module.id,className:"splunkified",template:footerTemplate,initialize:function(){BaseView.prototype.initialize.apply(this,arguments);var applicationModelDeferred=$.Deferred(),appLocalModelDeferred=$.Deferred();this.options.model.application.get("app")?applicationModelDeferred.resolve():this.options.model.application.on("change reset",applicationModelDeferred.resolve);this.options.model.appLocal.entry.content.get("version")?appLocalModelDeferred.resolve():this.options.model.appLocal.on("change reset",appLocalModelDeferred.resolve);$.when(applicationModelDeferred,appLocalModelDeferred).done(this.render.bind(this))},events:{"click a[id=about]":function(e){this.children.aboutDialog=new AboutDialogView({collection:this.options.collection.apps,model:{applicationModel:this.options.model.application,appLocal:this.options.model.appLocal,serverInfo:this.options.model.serverInfo},onHiddenRemove:!0});this.modalWrapper=$('<div class="splunk-components">').appendTo("body").append(this.children.aboutDialog.render().el);this.children.aboutDialog.once("hidden",function(){this.modalWrapper.remove();$(e.currentTarget).focus()},this);this.children.aboutDialog.show();e.preventDefault()}},makeDocLink:function(location){return route.docHelpInAppContext(this.model.application.get("root"),this.model.application.get("locale"),location,this.model.application.get("app"),this.model.appLocal.entry.content.get("version"),this.model.appLocal.appAllowsDisable(),this.model.appLocal.entry.content.get("docs_section_override"))},render:function(){var currentPageDocLocation=["app",this.model.application.get("app"),this.model.application.get("page")].join("."),html=this.compiledTemplate({makeDocLink:this.makeDocLink.bind(this),currentPageDocLocation:currentPageDocLocation});this.$el.html(html);return this}},{create:function(options){options=options||{};options.model=options.model||{};options.collection=options.collection||{};if(!options.model.serverInfo){options.model.serverInfo=new ServerInfoModel;options.model.serverInfo.fetch()}var applicationDfd=$.Deferred();options.model.application||(options.model.application=new ApplicationModel);options.model.application.get("app")?applicationDfd.resolve():options.model.application.on("change",applicationDfd.resolve);if(!options.model.appLocal){options.model.appLocal=new AppLocalModel;applicationDfd.done(function(){"system"!==options.model.application.get("app")&&options.model.appLocal.fetch({url:splunkDUtils.fullpath(options.model.appLocal.url+"/"+encodeURIComponent(options.model.application.get("app"))),data:{app:options.model.application.get("app"),owner:options.model.application.get("owner")}})})}if(!options.collection.apps){options.collection.apps=new AppsCollection;options.collection.apps.fetch({data:{sort_key:"name",sort_dir:"desc",app:"-",owner:options.model.application.get("owner"),search:"visible=true AND disabled=0 AND name!=launcher",count:-1}})}return new View(options)}});return View});define("splunkjs/mvc/footerview",["require","exports","module","jquery","underscore","./mvc","./basesplunkview","views/shared/footer/Master","./sharedmodels"],function(require,exports,module){var $=require("jquery"),_=require("underscore"),BaseSplunkView=(require("./mvc"),require("./basesplunkview")),Footer=require("views/shared/footer/Master"),sharedModels=require("./sharedmodels"),FooterView=BaseSplunkView.extend({moduleId:module.id,className:"splunk-footer",initialize:function(){var appModel=sharedModels.get("app"),appLocalModel=sharedModels.get("appLocal"),serverInfoModel=sharedModels.get("serverInfo"),appLocals=sharedModels.get("appLocals");this.dfd=$.when.apply($,[appModel.dfd,appLocalModel.dfd,serverInfoModel.dfd,appLocals.dfd]);this.dfd.done(_.bind(function(){this.footer=Footer.create({model:{application:appModel,appLocal:appLocalModel,serverInfo:serverInfoModel},collection:{apps:appLocals}})},this))},render:function(){this.dfd.done(_.bind(function(){this.$el.append(this.footer.render().el)},this));return this}});return FooterView});define("splunkjs/mvc/textinputview",["require","exports","module","underscore","jquery","./baseinputview"],function(require,exports,module){var _=require("underscore"),$=require("jquery"),BaseInputView=require("./baseinputview"),TextInputView=BaseInputView.extend({moduleId:module.id,className:"splunk-textinput",options:{"default":void 0,type:"text",seed:void 0,value:void 0,disabled:!1},events:{"change input":"_onDomValueChange"},initialize:function(){this.options=_.extend({},BaseInputView.prototype.options,this.options);BaseInputView.prototype.initialize.apply(this,arguments);this.settings.on("change:value",this._onValueChange,this);this.settings.on("change",this.render,this);this.settings.on("change:type",this._onTypeChange,this);var that=this;this.on("change",function(){that.settings.set("value",that.val())});_.contains(["text","password"],this.settings.get("type"))||this.settings.set("type","text");this._inputId=this.id+"-input"},_onDomValueChange:function(){var input=$("input",this.$el);this.val(input.val())},_onValueChange:function(){var input=$("input",this.$el);input.val(this.settings.get("value"));this._onChange()},_onTypeChange:function(){this.clearView();this.render()},getInputId:function(){return this._inputId},createView:function(){var viz=$(_.template("<input type='<%= type %>' id='<%= id %>' value='<%- value %>'/>",{type:this.settings.get("type"),id:this._inputId,value:this.settings.get("value")}));this.$el.html(viz);return viz},updateView:function(){return this},val:function(value){var input=$("input",this.$el);if(0===arguments.length)return this.settings.get("value");if(value!==this.settings.get("value")){input.val(value||"");this.settings.set("value",value)}return this.val()},_hasValueForDashboards:function(){var value=this.settings.get("value"),defaultValue=this.settings.get("default"),valueIsDefined=void 0!==value&&null!==value&&""!==value;return valueIsDefined||void 0===defaultValue||value===defaultValue}});return TextInputView});define("splunkjs/mvc/simpleform/input/text",["require","./base","../../textinputview","../formutils"],function(require){var BaseInput=require("./base"),TextInputView=require("../../textinputview"),FormUtils=require("../formutils");FormUtils.registerInputType("text",TextInputView,{blankIsUndefined:!0});var TextInput=BaseInput.extend({initialVisualization:"text"});return TextInput});define("splunkjs/mvc/simpleform/input/dropdown",["require","./base","../../dropdownview","../formutils"],function(require){var BaseInput=require("./base"),SelectView=require("../../dropdownview"),FormUtils=require("../formutils");FormUtils.registerInputType("dropdown",SelectView,{choices:!0,multiValue:!1});var DropdownInput=BaseInput.extend({initialVisualization:"dropdown"});return DropdownInput});define("splunkjs/mvc/simpleform/input/radiogroup",["require","./base","../../radiogroupview","../formutils"],function(require){var BaseInput=require("./base"),RadioGroupView=require("../../radiogroupview"),FormUtils=require("../formutils");FormUtils.registerInputType("radio",RadioGroupView,{choices:!0,multiValue:!1});var RadioGroupInput=BaseInput.extend({initialVisualization:"radio"});return RadioGroupInput});define("splunkjs/mvc/simpleform/input",["require","./input/submit","./input/text","./input/dropdown","./input/radiogroup","./input/timerange","./input/submit","./input/text","./input/dropdown","./input/radiogroup","./input/timerange"],function(require){return{SubmitButton:require("./input/submit"),TextInput:require("./input/text"),DropdownInput:require("./input/dropdown"),RadioGroupInput:require("./input/radiogroup"),TimeRangeInput:require("./input/timerange"),Submit:require("./input/submit"),Text:require("./input/text"),Dropdown:require("./input/dropdown"),Radio:require("./input/radiogroup"),TimeRangePicker:require("./input/timerange")}});define("splunkjs/mvc/simpleform/input/checkboxgroup",["require","./base","../../checkboxgroupview","../formutils"],function(require){var BaseInput=require("./base"),CheckboxGroupView=require("../../checkboxgroupview"),FormUtils=require("../formutils");FormUtils.registerInputType("checkbox",CheckboxGroupView,{choices:!0,multiValue:!0});var CheckboxGroupInput=BaseInput.extend({initialVisualization:"checkbox"});return CheckboxGroupInput});define("splunkjs/mvc/simpleform/input/multiselect",["require","./base","../../multiselectview","../formutils"],function(require){var BaseInput=require("./base"),MultiSelectView=require("../../multiselectview"),FormUtils=require("../formutils");FormUtils.registerInputType("multiselect",MultiSelectView,{choices:!0,multiValue:!0});var MultiSelectInput=BaseInput.extend({initialVisualization:"multiselect"});return MultiSelectInput});define("splunkjs/mvc/simplexml",["require","./simplexml/controller","./simplexml/dashboardview","./simplexml/dashboard","./simplexml/element/table","./simplexml/element/chart","./simplexml/element/event","./simplexml/element/single","./simplexml/element/map","./simplexml/element/list","./simplexml/element/html","./simplexml/urltokenmodel","./searchmanager","./savedsearchmanager","./postprocessmanager","./drilldown","./headerview","./footerview","./simpleform/formutils","./simpleform/input","./simpleform/input/submit","./simpleform/input/text","./simpleform/input/dropdown","./simpleform/input/radiogroup","./simpleform/input/timerange","./simpleform/input/checkboxgroup","./simpleform/input/multiselect","./utils"],function(require){var Controller=require("./simplexml/controller");require("./simplexml/dashboardview");require("./simplexml/dashboard");require("./simplexml/element/table");require("./simplexml/element/chart");require("./simplexml/element/event");require("./simplexml/element/single");require("./simplexml/element/map");require("./simplexml/element/list");require("./simplexml/element/html");require("./simplexml/urltokenmodel");require("./searchmanager");require("./savedsearchmanager");require("./postprocessmanager");require("./drilldown");require("./headerview");require("./footerview");require("./simpleform/formutils");require("./simpleform/input");require("./simpleform/input/submit");require("./simpleform/input/text");require("./simpleform/input/dropdown");require("./simpleform/input/radiogroup");require("./simpleform/input/timerange");require("./simpleform/input/checkboxgroup");require("./simpleform/input/multiselect");require("./utils");return Controller});requirejs.s.contexts._.nextTick=function(f){f()};require(["css"],function(css){css.setBuffer(".splunk-message-container {\n    padding: 54px 40px 90px 40px;\n}\n\n.splunk-message-container.compact {\n    padding: 0px 40px 10px 40px;\n    text-align: center;\n}.clearfix{*zoom:1;}.clearfix:before,.clearfix:after{display:table;content:\"\";line-height:0;}\n.clearfix:after{clear:both;}\n.hide-text{font:0/0 a;color:transparent;text-shadow:none;background-color:transparent;border:0;}\n.input-block-level{display:block;width:100%;min-height:26px;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;}\n.ie7-force-layout{*min-width:0;}\n.shared-timerangepicker-dialog{width:640px;}.shared-timerangepicker-dialog td{vertical-align:top;}\n.timeRangeMenu,.trpCustomDateTime{display:none;}\n.shared-timerangepicker-dialog-advanced .control-group{width:50%;float:left;}\n.help-block-timestamp{min-height:1em;line-height:1em;padding:3px;margin-top:5px;margin-right:15px;border-radius:3px;background-color:#eeeeee;}\n.timerangepicker-range-type{margin-right:25px;float:left;}\n.timerangepicker-range-type .btn{min-width:65px;}\n.btn.timerange-control>.icon-triangle-right-small{padding-left:5px;}\ninput.timerangepicker-earliest-date{margin-right:0;}\ninput.timerangepicker-real-time-earliest-time,input.timerangepicker-relative-earliest-time{margin-right:0;}\n.timerangepicker-realtime_range_type,.timerangepicker-relative_range_type{display:inline-block;vertical-align:middle;margin-right:25px;}\n.shared-timerangepicker-dialog-daterange-betweendates>tr:first-child>td{padding-bottom:0;}.shared-timerangepicker-dialog-daterange-betweendates>tr:first-child>td>.alerts{margin-top:0;}\n.form-inline .radio{line-height:18px;padding-top:5px;padding-bottom:5px;display:block;}\n.form-inline .radio+.radio{padding-top:0;}\ninput.date-before-time{margin-right:5px;}\n.advanced-time-documentation{clear:left;margin:10px 0 0 55px;display:block;float:left;}\n.presets-group{float:left;width:130px;}\n.presets-group+.presets-group{margin-left:10px;}\n.presets-divider-wrap{float:left;margin:10px;}\n.presets-divider{position:absolute;top:10px;bottom:10px;border-right:1px dotted #cccccc;}\n.presets-group li{color:#999999;padding-left:20px;text-indent:-20px;overflow:hidden;text-overflow:ellipsis;}\n.vis-area{*zoom:1;}.vis-area:before,.vis-area:after{display:table;content:\"\";line-height:0;}\n.vis-area:after{clear:both;}\n.slide-area{width:1090px;}\n.content-wrapper{width:450px;float:left;}\n.modal .timerange-picker-wrapper{float:left;}.modal .timerange-picker-wrapper .shared-timerangepicker-dialog{width:640px;}\n.modal .timerange-picker-wrapper .accordion .accordion-heading .accordion-toggle{border-left:none;border-right:none;}\n.modal .timerange-picker-wrapper .accordion .accordion-body{border:none;}\n.modal .timerange-picker-wrapper .accordion .accordion-group.active:last-child .accordion-body{border:none;}\n.modal .timerange-picker-wrapper .accordion .accordion-group:last-child .accordion-toggle{border-bottom:none;border-radius:0px;}\n.modal .timerange-picker-wrapper .accordion .accordion-group:first-child .accordion-toggle{border-top:none;border-radius:0px;}\n.shared-timerangepicker .btn{max-width:99%;}.shared-timerangepicker .btn .time-label{display:inline-block;display:inline\\9;vertical-align:middle;max-width:99%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}\n.relative-time-container .control-label,.real-time-container .control-label{width:50px;overflow:hidden;text-overflow:ellipsis;}\n.relative-time-container .controls,.real-time-container .controls{margin-left:60px;}\n.relative-time-container input,.real-time-container input,.relative-time-container .uneditable-input,.real-time-container .uneditable-input{width:4em;}\n.relative-time-container input[type=\"file\"],.real-time-container input[type=\"file\"],.relative-time-container input[type=\"image\"],.real-time-container input[type=\"image\"],.relative-time-container input[type=\"submit\"],.real-time-container input[type=\"submit\"],.relative-time-container input[type=\"reset\"],.real-time-container input[type=\"reset\"],.relative-time-container input[type=\"button\"],.real-time-container input[type=\"button\"],.relative-time-container input[type=\"radio\"],.real-time-container input[type=\"radio\"],.relative-time-container input[type=\"checkbox\"],.real-time-container input[type=\"checkbox\"]{width:auto;}\n.relative-time-container .col-1,.real-time-container .col-1,.relative-time-container .col-2,.real-time-container .col-2{width:250px;}\n.relative-time-container .col-3,.real-time-container .col-3{width:98px;}\n.relative-time-container .col-1,.real-time-container .col-1,.relative-time-container .col-2,.real-time-container .col-2,.relative-time-container .col-3,.real-time-container .col-3{float:left;}\n.relative-time-container .input-append .btn,.real-time-container .input-append .btn{max-width:8em;overflow:hidden;text-overflow:ellipsis;}\n.relative-time-container .col-3 .btn,.real-time-container .col-3 .btn{max-width:9em;overflow:hidden;text-overflow:ellipsis;}\n.date-range-container{overflow:hidden;}.date-range-container .shared-controls-datecontrol{display:inline-block;}\n.date-range-container .help-block{display:inline;}\n.time-before-date .col-1,.time-after-date .col-1{float:left;max-width:100px;}\n.time-before-date .help-block,.time-after-date .help-block{display:block;}\n.time-between-dates .col-1,.time-between-dates .col-2,.time-between-dates .col-3{float:left;max-width:100px;}\n.time-between-dates .help-block{display:block;}\n.time-between-dates .control-label{float:left;margin-left:1em;margin-right:1em;}\n.shared-timerangepicker-dialog-dateandtimerange .control-label{float:left;margin-right:0.5em;max-width:4em;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}\n.shared-timerangepicker-dialog-dateandtimerange input{margin-right:0.5em;}\n.btn-documentation{line-height:22px;white-space:nowrap;}\n.time-advanced .control-label{float:left;margin-right:0.25em;max-width:4em;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}\n.accordion-body .time-advanced .controls{float:left;}\n.splunk-choice-input .splunk-choice-input-message {\n    color: gray;\n    font-size: 11px;\n    height: 0;\n    overflow: visible;\n    margin-top: -5px;\n}\n\n.splunk-choice-input {\n    padding-bottom: 20px;\n}\n.splunk-radiogroup input {\n    margin-left: 2px;\n    margin-right: 10px;\n}\n.splunk-radiogroup .choice label {\n    display: inline;\n}\n\n.splunk-radiogroup-choices {\n    margin-bottom: 8px;\n}/*\nVersion: 3.3.1 Timestamp: Wed Feb 20 09:57:22 PST 2013\n*/\n.select2-container {\n    position: relative;\n    display: inline-block;\n    /* inline-block for ie7 */\n    zoom: 1;\n    *display: inline;\n    vertical-align: top;\n}\n\n.select2-container,\n.select2-drop,\n.select2-search,\n.select2-search input{\n  /*\n    Force border-box so that % widths fit the parent\n    container without overlap because of margin/padding.\n\n    More Info : http://www.quirksmode.org/css/box.html\n  */\n  -webkit-box-sizing: border-box; /* webkit */\n   -khtml-box-sizing: border-box; /* konqueror */\n     -moz-box-sizing: border-box; /* firefox */\n      -ms-box-sizing: border-box; /* ie */\n          box-sizing: border-box; /* css3 */\n}\n\n.select2-container .select2-choice {\n    display: block;\n    height: 26px;\n    padding: 0 0 0 8px;\n    overflow: hidden;\n    position: relative;\n\n    border: 1px solid #aaa;\n    white-space: nowrap;\n    line-height: 26px;\n    color: #444;\n    text-decoration: none;\n\n    -webkit-border-radius: 4px;\n       -moz-border-radius: 4px;\n            border-radius: 4px;\n\n    -webkit-background-clip: padding-box;\n       -moz-background-clip: padding;\n            background-clip: padding-box;\n\n    -webkit-touch-callout: none;\n      -webkit-user-select: none;\n       -khtml-user-select: none;\n         -moz-user-select: none;\n          -ms-user-select: none;\n              user-select: none;\n\n    background-color: #fff;\n    background-image: -webkit-gradient(linear, left bottom, left top, color-stop(0, #eeeeee), color-stop(0.5, white));\n    background-image: -webkit-linear-gradient(center bottom, #eeeeee 0%, white 50%);\n    background-image: -moz-linear-gradient(center bottom, #eeeeee 0%, white 50%);\n    background-image: -o-linear-gradient(bottom, #eeeeee 0%, #ffffff 50%);\n    background-image: -ms-linear-gradient(top, #ffffff 0%, #eeeeee 50%);\n    filter: progid:DXImageTransform.Microsoft.gradient(startColorstr = '#ffffff', endColorstr = '#eeeeee', GradientType = 0);\n    background-image: linear-gradient(top, #ffffff 0%, #eeeeee 50%);\n}\n\n.select2-container.select2-drop-above .select2-choice {\n    border-bottom-color: #aaa;\n\n    -webkit-border-radius:0 0 4px 4px;\n       -moz-border-radius:0 0 4px 4px;\n            border-radius:0 0 4px 4px;\n\n    background-image: -webkit-gradient(linear, left bottom, left top, color-stop(0, #eeeeee), color-stop(0.9, white));\n    background-image: -webkit-linear-gradient(center bottom, #eeeeee 0%, white 90%);\n    background-image: -moz-linear-gradient(center bottom, #eeeeee 0%, white 90%);\n    background-image: -o-linear-gradient(bottom, #eeeeee 0%, white 90%);\n    background-image: -ms-linear-gradient(top, #eeeeee 0%,#ffffff 90%);\n    filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#ffffff', endColorstr='#eeeeee',GradientType=0 );\n    background-image: linear-gradient(top, #eeeeee 0%,#ffffff 90%);\n}\n\n.select2-container .select2-choice span {\n    margin-right: 26px;\n    display: block;\n    overflow: hidden;\n\n    white-space: nowrap;\n\n    -ms-text-overflow: ellipsis;\n     -o-text-overflow: ellipsis;\n        text-overflow: ellipsis;\n}\n\n.select2-container .select2-choice abbr {\n    display: block;\n    width: 12px;\n    height: 12px;\n    position: absolute;\n    right: 26px;\n    top: 8px;\n\n    font-size: 1px;\n    text-decoration: none;\n\n    border: 0;\n    background: url('contrib/select2-3.3.1/select2.png') right top no-repeat;\n    cursor: pointer;\n    outline: 0;\n}\n.select2-container .select2-choice abbr:hover {\n    background-position: right -11px;\n    cursor: pointer;\n}\n\n.select2-drop-mask {\n    position: absolute;\n    left: 0;\n    top: 0;\n    z-index: 9998;\n    opacity: 0;\n}\n\n.select2-drop {\n    width: 100%;\n    margin-top:-1px;\n    position: absolute;\n    z-index: 9999;\n    top: 100%;\n\n    background: #fff;\n    color: #000;\n    border: 1px solid #aaa;\n    border-top: 0;\n\n    -webkit-border-radius: 0 0 4px 4px;\n       -moz-border-radius: 0 0 4px 4px;\n            border-radius: 0 0 4px 4px;\n\n    -webkit-box-shadow: 0 4px 5px rgba(0, 0, 0, .15);\n       -moz-box-shadow: 0 4px 5px rgba(0, 0, 0, .15);\n            box-shadow: 0 4px 5px rgba(0, 0, 0, .15);\n}\n\n.select2-drop.select2-drop-above {\n    margin-top: 1px;\n    border-top: 1px solid #aaa;\n    border-bottom: 0;\n\n    -webkit-border-radius: 4px 4px 0 0;\n       -moz-border-radius: 4px 4px 0 0;\n            border-radius: 4px 4px 0 0;\n\n    -webkit-box-shadow: 0 -4px 5px rgba(0, 0, 0, .15);\n       -moz-box-shadow: 0 -4px 5px rgba(0, 0, 0, .15);\n            box-shadow: 0 -4px 5px rgba(0, 0, 0, .15);\n}\n\n.select2-container .select2-choice div {\n    display: block;\n    width: 18px;\n    height: 100%;\n    position: absolute;\n    right: 0;\n    top: 0;\n\n    border-left: 1px solid #aaa;\n    -webkit-border-radius: 0 4px 4px 0;\n       -moz-border-radius: 0 4px 4px 0;\n            border-radius: 0 4px 4px 0;\n\n    -webkit-background-clip: padding-box;\n       -moz-background-clip: padding;\n            background-clip: padding-box;\n\n    background: #ccc;\n    background-image: -webkit-gradient(linear, left bottom, left top, color-stop(0, #ccc), color-stop(0.6, #eee));\n    background-image: -webkit-linear-gradient(center bottom, #ccc 0%, #eee 60%);\n    background-image: -moz-linear-gradient(center bottom, #ccc 0%, #eee 60%);\n    background-image: -o-linear-gradient(bottom, #ccc 0%, #eee 60%);\n    background-image: -ms-linear-gradient(top, #cccccc 0%, #eeeeee 60%);\n    filter: progid:DXImageTransform.Microsoft.gradient(startColorstr = '#eeeeee', endColorstr = '#cccccc', GradientType = 0);\n    background-image: linear-gradient(top, #cccccc 0%, #eeeeee 60%);\n}\n\n.select2-container .select2-choice div b {\n    display: block;\n    width: 100%;\n    height: 100%;\n    background: url('contrib/select2-3.3.1/select2.png') no-repeat 0 1px;\n}\n\n.select2-search {\n    display: inline-block;\n    width: 100%;\n    min-height: 26px;\n    margin: 0;\n    padding-left: 4px;\n    padding-right: 4px;\n\n    position: relative;\n    z-index: 10000;\n\n    white-space: nowrap;\n}\n\n.select2-search-hidden {\n    display: block;\n    position: absolute;\n    left: -10000px;\n}\n\n.select2-search input {\n    width: 100%;\n    height: auto !important;\n    min-height: 26px;\n    padding: 4px 20px 4px 5px;\n    margin: 0;\n\n    outline: 0;\n    font-family: sans-serif;\n    font-size: 1em;\n\n    border: 1px solid #aaa;\n    -webkit-border-radius: 0;\n       -moz-border-radius: 0;\n            border-radius: 0;\n\n    -webkit-box-shadow: none;\n       -moz-box-shadow: none;\n            box-shadow: none;\n\n    background: #fff url('contrib/select2-3.3.1/select2.png') no-repeat 100% -22px;\n    background: url('contrib/select2-3.3.1/select2.png') no-repeat 100% -22px, -webkit-gradient(linear, left bottom, left top, color-stop(0.85, white), color-stop(0.99, #eeeeee));\n    background: url('contrib/select2-3.3.1/select2.png') no-repeat 100% -22px, -webkit-linear-gradient(center bottom, white 85%, #eeeeee 99%);\n    background: url('contrib/select2-3.3.1/select2.png') no-repeat 100% -22px, -moz-linear-gradient(center bottom, white 85%, #eeeeee 99%);\n    background: url('contrib/select2-3.3.1/select2.png') no-repeat 100% -22px, -o-linear-gradient(bottom, white 85%, #eeeeee 99%);\n    background: url('contrib/select2-3.3.1/select2.png') no-repeat 100% -22px, -ms-linear-gradient(top, #ffffff 85%, #eeeeee 99%);\n    background: url('contrib/select2-3.3.1/select2.png') no-repeat 100% -22px, linear-gradient(top, #ffffff 85%, #eeeeee 99%);\n}\n\n.select2-drop.select2-drop-above .select2-search input {\n    margin-top: 4px;\n}\n\n.select2-search input.select2-active {\n    background: #fff url('contrib/select2-3.3.1/select2-spinner.gif') no-repeat 100%;\n    background: url('contrib/select2-3.3.1/select2-spinner.gif') no-repeat 100%, -webkit-gradient(linear, left bottom, left top, color-stop(0.85, white), color-stop(0.99, #eeeeee));\n    background: url('contrib/select2-3.3.1/select2-spinner.gif') no-repeat 100%, -webkit-linear-gradient(center bottom, white 85%, #eeeeee 99%);\n    background: url('contrib/select2-3.3.1/select2-spinner.gif') no-repeat 100%, -moz-linear-gradient(center bottom, white 85%, #eeeeee 99%);\n    background: url('contrib/select2-3.3.1/select2-spinner.gif') no-repeat 100%, -o-linear-gradient(bottom, white 85%, #eeeeee 99%);\n    background: url('contrib/select2-3.3.1/select2-spinner.gif') no-repeat 100%, -ms-linear-gradient(top, #ffffff 85%, #eeeeee 99%);\n    background: url('contrib/select2-3.3.1/select2-spinner.gif') no-repeat 100%, linear-gradient(top, #ffffff 85%, #eeeeee 99%);\n}\n\n.select2-container-active .select2-choice,\n.select2-container-active .select2-choices {\n    border: 1px solid #5897fb;\n    outline: none;\n\n    -webkit-box-shadow: 0 0 5px rgba(0,0,0,.3);\n       -moz-box-shadow: 0 0 5px rgba(0,0,0,.3);\n            box-shadow: 0 0 5px rgba(0,0,0,.3);\n}\n\n.select2-dropdown-open .select2-choice {\n    border-bottom-color: transparent;\n    -webkit-box-shadow: 0 1px 0 #fff inset;\n       -moz-box-shadow: 0 1px 0 #fff inset;\n            box-shadow: 0 1px 0 #fff inset;\n\n    -webkit-border-bottom-left-radius: 0;\n        -moz-border-radius-bottomleft: 0;\n            border-bottom-left-radius: 0;\n\n    -webkit-border-bottom-right-radius: 0;\n        -moz-border-radius-bottomright: 0;\n            border-bottom-right-radius: 0;\n\n    background-color: #eee;\n    background-image: -webkit-gradient(linear, left bottom, left top, color-stop(0, white), color-stop(0.5, #eeeeee));\n    background-image: -webkit-linear-gradient(center bottom, white 0%, #eeeeee 50%);\n    background-image: -moz-linear-gradient(center bottom, white 0%, #eeeeee 50%);\n    background-image: -o-linear-gradient(bottom, white 0%, #eeeeee 50%);\n    background-image: -ms-linear-gradient(top, #ffffff 0%,#eeeeee 50%);\n    filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#eeeeee', endColorstr='#ffffff',GradientType=0 );\n    background-image: linear-gradient(top, #ffffff 0%,#eeeeee 50%);\n}\n\n.select2-dropdown-open .select2-choice div {\n    background: transparent;\n    border-left: none;\n    filter: none;\n}\n.select2-dropdown-open .select2-choice div b {\n    background-position: -18px 1px;\n}\n\n/* results */\n.select2-results {\n    max-height: 200px;\n    padding: 0 0 0 4px;\n    margin: 4px 4px 4px 0;\n    position: relative;\n    overflow-x: hidden;\n    overflow-y: auto;\n    -webkit-tap-highlight-color: rgba(0,0,0,0);\n}\n\n.select2-results ul.select2-result-sub {\n    margin: 0;\n}\n\n.select2-results ul.select2-result-sub > li .select2-result-label { padding-left: 20px }\n.select2-results ul.select2-result-sub ul.select2-result-sub > li .select2-result-label { padding-left: 40px }\n.select2-results ul.select2-result-sub ul.select2-result-sub ul.select2-result-sub > li .select2-result-label { padding-left: 60px }\n.select2-results ul.select2-result-sub ul.select2-result-sub ul.select2-result-sub ul.select2-result-sub > li .select2-result-label { padding-left: 80px }\n.select2-results ul.select2-result-sub ul.select2-result-sub ul.select2-result-sub ul.select2-result-sub ul.select2-result-sub > li .select2-result-label { padding-left: 100px }\n.select2-results ul.select2-result-sub ul.select2-result-sub ul.select2-result-sub ul.select2-result-sub ul.select2-result-sub ul.select2-result-sub > li .select2-result-label { padding-left: 110px }\n.select2-results ul.select2-result-sub ul.select2-result-sub ul.select2-result-sub ul.select2-result-sub ul.select2-result-sub ul.select2-result-sub ul.select2-result-sub > li .select2-result-label { padding-left: 120px }\n\n.select2-results li {\n    list-style: none;\n    display: list-item;\n    background-image: none;\n}\n\n.select2-results li.select2-result-with-children > .select2-result-label {\n    font-weight: bold;\n}\n\n.select2-results .select2-result-label {\n    padding: 3px 7px 4px;\n    margin: 0;\n    cursor: pointer;\n\n    -webkit-touch-callout: none;\n      -webkit-user-select: none;\n       -khtml-user-select: none;\n         -moz-user-select: none;\n          -ms-user-select: none;\n              user-select: none;\n}\n\n.select2-results .select2-highlighted {\n    background: #3875d7;\n    color: #fff;\n}\n\n.select2-results li em {\n    background: #feffde;\n    font-style: normal;\n}\n\n.select2-results .select2-highlighted em {\n    background: transparent;\n}\n\n.select2-results .select2-highlighted ul {\n    background: white;\n    color: #000;\n}\n\n\n.select2-results .select2-no-results,\n.select2-results .select2-searching,\n.select2-results .select2-selection-limit {\n    background: #f4f4f4;\n    display: list-item;\n}\n\n/*\ndisabled look for disabled choices in the results dropdown\n*/\n.select2-results .select2-disabled.select2-highlighted {\n    color: #666;\n    background: #f4f4f4;\n    display: list-item;\n    cursor: default;\n}\n.select2-results .select2-disabled {\n  background: #f4f4f4;\n  display: list-item;\n  cursor: default;\n}\n\n.select2-results .select2-selected {\n    display: none;\n}\n\n.select2-more-results.select2-active {\n    background: #f4f4f4 url('contrib/select2-3.3.1/select2-spinner.gif') no-repeat 100%;\n}\n\n.select2-more-results {\n    background: #f4f4f4;\n    display: list-item;\n}\n\n/* disabled styles */\n\n.select2-container.select2-container-disabled .select2-choice {\n    background-color: #f4f4f4;\n    background-image: none;\n    border: 1px solid #ddd;\n    cursor: default;\n}\n\n.select2-container.select2-container-disabled .select2-choice div {\n    background-color: #f4f4f4;\n    background-image: none;\n    border-left: 0;\n}\n\n.select2-container.select2-container-disabled .select2-choice abbr {\n    display: none\n}\n\n\n/* multiselect */\n\n.select2-container-multi .select2-choices {\n    height: auto !important;\n    height: 1%;\n    margin: 0;\n    padding: 0;\n    position: relative;\n\n    border: 1px solid #aaa;\n    cursor: text;\n    overflow: hidden;\n\n    background-color: #fff;\n    background-image: -webkit-gradient(linear, 0% 0%, 0% 100%, color-stop(1%, #eeeeee), color-stop(15%, #ffffff));\n    background-image: -webkit-linear-gradient(top, #eeeeee 1%, #ffffff 15%);\n    background-image: -moz-linear-gradient(top, #eeeeee 1%, #ffffff 15%);\n    background-image: -o-linear-gradient(top, #eeeeee 1%, #ffffff 15%);\n    background-image: -ms-linear-gradient(top, #eeeeee 1%, #ffffff 15%);\n    background-image: linear-gradient(top, #eeeeee 1%, #ffffff 15%);\n}\n\n.select2-locked {\n  padding: 3px 5px 3px 5px !important;\n}\n\n.select2-container-multi .select2-choices {\n    min-height: 26px;\n}\n\n.select2-container-multi.select2-container-active .select2-choices {\n    border: 1px solid #5897fb;\n    outline: none;\n\n    -webkit-box-shadow: 0 0 5px rgba(0,0,0,.3);\n       -moz-box-shadow: 0 0 5px rgba(0,0,0,.3);\n            box-shadow: 0 0 5px rgba(0,0,0,.3);\n}\n.select2-container-multi .select2-choices li {\n    float: left;\n    list-style: none;\n}\n.select2-container-multi .select2-choices .select2-search-field {\n    margin: 0;\n    padding: 0;\n    white-space: nowrap;\n}\n\n.select2-container-multi .select2-choices .select2-search-field input {\n    padding: 5px;\n    margin: 1px 0;\n\n    font-family: sans-serif;\n    font-size: 100%;\n    color: #666;\n    outline: 0;\n    border: 0;\n    -webkit-box-shadow: none;\n       -moz-box-shadow: none;\n            box-shadow: none;\n    background: transparent !important;\n}\n\n.select2-container-multi .select2-choices .select2-search-field input.select2-active {\n    background: #fff url('contrib/select2-3.3.1/select2-spinner.gif') no-repeat 100% !important;\n}\n\n.select2-default {\n    color: #999 !important;\n}\n\n.select2-container-multi .select2-choices .select2-search-choice {\n    padding: 3px 5px 3px 18px;\n    margin: 3px 0 3px 5px;\n    position: relative;\n\n    line-height: 13px;\n    color: #333;\n    cursor: default;\n    border: 1px solid #aaaaaa;\n\n    -webkit-border-radius: 3px;\n       -moz-border-radius: 3px;\n            border-radius: 3px;\n\n    -webkit-box-shadow: 0 0 2px #ffffff inset, 0 1px 0 rgba(0,0,0,0.05);\n       -moz-box-shadow: 0 0 2px #ffffff inset, 0 1px 0 rgba(0,0,0,0.05);\n            box-shadow: 0 0 2px #ffffff inset, 0 1px 0 rgba(0,0,0,0.05);\n\n    -webkit-background-clip: padding-box;\n       -moz-background-clip: padding;\n            background-clip: padding-box;\n\n    -webkit-touch-callout: none;\n      -webkit-user-select: none;\n       -khtml-user-select: none;\n         -moz-user-select: none;\n          -ms-user-select: none;\n              user-select: none;\n\n    background-color: #e4e4e4;\n    filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#eeeeee', endColorstr='#f4f4f4', GradientType=0 );\n    background-image: -webkit-gradient(linear, 0% 0%, 0% 100%, color-stop(20%, #f4f4f4), color-stop(50%, #f0f0f0), color-stop(52%, #e8e8e8), color-stop(100%, #eeeeee));\n    background-image: -webkit-linear-gradient(top, #f4f4f4 20%, #f0f0f0 50%, #e8e8e8 52%, #eeeeee 100%);\n    background-image: -moz-linear-gradient(top, #f4f4f4 20%, #f0f0f0 50%, #e8e8e8 52%, #eeeeee 100%);\n    background-image: -o-linear-gradient(top, #f4f4f4 20%, #f0f0f0 50%, #e8e8e8 52%, #eeeeee 100%);\n    background-image: -ms-linear-gradient(top, #f4f4f4 20%, #f0f0f0 50%, #e8e8e8 52%, #eeeeee 100%);\n    background-image: linear-gradient(top, #f4f4f4 20%, #f0f0f0 50%, #e8e8e8 52%, #eeeeee 100%);\n}\n.select2-container-multi .select2-choices .select2-search-choice span {\n    cursor: default;\n}\n.select2-container-multi .select2-choices .select2-search-choice-focus {\n    background: #d4d4d4;\n}\n\n.select2-search-choice-close {\n    display: block;\n    width: 12px;\n    height: 13px;\n    position: absolute;\n    right: 3px;\n    top: 4px;\n\n    font-size: 1px;\n    outline: none;\n    background: url('contrib/select2-3.3.1/select2.png') right top no-repeat;\n}\n\n.select2-container-multi .select2-search-choice-close {\n    left: 3px;\n}\n\n.select2-container-multi .select2-choices .select2-search-choice .select2-search-choice-close:hover {\n  background-position: right -11px;\n}\n.select2-container-multi .select2-choices .select2-search-choice-focus .select2-search-choice-close {\n    background-position: right -11px;\n}\n\n/* disabled styles */\n.select2-container-multi.select2-container-disabled .select2-choices{\n    background-color: #f4f4f4;\n    background-image: none;\n    border: 1px solid #ddd;\n    cursor: default;\n}\n\n.select2-container-multi.select2-container-disabled .select2-choices .select2-search-choice {\n    padding: 3px 5px 3px 5px;\n    border: 1px solid #ddd;\n    background-image: none;\n    background-color: #f4f4f4;\n}\n\n.select2-container-multi.select2-container-disabled .select2-choices .select2-search-choice .select2-search-choice-close {\n    display: none;\n}\n/* end multiselect */\n\n\n.select2-result-selectable .select2-match,\n.select2-result-unselectable .select2-match {\n    text-decoration: underline;\n}\n\n.select2-offscreen {\n    position: absolute;\n    left: -10000px;\n}\n\n/* Retina-ize icons */\n\n@media only screen and (-webkit-min-device-pixel-ratio: 1.5), only screen and (min-resolution: 144dpi)  {\n  .select2-search input, .select2-search-choice-close, .select2-container .select2-choice abbr, .select2-container .select2-choice div b {\n      background-image: url('contrib/select2-3.3.1/select2x2.png') !important;\n      background-repeat: no-repeat !important;\n      background-size: 60px 40px !important;\n  }\n  .select2-search input {\n      background-position: 100% -21px !important;\n  }\n}\n.clearfix{*zoom:1;}.clearfix:before,.clearfix:after{display:table;content:\"\";line-height:0;}\n.clearfix:after{clear:both;}\n.hide-text{font:0/0 a;color:transparent;text-shadow:none;background-color:transparent;border:0;}\n.input-block-level{display:block;width:100%;min-height:26px;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;}\n.ie7-force-layout{*min-width:0;}\n.splunk-multidropdown .select2-container,.splunk-dropdown .select2-container,.shared-controls-multiinputcontrol .select2-container,.splunk-multidropdown .select2-container-multi,.splunk-dropdown .select2-container-multi,.shared-controls-multiinputcontrol .select2-container-multi{min-width:200px;margin-bottom:8px;}.splunk-multidropdown .select2-container .select2-choices,.splunk-dropdown .select2-container .select2-choices,.shared-controls-multiinputcontrol .select2-container .select2-choices,.splunk-multidropdown .select2-container-multi .select2-choices,.splunk-dropdown .select2-container-multi .select2-choices,.shared-controls-multiinputcontrol .select2-container-multi .select2-choices{min-height:0px;-webkit-border-radius:4px;-moz-border-radius:4px;border-radius:4px;background-color:#ffffff;border:1px solid #cccccc;-webkit-box-shadow:inset 0 1px 1px rgba(0, 0, 0, 0.075);-moz-box-shadow:inset 0 1px 1px rgba(0, 0, 0, 0.075);box-shadow:inset 0 1px 1px rgba(0, 0, 0, 0.075);-webkit-transition:border linear .2s, box-shadow linear .2s;-moz-transition:border linear .2s, box-shadow linear .2s;-o-transition:border linear .2s, box-shadow linear .2s;transition:border linear .2s, box-shadow linear .2s;}.splunk-multidropdown .select2-container .select2-choices .select2-search-field,.splunk-dropdown .select2-container .select2-choices .select2-search-field,.shared-controls-multiinputcontrol .select2-container .select2-choices .select2-search-field,.splunk-multidropdown .select2-container-multi .select2-choices .select2-search-field,.splunk-dropdown .select2-container-multi .select2-choices .select2-search-field,.shared-controls-multiinputcontrol .select2-container-multi .select2-choices .select2-search-field{height:24px;}\n.splunk-multidropdown .select2-container .select2-choices .select2-search-choice,.splunk-dropdown .select2-container .select2-choices .select2-search-choice,.shared-controls-multiinputcontrol .select2-container .select2-choices .select2-search-choice,.splunk-multidropdown .select2-container-multi .select2-choices .select2-search-choice,.splunk-dropdown .select2-container-multi .select2-choices .select2-search-choice,.shared-controls-multiinputcontrol .select2-container-multi .select2-choices .select2-search-choice{margin:2px;background-color:#f4f4f4;background-image:-moz-linear-gradient(top, #f8f8f8, #eeeeee);background-image:-webkit-gradient(linear, 0 0, 0 100%, from(#f8f8f8), to(#eeeeee));background-image:-webkit-linear-gradient(top, #f8f8f8, #eeeeee);background-image:-o-linear-gradient(top, #f8f8f8, #eeeeee);background-image:linear-gradient(to bottom, #f8f8f8, #eeeeee);background-repeat:repeat-x;filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#fff8f8f8', endColorstr='#ffeeeeee', GradientType=0);background-color:#eeeeee;border:1px solid #bfbfbf;border-top-color:#bfbfbf;border-bottom-color:#bfbfbf;color:#333333;-webkit-box-shadow:inset 0px 1px 0 #fdfdfd;-moz-box-shadow:inset 0px 1px 0 #fdfdfd;box-shadow:inset 0px 1px 0 #fdfdfd;-webkit-border-radius:2px;-moz-border-radius:2px;border-radius:2px;}.splunk-multidropdown .select2-container .select2-choices .select2-search-choice .select2-search-choice-close,.splunk-dropdown .select2-container .select2-choices .select2-search-choice .select2-search-choice-close,.shared-controls-multiinputcontrol .select2-container .select2-choices .select2-search-choice .select2-search-choice-close,.splunk-multidropdown .select2-container-multi .select2-choices .select2-search-choice .select2-search-choice-close,.splunk-dropdown .select2-container-multi .select2-choices .select2-search-choice .select2-search-choice-close,.shared-controls-multiinputcontrol .select2-container-multi .select2-choices .select2-search-choice .select2-search-choice-close{top:2px;}\n.splunk-multidropdown .select2-container .select2-choices .select2-search-choice div,.splunk-dropdown .select2-container .select2-choices .select2-search-choice div,.shared-controls-multiinputcontrol .select2-container .select2-choices .select2-search-choice div,.splunk-multidropdown .select2-container-multi .select2-choices .select2-search-choice div,.splunk-dropdown .select2-container-multi .select2-choices .select2-search-choice div,.shared-controls-multiinputcontrol .select2-container-multi .select2-choices .select2-search-choice div{line-height:16px;margin-top:-2px;margin-bottom:-1px;overflow:hidden;text-overflow:ellipsis;}\n.splunk-multidropdown .select2-container .select2-choice,.splunk-dropdown .select2-container .select2-choice,.shared-controls-multiinputcontrol .select2-container .select2-choice,.splunk-multidropdown .select2-container-multi .select2-choice,.splunk-dropdown .select2-container-multi .select2-choice,.shared-controls-multiinputcontrol .select2-container-multi .select2-choice{background-color:#f4f4f4;background-image:-moz-linear-gradient(top, #f8f8f8, #eeeeee);background-image:-webkit-gradient(linear, 0 0, 0 100%, from(#f8f8f8), to(#eeeeee));background-image:-webkit-linear-gradient(top, #f8f8f8, #eeeeee);background-image:-o-linear-gradient(top, #f8f8f8, #eeeeee);background-image:linear-gradient(to bottom, #f8f8f8, #eeeeee);background-repeat:repeat-x;filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#fff8f8f8', endColorstr='#ffeeeeee', GradientType=0);background-color:#eeeeee;border:1px solid #bfbfbf;border-top-color:#bfbfbf;border-bottom-color:#bfbfbf;color:#333333;-webkit-box-shadow:inset 0px 1px 0 #fdfdfd;-moz-box-shadow:inset 0px 1px 0 #fdfdfd;box-shadow:inset 0px 1px 0 #fdfdfd;height:24px;line-height:24px;}.splunk-multidropdown .select2-container .select2-choice:hover,.splunk-dropdown .select2-container .select2-choice:hover,.shared-controls-multiinputcontrol .select2-container .select2-choice:hover,.splunk-multidropdown .select2-container-multi .select2-choice:hover,.splunk-dropdown .select2-container-multi .select2-choice:hover,.shared-controls-multiinputcontrol .select2-container-multi .select2-choice:hover{background-image:-moz-linear-gradient(top, #f8f8f8, #f8f8f8);background-image:-webkit-gradient(linear, 0 0, 0 100%, from(#f8f8f8), to(#f8f8f8));background-image:-webkit-linear-gradient(top, #f8f8f8, #f8f8f8);background-image:-o-linear-gradient(top, #f8f8f8, #f8f8f8);background-image:linear-gradient(to bottom, #f8f8f8, #f8f8f8);background-repeat:repeat-x;filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#fff8f8f8', endColorstr='#fff8f8f8', GradientType=0);-webkit-box-shadow:0px 1px 1px rgba(0, 0, 0, 0.08);-moz-box-shadow:0px 1px 1px rgba(0, 0, 0, 0.08);box-shadow:0px 1px 1px rgba(0, 0, 0, 0.08);background-color:#f8f8f8;border-color:#c7c7c7;border-top-color:#c7c7c7;border-bottom-color:#c7c7c7;background-position:0 0;}\n.splunk-multidropdown .select2-container .select2-choice div,.splunk-dropdown .select2-container .select2-choice div,.shared-controls-multiinputcontrol .select2-container .select2-choice div,.splunk-multidropdown .select2-container-multi .select2-choice div,.splunk-dropdown .select2-container-multi .select2-choice div,.shared-controls-multiinputcontrol .select2-container-multi .select2-choice div{width:auto;padding-left:8px;padding-right:8px;background:transparent;border-left:none;}.splunk-multidropdown .select2-container .select2-choice div:after,.splunk-dropdown .select2-container .select2-choice div:after,.shared-controls-multiinputcontrol .select2-container .select2-choice div:after,.splunk-multidropdown .select2-container-multi .select2-choice div:after,.splunk-dropdown .select2-container-multi .select2-choice div:after,.shared-controls-multiinputcontrol .select2-container-multi .select2-choice div:after{display:inline-block;font-family:\"Splunk Icons\";content:\"\\25BE\";font-size:inherit;opacity:0.8;filter:alpha(opacity=80);}\n.splunk-multidropdown .select2-container .select2-choice div:hover,.splunk-dropdown .select2-container .select2-choice div:hover,.shared-controls-multiinputcontrol .select2-container .select2-choice div:hover,.splunk-multidropdown .select2-container-multi .select2-choice div:hover,.splunk-dropdown .select2-container-multi .select2-choice div:hover,.shared-controls-multiinputcontrol .select2-container-multi .select2-choice div:hover{opacity:1;filter:alpha(opacity=100);}\n.splunk-multidropdown .select2-container .select2-choice div b,.splunk-dropdown .select2-container .select2-choice div b,.shared-controls-multiinputcontrol .select2-container .select2-choice div b,.splunk-multidropdown .select2-container-multi .select2-choice div b,.splunk-dropdown .select2-container-multi .select2-choice div b,.shared-controls-multiinputcontrol .select2-container-multi .select2-choice div b{display:none;}\n.splunk-multidropdown .select2-container .select2-choice .select2-search-choice-close,.splunk-dropdown .select2-container .select2-choice .select2-search-choice-close,.shared-controls-multiinputcontrol .select2-container .select2-choice .select2-search-choice-close,.splunk-multidropdown .select2-container-multi .select2-choice .select2-search-choice-close,.splunk-dropdown .select2-container-multi .select2-choice .select2-search-choice-close,.shared-controls-multiinputcontrol .select2-container-multi .select2-choice .select2-search-choice-close{background:none;background-image:none !important;top:1px;}.splunk-multidropdown .select2-container .select2-choice .select2-search-choice-close:before,.splunk-dropdown .select2-container .select2-choice .select2-search-choice-close:before,.shared-controls-multiinputcontrol .select2-container .select2-choice .select2-search-choice-close:before,.splunk-multidropdown .select2-container-multi .select2-choice .select2-search-choice-close:before,.splunk-dropdown .select2-container-multi .select2-choice .select2-search-choice-close:before,.shared-controls-multiinputcontrol .select2-container-multi .select2-choice .select2-search-choice-close:before{display:inline-block;font-family:\"Splunk Icons\";content:\"\\2297\";font-size:16px;opacity:0.8;filter:alpha(opacity=80);}\n.splunk-multidropdown .select2-container .select2-choice .select2-search-choice-close:hover,.splunk-dropdown .select2-container .select2-choice .select2-search-choice-close:hover,.shared-controls-multiinputcontrol .select2-container .select2-choice .select2-search-choice-close:hover,.splunk-multidropdown .select2-container-multi .select2-choice .select2-search-choice-close:hover,.splunk-dropdown .select2-container-multi .select2-choice .select2-search-choice-close:hover,.shared-controls-multiinputcontrol .select2-container-multi .select2-choice .select2-search-choice-close:hover{opacity:1;filter:alpha(opacity=100);}\n.select2-drop{background-color:#eeeeee;background-color:#ececec;background-image:-moz-linear-gradient(top, #e4e4e4, #f8f8f8);background-image:-webkit-gradient(linear, 0 0, 0 100%, from(#e4e4e4), to(#f8f8f8));background-image:-webkit-linear-gradient(top, #e4e4e4, #f8f8f8);background-image:-o-linear-gradient(top, #e4e4e4, #f8f8f8);background-image:linear-gradient(to bottom, #e4e4e4, #f8f8f8);background-repeat:repeat-x;filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#ffe4e4e4', endColorstr='#fff8f8f8', GradientType=0);border:1px solid #bfbfbf;border-bottom-color:#bfbfbf;border-top-color:#bfbfbf;filter:progid:DXImageTransform.Microsoft.gradient(enabled = false);box-shadow:1px 6px 5px rgba(0, 0, 0, 0.3);-webkit-border-radius:3px;-moz-border-radius:3px;border-radius:3px;-webkit-border-top-left-radius:0;-moz-border-radius-topleft:0;border-top-left-radius:0;-webkit-border-top-right-radius:0;-moz-border-radius-topright:0;border-top-right-radius:0;border-top:none;padding:5px;}.select2-drop .select2-search{padding-left:0;padding-right:0;}.select2-drop .select2-search input{-webkit-border-radius:15px;-moz-border-radius:15px;border-radius:15px;margin-bottom:5px;}\n.select2-drop .select2-results{border:1px solid #aeaeae;border-bottom-color:#959595;border-top-color:#bbbbbb;-webkit-border-radius:3px;-moz-border-radius:3px;border-radius:3px;background-color:#ffffff;padding:0;margin:0;}.select2-drop .select2-results .select2-result-selectable{background-color:#ffffff;border-top:1px dotted #dddddd;color:#5379af;}.select2-drop .select2-results .select2-result-selectable:hover{color:#32496a;background:#eeeeee;}\n.select2-drop .select2-results .select2-result-selectable:first-child{-webkit-border-top-left-radius:3px;-moz-border-radius-topleft:3px;border-top-left-radius:3px;-webkit-border-top-right-radius:3px;-moz-border-radius-topright:3px;border-top-right-radius:3px;border-top:none;}\n.select2-drop .select2-results .select2-result-selectable:last-child{-webkit-border-bottom-left-radius:3px;-moz-border-radius-bottomleft:3px;border-bottom-left-radius:3px;-webkit-border-bottom-right-radius:3px;-moz-border-radius-bottomright:3px;border-bottom-right-radius:3px;}\n.select2-drop .select2-results .select2-result div{overflow:hidden;text-overflow:ellipsis;}\n.select2-drop .select2-no-results{text-align:center;color:red;}\n.splunk-dropdown .select2-container.select2-container-active,.splunk-multidropdown .select2-container-multi.select2-container-active .select2-choices{border-color:rgba(82, 168, 236, 0.8);outline:0;outline:thin dotted \\9;-webkit-box-shadow:inset 0 1px 1px rgba(0,0,0,.075), 0 0 8px rgba(82,168,236,.6);-moz-box-shadow:inset 0 1px 1px rgba(0,0,0,.075), 0 0 8px rgba(82,168,236,.6);box-shadow:inset 0 1px 1px rgba(0,0,0,.075), 0 0 8px rgba(82,168,236,.6);}\n.shared-controls-multiinputcontrol .select2-container-multi.select2-dropdown-open .select2-choices,.splunk-multidropdown .select2-container-multi.select2-dropdown-open .select2-choices{-webkit-border-bottom-left-radius:0;-moz-border-radius-bottomleft:0;border-bottom-left-radius:0;-webkit-border-bottom-right-radius:0;-moz-border-radius-bottomright:0;border-bottom-right-radius:0;}\n.select2-drop .select2-results .select2-result-selectable.select2-highlighted .select2-result-label{color:#32496a;background:#eeeeee;}\n.select2-drop.empty-results-allowed .select2-no-results{background-color:#ffffff;padding:3px 7px 4px;}\n.select2-container{width:100%;}\n.splunk-checkboxgroup {\n    width: 220px;\n}\n\n.splunk-checkboxgroup .choice label, .splunk-checkbox .choice label {\n        display: inline-block;\n        margin-left: 0.4em;        \n}\n\n.shared-controls-syntheticcheckboxcontrol a.btn {\n    position: absolute;\n    left: 0;\n}\n.shared-controls-syntheticcheckboxcontrol label {\n    padding: 0 0 0 21px;\n    overflow:hidden;\n    text-overflow:ellipsis;\n    margin: 5px 0;\n}\n.shared-controls-syntheticcheckboxcontrol label:first-child {\n    padding-top: 0;\n}\n.shared-controls-syntheticcheckboxcontrol label:last-child {\n    padding-bottom: 0;\n}\n\n.splunk-checkboxgroup-choices {\n    margin-bottom: 8px;\n}\n/*  */\n\n.splunk-paginator {\n    user-select: none;\n    -moz-user-select: none;\n    -webkit-user-select: none;\n    margin-bottom: 5px;\n    padding-left: 15px;\n}\n.splunk-paginator .disabled, .splunk-paginator .selected {\n    color: #999;\n    cursor: default;\n}\n.splunk-paginator a {\n    border: 1px solid transparent;\n    border-radius: 3px;\n    padding-left: 5px;\n    padding-right: 5px;\n    text-decoration: none;\n    min-width: 20px;\n    line-height: 20px;\n    display: inline-block;\n    text-align: center;\n}\n.splunk-paginator a.selected, .splunk-paginator a:hover {\n    background: #eee;\n}\n.splunk-paginator span {\n    padding-left: 5px;\n    padding-right: 5px;\n}\n.splunk-paginator a.disabled:hover {\n    background: none;\n}.clearfix{*zoom:1;}.clearfix:before,.clearfix:after{display:table;content:\"\";line-height:0;}\n.clearfix:after{clear:both;}\n.hide-text{font:0/0 a;color:transparent;text-shadow:none;background-color:transparent;border:0;}\n.input-block-level{display:block;width:100%;min-height:26px;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;}\n.ie7-force-layout{*min-width:0;}\n.shared-resultstable .simpleResultsTableWrapper{width:100%;overflow:auto;}\n.shared-resultstable table .pos{color:#999999;text-align:right;font-size:11px;width:50px;}\n.shared-resultstable table tr>th:first-child,.shared-resultstable table tr>td:first-child{padding-left:20px;}\n.shared-resultstable table tr>th:last-child,.shared-resultstable table tr>td:last-child{padding-right:20px;}\n.shared-resultstable .table-chrome th a{color:#333333;text-decoration:none;}\n.shared-resultstable .table-chrome th.pos:after{content:\"\";}\n.shared-resultstable-resultstablemaster{overflow-x:auto;}.shared-resultstable-resultstablemaster table tr>th:first-child,.shared-resultstable-resultstablemaster table tr>td:first-child{padding-left:20px;}\n.shared-resultstable-resultstablemaster table tr>th:last-child,.shared-resultstable-resultstablemaster table tr>td:last-child{padding-right:20px;}\n.shared-resultstable-resultstablemaster td.numeric .multivalue-subcell{text-align:right;}\n.shared-resultstable-resultstablemaster td.timestamp,.shared-resultstable-resultstablemaster th.timestamp{min-width:150px;}\n.shared-resultstable-resultstablemaster table.single-column-table th.numeric{text-align:left;}\n.shared-resultstable-resultstablemaster table.single-column-table td.numeric{text-align:left;}.shared-resultstable-resultstablemaster table.single-column-table td.numeric .multivalue-subcell{text-align:left;}\n.shared-resultstable-resultstablemaster>.table>tbody>tr>td.with-overlay{padding-right:20px !important;}\n.shared-resultstable-resultstablemaster .overlay-cell{height:24px;width:15px;float:right;margin:-4px -20px -24px 0;}\n.shared-resultstable-resultstablemaster .overlay-cell-value{height:24px;width:0;border-left:15px solid #f5f5f5;}\n.shared-resultstable-resultstablemaster .heat-value{border-left-color:#d85d3c;}\n.shared-resultstable-resultstablemaster .max-value{border-left-color:#d85d3c;}\n.shared-resultstable-resultstablemaster .min-value{border-left-color:#6ab7c7;}\n.shared-resultstable-resultstablemaster .no-value{border-left-color:transparent;}\n.shared-resultstable-resultstablemaster .tbody tr.even td{background-color:transparent;}\n.shared-resultstable-resultstablemaster .tbody tr.odd td{background-color:#f5f5f5;}\n.shared-resultstable-resultstablemaster .wrapped-results th,.shared-resultstable-resultstablemaster .wrapped-results td{white-space:normal;}\n.shared-resultstable-resultstablemaster .not-wrapped-results th,.shared-resultstable-resultstablemaster .not-wrapped-results td{white-space:nowrap;}\n.shared-resultstable-resultstablemaster thead tr.sorts th.highlighted{background-image:-moz-linear-gradient(top, #f8f8f8, #f8f8f8);background-image:-webkit-gradient(linear, 0 0, 0 100%, from(#f8f8f8), to(#f8f8f8));background-image:-webkit-linear-gradient(top, #f8f8f8, #f8f8f8);background-image:-o-linear-gradient(top, #f8f8f8, #f8f8f8);background-image:linear-gradient(to bottom, #f8f8f8, #f8f8f8);background-repeat:repeat-x;filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#fff8f8f8', endColorstr='#fff8f8f8', GradientType=0);-webkit-box-shadow:0px 1px 1px rgba(0, 0, 0, 0.08);-moz-box-shadow:0px 1px 1px rgba(0, 0, 0, 0.08);box-shadow:0px 1px 1px rgba(0, 0, 0, 0.08);background-color:#f8f8f8;border-color:#c7c7c7;border-top-color:#c7c7c7;border-bottom-color:#c7c7c7;background-position:0 0;}\n.shared-resultstable-resultstablemaster tbody td.highlighted,.shared-resultstable-resultstablemaster tbody tr.highlighted>td{background-color:#e4e4e4 !important;cursor:pointer;}\n.shared-resultstable-resultstablemaster .multivalue-subcell.highlighted{background-color:#e4e4e4 !important;cursor:pointer;}\n.shared-resultstable-resultstablemaster .scroll-table-wrapper{height:100%;}\n.shared-resultstable-resultstablemaster th.col-info{padding-left:20px;padding-right:0px;}.shared-resultstable-resultstablemaster th.col-info .icon-info{display:block;width:15px;}\n.shared-resultstable-resultstablemaster table>tbody>tr>td.row-expansion-toggle{border-right:1px solid #D5D5D5;padding:0px;}.shared-resultstable-resultstablemaster table>tbody>tr>td.row-expansion-toggle a{color:#333333;display:block;padding:4px 0px 4px 20px;width:15px;height:16px;}\n.shared-resultstable-resultstablemaster table>tbody>tr>td.row-expansion-toggle .icon-triangle-right-small:before{content:\"\\203A\";}\n.shared-resultstable-resultstablemaster table>tbody>tr>td.row-expansion-toggle .icon-triangle-down-small:before{content:\"\\02C5\";}\n.shared-resultstable-resultstablemaster tr.expanded-row td,.shared-resultstable-resultstablemaster tr.expanded-content-row td{background-color:#E4E4E4 !important;}\n.shared-resultstable-resultstablemaster tr.expanded-content-row td{border-top:none;color:#333333;}\n.clearfix{*zoom:1;}.clearfix:before,.clearfix:after{display:table;content:\"\";line-height:0;}\n.clearfix:after{clear:both;}\n.hide-text{font:0/0 a;color:transparent;text-shadow:none;background-color:transparent;border:0;}\n.input-block-level{display:block;width:100%;min-height:26px;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;}\n.ie7-force-layout{*min-width:0;}\n.btn-pan-left,.btn-pan-right{background:#525252;background:rgba(0, 0, 0, 0.32);position:absolute;z-index:9999;padding:4px 5px;color:#FFFFFF;line-height:10px;-webkit-border-radius:1px;-moz-border-radius:1px;border-radius:1px;}.btn-pan-left:hover,.btn-pan-right:hover,.btn-pan-left.active,.btn-pan-right.active{background:#454545;background:rgba(0, 0, 0, 0.27);text-decoration:none;color:#FFFFFF;-webkit-border-radius:1px;-moz-border-radius:1px;border-radius:1px;}\n.btn-zoom-out,.btn-reset-selection{position:absolute;z-index:9999;}\n.btn-reset-selection{margin-top:5px;margin-right:10px;}\n.clearfix{*zoom:1;}.clearfix:before,.clearfix:after{display:table;content:\"\";line-height:0;}\n.clearfix:after{clear:both;}\n.hide-text{font:0/0 a;color:transparent;text-shadow:none;background-color:transparent;border:0;}\n.input-block-level{display:block;width:100%;min-height:26px;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;}\n.ie7-force-layout{*min-width:0;}\n.search-results-wrapper{clear:both;min-height:400px;*zoom:1;}.search-results-wrapper:before,.search-results-wrapper:after{display:table;content:\"\";line-height:0;}\n.search-results-wrapper:after{clear:both;}\n.event .raw-event,.event .json-event{font-family:'Droid Sans Mono','Consolas','Monaco','Courier New',Courier,monospace;font-size:12px;color:#333333;border:none;background-color:transparent;margin:auto;padding:0;}.event .raw-event em,.event .json-event em{font-style:normal ;}\n.event .raw-event .a,.event .json-event .a,.event .raw-event .h,.event .json-event .h,.event .raw-event .fields .v:hover,.event .json-event .fields .v:hover,.event .raw-event .fields .tg:hover,.event .json-event .fields .tg:hover,.event .raw-event .time:hover,.event .json-event .time:hover{background-color:#fde9a8;border-top:4px solid #fde9a8;border-bottom:4px solid #fde9a8;color:#32496a;}\n.event .raw-event .key-name,.event .json-event .key-name{color:#d85d3c;font-weight:bold;}\n.event .raw-event .string,.event .json-event .string{color:#1abb97;}\n.event .raw-event .number,.event .json-event .number{color:#956d95;}\n.event .raw-event .boolean,.event .json-event .boolean{color:#f7902b;}\n.event .raw-event .null,.event .json-event .null{color:#f7902b;}\n.shared-eventsviewer th.col-0,.shared-eventsviewer th.line-num,.shared-eventsviewer th.col-time{width:1px;}\n.shared-eventsviewer th.col-time.ie7,.shared-eventsviewer th.col-0.ie7{width:150px;}\n.shared-eventsviewer th.line-num.ie7{width:50px;}\n.shared-eventsviewer th.col-0:last-child,.shared-eventsviewer th.col-time:last-child{width:auto;}\n.shared-eventsviewer th.col-0.ie8{width:auto;}\n.shared-eventsviewer td._time>span>span{white-space:nowrap;}\n.shared-eventsviewer .shared-eventsviewer-table-body-primaryrow>td.no-wrap{white-space:pre;}\n.shared-eventsviewer td.expands.et_blue{background-color:#5379af !important;border-right:1px solid #5379af !important;}.shared-eventsviewer td.expands.et_blue:hover{background-color:#6b8cba !important;}\n.shared-eventsviewer td.expands.et_green{background-color:#9ac23c !important;border-right:1px solid #9ac23c !important;}.shared-eventsviewer td.expands.et_green:hover{background-color:#a8cb57 !important;}\n.shared-eventsviewer td.expands.et_magenta{background-color:#dd86af !important;border-right:1px solid #dd86af !important;}.shared-eventsviewer td.expands.et_magenta:hover{background-color:#e5a2c1 !important;}\n.shared-eventsviewer td.expands.et_orange{background-color:#f7902b !important;border-right:1px solid #f7902b !important;}.shared-eventsviewer td.expands.et_orange:hover{background-color:#f8a24d !important;}\n.shared-eventsviewer td.expands.et_purple{background-color:#956d95 !important;border-right:1px solid #956d95 !important;}.shared-eventsviewer td.expands.et_purple:hover{background-color:#a482a4 !important;}\n.shared-eventsviewer td.expands.et_red{background-color:#d85d3c !important;border-right:1px solid #d85d3c !important;}.shared-eventsviewer td.expands.et_red:hover{background-color:#de765a !important;}\n.shared-eventsviewer td.expands.et_sky{background-color:#6ab7c7 !important;border-right:1px solid #6ab7c7 !important;}.shared-eventsviewer td.expands.et_sky:hover{background-color:#84c4d1 !important;}\n.shared-eventsviewer td.expands.et_teal{background-color:#1abb97 !important;border-right:1px solid #1abb97 !important;}.shared-eventsviewer td.expands.et_teal:hover{background-color:#1edab0 !important;}\n.shared-eventsviewer td.expands.et_yellow{background-color:#fac51c !important;border-right:1px solid #fac51c !important;}.shared-eventsviewer td.expands.et_yellow:hover{background-color:#fbce3f !important;}\n.shared-eventsviewer .event-fields-loading{padding:20px 0;color:#999999;}\n.shared-eventsviewer ul.condensed-selected-fields{margin:5px 0 0 0;max-width:100%;}.shared-eventsviewer ul.condensed-selected-fields li{color:#999999;margin-right:10px;float:left;list-style:none;display:inline;max-width:100%;}.shared-eventsviewer ul.condensed-selected-fields li>:last-child{padding-right:10px;border-right:1px dashed #cccccc;}\n.shared-eventsviewer ul.condensed-selected-fields li:last-child{margin-right:0;}.shared-eventsviewer ul.condensed-selected-fields li:last-child>:last-child{padding-right:0;border-right:none;}\n.shared-eventsviewer ul.condensed-selected-fields li .field-value{display:inline-block;}\n.shared-eventsviewer ul.condensed-selected-fields li .f-v{display:inline-block;max-width:500px;word-wrap:normal;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;vertical-align:top;}\n.shared-eventsviewer ul.condensed-selected-fields li .f-v,.shared-eventsviewer ul.condensed-selected-fields li .more-fields{color:#333333;cursor:pointer;}.shared-eventsviewer ul.condensed-selected-fields li .f-v:hover,.shared-eventsviewer ul.condensed-selected-fields li .more-fields:hover{color:#32496a;}\n.shared-eventsviewer ul.condensed-selected-fields li>.tag{color:inherit;}.shared-eventsviewer ul.condensed-selected-fields li>.tag:hover{color:#32496a;}\n.shared-eventsviewer .formated-time:hover{color:#32496a;text-decoration:underline;cursor:pointer;}\n.shared-eventsviewer .table-embed{margin-top:10px;margin-bottom:0;background-color:transparent;width:auto;clear:left;min-width:0;}.shared-eventsviewer .table-embed th:first-child{padding-left:0;}\n.shared-eventsviewer .table-embed td>a._time-expand{display:inline;margin-left:2px;}\n.shared-eventsviewer .table-embed td>a._time-expand:hover{text-decoration:none;}\n.shared-eventsviewer .table-embed td{border-bottom:none ;line-height:20px;}\n.shared-eventsviewer .table-embed tbody:first-child tr:first-child td{border-top:none ;}\n.shared-eventsviewer .table-embed a{text-decoration:none;display:block;min-width:16px;padding:0 3px;}.shared-eventsviewer .table-embed a:hover{background:#ebebeb;color:#32496a !important;}\n.shared-eventsviewer .table-embed a._time-expand:hover,.shared-eventsviewer .table-embed a.more-fields:hover{text-decoration:underline;background:none;}\n.shared-eventsviewer .table-embed .field-actions{font-size:14px;height:20px;overflow:hidden;text-align:center;padding-right:0;}\n.shared-eventsviewer .table-embed .btn-group{font-size:inherit;}\n.shared-eventsviewer .table-embed .field-type{padding-left:0;}\n.shared-eventsviewer .table-embed .field-key{padding:0 8px 0 0;}\n.shared-eventsviewer .table-embed td.field-value{word-break:break-all;padding-left:0;}\n.shared-eventsviewer .table-embed .field-value a{display:inline-block;}\n.shared-eventsviewer tr.row-more-fields+tr>td{border-top:none;border-bottom:none;}\n.shared-eventsviewer .col-more-fields{padding-left:10px;vertical-align:middle;}\n.shared-eventsviewer .col-visibility{text-align:left;font-size:20px;padding:0 !important;width:auto;}.shared-eventsviewer .col-visibility .checkbox{padding:1px 5px 1px 0;margin:0;}.shared-eventsviewer .col-visibility .checkbox>a,.shared-eventsviewer .col-visibility .checkbox>a:hover{padding:0;color:#333333 !important;}\n.shared-eventsviewer th.col-visibility{padding-bottom:4px !important;}\n.shared-eventsviewer th.col-field-name,.shared-eventsviewer th.col-field-value{padding-left:4px;}\n.shared-eventsviewer a:hover .icon-hidden{color:inherit;}\n.shared-eventsviewer .table-expanded a{color:#5379af !important;}\n.shared-eventsviewer .table-expanded a:hover{color:#32496a !important;}\n.shared-eventsviewer .table{margin-bottom:0;}\n.shared-eventsviewer .hide-line-num th.line-num,.shared-eventsviewer .hide-line-num td.line-num{display:none;}\n.shared-eventsviewer .normal.raw-event{background-color:inherit;border:none;white-space:pre;}\n.shared-eventsviewer .normal.raw-event.wrap{white-space:pre-wrap;word-break:break-all;}\n.shared-eventsviewer .event-actions{margin-top:10px;}\n.shared-eventsviewer .showinline,.shared-eventsviewer .hideinline{white-space:nowrap;word-wrap:normal;display:block;}\n.shared-eventsviewer-list,.shared-eventsviewer-table,.shared-eventsviewer-raw{background:#ffffff;}\n.events-results-table{min-width:100%;width:auto;*width:100%;}.events-results-table>tbody>tr>td>a,.events-results-table>tbody>tr>td>span.field-val{text-decoration:none;display:block;}\n.events-results-table>tbody>tr>td.one-value-drilldown:hover,.events-results-table>tbody>tr>td._time-drilldown:hover,.events-results-table>tbody>tr>td.multi-value-drilldown>a.field-val:hover{background-color:#ffffff;cursor:pointer;}\n.events-results-table>tbody>tr>td.one-value-drilldown:hover>a.field-val,.events-results-table>tbody>tr>td._time-drilldown:hover>a{color:#32496a;}\n.docked-header-table>table{border-top:0;}\n.reorderable{border-left:1px solid #d5d5d5;}\n.reorderable-label{position:relative;display:block;padding:4px 8px 4px 18px;}\n.sorts .reorderable-label:after{font-family:\"Splunk Icons\";content:\"\\2195 \";padding-left:5px;color:#bbbbbb;}\n.sorts.asc .reorderable-label:after,.sorts.Asc .reorderable-label:after{content:\"\\21A5 \";color:#333333;}\n.sorts.desc .reorderable-label:after,.sorts.Desc .reorderable-label:after{content:\"\\21A7 \";color:#333333;}\n.reorderable-helper{background-color:#d85d3c;background-color:#f4f4f4;background-image:-moz-linear-gradient(top, #f8f8f8, #eeeeee);background-image:-webkit-gradient(linear, 0 0, 0 100%, from(#f8f8f8), to(#eeeeee));background-image:-webkit-linear-gradient(top, #f8f8f8, #eeeeee);background-image:-o-linear-gradient(top, #f8f8f8, #eeeeee);background-image:linear-gradient(to bottom, #f8f8f8, #eeeeee);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#fff8f8f8', endColorstr='#ffeeeeee', GradientType=0);background-color:#eeeeee;border:1px solid #bfbfbf;border-top-color:#bfbfbf;border-bottom-color:#bfbfbf;color:#333333;-webkit-box-shadow:inset 0px 1px 0 #fdfdfd;-moz-box-shadow:inset 0px 1px 0 #fdfdfd;box-shadow:inset 0px 1px 0 #fdfdfd;background-image:-moz-linear-gradient(top, #f8f8f8, #f8f8f8);background-image:-webkit-gradient(linear, 0 0, 0 100%, from(#f8f8f8), to(#f8f8f8));background-image:-webkit-linear-gradient(top, #f8f8f8, #f8f8f8);background-image:-o-linear-gradient(top, #f8f8f8, #f8f8f8);background-image:linear-gradient(to bottom, #f8f8f8, #f8f8f8);background-repeat:repeat-x;filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#fff8f8f8', endColorstr='#fff8f8f8', GradientType=0);-webkit-box-shadow:0px 1px 1px rgba(0, 0, 0, 0.08);-moz-box-shadow:0px 1px 1px rgba(0, 0, 0, 0.08);box-shadow:0px 1px 1px rgba(0, 0, 0, 0.08);background-color:#f8f8f8;border-color:#c7c7c7;border-top-color:#c7c7c7;border-bottom-color:#c7c7c7;background-position:0 0;-webkit-border-radius:0;-moz-border-radius:0;border-radius:0;z-index:10;line-height:16px;}\n.reorderable-helper.reorderable-remove{background-color:#fdf7f5;background-image:-moz-linear-gradient(top, #ffffff, #faeae6);background-image:-webkit-gradient(linear, 0 0, 0 100%, from(#ffffff), to(#faeae6));background-image:-webkit-linear-gradient(top, #ffffff, #faeae6);background-image:-o-linear-gradient(top, #ffffff, #faeae6);background-image:linear-gradient(to bottom, #ffffff, #faeae6);background-repeat:repeat-x;filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#ffffffff', endColorstr='#fffaeae6', GradientType=0);border-color:#cfb3ab;}\nth.reorderable{cursor:move;padding:0;}th.reorderable.sorts:after{display:none;}\n.on.reorderable-label:before{content:\"\";position:absolute;display:block;height:20px;width:7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAYAAACp8Z5+AAAAG0lEQVQIW2M0Njb+f/bsWUYYzciABuAyOFUAAKKMEAXhn6ySAAAAAElFTkSuQmCC) repeat;top:3px;left:3px;opacity:0.5;margin-bottom:-10px;}\nth.reorderable.moving{color:transparent;text-shadow:none;background:#cccccc;}\nth.reorderable.moving .reorderable-label:before{background:none;}\nth.reorderable.moving .reorderable-label:after{color:transparent;}\n.table-insertion-cursor{border-left:1px dashed #d85d3c;position:absolute;top:0;left:-100px;bottom:0;margin-left:-1px;display:none;}\n@media print{td.expands,td.actions,th.col-info{display:none !important;} .reorderable-label{padding-left:8px !important;}.reorderable-label:before{background:none !important;} .shared-eventsviewer pre.raw-event{word-break:break-all !important;word-wrap:break-word !important;overflow-wrap:break-word !important;white-space:normal !important;} .shared-eventsviewer,.events-viewer-wrapper{max-width:100% !important;width:100% !important;overflow:hidden !important;}}.shared-fieldinfo{width:600px;}.shared-fieldinfo .popdown-dialog-body{padding:0 20px 20px 20px;}\n.shared-fieldinfo h2{margin:-1px -21px 10px -21px;line-height:40px;font-size:16px;font-weight:normal;color:#333333;padding:0 60px 0 20px;-webkit-border-top-right-radius:3px;-moz-border-radius-topright:3px;border-top-right-radius:3px;-webkit-border-top-left-radius:3px;-moz-border-radius-topleft:3px;border-top-left-radius:3px;border-bottom:1px solid #cccccc;box-shadow:none;*zoom:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}\n.shared-fieldinfo h3{font-size:12px;font-weight:bold;margin:15px 0 0 0;}\n.shared-fieldinfo p{line-height:30px;}\n.shared-fieldinfo .select-field-label{display:inline-block;margin:0 5px 0 20px;line-height:26px;color:#999999;vertical-align:top;}\n.shared-fieldinfo .graph-bar{margin:0 20px 0 0;height:16px;background-color:#999999;background-color:#b8b8b8;background-image:-moz-linear-gradient(top, #cccccc, #999999);background-image:-webkit-gradient(linear, 0 0, 0 100%, from(#cccccc), to(#999999));background-image:-webkit-linear-gradient(top, #cccccc, #999999);background-image:-o-linear-gradient(top, #cccccc, #999999);background-image:linear-gradient(to bottom, #cccccc, #999999);background-repeat:repeat-x;filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#ffcccccc', endColorstr='#ff999999', GradientType=0);max-width:100%;}\n.shared-fieldinfo table.table-condensed{margin:13px -20px -5px -20px;width:598px;}\n.shared-fieldinfo table.fields{width:100%;}.shared-fieldinfo table.fields td{padding:3px 0px;vertical-align:top;}\n.shared-fieldinfo td.value{max-width:200px;word-wrap:break-word;padding-left:20px;}\n.shared-fieldinfo th.value{padding-left:20px;}\n.shared-fieldinfo ul.inline{line-height:20px;margin-bottom:0;}.shared-fieldinfo ul.inline li{padding-left:0;}\n.shared-fieldinfo .close{display:block;top:12px;right:20px;opacity:0.4;filter:alpha(opacity=40);overflow:hidden;position:absolute;font-size:16px;}.shared-fieldinfo .close:hover{opacity:0.8;filter:alpha(opacity=80);}\n.clearfix{*zoom:1;}.clearfix:before,.clearfix:after{display:table;content:\"\";line-height:0;}\n.clearfix:after{clear:both;}\n.hide-text{font:0/0 a;color:transparent;text-shadow:none;background-color:transparent;border:0;}\n.input-block-level{display:block;width:100%;min-height:26px;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;}\n.ie7-force-layout{*min-width:0;}\n.single-value{margin:20px;display:inline-block;*display:inline;*zoom:1;text-align:center;}.single-value .single-result{font-size:24px;font-weight:bold;word-wrap:break-word;}\n.single-value .before-label{margin-right:1em;}\n.single-value .after-label{margin-left:1em;}\n.single-value .under-label{text-transform:uppercase;color:#999999;font-size:11px;}\n.single-value .severe,.single-value.severe .single-result{color:#d85d3c;}\n.single-value .high,.single-value.high .single-result{color:#f7902b;}\n.single-value .elevated,.single-value.elevated .single-result{color:#fac51c;}\n.single-value .guarded,.single-value.guarded .single-result{color:#6ab7c7;}\n.single-value .low,.single-value.low .single-result{color:#65a637;}\n.single-value .None,.single-value.None .single-result{color:#999999;}\n")
});requirejs.s.contexts._.nextTick=requirejs.nextTick;
//# sourceMappingURL=investigator.built.js.map